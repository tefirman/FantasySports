<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 14.1.0"/>
    <title>fantasyfb documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>




            <h2>Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#League">League</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#League.__init__">League</a>
                        </li>
                        <li>
                                <a class="variable" href="#League.latest_season">latest_season</a>
                        </li>
                        <li>
                                <a class="variable" href="#League.season">season</a>
                        </li>
                        <li>
                                <a class="variable" href="#League.current_week">current_week</a>
                        </li>
                        <li>
                                <a class="variable" href="#League.week">week</a>
                        </li>
                        <li>
                                <a class="variable" href="#League.num_sims">num_sims</a>
                        </li>
                        <li>
                                <a class="function" href="#League.load_credentials">load_credentials</a>
                        </li>
                        <li>
                                <a class="function" href="#League.load_oauth">load_oauth</a>
                        </li>
                        <li>
                                <a class="function" href="#League.load_league">load_league</a>
                        </li>
                        <li>
                                <a class="function" href="#League.load_settings">load_settings</a>
                        </li>
                        <li>
                                <a class="function" href="#League.load_fantasy_teams">load_fantasy_teams</a>
                        </li>
                        <li>
                                <a class="function" href="#League.load_nfl_abbrevs">load_nfl_abbrevs</a>
                        </li>
                        <li>
                                <a class="function" href="#League.load_nfl_schedule">load_nfl_schedule</a>
                        </li>
                        <li>
                                <a class="function" href="#League.refresh_oauth">refresh_oauth</a>
                        </li>
                        <li>
                                <a class="function" href="#League.get_yahoo_players">get_yahoo_players</a>
                        </li>
                        <li>
                                <a class="function" href="#League.get_fantasy_rosters">get_fantasy_rosters</a>
                        </li>
                        <li>
                                <a class="function" href="#League.pull_stats">pull_stats</a>
                        </li>
                        <li>
                                <a class="function" href="#League.add_points">add_points</a>
                        </li>
                        <li>
                                <a class="function" href="#League.load_stats">load_stats</a>
                        </li>
                        <li>
                                <a class="function" href="#League.name_corrections">name_corrections</a>
                        </li>
                        <li>
                                <a class="function" href="#League.get_player_ids">get_player_ids</a>
                        </li>
                        <li>
                                <a class="function" href="#League.load_parameters">load_parameters</a>
                        </li>
                        <li>
                                <a class="function" href="#League.add_injuries">add_injuries</a>
                        </li>
                        <li>
                                <a class="function" href="#League.add_bye_weeks">add_bye_weeks</a>
                        </li>
                        <li>
                                <a class="function" href="#League.add_roster_pcts">add_roster_pcts</a>
                        </li>
                        <li>
                                <a class="function" href="#League.add_depth_charts">add_depth_charts</a>
                        </li>
                        <li>
                                <a class="function" href="#League.get_rates">get_rates</a>
                        </li>
                        <li>
                                <a class="function" href="#League.get_schedule">get_schedule</a>
                        </li>
                        <li>
                                <a class="function" href="#League.starters">starters</a>
                        </li>
                        <li>
                                <a class="function" href="#League.bestball_sims">bestball_sims</a>
                        </li>
                        <li>
                                <a class="function" href="#League.season_sims">season_sims</a>
                        </li>
                        <li>
                                <a class="function" href="#League.war_sim">war_sim</a>
                        </li>
                        <li>
                                <a class="function" href="#League.possible_pickups">possible_pickups</a>
                        </li>
                        <li>
                                <a class="function" href="#League.possible_adds">possible_adds</a>
                        </li>
                        <li>
                                <a class="function" href="#League.possible_drops">possible_drops</a>
                        </li>
                        <li>
                                <a class="function" href="#League.possible_trades">possible_trades</a>
                        </li>
                        <li>
                                <a class="function" href="#League.perGameDelta">perGameDelta</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="function" href="#excelAutofit">excelAutofit</a>
            </li>
            <li>
                    <a class="function" href="#sendEmail">sendEmail</a>
            </li>
            <li>
                    <a class="function" href="#initialize_inputs">initialize_inputs</a>
            </li>
            <li>
                    <a class="function" href="#main">main</a>
            </li>
    </ul>



        <a class="attribution" title="pdoc: Python documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
fantasyfb    </h1>

                        <div class="docstring"><p>@File    :   fantasyfb.py <br />
@Time    :   2019/09/07 19:09:47 <br />
@Author  :   Taylor Firman <br />
@Version :   1.0 <br />
@Contact :   tefirman@gmail.com <br />
@Desc    :   Firman Fantasy Football Algorithm</p>
</div>

                        <input id="mod-fantasyfb-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-fantasyfb-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">   1</span></a><span class="ch">#!/usr/bin/env python</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">   2</span></a><span class="c1"># -*-coding:utf-8 -*-</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">   3</span></a><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">   4</span></a><span class="sd">@File    :   fantasyfb.py  </span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">   5</span></a><span class="sd">@Time    :   2019/09/07 19:09:47  </span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">   6</span></a><span class="sd">@Author  :   Taylor Firman  </span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">   7</span></a><span class="sd">@Version :   1.0  </span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">   8</span></a><span class="sd">@Contact :   tefirman@gmail.com  </span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">   9</span></a><span class="sd">@Desc    :   Firman Fantasy Football Algorithm</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">  10</span></a><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">  11</span></a>
</span><span id="L-12"><a href="#L-12"><span class="linenos">  12</span></a><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos">  13</span></a><span class="kn">import</span> <span class="nn">os</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos">  14</span></a><span class="kn">import</span> <span class="nn">shutil</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos">  15</span></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos">  16</span></a><span class="kn">from</span> <span class="nn">util</span> <span class="kn">import</span> <span class="n">sportsref_nfl</span> <span class="k">as</span> <span class="n">sr</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos">  17</span></a><span class="kn">import</span> <span class="nn">time</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos">  18</span></a><span class="kn">import</span> <span class="nn">datetime</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos">  19</span></a><span class="kn">from</span> <span class="nn">pytz</span> <span class="kn">import</span> <span class="n">timezone</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos">  20</span></a><span class="kn">import</span> <span class="nn">optparse</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos">  21</span></a><span class="kn">from</span> <span class="nn">yahoo_oauth</span> <span class="kn">import</span> <span class="n">OAuth2</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos">  22</span></a><span class="kn">import</span> <span class="nn">yahoo_fantasy_api</span> <span class="k">as</span> <span class="nn">yfa</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos">  23</span></a><span class="kn">import</span> <span class="nn">json</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos">  24</span></a><span class="kn">import</span> <span class="nn">smtplib</span><span class="o">,</span> <span class="nn">ssl</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos">  25</span></a><span class="kn">from</span> <span class="nn">email</span> <span class="kn">import</span> <span class="n">encoders</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos">  26</span></a><span class="kn">from</span> <span class="nn">email.mime.base</span> <span class="kn">import</span> <span class="n">MIMEBase</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos">  27</span></a><span class="kn">from</span> <span class="nn">email.mime.multipart</span> <span class="kn">import</span> <span class="n">MIMEMultipart</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos">  28</span></a><span class="kn">from</span> <span class="nn">email.mime.text</span> <span class="kn">import</span> <span class="n">MIMEText</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos">  29</span></a><span class="kn">from</span> <span class="nn">dotenv</span> <span class="kn">import</span> <span class="n">load_dotenv</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos">  30</span></a><span class="kn">import</span> <span class="nn">traceback</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos">  31</span></a>
</span><span id="L-32"><a href="#L-32"><span class="linenos">  32</span></a>
</span><span id="L-33"><a href="#L-33"><span class="linenos">  33</span></a><span class="k">class</span> <span class="nc">League</span><span class="p">:</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos">  34</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos">  35</span></a><span class="sd">    League class that gathers all relevant settings and statistics</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos">  36</span></a><span class="sd">    to simulate and assess the fantasy league in question.</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos">  37</span></a>
</span><span id="L-38"><a href="#L-38"><span class="linenos">  38</span></a><span class="sd">    Attributes:  </span>
</span><span id="L-39"><a href="#L-39"><span class="linenos">  39</span></a><span class="sd">        season: integer specifying the season of interest  </span>
</span><span id="L-40"><a href="#L-40"><span class="linenos">  40</span></a><span class="sd">        week: integer specifiying the week of interest  </span>
</span><span id="L-41"><a href="#L-41"><span class="linenos">  41</span></a><span class="sd">        oauth: yahoo_oauth object contain user credentials and auth tokens  </span>
</span><span id="L-42"><a href="#L-42"><span class="linenos">  42</span></a><span class="sd">        lg: yahoo_fantasy_api league object used to connect to Yahoo&#39;s API  </span>
</span><span id="L-43"><a href="#L-43"><span class="linenos">  43</span></a><span class="sd">        gm: yahoo_fantasy_api game object used to connect to Yahoo&#39;s API  </span>
</span><span id="L-44"><a href="#L-44"><span class="linenos">  44</span></a><span class="sd">        name: string specifying the name of the fantasy to be analyzed  </span>
</span><span id="L-45"><a href="#L-45"><span class="linenos">  45</span></a><span class="sd">        settings: dictionary containing the scheduling and roster settings for the league in question  </span>
</span><span id="L-46"><a href="#L-46"><span class="linenos">  46</span></a><span class="sd">        scoring: dictionary containing the scoring categories and values for the league in question  </span>
</span><span id="L-47"><a href="#L-47"><span class="linenos">  47</span></a><span class="sd">        teams: list of dictionaries containing identifiers for each fantasy team in the league  </span>
</span><span id="L-48"><a href="#L-48"><span class="linenos">  48</span></a><span class="sd">        nfl_teams: dataframe containing different identifiers for each NFL team  </span>
</span><span id="L-49"><a href="#L-49"><span class="linenos">  49</span></a><span class="sd">        nfl_schedule: dataframe containing NFL schedules throughout the years with elo statistics for both teams  </span>
</span><span id="L-50"><a href="#L-50"><span class="linenos">  50</span></a><span class="sd">        players: dataframe containing demographics and rates for current NFL players  </span>
</span><span id="L-51"><a href="#L-51"><span class="linenos">  51</span></a><span class="sd">        num_sims: integer specifying the number of Monte Carlo simulations to run  </span>
</span><span id="L-52"><a href="#L-52"><span class="linenos">  52</span></a><span class="sd">        earliest: integer describing the earliest week to pull statistics from (YYYYWW)  </span>
</span><span id="L-53"><a href="#L-53"><span class="linenos">  53</span></a><span class="sd">        reference_games: integer describing the number of games to use as a prior for rates  </span>
</span><span id="L-54"><a href="#L-54"><span class="linenos">  54</span></a><span class="sd">        basaloppstringtime: list of the four weighting factors when calculating rates  </span>
</span><span id="L-55"><a href="#L-55"><span class="linenos">  55</span></a><span class="sd">        schedule: dataframe containing the fantasy schedule for the league and season in question</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos">  56</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos">  57</span></a>
</span><span id="L-58"><a href="#L-58"><span class="linenos">  58</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos">  59</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos">  60</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos">  61</span></a>        <span class="n">season</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos">  62</span></a>        <span class="n">week</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos">  63</span></a>        <span class="n">injurytries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos">  64</span></a>        <span class="n">num_sims</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">,</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos">  65</span></a>        <span class="n">earliest</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos">  66</span></a>        <span class="n">reference_games</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos">  67</span></a>        <span class="n">basaloppstringtime</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[],</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos">  68</span></a>        <span class="n">sfb</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos">  69</span></a>        <span class="n">bestball</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos">  70</span></a>    <span class="p">):</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos">  71</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos">  72</span></a><span class="sd">        Initializes a League object using the parameters provided and class functions defined below.</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos">  73</span></a>
</span><span id="L-74"><a href="#L-74"><span class="linenos">  74</span></a><span class="sd">        Args:</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos">  75</span></a><span class="sd">            name (str, optional): string describing the name of the fantasy team in question, defaults to None.  </span>
</span><span id="L-76"><a href="#L-76"><span class="linenos">  76</span></a><span class="sd">            season (int, optional): integer specifying the season of interest, defaults to None.  </span>
</span><span id="L-77"><a href="#L-77"><span class="linenos">  77</span></a><span class="sd">            week (int, optional): integer specifiying the week of interest, defaults to None.  </span>
</span><span id="L-78"><a href="#L-78"><span class="linenos">  78</span></a><span class="sd">            injurytries (int, optional): integer specifying the number of attempts to pull injury statuses, defaults to 10.  </span>
</span><span id="L-79"><a href="#L-79"><span class="linenos">  79</span></a><span class="sd">            num_sims (int, optional): integer specifying the number of Monte Carlo simulations to run, defaults to 10000.  </span>
</span><span id="L-80"><a href="#L-80"><span class="linenos">  80</span></a><span class="sd">            earliest (int, optional): integer describing the earliest week to pull statistics from (YYYYWW), defaults to None.  </span>
</span><span id="L-81"><a href="#L-81"><span class="linenos">  81</span></a><span class="sd">            reference_games (int, optional): integer describing the number of games to use as a prior for rates, defaults to None.  </span>
</span><span id="L-82"><a href="#L-82"><span class="linenos">  82</span></a><span class="sd">            basaloppstringtime (list, optional): list of the four weighting factors when calculating rates, defaults to an empty list.  </span>
</span><span id="L-83"><a href="#L-83"><span class="linenos">  83</span></a><span class="sd">            sfb (bool, optional): whether to implement SFB13 settings and scoring, defaults to False.  </span>
</span><span id="L-84"><a href="#L-84"><span class="linenos">  84</span></a><span class="sd">            bestball (str, optional): which platform to use when implementing best ball settings/scoring, defaults to a blank string (no bestball).</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos">  85</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos">  86</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">latest_season</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">year</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">month</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">)</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos">  87</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Year of the most recent season &quot;&quot;&quot;</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos">  88</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">season</span> <span class="o">=</span> <span class="n">season</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">season</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">latest_season</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos">  89</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Season of interest, defaults to most recent season when no value is provided &quot;&quot;&quot;</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos">  90</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">load_credentials</span><span class="p">()</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos">  91</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">load_oauth</span><span class="p">()</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos">  92</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">load_league</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos">  93</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">current_week</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lg</span><span class="o">.</span><span class="n">current_week</span><span class="p">()</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos">  94</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Most recent week of the season of interest &quot;&quot;&quot;</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos">  95</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">week</span> <span class="o">=</span> <span class="n">week</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">week</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_week</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos">  96</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Week of interest during the season of interest, defaults to most recent week &quot;&quot;&quot;</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos">  97</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">load_settings</span><span class="p">(</span><span class="n">sfb</span><span class="p">,</span> <span class="n">bestball</span><span class="p">)</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos">  98</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">load_fantasy_teams</span><span class="p">()</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos">  99</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">load_nfl_abbrevs</span><span class="p">()</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos"> 100</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">load_nfl_schedule</span><span class="p">()</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos"> 101</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">get_yahoo_players</span><span class="p">(</span><span class="n">injurytries</span><span class="p">)</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos"> 102</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">get_fantasy_rosters</span><span class="p">()</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos"> 103</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name_corrections</span><span class="p">()</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos"> 104</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">get_player_ids</span><span class="p">()</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos"> 105</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_injuries</span><span class="p">()</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos"> 106</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_bye_weeks</span><span class="p">()</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos"> 107</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_roster_pcts</span><span class="p">()</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos"> 108</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_depth_charts</span><span class="p">()</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos"> 109</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">load_parameters</span><span class="p">(</span><span class="n">earliest</span><span class="p">,</span> <span class="n">reference_games</span><span class="p">,</span> <span class="n">basaloppstringtime</span><span class="p">)</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos"> 110</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">num_sims</span> <span class="o">=</span> <span class="n">num_sims</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">num_sims</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span> <span class="k">else</span> <span class="mi">10000</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos"> 111</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Number of simulations to run when assessing the league of interest &quot;&quot;&quot;</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos"> 112</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">get_rates</span><span class="p">()</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos"> 113</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">war_sim</span><span class="p">()</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos"> 114</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">get_schedule</span><span class="p">()</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos"> 115</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">starters</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">week</span><span class="p">)</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos"> 116</span></a>
</span><span id="L-117"><a href="#L-117"><span class="linenos"> 117</span></a>    <span class="k">def</span> <span class="nf">load_credentials</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos"> 118</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos"> 119</span></a><span class="sd">        Loads user credentials from the .env file, specifically the Yahoo consumer key/secret</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos"> 120</span></a><span class="sd">        and email credentials to use when emailing a copy of the results to the user.</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos"> 121</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos"> 122</span></a>        <span class="c1"># Loading Yahoo OAuth credentials from environment variables</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos"> 123</span></a>        <span class="n">load_dotenv</span><span class="p">()</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos"> 124</span></a>        <span class="k">if</span> <span class="s2">&quot;CONSUMER_KEY&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span> <span class="ow">or</span> <span class="s2">&quot;CONSUMER_SECRET&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos"> 125</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No valid .env file present, copying from .env.example&quot;</span><span class="p">)</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos"> 126</span></a>            <span class="n">shutil</span><span class="o">.</span><span class="n">copyfile</span><span class="p">(</span><span class="s2">&quot;.env.example&quot;</span><span class="p">,</span> <span class="s2">&quot;.env&quot;</span><span class="p">)</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos"> 127</span></a>        <span class="c1"># Updating .env file if default values are still present</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos"> 128</span></a>        <span class="k">if</span> <span class="p">(</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos"> 129</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;CONSUMER_KEY&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;updatekey&quot;</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos"> 130</span></a>            <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;CONSUMER_SECRET&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;updatesecret&quot;</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos"> 131</span></a>        <span class="p">):</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos"> 132</span></a>            <span class="c1"># Only have to do this once since we&#39;re storing them in environment variables</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos"> 133</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;It appears you haven&#39;t updated your Yahoo OAuth credentials...&quot;</span><span class="p">)</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos"> 134</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;To get credentials: https://developer.yahoo.com/apps/create/&quot;</span><span class="p">)</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos"> 135</span></a>            <span class="n">consumer_key</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Yahoo OAuth Key: &quot;</span><span class="p">)</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos"> 136</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;sed -i &#39;s/updatekey/</span><span class="si">{}</span><span class="s2">/g&#39; .env&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">consumer_key</span><span class="p">))</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos"> 137</span></a>            <span class="n">consumer_secret</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Yahoo OAuth Secret: &quot;</span><span class="p">)</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos"> 138</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;sed -i &#39;s/updatesecret/</span><span class="si">{}</span><span class="s2">/g&#39; .env&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">consumer_secret</span><span class="p">))</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos"> 139</span></a>            <span class="n">load_dotenv</span><span class="p">()</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos"> 140</span></a>            <span class="c1"># Previous oauth file is probably bad if it exists, deleting it just in case</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos"> 141</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;oauth2.json&quot;</span><span class="p">):</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos"> 142</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;oauth.json&quot;</span><span class="p">)</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos"> 143</span></a>
</span><span id="L-144"><a href="#L-144"><span class="linenos"> 144</span></a>    <span class="k">def</span> <span class="nf">load_oauth</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos"> 145</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos"> 146</span></a><span class="sd">        Initializes an OAuth2 authentication object to connect with Yahoo&#39;s API</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos"> 147</span></a><span class="sd">        using the credentials loaded above in the load_credentials function.</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos"> 148</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos"> 149</span></a>        <span class="c1"># Creating oauth file from credentials provided</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos"> 150</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;oauth2.json&quot;</span><span class="p">):</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos"> 151</span></a>            <span class="n">creds</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos"> 152</span></a>                <span class="s2">&quot;consumer_key&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;CONSUMER_KEY&quot;</span><span class="p">],</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos"> 153</span></a>                <span class="s2">&quot;consumer_secret&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;CONSUMER_SECRET&quot;</span><span class="p">],</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos"> 154</span></a>            <span class="p">}</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos"> 155</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;oauth2.json&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos"> 156</span></a>                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">creds</span><span class="p">))</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos"> 157</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">oauth</span> <span class="o">=</span> <span class="n">OAuth2</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">from_file</span><span class="o">=</span><span class="s2">&quot;oauth2.json&quot;</span><span class="p">)</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos"> 158</span></a>
</span><span id="L-159"><a href="#L-159"><span class="linenos"> 159</span></a>    <span class="k">def</span> <span class="nf">load_league</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos"> 160</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos"> 161</span></a><span class="sd">        Initializes yahoo_fantasy_api game and league objects used to query Yahoo&#39;s API</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos"> 162</span></a><span class="sd">        for details about the league in question. Also identifies fantasy team name and </span>
</span><span id="L-163"><a href="#L-163"><span class="linenos"> 163</span></a><span class="sd">        fantasy league id for future reference throughout the script.</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos"> 164</span></a>
</span><span id="L-165"><a href="#L-165"><span class="linenos"> 165</span></a><span class="sd">        Args:</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos"> 166</span></a><span class="sd">            name (str, optional): string specifiying the name of the team of interest </span>
</span><span id="L-167"><a href="#L-167"><span class="linenos"> 167</span></a><span class="sd">            in case a user has multiple leagues, defaults to None.</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos"> 168</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos"> 169</span></a>        <span class="c1"># Pulling user&#39;s Yahoo fantasy games</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos"> 170</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gm</span> <span class="o">=</span> <span class="n">yfa</span><span class="o">.</span><span class="n">Game</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">oauth</span><span class="p">,</span> <span class="s2">&quot;nfl&quot;</span><span class="p">)</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos"> 171</span></a>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos"> 172</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos"> 173</span></a>                <span class="n">profile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gm</span><span class="o">.</span><span class="n">yhandler</span><span class="o">.</span><span class="n">get_teams_raw</span><span class="p">()[</span><span class="s2">&quot;fantasy_content&quot;</span><span class="p">]</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos"> 174</span></a>                <span class="n">leagues</span> <span class="o">=</span> <span class="n">profile</span><span class="p">[</span><span class="s2">&quot;users&quot;</span><span class="p">][</span><span class="s2">&quot;0&quot;</span><span class="p">][</span><span class="s2">&quot;user&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;games&quot;</span><span class="p">]</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos"> 175</span></a>                <span class="k">break</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos"> 176</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos"> 177</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos"> 178</span></a>                    <span class="s2">&quot;Teams query crapped out... Waiting 30 seconds and trying again...&quot;</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos"> 179</span></a>                <span class="p">)</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos"> 180</span></a>                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos"> 181</span></a>        <span class="c1"># Identifying user&#39;s NFL Yahoo fantasy games</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos"> 182</span></a>        <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">leagues</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos"> 183</span></a>            <span class="n">game</span> <span class="o">=</span> <span class="n">leagues</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">ind</span><span class="p">)][</span><span class="s2">&quot;game&quot;</span><span class="p">]</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos"> 184</span></a>            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">game</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos"> 185</span></a>                <span class="k">continue</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos"> 186</span></a>            <span class="k">if</span> <span class="n">game</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;code&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;nfl&quot;</span> <span class="ow">and</span> <span class="n">game</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;season&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">season</span><span class="p">):</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos"> 187</span></a>                <span class="n">teams</span> <span class="o">=</span> <span class="n">game</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;teams&quot;</span><span class="p">]</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos"> 188</span></a>                <span class="n">details</span> <span class="o">=</span> <span class="p">[</span><span class="n">teams</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">ind</span><span class="p">)][</span><span class="s2">&quot;team&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">teams</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">])]</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos"> 189</span></a>                <span class="n">names</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos"> 190</span></a>                    <span class="p">[</span><span class="n">val</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">team</span> <span class="k">if</span> <span class="s2">&quot;name&quot;</span> <span class="ow">in</span> <span class="n">val</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos"> 191</span></a>                    <span class="k">for</span> <span class="n">team</span> <span class="ow">in</span> <span class="n">details</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos"> 192</span></a>                <span class="p">]</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos"> 193</span></a>                <span class="k">if</span> <span class="n">teams</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos"> 194</span></a>                    <span class="c1"># If user has more than one team, use the name input or prompt them to pick one</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos"> 195</span></a>                    <span class="k">while</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos"> 196</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Found multiple fantasy teams: &quot;</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">names</span><span class="p">))</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos"> 197</span></a>                        <span class="n">name</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Which team would you like to analyze? &quot;</span><span class="p">)</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos"> 198</span></a>                    <span class="n">team</span> <span class="o">=</span> <span class="n">teams</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">name</span><span class="p">))][</span><span class="s2">&quot;team&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos"> 199</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos"> 200</span></a>                    <span class="c1"># If user has only one team, use that one and override whatever name was given</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos"> 201</span></a>                    <span class="n">team</span> <span class="o">=</span> <span class="n">teams</span><span class="p">[</span><span class="s2">&quot;0&quot;</span><span class="p">][</span><span class="s2">&quot;team&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos"> 202</span></a>                    <span class="n">name</span> <span class="o">=</span> <span class="n">names</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos"> 203</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos"> 204</span></a>                <span class="n">team_key</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span><span class="p">[</span><span class="s2">&quot;team_key&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">team</span> <span class="k">if</span> <span class="s2">&quot;team_key&quot;</span> <span class="ow">in</span> <span class="n">val</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos"> 205</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">lg_id</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">team_key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[:</span><span class="mi">3</span><span class="p">])</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos"> 206</span></a>                <span class="k">break</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos"> 207</span></a>        <span class="c1"># Creating league object</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos"> 208</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gm</span><span class="o">.</span><span class="n">to_league</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lg_id</span><span class="p">)</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos"> 209</span></a>
</span><span id="L-210"><a href="#L-210"><span class="linenos"> 210</span></a>    <span class="k">def</span> <span class="nf">load_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sfb</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">bestball</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos"> 211</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos"> 212</span></a><span class="sd">        Pulls league roster/schedule settings and scoring modifiers</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos"> 213</span></a>
</span><span id="L-214"><a href="#L-214"><span class="linenos"> 214</span></a><span class="sd">        Args:</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos"> 215</span></a><span class="sd">            sfb (bool, optional): whether to use Scott Fish Bowl 13 settings, defaults to False.  </span>
</span><span id="L-216"><a href="#L-216"><span class="linenos"> 216</span></a><span class="sd">            bestball (str, optional): which best ball settings to use if desired, defaults to &quot;&quot; (redraft).</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos"> 217</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos"> 218</span></a>        <span class="c1"># Pulling league settings</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos"> 219</span></a>        <span class="n">settings_json</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lg</span><span class="o">.</span><span class="n">yhandler</span><span class="o">.</span><span class="n">get_settings_raw</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lg_id</span><span class="p">)</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos"> 220</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span> <span class="o">=</span> <span class="n">settings_json</span><span class="p">[</span><span class="s2">&quot;fantasy_content&quot;</span><span class="p">][</span><span class="s2">&quot;league&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;settings&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos"> 221</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;playoff_start_week&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;playoff_start_week&quot;</span><span class="p">])</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos"> 222</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;num_playoff_teams&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;num_playoff_teams&quot;</span><span class="p">])</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos"> 223</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">roster_spots</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">pos</span><span class="p">[</span><span class="s2">&quot;roster_position&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;roster_positions&quot;</span><span class="p">]])</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos"> 224</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">roster_spots</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">roster_spots</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos"> 225</span></a>        <span class="n">categories</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos"> 226</span></a>            <span class="p">[</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;stat&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">stat</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;stat_categories&quot;</span><span class="p">][</span><span class="s2">&quot;stats&quot;</span><span class="p">]]</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos"> 227</span></a>        <span class="p">)</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos"> 228</span></a>        <span class="n">modifiers</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos"> 229</span></a>            <span class="p">[</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;stat&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">stat</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;stat_modifiers&quot;</span><span class="p">][</span><span class="s2">&quot;stats&quot;</span><span class="p">]]</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos"> 230</span></a>        <span class="p">)</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos"> 231</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos"> 232</span></a>            <span class="n">left</span><span class="o">=</span><span class="n">categories</span><span class="p">,</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos"> 233</span></a>            <span class="n">right</span><span class="o">=</span><span class="n">modifiers</span><span class="p">,</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos"> 234</span></a>            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">,</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos"> 235</span></a>            <span class="n">on</span><span class="o">=</span><span class="s2">&quot;stat_id&quot;</span><span class="p">,</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos"> 236</span></a>        <span class="p">)[[</span><span class="s2">&quot;display_name&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">({</span><span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">})</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos"> 237</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="o">.</span><span class="n">display_name</span> <span class="o">==</span> <span class="s2">&quot;Int&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="o">.</span><span class="n">value</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">),</span><span class="s2">&quot;display_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Int Thrown&quot;</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos"> 238</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;display_name&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;display_name&quot;</span><span class="p">)[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos"> 239</span></a>        <span class="k">if</span> <span class="n">sfb</span><span class="p">:</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos"> 240</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;playoff_start_week&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos"> 241</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;num_playoff_teams&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos"> 242</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Pass Yds&#39;</span><span class="p">:</span><span class="mf">0.04</span><span class="p">,</span><span class="s1">&#39;Pass Comp&#39;</span><span class="p">:</span><span class="mf">0.1</span><span class="p">,</span><span class="s1">&#39;Pass TD&#39;</span><span class="p">:</span><span class="mf">6.0</span><span class="p">,</span><span class="s1">&#39;Pass 1D&#39;</span><span class="p">:</span><span class="mf">0.1</span><span class="p">,</span><span class="s1">&#39;Pass 300+&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span>\
</span><span id="L-243"><a href="#L-243"><span class="linenos"> 243</span></a>            <span class="s1">&#39;Int Thrown&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Rush Yds&#39;</span><span class="p">:</span><span class="mf">0.1</span><span class="p">,</span><span class="s1">&#39;Rush Att&#39;</span><span class="p">:</span><span class="mf">0.25</span><span class="p">,</span><span class="s1">&#39;Rush TD&#39;</span><span class="p">:</span><span class="mf">6.0</span><span class="p">,</span><span class="s1">&#39;Rush 1D&#39;</span><span class="p">:</span><span class="mf">1.0</span><span class="p">,</span><span class="s1">&#39;Rush 100+&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span>\
</span><span id="L-244"><a href="#L-244"><span class="linenos"> 244</span></a>            <span class="s1">&#39;Rec Yds&#39;</span><span class="p">:</span><span class="mf">0.1</span><span class="p">,</span><span class="s1">&#39;Rec&#39;</span><span class="p">:</span><span class="mf">1.0</span><span class="p">,</span><span class="s1">&#39;Rec TD&#39;</span><span class="p">:</span><span class="mf">6.0</span><span class="p">,</span><span class="s1">&#39;Rec 1D&#39;</span><span class="p">:</span><span class="mf">1.0</span><span class="p">,</span><span class="s1">&#39;Rec 100+&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Ret Yds&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Ret TD&#39;</span><span class="p">:</span><span class="mf">6.0</span><span class="p">,</span>\
</span><span id="L-245"><a href="#L-245"><span class="linenos"> 245</span></a>            <span class="s1">&#39;TE Rec Bonus&#39;</span><span class="p">:</span><span class="mf">1.0</span><span class="p">,</span><span class="s1">&#39;TE 1D Bonus&#39;</span><span class="p">:</span><span class="mf">1.0</span><span class="p">,</span><span class="s1">&#39;2-PT&#39;</span><span class="p">:</span><span class="mf">2.0</span><span class="p">,</span><span class="s1">&#39;Fum Lost&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Fum Ret TD&#39;</span><span class="p">:</span><span class="mf">6.0</span><span class="p">,</span>\
</span><span id="L-246"><a href="#L-246"><span class="linenos"> 246</span></a>            <span class="s1">&#39;FG 0-19&#39;</span><span class="p">:</span><span class="mf">2.0</span><span class="p">,</span><span class="s1">&#39;FG 20-29&#39;</span><span class="p">:</span><span class="mf">2.5</span><span class="p">,</span><span class="s1">&#39;FG 30-39&#39;</span><span class="p">:</span><span class="mf">3.5</span><span class="p">,</span><span class="s1">&#39;FG 40-49&#39;</span><span class="p">:</span><span class="mf">4.5</span><span class="p">,</span><span class="s1">&#39;FG 50+&#39;</span><span class="p">:</span><span class="mf">5.5</span><span class="p">,</span><span class="s1">&#39;PAT Made&#39;</span><span class="p">:</span><span class="mf">3.3</span><span class="p">,</span>\
</span><span id="L-247"><a href="#L-247"><span class="linenos"> 247</span></a>            <span class="s1">&#39;Sack&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Int&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Fum Rec&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;TD&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Safe&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Blk Kick&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span>\
</span><span id="L-248"><a href="#L-248"><span class="linenos"> 248</span></a>            <span class="s1">&#39;Pts Allow 0&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Pts Allow 1-6&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Pts Allow 7-13&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Pts Allow 14-20&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span>\
</span><span id="L-249"><a href="#L-249"><span class="linenos"> 249</span></a>            <span class="s1">&#39;Pts Allow 21-27&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Pts Allow 28-34&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Pts Allow 35+&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;XPR&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">}</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos"> 250</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">roster_spots</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;position&#39;</span><span class="p">:[</span><span class="s1">&#39;QB&#39;</span><span class="p">,</span><span class="s1">&#39;RB&#39;</span><span class="p">,</span><span class="s1">&#39;WR&#39;</span><span class="p">,</span><span class="s1">&#39;TE&#39;</span><span class="p">,</span><span class="s1">&#39;W/R/T&#39;</span><span class="p">,</span><span class="s1">&#39;Q/W/R/T&#39;</span><span class="p">,</span><span class="s1">&#39;K&#39;</span><span class="p">,</span><span class="s1">&#39;BN&#39;</span><span class="p">],</span><span class="s1">&#39;count&#39;</span><span class="p">:[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">]})</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos"> 251</span></a>        <span class="k">elif</span> <span class="nb">str</span><span class="p">(</span><span class="n">bestball</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;dk&quot;</span><span class="p">,</span> <span class="s2">&quot;draftkings&quot;</span><span class="p">]:</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos"> 252</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;playoff_start_week&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">14</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos"> 253</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;num_playoff_teams&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos"> 254</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Pass Yds&#39;</span><span class="p">:</span><span class="mf">0.04</span><span class="p">,</span><span class="s1">&#39;Pass Comp&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Pass TD&#39;</span><span class="p">:</span><span class="mf">4.0</span><span class="p">,</span><span class="s1">&#39;Pass 1D&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Pass 300+&#39;</span><span class="p">:</span><span class="mf">3.0</span><span class="p">,</span>\
</span><span id="L-255"><a href="#L-255"><span class="linenos"> 255</span></a>            <span class="s1">&#39;Int Thrown&#39;</span><span class="p">:</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span><span class="s1">&#39;Rush Yds&#39;</span><span class="p">:</span><span class="mf">0.1</span><span class="p">,</span><span class="s1">&#39;Rush Att&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Rush TD&#39;</span><span class="p">:</span><span class="mf">6.0</span><span class="p">,</span><span class="s1">&#39;Rush 1D&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Rush 100+&#39;</span><span class="p">:</span><span class="mf">3.0</span><span class="p">,</span>\
</span><span id="L-256"><a href="#L-256"><span class="linenos"> 256</span></a>            <span class="s1">&#39;Rec Yds&#39;</span><span class="p">:</span><span class="mf">0.1</span><span class="p">,</span><span class="s1">&#39;Rec&#39;</span><span class="p">:</span><span class="mf">1.0</span><span class="p">,</span><span class="s1">&#39;Rec TD&#39;</span><span class="p">:</span><span class="mf">6.0</span><span class="p">,</span><span class="s1">&#39;Rec 1D&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Rec 100+&#39;</span><span class="p">:</span><span class="mf">3.0</span><span class="p">,</span><span class="s1">&#39;Ret Yds&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Ret TD&#39;</span><span class="p">:</span><span class="mf">6.0</span><span class="p">,</span>\
</span><span id="L-257"><a href="#L-257"><span class="linenos"> 257</span></a>            <span class="s1">&#39;TE Rec Bonus&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;TE 1D Bonus&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;2-PT&#39;</span><span class="p">:</span><span class="mf">2.0</span><span class="p">,</span><span class="s1">&#39;Fum Lost&#39;</span><span class="p">:</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span><span class="s1">&#39;Fum Ret TD&#39;</span><span class="p">:</span><span class="mf">6.0</span><span class="p">,</span>\
</span><span id="L-258"><a href="#L-258"><span class="linenos"> 258</span></a>            <span class="s1">&#39;FG 0-19&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;FG 20-29&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;FG 30-39&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;FG 40-49&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;FG 50+&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;PAT Made&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span>\
</span><span id="L-259"><a href="#L-259"><span class="linenos"> 259</span></a>            <span class="s1">&#39;Sack&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Int&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Fum Rec&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;TD&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Safe&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Blk Kick&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span>\
</span><span id="L-260"><a href="#L-260"><span class="linenos"> 260</span></a>            <span class="s1">&#39;Pts Allow 0&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Pts Allow 1-6&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Pts Allow 7-13&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Pts Allow 14-20&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span>\
</span><span id="L-261"><a href="#L-261"><span class="linenos"> 261</span></a>            <span class="s1">&#39;Pts Allow 21-27&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Pts Allow 28-34&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Pts Allow 35+&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;XPR&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">}</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos"> 262</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">roster_spots</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;position&#39;</span><span class="p">:[</span><span class="s1">&#39;QB&#39;</span><span class="p">,</span><span class="s1">&#39;RB&#39;</span><span class="p">,</span><span class="s1">&#39;WR&#39;</span><span class="p">,</span><span class="s1">&#39;TE&#39;</span><span class="p">,</span><span class="s1">&#39;W/R/T&#39;</span><span class="p">,</span><span class="s1">&#39;Q/W/R/T&#39;</span><span class="p">,</span><span class="s1">&#39;K&#39;</span><span class="p">,</span><span class="s1">&#39;BN&#39;</span><span class="p">],</span><span class="s1">&#39;count&#39;</span><span class="p">:[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">12</span><span class="p">]})</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos"> 263</span></a>        <span class="k">elif</span> <span class="nb">str</span><span class="p">(</span><span class="n">bestball</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;underdog&quot;</span><span class="p">]:</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos"> 264</span></a>            <span class="c1"># Slow Puppy</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos"> 265</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;playoff_start_week&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">14</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos"> 266</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;num_playoff_teams&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos"> 267</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Pass Yds&#39;</span><span class="p">:</span><span class="mf">0.04</span><span class="p">,</span><span class="s1">&#39;Pass Comp&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Pass TD&#39;</span><span class="p">:</span><span class="mf">4.0</span><span class="p">,</span><span class="s1">&#39;Pass 1D&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Pass 300+&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span>\
</span><span id="L-268"><a href="#L-268"><span class="linenos"> 268</span></a>            <span class="s1">&#39;Int Thrown&#39;</span><span class="p">:</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span><span class="s1">&#39;Rush Yds&#39;</span><span class="p">:</span><span class="mf">0.1</span><span class="p">,</span><span class="s1">&#39;Rush Att&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Rush TD&#39;</span><span class="p">:</span><span class="mf">6.0</span><span class="p">,</span><span class="s1">&#39;Rush 1D&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Rush 100+&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span>\
</span><span id="L-269"><a href="#L-269"><span class="linenos"> 269</span></a>            <span class="s1">&#39;Rec Yds&#39;</span><span class="p">:</span><span class="mf">0.1</span><span class="p">,</span><span class="s1">&#39;Rec&#39;</span><span class="p">:</span><span class="mf">0.5</span><span class="p">,</span><span class="s1">&#39;Rec TD&#39;</span><span class="p">:</span><span class="mf">6.0</span><span class="p">,</span><span class="s1">&#39;Rec 1D&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Rec 100+&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Ret Yds&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Ret TD&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span>\
</span><span id="L-270"><a href="#L-270"><span class="linenos"> 270</span></a>            <span class="s1">&#39;TE Rec Bonus&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;TE 1D Bonus&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;2-PT&#39;</span><span class="p">:</span><span class="mf">2.0</span><span class="p">,</span><span class="s1">&#39;Fum Lost&#39;</span><span class="p">:</span><span class="o">-</span><span class="mf">2.0</span><span class="p">,</span><span class="s1">&#39;Fum Ret TD&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span>\
</span><span id="L-271"><a href="#L-271"><span class="linenos"> 271</span></a>            <span class="s1">&#39;FG 0-19&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;FG 20-29&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;FG 30-39&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;FG 40-49&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;FG 50+&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;PAT Made&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span>\
</span><span id="L-272"><a href="#L-272"><span class="linenos"> 272</span></a>            <span class="s1">&#39;Sack&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Int&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Fum Rec&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;TD&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Safe&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Blk Kick&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span>\
</span><span id="L-273"><a href="#L-273"><span class="linenos"> 273</span></a>            <span class="s1">&#39;Pts Allow 0&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Pts Allow 1-6&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Pts Allow 7-13&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Pts Allow 14-20&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span>\
</span><span id="L-274"><a href="#L-274"><span class="linenos"> 274</span></a>            <span class="s1">&#39;Pts Allow 21-27&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Pts Allow 28-34&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Pts Allow 35+&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;XPR&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">}</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos"> 275</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">roster_spots</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;position&#39;</span><span class="p">:[</span><span class="s1">&#39;QB&#39;</span><span class="p">,</span><span class="s1">&#39;RB&#39;</span><span class="p">,</span><span class="s1">&#39;WR&#39;</span><span class="p">,</span><span class="s1">&#39;TE&#39;</span><span class="p">,</span><span class="s1">&#39;W/R/T&#39;</span><span class="p">,</span><span class="s1">&#39;Q/W/R/T&#39;</span><span class="p">,</span><span class="s1">&#39;K&#39;</span><span class="p">,</span><span class="s1">&#39;BN&#39;</span><span class="p">],</span><span class="s1">&#39;count&#39;</span><span class="p">:[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">]})</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos"> 276</span></a>            <span class="c1"># # Pomeranian Superflex</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos"> 277</span></a>            <span class="c1"># self.settings[&#39;num_playoff_teams&#39;] = 3</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos"> 278</span></a>            <span class="c1"># self.roster_spots = pd.DataFrame({&#39;position&#39;:[&#39;QB&#39;,&#39;RB&#39;,&#39;WR&#39;,&#39;TE&#39;,&#39;W/R/T&#39;,&#39;Q/W/R/T&#39;,&#39;K&#39;,&#39;BN&#39;],&#39;count&#39;:[1,2,2,1,1,1,0,12]})</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos"> 279</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos"> 280</span></a>            <span class="k">if</span> <span class="s2">&quot;FG 0-19&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">:</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos"> 281</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;FG 0-19&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos"> 282</span></a>            <span class="k">if</span> <span class="s2">&quot;Rec&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">:</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos"> 283</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Rec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos"> 284</span></a>            <span class="k">if</span> <span class="s2">&quot;Ret Yds&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">:</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos"> 285</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Ret Yds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos"> 286</span></a>            <span class="k">for</span> <span class="n">stat</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Pass Comp&#39;</span><span class="p">,</span><span class="s1">&#39;Pass 1D&#39;</span><span class="p">,</span><span class="s1">&#39;Rush Att&#39;</span><span class="p">,</span><span class="s1">&#39;Rush 1D&#39;</span><span class="p">,</span><span class="s1">&#39;Rec 1D&#39;</span><span class="p">,</span>\
</span><span id="L-287"><a href="#L-287"><span class="linenos"> 287</span></a>            <span class="s1">&#39;TE Rec Bonus&#39;</span><span class="p">,</span><span class="s1">&#39;TE 1D Bonus&#39;</span><span class="p">,</span><span class="s1">&#39;Pass 300+&#39;</span><span class="p">,</span><span class="s1">&#39;Rush 100+&#39;</span><span class="p">,</span><span class="s1">&#39;Rec 100+&#39;</span><span class="p">]:</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos"> 288</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="n">stat</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos"> 289</span></a>
</span><span id="L-290"><a href="#L-290"><span class="linenos"> 290</span></a>    <span class="k">def</span> <span class="nf">load_fantasy_teams</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos"> 291</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos"> 292</span></a><span class="sd">        Pulls a list of all fantasy team names and ids for the league in question.</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos"> 293</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos"> 294</span></a>        <span class="c1"># Pulling list of teams in the fantasy league</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos"> 295</span></a>        <span class="n">league_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lg</span><span class="o">.</span><span class="n">yhandler</span><span class="o">.</span><span class="n">get_standings_raw</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lg_id</span><span class="p">)[</span><span class="s2">&quot;fantasy_content&quot;</span><span class="p">]</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos"> 296</span></a>        <span class="n">teams_info</span> <span class="o">=</span> <span class="n">league_info</span><span class="p">[</span><span class="s2">&quot;league&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;standings&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;teams&quot;</span><span class="p">]</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos"> 297</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">teams</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos"> 298</span></a>            <span class="p">{</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos"> 299</span></a>                <span class="s2">&quot;team_key&quot;</span><span class="p">:</span> <span class="n">teams_info</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">ind</span><span class="p">)][</span><span class="s2">&quot;team&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;team_key&quot;</span><span class="p">],</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos"> 300</span></a>                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">teams_info</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">ind</span><span class="p">)][</span><span class="s2">&quot;team&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos"> 301</span></a>                <span class="s2">&quot;manager&quot;</span><span class="p">:</span> <span class="n">teams_info</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">ind</span><span class="p">)][</span><span class="s2">&quot;team&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;managers&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;manager&#39;</span><span class="p">][</span><span class="s1">&#39;nickname&#39;</span><span class="p">],</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos"> 302</span></a>            <span class="p">}</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos"> 303</span></a>            <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">teams_info</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">])</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos"> 304</span></a>        <span class="p">]</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos"> 305</span></a>
</span><span id="L-306"><a href="#L-306"><span class="linenos"> 306</span></a>    <span class="k">def</span> <span class="nf">load_nfl_abbrevs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos"> 307</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos"> 308</span></a><span class="sd">        Loads a translation table for all NFL team abbreviations across platforms</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos"> 309</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos"> 310</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">nfl_teams</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos"> 311</span></a>            <span class="s2">&quot;https://raw.githubusercontent.com/&quot;</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos"> 312</span></a>            <span class="o">+</span> <span class="s2">&quot;tefirman/FantasySports/main/res/football/team_abbrevs.csv&quot;</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos"> 313</span></a>        <span class="p">)</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos"> 314</span></a>
</span><span id="L-315"><a href="#L-315"><span class="linenos"> 315</span></a>    <span class="k">def</span> <span class="nf">load_nfl_schedule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;NFLSchedule.csv&quot;</span><span class="p">):</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos"> 316</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos"> 317</span></a><span class="sd">        Loads and processes the NFL schedule for use in future simulations</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos"> 318</span></a>
</span><span id="L-319"><a href="#L-319"><span class="linenos"> 319</span></a><span class="sd">        Args:</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos"> 320</span></a><span class="sd">            path (str, optional): location of saved NFL schedule, defaults to &quot;NFLSchedule.csv&quot;.</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos"> 321</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos"> 322</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos"> 323</span></a>            <span class="n">nfl_schedule</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos"> 324</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos"> 325</span></a>            <span class="n">nfl_schedule</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;season&#39;</span><span class="p">,</span><span class="s1">&#39;week&#39;</span><span class="p">,</span><span class="s1">&#39;score1&#39;</span><span class="p">,</span><span class="s1">&#39;score2&#39;</span><span class="p">])</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos"> 326</span></a>        <span class="n">before</span> <span class="o">=</span> <span class="n">nfl_schedule</span><span class="o">.</span><span class="n">season</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="n">nfl_schedule</span><span class="o">.</span><span class="n">week</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">season</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">week</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos"> 327</span></a>        <span class="n">missing</span> <span class="o">=</span> <span class="n">before</span> <span class="o">&amp;</span> <span class="n">nfl_schedule</span><span class="o">.</span><span class="n">score1</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">nfl_schedule</span><span class="o">.</span><span class="n">score2</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos"> 328</span></a>        <span class="k">if</span> <span class="n">missing</span><span class="o">.</span><span class="n">any</span><span class="p">()</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">season</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">nfl_schedule</span><span class="o">.</span><span class="n">season</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos"> 329</span></a>            <span class="n">s</span> <span class="o">=</span> <span class="n">sr</span><span class="o">.</span><span class="n">Schedule</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">season</span> <span class="o">-</span> <span class="mi">8</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">season</span><span class="p">,</span><span class="kc">False</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos"> 330</span></a>            <span class="n">s</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos"> 331</span></a>            <span class="n">nfl_schedule</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos"> 332</span></a>        
</span><span id="L-333"><a href="#L-333"><span class="linenos"> 333</span></a>        <span class="n">nfl_schedule</span> <span class="o">=</span> <span class="n">nfl_schedule</span><span class="p">[[</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos"> 334</span></a>                <span class="s2">&quot;season&quot;</span><span class="p">,</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos"> 335</span></a>                <span class="s2">&quot;game_date&quot;</span><span class="p">,</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos"> 336</span></a>                <span class="s2">&quot;week&quot;</span><span class="p">,</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos"> 337</span></a>                <span class="s2">&quot;team1_abbrev&quot;</span><span class="p">,</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos"> 338</span></a>                <span class="s2">&quot;team2_abbrev&quot;</span><span class="p">,</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos"> 339</span></a>                <span class="s2">&quot;elo1_pre&quot;</span><span class="p">,</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos"> 340</span></a>                <span class="s2">&quot;elo2_pre&quot;</span><span class="p">,</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos"> 341</span></a>                <span class="s2">&quot;elo_diff&quot;</span><span class="p">,</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos"> 342</span></a>            <span class="p">]]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos"> 343</span></a>            <span class="n">columns</span><span class="o">=</span><span class="p">{</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos"> 344</span></a>                <span class="s2">&quot;game_date&quot;</span><span class="p">:</span> <span class="s2">&quot;date&quot;</span><span class="p">,</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos"> 345</span></a>                <span class="s2">&quot;team1_abbrev&quot;</span><span class="p">:</span> <span class="s2">&quot;home_team&quot;</span><span class="p">,</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos"> 346</span></a>                <span class="s2">&quot;team2_abbrev&quot;</span><span class="p">:</span> <span class="s2">&quot;away_team&quot;</span><span class="p">,</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos"> 347</span></a>                <span class="s2">&quot;elo1_pre&quot;</span><span class="p">:</span> <span class="s2">&quot;home_elo&quot;</span><span class="p">,</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos"> 348</span></a>                <span class="s2">&quot;elo2_pre&quot;</span><span class="p">:</span> <span class="s2">&quot;away_elo&quot;</span><span class="p">,</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos"> 349</span></a>                <span class="s2">&quot;elo_diff&quot;</span><span class="p">:</span> <span class="s2">&quot;home_elo_diff&quot;</span><span class="p">,</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos"> 350</span></a>            <span class="p">},</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos"> 351</span></a>        <span class="p">)</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos"> 352</span></a>        <span class="n">nfl_schedule</span><span class="p">[</span><span class="s2">&quot;away_elo_diff&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">nfl_schedule</span><span class="p">[</span><span class="s2">&quot;home_elo_diff&quot;</span><span class="p">]</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos"> 353</span></a>        <span class="n">home</span> <span class="o">=</span> <span class="n">nfl_schedule</span><span class="p">[[</span><span class="s2">&quot;season&quot;</span><span class="p">,</span> <span class="s2">&quot;week&quot;</span><span class="p">,</span> <span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="s2">&quot;home_team&quot;</span><span class="p">,</span> <span class="s2">&quot;home_elo_diff&quot;</span><span class="p">,</span> <span class="s2">&quot;away_elo&quot;</span><span class="p">]]</span>\
</span><span id="L-354"><a href="#L-354"><span class="linenos"> 354</span></a>        <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;home_team&quot;</span><span class="p">:</span> <span class="s2">&quot;team&quot;</span><span class="p">,</span> <span class="s2">&quot;home_elo_diff&quot;</span><span class="p">:</span> <span class="s2">&quot;elo_diff&quot;</span><span class="p">,</span> <span class="s2">&quot;away_elo&quot;</span><span class="p">:</span> <span class="s2">&quot;opp_elo&quot;</span><span class="p">})</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos"> 355</span></a>        <span class="n">home</span><span class="p">[</span><span class="s2">&quot;home_away&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Home&quot;</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos"> 356</span></a>        <span class="n">away</span> <span class="o">=</span> <span class="n">nfl_schedule</span><span class="p">[[</span><span class="s2">&quot;season&quot;</span><span class="p">,</span> <span class="s2">&quot;week&quot;</span><span class="p">,</span> <span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="s2">&quot;away_team&quot;</span><span class="p">,</span> <span class="s2">&quot;away_elo_diff&quot;</span><span class="p">,</span> <span class="s2">&quot;home_elo&quot;</span><span class="p">]]</span>\
</span><span id="L-357"><a href="#L-357"><span class="linenos"> 357</span></a>        <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;away_team&quot;</span><span class="p">:</span> <span class="s2">&quot;team&quot;</span><span class="p">,</span> <span class="s2">&quot;away_elo_diff&quot;</span><span class="p">:</span> <span class="s2">&quot;elo_diff&quot;</span><span class="p">,</span> <span class="s2">&quot;home_elo&quot;</span><span class="p">:</span> <span class="s2">&quot;opp_elo&quot;</span><span class="p">})</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos"> 358</span></a>        <span class="n">away</span><span class="p">[</span><span class="s2">&quot;home_away&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Away&quot;</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos"> 359</span></a>        <span class="n">nfl_schedule</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">home</span><span class="p">,</span> <span class="n">away</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos"> 360</span></a>        <span class="n">nfl_schedule</span><span class="o">.</span><span class="n">elo_diff</span> <span class="o">=</span> <span class="n">nfl_schedule</span><span class="o">.</span><span class="n">elo_diff</span> <span class="o">/</span> <span class="mi">1500</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos"> 361</span></a>        <span class="n">nfl_schedule</span><span class="o">.</span><span class="n">opp_elo</span> <span class="o">=</span> <span class="mi">1500</span> <span class="o">/</span> <span class="n">nfl_schedule</span><span class="o">.</span><span class="n">opp_elo</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos"> 362</span></a>        <span class="n">nfl_schedule</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">nfl_schedule</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;%m/</span><span class="si">%d</span><span class="s2">/%y&quot;</span><span class="p">)</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos"> 363</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">nfl_schedule</span> <span class="o">=</span> <span class="n">nfl_schedule</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">,</span> <span class="s2">&quot;week&quot;</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos"> 364</span></a>
</span><span id="L-365"><a href="#L-365"><span class="linenos"> 365</span></a>    <span class="k">def</span> <span class="nf">refresh_oauth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threshold</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">59</span><span class="p">):</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos"> 366</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos"> 367</span></a><span class="sd">        Checks the status of the current authentication token and refreshes it if expired (1hr).</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos"> 368</span></a>
</span><span id="L-369"><a href="#L-369"><span class="linenos"> 369</span></a><span class="sd">        Args:</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos"> 370</span></a><span class="sd">            threshold (int, optional): integer specifying the number of minutes an auth token </span>
</span><span id="L-371"><a href="#L-371"><span class="linenos"> 371</span></a><span class="sd">            can exist for before the code waits for it to expire and refreshes it, defaults to 59.</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos"> 372</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos"> 373</span></a>        <span class="n">diff</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos"> 374</span></a>            <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="p">(</span><span class="s2">&quot;GMT&quot;</span><span class="p">))</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos"> 375</span></a>            <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1970</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">timezone</span><span class="p">(</span><span class="s2">&quot;GMT&quot;</span><span class="p">))</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos"> 376</span></a>        <span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">oauth</span><span class="o">.</span><span class="n">token_time</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos"> 377</span></a>        <span class="k">if</span> <span class="n">diff</span> <span class="o">&gt;=</span> <span class="n">threshold</span> <span class="o">*</span> <span class="mi">60</span><span class="p">:</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos"> 378</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">3600</span> <span class="o">-</span> <span class="n">diff</span> <span class="o">+</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos"> 379</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">oauth</span> <span class="o">=</span> <span class="n">OAuth2</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">from_file</span><span class="o">=</span><span class="s2">&quot;oauth2.json&quot;</span><span class="p">)</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos"> 380</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">gm</span> <span class="o">=</span> <span class="n">yfa</span><span class="o">.</span><span class="n">Game</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">oauth</span><span class="p">,</span> <span class="s2">&quot;nfl&quot;</span><span class="p">)</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos"> 381</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">lg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gm</span><span class="o">.</span><span class="n">to_league</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lg_id</span><span class="p">)</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos"> 382</span></a>
</span><span id="L-383"><a href="#L-383"><span class="linenos"> 383</span></a>    <span class="k">def</span> <span class="nf">get_yahoo_players</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">injurytries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">):</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos"> 384</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos"> 385</span></a><span class="sd">        Pulls a dataframe containing details about all NFL players that are eligible </span>
</span><span id="L-386"><a href="#L-386"><span class="linenos"> 386</span></a><span class="sd">        to be rostered in the fantasy league in question. Injury statuses will occasionally </span>
</span><span id="L-387"><a href="#L-387"><span class="linenos"> 387</span></a><span class="sd">        be excluded by API; in that case, the function will repeat the pull until it sees </span>
</span><span id="L-388"><a href="#L-388"><span class="linenos"> 388</span></a><span class="sd">        the injury statuses or hits the upper limit provided in injurytries.</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos"> 389</span></a>
</span><span id="L-390"><a href="#L-390"><span class="linenos"> 390</span></a><span class="sd">        Args:</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos"> 391</span></a><span class="sd">            injurytries (int, optional): maximum number of times the code will try to pull the player list, defaults to 10.</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos"> 392</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos"> 393</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_oauth</span><span class="p">()</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos"> 394</span></a>        <span class="n">tries</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos"> 395</span></a>        <span class="k">while</span> <span class="n">tries</span> <span class="o">&lt;</span> <span class="n">injurytries</span><span class="p">:</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos"> 396</span></a>            <span class="n">tries</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos"> 397</span></a>            <span class="n">players</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos"> 398</span></a>            <span class="c1"># Rostered Players</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos"> 399</span></a>            <span class="k">for</span> <span class="n">page_ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos"> 400</span></a>                <span class="n">page</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lg</span><span class="o">.</span><span class="n">yhandler</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos"> 401</span></a>                    <span class="s2">&quot;league/</span><span class="si">{}</span><span class="s2">/players;start=</span><span class="si">{}</span><span class="s2">;count=25;status=T/&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos"> 402</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">lg_id</span><span class="p">,</span> <span class="n">page_ind</span> <span class="o">*</span> <span class="mi">25</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos"> 403</span></a>                    <span class="p">)</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos"> 404</span></a>                <span class="p">)[</span><span class="s2">&quot;fantasy_content&quot;</span><span class="p">][</span><span class="s2">&quot;league&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;players&quot;</span><span class="p">]</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos"> 405</span></a>                <span class="k">if</span> <span class="n">page</span> <span class="o">==</span> <span class="p">[]:</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos"> 406</span></a>                    <span class="k">break</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos"> 407</span></a>                <span class="k">for</span> <span class="n">player_ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">page</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]):</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos"> 408</span></a>                    <span class="n">player</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos"> 409</span></a>                        <span class="n">field</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos"> 410</span></a>                        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">page</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">player_ind</span><span class="p">)][</span><span class="s2">&quot;player&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos"> 411</span></a>                        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">field</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos"> 412</span></a>                    <span class="p">]</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos"> 413</span></a>                    <span class="n">vals</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos"> 414</span></a>                    <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">player</span><span class="p">:</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos"> 415</span></a>                        <span class="n">vals</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos"> 416</span></a>                    <span class="n">vals</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vals</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">][</span><span class="s2">&quot;full&quot;</span><span class="p">]</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos"> 417</span></a>                    <span class="n">vals</span><span class="p">[</span><span class="s2">&quot;eligible_positions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos"> 418</span></a>                        <span class="n">pos</span><span class="p">[</span><span class="s2">&quot;position&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">[</span><span class="s2">&quot;eligible_positions&quot;</span><span class="p">]</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos"> 419</span></a>                    <span class="p">]</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos"> 420</span></a>                    <span class="n">vals</span><span class="p">[</span><span class="s2">&quot;bye_weeks&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vals</span><span class="p">[</span><span class="s2">&quot;bye_weeks&quot;</span><span class="p">][</span><span class="s2">&quot;week&quot;</span><span class="p">]</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos"> 421</span></a>                    <span class="n">players</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos"> 422</span></a>            <span class="c1"># Available Players</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos"> 423</span></a>            <span class="k">for</span> <span class="n">page_ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos"> 424</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;Accounting for a weird player_id deletion in 2015...&quot;&quot;&quot;</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos"> 425</span></a>                <span class="n">page</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lg</span><span class="o">.</span><span class="n">yhandler</span><span class="o">.</span><span class="n">get_players_raw</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lg_id</span><span class="p">,</span> <span class="n">page_ind</span> <span class="o">*</span> <span class="mi">25</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">)</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos"> 426</span></a>                <span class="n">page</span> <span class="o">=</span> <span class="n">page</span><span class="p">[</span><span class="s2">&quot;fantasy_content&quot;</span><span class="p">][</span><span class="s2">&quot;league&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;players&quot;</span><span class="p">]</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos"> 427</span></a>                <span class="k">if</span> <span class="n">page</span> <span class="o">==</span> <span class="p">[]:</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos"> 428</span></a>                    <span class="k">break</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos"> 429</span></a>                <span class="k">for</span> <span class="n">player_ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">page</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]):</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos"> 430</span></a>                    <span class="n">player</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos"> 431</span></a>                        <span class="n">field</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos"> 432</span></a>                        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">page</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">player_ind</span><span class="p">)][</span><span class="s2">&quot;player&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos"> 433</span></a>                        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">field</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos"> 434</span></a>                    <span class="p">]</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos"> 435</span></a>                    <span class="n">vals</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos"> 436</span></a>                    <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">player</span><span class="p">:</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos"> 437</span></a>                        <span class="n">vals</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos"> 438</span></a>                    <span class="n">vals</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vals</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">][</span><span class="s2">&quot;full&quot;</span><span class="p">]</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos"> 439</span></a>                    <span class="n">vals</span><span class="p">[</span><span class="s2">&quot;eligible_positions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos"> 440</span></a>                        <span class="n">pos</span><span class="p">[</span><span class="s2">&quot;position&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">[</span><span class="s2">&quot;eligible_positions&quot;</span><span class="p">]</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos"> 441</span></a>                    <span class="p">]</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos"> 442</span></a>                    <span class="n">vals</span><span class="p">[</span><span class="s2">&quot;bye_weeks&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vals</span><span class="p">[</span><span class="s2">&quot;bye_weeks&quot;</span><span class="p">][</span><span class="s2">&quot;week&quot;</span><span class="p">]</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos"> 443</span></a>                    <span class="n">players</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos"> 444</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">players</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">players</span><span class="p">)</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos"> 445</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">player_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">player_id</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos"> 446</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos"> 447</span></a>                <span class="k">break</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos"> 448</span></a>
</span><span id="L-449"><a href="#L-449"><span class="linenos"> 449</span></a>    <span class="k">def</span> <span class="nf">get_fantasy_rosters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos"> 450</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos"> 451</span></a><span class="sd">        Pulls the current fantasy team of each eligible NFL player </span>
</span><span id="L-452"><a href="#L-452"><span class="linenos"> 452</span></a><span class="sd">        and merges it into the players dataframe.</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos"> 453</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos"> 454</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_oauth</span><span class="p">()</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos"> 455</span></a>        <span class="n">selected</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos"> 456</span></a>            <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;player_id&quot;</span><span class="p">,</span> <span class="s2">&quot;selected_position&quot;</span><span class="p">,</span> <span class="s2">&quot;fantasy_team&quot;</span><span class="p">]</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos"> 457</span></a>        <span class="p">)</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos"> 458</span></a>        <span class="k">for</span> <span class="n">team</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">teams</span><span class="p">:</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos"> 459</span></a>            <span class="n">tm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lg</span><span class="o">.</span><span class="n">to_team</span><span class="p">(</span><span class="n">team</span><span class="p">[</span><span class="s2">&quot;team_key&quot;</span><span class="p">])</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos"> 460</span></a>            <span class="n">players</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">tm</span><span class="o">.</span><span class="n">roster</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">week</span><span class="p">))</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos"> 461</span></a>            <span class="k">if</span> <span class="n">players</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos"> 462</span></a>                <span class="k">continue</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos"> 463</span></a>            <span class="k">if</span> <span class="p">(</span><span class="o">~</span><span class="n">players</span><span class="o">.</span><span class="n">player_id</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">player_id</span><span class="p">))</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos"> 464</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos"> 465</span></a>                    <span class="s2">&quot;Some players are missing... &quot;</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos"> 466</span></a>                    <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos"> 467</span></a>                        <span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">players</span><span class="o">.</span><span class="n">player_id</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">rosters</span><span class="o">.</span><span class="n">player_id</span><span class="p">),</span> <span class="s2">&quot;name&quot;</span><span class="p">]</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos"> 468</span></a>                    <span class="p">)</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos"> 469</span></a>                <span class="p">)</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos"> 470</span></a>            <span class="n">players</span><span class="p">[</span><span class="s2">&quot;fantasy_team&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">team</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos"> 471</span></a>            <span class="n">selected</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">selected</span><span class="p">,</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos"> 472</span></a>                <span class="n">players</span><span class="p">[[</span><span class="s2">&quot;player_id&quot;</span><span class="p">,</span> <span class="s2">&quot;selected_position&quot;</span><span class="p">,</span> <span class="s2">&quot;fantasy_team&quot;</span><span class="p">]]],</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos"> 473</span></a>                <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos"> 474</span></a>                <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos"> 475</span></a>            <span class="p">)</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos"> 476</span></a>        <span class="n">rosters</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos"> 477</span></a>            <span class="n">left</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">selected</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;player_id&quot;</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos"> 478</span></a>        <span class="p">)</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos"> 479</span></a>        <span class="k">if</span> <span class="s2">&quot;fantasy_team&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">rosters</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos"> 480</span></a>            <span class="n">rosters</span><span class="p">[</span><span class="s2">&quot;fantasy_team&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos"> 481</span></a>        <span class="n">rosters</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">rosters</span><span class="o">.</span><span class="n">player_id</span> <span class="o">==</span> <span class="mi">100014</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="s2">&quot; Rams&quot;</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos"> 482</span></a>        <span class="n">rosters</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">rosters</span><span class="o">.</span><span class="n">player_id</span> <span class="o">==</span> <span class="mi">100024</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="s2">&quot; Chargers&quot;</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos"> 483</span></a>        <span class="n">rosters</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">rosters</span><span class="o">.</span><span class="n">player_id</span> <span class="o">==</span> <span class="mi">100020</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="s2">&quot; Jets&quot;</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos"> 484</span></a>        <span class="n">rosters</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">rosters</span><span class="o">.</span><span class="n">player_id</span> <span class="o">==</span> <span class="mi">100019</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="s2">&quot; Giants&quot;</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos"> 485</span></a>        <span class="n">rosters</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos"> 486</span></a>            <span class="n">left</span><span class="o">=</span><span class="n">rosters</span><span class="p">,</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos"> 487</span></a>            <span class="n">right</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nfl_teams</span><span class="p">[[</span><span class="s2">&quot;real_abbrev&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">]],</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos"> 488</span></a>            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos"> 489</span></a>            <span class="n">on</span><span class="o">=</span><span class="s2">&quot;name&quot;</span><span class="p">,</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos"> 490</span></a>        <span class="p">)</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos"> 491</span></a>        <span class="n">rosters</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">rosters</span><span class="o">.</span><span class="n">real_abbrev</span><span class="o">.</span><span class="n">isnull</span><span class="p">(),</span> <span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rosters</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos"> 492</span></a>            <span class="o">~</span><span class="n">rosters</span><span class="o">.</span><span class="n">real_abbrev</span><span class="o">.</span><span class="n">isnull</span><span class="p">(),</span> <span class="s2">&quot;real_abbrev&quot;</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos"> 493</span></a>        <span class="p">]</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos"> 494</span></a>        <span class="n">rosters</span><span class="p">[</span><span class="s2">&quot;position&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rosters</span><span class="o">.</span><span class="n">display_position</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos"> 495</span></a>            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span><span class="n">pos</span> <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">pos</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;QB&#39;</span><span class="p">,</span><span class="s1">&#39;WR&#39;</span><span class="p">,</span><span class="s1">&#39;TE&#39;</span><span class="p">,</span><span class="s1">&#39;K&#39;</span><span class="p">,</span><span class="s1">&#39;RB&#39;</span><span class="p">,</span><span class="s1">&#39;DEF&#39;</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos"> 496</span></a>        <span class="p">)</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos"> 497</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span> <span class="o">=</span> <span class="n">rosters</span><span class="p">[</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos"> 498</span></a>            <span class="p">[</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos"> 499</span></a>                <span class="s2">&quot;name&quot;</span><span class="p">,</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos"> 500</span></a>                <span class="s2">&quot;eligible_positions&quot;</span><span class="p">,</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos"> 501</span></a>                <span class="s2">&quot;selected_position&quot;</span><span class="p">,</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos"> 502</span></a>                <span class="s2">&quot;status&quot;</span><span class="p">,</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos"> 503</span></a>                <span class="s2">&quot;player_id&quot;</span><span class="p">,</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos"> 504</span></a>                <span class="s2">&quot;editorial_team_abbr&quot;</span><span class="p">,</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos"> 505</span></a>                <span class="s2">&quot;fantasy_team&quot;</span><span class="p">,</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos"> 506</span></a>                <span class="s2">&quot;position&quot;</span><span class="p">,</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos"> 507</span></a>            <span class="p">]</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos"> 508</span></a>        <span class="p">]</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos"> 509</span></a>
</span><span id="L-510"><a href="#L-510"><span class="linenos"> 510</span></a>    <span class="k">def</span> <span class="nf">pull_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">finish</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;GameByGameFantasyFootballStats.csv&quot;</span><span class="p">):</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos"> 511</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos"> 512</span></a><span class="sd">        Pulls a dataframe containing event rates based on per-game statistics during the specified timeframe.</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos"> 513</span></a>
</span><span id="L-514"><a href="#L-514"><span class="linenos"> 514</span></a><span class="sd">        Args:</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos"> 515</span></a><span class="sd">            start (int): year and number of the first week of interest (YYYYWW, e.g. 202102 = week 2 of 2021).  </span>
</span><span id="L-516"><a href="#L-516"><span class="linenos"> 516</span></a><span class="sd">            finish (int): year and number of the last week of interest (YYYYWW, e.g. 202307 = week 7 of 2023).  </span>
</span><span id="L-517"><a href="#L-517"><span class="linenos"> 517</span></a><span class="sd">            path (str, optional): location of saved per-game statistics, defaults to &quot;GameByGameFantasyFootballStats.csv&quot;.</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos"> 518</span></a>
</span><span id="L-519"><a href="#L-519"><span class="linenos"> 519</span></a><span class="sd">        Returns:</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos"> 520</span></a><span class="sd">            pd.DataFrame: dataframe containing player rates based on games during the timespan of interest.</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos"> 521</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos"> 522</span></a>        <span class="n">stats</span> <span class="o">=</span> <span class="n">sr</span><span class="o">.</span><span class="n">get_bulk_stats</span><span class="p">(</span><span class="n">start</span><span class="o">//</span><span class="mi">100</span><span class="p">,</span><span class="n">start</span><span class="o">%</span><span class="mi">100</span><span class="p">,</span><span class="n">finish</span><span class="o">//</span><span class="mi">100</span><span class="p">,</span><span class="n">finish</span><span class="o">%</span><span class="mi">100</span><span class="p">,</span><span class="kc">False</span><span class="p">,</span><span class="n">path</span><span class="p">)</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos"> 523</span></a>        <span class="n">s</span> <span class="o">=</span> <span class="n">sr</span><span class="o">.</span><span class="n">Schedule</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">season</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="n">stats</span><span class="o">.</span><span class="n">season</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos"> 524</span></a>        <span class="n">pts_allowed</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">s</span><span class="o">.</span><span class="n">schedule</span><span class="p">[[</span><span class="s1">&#39;boxscore_abbrev&#39;</span><span class="p">,</span><span class="s1">&#39;team1_abbrev&#39;</span><span class="p">,</span><span class="s1">&#39;score2&#39;</span><span class="p">]]</span>\
</span><span id="L-525"><a href="#L-525"><span class="linenos"> 525</span></a>        <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;boxscore_abbrev&#39;</span><span class="p">:</span><span class="s1">&#39;game_id&#39;</span><span class="p">,</span><span class="s1">&#39;team1_abbrev&#39;</span><span class="p">:</span><span class="s1">&#39;team&#39;</span><span class="p">,</span><span class="s1">&#39;score2&#39;</span><span class="p">:</span><span class="s1">&#39;points_allowed&#39;</span><span class="p">}),</span>\
</span><span id="L-526"><a href="#L-526"><span class="linenos"> 526</span></a>        <span class="n">s</span><span class="o">.</span><span class="n">schedule</span><span class="p">[[</span><span class="s1">&#39;boxscore_abbrev&#39;</span><span class="p">,</span><span class="s1">&#39;team2_abbrev&#39;</span><span class="p">,</span><span class="s1">&#39;score1&#39;</span><span class="p">]]</span>\
</span><span id="L-527"><a href="#L-527"><span class="linenos"> 527</span></a>        <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;boxscore_abbrev&#39;</span><span class="p">:</span><span class="s1">&#39;game_id&#39;</span><span class="p">,</span><span class="s1">&#39;team2_abbrev&#39;</span><span class="p">:</span><span class="s1">&#39;team&#39;</span><span class="p">,</span><span class="s1">&#39;score1&#39;</span><span class="p">:</span><span class="s1">&#39;points_allowed&#39;</span><span class="p">})],</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos"> 528</span></a>        <span class="n">stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">stats</span><span class="p">,</span><span class="n">right</span><span class="o">=</span><span class="n">pts_allowed</span><span class="p">,</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;game_id&#39;</span><span class="p">,</span><span class="s1">&#39;team&#39;</span><span class="p">])</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos"> 529</span></a>        <span class="n">pos_corrections</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos"> 530</span></a>            <span class="s2">&quot;https://raw.githubusercontent.com/&quot;</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos"> 531</span></a>            <span class="o">+</span> <span class="s2">&quot;tefirman/FantasySports/main/res/football/pos_corrections.csv&quot;</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos"> 532</span></a>        <span class="p">)</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos"> 533</span></a>        <span class="n">stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">stats</span><span class="p">,</span><span class="n">right</span><span class="o">=</span><span class="n">pos_corrections</span><span class="p">[[</span><span class="s1">&#39;player_id&#39;</span><span class="p">,</span><span class="s1">&#39;actual_pos&#39;</span><span class="p">]],</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;player_id&#39;</span><span class="p">])</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos"> 534</span></a>        <span class="n">stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">stats</span><span class="o">.</span><span class="n">actual_pos</span><span class="o">.</span><span class="n">isnull</span><span class="p">(),</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">stats</span><span class="o">.</span><span class="n">actual_pos</span><span class="o">.</span><span class="n">isnull</span><span class="p">(),</span><span class="s1">&#39;actual_pos&#39;</span><span class="p">]</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos"> 535</span></a>        <span class="k">del</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;actual_pos&#39;</span><span class="p">]</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos"> 536</span></a>        <span class="n">to_fix</span> <span class="o">=</span> <span class="o">~</span><span class="n">stats</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;QB&quot;</span><span class="p">,</span> <span class="s2">&quot;RB&quot;</span><span class="p">,</span> <span class="s2">&quot;WR&quot;</span><span class="p">,</span> <span class="s2">&quot;TE&quot;</span><span class="p">,</span> <span class="s2">&quot;K&quot;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos"> 537</span></a>            <span class="n">stats</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;QB&quot;</span><span class="p">)</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos"> 538</span></a>            <span class="o">|</span> <span class="n">stats</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;WR&quot;</span><span class="p">)</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos"> 539</span></a>            <span class="o">|</span> <span class="n">stats</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;RB&quot;</span><span class="p">)</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos"> 540</span></a>            <span class="o">|</span> <span class="n">stats</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;TE&quot;</span><span class="p">)</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos"> 541</span></a>            <span class="o">|</span> <span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;K&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">stats</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;MIKE&quot;</span><span class="p">,</span><span class="s2">&quot;JACK&quot;</span><span class="p">]))</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos"> 542</span></a>        <span class="p">)</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos"> 543</span></a>        <span class="k">if</span> <span class="n">to_fix</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos"> 544</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Weird positions in game-by-game stats...&#39;</span><span class="p">)</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos"> 545</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">to_fix</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;player_id&quot;</span><span class="p">,</span> <span class="s2">&quot;player&quot;</span><span class="p">,</span> <span class="s2">&quot;pos&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos"> 546</span></a>        <span class="n">defenses</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos"> 547</span></a>            <span class="n">stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">stats</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;QB&quot;</span><span class="p">,</span> <span class="s2">&quot;RB&quot;</span><span class="p">,</span> <span class="s2">&quot;WR&quot;</span><span class="p">,</span> <span class="s2">&quot;TE&quot;</span><span class="p">,</span> <span class="s2">&quot;K&quot;</span><span class="p">])]</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos"> 548</span></a>            <span class="o">.</span><span class="n">groupby</span><span class="p">(</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos"> 549</span></a>                <span class="p">[</span><span class="s2">&quot;game_id&quot;</span><span class="p">,</span> <span class="s2">&quot;season&quot;</span><span class="p">,</span> <span class="s2">&quot;week&quot;</span><span class="p">,</span> <span class="s2">&quot;team&quot;</span><span class="p">,</span> <span class="s2">&quot;opponent&quot;</span><span class="p">,</span> <span class="s2">&quot;points_allowed&quot;</span><span class="p">]</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos"> 550</span></a>            <span class="p">)</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos"> 551</span></a>            <span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">numeric_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos"> 552</span></a>            <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos"> 553</span></a>        <span class="p">)</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos"> 554</span></a>        <span class="n">defenses</span><span class="p">[</span><span class="s2">&quot;player&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">defenses</span><span class="p">[</span><span class="s2">&quot;team&quot;</span><span class="p">]</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos"> 555</span></a>        <span class="n">defenses</span><span class="p">[</span><span class="s2">&quot;player_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">defenses</span><span class="p">[</span><span class="s2">&quot;player&quot;</span><span class="p">]</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos"> 556</span></a>        <span class="n">defenses</span><span class="p">[</span><span class="s2">&quot;pos&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;DEF&quot;</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos"> 557</span></a>        <span class="k">if</span> <span class="s2">&quot;string&quot;</span> <span class="ow">in</span> <span class="n">defenses</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos"> 558</span></a>            <span class="n">defenses</span><span class="p">[</span><span class="s2">&quot;string&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos"> 559</span></a>        <span class="n">defenses</span> <span class="o">=</span> <span class="n">defenses</span><span class="p">[[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">stats</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">defenses</span><span class="o">.</span><span class="n">columns</span><span class="p">]]</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos"> 560</span></a>        <span class="n">stats</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">stats</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;QB&quot;</span><span class="p">,</span> <span class="s2">&quot;RB&quot;</span><span class="p">,</span> <span class="s2">&quot;WR&quot;</span><span class="p">,</span> <span class="s2">&quot;TE&quot;</span><span class="p">,</span> <span class="s2">&quot;K&quot;</span><span class="p">])]</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos"> 561</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">stats</span><span class="p">,</span><span class="n">defenses</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>\
</span><span id="L-562"><a href="#L-562"><span class="linenos"> 562</span></a>        <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;pos&#39;</span><span class="p">:</span><span class="s1">&#39;position&#39;</span><span class="p">,</span><span class="s1">&#39;player&#39;</span><span class="p">:</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;player_id&#39;</span><span class="p">:</span><span class="s1">&#39;player_id_sr&#39;</span><span class="p">})</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos"> 563</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;weeks_ago&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">game_id</span><span class="o">.</span><span class="n">str</span><span class="p">[:</span><span class="mi">8</span><span class="p">]))</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">days</span> <span class="o">/</span> <span class="mf">7.0</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos"> 564</span></a>
</span><span id="L-565"><a href="#L-565"><span class="linenos"> 565</span></a>    <span class="k">def</span> <span class="nf">add_points</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos"> 566</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos"> 567</span></a><span class="sd">        Calculates per-game fantasy points based on per-game statistics and provided scoring settings.</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos"> 568</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos"> 569</span></a>        <span class="n">offense</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">position</span> <span class="o">!=</span> <span class="s2">&quot;DEF&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos"> 570</span></a>        <span class="n">offense</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos"> 571</span></a>            <span class="n">offense</span><span class="p">[</span><span class="s2">&quot;rush_yds&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Rush Yds&quot;</span><span class="p">]</span>
</span><span id="L-572"><a href="#L-572"><span class="linenos"> 572</span></a>            <span class="o">+</span> <span class="n">offense</span><span class="p">[</span><span class="s2">&quot;rush_att&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Rush Att&quot;</span><span class="p">]</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos"> 573</span></a>            <span class="o">+</span> <span class="n">offense</span><span class="p">[</span><span class="s2">&quot;rush_td&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Rush TD&quot;</span><span class="p">]</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos"> 574</span></a>            <span class="o">+</span> <span class="n">offense</span><span class="p">[</span><span class="s2">&quot;rush_first_down&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Rush 1D&quot;</span><span class="p">]</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos"> 575</span></a>            <span class="o">+</span> <span class="n">offense</span><span class="p">[</span><span class="s2">&quot;rec&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Rec&quot;</span><span class="p">]</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos"> 576</span></a>            <span class="o">+</span> <span class="n">offense</span><span class="p">[</span><span class="s2">&quot;rec_yds&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Rec Yds&quot;</span><span class="p">]</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos"> 577</span></a>            <span class="o">+</span> <span class="n">offense</span><span class="p">[</span><span class="s2">&quot;rec_td&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Rec TD&quot;</span><span class="p">]</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos"> 578</span></a>            <span class="o">+</span> <span class="n">offense</span><span class="p">[</span><span class="s2">&quot;rec_first_down&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Rec 1D&quot;</span><span class="p">]</span>
</span><span id="L-579"><a href="#L-579"><span class="linenos"> 579</span></a>            <span class="o">+</span> <span class="n">offense</span><span class="p">[</span><span class="s2">&quot;pass_yds&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Pass Yds&quot;</span><span class="p">]</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos"> 580</span></a>            <span class="o">+</span> <span class="n">offense</span><span class="p">[</span><span class="s2">&quot;pass_cmp&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Pass Comp&quot;</span><span class="p">]</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos"> 581</span></a>            <span class="o">+</span> <span class="n">offense</span><span class="p">[</span><span class="s2">&quot;pass_td&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Pass TD&quot;</span><span class="p">]</span>
</span><span id="L-582"><a href="#L-582"><span class="linenos"> 582</span></a>            <span class="o">+</span> <span class="n">offense</span><span class="p">[</span><span class="s2">&quot;pass_first_down&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Pass 1D&quot;</span><span class="p">]</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos"> 583</span></a>            <span class="o">+</span> <span class="n">offense</span><span class="p">[</span><span class="s2">&quot;pass_int&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Int Thrown&quot;</span><span class="p">]</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos"> 584</span></a>            <span class="o">+</span> <span class="n">offense</span><span class="p">[</span><span class="s2">&quot;fumbles_lost&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Fum Lost&quot;</span><span class="p">]</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos"> 585</span></a>            <span class="o">+</span> <span class="p">(</span><span class="n">offense</span><span class="p">[</span><span class="s2">&quot;kick_ret_yds&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">offense</span><span class="p">[</span><span class="s2">&quot;punt_ret_yds&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Ret Yds&quot;</span><span class="p">]</span>
</span><span id="L-586"><a href="#L-586"><span class="linenos"> 586</span></a>            <span class="o">+</span> <span class="p">(</span><span class="n">offense</span><span class="p">[</span><span class="s2">&quot;kick_ret_td&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">offense</span><span class="p">[</span><span class="s2">&quot;punt_ret_td&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Ret TD&quot;</span><span class="p">]</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos"> 587</span></a>            <span class="o">+</span> <span class="n">offense</span><span class="p">[</span><span class="s2">&quot;xpm&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;PAT Made&quot;</span><span class="p">]</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos"> 588</span></a>            <span class="o">+</span> <span class="n">offense</span><span class="p">[</span><span class="s2">&quot;fgm&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;FG 0-19&quot;</span><span class="p">]</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos"> 589</span></a>        <span class="p">)</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos"> 590</span></a>        <span class="n">tes</span> <span class="o">=</span> <span class="n">offense</span><span class="o">.</span><span class="n">position</span> <span class="o">==</span> <span class="s1">&#39;TE&#39;</span>
</span><span id="L-591"><a href="#L-591"><span class="linenos"> 591</span></a>        <span class="n">offense</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">tes</span><span class="p">,</span><span class="s1">&#39;points&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">offense</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">tes</span><span class="p">,</span><span class="s1">&#39;rec&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s1">&#39;TE Rec Bonus&#39;</span><span class="p">]</span> <span class="o">+</span> \
</span><span id="L-592"><a href="#L-592"><span class="linenos"> 592</span></a>        <span class="p">(</span><span class="n">offense</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">tes</span><span class="p">,</span><span class="s1">&#39;rush_first_down&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">offense</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">tes</span><span class="p">,</span><span class="s1">&#39;rec_first_down&#39;</span><span class="p">]</span> <span class="o">+</span> \
</span><span id="L-593"><a href="#L-593"><span class="linenos"> 593</span></a>        <span class="n">offense</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">tes</span><span class="p">,</span><span class="s1">&#39;pass_first_down&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s1">&#39;TE 1D Bonus&#39;</span><span class="p">]</span>
</span><span id="L-594"><a href="#L-594"><span class="linenos"> 594</span></a>        <span class="n">offense</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">offense</span><span class="o">.</span><span class="n">pass_yds</span> <span class="o">&gt;=</span> <span class="mi">300</span><span class="p">,</span><span class="s1">&#39;points&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s1">&#39;Pass 300+&#39;</span><span class="p">]</span>
</span><span id="L-595"><a href="#L-595"><span class="linenos"> 595</span></a>        <span class="n">offense</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">offense</span><span class="o">.</span><span class="n">rush_yds</span> <span class="o">&gt;=</span> <span class="mi">100</span><span class="p">,</span><span class="s1">&#39;points&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s1">&#39;Rush 100+&#39;</span><span class="p">]</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos"> 596</span></a>        <span class="n">offense</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">offense</span><span class="o">.</span><span class="n">rec_yds</span> <span class="o">&gt;=</span> <span class="mi">100</span><span class="p">,</span><span class="s1">&#39;points&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s1">&#39;Rec 100+&#39;</span><span class="p">]</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos"> 597</span></a>        <span class="n">defense</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">position</span> <span class="o">==</span> <span class="s2">&quot;DEF&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-598"><a href="#L-598"><span class="linenos"> 598</span></a>        <span class="n">defense</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-599"><a href="#L-599"><span class="linenos"> 599</span></a>            <span class="n">defense</span><span class="p">[</span><span class="s2">&quot;sacks&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Sack&quot;</span><span class="p">]</span>
</span><span id="L-600"><a href="#L-600"><span class="linenos"> 600</span></a>            <span class="o">+</span> <span class="n">defense</span><span class="p">[</span><span class="s2">&quot;def_int&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Int&quot;</span><span class="p">]</span>
</span><span id="L-601"><a href="#L-601"><span class="linenos"> 601</span></a>            <span class="o">+</span> <span class="n">defense</span><span class="p">[</span><span class="s2">&quot;fumbles_rec&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Fum Rec&quot;</span><span class="p">]</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos"> 602</span></a>            <span class="o">+</span> <span class="p">(</span><span class="n">defense</span><span class="p">[</span><span class="s2">&quot;def_int_td&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">defense</span><span class="p">[</span><span class="s1">&#39;fumbles_rec_td&#39;</span><span class="p">]</span> 
</span><span id="L-603"><a href="#L-603"><span class="linenos"> 603</span></a>            <span class="o">+</span> <span class="n">defense</span><span class="p">[</span><span class="s2">&quot;kick_ret_td&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">defense</span><span class="p">[</span><span class="s2">&quot;punt_ret_td&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Ret TD&quot;</span><span class="p">]</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos"> 604</span></a>        <span class="p">)</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos"> 605</span></a>        <span class="n">defense</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">defense</span><span class="o">.</span><span class="n">points_allowed</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;points&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Pts Allow 0&quot;</span><span class="p">]</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos"> 606</span></a>        <span class="n">defense</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos"> 607</span></a>            <span class="p">(</span><span class="n">defense</span><span class="o">.</span><span class="n">points_allowed</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">defense</span><span class="o">.</span><span class="n">points_allowed</span> <span class="o">&lt;=</span> <span class="mi">6</span><span class="p">),</span> <span class="s2">&quot;points&quot;</span>
</span><span id="L-608"><a href="#L-608"><span class="linenos"> 608</span></a>        <span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Pts Allow 1-6&quot;</span><span class="p">]</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos"> 609</span></a>        <span class="n">defense</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos"> 610</span></a>            <span class="p">(</span><span class="n">defense</span><span class="o">.</span><span class="n">points_allowed</span> <span class="o">&gt;=</span> <span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">defense</span><span class="o">.</span><span class="n">points_allowed</span> <span class="o">&lt;=</span> <span class="mi">13</span><span class="p">),</span> <span class="s2">&quot;points&quot;</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos"> 611</span></a>        <span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Pts Allow 7-13&quot;</span><span class="p">]</span>
</span><span id="L-612"><a href="#L-612"><span class="linenos"> 612</span></a>        <span class="n">defense</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos"> 613</span></a>            <span class="p">(</span><span class="n">defense</span><span class="o">.</span><span class="n">points_allowed</span> <span class="o">&gt;=</span> <span class="mi">14</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">defense</span><span class="o">.</span><span class="n">points_allowed</span> <span class="o">&lt;=</span> <span class="mi">20</span><span class="p">),</span> <span class="s2">&quot;points&quot;</span>
</span><span id="L-614"><a href="#L-614"><span class="linenos"> 614</span></a>        <span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Pts Allow 14-20&quot;</span><span class="p">]</span>
</span><span id="L-615"><a href="#L-615"><span class="linenos"> 615</span></a>        <span class="n">defense</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-616"><a href="#L-616"><span class="linenos"> 616</span></a>            <span class="p">(</span><span class="n">defense</span><span class="o">.</span><span class="n">points_allowed</span> <span class="o">&gt;=</span> <span class="mi">21</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">defense</span><span class="o">.</span><span class="n">points_allowed</span> <span class="o">&lt;=</span> <span class="mi">27</span><span class="p">),</span> <span class="s2">&quot;points&quot;</span>
</span><span id="L-617"><a href="#L-617"><span class="linenos"> 617</span></a>        <span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Pts Allow 21-27&quot;</span><span class="p">]</span>
</span><span id="L-618"><a href="#L-618"><span class="linenos"> 618</span></a>        <span class="n">defense</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-619"><a href="#L-619"><span class="linenos"> 619</span></a>            <span class="p">(</span><span class="n">defense</span><span class="o">.</span><span class="n">points_allowed</span> <span class="o">&gt;=</span> <span class="mi">28</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">defense</span><span class="o">.</span><span class="n">points_allowed</span> <span class="o">&lt;=</span> <span class="mi">34</span><span class="p">),</span> <span class="s2">&quot;points&quot;</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos"> 620</span></a>        <span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Pts Allow 28-34&quot;</span><span class="p">]</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos"> 621</span></a>        <span class="n">defense</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">defense</span><span class="o">.</span><span class="n">points_allowed</span> <span class="o">&gt;=</span> <span class="mi">35</span><span class="p">),</span> <span class="s2">&quot;points&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Pts Allow 35+&quot;</span><span class="p">]</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos"> 622</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">offense</span><span class="p">,</span><span class="n">defense</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-623"><a href="#L-623"><span class="linenos"> 623</span></a>    
</span><span id="L-624"><a href="#L-624"><span class="linenos"> 624</span></a>    <span class="k">def</span> <span class="nf">load_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">finish</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos"> 625</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos"> 626</span></a><span class="sd">        Loads individual player statistics for each game in the specified timeframe </span>
</span><span id="L-627"><a href="#L-627"><span class="linenos"> 627</span></a><span class="sd">        and calculates fantasy points based on league settings. Initially looks for </span>
</span><span id="L-628"><a href="#L-628"><span class="linenos"> 628</span></a><span class="sd">        pre-pulled statistics saved locally and pulls new stats when necessary.</span>
</span><span id="L-629"><a href="#L-629"><span class="linenos"> 629</span></a>
</span><span id="L-630"><a href="#L-630"><span class="linenos"> 630</span></a><span class="sd">        Args:</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos"> 631</span></a><span class="sd">            start (int): year and number of the first week of interest (YYYYWW, e.g. 202102 = week 2 of 2021).  </span>
</span><span id="L-632"><a href="#L-632"><span class="linenos"> 632</span></a><span class="sd">            finish (int): year and number of the last week of interest (YYYYWW, e.g. 202307 = week 7 of 2023).</span>
</span><span id="L-633"><a href="#L-633"><span class="linenos"> 633</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-634"><a href="#L-634"><span class="linenos"> 634</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pull_stats</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">finish</span><span class="p">)</span>
</span><span id="L-635"><a href="#L-635"><span class="linenos"> 635</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_points</span><span class="p">()</span>
</span><span id="L-636"><a href="#L-636"><span class="linenos"> 636</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos"> 637</span></a>            <span class="n">left</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">,</span>
</span><span id="L-638"><a href="#L-638"><span class="linenos"> 638</span></a>            <span class="n">right</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nfl_schedule</span><span class="p">,</span>
</span><span id="L-639"><a href="#L-639"><span class="linenos"> 639</span></a>            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
</span><span id="L-640"><a href="#L-640"><span class="linenos"> 640</span></a>            <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">,</span> <span class="s2">&quot;week&quot;</span><span class="p">,</span> <span class="s2">&quot;team&quot;</span><span class="p">],</span>
</span><span id="L-641"><a href="#L-641"><span class="linenos"> 641</span></a>        <span class="p">)</span>
</span><span id="L-642"><a href="#L-642"><span class="linenos"> 642</span></a>
</span><span id="L-643"><a href="#L-643"><span class="linenos"> 643</span></a>    <span class="k">def</span> <span class="nf">name_corrections</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-644"><a href="#L-644"><span class="linenos"> 644</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-645"><a href="#L-645"><span class="linenos"> 645</span></a><span class="sd">        Applies name corrections between Pro Football Reference and Yahoo.</span>
</span><span id="L-646"><a href="#L-646"><span class="linenos"> 646</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-647"><a href="#L-647"><span class="linenos"> 647</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">load_stats</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">season</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">season</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">week</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos"> 648</span></a>        <span class="n">corrections</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
</span><span id="L-649"><a href="#L-649"><span class="linenos"> 649</span></a>            <span class="s2">&quot;https://raw.githubusercontent.com/&quot;</span>
</span><span id="L-650"><a href="#L-650"><span class="linenos"> 650</span></a>            <span class="o">+</span> <span class="s2">&quot;tefirman/FantasySports/main/res/football/name_corrections.csv&quot;</span>
</span><span id="L-651"><a href="#L-651"><span class="linenos"> 651</span></a>        <span class="p">)</span>
</span><span id="L-652"><a href="#L-652"><span class="linenos"> 652</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="L-653"><a href="#L-653"><span class="linenos"> 653</span></a>            <span class="n">left</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">corrections</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;name&quot;</span>
</span><span id="L-654"><a href="#L-654"><span class="linenos"> 654</span></a>        <span class="p">)</span>
</span><span id="L-655"><a href="#L-655"><span class="linenos"> 655</span></a>        <span class="n">to_fix</span> <span class="o">=</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">new_name</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span>
</span><span id="L-656"><a href="#L-656"><span class="linenos"> 656</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">to_fix</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">to_fix</span><span class="p">,</span> <span class="s2">&quot;new_name&quot;</span><span class="p">]</span>
</span><span id="L-657"><a href="#L-657"><span class="linenos"> 657</span></a>
</span><span id="L-658"><a href="#L-658"><span class="linenos"> 658</span></a>    <span class="k">def</span> <span class="nf">get_player_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-659"><a href="#L-659"><span class="linenos"> 659</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-660"><a href="#L-660"><span class="linenos"> 660</span></a><span class="sd">        Maps between Yahoo player ID&#39;s and SportsRef player ID&#39;s based on team rosters and draft results.</span>
</span><span id="L-661"><a href="#L-661"><span class="linenos"> 661</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-662"><a href="#L-662"><span class="linenos"> 662</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">nfl_rosters</span> <span class="o">=</span> <span class="n">sr</span><span class="o">.</span><span class="n">get_bulk_rosters</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">season</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">latest_season</span><span class="p">,</span><span class="s2">&quot;NFLRosters.csv&quot;</span><span class="p">)</span>
</span><span id="L-663"><a href="#L-663"><span class="linenos"> 663</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">nfl_rosters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nfl_rosters</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;player&#39;</span><span class="p">:</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;player_id&#39;</span><span class="p">:</span><span class="s1">&#39;player_id_sr&#39;</span><span class="p">,</span><span class="s1">&#39;team&#39;</span><span class="p">:</span><span class="s1">&#39;current_team&#39;</span><span class="p">})</span>
</span><span id="L-664"><a href="#L-664"><span class="linenos"> 664</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="L-665"><a href="#L-665"><span class="linenos"> 665</span></a>            <span class="n">left</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">,</span><span class="n">right</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nfl_teams</span><span class="p">[[</span><span class="s2">&quot;real_abbrev&quot;</span><span class="p">,</span> <span class="s2">&quot;yahoo&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
</span><span id="L-666"><a href="#L-666"><span class="linenos"> 666</span></a>                <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;yahoo&quot;</span><span class="p">:</span> <span class="s2">&quot;editorial_team_abbr&quot;</span><span class="p">,</span> <span class="s2">&quot;real_abbrev&quot;</span><span class="p">:</span> <span class="s2">&quot;current_team&quot;</span><span class="p">}</span>
</span><span id="L-667"><a href="#L-667"><span class="linenos"> 667</span></a>            <span class="p">),</span>
</span><span id="L-668"><a href="#L-668"><span class="linenos"> 668</span></a>            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">,</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos"> 669</span></a>            <span class="n">on</span><span class="o">=</span><span class="s2">&quot;editorial_team_abbr&quot;</span><span class="p">,</span>
</span><span id="L-670"><a href="#L-670"><span class="linenos"> 670</span></a>        <span class="p">)</span>
</span><span id="L-671"><a href="#L-671"><span class="linenos"> 671</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">,</span><span class="n">right</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nfl_rosters</span><span class="p">[[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;current_team&#39;</span><span class="p">,</span><span class="s1">&#39;player_id_sr&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>\
</span><span id="L-672"><a href="#L-672"><span class="linenos"> 672</span></a>        <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;player&#39;</span><span class="p">:</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;player_id&#39;</span><span class="p">:</span><span class="s1">&#39;player_id_sr&#39;</span><span class="p">,</span><span class="s1">&#39;team&#39;</span><span class="p">:</span><span class="s1">&#39;current_team&#39;</span><span class="p">}),</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;current_team&#39;</span><span class="p">])</span>
</span><span id="L-673"><a href="#L-673"><span class="linenos"> 673</span></a>        <span class="c1"># Two Michael Carter&#39;s on the same team. What are the odds...</span>
</span><span id="L-674"><a href="#L-674"><span class="linenos"> 674</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">player_id_sr</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;CartMi02&#39;</span><span class="p">])]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-675"><a href="#L-675"><span class="linenos"> 675</span></a>        <span class="n">id_check</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;player_id_sr&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;freq&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="L-676"><a href="#L-676"><span class="linenos"> 676</span></a>        <span class="k">if</span> <span class="n">id_check</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-677"><a href="#L-677"><span class="linenos"> 677</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Found the same player ID on multiple players: &#39;</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">id_check</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">id_check</span><span class="o">.</span><span class="n">freq</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">,</span><span class="s1">&#39;player_id_sr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()))</span>
</span><span id="L-678"><a href="#L-678"><span class="linenos"> 678</span></a>        <span class="n">defenses</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;DEF&#39;</span><span class="p">])</span>
</span><span id="L-679"><a href="#L-679"><span class="linenos"> 679</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">defenses</span><span class="p">,</span><span class="s1">&#39;player_id_sr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">defenses</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
</span><span id="L-680"><a href="#L-680"><span class="linenos"> 680</span></a>        <span class="n">latest_draft</span> <span class="o">=</span> <span class="n">sr</span><span class="o">.</span><span class="n">get_draft</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">latest_season</span><span class="p">)[[</span><span class="s1">&#39;player&#39;</span><span class="p">,</span><span class="s1">&#39;player_id&#39;</span><span class="p">,</span><span class="s1">&#39;team_abbrev&#39;</span><span class="p">]]</span>\
</span><span id="L-681"><a href="#L-681"><span class="linenos"> 681</span></a>        <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;player&#39;</span><span class="p">:</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;player_id&#39;</span><span class="p">:</span><span class="s1">&#39;player_id_sr&#39;</span><span class="p">,</span><span class="s1">&#39;team_abbrev&#39;</span><span class="p">:</span><span class="s1">&#39;current_team&#39;</span><span class="p">})</span>
</span><span id="L-682"><a href="#L-682"><span class="linenos"> 682</span></a>        <span class="n">missing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">player_id_sr</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">latest_draft</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
</span><span id="L-683"><a href="#L-683"><span class="linenos"> 683</span></a>        <span class="n">unsigned</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[</span><span class="n">missing</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-684"><a href="#L-684"><span class="linenos"> 684</span></a>        <span class="k">del</span> <span class="n">unsigned</span><span class="p">[</span><span class="s1">&#39;player_id_sr&#39;</span><span class="p">]</span>
</span><span id="L-685"><a href="#L-685"><span class="linenos"> 685</span></a>        <span class="n">unsigned</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">unsigned</span><span class="p">,</span><span class="n">right</span><span class="o">=</span><span class="n">latest_draft</span><span class="p">[[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;current_team&#39;</span><span class="p">,</span><span class="s1">&#39;player_id_sr&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span><span class="n">keep</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">),</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;current_team&#39;</span><span class="p">])</span>
</span><span id="L-686"><a href="#L-686"><span class="linenos"> 686</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[</span><span class="o">~</span><span class="n">missing</span><span class="p">],</span><span class="n">unsigned</span><span class="p">],</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-687"><a href="#L-687"><span class="linenos"> 687</span></a>        <span class="n">missing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">player_id_sr</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nfl_rosters</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
</span><span id="L-688"><a href="#L-688"><span class="linenos"> 688</span></a>        <span class="n">closest</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[</span><span class="n">missing</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-689"><a href="#L-689"><span class="linenos"> 689</span></a>        <span class="k">del</span> <span class="n">closest</span><span class="p">[</span><span class="s1">&#39;player_id_sr&#39;</span><span class="p">],</span> <span class="n">closest</span><span class="p">[</span><span class="s1">&#39;current_team&#39;</span><span class="p">]</span>
</span><span id="L-690"><a href="#L-690"><span class="linenos"> 690</span></a>        <span class="n">closest</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">closest</span><span class="p">,</span><span class="n">right</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nfl_rosters</span><span class="p">[[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;current_team&#39;</span><span class="p">,</span><span class="s1">&#39;player_id_sr&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span><span class="n">keep</span><span class="o">=</span><span class="s1">&#39;last&#39;</span><span class="p">),</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
</span><span id="L-691"><a href="#L-691"><span class="linenos"> 691</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[</span><span class="o">~</span><span class="n">missing</span><span class="p">],</span><span class="n">closest</span><span class="p">],</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-692"><a href="#L-692"><span class="linenos"> 692</span></a>        <span class="n">still_missing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">player_id_sr</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span>
</span><span id="L-693"><a href="#L-693"><span class="linenos"> 693</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">still_missing</span><span class="p">,</span><span class="s1">&#39;player_id_sr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">still_missing</span><span class="p">,</span><span class="s1">&#39;player_id&#39;</span><span class="p">]</span>
</span><span id="L-694"><a href="#L-694"><span class="linenos"> 694</span></a>
</span><span id="L-695"><a href="#L-695"><span class="linenos"> 695</span></a>    <span class="k">def</span> <span class="nf">load_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">earliest</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">reference_games</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">basaloppstringtime</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]):</span>
</span><span id="L-696"><a href="#L-696"><span class="linenos"> 696</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-697"><a href="#L-697"><span class="linenos"> 697</span></a><span class="sd">        Initializes rate adjustment parameters for future season simulations. </span>
</span><span id="L-698"><a href="#L-698"><span class="linenos"> 698</span></a><span class="sd">        If parameters are not manually, optimal values are chosen based on </span>
</span><span id="L-699"><a href="#L-699"><span class="linenos"> 699</span></a><span class="sd">        maximum likelihood fitting over five years.</span>
</span><span id="L-700"><a href="#L-700"><span class="linenos"> 700</span></a>
</span><span id="L-701"><a href="#L-701"><span class="linenos"> 701</span></a><span class="sd">        Args:</span>
</span><span id="L-702"><a href="#L-702"><span class="linenos"> 702</span></a><span class="sd">            earliest (int, optional): year and number of the earliest week to be included in the prior for rate calculation, defaults to None.  </span>
</span><span id="L-703"><a href="#L-703"><span class="linenos"> 703</span></a><span class="sd">            reference_games (int, optional): number of games to include the prior for rate calculation, defaults to None.  </span>
</span><span id="L-704"><a href="#L-704"><span class="linenos"> 704</span></a><span class="sd">            basaloppstringtime (list, optional): list containing the basal factor, opponent elo factor, and depth chart factor, defaults to [].</span>
</span><span id="L-705"><a href="#L-705"><span class="linenos"> 705</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-706"><a href="#L-706"><span class="linenos"> 706</span></a>        <span class="n">params</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
</span><span id="L-707"><a href="#L-707"><span class="linenos"> 707</span></a>            <span class="s2">&quot;https://raw.githubusercontent.com/&quot;</span>
</span><span id="L-708"><a href="#L-708"><span class="linenos"> 708</span></a>            <span class="o">+</span> <span class="s2">&quot;tefirman/FantasySports/main/res/football/weighting_factors.csv&quot;</span>
</span><span id="L-709"><a href="#L-709"><span class="linenos"> 709</span></a>        <span class="p">)</span>
</span><span id="L-710"><a href="#L-710"><span class="linenos"> 710</span></a>        <span class="k">if</span> <span class="n">earliest</span><span class="p">:</span>
</span><span id="L-711"><a href="#L-711"><span class="linenos"> 711</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">earliest</span> <span class="o">=</span> <span class="n">earliest</span>
</span><span id="L-712"><a href="#L-712"><span class="linenos"> 712</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-713"><a href="#L-713"><span class="linenos"> 713</span></a>            <span class="n">prior</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">params</span><span class="o">.</span><span class="n">week</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">week</span><span class="p">,</span> <span class="s2">&quot;prior&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-714"><a href="#L-714"><span class="linenos"> 714</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">earliest</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">season</span> <span class="o">-</span> <span class="n">prior</span> <span class="o">//</span> <span class="mi">17</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">week</span> <span class="o">-</span> <span class="n">prior</span> <span class="o">%</span> <span class="mi">17</span>
</span><span id="L-715"><a href="#L-715"><span class="linenos"> 715</span></a>            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">earliest</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">earliest</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">):</span>
</span><span id="L-716"><a href="#L-716"><span class="linenos"> 716</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">earliest</span> <span class="o">-=</span> <span class="mi">83</span>  <span class="c1"># Assuming 17 weeks... Need to change this soon...</span>
</span><span id="L-717"><a href="#L-717"><span class="linenos"> 717</span></a>        <span class="k">if</span> <span class="n">reference_games</span><span class="p">:</span>
</span><span id="L-718"><a href="#L-718"><span class="linenos"> 718</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">reference_games</span> <span class="o">=</span> <span class="n">reference_games</span>
</span><span id="L-719"><a href="#L-719"><span class="linenos"> 719</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-720"><a href="#L-720"><span class="linenos"> 720</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">reference_games</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">params</span><span class="o">.</span><span class="n">week</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">week</span><span class="p">,</span> <span class="s2">&quot;games&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-721"><a href="#L-721"><span class="linenos"> 721</span></a>        <span class="k">if</span> <span class="n">basaloppstringtime</span><span class="p">:</span>
</span><span id="L-722"><a href="#L-722"><span class="linenos"> 722</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">basaloppstringtime</span> <span class="o">=</span> <span class="n">basaloppstringtime</span>
</span><span id="L-723"><a href="#L-723"><span class="linenos"> 723</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-724"><a href="#L-724"><span class="linenos"> 724</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">basaloppstringtime</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="L-725"><a href="#L-725"><span class="linenos"> 725</span></a>                <span class="n">params</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-726"><a href="#L-726"><span class="linenos"> 726</span></a>                    <span class="n">params</span><span class="o">.</span><span class="n">week</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">week</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;basal&quot;</span><span class="p">,</span> <span class="s2">&quot;opp_elo&quot;</span><span class="p">,</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="s2">&quot;time_factor&quot;</span><span class="p">]</span>
</span><span id="L-727"><a href="#L-727"><span class="linenos"> 727</span></a>                <span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-728"><a href="#L-728"><span class="linenos"> 728</span></a>            <span class="p">)</span>
</span><span id="L-729"><a href="#L-729"><span class="linenos"> 729</span></a>
</span><span id="L-730"><a href="#L-730"><span class="linenos"> 730</span></a>    <span class="k">def</span> <span class="nf">add_injuries</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-731"><a href="#L-731"><span class="linenos"> 731</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-732"><a href="#L-732"><span class="linenos"> 732</span></a><span class="sd">        Adds manual projections for injury timespans. If a new injury pops up </span>
</span><span id="L-733"><a href="#L-733"><span class="linenos"> 733</span></a><span class="sd">        and no projection has been provided yet, timespan defaults to one week.</span>
</span><span id="L-734"><a href="#L-734"><span class="linenos"> 734</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-735"><a href="#L-735"><span class="linenos"> 735</span></a>        <span class="n">as_of</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">season</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">week</span>
</span><span id="L-736"><a href="#L-736"><span class="linenos"> 736</span></a>        <span class="k">if</span> <span class="s2">&quot;until&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="L-737"><a href="#L-737"><span class="linenos"> 737</span></a>            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[</span><span class="s2">&quot;until&quot;</span><span class="p">]</span>
</span><span id="L-738"><a href="#L-738"><span class="linenos"> 738</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[</span><span class="s2">&quot;until&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;NaN&quot;</span><span class="p">)</span>
</span><span id="L-739"><a href="#L-739"><span class="linenos"> 739</span></a>        <span class="k">if</span> <span class="n">as_of</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">latest_season</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_week</span><span class="p">:</span>
</span><span id="L-740"><a href="#L-740"><span class="linenos"> 740</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">load_stats</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">season</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">season</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="mi">17</span><span class="p">)</span>
</span><span id="L-741"><a href="#L-741"><span class="linenos"> 741</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-742"><a href="#L-742"><span class="linenos"> 742</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">season</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">week</span> <span class="o">&gt;=</span> <span class="n">as_of</span>
</span><span id="L-743"><a href="#L-743"><span class="linenos"> 743</span></a>            <span class="p">]</span>
</span><span id="L-744"><a href="#L-744"><span class="linenos"> 744</span></a>            <span class="n">healthy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-745"><a href="#L-745"><span class="linenos"> 745</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">season</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">week</span> <span class="o">==</span> <span class="n">as_of</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span>
</span><span id="L-746"><a href="#L-746"><span class="linenos"> 746</span></a>            <span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="L-747"><a href="#L-747"><span class="linenos"> 747</span></a>            <span class="n">injured</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-748"><a href="#L-748"><span class="linenos"> 748</span></a>                <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">healthy</span><span class="p">),</span> <span class="s2">&quot;name&quot;</span>
</span><span id="L-749"><a href="#L-749"><span class="linenos"> 749</span></a>            <span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="L-750"><a href="#L-750"><span class="linenos"> 750</span></a>            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">injured</span><span class="p">:</span>
</span><span id="L-751"><a href="#L-751"><span class="linenos"> 751</span></a>                <span class="n">until</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">name</span><span class="p">,</span> <span class="s2">&quot;week&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="L-752"><a href="#L-752"><span class="linenos"> 752</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">until</span><span class="p">):</span>
</span><span id="L-753"><a href="#L-753"><span class="linenos"> 753</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">name</span><span class="p">,</span> <span class="s2">&quot;until&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">until</span>
</span><span id="L-754"><a href="#L-754"><span class="linenos"> 754</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">season</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">latest_season</span><span class="p">:</span>
</span><span id="L-755"><a href="#L-755"><span class="linenos"> 755</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">name</span><span class="p">,</span> <span class="s2">&quot;until&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">17</span>
</span><span id="L-756"><a href="#L-756"><span class="linenos"> 756</span></a>        <span class="k">if</span> <span class="n">as_of</span> <span class="o">//</span> <span class="mi">100</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">latest_season</span><span class="p">:</span>
</span><span id="L-757"><a href="#L-757"><span class="linenos"> 757</span></a>            <span class="n">inj_proj</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
</span><span id="L-758"><a href="#L-758"><span class="linenos"> 758</span></a>                <span class="s2">&quot;https://raw.githubusercontent.com/&quot;</span>
</span><span id="L-759"><a href="#L-759"><span class="linenos"> 759</span></a>                <span class="o">+</span> <span class="s2">&quot;tefirman/FantasySports/main/res/football/injured_list.csv&quot;</span>
</span><span id="L-760"><a href="#L-760"><span class="linenos"> 760</span></a>            <span class="p">)</span>
</span><span id="L-761"><a href="#L-761"><span class="linenos"> 761</span></a>            <span class="n">inj_proj</span> <span class="o">=</span> <span class="n">inj_proj</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inj_proj</span><span class="o">.</span><span class="n">until</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_week</span><span class="p">]</span>
</span><span id="L-762"><a href="#L-762"><span class="linenos"> 762</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">players</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="L-763"><a href="#L-763"><span class="linenos"> 763</span></a>                <span class="n">left</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;until&quot;</span><span class="p">:</span> <span class="s2">&quot;until_orig&quot;</span><span class="p">}),</span>
</span><span id="L-764"><a href="#L-764"><span class="linenos"> 764</span></a>                <span class="n">right</span><span class="o">=</span><span class="n">inj_proj</span><span class="p">,</span>
</span><span id="L-765"><a href="#L-765"><span class="linenos"> 765</span></a>                <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
</span><span id="L-766"><a href="#L-766"><span class="linenos"> 766</span></a>                <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;player_id_sr&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;position&quot;</span><span class="p">],</span>
</span><span id="L-767"><a href="#L-767"><span class="linenos"> 767</span></a>            <span class="p">)</span>
</span><span id="L-768"><a href="#L-768"><span class="linenos"> 768</span></a>            <span class="k">if</span> <span class="n">as_of</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_week</span><span class="p">:</span>
</span><span id="L-769"><a href="#L-769"><span class="linenos"> 769</span></a>                <span class="n">newInjury</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-770"><a href="#L-770"><span class="linenos"> 770</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span>
</span><span id="L-771"><a href="#L-771"><span class="linenos"> 771</span></a>                        <span class="p">[</span>
</span><span id="L-772"><a href="#L-772"><span class="linenos"> 772</span></a>                            <span class="s2">&quot;O&quot;</span><span class="p">,</span>
</span><span id="L-773"><a href="#L-773"><span class="linenos"> 773</span></a>                            <span class="s2">&quot;D&quot;</span><span class="p">,</span>
</span><span id="L-774"><a href="#L-774"><span class="linenos"> 774</span></a>                            <span class="s2">&quot;SUSP&quot;</span><span class="p">,</span>
</span><span id="L-775"><a href="#L-775"><span class="linenos"> 775</span></a>                            <span class="s2">&quot;IR&quot;</span><span class="p">,</span>
</span><span id="L-776"><a href="#L-776"><span class="linenos"> 776</span></a>                            <span class="s2">&quot;PUP-R&quot;</span><span class="p">,</span>
</span><span id="L-777"><a href="#L-777"><span class="linenos"> 777</span></a>                            <span class="s2">&quot;PUP-P&quot;</span><span class="p">,</span>
</span><span id="L-778"><a href="#L-778"><span class="linenos"> 778</span></a>                            <span class="s2">&quot;NFI-R&quot;</span><span class="p">,</span>
</span><span id="L-779"><a href="#L-779"><span class="linenos"> 779</span></a>                            <span class="s2">&quot;NA&quot;</span><span class="p">,</span>
</span><span id="L-780"><a href="#L-780"><span class="linenos"> 780</span></a>                            <span class="s2">&quot;COVID-19&quot;</span><span class="p">,</span>
</span><span id="L-781"><a href="#L-781"><span class="linenos"> 781</span></a>                        <span class="p">]</span>
</span><span id="L-782"><a href="#L-782"><span class="linenos"> 782</span></a>                    <span class="p">)</span>
</span><span id="L-783"><a href="#L-783"><span class="linenos"> 783</span></a>                    <span class="o">&amp;</span> <span class="p">(</span>
</span><span id="L-784"><a href="#L-784"><span class="linenos"> 784</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">until</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span>
</span><span id="L-785"><a href="#L-785"><span class="linenos"> 785</span></a>                        <span class="o">|</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">until</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_week</span><span class="p">)</span>
</span><span id="L-786"><a href="#L-786"><span class="linenos"> 786</span></a>                    <span class="p">)</span>
</span><span id="L-787"><a href="#L-787"><span class="linenos"> 787</span></a>                    <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">fantasy_team</span><span class="o">.</span><span class="n">isnull</span><span class="p">())</span>
</span><span id="L-788"><a href="#L-788"><span class="linenos"> 788</span></a>                <span class="p">)</span>  <span class="c1"># | (self.players.WAR &gt;= 0))</span>
</span><span id="L-789"><a href="#L-789"><span class="linenos"> 789</span></a>                <span class="k">if</span> <span class="n">newInjury</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-790"><a href="#L-790"><span class="linenos"> 790</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="L-791"><a href="#L-791"><span class="linenos"> 791</span></a>                        <span class="s2">&quot;Need to look up new injuries... &quot;</span>
</span><span id="L-792"><a href="#L-792"><span class="linenos"> 792</span></a>                        <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">newInjury</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
</span><span id="L-793"><a href="#L-793"><span class="linenos"> 793</span></a>                    <span class="p">)</span>
</span><span id="L-794"><a href="#L-794"><span class="linenos"> 794</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">newInjury</span><span class="p">,</span> <span class="s2">&quot;until&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_week</span>
</span><span id="L-795"><a href="#L-795"><span class="linenos"> 795</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">newInjury</span><span class="p">,[</span><span class="s2">&quot;player_id_sr&quot;</span><span class="p">,</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="s2">&quot;position&quot;</span><span class="p">,</span><span class="s2">&quot;status&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;NewInjuries.csv&quot;</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-796"><a href="#L-796"><span class="linenos"> 796</span></a>                <span class="n">oldInjury</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-797"><a href="#L-797"><span class="linenos"> 797</span></a>                    <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span>
</span><span id="L-798"><a href="#L-798"><span class="linenos"> 798</span></a>                        <span class="p">[</span>
</span><span id="L-799"><a href="#L-799"><span class="linenos"> 799</span></a>                            <span class="s2">&quot;O&quot;</span><span class="p">,</span>
</span><span id="L-800"><a href="#L-800"><span class="linenos"> 800</span></a>                            <span class="s2">&quot;D&quot;</span><span class="p">,</span>
</span><span id="L-801"><a href="#L-801"><span class="linenos"> 801</span></a>                            <span class="s2">&quot;SUSP&quot;</span><span class="p">,</span>
</span><span id="L-802"><a href="#L-802"><span class="linenos"> 802</span></a>                            <span class="s2">&quot;IR&quot;</span><span class="p">,</span>
</span><span id="L-803"><a href="#L-803"><span class="linenos"> 803</span></a>                            <span class="s2">&quot;PUP-R&quot;</span><span class="p">,</span>
</span><span id="L-804"><a href="#L-804"><span class="linenos"> 804</span></a>                            <span class="s2">&quot;PUP-P&quot;</span><span class="p">,</span>
</span><span id="L-805"><a href="#L-805"><span class="linenos"> 805</span></a>                            <span class="s2">&quot;NFI-R&quot;</span><span class="p">,</span>
</span><span id="L-806"><a href="#L-806"><span class="linenos"> 806</span></a>                            <span class="s2">&quot;NA&quot;</span><span class="p">,</span>
</span><span id="L-807"><a href="#L-807"><span class="linenos"> 807</span></a>                            <span class="s2">&quot;COVID-19&quot;</span><span class="p">,</span>
</span><span id="L-808"><a href="#L-808"><span class="linenos"> 808</span></a>                        <span class="p">]</span>
</span><span id="L-809"><a href="#L-809"><span class="linenos"> 809</span></a>                    <span class="p">)</span>
</span><span id="L-810"><a href="#L-810"><span class="linenos"> 810</span></a>                    <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">until</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_week</span><span class="p">)</span>
</span><span id="L-811"><a href="#L-811"><span class="linenos"> 811</span></a>                    <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">fantasy_team</span><span class="o">.</span><span class="n">isnull</span><span class="p">())</span>
</span><span id="L-812"><a href="#L-812"><span class="linenos"> 812</span></a>                <span class="p">)</span>  <span class="c1"># | (self.players.WAR &gt;= 0))</span>
</span><span id="L-813"><a href="#L-813"><span class="linenos"> 813</span></a>                <span class="k">if</span> <span class="n">oldInjury</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-814"><a href="#L-814"><span class="linenos"> 814</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="L-815"><a href="#L-815"><span class="linenos"> 815</span></a>                        <span class="s2">&quot;Need to update old injuries... &quot;</span>
</span><span id="L-816"><a href="#L-816"><span class="linenos"> 816</span></a>                        <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">oldInjury</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
</span><span id="L-817"><a href="#L-817"><span class="linenos"> 817</span></a>                    <span class="p">)</span>
</span><span id="L-818"><a href="#L-818"><span class="linenos"> 818</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">oldInjury</span><span class="p">,[</span><span class="s2">&quot;player_id_sr&quot;</span><span class="p">,</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="s2">&quot;position&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;OldInjuries.csv&quot;</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-819"><a href="#L-819"><span class="linenos"> 819</span></a>                    <span class="c1"># self.players.loc[oldInjury,&#39;until&#39;] = self.current_week</span>
</span><span id="L-820"><a href="#L-820"><span class="linenos"> 820</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[</span><span class="s2">&quot;until&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[[</span><span class="s2">&quot;until_orig&quot;</span><span class="p">,</span> <span class="s2">&quot;until&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-821"><a href="#L-821"><span class="linenos"> 821</span></a>            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[</span><span class="s2">&quot;until_orig&quot;</span><span class="p">]</span>
</span><span id="L-822"><a href="#L-822"><span class="linenos"> 822</span></a>
</span><span id="L-823"><a href="#L-823"><span class="linenos"> 823</span></a>    <span class="k">def</span> <span class="nf">add_bye_weeks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-824"><a href="#L-824"><span class="linenos"> 824</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-825"><a href="#L-825"><span class="linenos"> 825</span></a><span class="sd">        Derives bye weeks based on the current NFL schedule and merges them to the players dataframe.</span>
</span><span id="L-826"><a href="#L-826"><span class="linenos"> 826</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-827"><a href="#L-827"><span class="linenos"> 827</span></a>        <span class="n">byes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="L-828"><a href="#L-828"><span class="linenos"> 828</span></a>        <span class="k">for</span> <span class="n">team</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nfl_schedule</span><span class="o">.</span><span class="n">team</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
</span><span id="L-829"><a href="#L-829"><span class="linenos"> 829</span></a>            <span class="n">bye_week</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-830"><a href="#L-830"><span class="linenos"> 830</span></a>            <span class="k">while</span> <span class="p">(</span>
</span><span id="L-831"><a href="#L-831"><span class="linenos"> 831</span></a>                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nfl_schedule</span><span class="o">.</span><span class="n">team</span> <span class="o">==</span> <span class="n">team</span><span class="p">)</span>
</span><span id="L-832"><a href="#L-832"><span class="linenos"> 832</span></a>                <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nfl_schedule</span><span class="o">.</span><span class="n">season</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">season</span><span class="p">)</span>
</span><span id="L-833"><a href="#L-833"><span class="linenos"> 833</span></a>                <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nfl_schedule</span><span class="o">.</span><span class="n">week</span> <span class="o">==</span> <span class="n">bye_week</span><span class="p">)</span>
</span><span id="L-834"><a href="#L-834"><span class="linenos"> 834</span></a>            <span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="L-835"><a href="#L-835"><span class="linenos"> 835</span></a>                <span class="n">bye_week</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-836"><a href="#L-836"><span class="linenos"> 836</span></a>            <span class="n">byes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">byes</span><span class="p">,</span>
</span><span id="L-837"><a href="#L-837"><span class="linenos"> 837</span></a>                <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;current_team&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">team</span><span class="p">],</span> <span class="s2">&quot;bye_week&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">bye_week</span><span class="p">]})],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span>
</span><span id="L-838"><a href="#L-838"><span class="linenos"> 838</span></a>            <span class="p">)</span>
</span><span id="L-839"><a href="#L-839"><span class="linenos"> 839</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="L-840"><a href="#L-840"><span class="linenos"> 840</span></a>            <span class="n">left</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">byes</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;current_team&quot;</span>
</span><span id="L-841"><a href="#L-841"><span class="linenos"> 841</span></a>        <span class="p">)</span>
</span><span id="L-842"><a href="#L-842"><span class="linenos"> 842</span></a>
</span><span id="L-843"><a href="#L-843"><span class="linenos"> 843</span></a>    <span class="k">def</span> <span class="nf">add_roster_pcts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span><span class="p">):</span>
</span><span id="L-844"><a href="#L-844"><span class="linenos"> 844</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-845"><a href="#L-845"><span class="linenos"> 845</span></a><span class="sd">        Pulls the percentage of leagues each player is rostered in and merges it into the players dataframe.</span>
</span><span id="L-846"><a href="#L-846"><span class="linenos"> 846</span></a>
</span><span id="L-847"><a href="#L-847"><span class="linenos"> 847</span></a><span class="sd">        Args:</span>
</span><span id="L-848"><a href="#L-848"><span class="linenos"> 848</span></a><span class="sd">            inc (int, optional): number of players to pull per API call, defaults to 25.</span>
</span><span id="L-849"><a href="#L-849"><span class="linenos"> 849</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-850"><a href="#L-850"><span class="linenos"> 850</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_oauth</span><span class="p">()</span>
</span><span id="L-851"><a href="#L-851"><span class="linenos"> 851</span></a>        <span class="n">roster_pcts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="L-852"><a href="#L-852"><span class="linenos"> 852</span></a>        <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="n">inc</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="L-853"><a href="#L-853"><span class="linenos"> 853</span></a>            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="L-854"><a href="#L-854"><span class="linenos"> 854</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="L-855"><a href="#L-855"><span class="linenos"> 855</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">refresh_oauth</span><span class="p">()</span>
</span><span id="L-856"><a href="#L-856"><span class="linenos"> 856</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">inc</span> <span class="o">*</span> <span class="n">ind</span> <span class="p">:</span> <span class="n">inc</span> <span class="o">*</span> <span class="p">(</span><span class="n">ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-857"><a href="#L-857"><span class="linenos"> 857</span></a>                        <span class="n">pcts</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;count&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">}</span>
</span><span id="L-858"><a href="#L-858"><span class="linenos"> 858</span></a>                        <span class="k">break</span>
</span><span id="L-859"><a href="#L-859"><span class="linenos"> 859</span></a>                    <span class="n">player_ids</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-860"><a href="#L-860"><span class="linenos"> 860</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">inc</span> <span class="o">*</span> <span class="n">ind</span> <span class="p">:</span> <span class="n">inc</span> <span class="o">*</span> <span class="p">(</span><span class="n">ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
</span><span id="L-861"><a href="#L-861"><span class="linenos"> 861</span></a>                        <span class="o">.</span><span class="n">player_id</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
</span><span id="L-862"><a href="#L-862"><span class="linenos"> 862</span></a>                        <span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="L-863"><a href="#L-863"><span class="linenos"> 863</span></a>                    <span class="p">)</span>
</span><span id="L-864"><a href="#L-864"><span class="linenos"> 864</span></a>                    <span class="n">player_ids</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-865"><a href="#L-865"><span class="linenos"> 865</span></a>                        <span class="n">val</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">player_ids</span> <span class="k">if</span> <span class="n">val</span> <span class="o">!=</span> <span class="s2">&quot;nan&quot;</span>
</span><span id="L-866"><a href="#L-866"><span class="linenos"> 866</span></a>                    <span class="p">]</span>
</span><span id="L-867"><a href="#L-867"><span class="linenos"> 867</span></a>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">player_ids</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-868"><a href="#L-868"><span class="linenos"> 868</span></a>                        <span class="n">pcts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lg</span><span class="o">.</span><span class="n">yhandler</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="L-869"><a href="#L-869"><span class="linenos"> 869</span></a>                            <span class="s2">&quot;league/</span><span class="si">{}</span><span class="s2">/players;player_keys=</span><span class="si">{}</span><span class="s2">.p.</span><span class="si">{}</span><span class="s2">/percent_owned&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="L-870"><a href="#L-870"><span class="linenos"> 870</span></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">lg_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lg_id</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;,</span><span class="si">{}</span><span class="s2">.p.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lg_id</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">player_ids</span><span class="p">)</span>
</span><span id="L-871"><a href="#L-871"><span class="linenos"> 871</span></a>                            <span class="p">)</span>
</span><span id="L-872"><a href="#L-872"><span class="linenos"> 872</span></a>                        <span class="p">)[</span><span class="s2">&quot;fantasy_content&quot;</span><span class="p">][</span><span class="s2">&quot;league&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;players&quot;</span><span class="p">]</span>
</span><span id="L-873"><a href="#L-873"><span class="linenos"> 873</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-874"><a href="#L-874"><span class="linenos"> 874</span></a>                        <span class="n">pcts</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;count&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">}</span>
</span><span id="L-875"><a href="#L-875"><span class="linenos"> 875</span></a>                    <span class="k">break</span>
</span><span id="L-876"><a href="#L-876"><span class="linenos"> 876</span></a>                <span class="k">except</span><span class="p">:</span>
</span><span id="L-877"><a href="#L-877"><span class="linenos"> 877</span></a>                    <span class="n">err_message</span> <span class="o">=</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span>
</span><span id="L-878"><a href="#L-878"><span class="linenos"> 878</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="n">err_message</span><span class="p">)</span>
</span><span id="L-879"><a href="#L-879"><span class="linenos"> 879</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="L-880"><a href="#L-880"><span class="linenos"> 880</span></a>                        <span class="s2">&quot;Roster percentage query crapped out... Waiting 30 seconds and trying again...&quot;</span>
</span><span id="L-881"><a href="#L-881"><span class="linenos"> 881</span></a>                    <span class="p">)</span>
</span><span id="L-882"><a href="#L-882"><span class="linenos"> 882</span></a>                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
</span><span id="L-883"><a href="#L-883"><span class="linenos"> 883</span></a>            <span class="k">for</span> <span class="n">player_ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">pcts</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]):</span>
</span><span id="L-884"><a href="#L-884"><span class="linenos"> 884</span></a>                <span class="n">player</span> <span class="o">=</span> <span class="n">pcts</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">player_ind</span><span class="p">)][</span><span class="s2">&quot;player&quot;</span><span class="p">]</span>
</span><span id="L-885"><a href="#L-885"><span class="linenos"> 885</span></a>                <span class="n">player_id</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-886"><a href="#L-886"><span class="linenos"> 886</span></a>                    <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="s2">&quot;player_id&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">player</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;player_id&quot;</span> <span class="ow">in</span> <span class="n">val</span>
</span><span id="L-887"><a href="#L-887"><span class="linenos"> 887</span></a>                <span class="p">]</span>
</span><span id="L-888"><a href="#L-888"><span class="linenos"> 888</span></a>                <span class="c1"># full_name = [val[&quot;name&quot;][&quot;full&quot;] for val in player[0] if &quot;name&quot; in val]</span>
</span><span id="L-889"><a href="#L-889"><span class="linenos"> 889</span></a>                <span class="n">pct_owned</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-890"><a href="#L-890"><span class="linenos"> 890</span></a>                    <span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">])</span> <span class="o">/</span> <span class="mf">100.0</span>
</span><span id="L-891"><a href="#L-891"><span class="linenos"> 891</span></a>                    <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">player</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;percent_owned&quot;</span><span class="p">]</span>
</span><span id="L-892"><a href="#L-892"><span class="linenos"> 892</span></a>                    <span class="k">if</span> <span class="s2">&quot;value&quot;</span> <span class="ow">in</span> <span class="n">val</span>
</span><span id="L-893"><a href="#L-893"><span class="linenos"> 893</span></a>                <span class="p">]</span>
</span><span id="L-894"><a href="#L-894"><span class="linenos"> 894</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pct_owned</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-895"><a href="#L-895"><span class="linenos"> 895</span></a>                    <span class="c1"># print(&quot;Can&#39;t find roster percentage for {}...&quot;.format(full_name))</span>
</span><span id="L-896"><a href="#L-896"><span class="linenos"> 896</span></a>                    <span class="n">pct_owned</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span>
</span><span id="L-897"><a href="#L-897"><span class="linenos"> 897</span></a>                <span class="n">roster_pcts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">roster_pcts</span><span class="p">,</span>
</span><span id="L-898"><a href="#L-898"><span class="linenos"> 898</span></a>                    <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span><span id="L-899"><a href="#L-899"><span class="linenos"> 899</span></a>                        <span class="p">{</span>
</span><span id="L-900"><a href="#L-900"><span class="linenos"> 900</span></a>                            <span class="s2">&quot;player_id&quot;</span><span class="p">:</span> <span class="n">player_id</span><span class="p">,</span>
</span><span id="L-901"><a href="#L-901"><span class="linenos"> 901</span></a>                            <span class="c1"># &quot;name&quot;: full_name,</span>
</span><span id="L-902"><a href="#L-902"><span class="linenos"> 902</span></a>                            <span class="s2">&quot;pct_rostered&quot;</span><span class="p">:</span> <span class="n">pct_owned</span><span class="p">,</span>
</span><span id="L-903"><a href="#L-903"><span class="linenos"> 903</span></a>                        <span class="p">}</span>
</span><span id="L-904"><a href="#L-904"><span class="linenos"> 904</span></a>                    <span class="p">)],</span>
</span><span id="L-905"><a href="#L-905"><span class="linenos"> 905</span></a>                    <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-906"><a href="#L-906"><span class="linenos"> 906</span></a>                    <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-907"><a href="#L-907"><span class="linenos"> 907</span></a>                <span class="p">)</span>
</span><span id="L-908"><a href="#L-908"><span class="linenos"> 908</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="L-909"><a href="#L-909"><span class="linenos"> 909</span></a>            <span class="n">left</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">roster_pcts</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;player_id&quot;</span><span class="p">]</span><span class="c1">#, &quot;name&quot;]</span>
</span><span id="L-910"><a href="#L-910"><span class="linenos"> 910</span></a>        <span class="p">)</span>
</span><span id="L-911"><a href="#L-911"><span class="linenos"> 911</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">pct_rostered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">pct_rostered</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="L-912"><a href="#L-912"><span class="linenos"> 912</span></a>        <span class="n">not_found</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">player_id</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">player_id_sr</span><span class="p">)</span> \
</span><span id="L-913"><a href="#L-913"><span class="linenos"> 913</span></a>        <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">fantasy_team</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span> <span class="o">|</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">pct_rostered</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">))</span>
</span><span id="L-914"><a href="#L-914"><span class="linenos"> 914</span></a>        <span class="k">if</span> <span class="n">not_found</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="L-915"><a href="#L-915"><span class="linenos"> 915</span></a>            <span class="c1"># What about unsigned draft picks??? Maybe look them up individually?</span>
</span><span id="L-916"><a href="#L-916"><span class="linenos"> 916</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="L-917"><a href="#L-917"><span class="linenos"> 917</span></a>                <span class="s2">&quot;Need to reconcile player names with Pro Football Reference... &quot;</span>
</span><span id="L-918"><a href="#L-918"><span class="linenos"> 918</span></a>                <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">not_found</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">])</span>
</span><span id="L-919"><a href="#L-919"><span class="linenos"> 919</span></a>            <span class="p">)</span>
</span><span id="L-920"><a href="#L-920"><span class="linenos"> 920</span></a>
</span><span id="L-921"><a href="#L-921"><span class="linenos"> 921</span></a>    <span class="k">def</span> <span class="nf">add_depth_charts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-922"><a href="#L-922"><span class="linenos"> 922</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-923"><a href="#L-923"><span class="linenos"> 923</span></a><span class="sd">        Pulls current team depth charts from ESPN and merges them into the players dataframe.</span>
</span><span id="L-924"><a href="#L-924"><span class="linenos"> 924</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-925"><a href="#L-925"><span class="linenos"> 925</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">season</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">latest_season</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">week</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_week</span><span class="p">:</span>
</span><span id="L-926"><a href="#L-926"><span class="linenos"> 926</span></a>            <span class="c1"># Include name corrections here???</span>
</span><span id="L-927"><a href="#L-927"><span class="linenos"> 927</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">players</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">,</span><span class="n">right</span><span class="o">=</span><span class="n">sr</span><span class="o">.</span><span class="n">get_all_depth_charts</span><span class="p">()</span>\
</span><span id="L-928"><a href="#L-928"><span class="linenos"> 928</span></a>            <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;player&#39;</span><span class="p">:</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;pos&#39;</span><span class="p">:</span><span class="s1">&#39;position&#39;</span><span class="p">,</span><span class="s1">&#39;team&#39;</span><span class="p">:</span><span class="s1">&#39;current_team&#39;</span><span class="p">}),</span>\
</span><span id="L-929"><a href="#L-929"><span class="linenos"> 929</span></a>            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;current_team&quot;</span><span class="p">,</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="s1">&#39;position&#39;</span><span class="p">])</span>
</span><span id="L-930"><a href="#L-930"><span class="linenos"> 930</span></a>            <span class="n">missing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">string</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span> <span class="o">&amp;</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;DEF&#39;</span><span class="p">])</span> \
</span><span id="L-931"><a href="#L-931"><span class="linenos"> 931</span></a>            <span class="o">&amp;</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">pct_rostered</span> <span class="o">&gt;</span> <span class="mf">0.05</span><span class="p">)</span> <span class="o">|</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">fantasy_team</span><span class="o">.</span><span class="n">isnull</span><span class="p">())</span> \
</span><span id="L-932"><a href="#L-932"><span class="linenos"> 932</span></a>            <span class="o">&amp;</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;NA&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">until</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span>
</span><span id="L-933"><a href="#L-933"><span class="linenos"> 933</span></a>            <span class="k">if</span> <span class="n">missing</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="L-934"><a href="#L-934"><span class="linenos"> 934</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="L-935"><a href="#L-935"><span class="linenos"> 935</span></a>                    <span class="s2">&quot;Need to reconcile player names with ESPN... &quot;</span>
</span><span id="L-936"><a href="#L-936"><span class="linenos"> 936</span></a>                    <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">missing</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">])</span>
</span><span id="L-937"><a href="#L-937"><span class="linenos"> 937</span></a>                <span class="p">)</span>
</span><span id="L-938"><a href="#L-938"><span class="linenos"> 938</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-939"><a href="#L-939"><span class="linenos"> 939</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">load_stats</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">season</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">season</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="mi">17</span><span class="p">)</span>
</span><span id="L-940"><a href="#L-940"><span class="linenos"> 940</span></a>            <span class="n">strings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">season</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">week</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">season</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">week</span><span class="p">]</span>\
</span><span id="L-941"><a href="#L-941"><span class="linenos"> 941</span></a>            <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;season&#39;</span><span class="p">,</span><span class="s1">&#39;week&#39;</span><span class="p">],</span><span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)[[</span><span class="s1">&#39;player_id_sr&#39;</span><span class="p">,</span><span class="s1">&#39;string&#39;</span><span class="p">]]</span>\
</span><span id="L-942"><a href="#L-942"><span class="linenos"> 942</span></a>            <span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;player_id_sr&#39;</span><span class="p">],</span><span class="n">keep</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">)</span>
</span><span id="L-943"><a href="#L-943"><span class="linenos"> 943</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">players</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">,</span><span class="n">right</span><span class="o">=</span><span class="n">strings</span><span class="p">,</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;player_id_sr&#39;</span><span class="p">])</span>
</span><span id="L-944"><a href="#L-944"><span class="linenos"> 944</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">position</span> <span class="o">==</span> <span class="s1">&#39;DEF&#39;</span><span class="p">,</span><span class="s1">&#39;string&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="L-945"><a href="#L-945"><span class="linenos"> 945</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">string</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span>
</span><span id="L-946"><a href="#L-946"><span class="linenos"> 946</span></a>
</span><span id="L-947"><a href="#L-947"><span class="linenos"> 947</span></a>    <span class="k">def</span> <span class="nf">get_rates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reload</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
</span><span id="L-948"><a href="#L-948"><span class="linenos"> 948</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-949"><a href="#L-949"><span class="linenos"> 949</span></a><span class="sd">        Calculates the average and standard deviation of fantasy points for each player </span>
</span><span id="L-950"><a href="#L-950"><span class="linenos"> 950</span></a><span class="sd">        based on the specified prior and normalizing with respect to the provided weighting factors.</span>
</span><span id="L-951"><a href="#L-951"><span class="linenos"> 951</span></a>
</span><span id="L-952"><a href="#L-952"><span class="linenos"> 952</span></a><span class="sd">        Args:</span>
</span><span id="L-953"><a href="#L-953"><span class="linenos"> 953</span></a><span class="sd">            reload (bool, optional): whether to reload the statistics dataframe, defaults to True.</span>
</span><span id="L-954"><a href="#L-954"><span class="linenos"> 954</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-955"><a href="#L-955"><span class="linenos"> 955</span></a>        <span class="n">as_of</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">season</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">week</span>
</span><span id="L-956"><a href="#L-956"><span class="linenos"> 956</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s2">&quot;stats&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">reload</span><span class="p">:</span>
</span><span id="L-957"><a href="#L-957"><span class="linenos"> 957</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">load_stats</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">earliest</span><span class="p">,</span> <span class="n">as_of</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-958"><a href="#L-958"><span class="linenos"> 958</span></a>            <span class="n">rel_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-959"><a href="#L-959"><span class="linenos"> 959</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-960"><a href="#L-960"><span class="linenos"> 960</span></a>            <span class="n">rel_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">season</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">week</span> <span class="o">&lt;=</span> <span class="n">as_of</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> \
</span><span id="L-961"><a href="#L-961"><span class="linenos"> 961</span></a>            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">season</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">week</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">earliest</span><span class="p">)]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="L-962"><a href="#L-962"><span class="linenos"> 962</span></a>        <span class="n">rel_stats</span><span class="p">[</span><span class="s2">&quot;game_factor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-963"><a href="#L-963"><span class="linenos"> 963</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">basaloppstringtime</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-964"><a href="#L-964"><span class="linenos"> 964</span></a>            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">basaloppstringtime</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">rel_stats</span><span class="p">[</span><span class="s2">&quot;elo_diff&quot;</span><span class="p">])</span>
</span><span id="L-965"><a href="#L-965"><span class="linenos"> 965</span></a>            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">basaloppstringtime</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">rel_stats</span><span class="p">[</span><span class="s2">&quot;string&quot;</span><span class="p">])</span>
</span><span id="L-966"><a href="#L-966"><span class="linenos"> 966</span></a>        <span class="p">)</span>
</span><span id="L-967"><a href="#L-967"><span class="linenos"> 967</span></a>        <span class="n">rel_stats</span><span class="p">[</span><span class="s1">&#39;rel_points&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rel_stats</span><span class="o">.</span><span class="n">points</span><span class="o">/</span><span class="n">rel_stats</span><span class="o">.</span><span class="n">game_factor</span>
</span><span id="L-968"><a href="#L-968"><span class="linenos"> 968</span></a>        <span class="n">by_pos</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="L-969"><a href="#L-969"><span class="linenos"> 969</span></a>            <span class="n">left</span><span class="o">=</span><span class="n">rel_stats</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;position&quot;</span><span class="p">)</span>
</span><span id="L-970"><a href="#L-970"><span class="linenos"> 970</span></a>            <span class="o">.</span><span class="n">rel_points</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="L-971"><a href="#L-971"><span class="linenos"> 971</span></a>            <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="L-972"><a href="#L-972"><span class="linenos"> 972</span></a>            <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;rel_points&quot;</span><span class="p">:</span> <span class="s2">&quot;points_rate&quot;</span><span class="p">}),</span>
</span><span id="L-973"><a href="#L-973"><span class="linenos"> 973</span></a>            <span class="n">right</span><span class="o">=</span><span class="n">rel_stats</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;position&quot;</span><span class="p">)</span>
</span><span id="L-974"><a href="#L-974"><span class="linenos"> 974</span></a>            <span class="o">.</span><span class="n">rel_points</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
</span><span id="L-975"><a href="#L-975"><span class="linenos"> 975</span></a>            <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="L-976"><a href="#L-976"><span class="linenos"> 976</span></a>            <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;rel_points&quot;</span><span class="p">:</span> <span class="s2">&quot;points_stdev&quot;</span><span class="p">}),</span>
</span><span id="L-977"><a href="#L-977"><span class="linenos"> 977</span></a>            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">,</span>
</span><span id="L-978"><a href="#L-978"><span class="linenos"> 978</span></a>            <span class="n">on</span><span class="o">=</span><span class="s2">&quot;position&quot;</span><span class="p">,</span>
</span><span id="L-979"><a href="#L-979"><span class="linenos"> 979</span></a>        <span class="p">)</span>
</span><span id="L-980"><a href="#L-980"><span class="linenos"> 980</span></a>        <span class="n">by_pos</span><span class="p">[</span><span class="s2">&quot;player_id_sr&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;avg_&quot;</span> <span class="o">+</span> <span class="n">by_pos</span><span class="p">[</span><span class="s2">&quot;position&quot;</span><span class="p">]</span>
</span><span id="L-981"><a href="#L-981"><span class="linenos"> 981</span></a>        <span class="n">rel_stats</span> <span class="o">=</span> <span class="n">rel_stats</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;player_id_sr&quot;</span><span class="p">,</span><span class="s2">&quot;position&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reference_games</span><span class="p">)</span>
</span><span id="L-982"><a href="#L-982"><span class="linenos"> 982</span></a>        <span class="n">rel_stats</span><span class="p">[</span><span class="s2">&quot;weeks_ago&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-983"><a href="#L-983"><span class="linenos"> 983</span></a>            <span class="mi">17</span> <span class="o">*</span> <span class="p">(</span><span class="n">as_of</span> <span class="o">//</span> <span class="mi">100</span> <span class="o">-</span> <span class="n">rel_stats</span><span class="o">.</span><span class="n">season</span><span class="p">)</span> <span class="o">+</span> <span class="n">as_of</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">-</span> <span class="n">rel_stats</span><span class="o">.</span><span class="n">week</span>
</span><span id="L-984"><a href="#L-984"><span class="linenos"> 984</span></a>        <span class="p">)</span>
</span><span id="L-985"><a href="#L-985"><span class="linenos"> 985</span></a>        <span class="n">rel_stats</span><span class="p">[</span><span class="s2">&quot;time_factor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">rel_stats</span><span class="o">.</span><span class="n">weeks_ago</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">basaloppstringtime</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-986"><a href="#L-986"><span class="linenos"> 986</span></a>        <span class="n">rel_stats</span> <span class="o">=</span> <span class="n">rel_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">rel_stats</span><span class="o">.</span><span class="n">time_factor</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-987"><a href="#L-987"><span class="linenos"> 987</span></a>        <span class="n">rel_stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="L-988"><a href="#L-988"><span class="linenos"> 988</span></a>            <span class="n">left</span><span class="o">=</span><span class="n">rel_stats</span><span class="p">,</span>
</span><span id="L-989"><a href="#L-989"><span class="linenos"> 989</span></a>            <span class="n">right</span><span class="o">=</span><span class="n">rel_stats</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;player_id_sr&quot;</span><span class="p">,</span><span class="s2">&quot;position&quot;</span><span class="p">])</span>
</span><span id="L-990"><a href="#L-990"><span class="linenos"> 990</span></a>            <span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s2">&quot;time_factor&quot;</span><span class="p">:</span> <span class="nb">sum</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;count&quot;</span><span class="p">})</span>
</span><span id="L-991"><a href="#L-991"><span class="linenos"> 991</span></a>            <span class="o">.</span><span class="n">rename</span><span class="p">(</span>
</span><span id="L-992"><a href="#L-992"><span class="linenos"> 992</span></a>                <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;num_games&quot;</span><span class="p">,</span> <span class="s2">&quot;time_factor&quot;</span><span class="p">:</span> <span class="s2">&quot;time_factor_sum&quot;</span><span class="p">}</span>
</span><span id="L-993"><a href="#L-993"><span class="linenos"> 993</span></a>            <span class="p">)</span>
</span><span id="L-994"><a href="#L-994"><span class="linenos"> 994</span></a>            <span class="o">.</span><span class="n">reset_index</span><span class="p">(),</span>
</span><span id="L-995"><a href="#L-995"><span class="linenos"> 995</span></a>            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">,</span>
</span><span id="L-996"><a href="#L-996"><span class="linenos"> 996</span></a>            <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;player_id_sr&quot;</span><span class="p">,</span><span class="s2">&quot;position&quot;</span><span class="p">],</span>
</span><span id="L-997"><a href="#L-997"><span class="linenos"> 997</span></a>        <span class="p">)</span>
</span><span id="L-998"><a href="#L-998"><span class="linenos"> 998</span></a>        <span class="n">rel_stats</span><span class="o">.</span><span class="n">time_factor</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-999"><a href="#L-999"><span class="linenos"> 999</span></a>            <span class="n">rel_stats</span><span class="o">.</span><span class="n">time_factor</span> <span class="o">*</span> <span class="n">rel_stats</span><span class="o">.</span><span class="n">num_games</span> <span class="o">/</span> <span class="n">rel_stats</span><span class="o">.</span><span class="n">time_factor_sum</span>
</span><span id="L-1000"><a href="#L-1000"><span class="linenos">1000</span></a>        <span class="p">)</span>
</span><span id="L-1001"><a href="#L-1001"><span class="linenos">1001</span></a>        <span class="n">rel_stats</span><span class="p">[</span><span class="s2">&quot;weighted_points&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rel_stats</span><span class="o">.</span><span class="n">rel_points</span> <span class="o">*</span> <span class="n">rel_stats</span><span class="o">.</span><span class="n">time_factor</span>
</span><span id="L-1002"><a href="#L-1002"><span class="linenos">1002</span></a>        <span class="n">by_player</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="L-1003"><a href="#L-1003"><span class="linenos">1003</span></a>            <span class="n">left</span><span class="o">=</span><span class="n">rel_stats</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;player_id_sr&quot;</span><span class="p">,</span><span class="s2">&quot;position&quot;</span><span class="p">])</span>
</span><span id="L-1004"><a href="#L-1004"><span class="linenos">1004</span></a>            <span class="o">.</span><span class="n">weighted_points</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="L-1005"><a href="#L-1005"><span class="linenos">1005</span></a>            <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="L-1006"><a href="#L-1006"><span class="linenos">1006</span></a>            <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;weighted_points&quot;</span><span class="p">:</span> <span class="s2">&quot;points_rate&quot;</span><span class="p">}),</span>
</span><span id="L-1007"><a href="#L-1007"><span class="linenos">1007</span></a>            <span class="n">right</span><span class="o">=</span><span class="n">rel_stats</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;player_id_sr&quot;</span><span class="p">,</span><span class="s2">&quot;position&quot;</span><span class="p">])</span>
</span><span id="L-1008"><a href="#L-1008"><span class="linenos">1008</span></a>            <span class="o">.</span><span class="n">weighted_points</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
</span><span id="L-1009"><a href="#L-1009"><span class="linenos">1009</span></a>            <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="L-1010"><a href="#L-1010"><span class="linenos">1010</span></a>            <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;weighted_points&quot;</span><span class="p">:</span> <span class="s2">&quot;points_stdev&quot;</span><span class="p">}),</span>
</span><span id="L-1011"><a href="#L-1011"><span class="linenos">1011</span></a>            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">,</span>
</span><span id="L-1012"><a href="#L-1012"><span class="linenos">1012</span></a>            <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;player_id_sr&quot;</span><span class="p">,</span><span class="s2">&quot;position&quot;</span><span class="p">],</span>
</span><span id="L-1013"><a href="#L-1013"><span class="linenos">1013</span></a>        <span class="p">)</span>
</span><span id="L-1014"><a href="#L-1014"><span class="linenos">1014</span></a>        <span class="n">by_player</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="L-1015"><a href="#L-1015"><span class="linenos">1015</span></a>            <span class="n">left</span><span class="o">=</span><span class="n">by_player</span><span class="p">,</span>
</span><span id="L-1016"><a href="#L-1016"><span class="linenos">1016</span></a>            <span class="n">right</span><span class="o">=</span><span class="n">rel_stats</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;player_id_sr&quot;</span><span class="p">,</span><span class="s2">&quot;position&quot;</span><span class="p">])</span>
</span><span id="L-1017"><a href="#L-1017"><span class="linenos">1017</span></a>            <span class="o">.</span><span class="n">size</span><span class="p">()</span>
</span><span id="L-1018"><a href="#L-1018"><span class="linenos">1018</span></a>            <span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s2">&quot;num_games&quot;</span><span class="p">)</span>
</span><span id="L-1019"><a href="#L-1019"><span class="linenos">1019</span></a>            <span class="o">.</span><span class="n">reset_index</span><span class="p">(),</span>
</span><span id="L-1020"><a href="#L-1020"><span class="linenos">1020</span></a>            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">,</span>
</span><span id="L-1021"><a href="#L-1021"><span class="linenos">1021</span></a>            <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;player_id_sr&quot;</span><span class="p">,</span><span class="s2">&quot;position&quot;</span><span class="p">],</span>
</span><span id="L-1022"><a href="#L-1022"><span class="linenos">1022</span></a>        <span class="p">)</span>
</span><span id="L-1023"><a href="#L-1023"><span class="linenos">1023</span></a>        <span class="n">by_player</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">by_player</span><span class="p">,</span>
</span><span id="L-1024"><a href="#L-1024"><span class="linenos">1024</span></a>            <span class="n">by_pos</span><span class="p">[[</span><span class="s2">&quot;player_id_sr&quot;</span><span class="p">,</span><span class="s2">&quot;position&quot;</span><span class="p">,</span> <span class="s2">&quot;points_rate&quot;</span><span class="p">,</span> <span class="s2">&quot;points_stdev&quot;</span><span class="p">]]],</span>
</span><span id="L-1025"><a href="#L-1025"><span class="linenos">1025</span></a>            <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-1026"><a href="#L-1026"><span class="linenos">1026</span></a>            <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-1027"><a href="#L-1027"><span class="linenos">1027</span></a>        <span class="p">)</span>
</span><span id="L-1028"><a href="#L-1028"><span class="linenos">1028</span></a>        <span class="n">by_player</span><span class="o">.</span><span class="n">points_stdev</span> <span class="o">=</span> <span class="n">by_player</span><span class="o">.</span><span class="n">points_stdev</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="L-1029"><a href="#L-1029"><span class="linenos">1029</span></a>        <span class="n">by_player</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="L-1030"><a href="#L-1030"><span class="linenos">1030</span></a>            <span class="n">left</span><span class="o">=</span><span class="n">by_player</span><span class="p">,</span>
</span><span id="L-1031"><a href="#L-1031"><span class="linenos">1031</span></a>            <span class="n">right</span><span class="o">=</span><span class="n">by_pos</span><span class="p">[[</span><span class="s2">&quot;position&quot;</span><span class="p">,</span> <span class="s2">&quot;points_rate&quot;</span><span class="p">,</span> <span class="s2">&quot;points_stdev&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
</span><span id="L-1032"><a href="#L-1032"><span class="linenos">1032</span></a>                <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;points_rate&quot;</span><span class="p">:</span> <span class="s2">&quot;pos_avg&quot;</span><span class="p">,</span> <span class="s2">&quot;points_stdev&quot;</span><span class="p">:</span> <span class="s2">&quot;pos_stdev&quot;</span><span class="p">}</span>
</span><span id="L-1033"><a href="#L-1033"><span class="linenos">1033</span></a>            <span class="p">),</span>
</span><span id="L-1034"><a href="#L-1034"><span class="linenos">1034</span></a>            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">,</span>
</span><span id="L-1035"><a href="#L-1035"><span class="linenos">1035</span></a>            <span class="n">on</span><span class="o">=</span><span class="s2">&quot;position&quot;</span><span class="p">,</span>
</span><span id="L-1036"><a href="#L-1036"><span class="linenos">1036</span></a>        <span class="p">)</span>
</span><span id="L-1037"><a href="#L-1037"><span class="linenos">1037</span></a>        <span class="n">inds</span> <span class="o">=</span> <span class="n">by_player</span><span class="o">.</span><span class="n">num_games</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">reference_games</span>
</span><span id="L-1038"><a href="#L-1038"><span class="linenos">1038</span></a>        <span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inds</span><span class="p">,</span> <span class="s2">&quot;points_squared&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-1039"><a href="#L-1039"><span class="linenos">1039</span></a>            <span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inds</span><span class="p">,</span> <span class="s2">&quot;num_games&quot;</span><span class="p">]</span>
</span><span id="L-1040"><a href="#L-1040"><span class="linenos">1040</span></a>            <span class="o">*</span> <span class="p">(</span>
</span><span id="L-1041"><a href="#L-1041"><span class="linenos">1041</span></a>                <span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inds</span><span class="p">,</span> <span class="s2">&quot;points_stdev&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="L-1042"><a href="#L-1042"><span class="linenos">1042</span></a>                <span class="o">+</span> <span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inds</span><span class="p">,</span> <span class="s2">&quot;points_rate&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="L-1043"><a href="#L-1043"><span class="linenos">1043</span></a>            <span class="p">)</span>
</span><span id="L-1044"><a href="#L-1044"><span class="linenos">1044</span></a>            <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reference_games</span> <span class="o">-</span> <span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inds</span><span class="p">,</span> <span class="s2">&quot;num_games&quot;</span><span class="p">])</span>
</span><span id="L-1045"><a href="#L-1045"><span class="linenos">1045</span></a>            <span class="o">*</span> <span class="p">(</span>
</span><span id="L-1046"><a href="#L-1046"><span class="linenos">1046</span></a>                <span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inds</span><span class="p">,</span> <span class="s2">&quot;pos_stdev&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="L-1047"><a href="#L-1047"><span class="linenos">1047</span></a>                <span class="o">+</span> <span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inds</span><span class="p">,</span> <span class="s2">&quot;pos_avg&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="L-1048"><a href="#L-1048"><span class="linenos">1048</span></a>            <span class="p">)</span>
</span><span id="L-1049"><a href="#L-1049"><span class="linenos">1049</span></a>        <span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">reference_games</span>
</span><span id="L-1050"><a href="#L-1050"><span class="linenos">1050</span></a>        <span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inds</span><span class="p">,</span> <span class="s2">&quot;points_rate&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-1051"><a href="#L-1051"><span class="linenos">1051</span></a>            <span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inds</span><span class="p">,</span> <span class="s2">&quot;num_games&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inds</span><span class="p">,</span> <span class="s2">&quot;points_rate&quot;</span><span class="p">]</span>
</span><span id="L-1052"><a href="#L-1052"><span class="linenos">1052</span></a>            <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reference_games</span> <span class="o">-</span> <span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inds</span><span class="p">,</span> <span class="s2">&quot;num_games&quot;</span><span class="p">])</span>
</span><span id="L-1053"><a href="#L-1053"><span class="linenos">1053</span></a>            <span class="o">*</span> <span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inds</span><span class="p">,</span> <span class="s2">&quot;pos_avg&quot;</span><span class="p">]</span>
</span><span id="L-1054"><a href="#L-1054"><span class="linenos">1054</span></a>        <span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">reference_games</span>
</span><span id="L-1055"><a href="#L-1055"><span class="linenos">1055</span></a>        <span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inds</span><span class="p">,</span> <span class="s2">&quot;points_stdev&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-1056"><a href="#L-1056"><span class="linenos">1056</span></a>            <span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inds</span><span class="p">,</span> <span class="s2">&quot;points_squared&quot;</span><span class="p">]</span>
</span><span id="L-1057"><a href="#L-1057"><span class="linenos">1057</span></a>            <span class="o">-</span> <span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inds</span><span class="p">,</span> <span class="s2">&quot;points_rate&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="L-1058"><a href="#L-1058"><span class="linenos">1058</span></a>        <span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span>
</span><span id="L-1059"><a href="#L-1059"><span class="linenos">1059</span></a>        <span class="n">by_player</span><span class="o">.</span><span class="n">player_id_sr</span> <span class="o">=</span> <span class="n">by_player</span><span class="o">.</span><span class="n">player_id_sr</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="L-1060"><a href="#L-1060"><span class="linenos">1060</span></a>        <span class="n">league_avg</span> <span class="o">=</span> <span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">by_player</span><span class="o">.</span><span class="n">player_id_sr</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;avg_&quot;</span><span class="p">)]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1061"><a href="#L-1061"><span class="linenos">1061</span></a>        <span class="n">league_avg</span><span class="p">[</span><span class="s1">&#39;string&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2.0</span>
</span><span id="L-1062"><a href="#L-1062"><span class="linenos">1062</span></a>        <span class="n">by_player</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="L-1063"><a href="#L-1063"><span class="linenos">1063</span></a>            <span class="n">left</span><span class="o">=</span><span class="n">by_player</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;num_games&#39;</span><span class="p">,</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>\
</span><span id="L-1064"><a href="#L-1064"><span class="linenos">1064</span></a>            <span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;player_id_sr&#39;</span><span class="p">],</span><span class="n">keep</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">,</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
</span><span id="L-1065"><a href="#L-1065"><span class="linenos">1065</span></a>            <span class="n">right</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[</span>
</span><span id="L-1066"><a href="#L-1066"><span class="linenos">1066</span></a>                <span class="p">[</span>
</span><span id="L-1067"><a href="#L-1067"><span class="linenos">1067</span></a>                    <span class="s2">&quot;player_id_sr&quot;</span><span class="p">,</span>
</span><span id="L-1068"><a href="#L-1068"><span class="linenos">1068</span></a>                    <span class="s2">&quot;player_id&quot;</span><span class="p">,</span>
</span><span id="L-1069"><a href="#L-1069"><span class="linenos">1069</span></a>                    <span class="s2">&quot;status&quot;</span><span class="p">,</span>
</span><span id="L-1070"><a href="#L-1070"><span class="linenos">1070</span></a>                    <span class="s2">&quot;fantasy_team&quot;</span><span class="p">,</span>
</span><span id="L-1071"><a href="#L-1071"><span class="linenos">1071</span></a>                    <span class="s2">&quot;current_team&quot;</span><span class="p">,</span>
</span><span id="L-1072"><a href="#L-1072"><span class="linenos">1072</span></a>                    <span class="s2">&quot;position&quot;</span><span class="p">,</span>
</span><span id="L-1073"><a href="#L-1073"><span class="linenos">1073</span></a>                    <span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span id="L-1074"><a href="#L-1074"><span class="linenos">1074</span></a>                    <span class="s2">&quot;until&quot;</span><span class="p">,</span>
</span><span id="L-1075"><a href="#L-1075"><span class="linenos">1075</span></a>                    <span class="s2">&quot;bye_week&quot;</span><span class="p">,</span>
</span><span id="L-1076"><a href="#L-1076"><span class="linenos">1076</span></a>                    <span class="s2">&quot;pct_rostered&quot;</span><span class="p">,</span>
</span><span id="L-1077"><a href="#L-1077"><span class="linenos">1077</span></a>                    <span class="s2">&quot;selected_position&quot;</span><span class="p">,</span>
</span><span id="L-1078"><a href="#L-1078"><span class="linenos">1078</span></a>                <span class="p">]</span>
</span><span id="L-1079"><a href="#L-1079"><span class="linenos">1079</span></a>            <span class="p">]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(),</span>
</span><span id="L-1080"><a href="#L-1080"><span class="linenos">1080</span></a>            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span>
</span><span id="L-1081"><a href="#L-1081"><span class="linenos">1081</span></a>            <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;player_id_sr&quot;</span><span class="p">,</span><span class="s2">&quot;position&quot;</span><span class="p">],</span>
</span><span id="L-1082"><a href="#L-1082"><span class="linenos">1082</span></a>        <span class="p">)</span>
</span><span id="L-1083"><a href="#L-1083"><span class="linenos">1083</span></a>        <span class="n">rookies</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="L-1084"><a href="#L-1084"><span class="linenos">1084</span></a>            <span class="n">left</span><span class="o">=</span><span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-1085"><a href="#L-1085"><span class="linenos">1085</span></a>                <span class="n">by_player</span><span class="o">.</span><span class="n">num_games</span><span class="o">.</span><span class="n">isnull</span><span class="p">(),</span>
</span><span id="L-1086"><a href="#L-1086"><span class="linenos">1086</span></a>                <span class="p">[</span>
</span><span id="L-1087"><a href="#L-1087"><span class="linenos">1087</span></a>                    <span class="s2">&quot;player_id_sr&quot;</span><span class="p">,</span>
</span><span id="L-1088"><a href="#L-1088"><span class="linenos">1088</span></a>                    <span class="s2">&quot;player_id&quot;</span><span class="p">,</span>
</span><span id="L-1089"><a href="#L-1089"><span class="linenos">1089</span></a>                    <span class="s2">&quot;status&quot;</span><span class="p">,</span>
</span><span id="L-1090"><a href="#L-1090"><span class="linenos">1090</span></a>                    <span class="s2">&quot;fantasy_team&quot;</span><span class="p">,</span>
</span><span id="L-1091"><a href="#L-1091"><span class="linenos">1091</span></a>                    <span class="s2">&quot;current_team&quot;</span><span class="p">,</span>
</span><span id="L-1092"><a href="#L-1092"><span class="linenos">1092</span></a>                    <span class="s2">&quot;position&quot;</span><span class="p">,</span>
</span><span id="L-1093"><a href="#L-1093"><span class="linenos">1093</span></a>                    <span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span id="L-1094"><a href="#L-1094"><span class="linenos">1094</span></a>                    <span class="s2">&quot;until&quot;</span><span class="p">,</span>
</span><span id="L-1095"><a href="#L-1095"><span class="linenos">1095</span></a>                    <span class="s2">&quot;bye_week&quot;</span><span class="p">,</span>
</span><span id="L-1096"><a href="#L-1096"><span class="linenos">1096</span></a>                    <span class="s2">&quot;pct_rostered&quot;</span><span class="p">,</span>
</span><span id="L-1097"><a href="#L-1097"><span class="linenos">1097</span></a>                    <span class="s2">&quot;selected_position&quot;</span><span class="p">,</span>
</span><span id="L-1098"><a href="#L-1098"><span class="linenos">1098</span></a>                <span class="p">],</span>
</span><span id="L-1099"><a href="#L-1099"><span class="linenos">1099</span></a>            <span class="p">],</span>
</span><span id="L-1100"><a href="#L-1100"><span class="linenos">1100</span></a>            <span class="n">right</span><span class="o">=</span><span class="n">league_avg</span><span class="p">[[</span><span class="s2">&quot;position&quot;</span><span class="p">,</span> <span class="s2">&quot;points_rate&quot;</span><span class="p">,</span> <span class="s2">&quot;points_stdev&quot;</span><span class="p">]],</span>
</span><span id="L-1101"><a href="#L-1101"><span class="linenos">1101</span></a>            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">,</span>
</span><span id="L-1102"><a href="#L-1102"><span class="linenos">1102</span></a>            <span class="n">on</span><span class="o">=</span><span class="s2">&quot;position&quot;</span><span class="p">,</span>
</span><span id="L-1103"><a href="#L-1103"><span class="linenos">1103</span></a>        <span class="p">)</span>
</span><span id="L-1104"><a href="#L-1104"><span class="linenos">1104</span></a>        <span class="n">by_player</span> <span class="o">=</span> <span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">by_player</span><span class="o">.</span><span class="n">num_games</span><span class="o">.</span><span class="n">isnull</span><span class="p">()]</span>
</span><span id="L-1105"><a href="#L-1105"><span class="linenos">1105</span></a>        <span class="n">by_player</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">by_player</span><span class="p">,</span>
</span><span id="L-1106"><a href="#L-1106"><span class="linenos">1106</span></a>            <span class="n">rookies</span><span class="p">[</span>
</span><span id="L-1107"><a href="#L-1107"><span class="linenos">1107</span></a>                <span class="p">[</span>
</span><span id="L-1108"><a href="#L-1108"><span class="linenos">1108</span></a>                    <span class="s2">&quot;player_id_sr&quot;</span><span class="p">,</span>
</span><span id="L-1109"><a href="#L-1109"><span class="linenos">1109</span></a>                    <span class="s2">&quot;player_id&quot;</span><span class="p">,</span>
</span><span id="L-1110"><a href="#L-1110"><span class="linenos">1110</span></a>                    <span class="s2">&quot;status&quot;</span><span class="p">,</span>
</span><span id="L-1111"><a href="#L-1111"><span class="linenos">1111</span></a>                    <span class="s2">&quot;fantasy_team&quot;</span><span class="p">,</span>
</span><span id="L-1112"><a href="#L-1112"><span class="linenos">1112</span></a>                    <span class="s2">&quot;current_team&quot;</span><span class="p">,</span>
</span><span id="L-1113"><a href="#L-1113"><span class="linenos">1113</span></a>                    <span class="s2">&quot;position&quot;</span><span class="p">,</span>
</span><span id="L-1114"><a href="#L-1114"><span class="linenos">1114</span></a>                    <span class="s2">&quot;points_rate&quot;</span><span class="p">,</span>
</span><span id="L-1115"><a href="#L-1115"><span class="linenos">1115</span></a>                    <span class="s2">&quot;points_stdev&quot;</span><span class="p">,</span>
</span><span id="L-1116"><a href="#L-1116"><span class="linenos">1116</span></a>                    <span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span id="L-1117"><a href="#L-1117"><span class="linenos">1117</span></a>                    <span class="s2">&quot;until&quot;</span><span class="p">,</span>
</span><span id="L-1118"><a href="#L-1118"><span class="linenos">1118</span></a>                    <span class="s2">&quot;bye_week&quot;</span><span class="p">,</span>
</span><span id="L-1119"><a href="#L-1119"><span class="linenos">1119</span></a>                    <span class="s2">&quot;pct_rostered&quot;</span><span class="p">,</span>
</span><span id="L-1120"><a href="#L-1120"><span class="linenos">1120</span></a>                    <span class="s2">&quot;selected_position&quot;</span><span class="p">,</span>
</span><span id="L-1121"><a href="#L-1121"><span class="linenos">1121</span></a>                <span class="p">]</span>
</span><span id="L-1122"><a href="#L-1122"><span class="linenos">1122</span></a>            <span class="p">],</span>
</span><span id="L-1123"><a href="#L-1123"><span class="linenos">1123</span></a>            <span class="n">league_avg</span><span class="p">],</span>
</span><span id="L-1124"><a href="#L-1124"><span class="linenos">1124</span></a>            <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-1125"><a href="#L-1125"><span class="linenos">1125</span></a>            <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-1126"><a href="#L-1126"><span class="linenos">1126</span></a>        <span class="p">)</span>
</span><span id="L-1127"><a href="#L-1127"><span class="linenos">1127</span></a>        <span class="n">by_player</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">by_player</span><span class="p">,</span><span class="n">right</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nfl_rosters</span><span class="p">[[</span><span class="s1">&#39;player_id_sr&#39;</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">]]</span>\
</span><span id="L-1128"><a href="#L-1128"><span class="linenos">1128</span></a>        <span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;player_id_sr&#39;</span><span class="p">],</span><span class="n">keep</span><span class="o">=</span><span class="s1">&#39;last&#39;</span><span class="p">),</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="s1">&#39;player_id_sr&#39;</span><span class="p">)</span>
</span><span id="L-1129"><a href="#L-1129"><span class="linenos">1129</span></a>        <span class="n">by_player</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">by_player</span><span class="p">,</span><span class="n">right</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[[</span><span class="s1">&#39;player_id&#39;</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">]]</span>\
</span><span id="L-1130"><a href="#L-1130"><span class="linenos">1130</span></a>        <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s1">&#39;yahoo_name&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(),</span><span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="s1">&#39;player_id&#39;</span><span class="p">)</span>
</span><span id="L-1131"><a href="#L-1131"><span class="linenos">1131</span></a>        <span class="n">missing</span> <span class="o">=</span> <span class="n">by_player</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">by_player</span><span class="o">.</span><span class="n">yahoo_name</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span>
</span><span id="L-1132"><a href="#L-1132"><span class="linenos">1132</span></a>        <span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">missing</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">missing</span><span class="p">,</span><span class="s1">&#39;yahoo_name&#39;</span><span class="p">]</span>
</span><span id="L-1133"><a href="#L-1133"><span class="linenos">1133</span></a>        <span class="k">del</span> <span class="n">by_player</span><span class="p">[</span><span class="s1">&#39;yahoo_name&#39;</span><span class="p">]</span>
</span><span id="L-1134"><a href="#L-1134"><span class="linenos">1134</span></a>        <span class="n">defenses</span> <span class="o">=</span> <span class="n">by_player</span><span class="o">.</span><span class="n">player_id_sr</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nfl_teams</span><span class="o">.</span><span class="n">real_abbrev</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
</span><span id="L-1135"><a href="#L-1135"><span class="linenos">1135</span></a>        <span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">defenses</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">defenses</span><span class="p">,</span><span class="s1">&#39;player_id_sr&#39;</span><span class="p">]</span>
</span><span id="L-1136"><a href="#L-1136"><span class="linenos">1136</span></a>        <span class="n">avgs</span> <span class="o">=</span> <span class="n">by_player</span><span class="o">.</span><span class="n">player_id_sr</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;avg_&quot;</span><span class="p">)</span>
</span><span id="L-1137"><a href="#L-1137"><span class="linenos">1137</span></a>        <span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">avgs</span><span class="p">,</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Average_&quot;</span> <span class="o">+</span> <span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">avgs</span><span class="p">,</span><span class="s2">&quot;position&quot;</span><span class="p">]</span>
</span><span id="L-1138"><a href="#L-1138"><span class="linenos">1138</span></a>        <span class="n">teams_as_of</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-1139"><a href="#L-1139"><span class="linenos">1139</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">season</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">week</span> <span class="o">&gt;=</span> <span class="n">as_of</span><span class="p">]</span>
</span><span id="L-1140"><a href="#L-1140"><span class="linenos">1140</span></a>            <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="s2">&quot;week&quot;</span><span class="p">],</span><span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1141"><a href="#L-1141"><span class="linenos">1141</span></a>            <span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s2">&quot;player_id_sr&quot;</span><span class="p">,</span> <span class="n">keep</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)[</span>
</span><span id="L-1142"><a href="#L-1142"><span class="linenos">1142</span></a>                <span class="p">[</span><span class="s2">&quot;player_id_sr&quot;</span><span class="p">,</span> <span class="s2">&quot;team&quot;</span><span class="p">]</span>
</span><span id="L-1143"><a href="#L-1143"><span class="linenos">1143</span></a>            <span class="p">]</span>
</span><span id="L-1144"><a href="#L-1144"><span class="linenos">1144</span></a>            <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;team&quot;</span><span class="p">:</span> <span class="s2">&quot;actual_team&quot;</span><span class="p">})</span>
</span><span id="L-1145"><a href="#L-1145"><span class="linenos">1145</span></a>        <span class="p">)</span>
</span><span id="L-1146"><a href="#L-1146"><span class="linenos">1146</span></a>        <span class="n">by_player</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="L-1147"><a href="#L-1147"><span class="linenos">1147</span></a>            <span class="n">left</span><span class="o">=</span><span class="n">by_player</span><span class="p">,</span>
</span><span id="L-1148"><a href="#L-1148"><span class="linenos">1148</span></a>            <span class="n">right</span><span class="o">=</span><span class="n">teams_as_of</span><span class="p">,</span>
</span><span id="L-1149"><a href="#L-1149"><span class="linenos">1149</span></a>            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
</span><span id="L-1150"><a href="#L-1150"><span class="linenos">1150</span></a>            <span class="n">on</span><span class="o">=</span><span class="s2">&quot;player_id_sr&quot;</span><span class="p">,</span>
</span><span id="L-1151"><a href="#L-1151"><span class="linenos">1151</span></a>        <span class="p">)</span>
</span><span id="L-1152"><a href="#L-1152"><span class="linenos">1152</span></a>        <span class="n">not_yet</span> <span class="o">=</span> <span class="o">~</span><span class="n">by_player</span><span class="o">.</span><span class="n">actual_team</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span>
</span><span id="L-1153"><a href="#L-1153"><span class="linenos">1153</span></a>        <span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">not_yet</span><span class="p">,</span><span class="s1">&#39;current_team&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">not_yet</span><span class="p">,</span><span class="s1">&#39;actual_team&#39;</span><span class="p">]</span>
</span><span id="L-1154"><a href="#L-1154"><span class="linenos">1154</span></a>        <span class="k">del</span> <span class="n">by_player</span><span class="p">[</span><span class="s1">&#39;actual_team&#39;</span><span class="p">]</span>
</span><span id="L-1155"><a href="#L-1155"><span class="linenos">1155</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span> <span class="o">=</span> <span class="n">by_player</span>
</span><span id="L-1156"><a href="#L-1156"><span class="linenos">1156</span></a>
</span><span id="L-1157"><a href="#L-1157"><span class="linenos">1157</span></a>    <span class="k">def</span> <span class="nf">get_schedule</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1158"><a href="#L-1158"><span class="linenos">1158</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1159"><a href="#L-1159"><span class="linenos">1159</span></a><span class="sd">        Pulls the fantasy schedule for the season in question as well as </span>
</span><span id="L-1160"><a href="#L-1160"><span class="linenos">1160</span></a><span class="sd">        scores for all matchups up to the week in question.</span>
</span><span id="L-1161"><a href="#L-1161"><span class="linenos">1161</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1162"><a href="#L-1162"><span class="linenos">1162</span></a>        <span class="n">as_of</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">season</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">week</span>
</span><span id="L-1163"><a href="#L-1163"><span class="linenos">1163</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_oauth</span><span class="p">()</span>
</span><span id="L-1164"><a href="#L-1164"><span class="linenos">1164</span></a>        <span class="n">schedule</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="L-1165"><a href="#L-1165"><span class="linenos">1165</span></a>        <span class="k">for</span> <span class="n">team</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">teams</span><span class="p">:</span>
</span><span id="L-1166"><a href="#L-1166"><span class="linenos">1166</span></a>            <span class="n">tm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lg</span><span class="o">.</span><span class="n">to_team</span><span class="p">(</span><span class="n">team</span><span class="p">[</span><span class="s2">&quot;team_key&quot;</span><span class="p">])</span>
</span><span id="L-1167"><a href="#L-1167"><span class="linenos">1167</span></a>            <span class="n">limit</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-1168"><a href="#L-1168"><span class="linenos">1168</span></a>                <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;playoff_start_week&quot;</span><span class="p">],</span> <span class="n">as_of</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-1169"><a href="#L-1169"><span class="linenos">1169</span></a>                <span class="k">if</span> <span class="n">as_of</span>
</span><span id="L-1170"><a href="#L-1170"><span class="linenos">1170</span></a>                <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;playoff_start_week&quot;</span><span class="p">]</span>
</span><span id="L-1171"><a href="#L-1171"><span class="linenos">1171</span></a>            <span class="p">)</span>
</span><span id="L-1172"><a href="#L-1172"><span class="linenos">1172</span></a>            <span class="k">for</span> <span class="n">week</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">limit</span><span class="p">):</span>
</span><span id="L-1173"><a href="#L-1173"><span class="linenos">1173</span></a>                <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="L-1174"><a href="#L-1174"><span class="linenos">1174</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="L-1175"><a href="#L-1175"><span class="linenos">1175</span></a>                        <span class="n">matchup</span> <span class="o">=</span> <span class="n">tm</span><span class="o">.</span><span class="n">yhandler</span><span class="o">.</span><span class="n">get_matchup_raw</span><span class="p">(</span><span class="n">tm</span><span class="o">.</span><span class="n">team_key</span><span class="p">,</span> <span class="n">week</span><span class="p">)</span>
</span><span id="L-1176"><a href="#L-1176"><span class="linenos">1176</span></a>                        <span class="n">matchup</span> <span class="o">=</span> <span class="n">matchup</span><span class="p">[</span><span class="s2">&quot;fantasy_content&quot;</span><span class="p">][</span><span class="s2">&quot;team&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;matchups&quot;</span><span class="p">]</span>
</span><span id="L-1177"><a href="#L-1177"><span class="linenos">1177</span></a>                        <span class="k">break</span>
</span><span id="L-1178"><a href="#L-1178"><span class="linenos">1178</span></a>                    <span class="k">except</span><span class="p">:</span>
</span><span id="L-1179"><a href="#L-1179"><span class="linenos">1179</span></a>                        <span class="nb">print</span><span class="p">(</span>
</span><span id="L-1180"><a href="#L-1180"><span class="linenos">1180</span></a>                            <span class="s2">&quot;Matchup query crapped out... Waiting 30 seconds and trying again...&quot;</span>
</span><span id="L-1181"><a href="#L-1181"><span class="linenos">1181</span></a>                        <span class="p">)</span>
</span><span id="L-1182"><a href="#L-1182"><span class="linenos">1182</span></a>                        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
</span><span id="L-1183"><a href="#L-1183"><span class="linenos">1183</span></a>                <span class="k">if</span> <span class="s2">&quot;0&quot;</span> <span class="ow">in</span> <span class="n">matchup</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="L-1184"><a href="#L-1184"><span class="linenos">1184</span></a>                    <span class="n">team_1</span> <span class="o">=</span> <span class="n">matchup</span><span class="p">[</span><span class="s2">&quot;0&quot;</span><span class="p">][</span><span class="s2">&quot;matchup&quot;</span><span class="p">][</span><span class="s2">&quot;0&quot;</span><span class="p">][</span><span class="s2">&quot;teams&quot;</span><span class="p">][</span><span class="s2">&quot;0&quot;</span><span class="p">][</span><span class="s2">&quot;team&quot;</span><span class="p">]</span>
</span><span id="L-1185"><a href="#L-1185"><span class="linenos">1185</span></a>                    <span class="n">team_2</span> <span class="o">=</span> <span class="n">matchup</span><span class="p">[</span><span class="s2">&quot;0&quot;</span><span class="p">][</span><span class="s2">&quot;matchup&quot;</span><span class="p">][</span><span class="s2">&quot;0&quot;</span><span class="p">][</span><span class="s2">&quot;teams&quot;</span><span class="p">][</span><span class="s2">&quot;1&quot;</span><span class="p">][</span><span class="s2">&quot;team&quot;</span><span class="p">]</span>
</span><span id="L-1186"><a href="#L-1186"><span class="linenos">1186</span></a>                    <span class="n">schedule</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">schedule</span><span class="p">,</span>
</span><span id="L-1187"><a href="#L-1187"><span class="linenos">1187</span></a>                        <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span><span id="L-1188"><a href="#L-1188"><span class="linenos">1188</span></a>                            <span class="p">{</span>
</span><span id="L-1189"><a href="#L-1189"><span class="linenos">1189</span></a>                                <span class="s2">&quot;week&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">week</span><span class="p">],</span>
</span><span id="L-1190"><a href="#L-1190"><span class="linenos">1190</span></a>                                <span class="s2">&quot;team_1&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">team_1</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]],</span>
</span><span id="L-1191"><a href="#L-1191"><span class="linenos">1191</span></a>                                <span class="s2">&quot;team_2&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">team_2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]],</span>
</span><span id="L-1192"><a href="#L-1192"><span class="linenos">1192</span></a>                                <span class="s2">&quot;score_1&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">team_1</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;team_points&quot;</span><span class="p">][</span><span class="s2">&quot;total&quot;</span><span class="p">]],</span>
</span><span id="L-1193"><a href="#L-1193"><span class="linenos">1193</span></a>                                <span class="s2">&quot;score_2&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">team_2</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;team_points&quot;</span><span class="p">][</span><span class="s2">&quot;total&quot;</span><span class="p">]],</span>
</span><span id="L-1194"><a href="#L-1194"><span class="linenos">1194</span></a>                            <span class="p">}</span>
</span><span id="L-1195"><a href="#L-1195"><span class="linenos">1195</span></a>                        <span class="p">)],</span>
</span><span id="L-1196"><a href="#L-1196"><span class="linenos">1196</span></a>                        <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-1197"><a href="#L-1197"><span class="linenos">1197</span></a>                    <span class="p">)</span>
</span><span id="L-1198"><a href="#L-1198"><span class="linenos">1198</span></a>        <span class="n">schedule</span><span class="o">.</span><span class="n">score_1</span> <span class="o">=</span> <span class="n">schedule</span><span class="o">.</span><span class="n">score_1</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="L-1199"><a href="#L-1199"><span class="linenos">1199</span></a>        <span class="n">schedule</span><span class="o">.</span><span class="n">score_2</span> <span class="o">=</span> <span class="n">schedule</span><span class="o">.</span><span class="n">score_2</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="L-1200"><a href="#L-1200"><span class="linenos">1200</span></a>
</span><span id="L-1201"><a href="#L-1201"><span class="linenos">1201</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; MANY MILE POSTSEASON &quot;&quot;&quot;</span>
</span><span id="L-1202"><a href="#L-1202"><span class="linenos">1202</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;res/football/many_mile.csv&quot;</span><span class="p">):</span>
</span><span id="L-1203"><a href="#L-1203"><span class="linenos">1203</span></a>            <span class="n">many_mile_sched</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;res/football/many_mile.csv&quot;</span><span class="p">)</span>
</span><span id="L-1204"><a href="#L-1204"><span class="linenos">1204</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1205"><a href="#L-1205"><span class="linenos">1205</span></a>            <span class="n">many_mile_sched</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">,</span> <span class="s2">&quot;week&quot;</span><span class="p">])</span>
</span><span id="L-1206"><a href="#L-1206"><span class="linenos">1206</span></a>        <span class="n">algo</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-1207"><a href="#L-1207"><span class="linenos">1207</span></a>            <span class="n">schedule</span><span class="o">.</span><span class="n">team_1</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;The Algorithm&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
</span><span id="L-1208"><a href="#L-1208"><span class="linenos">1208</span></a>            <span class="ow">or</span> <span class="n">schedule</span><span class="o">.</span><span class="n">team_2</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;The Algorithm&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
</span><span id="L-1209"><a href="#L-1209"><span class="linenos">1209</span></a>        <span class="p">)</span>
</span><span id="L-1210"><a href="#L-1210"><span class="linenos">1210</span></a>        <span class="k">if</span> <span class="n">as_of</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;playoff_start_week&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">algo</span><span class="p">:</span>
</span><span id="L-1211"><a href="#L-1211"><span class="linenos">1211</span></a>            <span class="n">many_mile_sched</span> <span class="o">=</span> <span class="n">many_mile_sched</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-1212"><a href="#L-1212"><span class="linenos">1212</span></a>                <span class="p">(</span><span class="n">many_mile_sched</span><span class="o">.</span><span class="n">season</span> <span class="o">==</span> <span class="n">as_of</span> <span class="o">//</span> <span class="mi">100</span><span class="p">)</span>
</span><span id="L-1213"><a href="#L-1213"><span class="linenos">1213</span></a>                <span class="o">&amp;</span> <span class="p">(</span><span class="n">many_mile_sched</span><span class="o">.</span><span class="n">week</span> <span class="o">&lt;=</span> <span class="n">as_of</span> <span class="o">%</span> <span class="mi">100</span><span class="p">)</span>
</span><span id="L-1214"><a href="#L-1214"><span class="linenos">1214</span></a>            <span class="p">]</span>
</span><span id="L-1215"><a href="#L-1215"><span class="linenos">1215</span></a>            <span class="k">del</span> <span class="n">many_mile_sched</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">]</span>
</span><span id="L-1216"><a href="#L-1216"><span class="linenos">1216</span></a>            <span class="n">many_mile_sched</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">many_mile_sched</span><span class="o">.</span><span class="n">week</span> <span class="o">==</span> <span class="n">as_of</span> <span class="o">%</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;score_1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-1217"><a href="#L-1217"><span class="linenos">1217</span></a>            <span class="n">many_mile_sched</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">many_mile_sched</span><span class="o">.</span><span class="n">week</span> <span class="o">==</span> <span class="n">as_of</span> <span class="o">%</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;score_2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-1218"><a href="#L-1218"><span class="linenos">1218</span></a>            <span class="n">standings</span> <span class="o">=</span> <span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-1219"><a href="#L-1219"><span class="linenos">1219</span></a>                <span class="n">schedule</span><span class="o">.</span><span class="n">week</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;playoff_start_week&quot;</span><span class="p">]</span>
</span><span id="L-1220"><a href="#L-1220"><span class="linenos">1220</span></a>            <span class="p">]</span>
</span><span id="L-1221"><a href="#L-1221"><span class="linenos">1221</span></a>            <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;win_1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">standings</span><span class="o">.</span><span class="n">score_1</span> <span class="o">&gt;</span> <span class="n">standings</span><span class="o">.</span><span class="n">score_2</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="L-1222"><a href="#L-1222"><span class="linenos">1222</span></a>            <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;win_2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">standings</span><span class="o">.</span><span class="n">win_1</span>
</span><span id="L-1223"><a href="#L-1223"><span class="linenos">1223</span></a>            <span class="n">standings</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">standings</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
</span><span id="L-1224"><a href="#L-1224"><span class="linenos">1224</span></a>                <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">col</span><span class="p">:</span> <span class="n">col</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_1&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">standings</span><span class="o">.</span><span class="n">columns</span><span class="p">}</span>
</span><span id="L-1225"><a href="#L-1225"><span class="linenos">1225</span></a>            <span class="p">),</span>
</span><span id="L-1226"><a href="#L-1226"><span class="linenos">1226</span></a>                <span class="n">standings</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
</span><span id="L-1227"><a href="#L-1227"><span class="linenos">1227</span></a>                    <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">col</span><span class="p">:</span> <span class="n">col</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_2&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">standings</span><span class="o">.</span><span class="n">columns</span><span class="p">}</span>
</span><span id="L-1228"><a href="#L-1228"><span class="linenos">1228</span></a>                <span class="p">)],</span>
</span><span id="L-1229"><a href="#L-1229"><span class="linenos">1229</span></a>                <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-1230"><a href="#L-1230"><span class="linenos">1230</span></a>                <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-1231"><a href="#L-1231"><span class="linenos">1231</span></a>            <span class="p">)</span>
</span><span id="L-1232"><a href="#L-1232"><span class="linenos">1232</span></a>            <span class="n">standings</span> <span class="o">=</span> <span class="n">standings</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;team&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="L-1233"><a href="#L-1233"><span class="linenos">1233</span></a>            <span class="n">standings</span> <span class="o">=</span> <span class="n">standings</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
</span><span id="L-1234"><a href="#L-1234"><span class="linenos">1234</span></a>                <span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;win&quot;</span><span class="p">,</span> <span class="s2">&quot;score&quot;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span>
</span><span id="L-1235"><a href="#L-1235"><span class="linenos">1235</span></a>            <span class="p">)</span>
</span><span id="L-1236"><a href="#L-1236"><span class="linenos">1236</span></a>            <span class="n">consolation</span> <span class="o">=</span> <span class="n">standings</span><span class="o">.</span><span class="n">team</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">6</span><span class="p">:]</span>
</span><span id="L-1237"><a href="#L-1237"><span class="linenos">1237</span></a>            <span class="n">schedule</span> <span class="o">=</span> <span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-1238"><a href="#L-1238"><span class="linenos">1238</span></a>                <span class="p">(</span><span class="n">schedule</span><span class="o">.</span><span class="n">week</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;playoff_start_week&quot;</span><span class="p">])</span>
</span><span id="L-1239"><a href="#L-1239"><span class="linenos">1239</span></a>                <span class="o">|</span> <span class="o">~</span><span class="n">schedule</span><span class="o">.</span><span class="n">team_1</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">consolation</span><span class="p">)</span>
</span><span id="L-1240"><a href="#L-1240"><span class="linenos">1240</span></a>            <span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1241"><a href="#L-1241"><span class="linenos">1241</span></a>            <span class="n">schedule</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">schedule</span><span class="p">,</span>
</span><span id="L-1242"><a href="#L-1242"><span class="linenos">1242</span></a>                <span class="n">many_mile_sched</span><span class="p">],</span>
</span><span id="L-1243"><a href="#L-1243"><span class="linenos">1243</span></a>                <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-1244"><a href="#L-1244"><span class="linenos">1244</span></a>                <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-1245"><a href="#L-1245"><span class="linenos">1245</span></a>            <span class="p">)</span>
</span><span id="L-1246"><a href="#L-1246"><span class="linenos">1246</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; MANY MILE POSTSEASON &quot;&quot;&quot;</span>
</span><span id="L-1247"><a href="#L-1247"><span class="linenos">1247</span></a>
</span><span id="L-1248"><a href="#L-1248"><span class="linenos">1248</span></a>        <span class="n">switch</span> <span class="o">=</span> <span class="n">schedule</span><span class="o">.</span><span class="n">team_1</span> <span class="o">&gt;</span> <span class="n">schedule</span><span class="o">.</span><span class="n">team_2</span>
</span><span id="L-1249"><a href="#L-1249"><span class="linenos">1249</span></a>        <span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">switch</span><span class="p">,</span> <span class="s2">&quot;temp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">switch</span><span class="p">,</span> <span class="s2">&quot;team_1&quot;</span><span class="p">]</span>
</span><span id="L-1250"><a href="#L-1250"><span class="linenos">1250</span></a>        <span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">switch</span><span class="p">,</span> <span class="s2">&quot;team_1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">switch</span><span class="p">,</span> <span class="s2">&quot;team_2&quot;</span><span class="p">]</span>
</span><span id="L-1251"><a href="#L-1251"><span class="linenos">1251</span></a>        <span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">switch</span><span class="p">,</span> <span class="s2">&quot;team_2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">switch</span><span class="p">,</span> <span class="s2">&quot;temp&quot;</span><span class="p">]</span>
</span><span id="L-1252"><a href="#L-1252"><span class="linenos">1252</span></a>        <span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">switch</span><span class="p">,</span> <span class="s2">&quot;temp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">switch</span><span class="p">,</span> <span class="s2">&quot;score_1&quot;</span><span class="p">]</span>
</span><span id="L-1253"><a href="#L-1253"><span class="linenos">1253</span></a>        <span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">switch</span><span class="p">,</span> <span class="s2">&quot;score_1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">switch</span><span class="p">,</span> <span class="s2">&quot;score_2&quot;</span><span class="p">]</span>
</span><span id="L-1254"><a href="#L-1254"><span class="linenos">1254</span></a>        <span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">switch</span><span class="p">,</span> <span class="s2">&quot;score_2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">switch</span><span class="p">,</span> <span class="s2">&quot;temp&quot;</span><span class="p">]</span>
</span><span id="L-1255"><a href="#L-1255"><span class="linenos">1255</span></a>        <span class="n">schedule</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-1256"><a href="#L-1256"><span class="linenos">1256</span></a>            <span class="n">schedule</span><span class="p">[[</span><span class="s2">&quot;week&quot;</span><span class="p">,</span> <span class="s2">&quot;team_1&quot;</span><span class="p">,</span> <span class="s2">&quot;team_2&quot;</span><span class="p">,</span> <span class="s2">&quot;score_1&quot;</span><span class="p">,</span> <span class="s2">&quot;score_2&quot;</span><span class="p">]]</span>
</span><span id="L-1257"><a href="#L-1257"><span class="linenos">1257</span></a>            <span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
</span><span id="L-1258"><a href="#L-1258"><span class="linenos">1258</span></a>            <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;week&quot;</span><span class="p">,</span> <span class="s2">&quot;team_1&quot;</span><span class="p">,</span> <span class="s2">&quot;team_2&quot;</span><span class="p">])</span>
</span><span id="L-1259"><a href="#L-1259"><span class="linenos">1259</span></a>            <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1260"><a href="#L-1260"><span class="linenos">1260</span></a>        <span class="p">)</span>
</span><span id="L-1261"><a href="#L-1261"><span class="linenos">1261</span></a>        <span class="n">team_name</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-1262"><a href="#L-1262"><span class="linenos">1262</span></a>            <span class="n">team</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
</span><span id="L-1263"><a href="#L-1263"><span class="linenos">1263</span></a>            <span class="k">for</span> <span class="n">team</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">teams</span>
</span><span id="L-1264"><a href="#L-1264"><span class="linenos">1264</span></a>            <span class="k">if</span> <span class="n">team</span><span class="p">[</span><span class="s2">&quot;team_key&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">lg</span><span class="o">.</span><span class="n">team_key</span><span class="p">()</span>
</span><span id="L-1265"><a href="#L-1265"><span class="linenos">1265</span></a>        <span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-1266"><a href="#L-1266"><span class="linenos">1266</span></a>        <span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;me&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;team_1&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">team_name</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span>
</span><span id="L-1267"><a href="#L-1267"><span class="linenos">1267</span></a>            <span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;team_2&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">team_name</span>
</span><span id="L-1268"><a href="#L-1268"><span class="linenos">1268</span></a>        <span class="p">)</span>
</span><span id="L-1269"><a href="#L-1269"><span class="linenos">1269</span></a>        <span class="k">if</span> <span class="n">as_of</span><span class="p">:</span>
</span><span id="L-1270"><a href="#L-1270"><span class="linenos">1270</span></a>            <span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">schedule</span><span class="o">.</span><span class="n">week</span> <span class="o">&gt;</span> <span class="n">as_of</span> <span class="o">%</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;score_1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-1271"><a href="#L-1271"><span class="linenos">1271</span></a>            <span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">schedule</span><span class="o">.</span><span class="n">week</span> <span class="o">&gt;</span> <span class="n">as_of</span> <span class="o">%</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;score_2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-1272"><a href="#L-1272"><span class="linenos">1272</span></a>            <span class="k">if</span> <span class="p">(</span>
</span><span id="L-1273"><a href="#L-1273"><span class="linenos">1273</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">latest_season</span> <span class="o">&gt;</span> <span class="n">as_of</span> <span class="o">//</span> <span class="mi">100</span>
</span><span id="L-1274"><a href="#L-1274"><span class="linenos">1274</span></a>                <span class="ow">or</span> <span class="n">as_of</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_week</span>
</span><span id="L-1275"><a href="#L-1275"><span class="linenos">1275</span></a>            <span class="p">):</span>
</span><span id="L-1276"><a href="#L-1276"><span class="linenos">1276</span></a>                <span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">schedule</span><span class="o">.</span><span class="n">week</span> <span class="o">==</span> <span class="n">as_of</span> <span class="o">%</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;score_1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-1277"><a href="#L-1277"><span class="linenos">1277</span></a>                <span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">schedule</span><span class="o">.</span><span class="n">week</span> <span class="o">==</span> <span class="n">as_of</span> <span class="o">%</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;score_2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-1278"><a href="#L-1278"><span class="linenos">1278</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span> <span class="o">=</span> <span class="n">schedule</span>
</span><span id="L-1279"><a href="#L-1279"><span class="linenos">1279</span></a>
</span><span id="L-1280"><a href="#L-1280"><span class="linenos">1280</span></a>    <span class="k">def</span> <span class="nf">starters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">week</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="L-1281"><a href="#L-1281"><span class="linenos">1281</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1282"><a href="#L-1282"><span class="linenos">1282</span></a><span class="sd">        Identifies which players should be started on each fantasy team </span>
</span><span id="L-1283"><a href="#L-1283"><span class="linenos">1283</span></a><span class="sd">        based on fantasy point projections and available roster spots.</span>
</span><span id="L-1284"><a href="#L-1284"><span class="linenos">1284</span></a>
</span><span id="L-1285"><a href="#L-1285"><span class="linenos">1285</span></a><span class="sd">        Args:</span>
</span><span id="L-1286"><a href="#L-1286"><span class="linenos">1286</span></a><span class="sd">            week (int, optional): week for which to identify starters.</span>
</span><span id="L-1287"><a href="#L-1287"><span class="linenos">1287</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1288"><a href="#L-1288"><span class="linenos">1288</span></a>        <span class="n">as_of</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">season</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">week</span>
</span><span id="L-1289"><a href="#L-1289"><span class="linenos">1289</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_oauth</span><span class="p">()</span>
</span><span id="L-1290"><a href="#L-1290"><span class="linenos">1290</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="L-1291"><a href="#L-1291"><span class="linenos">1291</span></a>            <span class="n">left</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">,</span>
</span><span id="L-1292"><a href="#L-1292"><span class="linenos">1292</span></a>            <span class="n">right</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nfl_schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-1293"><a href="#L-1293"><span class="linenos">1293</span></a>                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nfl_schedule</span><span class="o">.</span><span class="n">season</span> <span class="o">==</span> <span class="n">as_of</span> <span class="o">//</span> <span class="mi">100</span><span class="p">)</span>
</span><span id="L-1294"><a href="#L-1294"><span class="linenos">1294</span></a>                <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nfl_schedule</span><span class="o">.</span><span class="n">week</span> <span class="o">==</span> <span class="n">week</span><span class="p">),</span>
</span><span id="L-1295"><a href="#L-1295"><span class="linenos">1295</span></a>                <span class="p">[</span><span class="s2">&quot;team&quot;</span><span class="p">,</span> <span class="s2">&quot;elo_diff&quot;</span><span class="p">],</span>
</span><span id="L-1296"><a href="#L-1296"><span class="linenos">1296</span></a>            <span class="p">],</span>
</span><span id="L-1297"><a href="#L-1297"><span class="linenos">1297</span></a>            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
</span><span id="L-1298"><a href="#L-1298"><span class="linenos">1298</span></a>            <span class="n">left_on</span><span class="o">=</span><span class="s2">&quot;current_team&quot;</span><span class="p">,</span>
</span><span id="L-1299"><a href="#L-1299"><span class="linenos">1299</span></a>            <span class="n">right_on</span><span class="o">=</span><span class="s2">&quot;team&quot;</span><span class="p">,</span>
</span><span id="L-1300"><a href="#L-1300"><span class="linenos">1300</span></a>        <span class="p">)</span>
</span><span id="L-1301"><a href="#L-1301"><span class="linenos">1301</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">elo_diff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">elo_diff</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="L-1302"><a href="#L-1302"><span class="linenos">1302</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[</span><span class="s2">&quot;opp_factor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">basaloppstringtime</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[</span><span class="s2">&quot;elo_diff&quot;</span><span class="p">])</span>
</span><span id="L-1303"><a href="#L-1303"><span class="linenos">1303</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[</span><span class="s2">&quot;string_factor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">basaloppstringtime</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[</span><span class="s2">&quot;string&quot;</span><span class="p">])</span>
</span><span id="L-1304"><a href="#L-1304"><span class="linenos">1304</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[</span><span class="s2">&quot;game_factor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-1305"><a href="#L-1305"><span class="linenos">1305</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">basaloppstringtime</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-1306"><a href="#L-1306"><span class="linenos">1306</span></a>            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[</span><span class="s2">&quot;opp_factor&quot;</span><span class="p">]</span>
</span><span id="L-1307"><a href="#L-1307"><span class="linenos">1307</span></a>            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[</span><span class="s2">&quot;string_factor&quot;</span><span class="p">]</span>
</span><span id="L-1308"><a href="#L-1308"><span class="linenos">1308</span></a>        <span class="p">)</span>
</span><span id="L-1309"><a href="#L-1309"><span class="linenos">1309</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[</span><span class="s2">&quot;points_avg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[</span><span class="s2">&quot;points_rate&quot;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[</span><span class="s2">&quot;game_factor&quot;</span><span class="p">]</span><span class="c1">#.fillna(1.0)</span>
</span><span id="L-1310"><a href="#L-1310"><span class="linenos">1310</span></a>        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[</span><span class="s2">&quot;team&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[</span><span class="s2">&quot;elo_diff&quot;</span><span class="p">]</span>
</span><span id="L-1311"><a href="#L-1311"><span class="linenos">1311</span></a>        <span class="c1"># WAR is linear with points_avg, but slope/intercept depends on position</span>
</span><span id="L-1312"><a href="#L-1312"><span class="linenos">1312</span></a>        <span class="c1"># Harder to characterize how WAR varies with points_stdev, ignoring for now...</span>
</span><span id="L-1313"><a href="#L-1313"><span class="linenos">1313</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;points_avg&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-1314"><a href="#L-1314"><span class="linenos">1314</span></a>        <span class="c1"># self.players = self.players.sort_values(by=&#39;WAR&#39;,ascending=False)</span>
</span><span id="L-1315"><a href="#L-1315"><span class="linenos">1315</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[</span><span class="s2">&quot;starter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-1316"><a href="#L-1316"><span class="linenos">1316</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[</span><span class="s2">&quot;injured&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">until</span> <span class="o">&gt;=</span> <span class="n">week</span>
</span><span id="L-1317"><a href="#L-1317"><span class="linenos">1317</span></a>        <span class="k">if</span> <span class="p">(</span>
</span><span id="L-1318"><a href="#L-1318"><span class="linenos">1318</span></a>            <span class="n">week</span> <span class="o">==</span> <span class="n">as_of</span> <span class="o">%</span> <span class="mi">100</span>
</span><span id="L-1319"><a href="#L-1319"><span class="linenos">1319</span></a>            <span class="ow">and</span> <span class="n">as_of</span> <span class="o">//</span> <span class="mi">100</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">latest_season</span>
</span><span id="L-1320"><a href="#L-1320"><span class="linenos">1320</span></a>            <span class="ow">and</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">month</span> <span class="o">&gt;</span> <span class="mi">8</span>
</span><span id="L-1321"><a href="#L-1321"><span class="linenos">1321</span></a>        <span class="p">):</span>  <span class="c1"># Careful when your draft is in September...</span>
</span><span id="L-1322"><a href="#L-1322"><span class="linenos">1322</span></a>            <span class="n">cutoff</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span id="L-1323"><a href="#L-1323"><span class="linenos">1323</span></a>            <span class="k">if</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">hour</span> <span class="o">&lt;</span> <span class="mi">20</span><span class="p">:</span>
</span><span id="L-1324"><a href="#L-1324"><span class="linenos">1324</span></a>                <span class="n">cutoff</span> <span class="o">-=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-1325"><a href="#L-1325"><span class="linenos">1325</span></a>            <span class="n">completed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nfl_schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-1326"><a href="#L-1326"><span class="linenos">1326</span></a>                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nfl_schedule</span><span class="o">.</span><span class="n">season</span> <span class="o">==</span> <span class="n">as_of</span> <span class="o">//</span> <span class="mi">100</span><span class="p">)</span>
</span><span id="L-1327"><a href="#L-1327"><span class="linenos">1327</span></a>                <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nfl_schedule</span><span class="o">.</span><span class="n">week</span> <span class="o">==</span> <span class="n">week</span><span class="p">)</span>
</span><span id="L-1328"><a href="#L-1328"><span class="linenos">1328</span></a>                <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nfl_schedule</span><span class="o">.</span><span class="n">date</span> <span class="o">&lt;</span> <span class="n">cutoff</span><span class="p">),</span>
</span><span id="L-1329"><a href="#L-1329"><span class="linenos">1329</span></a>                <span class="s2">&quot;team&quot;</span><span class="p">,</span>
</span><span id="L-1330"><a href="#L-1330"><span class="linenos">1330</span></a>            <span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="L-1331"><a href="#L-1331"><span class="linenos">1331</span></a>            <span class="k">for</span> <span class="n">team</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">teams</span><span class="p">:</span>
</span><span id="L-1332"><a href="#L-1332"><span class="linenos">1332</span></a>                <span class="n">started</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-1333"><a href="#L-1333"><span class="linenos">1333</span></a>                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">selected_position</span> <span class="o">!=</span> <span class="s2">&quot;BN&quot;</span><span class="p">)</span>
</span><span id="L-1334"><a href="#L-1334"><span class="linenos">1334</span></a>                    <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">fantasy_team</span> <span class="o">==</span> <span class="n">team</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>
</span><span id="L-1335"><a href="#L-1335"><span class="linenos">1335</span></a>                    <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">current_team</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">completed</span><span class="p">)</span>
</span><span id="L-1336"><a href="#L-1336"><span class="linenos">1336</span></a>                <span class="p">]</span>
</span><span id="L-1337"><a href="#L-1337"><span class="linenos">1337</span></a>                <span class="n">not_available</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-1338"><a href="#L-1338"><span class="linenos">1338</span></a>                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">selected_position</span> <span class="o">==</span> <span class="s2">&quot;BN&quot;</span><span class="p">)</span>
</span><span id="L-1339"><a href="#L-1339"><span class="linenos">1339</span></a>                    <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">fantasy_team</span> <span class="o">==</span> <span class="n">team</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>
</span><span id="L-1340"><a href="#L-1340"><span class="linenos">1340</span></a>                    <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">current_team</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">completed</span><span class="p">)</span>
</span><span id="L-1341"><a href="#L-1341"><span class="linenos">1341</span></a>                <span class="p">]</span>
</span><span id="L-1342"><a href="#L-1342"><span class="linenos">1342</span></a>                <span class="n">lineup</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">roster_spots</span><span class="p">,</span><span class="n">right</span><span class="o">=</span><span class="n">started</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;selected_position&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>\
</span><span id="L-1343"><a href="#L-1343"><span class="linenos">1343</span></a>                <span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;num_started&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;selected_position&#39;</span><span class="p">:</span><span class="s1">&#39;position&#39;</span><span class="p">}),</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="s1">&#39;position&#39;</span><span class="p">)</span>
</span><span id="L-1344"><a href="#L-1344"><span class="linenos">1344</span></a>                <span class="n">lineup</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="o">-=</span> <span class="n">lineup</span><span class="o">.</span><span class="n">num_started</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="L-1345"><a href="#L-1345"><span class="linenos">1345</span></a>                <span class="n">num_pos</span> <span class="o">=</span> <span class="n">lineup</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">lineup</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;W/T&quot;</span><span class="p">,</span> <span class="s2">&quot;W/R/T&quot;</span><span class="p">,</span> <span class="s2">&quot;Q/W/R/T&quot;</span><span class="p">,</span> <span class="s2">&quot;BN&quot;</span><span class="p">,</span> <span class="s2">&quot;IR&quot;</span><span class="p">])]</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;position&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span>
</span><span id="L-1346"><a href="#L-1346"><span class="linenos">1346</span></a>                <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">num_pos</span><span class="p">:</span>
</span><span id="L-1347"><a href="#L-1347"><span class="linenos">1347</span></a>                    <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">num_pos</span><span class="p">[</span><span class="n">pos</span><span class="p">])):</span>
</span><span id="L-1348"><a href="#L-1348"><span class="linenos">1348</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-1349"><a href="#L-1349"><span class="linenos">1349</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-1350"><a href="#L-1350"><span class="linenos">1350</span></a>                                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">fantasy_team</span> <span class="o">==</span> <span class="n">team</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>
</span><span id="L-1351"><a href="#L-1351"><span class="linenos">1351</span></a>                                <span class="o">&amp;</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">starter</span>
</span><span id="L-1352"><a href="#L-1352"><span class="linenos">1352</span></a>                                <span class="o">&amp;</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">injured</span>
</span><span id="L-1353"><a href="#L-1353"><span class="linenos">1353</span></a>                                <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">bye_week</span> <span class="o">!=</span> <span class="n">week</span><span class="p">)</span>
</span><span id="L-1354"><a href="#L-1354"><span class="linenos">1354</span></a>                                <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">position</span> <span class="o">==</span> <span class="n">pos</span><span class="p">)</span>
</span><span id="L-1355"><a href="#L-1355"><span class="linenos">1355</span></a>                                <span class="o">&amp;</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">player_id</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">started</span><span class="o">.</span><span class="n">player_id</span><span class="p">)</span>
</span><span id="L-1356"><a href="#L-1356"><span class="linenos">1356</span></a>                                <span class="o">&amp;</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">player_id</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">not_available</span><span class="o">.</span><span class="n">player_id</span><span class="p">)</span>
</span><span id="L-1357"><a href="#L-1357"><span class="linenos">1357</span></a>                            <span class="p">]</span>
</span><span id="L-1358"><a href="#L-1358"><span class="linenos">1358</span></a>                            <span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-1359"><a href="#L-1359"><span class="linenos">1359</span></a>                            <span class="o">.</span><span class="n">index</span><span class="p">,</span>
</span><span id="L-1360"><a href="#L-1360"><span class="linenos">1360</span></a>                            <span class="s2">&quot;starter&quot;</span><span class="p">,</span>
</span><span id="L-1361"><a href="#L-1361"><span class="linenos">1361</span></a>                        <span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-1362"><a href="#L-1362"><span class="linenos">1362</span></a>                <span class="n">flex_pos</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;W/T&quot;</span><span class="p">:[</span><span class="s1">&#39;WR&#39;</span><span class="p">,</span><span class="s1">&#39;TE&#39;</span><span class="p">],</span><span class="s2">&quot;W/R/T&quot;</span><span class="p">:[</span><span class="s1">&#39;WR&#39;</span><span class="p">,</span><span class="s1">&#39;RB&#39;</span><span class="p">,</span><span class="s1">&#39;TE&#39;</span><span class="p">],</span><span class="s2">&quot;Q/W/R/T&quot;</span><span class="p">:[</span><span class="s1">&#39;WR&#39;</span><span class="p">,</span><span class="s1">&#39;RB&#39;</span><span class="p">,</span><span class="s1">&#39;TE&#39;</span><span class="p">,</span><span class="s1">&#39;QB&#39;</span><span class="p">]}</span>
</span><span id="L-1363"><a href="#L-1363"><span class="linenos">1363</span></a>                <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">flex_pos</span><span class="p">:</span>
</span><span id="L-1364"><a href="#L-1364"><span class="linenos">1364</span></a>                    <span class="n">num_flex</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lineup</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">lineup</span><span class="o">.</span><span class="n">position</span> <span class="o">==</span> <span class="n">pos</span><span class="p">,</span><span class="s1">&#39;count&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
</span><span id="L-1365"><a href="#L-1365"><span class="linenos">1365</span></a>                    <span class="k">for</span> <span class="n">flex</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_flex</span><span class="p">):</span>
</span><span id="L-1366"><a href="#L-1366"><span class="linenos">1366</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-1367"><a href="#L-1367"><span class="linenos">1367</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-1368"><a href="#L-1368"><span class="linenos">1368</span></a>                                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">fantasy_team</span> <span class="o">==</span> <span class="n">team</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>
</span><span id="L-1369"><a href="#L-1369"><span class="linenos">1369</span></a>                                <span class="o">&amp;</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">starter</span>
</span><span id="L-1370"><a href="#L-1370"><span class="linenos">1370</span></a>                                <span class="o">&amp;</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">injured</span>
</span><span id="L-1371"><a href="#L-1371"><span class="linenos">1371</span></a>                                <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">bye_week</span> <span class="o">!=</span> <span class="n">week</span><span class="p">)</span>
</span><span id="L-1372"><a href="#L-1372"><span class="linenos">1372</span></a>                                <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">flex_pos</span><span class="p">[</span><span class="n">pos</span><span class="p">])</span>
</span><span id="L-1373"><a href="#L-1373"><span class="linenos">1373</span></a>                                <span class="o">&amp;</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">player_id</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">started</span><span class="o">.</span><span class="n">player_id</span><span class="p">)</span>
</span><span id="L-1374"><a href="#L-1374"><span class="linenos">1374</span></a>                                <span class="o">&amp;</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">player_id</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">not_available</span><span class="o">.</span><span class="n">player_id</span><span class="p">)</span>
</span><span id="L-1375"><a href="#L-1375"><span class="linenos">1375</span></a>                            <span class="p">]</span>
</span><span id="L-1376"><a href="#L-1376"><span class="linenos">1376</span></a>                            <span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-1377"><a href="#L-1377"><span class="linenos">1377</span></a>                            <span class="o">.</span><span class="n">index</span><span class="p">,</span>
</span><span id="L-1378"><a href="#L-1378"><span class="linenos">1378</span></a>                            <span class="s2">&quot;starter&quot;</span><span class="p">,</span>
</span><span id="L-1379"><a href="#L-1379"><span class="linenos">1379</span></a>                        <span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-1380"><a href="#L-1380"><span class="linenos">1380</span></a>        <span class="k">elif</span> <span class="n">week</span> <span class="o">&gt;=</span> <span class="n">as_of</span> <span class="o">%</span> <span class="mi">100</span><span class="p">:</span>
</span><span id="L-1381"><a href="#L-1381"><span class="linenos">1381</span></a>            <span class="n">num_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">roster_spots</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">roster_spots</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;W/T&quot;</span><span class="p">,</span> <span class="s2">&quot;W/R/T&quot;</span><span class="p">,</span> <span class="s2">&quot;Q/W/R/T&quot;</span><span class="p">,</span> <span class="s2">&quot;BN&quot;</span><span class="p">,</span> <span class="s2">&quot;IR&quot;</span><span class="p">])]</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;position&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span>
</span><span id="L-1382"><a href="#L-1382"><span class="linenos">1382</span></a>            <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">num_pos</span><span class="p">:</span>
</span><span id="L-1383"><a href="#L-1383"><span class="linenos">1383</span></a>                <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_pos</span><span class="p">[</span><span class="n">pos</span><span class="p">]):</span>
</span><span id="L-1384"><a href="#L-1384"><span class="linenos">1384</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-1385"><a href="#L-1385"><span class="linenos">1385</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-1386"><a href="#L-1386"><span class="linenos">1386</span></a>                            <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">starter</span>
</span><span id="L-1387"><a href="#L-1387"><span class="linenos">1387</span></a>                            <span class="o">&amp;</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">injured</span>
</span><span id="L-1388"><a href="#L-1388"><span class="linenos">1388</span></a>                            <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">bye_week</span> <span class="o">!=</span> <span class="n">week</span><span class="p">)</span>
</span><span id="L-1389"><a href="#L-1389"><span class="linenos">1389</span></a>                            <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">position</span> <span class="o">==</span> <span class="n">pos</span><span class="p">)</span>
</span><span id="L-1390"><a href="#L-1390"><span class="linenos">1390</span></a>                        <span class="p">]</span>
</span><span id="L-1391"><a href="#L-1391"><span class="linenos">1391</span></a>                        <span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;fantasy_team&quot;</span><span class="p">],</span> <span class="n">keep</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)</span>
</span><span id="L-1392"><a href="#L-1392"><span class="linenos">1392</span></a>                        <span class="o">.</span><span class="n">index</span><span class="p">,</span>
</span><span id="L-1393"><a href="#L-1393"><span class="linenos">1393</span></a>                        <span class="s2">&quot;starter&quot;</span><span class="p">,</span>
</span><span id="L-1394"><a href="#L-1394"><span class="linenos">1394</span></a>                    <span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-1395"><a href="#L-1395"><span class="linenos">1395</span></a>            <span class="n">flex_pos</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;W/T&quot;</span><span class="p">:[</span><span class="s1">&#39;WR&#39;</span><span class="p">,</span><span class="s1">&#39;TE&#39;</span><span class="p">],</span><span class="s2">&quot;W/R/T&quot;</span><span class="p">:[</span><span class="s1">&#39;WR&#39;</span><span class="p">,</span><span class="s1">&#39;RB&#39;</span><span class="p">,</span><span class="s1">&#39;TE&#39;</span><span class="p">],</span><span class="s2">&quot;Q/W/R/T&quot;</span><span class="p">:[</span><span class="s1">&#39;WR&#39;</span><span class="p">,</span><span class="s1">&#39;RB&#39;</span><span class="p">,</span><span class="s1">&#39;TE&#39;</span><span class="p">,</span><span class="s1">&#39;QB&#39;</span><span class="p">]}</span>
</span><span id="L-1396"><a href="#L-1396"><span class="linenos">1396</span></a>            <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">flex_pos</span><span class="p">:</span>
</span><span id="L-1397"><a href="#L-1397"><span class="linenos">1397</span></a>                <span class="n">num_flex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">roster_spots</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">roster_spots</span><span class="o">.</span><span class="n">position</span> <span class="o">==</span> <span class="n">pos</span><span class="p">,</span><span class="s1">&#39;count&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</span><span id="L-1398"><a href="#L-1398"><span class="linenos">1398</span></a>                <span class="k">for</span> <span class="n">flex</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_flex</span><span class="p">):</span>
</span><span id="L-1399"><a href="#L-1399"><span class="linenos">1399</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-1400"><a href="#L-1400"><span class="linenos">1400</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-1401"><a href="#L-1401"><span class="linenos">1401</span></a>                            <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">starter</span>
</span><span id="L-1402"><a href="#L-1402"><span class="linenos">1402</span></a>                            <span class="o">&amp;</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">injured</span>
</span><span id="L-1403"><a href="#L-1403"><span class="linenos">1403</span></a>                            <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">bye_week</span> <span class="o">!=</span> <span class="n">week</span><span class="p">)</span>
</span><span id="L-1404"><a href="#L-1404"><span class="linenos">1404</span></a>                            <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">flex_pos</span><span class="p">[</span><span class="n">pos</span><span class="p">])</span>
</span><span id="L-1405"><a href="#L-1405"><span class="linenos">1405</span></a>                        <span class="p">]</span>
</span><span id="L-1406"><a href="#L-1406"><span class="linenos">1406</span></a>                        <span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;fantasy_team&quot;</span><span class="p">],</span> <span class="n">keep</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)</span>
</span><span id="L-1407"><a href="#L-1407"><span class="linenos">1407</span></a>                        <span class="o">.</span><span class="n">index</span><span class="p">,</span>
</span><span id="L-1408"><a href="#L-1408"><span class="linenos">1408</span></a>                        <span class="s2">&quot;starter&quot;</span><span class="p">,</span>
</span><span id="L-1409"><a href="#L-1409"><span class="linenos">1409</span></a>                    <span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-1410"><a href="#L-1410"><span class="linenos">1410</span></a>
</span><span id="L-1411"><a href="#L-1411"><span class="linenos">1411</span></a>    <span class="k">def</span> <span class="nf">bestball_sims</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">payouts</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">]):</span>
</span><span id="L-1412"><a href="#L-1412"><span class="linenos">1412</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1413"><a href="#L-1413"><span class="linenos">1413</span></a><span class="sd">        Simulates the remainder of the fantasy season based on current rosters </span>
</span><span id="L-1414"><a href="#L-1414"><span class="linenos">1414</span></a><span class="sd">        and best ball settings using Monte Carlo simulations.</span>
</span><span id="L-1415"><a href="#L-1415"><span class="linenos">1415</span></a>
</span><span id="L-1416"><a href="#L-1416"><span class="linenos">1416</span></a><span class="sd">        Args:</span>
</span><span id="L-1417"><a href="#L-1417"><span class="linenos">1417</span></a><span class="sd">            payouts (list, optional): list of prize amounts for first, second, and third, defaults to [800, 300, 100].</span>
</span><span id="L-1418"><a href="#L-1418"><span class="linenos">1418</span></a>
</span><span id="L-1419"><a href="#L-1419"><span class="linenos">1419</span></a><span class="sd">        Returns:</span>
</span><span id="L-1420"><a href="#L-1420"><span class="linenos">1420</span></a><span class="sd">            standings (pd.DataFrame): simulated results for the final season standings and playoff projections.</span>
</span><span id="L-1421"><a href="#L-1421"><span class="linenos">1421</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1422"><a href="#L-1422"><span class="linenos">1422</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_oauth</span><span class="p">()</span>
</span><span id="L-1423"><a href="#L-1423"><span class="linenos">1423</span></a>        <span class="n">projections</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;fantasy_team&quot;</span><span class="p">,</span> <span class="s2">&quot;week&quot;</span><span class="p">,</span> <span class="s2">&quot;points_avg&quot;</span><span class="p">,</span> <span class="s2">&quot;points_stdev&quot;</span><span class="p">])</span>
</span><span id="L-1424"><a href="#L-1424"><span class="linenos">1424</span></a>        <span class="k">for</span> <span class="n">week</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">week</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;playoff_start_week&#39;</span><span class="p">]):</span>
</span><span id="L-1425"><a href="#L-1425"><span class="linenos">1425</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">starters</span><span class="p">(</span><span class="n">week</span><span class="p">)</span>
</span><span id="L-1426"><a href="#L-1426"><span class="linenos">1426</span></a>            <span class="n">projections</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">projections</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">fantasy_team</span><span class="o">.</span><span class="n">isnull</span><span class="p">(),</span>\
</span><span id="L-1427"><a href="#L-1427"><span class="linenos">1427</span></a>            <span class="p">[</span><span class="s1">&#39;player_id_sr&#39;</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;position&#39;</span><span class="p">,</span><span class="s1">&#39;fantasy_team&#39;</span><span class="p">,</span><span class="s1">&#39;points_avg&#39;</span><span class="p">,</span><span class="s1">&#39;points_stdev&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)],</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-1428"><a href="#L-1428"><span class="linenos">1428</span></a>            <span class="n">projections</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">projections</span><span class="o">.</span><span class="n">week</span><span class="o">.</span><span class="n">isnull</span><span class="p">(),</span> <span class="s2">&quot;week&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">week</span>
</span><span id="L-1429"><a href="#L-1429"><span class="linenos">1429</span></a>        <span class="n">season_sims</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">projections</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_sims</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1430"><a href="#L-1430"><span class="linenos">1430</span></a>        <span class="n">season_sims</span><span class="p">[</span><span class="s2">&quot;num_sim&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">season_sims</span><span class="o">.</span><span class="n">index</span> <span class="o">//</span> <span class="n">projections</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-1431"><a href="#L-1431"><span class="linenos">1431</span></a>        <span class="n">season_sims</span><span class="p">[</span><span class="s2">&quot;points_sim&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-1432"><a href="#L-1432"><span class="linenos">1432</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">season_sims</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-1433"><a href="#L-1433"><span class="linenos">1433</span></a>            <span class="o">*</span> <span class="n">season_sims</span><span class="p">[</span><span class="s2">&quot;points_stdev&quot;</span><span class="p">]</span>
</span><span id="L-1434"><a href="#L-1434"><span class="linenos">1434</span></a>            <span class="o">+</span> <span class="n">season_sims</span><span class="p">[</span><span class="s2">&quot;points_avg&quot;</span><span class="p">]</span>
</span><span id="L-1435"><a href="#L-1435"><span class="linenos">1435</span></a>        <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="L-1436"><a href="#L-1436"><span class="linenos">1436</span></a>        <span class="n">season_sims</span> <span class="o">=</span> <span class="n">season_sims</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;points_sim&#39;</span><span class="p">,</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1437"><a href="#L-1437"><span class="linenos">1437</span></a>        <span class="n">season_sims</span><span class="p">[</span><span class="s1">&#39;injured&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">season_sims</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mf">0.1</span>
</span><span id="L-1438"><a href="#L-1438"><span class="linenos">1438</span></a>        <span class="n">season_sims</span><span class="p">[</span><span class="s1">&#39;starter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-1439"><a href="#L-1439"><span class="linenos">1439</span></a>        <span class="n">num_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">roster_spots</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">roster_spots</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;W/T&quot;</span><span class="p">,</span> <span class="s2">&quot;W/R/T&quot;</span><span class="p">,</span> <span class="s2">&quot;Q/W/R/T&quot;</span><span class="p">,</span> <span class="s2">&quot;BN&quot;</span><span class="p">,</span> <span class="s2">&quot;IR&quot;</span><span class="p">])]</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;position&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span>
</span><span id="L-1440"><a href="#L-1440"><span class="linenos">1440</span></a>        <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">num_pos</span><span class="p">:</span>
</span><span id="L-1441"><a href="#L-1441"><span class="linenos">1441</span></a>            <span class="n">inds</span> <span class="o">=</span> <span class="n">season_sims</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">season_sims</span><span class="o">.</span><span class="n">position</span> <span class="o">==</span> <span class="n">pos</span><span class="p">)</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">season_sims</span><span class="o">.</span><span class="n">injured</span><span class="p">]</span>\
</span><span id="L-1442"><a href="#L-1442"><span class="linenos">1442</span></a>            <span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;num_sim&#39;</span><span class="p">,</span><span class="s1">&#39;week&#39;</span><span class="p">,</span><span class="s1">&#39;fantasy_team&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">num_pos</span><span class="p">[</span><span class="n">pos</span><span class="p">])</span><span class="o">.</span><span class="n">index</span>
</span><span id="L-1443"><a href="#L-1443"><span class="linenos">1443</span></a>            <span class="n">season_sims</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inds</span><span class="p">,</span><span class="s1">&#39;starter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-1444"><a href="#L-1444"><span class="linenos">1444</span></a>        <span class="n">flex_pos</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;W/T&quot;</span><span class="p">:[</span><span class="s1">&#39;WR&#39;</span><span class="p">,</span><span class="s1">&#39;TE&#39;</span><span class="p">],</span><span class="s2">&quot;W/R/T&quot;</span><span class="p">:[</span><span class="s1">&#39;WR&#39;</span><span class="p">,</span><span class="s1">&#39;RB&#39;</span><span class="p">,</span><span class="s1">&#39;TE&#39;</span><span class="p">],</span><span class="s2">&quot;Q/W/R/T&quot;</span><span class="p">:[</span><span class="s1">&#39;WR&#39;</span><span class="p">,</span><span class="s1">&#39;RB&#39;</span><span class="p">,</span><span class="s1">&#39;TE&#39;</span><span class="p">,</span><span class="s1">&#39;QB&#39;</span><span class="p">]}</span>
</span><span id="L-1445"><a href="#L-1445"><span class="linenos">1445</span></a>        <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">flex_pos</span><span class="p">:</span>
</span><span id="L-1446"><a href="#L-1446"><span class="linenos">1446</span></a>            <span class="n">num_flex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">roster_spots</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">roster_spots</span><span class="o">.</span><span class="n">position</span> <span class="o">==</span> <span class="n">pos</span><span class="p">,</span><span class="s1">&#39;count&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</span><span id="L-1447"><a href="#L-1447"><span class="linenos">1447</span></a>            <span class="n">inds</span> <span class="o">=</span> <span class="n">season_sims</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">season_sims</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">flex_pos</span><span class="p">[</span><span class="n">pos</span><span class="p">])</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">season_sims</span><span class="o">.</span><span class="n">injured</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">season_sims</span><span class="o">.</span><span class="n">starter</span><span class="p">]</span>\
</span><span id="L-1448"><a href="#L-1448"><span class="linenos">1448</span></a>            <span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;num_sim&#39;</span><span class="p">,</span><span class="s1">&#39;week&#39;</span><span class="p">,</span><span class="s1">&#39;fantasy_team&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">num_flex</span><span class="p">)</span><span class="o">.</span><span class="n">index</span>
</span><span id="L-1449"><a href="#L-1449"><span class="linenos">1449</span></a>            <span class="n">season_sims</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inds</span><span class="p">,</span><span class="s1">&#39;starter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-1450"><a href="#L-1450"><span class="linenos">1450</span></a>        <span class="n">standings_sims</span> <span class="o">=</span> <span class="n">season_sims</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">season_sims</span><span class="o">.</span><span class="n">starter</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;num_sim&#39;</span><span class="p">,</span><span class="s1">&#39;fantasy_team&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">points_sim</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="L-1451"><a href="#L-1451"><span class="linenos">1451</span></a>        <span class="n">standings_sims</span> <span class="o">=</span> <span class="n">standings_sims</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;num_sim&#39;</span><span class="p">,</span><span class="s1">&#39;points_sim&#39;</span><span class="p">],</span><span class="n">ascending</span><span class="o">=</span><span class="p">[</span><span class="kc">True</span><span class="p">,</span><span class="kc">False</span><span class="p">],</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1452"><a href="#L-1452"><span class="linenos">1452</span></a>        <span class="n">standings_sims</span><span class="p">[</span><span class="s1">&#39;place&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">standings_sims</span><span class="o">.</span><span class="n">index</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">teams</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="L-1453"><a href="#L-1453"><span class="linenos">1453</span></a>        <span class="n">standings_sims</span><span class="p">[</span><span class="s2">&quot;playoffs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">standings_sims</span><span class="p">[</span><span class="s1">&#39;place&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;num_playoff_teams&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="L-1454"><a href="#L-1454"><span class="linenos">1454</span></a>        <span class="n">standings_sims</span><span class="p">[</span><span class="s2">&quot;winner&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">standings_sims</span><span class="p">[</span><span class="s1">&#39;place&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="L-1455"><a href="#L-1455"><span class="linenos">1455</span></a>        <span class="n">standings_sims</span><span class="p">[</span><span class="s2">&quot;runner_up&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">standings_sims</span><span class="p">[</span><span class="s1">&#39;place&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="L-1456"><a href="#L-1456"><span class="linenos">1456</span></a>        <span class="n">standings_sims</span><span class="p">[</span><span class="s2">&quot;third&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">standings_sims</span><span class="p">[</span><span class="s1">&#39;place&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="L-1457"><a href="#L-1457"><span class="linenos">1457</span></a>        <span class="n">payouts</span> <span class="o">+=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">teams</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">payouts</span><span class="p">))</span>
</span><span id="L-1458"><a href="#L-1458"><span class="linenos">1458</span></a>        <span class="n">standings_sims</span><span class="p">[</span><span class="s1">&#39;earnings&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">payouts</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">num_sims</span>
</span><span id="L-1459"><a href="#L-1459"><span class="linenos">1459</span></a>        <span class="n">standings</span> <span class="o">=</span> <span class="n">standings_sims</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;fantasy_team&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="L-1460"><a href="#L-1460"><span class="linenos">1460</span></a>        <span class="n">standings</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">standings</span><span class="p">,</span><span class="n">right</span><span class="o">=</span><span class="n">standings_sims</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;fantasy_team&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">points_sim</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>\
</span><span id="L-1461"><a href="#L-1461"><span class="linenos">1461</span></a>        <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;points_sim&#39;</span><span class="p">:</span><span class="s1">&#39;points_stdev&#39;</span><span class="p">}),</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="s1">&#39;fantasy_team&#39;</span><span class="p">)</span>
</span><span id="L-1462"><a href="#L-1462"><span class="linenos">1462</span></a>        <span class="n">standings</span> <span class="o">=</span> <span class="n">standings</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fantasy_team&#39;</span><span class="p">:</span><span class="s1">&#39;team&#39;</span><span class="p">,</span><span class="s1">&#39;points_sim&#39;</span><span class="p">:</span><span class="s1">&#39;points_avg&#39;</span><span class="p">,</span><span class="s1">&#39;place&#39;</span><span class="p">:</span><span class="s1">&#39;avg_place&#39;</span><span class="p">})</span>
</span><span id="L-1463"><a href="#L-1463"><span class="linenos">1463</span></a>        <span class="n">standings</span> <span class="o">=</span> <span class="n">standings</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;playoffs&#39;</span><span class="p">,</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1464"><a href="#L-1464"><span class="linenos">1464</span></a>        <span class="k">del</span> <span class="n">standings</span><span class="p">[</span><span class="s1">&#39;num_sim&#39;</span><span class="p">]</span>
</span><span id="L-1465"><a href="#L-1465"><span class="linenos">1465</span></a>        <span class="n">standings</span><span class="p">[[</span><span class="s2">&quot;wins_avg&quot;</span><span class="p">,</span><span class="s2">&quot;wins_stdev&quot;</span><span class="p">,</span><span class="s2">&quot;playoff_bye&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-1466"><a href="#L-1466"><span class="linenos">1466</span></a>        <span class="k">return</span> <span class="n">standings</span>
</span><span id="L-1467"><a href="#L-1467"><span class="linenos">1467</span></a>
</span><span id="L-1468"><a href="#L-1468"><span class="linenos">1468</span></a>    <span class="k">def</span> <span class="nf">season_sims</span><span class="p">(</span>
</span><span id="L-1469"><a href="#L-1469"><span class="linenos">1469</span></a>        <span class="bp">self</span><span class="p">,</span> 
</span><span id="L-1470"><a href="#L-1470"><span class="linenos">1470</span></a>        <span class="n">postseason</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> 
</span><span id="L-1471"><a href="#L-1471"><span class="linenos">1471</span></a>        <span class="n">payouts</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">800</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span> 
</span><span id="L-1472"><a href="#L-1472"><span class="linenos">1472</span></a>        <span class="n">fixed_winner</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1473"><a href="#L-1473"><span class="linenos">1473</span></a>    <span class="p">):</span>
</span><span id="L-1474"><a href="#L-1474"><span class="linenos">1474</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1475"><a href="#L-1475"><span class="linenos">1475</span></a><span class="sd">        Simulates the remainder of the fantasy season based on current rosters </span>
</span><span id="L-1476"><a href="#L-1476"><span class="linenos">1476</span></a><span class="sd">        and redraft settings using Monte Carlo simulations.</span>
</span><span id="L-1477"><a href="#L-1477"><span class="linenos">1477</span></a>
</span><span id="L-1478"><a href="#L-1478"><span class="linenos">1478</span></a><span class="sd">        Args:</span>
</span><span id="L-1479"><a href="#L-1479"><span class="linenos">1479</span></a><span class="sd">            postseason (bool, optional): whether to simulate the postseason in addition to the regular season, defaults to True.  </span>
</span><span id="L-1480"><a href="#L-1480"><span class="linenos">1480</span></a><span class="sd">            payouts (list, optional): list of prize amounts for first, second, and third, defaults to [800, 300, 100].  </span>
</span><span id="L-1481"><a href="#L-1481"><span class="linenos">1481</span></a><span class="sd">            fixed_winner (list, optional): list containing the week and team name of a fixed winner, defaults to None.</span>
</span><span id="L-1482"><a href="#L-1482"><span class="linenos">1482</span></a>
</span><span id="L-1483"><a href="#L-1483"><span class="linenos">1483</span></a><span class="sd">        Returns:</span>
</span><span id="L-1484"><a href="#L-1484"><span class="linenos">1484</span></a><span class="sd">            schedule (pd.DataFrame): simulated results for each matchup throughout the season in question  </span>
</span><span id="L-1485"><a href="#L-1485"><span class="linenos">1485</span></a><span class="sd">            standings (pd.DataFrame): simulated results for the final season standings and playoff projections</span>
</span><span id="L-1486"><a href="#L-1486"><span class="linenos">1486</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1487"><a href="#L-1487"><span class="linenos">1487</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_oauth</span><span class="p">()</span>
</span><span id="L-1488"><a href="#L-1488"><span class="linenos">1488</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[</span><span class="s2">&quot;points_var&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">points_stdev</span><span class="o">**</span><span class="mi">2</span>
</span><span id="L-1489"><a href="#L-1489"><span class="linenos">1489</span></a>        <span class="n">projections</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span><span id="L-1490"><a href="#L-1490"><span class="linenos">1490</span></a>            <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;fantasy_team&quot;</span><span class="p">,</span> <span class="s2">&quot;week&quot;</span><span class="p">,</span> <span class="s2">&quot;points_avg&quot;</span><span class="p">,</span> <span class="s2">&quot;points_var&quot;</span><span class="p">]</span>
</span><span id="L-1491"><a href="#L-1491"><span class="linenos">1491</span></a>        <span class="p">)</span>
</span><span id="L-1492"><a href="#L-1492"><span class="linenos">1492</span></a>        <span class="k">for</span> <span class="n">week</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">17</span><span class="p">):</span>
</span><span id="L-1493"><a href="#L-1493"><span class="linenos">1493</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">starters</span><span class="p">(</span><span class="n">week</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-1494"><a href="#L-1494"><span class="linenos">1494</span></a>            <span class="n">projections</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">projections</span><span class="p">,</span>
</span><span id="L-1495"><a href="#L-1495"><span class="linenos">1495</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">starter</span><span class="p">]</span>
</span><span id="L-1496"><a href="#L-1496"><span class="linenos">1496</span></a>                <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;fantasy_team&quot;</span><span class="p">)[[</span><span class="s2">&quot;points_avg&quot;</span><span class="p">,</span> <span class="s2">&quot;points_var&quot;</span><span class="p">]]</span>
</span><span id="L-1497"><a href="#L-1497"><span class="linenos">1497</span></a>                <span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</span><span id="L-1498"><a href="#L-1498"><span class="linenos">1498</span></a>                <span class="o">.</span><span class="n">reset_index</span><span class="p">()],</span>
</span><span id="L-1499"><a href="#L-1499"><span class="linenos">1499</span></a>                <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-1500"><a href="#L-1500"><span class="linenos">1500</span></a>                <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-1501"><a href="#L-1501"><span class="linenos">1501</span></a>            <span class="p">)</span>
</span><span id="L-1502"><a href="#L-1502"><span class="linenos">1502</span></a>            <span class="n">projections</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">projections</span><span class="o">.</span><span class="n">week</span><span class="o">.</span><span class="n">isnull</span><span class="p">(),</span> <span class="s2">&quot;week&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">week</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="L-1503"><a href="#L-1503"><span class="linenos">1503</span></a>        <span class="n">projections</span><span class="p">[</span><span class="s2">&quot;points_stdev&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">projections</span><span class="p">[</span><span class="s2">&quot;points_var&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="mf">0.5</span>
</span><span id="L-1504"><a href="#L-1504"><span class="linenos">1504</span></a>        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[</span><span class="s2">&quot;points_var&quot;</span><span class="p">]</span>
</span><span id="L-1505"><a href="#L-1505"><span class="linenos">1505</span></a>        <span class="n">schedule</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="L-1506"><a href="#L-1506"><span class="linenos">1506</span></a>            <span class="n">left</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
</span><span id="L-1507"><a href="#L-1507"><span class="linenos">1507</span></a>            <span class="n">right</span><span class="o">=</span><span class="n">projections</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
</span><span id="L-1508"><a href="#L-1508"><span class="linenos">1508</span></a>                <span class="n">index</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="L-1509"><a href="#L-1509"><span class="linenos">1509</span></a>                <span class="n">columns</span><span class="o">=</span><span class="p">{</span>
</span><span id="L-1510"><a href="#L-1510"><span class="linenos">1510</span></a>                    <span class="s2">&quot;fantasy_team&quot;</span><span class="p">:</span> <span class="s2">&quot;team_1&quot;</span><span class="p">,</span>
</span><span id="L-1511"><a href="#L-1511"><span class="linenos">1511</span></a>                    <span class="s2">&quot;points_avg&quot;</span><span class="p">:</span> <span class="s2">&quot;points_avg_1&quot;</span><span class="p">,</span>
</span><span id="L-1512"><a href="#L-1512"><span class="linenos">1512</span></a>                    <span class="s2">&quot;points_stdev&quot;</span><span class="p">:</span> <span class="s2">&quot;points_stdev_1&quot;</span><span class="p">,</span>
</span><span id="L-1513"><a href="#L-1513"><span class="linenos">1513</span></a>                <span class="p">},</span>
</span><span id="L-1514"><a href="#L-1514"><span class="linenos">1514</span></a>            <span class="p">),</span>
</span><span id="L-1515"><a href="#L-1515"><span class="linenos">1515</span></a>            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
</span><span id="L-1516"><a href="#L-1516"><span class="linenos">1516</span></a>            <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;week&quot;</span><span class="p">,</span> <span class="s2">&quot;team_1&quot;</span><span class="p">],</span>
</span><span id="L-1517"><a href="#L-1517"><span class="linenos">1517</span></a>        <span class="p">)</span>
</span><span id="L-1518"><a href="#L-1518"><span class="linenos">1518</span></a>        <span class="n">schedule</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="L-1519"><a href="#L-1519"><span class="linenos">1519</span></a>            <span class="n">left</span><span class="o">=</span><span class="n">schedule</span><span class="p">,</span>
</span><span id="L-1520"><a href="#L-1520"><span class="linenos">1520</span></a>            <span class="n">right</span><span class="o">=</span><span class="n">projections</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
</span><span id="L-1521"><a href="#L-1521"><span class="linenos">1521</span></a>                <span class="n">index</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="L-1522"><a href="#L-1522"><span class="linenos">1522</span></a>                <span class="n">columns</span><span class="o">=</span><span class="p">{</span>
</span><span id="L-1523"><a href="#L-1523"><span class="linenos">1523</span></a>                    <span class="s2">&quot;fantasy_team&quot;</span><span class="p">:</span> <span class="s2">&quot;team_2&quot;</span><span class="p">,</span>
</span><span id="L-1524"><a href="#L-1524"><span class="linenos">1524</span></a>                    <span class="s2">&quot;points_avg&quot;</span><span class="p">:</span> <span class="s2">&quot;points_avg_2&quot;</span><span class="p">,</span>
</span><span id="L-1525"><a href="#L-1525"><span class="linenos">1525</span></a>                    <span class="s2">&quot;points_stdev&quot;</span><span class="p">:</span> <span class="s2">&quot;points_stdev_2&quot;</span><span class="p">,</span>
</span><span id="L-1526"><a href="#L-1526"><span class="linenos">1526</span></a>                <span class="p">},</span>
</span><span id="L-1527"><a href="#L-1527"><span class="linenos">1527</span></a>            <span class="p">),</span>
</span><span id="L-1528"><a href="#L-1528"><span class="linenos">1528</span></a>            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
</span><span id="L-1529"><a href="#L-1529"><span class="linenos">1529</span></a>            <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;week&quot;</span><span class="p">,</span> <span class="s2">&quot;team_2&quot;</span><span class="p">],</span>
</span><span id="L-1530"><a href="#L-1530"><span class="linenos">1530</span></a>        <span class="p">)</span>
</span><span id="L-1531"><a href="#L-1531"><span class="linenos">1531</span></a>        <span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;points_avg_1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;points_avg_1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="L-1532"><a href="#L-1532"><span class="linenos">1532</span></a>        <span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;points_avg_2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;points_avg_2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="L-1533"><a href="#L-1533"><span class="linenos">1533</span></a>        <span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;points_stdev_1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-1534"><a href="#L-1534"><span class="linenos">1534</span></a>            <span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;points_stdev_1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="L-1535"><a href="#L-1535"><span class="linenos">1535</span></a>        <span class="p">)</span>
</span><span id="L-1536"><a href="#L-1536"><span class="linenos">1536</span></a>        <span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;points_stdev_2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-1537"><a href="#L-1537"><span class="linenos">1537</span></a>            <span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;points_stdev_2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="L-1538"><a href="#L-1538"><span class="linenos">1538</span></a>        <span class="p">)</span>
</span><span id="L-1539"><a href="#L-1539"><span class="linenos">1539</span></a>        <span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;points_avg_1&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;score_1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="L-1540"><a href="#L-1540"><span class="linenos">1540</span></a>        <span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;points_avg_2&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;score_2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="L-1541"><a href="#L-1541"><span class="linenos">1541</span></a>        <span class="k">if</span> <span class="n">fixed_winner</span><span class="p">:</span>
</span><span id="L-1542"><a href="#L-1542"><span class="linenos">1542</span></a>            <span class="k">if</span> <span class="p">(</span>
</span><span id="L-1543"><a href="#L-1543"><span class="linenos">1543</span></a>                <span class="p">(</span><span class="n">schedule</span><span class="o">.</span><span class="n">week</span> <span class="o">==</span> <span class="n">fixed_winner</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-1544"><a href="#L-1544"><span class="linenos">1544</span></a>                <span class="o">&amp;</span> <span class="p">(</span><span class="n">schedule</span><span class="o">.</span><span class="n">team_1</span> <span class="o">==</span> <span class="n">fixed_winner</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-1545"><a href="#L-1545"><span class="linenos">1545</span></a>            <span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="L-1546"><a href="#L-1546"><span class="linenos">1546</span></a>                <span class="n">winner</span><span class="p">,</span> <span class="n">loser</span> <span class="o">=</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span>
</span><span id="L-1547"><a href="#L-1547"><span class="linenos">1547</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1548"><a href="#L-1548"><span class="linenos">1548</span></a>                <span class="n">winner</span><span class="p">,</span> <span class="n">loser</span> <span class="o">=</span> <span class="s2">&quot;2&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span>
</span><span id="L-1549"><a href="#L-1549"><span class="linenos">1549</span></a>            <span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-1550"><a href="#L-1550"><span class="linenos">1550</span></a>                <span class="p">(</span><span class="n">schedule</span><span class="o">.</span><span class="n">week</span> <span class="o">==</span> <span class="n">fixed_winner</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-1551"><a href="#L-1551"><span class="linenos">1551</span></a>                <span class="o">&amp;</span> <span class="p">(</span><span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;team_&quot;</span> <span class="o">+</span> <span class="n">winner</span><span class="p">]</span> <span class="o">==</span> <span class="n">fixed_winner</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
</span><span id="L-1552"><a href="#L-1552"><span class="linenos">1552</span></a>                <span class="s2">&quot;points_avg_&quot;</span> <span class="o">+</span> <span class="n">winner</span><span class="p">,</span>
</span><span id="L-1553"><a href="#L-1553"><span class="linenos">1553</span></a>            <span class="p">]</span> <span class="o">=</span> <span class="mf">100.1</span>
</span><span id="L-1554"><a href="#L-1554"><span class="linenos">1554</span></a>            <span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-1555"><a href="#L-1555"><span class="linenos">1555</span></a>                <span class="p">(</span><span class="n">schedule</span><span class="o">.</span><span class="n">week</span> <span class="o">==</span> <span class="n">fixed_winner</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-1556"><a href="#L-1556"><span class="linenos">1556</span></a>                <span class="o">&amp;</span> <span class="p">(</span><span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;team_&quot;</span> <span class="o">+</span> <span class="n">winner</span><span class="p">]</span> <span class="o">==</span> <span class="n">fixed_winner</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
</span><span id="L-1557"><a href="#L-1557"><span class="linenos">1557</span></a>                <span class="s2">&quot;points_avg_&quot;</span> <span class="o">+</span> <span class="n">loser</span><span class="p">,</span>
</span><span id="L-1558"><a href="#L-1558"><span class="linenos">1558</span></a>            <span class="p">]</span> <span class="o">=</span> <span class="mf">100.0</span>
</span><span id="L-1559"><a href="#L-1559"><span class="linenos">1559</span></a>            <span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-1560"><a href="#L-1560"><span class="linenos">1560</span></a>                <span class="p">(</span><span class="n">schedule</span><span class="o">.</span><span class="n">week</span> <span class="o">==</span> <span class="n">fixed_winner</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-1561"><a href="#L-1561"><span class="linenos">1561</span></a>                <span class="o">&amp;</span> <span class="p">(</span><span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;team_&quot;</span> <span class="o">+</span> <span class="n">winner</span><span class="p">]</span> <span class="o">==</span> <span class="n">fixed_winner</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
</span><span id="L-1562"><a href="#L-1562"><span class="linenos">1562</span></a>                <span class="s2">&quot;points_stdev_&quot;</span> <span class="o">+</span> <span class="n">winner</span><span class="p">,</span>
</span><span id="L-1563"><a href="#L-1563"><span class="linenos">1563</span></a>            <span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-1564"><a href="#L-1564"><span class="linenos">1564</span></a>            <span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-1565"><a href="#L-1565"><span class="linenos">1565</span></a>                <span class="p">(</span><span class="n">schedule</span><span class="o">.</span><span class="n">week</span> <span class="o">==</span> <span class="n">fixed_winner</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-1566"><a href="#L-1566"><span class="linenos">1566</span></a>                <span class="o">&amp;</span> <span class="p">(</span><span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;team_&quot;</span> <span class="o">+</span> <span class="n">winner</span><span class="p">]</span> <span class="o">==</span> <span class="n">fixed_winner</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
</span><span id="L-1567"><a href="#L-1567"><span class="linenos">1567</span></a>                <span class="s2">&quot;points_stdev_&quot;</span> <span class="o">+</span> <span class="n">loser</span><span class="p">,</span>
</span><span id="L-1568"><a href="#L-1568"><span class="linenos">1568</span></a>            <span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-1569"><a href="#L-1569"><span class="linenos">1569</span></a>        <span class="n">schedule_sims</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
</span><span id="L-1570"><a href="#L-1570"><span class="linenos">1570</span></a>            <span class="p">[</span><span class="n">schedule</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_sims</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span>
</span><span id="L-1571"><a href="#L-1571"><span class="linenos">1571</span></a>        <span class="p">)</span>
</span><span id="L-1572"><a href="#L-1572"><span class="linenos">1572</span></a>        <span class="n">schedule_sims</span><span class="p">[</span><span class="s2">&quot;num_sim&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">schedule_sims</span><span class="o">.</span><span class="n">index</span> <span class="o">//</span> <span class="n">schedule</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-1573"><a href="#L-1573"><span class="linenos">1573</span></a>        <span class="n">schedule_sims</span><span class="p">[</span><span class="s2">&quot;sim_1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-1574"><a href="#L-1574"><span class="linenos">1574</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">schedule_sims</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-1575"><a href="#L-1575"><span class="linenos">1575</span></a>            <span class="o">*</span> <span class="n">schedule_sims</span><span class="p">[</span><span class="s2">&quot;points_stdev_1&quot;</span><span class="p">]</span>
</span><span id="L-1576"><a href="#L-1576"><span class="linenos">1576</span></a>            <span class="o">+</span> <span class="n">schedule_sims</span><span class="p">[</span><span class="s2">&quot;points_avg_1&quot;</span><span class="p">]</span>
</span><span id="L-1577"><a href="#L-1577"><span class="linenos">1577</span></a>        <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="L-1578"><a href="#L-1578"><span class="linenos">1578</span></a>        <span class="n">schedule_sims</span><span class="p">[</span><span class="s2">&quot;sim_2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-1579"><a href="#L-1579"><span class="linenos">1579</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">schedule_sims</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-1580"><a href="#L-1580"><span class="linenos">1580</span></a>            <span class="o">*</span> <span class="n">schedule_sims</span><span class="p">[</span><span class="s2">&quot;points_stdev_2&quot;</span><span class="p">]</span>
</span><span id="L-1581"><a href="#L-1581"><span class="linenos">1581</span></a>            <span class="o">+</span> <span class="n">schedule_sims</span><span class="p">[</span><span class="s2">&quot;points_avg_2&quot;</span><span class="p">]</span>
</span><span id="L-1582"><a href="#L-1582"><span class="linenos">1582</span></a>        <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="L-1583"><a href="#L-1583"><span class="linenos">1583</span></a>        <span class="n">schedule_sims</span><span class="p">[</span><span class="s2">&quot;win_1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">schedule_sims</span><span class="o">.</span><span class="n">sim_1</span> <span class="o">&gt;</span> <span class="n">schedule_sims</span><span class="o">.</span><span class="n">sim_2</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="L-1584"><a href="#L-1584"><span class="linenos">1584</span></a>        <span class="n">schedule_sims</span><span class="p">[</span><span class="s2">&quot;win_2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">schedule_sims</span><span class="p">[</span><span class="s2">&quot;win_1&quot;</span><span class="p">]</span>
</span><span id="L-1585"><a href="#L-1585"><span class="linenos">1585</span></a>        <span class="n">standings</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span>
</span><span id="L-1586"><a href="#L-1586"><span class="linenos">1586</span></a>            <span class="n">schedule_sims</span><span class="p">[[</span><span class="s2">&quot;num_sim&quot;</span><span class="p">,</span> <span class="s2">&quot;week&quot;</span><span class="p">,</span> <span class="s2">&quot;team_1&quot;</span><span class="p">,</span> <span class="s2">&quot;sim_1&quot;</span><span class="p">,</span> <span class="s2">&quot;win_1&quot;</span><span class="p">]]</span>
</span><span id="L-1587"><a href="#L-1587"><span class="linenos">1587</span></a>            <span class="o">.</span><span class="n">rename</span><span class="p">(</span>
</span><span id="L-1588"><a href="#L-1588"><span class="linenos">1588</span></a>                <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;team_1&quot;</span><span class="p">:</span> <span class="s2">&quot;team&quot;</span><span class="p">,</span> <span class="s2">&quot;win_1&quot;</span><span class="p">:</span> <span class="s2">&quot;wins&quot;</span><span class="p">,</span> <span class="s2">&quot;sim_1&quot;</span><span class="p">:</span> <span class="s2">&quot;points&quot;</span><span class="p">},</span>
</span><span id="L-1589"><a href="#L-1589"><span class="linenos">1589</span></a>            <span class="p">),</span>
</span><span id="L-1590"><a href="#L-1590"><span class="linenos">1590</span></a>            <span class="n">schedule_sims</span><span class="p">[[</span><span class="s2">&quot;num_sim&quot;</span><span class="p">,</span> <span class="s2">&quot;week&quot;</span><span class="p">,</span> <span class="s2">&quot;team_2&quot;</span><span class="p">,</span> <span class="s2">&quot;sim_2&quot;</span><span class="p">,</span> <span class="s2">&quot;win_2&quot;</span><span class="p">]]</span>
</span><span id="L-1591"><a href="#L-1591"><span class="linenos">1591</span></a>            <span class="o">.</span><span class="n">rename</span><span class="p">(</span>
</span><span id="L-1592"><a href="#L-1592"><span class="linenos">1592</span></a>                <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;team_2&quot;</span><span class="p">:</span> <span class="s2">&quot;team&quot;</span><span class="p">,</span> <span class="s2">&quot;win_2&quot;</span><span class="p">:</span> <span class="s2">&quot;wins&quot;</span><span class="p">,</span> <span class="s2">&quot;sim_2&quot;</span><span class="p">:</span> <span class="s2">&quot;points&quot;</span><span class="p">},</span>
</span><span id="L-1593"><a href="#L-1593"><span class="linenos">1593</span></a>            <span class="p">)],</span>
</span><span id="L-1594"><a href="#L-1594"><span class="linenos">1594</span></a>            <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-1595"><a href="#L-1595"><span class="linenos">1595</span></a>        <span class="p">)</span>
</span><span id="L-1596"><a href="#L-1596"><span class="linenos">1596</span></a>        <span class="n">standings</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-1597"><a href="#L-1597"><span class="linenos">1597</span></a>            <span class="n">standings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">standings</span><span class="o">.</span><span class="n">week</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;playoff_start_week&quot;</span><span class="p">]]</span>
</span><span id="L-1598"><a href="#L-1598"><span class="linenos">1598</span></a>            <span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;num_sim&quot;</span><span class="p">,</span> <span class="s2">&quot;team&quot;</span><span class="p">])</span>
</span><span id="L-1599"><a href="#L-1599"><span class="linenos">1599</span></a>            <span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">numeric_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1600"><a href="#L-1600"><span class="linenos">1600</span></a>            <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;num_sim&quot;</span><span class="p">,</span> <span class="s2">&quot;wins&quot;</span><span class="p">,</span> <span class="s2">&quot;points&quot;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-1601"><a href="#L-1601"><span class="linenos">1601</span></a>            <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="L-1602"><a href="#L-1602"><span class="linenos">1602</span></a>        <span class="p">)</span>
</span><span id="L-1603"><a href="#L-1603"><span class="linenos">1603</span></a>        <span class="n">standings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-1604"><a href="#L-1604"><span class="linenos">1604</span></a>            <span class="n">standings</span><span class="o">.</span><span class="n">index</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">teams</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;num_playoff_teams&quot;</span><span class="p">],</span>
</span><span id="L-1605"><a href="#L-1605"><span class="linenos">1605</span></a>            <span class="s2">&quot;playoffs&quot;</span><span class="p">,</span>
</span><span id="L-1606"><a href="#L-1606"><span class="linenos">1606</span></a>        <span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-1607"><a href="#L-1607"><span class="linenos">1607</span></a>        <span class="n">standings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-1608"><a href="#L-1608"><span class="linenos">1608</span></a>            <span class="n">standings</span><span class="o">.</span><span class="n">index</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">teams</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;num_playoff_teams&quot;</span><span class="p">],</span>
</span><span id="L-1609"><a href="#L-1609"><span class="linenos">1609</span></a>            <span class="s2">&quot;playoffs&quot;</span><span class="p">,</span>
</span><span id="L-1610"><a href="#L-1610"><span class="linenos">1610</span></a>        <span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1611"><a href="#L-1611"><span class="linenos">1611</span></a>        <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;playoff_bye&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1612"><a href="#L-1612"><span class="linenos">1612</span></a>        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;num_playoff_teams&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
</span><span id="L-1613"><a href="#L-1613"><span class="linenos">1613</span></a>            <span class="n">standings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">standings</span><span class="o">.</span><span class="n">index</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">teams</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;playoff_bye&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-1614"><a href="#L-1614"><span class="linenos">1614</span></a>        <span class="n">algorithm</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-1615"><a href="#L-1615"><span class="linenos">1615</span></a>            <span class="n">schedule</span><span class="o">.</span><span class="n">team_1</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;The Algorithm&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
</span><span id="L-1616"><a href="#L-1616"><span class="linenos">1616</span></a>            <span class="ow">or</span> <span class="n">schedule</span><span class="o">.</span><span class="n">team_2</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;The Algorithm&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
</span><span id="L-1617"><a href="#L-1617"><span class="linenos">1617</span></a>        <span class="p">)</span>
</span><span id="L-1618"><a href="#L-1618"><span class="linenos">1618</span></a>        <span class="k">if</span> <span class="n">postseason</span><span class="p">:</span>
</span><span id="L-1619"><a href="#L-1619"><span class="linenos">1619</span></a>            <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;seed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">standings</span><span class="o">.</span><span class="n">index</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">teams</span><span class="p">)</span>
</span><span id="L-1620"><a href="#L-1620"><span class="linenos">1620</span></a>            <span class="n">scores</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-1621"><a href="#L-1621"><span class="linenos">1621</span></a>                    <span class="n">schedule</span><span class="o">.</span><span class="n">week</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;playoff_start_week&quot;</span><span class="p">],</span>
</span><span id="L-1622"><a href="#L-1622"><span class="linenos">1622</span></a>                    <span class="p">[</span><span class="s2">&quot;week&quot;</span><span class="p">,</span> <span class="s2">&quot;team_1&quot;</span><span class="p">,</span> <span class="s2">&quot;score_1&quot;</span><span class="p">],</span>
</span><span id="L-1623"><a href="#L-1623"><span class="linenos">1623</span></a>                <span class="p">]</span>
</span><span id="L-1624"><a href="#L-1624"><span class="linenos">1624</span></a>                <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;team_1&quot;</span><span class="p">:</span> <span class="s2">&quot;team&quot;</span><span class="p">,</span> <span class="s2">&quot;score_1&quot;</span><span class="p">:</span> <span class="s2">&quot;score&quot;</span><span class="p">}),</span>
</span><span id="L-1625"><a href="#L-1625"><span class="linenos">1625</span></a>                <span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-1626"><a href="#L-1626"><span class="linenos">1626</span></a>                    <span class="n">schedule</span><span class="o">.</span><span class="n">week</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;playoff_start_week&quot;</span><span class="p">],</span>
</span><span id="L-1627"><a href="#L-1627"><span class="linenos">1627</span></a>                    <span class="p">[</span><span class="s2">&quot;week&quot;</span><span class="p">,</span> <span class="s2">&quot;team_2&quot;</span><span class="p">,</span> <span class="s2">&quot;score_2&quot;</span><span class="p">],</span>
</span><span id="L-1628"><a href="#L-1628"><span class="linenos">1628</span></a>                <span class="p">]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;team_2&quot;</span><span class="p">:</span> <span class="s2">&quot;team&quot;</span><span class="p">,</span> <span class="s2">&quot;score_2&quot;</span><span class="p">:</span> <span class="s2">&quot;score&quot;</span><span class="p">})],</span>
</span><span id="L-1629"><a href="#L-1629"><span class="linenos">1629</span></a>                <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-1630"><a href="#L-1630"><span class="linenos">1630</span></a>                <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-1631"><a href="#L-1631"><span class="linenos">1631</span></a>            <span class="p">)</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;week&quot;</span><span class="p">,</span> <span class="s2">&quot;team&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">score</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="L-1632"><a href="#L-1632"><span class="linenos">1632</span></a>            <span class="n">playoffs</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-1633"><a href="#L-1633"><span class="linenos">1633</span></a>                <span class="n">standings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">standings</span><span class="o">.</span><span class="n">seed</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;num_playoff_teams&quot;</span><span class="p">]]</span>
</span><span id="L-1634"><a href="#L-1634"><span class="linenos">1634</span></a>                <span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-1635"><a href="#L-1635"><span class="linenos">1635</span></a>                <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="L-1636"><a href="#L-1636"><span class="linenos">1636</span></a>            <span class="p">)</span>
</span><span id="L-1637"><a href="#L-1637"><span class="linenos">1637</span></a>            <span class="k">if</span> <span class="n">algorithm</span><span class="p">:</span>
</span><span id="L-1638"><a href="#L-1638"><span class="linenos">1638</span></a>                <span class="n">many_mile</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-1639"><a href="#L-1639"><span class="linenos">1639</span></a>                    <span class="n">standings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">standings</span><span class="o">.</span><span class="n">seed</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;num_playoff_teams&quot;</span><span class="p">]]</span>
</span><span id="L-1640"><a href="#L-1640"><span class="linenos">1640</span></a>                    <span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-1641"><a href="#L-1641"><span class="linenos">1641</span></a>                    <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="L-1642"><a href="#L-1642"><span class="linenos">1642</span></a>                <span class="p">)</span>
</span><span id="L-1643"><a href="#L-1643"><span class="linenos">1643</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;num_playoff_teams&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;6&quot;</span><span class="p">:</span>
</span><span id="L-1644"><a href="#L-1644"><span class="linenos">1644</span></a>                <span class="n">playoffs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="L-1645"><a href="#L-1645"><span class="linenos">1645</span></a>                    <span class="n">left</span><span class="o">=</span><span class="n">playoffs</span><span class="p">,</span>
</span><span id="L-1646"><a href="#L-1646"><span class="linenos">1646</span></a>                    <span class="n">right</span><span class="o">=</span><span class="n">scores</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-1647"><a href="#L-1647"><span class="linenos">1647</span></a>                        <span class="n">scores</span><span class="o">.</span><span class="n">week</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;playoff_start_week&quot;</span><span class="p">],</span>
</span><span id="L-1648"><a href="#L-1648"><span class="linenos">1648</span></a>                        <span class="p">[</span><span class="s2">&quot;team&quot;</span><span class="p">,</span> <span class="s2">&quot;score&quot;</span><span class="p">],</span>
</span><span id="L-1649"><a href="#L-1649"><span class="linenos">1649</span></a>                    <span class="p">],</span>
</span><span id="L-1650"><a href="#L-1650"><span class="linenos">1650</span></a>                    <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
</span><span id="L-1651"><a href="#L-1651"><span class="linenos">1651</span></a>                    <span class="n">on</span><span class="o">=</span><span class="s2">&quot;team&quot;</span><span class="p">,</span>
</span><span id="L-1652"><a href="#L-1652"><span class="linenos">1652</span></a>                <span class="p">)</span>
</span><span id="L-1653"><a href="#L-1653"><span class="linenos">1653</span></a>                <span class="n">playoffs</span><span class="o">.</span><span class="n">score</span> <span class="o">=</span> <span class="n">playoffs</span><span class="o">.</span><span class="n">score</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="L-1654"><a href="#L-1654"><span class="linenos">1654</span></a>                <span class="n">playoffs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="L-1655"><a href="#L-1655"><span class="linenos">1655</span></a>                    <span class="n">left</span><span class="o">=</span><span class="n">playoffs</span><span class="p">,</span>
</span><span id="L-1656"><a href="#L-1656"><span class="linenos">1656</span></a>                    <span class="n">right</span><span class="o">=</span><span class="n">projections</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-1657"><a href="#L-1657"><span class="linenos">1657</span></a>                        <span class="n">projections</span><span class="o">.</span><span class="n">week</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;playoff_start_week&quot;</span><span class="p">],</span>
</span><span id="L-1658"><a href="#L-1658"><span class="linenos">1658</span></a>                        <span class="p">[</span><span class="s2">&quot;fantasy_team&quot;</span><span class="p">,</span> <span class="s2">&quot;points_avg&quot;</span><span class="p">,</span> <span class="s2">&quot;points_stdev&quot;</span><span class="p">],</span>
</span><span id="L-1659"><a href="#L-1659"><span class="linenos">1659</span></a>                    <span class="p">]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;fantasy_team&quot;</span><span class="p">:</span> <span class="s2">&quot;team&quot;</span><span class="p">}),</span>
</span><span id="L-1660"><a href="#L-1660"><span class="linenos">1660</span></a>                    <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
</span><span id="L-1661"><a href="#L-1661"><span class="linenos">1661</span></a>                    <span class="n">on</span><span class="o">=</span><span class="s2">&quot;team&quot;</span><span class="p">,</span>
</span><span id="L-1662"><a href="#L-1662"><span class="linenos">1662</span></a>                <span class="p">)</span>
</span><span id="L-1663"><a href="#L-1663"><span class="linenos">1663</span></a>                <span class="n">playoffs</span><span class="o">.</span><span class="n">points_avg</span> <span class="o">=</span> <span class="n">playoffs</span><span class="o">.</span><span class="n">points_avg</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="L-1664"><a href="#L-1664"><span class="linenos">1664</span></a>                <span class="n">playoffs</span><span class="o">.</span><span class="n">points_stdev</span> <span class="o">=</span> <span class="n">playoffs</span><span class="o">.</span><span class="n">points_stdev</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="L-1665"><a href="#L-1665"><span class="linenos">1665</span></a>                <span class="n">playoffs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">playoffs</span><span class="o">.</span><span class="n">seed</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;matchup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1666"><a href="#L-1666"><span class="linenos">1666</span></a>                <span class="n">playoffs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">playoffs</span><span class="o">.</span><span class="n">seed</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;matchup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-1667"><a href="#L-1667"><span class="linenos">1667</span></a>                <span class="n">playoffs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">playoffs</span><span class="o">.</span><span class="n">seed</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">]),</span> <span class="s2">&quot;matchup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="L-1668"><a href="#L-1668"><span class="linenos">1668</span></a>                <span class="n">playoffs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">playoffs</span><span class="o">.</span><span class="n">seed</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]),</span> <span class="s2">&quot;matchup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
</span><span id="L-1669"><a href="#L-1669"><span class="linenos">1669</span></a>                <span class="n">playoffs</span><span class="p">[</span><span class="s2">&quot;sim&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-1670"><a href="#L-1670"><span class="linenos">1670</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">playoffs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-1671"><a href="#L-1671"><span class="linenos">1671</span></a>                    <span class="o">*</span> <span class="n">playoffs</span><span class="o">.</span><span class="n">points_stdev</span>
</span><span id="L-1672"><a href="#L-1672"><span class="linenos">1672</span></a>                    <span class="o">+</span> <span class="n">playoffs</span><span class="o">.</span><span class="n">points_avg</span>
</span><span id="L-1673"><a href="#L-1673"><span class="linenos">1673</span></a>                    <span class="o">+</span> <span class="n">playoffs</span><span class="o">.</span><span class="n">score</span>
</span><span id="L-1674"><a href="#L-1674"><span class="linenos">1674</span></a>                <span class="p">)</span>
</span><span id="L-1675"><a href="#L-1675"><span class="linenos">1675</span></a>                <span class="n">playoffs</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-1676"><a href="#L-1676"><span class="linenos">1676</span></a>                    <span class="n">playoffs</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
</span><span id="L-1677"><a href="#L-1677"><span class="linenos">1677</span></a>                        <span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;num_sim&quot;</span><span class="p">,</span> <span class="s2">&quot;matchup&quot;</span><span class="p">,</span> <span class="s2">&quot;sim&quot;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]</span>
</span><span id="L-1678"><a href="#L-1678"><span class="linenos">1678</span></a>                    <span class="p">)</span>
</span><span id="L-1679"><a href="#L-1679"><span class="linenos">1679</span></a>                    <span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;num_sim&quot;</span><span class="p">,</span> <span class="s2">&quot;matchup&quot;</span><span class="p">],</span> <span class="n">keep</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)</span>
</span><span id="L-1680"><a href="#L-1680"><span class="linenos">1680</span></a>                    <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1681"><a href="#L-1681"><span class="linenos">1681</span></a>                <span class="p">)</span>
</span><span id="L-1682"><a href="#L-1682"><span class="linenos">1682</span></a>                <span class="k">del</span> <span class="p">(</span>
</span><span id="L-1683"><a href="#L-1683"><span class="linenos">1683</span></a>                    <span class="n">playoffs</span><span class="p">[</span><span class="s2">&quot;matchup&quot;</span><span class="p">],</span>
</span><span id="L-1684"><a href="#L-1684"><span class="linenos">1684</span></a>                    <span class="n">playoffs</span><span class="p">[</span><span class="s2">&quot;sim&quot;</span><span class="p">],</span>
</span><span id="L-1685"><a href="#L-1685"><span class="linenos">1685</span></a>                    <span class="n">playoffs</span><span class="p">[</span><span class="s2">&quot;score&quot;</span><span class="p">],</span>
</span><span id="L-1686"><a href="#L-1686"><span class="linenos">1686</span></a>                    <span class="n">playoffs</span><span class="p">[</span><span class="s2">&quot;points_avg&quot;</span><span class="p">],</span>
</span><span id="L-1687"><a href="#L-1687"><span class="linenos">1687</span></a>                    <span class="n">playoffs</span><span class="p">[</span><span class="s2">&quot;points_stdev&quot;</span><span class="p">],</span>
</span><span id="L-1688"><a href="#L-1688"><span class="linenos">1688</span></a>                <span class="p">)</span>
</span><span id="L-1689"><a href="#L-1689"><span class="linenos">1689</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;uses_playoff_reseeding&quot;</span><span class="p">]:</span>
</span><span id="L-1690"><a href="#L-1690"><span class="linenos">1690</span></a>                    <span class="n">playoffs</span> <span class="o">=</span> <span class="n">playoffs</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
</span><span id="L-1691"><a href="#L-1691"><span class="linenos">1691</span></a>                        <span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;num_sim&quot;</span><span class="p">,</span> <span class="s2">&quot;seed&quot;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span>
</span><span id="L-1692"><a href="#L-1692"><span class="linenos">1692</span></a>                    <span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1693"><a href="#L-1693"><span class="linenos">1693</span></a>                <span class="k">if</span> <span class="n">algorithm</span><span class="p">:</span>
</span><span id="L-1694"><a href="#L-1694"><span class="linenos">1694</span></a>                    <span class="n">many_mile</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="L-1695"><a href="#L-1695"><span class="linenos">1695</span></a>                        <span class="n">left</span><span class="o">=</span><span class="n">many_mile</span><span class="p">,</span>
</span><span id="L-1696"><a href="#L-1696"><span class="linenos">1696</span></a>                        <span class="n">right</span><span class="o">=</span><span class="n">scores</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-1697"><a href="#L-1697"><span class="linenos">1697</span></a>                            <span class="n">scores</span><span class="o">.</span><span class="n">week</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;playoff_start_week&quot;</span><span class="p">],</span>
</span><span id="L-1698"><a href="#L-1698"><span class="linenos">1698</span></a>                            <span class="p">[</span><span class="s2">&quot;team&quot;</span><span class="p">,</span> <span class="s2">&quot;score&quot;</span><span class="p">],</span>
</span><span id="L-1699"><a href="#L-1699"><span class="linenos">1699</span></a>                        <span class="p">],</span>
</span><span id="L-1700"><a href="#L-1700"><span class="linenos">1700</span></a>                        <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
</span><span id="L-1701"><a href="#L-1701"><span class="linenos">1701</span></a>                        <span class="n">on</span><span class="o">=</span><span class="s2">&quot;team&quot;</span><span class="p">,</span>
</span><span id="L-1702"><a href="#L-1702"><span class="linenos">1702</span></a>                    <span class="p">)</span>
</span><span id="L-1703"><a href="#L-1703"><span class="linenos">1703</span></a>                    <span class="n">many_mile</span><span class="o">.</span><span class="n">score</span> <span class="o">=</span> <span class="n">many_mile</span><span class="o">.</span><span class="n">score</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="L-1704"><a href="#L-1704"><span class="linenos">1704</span></a>                    <span class="n">many_mile</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="L-1705"><a href="#L-1705"><span class="linenos">1705</span></a>                        <span class="n">left</span><span class="o">=</span><span class="n">many_mile</span><span class="p">,</span>
</span><span id="L-1706"><a href="#L-1706"><span class="linenos">1706</span></a>                        <span class="n">right</span><span class="o">=</span><span class="n">projections</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-1707"><a href="#L-1707"><span class="linenos">1707</span></a>                            <span class="n">projections</span><span class="o">.</span><span class="n">week</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;playoff_start_week&quot;</span><span class="p">],</span>
</span><span id="L-1708"><a href="#L-1708"><span class="linenos">1708</span></a>                            <span class="p">[</span><span class="s2">&quot;fantasy_team&quot;</span><span class="p">,</span> <span class="s2">&quot;points_avg&quot;</span><span class="p">,</span> <span class="s2">&quot;points_stdev&quot;</span><span class="p">],</span>
</span><span id="L-1709"><a href="#L-1709"><span class="linenos">1709</span></a>                        <span class="p">]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;fantasy_team&quot;</span><span class="p">:</span> <span class="s2">&quot;team&quot;</span><span class="p">}),</span>
</span><span id="L-1710"><a href="#L-1710"><span class="linenos">1710</span></a>                        <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
</span><span id="L-1711"><a href="#L-1711"><span class="linenos">1711</span></a>                        <span class="n">on</span><span class="o">=</span><span class="s2">&quot;team&quot;</span><span class="p">,</span>
</span><span id="L-1712"><a href="#L-1712"><span class="linenos">1712</span></a>                    <span class="p">)</span>
</span><span id="L-1713"><a href="#L-1713"><span class="linenos">1713</span></a>                    <span class="n">many_mile</span><span class="o">.</span><span class="n">points_avg</span> <span class="o">=</span> <span class="n">many_mile</span><span class="o">.</span><span class="n">points_avg</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="L-1714"><a href="#L-1714"><span class="linenos">1714</span></a>                    <span class="n">many_mile</span><span class="o">.</span><span class="n">points_stdev</span> <span class="o">=</span> <span class="n">many_mile</span><span class="o">.</span><span class="n">points_stdev</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="L-1715"><a href="#L-1715"><span class="linenos">1715</span></a>                    <span class="n">many_mile</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">many_mile</span><span class="o">.</span><span class="n">seed</span> <span class="o">==</span> <span class="mi">11</span><span class="p">,</span> <span class="s2">&quot;matchup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1716"><a href="#L-1716"><span class="linenos">1716</span></a>                    <span class="n">many_mile</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">many_mile</span><span class="o">.</span><span class="n">seed</span> <span class="o">==</span> <span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;matchup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-1717"><a href="#L-1717"><span class="linenos">1717</span></a>                    <span class="n">many_mile</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">many_mile</span><span class="o">.</span><span class="n">seed</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">6</span><span class="p">,</span> <span class="mi">9</span><span class="p">]),</span> <span class="s2">&quot;matchup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="L-1718"><a href="#L-1718"><span class="linenos">1718</span></a>                    <span class="n">many_mile</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">many_mile</span><span class="o">.</span><span class="n">seed</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">]),</span> <span class="s2">&quot;matchup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
</span><span id="L-1719"><a href="#L-1719"><span class="linenos">1719</span></a>                    <span class="n">many_mile</span><span class="p">[</span><span class="s2">&quot;sim&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-1720"><a href="#L-1720"><span class="linenos">1720</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">many_mile</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-1721"><a href="#L-1721"><span class="linenos">1721</span></a>                        <span class="o">*</span> <span class="n">many_mile</span><span class="o">.</span><span class="n">points_stdev</span>
</span><span id="L-1722"><a href="#L-1722"><span class="linenos">1722</span></a>                        <span class="o">+</span> <span class="n">many_mile</span><span class="o">.</span><span class="n">points_avg</span>
</span><span id="L-1723"><a href="#L-1723"><span class="linenos">1723</span></a>                        <span class="o">+</span> <span class="n">many_mile</span><span class="o">.</span><span class="n">score</span>
</span><span id="L-1724"><a href="#L-1724"><span class="linenos">1724</span></a>                    <span class="p">)</span>
</span><span id="L-1725"><a href="#L-1725"><span class="linenos">1725</span></a>                    <span class="n">many_mile</span> <span class="o">=</span> <span class="n">many_mile</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
</span><span id="L-1726"><a href="#L-1726"><span class="linenos">1726</span></a>                        <span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;num_sim&quot;</span><span class="p">,</span> <span class="s2">&quot;matchup&quot;</span><span class="p">,</span> <span class="s2">&quot;sim&quot;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span>
</span><span id="L-1727"><a href="#L-1727"><span class="linenos">1727</span></a>                    <span class="p">)</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;num_sim&quot;</span><span class="p">,</span> <span class="s2">&quot;matchup&quot;</span><span class="p">],</span> <span class="n">keep</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)</span>
</span><span id="L-1728"><a href="#L-1728"><span class="linenos">1728</span></a>                    <span class="k">del</span> <span class="p">(</span>
</span><span id="L-1729"><a href="#L-1729"><span class="linenos">1729</span></a>                        <span class="n">many_mile</span><span class="p">[</span><span class="s2">&quot;matchup&quot;</span><span class="p">],</span>
</span><span id="L-1730"><a href="#L-1730"><span class="linenos">1730</span></a>                        <span class="n">many_mile</span><span class="p">[</span><span class="s2">&quot;sim&quot;</span><span class="p">],</span>
</span><span id="L-1731"><a href="#L-1731"><span class="linenos">1731</span></a>                        <span class="n">many_mile</span><span class="p">[</span><span class="s2">&quot;score&quot;</span><span class="p">],</span>
</span><span id="L-1732"><a href="#L-1732"><span class="linenos">1732</span></a>                        <span class="n">many_mile</span><span class="p">[</span><span class="s2">&quot;points_avg&quot;</span><span class="p">],</span>
</span><span id="L-1733"><a href="#L-1733"><span class="linenos">1733</span></a>                        <span class="n">many_mile</span><span class="p">[</span><span class="s2">&quot;points_stdev&quot;</span><span class="p">],</span>
</span><span id="L-1734"><a href="#L-1734"><span class="linenos">1734</span></a>                    <span class="p">)</span>
</span><span id="L-1735"><a href="#L-1735"><span class="linenos">1735</span></a>            <span class="n">playoffs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="L-1736"><a href="#L-1736"><span class="linenos">1736</span></a>                <span class="n">left</span><span class="o">=</span><span class="n">playoffs</span><span class="p">,</span>
</span><span id="L-1737"><a href="#L-1737"><span class="linenos">1737</span></a>                <span class="n">right</span><span class="o">=</span><span class="n">scores</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-1738"><a href="#L-1738"><span class="linenos">1738</span></a>                    <span class="n">scores</span><span class="o">.</span><span class="n">week</span>
</span><span id="L-1739"><a href="#L-1739"><span class="linenos">1739</span></a>                    <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;playoff_start_week&quot;</span><span class="p">]</span>
</span><span id="L-1740"><a href="#L-1740"><span class="linenos">1740</span></a>                    <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;num_playoff_teams&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">6</span><span class="p">),</span>
</span><span id="L-1741"><a href="#L-1741"><span class="linenos">1741</span></a>                    <span class="p">[</span><span class="s2">&quot;team&quot;</span><span class="p">,</span> <span class="s2">&quot;score&quot;</span><span class="p">],</span>
</span><span id="L-1742"><a href="#L-1742"><span class="linenos">1742</span></a>                <span class="p">],</span>
</span><span id="L-1743"><a href="#L-1743"><span class="linenos">1743</span></a>                <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
</span><span id="L-1744"><a href="#L-1744"><span class="linenos">1744</span></a>                <span class="n">on</span><span class="o">=</span><span class="s2">&quot;team&quot;</span><span class="p">,</span>
</span><span id="L-1745"><a href="#L-1745"><span class="linenos">1745</span></a>            <span class="p">)</span>
</span><span id="L-1746"><a href="#L-1746"><span class="linenos">1746</span></a>            <span class="n">playoffs</span><span class="o">.</span><span class="n">score</span> <span class="o">=</span> <span class="n">playoffs</span><span class="o">.</span><span class="n">score</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="L-1747"><a href="#L-1747"><span class="linenos">1747</span></a>            <span class="n">playoffs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="L-1748"><a href="#L-1748"><span class="linenos">1748</span></a>                <span class="n">left</span><span class="o">=</span><span class="n">playoffs</span><span class="p">,</span>
</span><span id="L-1749"><a href="#L-1749"><span class="linenos">1749</span></a>                <span class="n">right</span><span class="o">=</span><span class="n">projections</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-1750"><a href="#L-1750"><span class="linenos">1750</span></a>                    <span class="n">projections</span><span class="o">.</span><span class="n">week</span>
</span><span id="L-1751"><a href="#L-1751"><span class="linenos">1751</span></a>                    <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;playoff_start_week&quot;</span><span class="p">]</span>
</span><span id="L-1752"><a href="#L-1752"><span class="linenos">1752</span></a>                    <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;num_playoff_teams&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">6</span><span class="p">),</span>
</span><span id="L-1753"><a href="#L-1753"><span class="linenos">1753</span></a>                    <span class="p">[</span><span class="s2">&quot;fantasy_team&quot;</span><span class="p">,</span> <span class="s2">&quot;points_avg&quot;</span><span class="p">,</span> <span class="s2">&quot;points_stdev&quot;</span><span class="p">],</span>
</span><span id="L-1754"><a href="#L-1754"><span class="linenos">1754</span></a>                <span class="p">]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;fantasy_team&quot;</span><span class="p">:</span> <span class="s2">&quot;team&quot;</span><span class="p">}),</span>
</span><span id="L-1755"><a href="#L-1755"><span class="linenos">1755</span></a>                <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
</span><span id="L-1756"><a href="#L-1756"><span class="linenos">1756</span></a>                <span class="n">on</span><span class="o">=</span><span class="s2">&quot;team&quot;</span><span class="p">,</span>
</span><span id="L-1757"><a href="#L-1757"><span class="linenos">1757</span></a>            <span class="p">)</span>
</span><span id="L-1758"><a href="#L-1758"><span class="linenos">1758</span></a>            <span class="n">playoffs</span><span class="o">.</span><span class="n">points_avg</span> <span class="o">=</span> <span class="n">playoffs</span><span class="o">.</span><span class="n">points_avg</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="L-1759"><a href="#L-1759"><span class="linenos">1759</span></a>            <span class="n">playoffs</span><span class="o">.</span><span class="n">points_stdev</span> <span class="o">=</span> <span class="n">playoffs</span><span class="o">.</span><span class="n">points_stdev</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="L-1760"><a href="#L-1760"><span class="linenos">1760</span></a>            <span class="n">playoffs</span><span class="p">[</span><span class="s2">&quot;seed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">playoffs</span><span class="o">.</span><span class="n">index</span> <span class="o">%</span> <span class="mi">4</span>
</span><span id="L-1761"><a href="#L-1761"><span class="linenos">1761</span></a>            <span class="n">playoffs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">playoffs</span><span class="o">.</span><span class="n">seed</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">]),</span> <span class="s2">&quot;matchup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1762"><a href="#L-1762"><span class="linenos">1762</span></a>            <span class="n">playoffs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">playoffs</span><span class="o">.</span><span class="n">seed</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]),</span> <span class="s2">&quot;matchup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-1763"><a href="#L-1763"><span class="linenos">1763</span></a>            <span class="n">playoffs</span><span class="p">[</span><span class="s2">&quot;sim&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-1764"><a href="#L-1764"><span class="linenos">1764</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">playoffs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-1765"><a href="#L-1765"><span class="linenos">1765</span></a>                <span class="o">*</span> <span class="n">playoffs</span><span class="o">.</span><span class="n">points_stdev</span>
</span><span id="L-1766"><a href="#L-1766"><span class="linenos">1766</span></a>                <span class="o">+</span> <span class="n">playoffs</span><span class="o">.</span><span class="n">points_avg</span>
</span><span id="L-1767"><a href="#L-1767"><span class="linenos">1767</span></a>                <span class="o">+</span> <span class="n">playoffs</span><span class="o">.</span><span class="n">score</span>
</span><span id="L-1768"><a href="#L-1768"><span class="linenos">1768</span></a>            <span class="p">)</span>
</span><span id="L-1769"><a href="#L-1769"><span class="linenos">1769</span></a>            <span class="n">consolation</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-1770"><a href="#L-1770"><span class="linenos">1770</span></a>                <span class="n">playoffs</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;num_sim&quot;</span><span class="p">,</span> <span class="s2">&quot;matchup&quot;</span><span class="p">,</span> <span class="s2">&quot;sim&quot;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1771"><a href="#L-1771"><span class="linenos">1771</span></a>                <span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;num_sim&quot;</span><span class="p">,</span> <span class="s2">&quot;matchup&quot;</span><span class="p">],</span> <span class="n">keep</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)</span>
</span><span id="L-1772"><a href="#L-1772"><span class="linenos">1772</span></a>                <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1773"><a href="#L-1773"><span class="linenos">1773</span></a>            <span class="p">)</span>
</span><span id="L-1774"><a href="#L-1774"><span class="linenos">1774</span></a>            <span class="n">playoffs</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-1775"><a href="#L-1775"><span class="linenos">1775</span></a>                <span class="n">playoffs</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
</span><span id="L-1776"><a href="#L-1776"><span class="linenos">1776</span></a>                    <span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;num_sim&quot;</span><span class="p">,</span> <span class="s2">&quot;matchup&quot;</span><span class="p">,</span> <span class="s2">&quot;sim&quot;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]</span>
</span><span id="L-1777"><a href="#L-1777"><span class="linenos">1777</span></a>                <span class="p">)</span>
</span><span id="L-1778"><a href="#L-1778"><span class="linenos">1778</span></a>                <span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;num_sim&quot;</span><span class="p">,</span> <span class="s2">&quot;matchup&quot;</span><span class="p">],</span> <span class="n">keep</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)</span>
</span><span id="L-1779"><a href="#L-1779"><span class="linenos">1779</span></a>                <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1780"><a href="#L-1780"><span class="linenos">1780</span></a>            <span class="p">)</span>
</span><span id="L-1781"><a href="#L-1781"><span class="linenos">1781</span></a>            <span class="k">del</span> <span class="p">(</span>
</span><span id="L-1782"><a href="#L-1782"><span class="linenos">1782</span></a>                <span class="n">playoffs</span><span class="p">[</span><span class="s2">&quot;matchup&quot;</span><span class="p">],</span>
</span><span id="L-1783"><a href="#L-1783"><span class="linenos">1783</span></a>                <span class="n">playoffs</span><span class="p">[</span><span class="s2">&quot;sim&quot;</span><span class="p">],</span>
</span><span id="L-1784"><a href="#L-1784"><span class="linenos">1784</span></a>                <span class="n">playoffs</span><span class="p">[</span><span class="s2">&quot;score&quot;</span><span class="p">],</span>
</span><span id="L-1785"><a href="#L-1785"><span class="linenos">1785</span></a>                <span class="n">playoffs</span><span class="p">[</span><span class="s2">&quot;points_avg&quot;</span><span class="p">],</span>
</span><span id="L-1786"><a href="#L-1786"><span class="linenos">1786</span></a>                <span class="n">playoffs</span><span class="p">[</span><span class="s2">&quot;points_stdev&quot;</span><span class="p">],</span>
</span><span id="L-1787"><a href="#L-1787"><span class="linenos">1787</span></a>                <span class="n">consolation</span><span class="p">[</span><span class="s2">&quot;matchup&quot;</span><span class="p">],</span>
</span><span id="L-1788"><a href="#L-1788"><span class="linenos">1788</span></a>                <span class="n">consolation</span><span class="p">[</span><span class="s2">&quot;sim&quot;</span><span class="p">],</span>
</span><span id="L-1789"><a href="#L-1789"><span class="linenos">1789</span></a>                <span class="n">consolation</span><span class="p">[</span><span class="s2">&quot;score&quot;</span><span class="p">],</span>
</span><span id="L-1790"><a href="#L-1790"><span class="linenos">1790</span></a>                <span class="n">consolation</span><span class="p">[</span><span class="s2">&quot;points_avg&quot;</span><span class="p">],</span>
</span><span id="L-1791"><a href="#L-1791"><span class="linenos">1791</span></a>                <span class="n">consolation</span><span class="p">[</span><span class="s2">&quot;points_stdev&quot;</span><span class="p">],</span>
</span><span id="L-1792"><a href="#L-1792"><span class="linenos">1792</span></a>            <span class="p">)</span>
</span><span id="L-1793"><a href="#L-1793"><span class="linenos">1793</span></a>            <span class="k">if</span> <span class="n">algorithm</span><span class="p">:</span>
</span><span id="L-1794"><a href="#L-1794"><span class="linenos">1794</span></a>                <span class="n">many_mile</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="L-1795"><a href="#L-1795"><span class="linenos">1795</span></a>                    <span class="n">left</span><span class="o">=</span><span class="n">many_mile</span><span class="p">,</span>
</span><span id="L-1796"><a href="#L-1796"><span class="linenos">1796</span></a>                    <span class="n">right</span><span class="o">=</span><span class="n">scores</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-1797"><a href="#L-1797"><span class="linenos">1797</span></a>                        <span class="n">scores</span><span class="o">.</span><span class="n">week</span>
</span><span id="L-1798"><a href="#L-1798"><span class="linenos">1798</span></a>                        <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;playoff_start_week&quot;</span><span class="p">]</span>
</span><span id="L-1799"><a href="#L-1799"><span class="linenos">1799</span></a>                        <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;num_playoff_teams&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">6</span><span class="p">),</span>
</span><span id="L-1800"><a href="#L-1800"><span class="linenos">1800</span></a>                        <span class="p">[</span><span class="s2">&quot;team&quot;</span><span class="p">,</span> <span class="s2">&quot;score&quot;</span><span class="p">],</span>
</span><span id="L-1801"><a href="#L-1801"><span class="linenos">1801</span></a>                    <span class="p">],</span>
</span><span id="L-1802"><a href="#L-1802"><span class="linenos">1802</span></a>                    <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
</span><span id="L-1803"><a href="#L-1803"><span class="linenos">1803</span></a>                    <span class="n">on</span><span class="o">=</span><span class="s2">&quot;team&quot;</span><span class="p">,</span>
</span><span id="L-1804"><a href="#L-1804"><span class="linenos">1804</span></a>                <span class="p">)</span>
</span><span id="L-1805"><a href="#L-1805"><span class="linenos">1805</span></a>                <span class="n">many_mile</span><span class="o">.</span><span class="n">score</span> <span class="o">=</span> <span class="n">many_mile</span><span class="o">.</span><span class="n">score</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="L-1806"><a href="#L-1806"><span class="linenos">1806</span></a>                <span class="n">many_mile</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="L-1807"><a href="#L-1807"><span class="linenos">1807</span></a>                    <span class="n">left</span><span class="o">=</span><span class="n">many_mile</span><span class="p">,</span>
</span><span id="L-1808"><a href="#L-1808"><span class="linenos">1808</span></a>                    <span class="n">right</span><span class="o">=</span><span class="n">projections</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-1809"><a href="#L-1809"><span class="linenos">1809</span></a>                        <span class="n">projections</span><span class="o">.</span><span class="n">week</span>
</span><span id="L-1810"><a href="#L-1810"><span class="linenos">1810</span></a>                        <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;playoff_start_week&quot;</span><span class="p">]</span>
</span><span id="L-1811"><a href="#L-1811"><span class="linenos">1811</span></a>                        <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;num_playoff_teams&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">6</span><span class="p">),</span>
</span><span id="L-1812"><a href="#L-1812"><span class="linenos">1812</span></a>                        <span class="p">[</span><span class="s2">&quot;fantasy_team&quot;</span><span class="p">,</span> <span class="s2">&quot;points_avg&quot;</span><span class="p">,</span> <span class="s2">&quot;points_stdev&quot;</span><span class="p">],</span>
</span><span id="L-1813"><a href="#L-1813"><span class="linenos">1813</span></a>                    <span class="p">]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;fantasy_team&quot;</span><span class="p">:</span> <span class="s2">&quot;team&quot;</span><span class="p">}),</span>
</span><span id="L-1814"><a href="#L-1814"><span class="linenos">1814</span></a>                    <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
</span><span id="L-1815"><a href="#L-1815"><span class="linenos">1815</span></a>                    <span class="n">on</span><span class="o">=</span><span class="s2">&quot;team&quot;</span><span class="p">,</span>
</span><span id="L-1816"><a href="#L-1816"><span class="linenos">1816</span></a>                <span class="p">)</span>
</span><span id="L-1817"><a href="#L-1817"><span class="linenos">1817</span></a>                <span class="n">many_mile</span><span class="o">.</span><span class="n">points_avg</span> <span class="o">=</span> <span class="n">many_mile</span><span class="o">.</span><span class="n">points_avg</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="L-1818"><a href="#L-1818"><span class="linenos">1818</span></a>                <span class="n">many_mile</span><span class="o">.</span><span class="n">points_stdev</span> <span class="o">=</span> <span class="n">many_mile</span><span class="o">.</span><span class="n">points_stdev</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="L-1819"><a href="#L-1819"><span class="linenos">1819</span></a>                <span class="n">many_mile</span><span class="p">[</span><span class="s2">&quot;seed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">many_mile</span><span class="o">.</span><span class="n">index</span> <span class="o">%</span> <span class="mi">4</span>
</span><span id="L-1820"><a href="#L-1820"><span class="linenos">1820</span></a>                <span class="n">many_mile</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">many_mile</span><span class="o">.</span><span class="n">seed</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">]),</span> <span class="s2">&quot;matchup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1821"><a href="#L-1821"><span class="linenos">1821</span></a>                <span class="n">many_mile</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">many_mile</span><span class="o">.</span><span class="n">seed</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]),</span> <span class="s2">&quot;matchup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-1822"><a href="#L-1822"><span class="linenos">1822</span></a>                <span class="n">many_mile</span><span class="p">[</span><span class="s2">&quot;sim&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-1823"><a href="#L-1823"><span class="linenos">1823</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">many_mile</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-1824"><a href="#L-1824"><span class="linenos">1824</span></a>                    <span class="o">*</span> <span class="n">many_mile</span><span class="o">.</span><span class="n">points_stdev</span>
</span><span id="L-1825"><a href="#L-1825"><span class="linenos">1825</span></a>                    <span class="o">+</span> <span class="n">many_mile</span><span class="o">.</span><span class="n">points_avg</span>
</span><span id="L-1826"><a href="#L-1826"><span class="linenos">1826</span></a>                    <span class="o">+</span> <span class="n">many_mile</span><span class="o">.</span><span class="n">score</span>
</span><span id="L-1827"><a href="#L-1827"><span class="linenos">1827</span></a>                <span class="p">)</span>
</span><span id="L-1828"><a href="#L-1828"><span class="linenos">1828</span></a>                <span class="n">many_mile</span> <span class="o">=</span> <span class="n">many_mile</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
</span><span id="L-1829"><a href="#L-1829"><span class="linenos">1829</span></a>                    <span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;num_sim&quot;</span><span class="p">,</span> <span class="s2">&quot;matchup&quot;</span><span class="p">,</span> <span class="s2">&quot;sim&quot;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span>
</span><span id="L-1830"><a href="#L-1830"><span class="linenos">1830</span></a>                <span class="p">)</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;num_sim&quot;</span><span class="p">,</span> <span class="s2">&quot;matchup&quot;</span><span class="p">],</span> <span class="n">keep</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)</span>
</span><span id="L-1831"><a href="#L-1831"><span class="linenos">1831</span></a>                <span class="k">del</span> <span class="p">(</span>
</span><span id="L-1832"><a href="#L-1832"><span class="linenos">1832</span></a>                    <span class="n">many_mile</span><span class="p">[</span><span class="s2">&quot;matchup&quot;</span><span class="p">],</span>
</span><span id="L-1833"><a href="#L-1833"><span class="linenos">1833</span></a>                    <span class="n">many_mile</span><span class="p">[</span><span class="s2">&quot;sim&quot;</span><span class="p">],</span>
</span><span id="L-1834"><a href="#L-1834"><span class="linenos">1834</span></a>                    <span class="n">many_mile</span><span class="p">[</span><span class="s2">&quot;score&quot;</span><span class="p">],</span>
</span><span id="L-1835"><a href="#L-1835"><span class="linenos">1835</span></a>                    <span class="n">many_mile</span><span class="p">[</span><span class="s2">&quot;points_avg&quot;</span><span class="p">],</span>
</span><span id="L-1836"><a href="#L-1836"><span class="linenos">1836</span></a>                    <span class="n">many_mile</span><span class="p">[</span><span class="s2">&quot;points_stdev&quot;</span><span class="p">],</span>
</span><span id="L-1837"><a href="#L-1837"><span class="linenos">1837</span></a>                <span class="p">)</span>
</span><span id="L-1838"><a href="#L-1838"><span class="linenos">1838</span></a>            <span class="n">playoffs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="L-1839"><a href="#L-1839"><span class="linenos">1839</span></a>                <span class="n">left</span><span class="o">=</span><span class="n">playoffs</span><span class="p">,</span>
</span><span id="L-1840"><a href="#L-1840"><span class="linenos">1840</span></a>                <span class="n">right</span><span class="o">=</span><span class="n">scores</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-1841"><a href="#L-1841"><span class="linenos">1841</span></a>                    <span class="n">scores</span><span class="o">.</span><span class="n">week</span>
</span><span id="L-1842"><a href="#L-1842"><span class="linenos">1842</span></a>                    <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;playoff_start_week&quot;</span><span class="p">]</span>
</span><span id="L-1843"><a href="#L-1843"><span class="linenos">1843</span></a>                    <span class="o">+</span> <span class="mi">1</span>
</span><span id="L-1844"><a href="#L-1844"><span class="linenos">1844</span></a>                    <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;num_playoff_teams&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">6</span><span class="p">),</span>
</span><span id="L-1845"><a href="#L-1845"><span class="linenos">1845</span></a>                    <span class="p">[</span><span class="s2">&quot;team&quot;</span><span class="p">,</span> <span class="s2">&quot;score&quot;</span><span class="p">],</span>
</span><span id="L-1846"><a href="#L-1846"><span class="linenos">1846</span></a>                <span class="p">],</span>
</span><span id="L-1847"><a href="#L-1847"><span class="linenos">1847</span></a>                <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
</span><span id="L-1848"><a href="#L-1848"><span class="linenos">1848</span></a>                <span class="n">on</span><span class="o">=</span><span class="s2">&quot;team&quot;</span><span class="p">,</span>
</span><span id="L-1849"><a href="#L-1849"><span class="linenos">1849</span></a>            <span class="p">)</span>
</span><span id="L-1850"><a href="#L-1850"><span class="linenos">1850</span></a>            <span class="n">playoffs</span><span class="o">.</span><span class="n">score</span> <span class="o">=</span> <span class="n">playoffs</span><span class="o">.</span><span class="n">score</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="L-1851"><a href="#L-1851"><span class="linenos">1851</span></a>            <span class="n">playoffs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="L-1852"><a href="#L-1852"><span class="linenos">1852</span></a>                <span class="n">left</span><span class="o">=</span><span class="n">playoffs</span><span class="p">,</span>
</span><span id="L-1853"><a href="#L-1853"><span class="linenos">1853</span></a>                <span class="n">right</span><span class="o">=</span><span class="n">projections</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-1854"><a href="#L-1854"><span class="linenos">1854</span></a>                    <span class="n">projections</span><span class="o">.</span><span class="n">week</span>
</span><span id="L-1855"><a href="#L-1855"><span class="linenos">1855</span></a>                    <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;playoff_start_week&quot;</span><span class="p">]</span>
</span><span id="L-1856"><a href="#L-1856"><span class="linenos">1856</span></a>                    <span class="o">+</span> <span class="mi">1</span>
</span><span id="L-1857"><a href="#L-1857"><span class="linenos">1857</span></a>                    <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;num_playoff_teams&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">6</span><span class="p">),</span>
</span><span id="L-1858"><a href="#L-1858"><span class="linenos">1858</span></a>                    <span class="p">[</span><span class="s2">&quot;fantasy_team&quot;</span><span class="p">,</span> <span class="s2">&quot;points_avg&quot;</span><span class="p">,</span> <span class="s2">&quot;points_stdev&quot;</span><span class="p">],</span>
</span><span id="L-1859"><a href="#L-1859"><span class="linenos">1859</span></a>                <span class="p">]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;fantasy_team&quot;</span><span class="p">:</span> <span class="s2">&quot;team&quot;</span><span class="p">}),</span>
</span><span id="L-1860"><a href="#L-1860"><span class="linenos">1860</span></a>                <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
</span><span id="L-1861"><a href="#L-1861"><span class="linenos">1861</span></a>                <span class="n">on</span><span class="o">=</span><span class="s2">&quot;team&quot;</span><span class="p">,</span>
</span><span id="L-1862"><a href="#L-1862"><span class="linenos">1862</span></a>            <span class="p">)</span>
</span><span id="L-1863"><a href="#L-1863"><span class="linenos">1863</span></a>            <span class="n">playoffs</span><span class="o">.</span><span class="n">points_avg</span> <span class="o">=</span> <span class="n">playoffs</span><span class="o">.</span><span class="n">points_avg</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="L-1864"><a href="#L-1864"><span class="linenos">1864</span></a>            <span class="n">playoffs</span><span class="o">.</span><span class="n">points_stdev</span> <span class="o">=</span> <span class="n">playoffs</span><span class="o">.</span><span class="n">points_stdev</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="L-1865"><a href="#L-1865"><span class="linenos">1865</span></a>            <span class="n">playoffs</span><span class="p">[</span><span class="s2">&quot;sim&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-1866"><a href="#L-1866"><span class="linenos">1866</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">playoffs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-1867"><a href="#L-1867"><span class="linenos">1867</span></a>                <span class="o">*</span> <span class="n">playoffs</span><span class="o">.</span><span class="n">points_stdev</span>
</span><span id="L-1868"><a href="#L-1868"><span class="linenos">1868</span></a>                <span class="o">+</span> <span class="n">playoffs</span><span class="o">.</span><span class="n">points_avg</span>
</span><span id="L-1869"><a href="#L-1869"><span class="linenos">1869</span></a>                <span class="o">+</span> <span class="n">playoffs</span><span class="o">.</span><span class="n">score</span>
</span><span id="L-1870"><a href="#L-1870"><span class="linenos">1870</span></a>            <span class="p">)</span>
</span><span id="L-1871"><a href="#L-1871"><span class="linenos">1871</span></a>            <span class="n">runner_up</span> <span class="o">=</span> <span class="n">playoffs</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
</span><span id="L-1872"><a href="#L-1872"><span class="linenos">1872</span></a>                <span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;num_sim&quot;</span><span class="p">,</span> <span class="s2">&quot;sim&quot;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span>
</span><span id="L-1873"><a href="#L-1873"><span class="linenos">1873</span></a>            <span class="p">)</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;num_sim&quot;</span><span class="p">],</span> <span class="n">keep</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)</span>
</span><span id="L-1874"><a href="#L-1874"><span class="linenos">1874</span></a>            <span class="n">winner</span> <span class="o">=</span> <span class="n">playoffs</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
</span><span id="L-1875"><a href="#L-1875"><span class="linenos">1875</span></a>                <span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;num_sim&quot;</span><span class="p">,</span> <span class="s2">&quot;sim&quot;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]</span>
</span><span id="L-1876"><a href="#L-1876"><span class="linenos">1876</span></a>            <span class="p">)</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;num_sim&quot;</span><span class="p">],</span> <span class="n">keep</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)</span>
</span><span id="L-1877"><a href="#L-1877"><span class="linenos">1877</span></a>            <span class="n">consolation</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="L-1878"><a href="#L-1878"><span class="linenos">1878</span></a>                <span class="n">left</span><span class="o">=</span><span class="n">consolation</span><span class="p">,</span>
</span><span id="L-1879"><a href="#L-1879"><span class="linenos">1879</span></a>                <span class="n">right</span><span class="o">=</span><span class="n">scores</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-1880"><a href="#L-1880"><span class="linenos">1880</span></a>                    <span class="n">scores</span><span class="o">.</span><span class="n">week</span>
</span><span id="L-1881"><a href="#L-1881"><span class="linenos">1881</span></a>                    <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;playoff_start_week&quot;</span><span class="p">]</span>
</span><span id="L-1882"><a href="#L-1882"><span class="linenos">1882</span></a>                    <span class="o">+</span> <span class="mi">1</span>
</span><span id="L-1883"><a href="#L-1883"><span class="linenos">1883</span></a>                    <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;num_playoff_teams&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">6</span><span class="p">),</span>
</span><span id="L-1884"><a href="#L-1884"><span class="linenos">1884</span></a>                    <span class="p">[</span><span class="s2">&quot;team&quot;</span><span class="p">,</span> <span class="s2">&quot;score&quot;</span><span class="p">],</span>
</span><span id="L-1885"><a href="#L-1885"><span class="linenos">1885</span></a>                <span class="p">],</span>
</span><span id="L-1886"><a href="#L-1886"><span class="linenos">1886</span></a>                <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
</span><span id="L-1887"><a href="#L-1887"><span class="linenos">1887</span></a>                <span class="n">on</span><span class="o">=</span><span class="s2">&quot;team&quot;</span><span class="p">,</span>
</span><span id="L-1888"><a href="#L-1888"><span class="linenos">1888</span></a>            <span class="p">)</span>
</span><span id="L-1889"><a href="#L-1889"><span class="linenos">1889</span></a>            <span class="n">consolation</span><span class="o">.</span><span class="n">score</span> <span class="o">=</span> <span class="n">consolation</span><span class="o">.</span><span class="n">score</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="L-1890"><a href="#L-1890"><span class="linenos">1890</span></a>            <span class="n">consolation</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="L-1891"><a href="#L-1891"><span class="linenos">1891</span></a>                <span class="n">left</span><span class="o">=</span><span class="n">consolation</span><span class="p">,</span>
</span><span id="L-1892"><a href="#L-1892"><span class="linenos">1892</span></a>                <span class="n">right</span><span class="o">=</span><span class="n">projections</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-1893"><a href="#L-1893"><span class="linenos">1893</span></a>                    <span class="n">projections</span><span class="o">.</span><span class="n">week</span>
</span><span id="L-1894"><a href="#L-1894"><span class="linenos">1894</span></a>                    <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;playoff_start_week&quot;</span><span class="p">]</span>
</span><span id="L-1895"><a href="#L-1895"><span class="linenos">1895</span></a>                    <span class="o">+</span> <span class="mi">1</span>
</span><span id="L-1896"><a href="#L-1896"><span class="linenos">1896</span></a>                    <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;num_playoff_teams&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">6</span><span class="p">),</span>
</span><span id="L-1897"><a href="#L-1897"><span class="linenos">1897</span></a>                    <span class="p">[</span><span class="s2">&quot;fantasy_team&quot;</span><span class="p">,</span> <span class="s2">&quot;points_avg&quot;</span><span class="p">,</span> <span class="s2">&quot;points_stdev&quot;</span><span class="p">],</span>
</span><span id="L-1898"><a href="#L-1898"><span class="linenos">1898</span></a>                <span class="p">]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;fantasy_team&quot;</span><span class="p">:</span> <span class="s2">&quot;team&quot;</span><span class="p">}),</span>
</span><span id="L-1899"><a href="#L-1899"><span class="linenos">1899</span></a>                <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">,</span>
</span><span id="L-1900"><a href="#L-1900"><span class="linenos">1900</span></a>                <span class="n">on</span><span class="o">=</span><span class="s2">&quot;team&quot;</span><span class="p">,</span>
</span><span id="L-1901"><a href="#L-1901"><span class="linenos">1901</span></a>            <span class="p">)</span>
</span><span id="L-1902"><a href="#L-1902"><span class="linenos">1902</span></a>            <span class="n">consolation</span><span class="p">[</span><span class="s2">&quot;sim&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-1903"><a href="#L-1903"><span class="linenos">1903</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">consolation</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-1904"><a href="#L-1904"><span class="linenos">1904</span></a>                <span class="o">*</span> <span class="n">consolation</span><span class="o">.</span><span class="n">points_stdev</span>
</span><span id="L-1905"><a href="#L-1905"><span class="linenos">1905</span></a>                <span class="o">+</span> <span class="n">consolation</span><span class="o">.</span><span class="n">points_avg</span>
</span><span id="L-1906"><a href="#L-1906"><span class="linenos">1906</span></a>                <span class="o">+</span> <span class="n">consolation</span><span class="o">.</span><span class="n">score</span>
</span><span id="L-1907"><a href="#L-1907"><span class="linenos">1907</span></a>            <span class="p">)</span>
</span><span id="L-1908"><a href="#L-1908"><span class="linenos">1908</span></a>            <span class="n">third</span> <span class="o">=</span> <span class="n">consolation</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
</span><span id="L-1909"><a href="#L-1909"><span class="linenos">1909</span></a>                <span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;num_sim&quot;</span><span class="p">,</span> <span class="s2">&quot;sim&quot;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]</span>
</span><span id="L-1910"><a href="#L-1910"><span class="linenos">1910</span></a>            <span class="p">)</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;num_sim&quot;</span><span class="p">],</span> <span class="n">keep</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)</span>
</span><span id="L-1911"><a href="#L-1911"><span class="linenos">1911</span></a>            <span class="k">if</span> <span class="n">algorithm</span><span class="p">:</span>
</span><span id="L-1912"><a href="#L-1912"><span class="linenos">1912</span></a>                <span class="n">many_mile</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="L-1913"><a href="#L-1913"><span class="linenos">1913</span></a>                    <span class="n">left</span><span class="o">=</span><span class="n">many_mile</span><span class="p">,</span>
</span><span id="L-1914"><a href="#L-1914"><span class="linenos">1914</span></a>                    <span class="n">right</span><span class="o">=</span><span class="n">scores</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-1915"><a href="#L-1915"><span class="linenos">1915</span></a>                        <span class="n">scores</span><span class="o">.</span><span class="n">week</span>
</span><span id="L-1916"><a href="#L-1916"><span class="linenos">1916</span></a>                        <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;playoff_start_week&quot;</span><span class="p">]</span>
</span><span id="L-1917"><a href="#L-1917"><span class="linenos">1917</span></a>                        <span class="o">+</span> <span class="mi">1</span>
</span><span id="L-1918"><a href="#L-1918"><span class="linenos">1918</span></a>                        <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;num_playoff_teams&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">6</span><span class="p">),</span>
</span><span id="L-1919"><a href="#L-1919"><span class="linenos">1919</span></a>                        <span class="p">[</span><span class="s2">&quot;team&quot;</span><span class="p">,</span> <span class="s2">&quot;score&quot;</span><span class="p">],</span>
</span><span id="L-1920"><a href="#L-1920"><span class="linenos">1920</span></a>                    <span class="p">],</span>
</span><span id="L-1921"><a href="#L-1921"><span class="linenos">1921</span></a>                    <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
</span><span id="L-1922"><a href="#L-1922"><span class="linenos">1922</span></a>                    <span class="n">on</span><span class="o">=</span><span class="s2">&quot;team&quot;</span><span class="p">,</span>
</span><span id="L-1923"><a href="#L-1923"><span class="linenos">1923</span></a>                <span class="p">)</span>
</span><span id="L-1924"><a href="#L-1924"><span class="linenos">1924</span></a>                <span class="n">many_mile</span><span class="o">.</span><span class="n">score</span> <span class="o">=</span> <span class="n">many_mile</span><span class="o">.</span><span class="n">score</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="L-1925"><a href="#L-1925"><span class="linenos">1925</span></a>                <span class="n">many_mile</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="L-1926"><a href="#L-1926"><span class="linenos">1926</span></a>                    <span class="n">left</span><span class="o">=</span><span class="n">many_mile</span><span class="p">,</span>
</span><span id="L-1927"><a href="#L-1927"><span class="linenos">1927</span></a>                    <span class="n">right</span><span class="o">=</span><span class="n">projections</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-1928"><a href="#L-1928"><span class="linenos">1928</span></a>                        <span class="n">projections</span><span class="o">.</span><span class="n">week</span>
</span><span id="L-1929"><a href="#L-1929"><span class="linenos">1929</span></a>                        <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;playoff_start_week&quot;</span><span class="p">]</span>
</span><span id="L-1930"><a href="#L-1930"><span class="linenos">1930</span></a>                        <span class="o">+</span> <span class="mi">1</span>
</span><span id="L-1931"><a href="#L-1931"><span class="linenos">1931</span></a>                        <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;num_playoff_teams&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">6</span><span class="p">),</span>
</span><span id="L-1932"><a href="#L-1932"><span class="linenos">1932</span></a>                        <span class="p">[</span><span class="s2">&quot;fantasy_team&quot;</span><span class="p">,</span> <span class="s2">&quot;points_avg&quot;</span><span class="p">,</span> <span class="s2">&quot;points_stdev&quot;</span><span class="p">],</span>
</span><span id="L-1933"><a href="#L-1933"><span class="linenos">1933</span></a>                    <span class="p">]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;fantasy_team&quot;</span><span class="p">:</span> <span class="s2">&quot;team&quot;</span><span class="p">}),</span>
</span><span id="L-1934"><a href="#L-1934"><span class="linenos">1934</span></a>                    <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
</span><span id="L-1935"><a href="#L-1935"><span class="linenos">1935</span></a>                    <span class="n">on</span><span class="o">=</span><span class="s2">&quot;team&quot;</span><span class="p">,</span>
</span><span id="L-1936"><a href="#L-1936"><span class="linenos">1936</span></a>                <span class="p">)</span>
</span><span id="L-1937"><a href="#L-1937"><span class="linenos">1937</span></a>                <span class="n">many_mile</span><span class="o">.</span><span class="n">points_avg</span> <span class="o">=</span> <span class="n">many_mile</span><span class="o">.</span><span class="n">points_avg</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="L-1938"><a href="#L-1938"><span class="linenos">1938</span></a>                <span class="n">many_mile</span><span class="o">.</span><span class="n">points_stdev</span> <span class="o">=</span> <span class="n">many_mile</span><span class="o">.</span><span class="n">points_stdev</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="L-1939"><a href="#L-1939"><span class="linenos">1939</span></a>                <span class="n">many_mile</span><span class="p">[</span><span class="s2">&quot;sim&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-1940"><a href="#L-1940"><span class="linenos">1940</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">many_mile</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-1941"><a href="#L-1941"><span class="linenos">1941</span></a>                    <span class="o">*</span> <span class="n">many_mile</span><span class="o">.</span><span class="n">points_stdev</span>
</span><span id="L-1942"><a href="#L-1942"><span class="linenos">1942</span></a>                    <span class="o">+</span> <span class="n">many_mile</span><span class="o">.</span><span class="n">points_avg</span>
</span><span id="L-1943"><a href="#L-1943"><span class="linenos">1943</span></a>                    <span class="o">+</span> <span class="n">many_mile</span><span class="o">.</span><span class="n">score</span>
</span><span id="L-1944"><a href="#L-1944"><span class="linenos">1944</span></a>                <span class="p">)</span>
</span><span id="L-1945"><a href="#L-1945"><span class="linenos">1945</span></a>                <span class="n">many_mile</span> <span class="o">=</span> <span class="n">many_mile</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
</span><span id="L-1946"><a href="#L-1946"><span class="linenos">1946</span></a>                    <span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;num_sim&quot;</span><span class="p">,</span> <span class="s2">&quot;sim&quot;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span>
</span><span id="L-1947"><a href="#L-1947"><span class="linenos">1947</span></a>                <span class="p">)</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;num_sim&quot;</span><span class="p">],</span> <span class="n">keep</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)</span>
</span><span id="L-1948"><a href="#L-1948"><span class="linenos">1948</span></a>            <span class="n">final_probs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="L-1949"><a href="#L-1949"><span class="linenos">1949</span></a>                <span class="n">left</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="L-1950"><a href="#L-1950"><span class="linenos">1950</span></a>                    <span class="n">left</span><span class="o">=</span><span class="n">winner</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;team&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s2">&quot;winner&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(),</span>
</span><span id="L-1951"><a href="#L-1951"><span class="linenos">1951</span></a>                    <span class="n">right</span><span class="o">=</span><span class="n">runner_up</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;team&quot;</span><span class="p">)</span>
</span><span id="L-1952"><a href="#L-1952"><span class="linenos">1952</span></a>                    <span class="o">.</span><span class="n">size</span><span class="p">()</span>
</span><span id="L-1953"><a href="#L-1953"><span class="linenos">1953</span></a>                    <span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s2">&quot;runner_up&quot;</span><span class="p">)</span>
</span><span id="L-1954"><a href="#L-1954"><span class="linenos">1954</span></a>                    <span class="o">.</span><span class="n">reset_index</span><span class="p">(),</span>
</span><span id="L-1955"><a href="#L-1955"><span class="linenos">1955</span></a>                    <span class="n">how</span><span class="o">=</span><span class="s2">&quot;outer&quot;</span><span class="p">,</span>
</span><span id="L-1956"><a href="#L-1956"><span class="linenos">1956</span></a>                    <span class="n">on</span><span class="o">=</span><span class="s2">&quot;team&quot;</span><span class="p">,</span>
</span><span id="L-1957"><a href="#L-1957"><span class="linenos">1957</span></a>                <span class="p">),</span>
</span><span id="L-1958"><a href="#L-1958"><span class="linenos">1958</span></a>                <span class="n">right</span><span class="o">=</span><span class="n">third</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;team&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s2">&quot;third&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(),</span>
</span><span id="L-1959"><a href="#L-1959"><span class="linenos">1959</span></a>                <span class="n">how</span><span class="o">=</span><span class="s2">&quot;outer&quot;</span><span class="p">,</span>
</span><span id="L-1960"><a href="#L-1960"><span class="linenos">1960</span></a>                <span class="n">on</span><span class="o">=</span><span class="s2">&quot;team&quot;</span><span class="p">,</span>
</span><span id="L-1961"><a href="#L-1961"><span class="linenos">1961</span></a>            <span class="p">)</span>
</span><span id="L-1962"><a href="#L-1962"><span class="linenos">1962</span></a>            <span class="k">if</span> <span class="n">algorithm</span><span class="p">:</span>
</span><span id="L-1963"><a href="#L-1963"><span class="linenos">1963</span></a>                <span class="n">final_probs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="L-1964"><a href="#L-1964"><span class="linenos">1964</span></a>                    <span class="n">left</span><span class="o">=</span><span class="n">final_probs</span><span class="p">,</span>
</span><span id="L-1965"><a href="#L-1965"><span class="linenos">1965</span></a>                    <span class="n">right</span><span class="o">=</span><span class="n">many_mile</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;team&quot;</span><span class="p">)</span>
</span><span id="L-1966"><a href="#L-1966"><span class="linenos">1966</span></a>                    <span class="o">.</span><span class="n">size</span><span class="p">()</span>
</span><span id="L-1967"><a href="#L-1967"><span class="linenos">1967</span></a>                    <span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s2">&quot;many_mile&quot;</span><span class="p">)</span>
</span><span id="L-1968"><a href="#L-1968"><span class="linenos">1968</span></a>                    <span class="o">.</span><span class="n">reset_index</span><span class="p">(),</span>
</span><span id="L-1969"><a href="#L-1969"><span class="linenos">1969</span></a>                    <span class="n">how</span><span class="o">=</span><span class="s2">&quot;outer&quot;</span><span class="p">,</span>
</span><span id="L-1970"><a href="#L-1970"><span class="linenos">1970</span></a>                    <span class="n">on</span><span class="o">=</span><span class="s2">&quot;team&quot;</span><span class="p">,</span>
</span><span id="L-1971"><a href="#L-1971"><span class="linenos">1971</span></a>                <span class="p">)</span>
</span><span id="L-1972"><a href="#L-1972"><span class="linenos">1972</span></a>                <span class="n">final_probs</span><span class="p">[</span><span class="s2">&quot;many_mile&quot;</span><span class="p">]</span> <span class="o">/=</span> <span class="n">many_mile</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-1973"><a href="#L-1973"><span class="linenos">1973</span></a>                <span class="n">final_probs</span><span class="p">[</span><span class="s2">&quot;many_mile&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_probs</span><span class="p">[</span><span class="s2">&quot;many_mile&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="L-1974"><a href="#L-1974"><span class="linenos">1974</span></a>            <span class="n">final_probs</span><span class="p">[</span><span class="s2">&quot;winner&quot;</span><span class="p">]</span> <span class="o">/=</span> <span class="n">winner</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-1975"><a href="#L-1975"><span class="linenos">1975</span></a>            <span class="n">final_probs</span><span class="p">[</span><span class="s2">&quot;runner_up&quot;</span><span class="p">]</span> <span class="o">/=</span> <span class="n">runner_up</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-1976"><a href="#L-1976"><span class="linenos">1976</span></a>            <span class="n">final_probs</span><span class="p">[</span><span class="s2">&quot;third&quot;</span><span class="p">]</span> <span class="o">/=</span> <span class="n">third</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-1977"><a href="#L-1977"><span class="linenos">1977</span></a>            <span class="n">final_probs</span><span class="p">[</span><span class="s2">&quot;winner&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_probs</span><span class="p">[</span><span class="s2">&quot;winner&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="L-1978"><a href="#L-1978"><span class="linenos">1978</span></a>            <span class="n">final_probs</span><span class="p">[</span><span class="s2">&quot;runner_up&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_probs</span><span class="p">[</span><span class="s2">&quot;runner_up&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="L-1979"><a href="#L-1979"><span class="linenos">1979</span></a>            <span class="n">final_probs</span><span class="p">[</span><span class="s2">&quot;third&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_probs</span><span class="p">[</span><span class="s2">&quot;third&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="L-1980"><a href="#L-1980"><span class="linenos">1980</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1981"><a href="#L-1981"><span class="linenos">1981</span></a>            <span class="n">final_probs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span><span id="L-1982"><a href="#L-1982"><span class="linenos">1982</span></a>                <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;team&quot;</span><span class="p">,</span> <span class="s2">&quot;winner&quot;</span><span class="p">,</span> <span class="s2">&quot;runner_up&quot;</span><span class="p">,</span> <span class="s2">&quot;third&quot;</span><span class="p">,</span> <span class="s2">&quot;many_mile&quot;</span><span class="p">]</span>
</span><span id="L-1983"><a href="#L-1983"><span class="linenos">1983</span></a>            <span class="p">)</span>
</span><span id="L-1984"><a href="#L-1984"><span class="linenos">1984</span></a>        <span class="n">schedule</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-1985"><a href="#L-1985"><span class="linenos">1985</span></a>            <span class="n">schedule_sims</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;week&quot;</span><span class="p">,</span> <span class="s2">&quot;team_1&quot;</span><span class="p">,</span> <span class="s2">&quot;team_2&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">numeric_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="L-1986"><a href="#L-1986"><span class="linenos">1986</span></a>        <span class="p">)</span>
</span><span id="L-1987"><a href="#L-1987"><span class="linenos">1987</span></a>        <span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;points_avg_1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;points_avg_1&quot;</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-1988"><a href="#L-1988"><span class="linenos">1988</span></a>        <span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;points_stdev_1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;points_stdev_1&quot;</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-1989"><a href="#L-1989"><span class="linenos">1989</span></a>        <span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;points_avg_2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;points_avg_2&quot;</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-1990"><a href="#L-1990"><span class="linenos">1990</span></a>        <span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;points_stdev_2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;points_stdev_2&quot;</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-1991"><a href="#L-1991"><span class="linenos">1991</span></a>        <span class="n">standings</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="L-1992"><a href="#L-1992"><span class="linenos">1992</span></a>            <span class="n">left</span><span class="o">=</span><span class="n">standings</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;team&quot;</span><span class="p">)</span>
</span><span id="L-1993"><a href="#L-1993"><span class="linenos">1993</span></a>            <span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="L-1994"><a href="#L-1994"><span class="linenos">1994</span></a>            <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="L-1995"><a href="#L-1995"><span class="linenos">1995</span></a>            <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;wins&quot;</span><span class="p">:</span> <span class="s2">&quot;wins_avg&quot;</span><span class="p">,</span> <span class="s2">&quot;points&quot;</span><span class="p">:</span> <span class="s2">&quot;points_avg&quot;</span><span class="p">}),</span>
</span><span id="L-1996"><a href="#L-1996"><span class="linenos">1996</span></a>            <span class="n">right</span><span class="o">=</span><span class="n">standings</span><span class="p">[[</span><span class="s2">&quot;team&quot;</span><span class="p">,</span> <span class="s2">&quot;wins&quot;</span><span class="p">,</span> <span class="s2">&quot;points&quot;</span><span class="p">]]</span>
</span><span id="L-1997"><a href="#L-1997"><span class="linenos">1997</span></a>            <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;team&quot;</span><span class="p">)</span>
</span><span id="L-1998"><a href="#L-1998"><span class="linenos">1998</span></a>            <span class="o">.</span><span class="n">std</span><span class="p">()</span>
</span><span id="L-1999"><a href="#L-1999"><span class="linenos">1999</span></a>            <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="L-2000"><a href="#L-2000"><span class="linenos">2000</span></a>            <span class="o">.</span><span class="n">rename</span><span class="p">(</span>
</span><span id="L-2001"><a href="#L-2001"><span class="linenos">2001</span></a>                <span class="n">index</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;wins&quot;</span><span class="p">:</span> <span class="s2">&quot;wins_stdev&quot;</span><span class="p">,</span> <span class="s2">&quot;points&quot;</span><span class="p">:</span> <span class="s2">&quot;points_stdev&quot;</span><span class="p">}</span>
</span><span id="L-2002"><a href="#L-2002"><span class="linenos">2002</span></a>            <span class="p">),</span>
</span><span id="L-2003"><a href="#L-2003"><span class="linenos">2003</span></a>            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">,</span>
</span><span id="L-2004"><a href="#L-2004"><span class="linenos">2004</span></a>            <span class="n">on</span><span class="o">=</span><span class="s2">&quot;team&quot;</span><span class="p">,</span>
</span><span id="L-2005"><a href="#L-2005"><span class="linenos">2005</span></a>        <span class="p">)</span>
</span><span id="L-2006"><a href="#L-2006"><span class="linenos">2006</span></a>        <span class="n">standings</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">standings</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">final_probs</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;team&quot;</span><span class="p">)</span>
</span><span id="L-2007"><a href="#L-2007"><span class="linenos">2007</span></a>        <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;winner&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;winner&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="L-2008"><a href="#L-2008"><span class="linenos">2008</span></a>        <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;runner_up&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;runner_up&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="L-2009"><a href="#L-2009"><span class="linenos">2009</span></a>        <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;third&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;third&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="L-2010"><a href="#L-2010"><span class="linenos">2010</span></a>        <span class="k">if</span> <span class="n">algorithm</span><span class="p">:</span>
</span><span id="L-2011"><a href="#L-2011"><span class="linenos">2011</span></a>            <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;many_mile&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;many_mile&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="L-2012"><a href="#L-2012"><span class="linenos">2012</span></a>        <span class="n">scores</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">schedule_sims</span><span class="p">[[</span><span class="s2">&quot;team_1&quot;</span><span class="p">,</span> <span class="s2">&quot;sim_1&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;team_1&quot;</span><span class="p">:</span> <span class="s2">&quot;team&quot;</span><span class="p">,</span> <span class="s2">&quot;sim_1&quot;</span><span class="p">:</span> <span class="s2">&quot;sim&quot;</span><span class="p">}),</span>
</span><span id="L-2013"><a href="#L-2013"><span class="linenos">2013</span></a>        <span class="n">schedule_sims</span><span class="p">[[</span><span class="s2">&quot;team_2&quot;</span><span class="p">,</span> <span class="s2">&quot;sim_2&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;team_2&quot;</span><span class="p">:</span> <span class="s2">&quot;team&quot;</span><span class="p">,</span> <span class="s2">&quot;sim_2&quot;</span><span class="p">:</span> <span class="s2">&quot;sim&quot;</span><span class="p">})],</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;team&quot;</span><span class="p">)</span>
</span><span id="L-2014"><a href="#L-2014"><span class="linenos">2014</span></a>        <span class="n">standings</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="L-2015"><a href="#L-2015"><span class="linenos">2015</span></a>            <span class="n">left</span><span class="o">=</span><span class="n">standings</span><span class="p">,</span>
</span><span id="L-2016"><a href="#L-2016"><span class="linenos">2016</span></a>            <span class="n">right</span><span class="o">=</span><span class="n">scores</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="L-2017"><a href="#L-2017"><span class="linenos">2017</span></a>            <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="L-2018"><a href="#L-2018"><span class="linenos">2018</span></a>            <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;sim&quot;</span><span class="p">:</span> <span class="s2">&quot;per_game_avg&quot;</span><span class="p">}),</span>
</span><span id="L-2019"><a href="#L-2019"><span class="linenos">2019</span></a>            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">,</span>
</span><span id="L-2020"><a href="#L-2020"><span class="linenos">2020</span></a>            <span class="n">on</span><span class="o">=</span><span class="s2">&quot;team&quot;</span><span class="p">,</span>
</span><span id="L-2021"><a href="#L-2021"><span class="linenos">2021</span></a>        <span class="p">)</span>
</span><span id="L-2022"><a href="#L-2022"><span class="linenos">2022</span></a>        <span class="n">standings</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="L-2023"><a href="#L-2023"><span class="linenos">2023</span></a>            <span class="n">left</span><span class="o">=</span><span class="n">standings</span><span class="p">,</span>
</span><span id="L-2024"><a href="#L-2024"><span class="linenos">2024</span></a>            <span class="n">right</span><span class="o">=</span><span class="n">scores</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
</span><span id="L-2025"><a href="#L-2025"><span class="linenos">2025</span></a>            <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="L-2026"><a href="#L-2026"><span class="linenos">2026</span></a>            <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;sim&quot;</span><span class="p">:</span> <span class="s2">&quot;per_game_stdev&quot;</span><span class="p">}),</span>
</span><span id="L-2027"><a href="#L-2027"><span class="linenos">2027</span></a>            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">,</span>
</span><span id="L-2028"><a href="#L-2028"><span class="linenos">2028</span></a>            <span class="n">on</span><span class="o">=</span><span class="s2">&quot;team&quot;</span><span class="p">,</span>
</span><span id="L-2029"><a href="#L-2029"><span class="linenos">2029</span></a>        <span class="p">)</span>
</span><span id="L-2030"><a href="#L-2030"><span class="linenos">2030</span></a>        <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;per_game_fano&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-2031"><a href="#L-2031"><span class="linenos">2031</span></a>            <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;per_game_stdev&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;per_game_avg&quot;</span><span class="p">]</span>
</span><span id="L-2032"><a href="#L-2032"><span class="linenos">2032</span></a>        <span class="p">)</span>
</span><span id="L-2033"><a href="#L-2033"><span class="linenos">2033</span></a>        <span class="n">standings</span> <span class="o">=</span> <span class="n">standings</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
</span><span id="L-2034"><a href="#L-2034"><span class="linenos">2034</span></a>            <span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;winner&quot;</span> <span class="k">if</span> <span class="n">postseason</span> <span class="k">else</span> <span class="s2">&quot;playoffs&quot;</span><span class="p">]</span>
</span><span id="L-2035"><a href="#L-2035"><span class="linenos">2035</span></a>            <span class="o">+</span> <span class="p">([</span><span class="s2">&quot;many_mile&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;many_mile&quot;</span> <span class="ow">in</span> <span class="n">standings</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="k">else</span> <span class="p">[]),</span>
</span><span id="L-2036"><a href="#L-2036"><span class="linenos">2036</span></a>            <span class="n">ascending</span><span class="o">=</span><span class="p">[</span><span class="kc">False</span><span class="p">]</span>
</span><span id="L-2037"><a href="#L-2037"><span class="linenos">2037</span></a>            <span class="o">+</span> <span class="p">([</span><span class="kc">True</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;many_mile&quot;</span> <span class="ow">in</span> <span class="n">standings</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="k">else</span> <span class="p">[]),</span>
</span><span id="L-2038"><a href="#L-2038"><span class="linenos">2038</span></a>        <span class="p">)</span>
</span><span id="L-2039"><a href="#L-2039"><span class="linenos">2039</span></a>        <span class="k">if</span> <span class="n">postseason</span><span class="p">:</span>
</span><span id="L-2040"><a href="#L-2040"><span class="linenos">2040</span></a>            <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;earnings&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span>
</span><span id="L-2041"><a href="#L-2041"><span class="linenos">2041</span></a>                <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;winner&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">payouts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-2042"><a href="#L-2042"><span class="linenos">2042</span></a>                <span class="o">+</span> <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;runner_up&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">payouts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-2043"><a href="#L-2043"><span class="linenos">2043</span></a>                <span class="o">+</span> <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;third&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">payouts</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
</span><span id="L-2044"><a href="#L-2044"><span class="linenos">2044</span></a>                <span class="mi">2</span><span class="p">,</span>
</span><span id="L-2045"><a href="#L-2045"><span class="linenos">2045</span></a>            <span class="p">)</span>
</span><span id="L-2046"><a href="#L-2046"><span class="linenos">2046</span></a>        <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;wins_avg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">standings</span><span class="p">[</span><span class="s2">&quot;wins_avg&quot;</span><span class="p">],</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="L-2047"><a href="#L-2047"><span class="linenos">2047</span></a>        <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;wins_stdev&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">standings</span><span class="p">[</span><span class="s2">&quot;wins_stdev&quot;</span><span class="p">],</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="L-2048"><a href="#L-2048"><span class="linenos">2048</span></a>        <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;points_avg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">standings</span><span class="p">[</span><span class="s2">&quot;points_avg&quot;</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-2049"><a href="#L-2049"><span class="linenos">2049</span></a>        <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;points_stdev&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">standings</span><span class="p">[</span><span class="s2">&quot;points_stdev&quot;</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-2050"><a href="#L-2050"><span class="linenos">2050</span></a>        <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;per_game_avg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">standings</span><span class="p">[</span><span class="s2">&quot;per_game_avg&quot;</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-2051"><a href="#L-2051"><span class="linenos">2051</span></a>        <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;per_game_stdev&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">standings</span><span class="p">[</span><span class="s2">&quot;per_game_stdev&quot;</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-2052"><a href="#L-2052"><span class="linenos">2052</span></a>        <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;per_game_fano&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">standings</span><span class="p">[</span><span class="s2">&quot;per_game_fano&quot;</span><span class="p">],</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="L-2053"><a href="#L-2053"><span class="linenos">2053</span></a>        <span class="k">return</span> <span class="n">schedule</span><span class="p">,</span> <span class="n">standings</span>
</span><span id="L-2054"><a href="#L-2054"><span class="linenos">2054</span></a>
</span><span id="L-2055"><a href="#L-2055"><span class="linenos">2055</span></a>    <span class="k">def</span> <span class="nf">war_sim</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-2056"><a href="#L-2056"><span class="linenos">2056</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2057"><a href="#L-2057"><span class="linenos">2057</span></a><span class="sd">        Simulates the wins-above-replacement (WAR) for each of the players eligible to roster, </span>
</span><span id="L-2058"><a href="#L-2058"><span class="linenos">2058</span></a><span class="sd">        i.e. how many more wins in a season you would have by rostering that player </span>
</span><span id="L-2059"><a href="#L-2059"><span class="linenos">2059</span></a><span class="sd">        compared to an average player at that position.</span>
</span><span id="L-2060"><a href="#L-2060"><span class="linenos">2060</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2061"><a href="#L-2061"><span class="linenos">2061</span></a>        <span class="n">as_of</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">season</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">week</span>
</span><span id="L-2062"><a href="#L-2062"><span class="linenos">2062</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">load_stats</span><span class="p">(</span><span class="n">as_of</span> <span class="o">-</span> <span class="mi">100</span><span class="p">,</span> <span class="n">as_of</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-2063"><a href="#L-2063"><span class="linenos">2063</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Creating histograms across all players in each position &quot;&quot;&quot;</span>
</span><span id="L-2064"><a href="#L-2064"><span class="linenos">2064</span></a>        <span class="n">pos_hists</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;points&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mf">50.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)}</span>
</span><span id="L-2065"><a href="#L-2065"><span class="linenos">2065</span></a>        <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
</span><span id="L-2066"><a href="#L-2066"><span class="linenos">2066</span></a>            <span class="n">pos_hists</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span>
</span><span id="L-2067"><a href="#L-2067"><span class="linenos">2067</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">position</span> <span class="o">==</span> <span class="n">pos</span><span class="p">,</span> <span class="s2">&quot;points&quot;</span><span class="p">],</span>
</span><span id="L-2068"><a href="#L-2068"><span class="linenos">2068</span></a>                <span class="n">bins</span><span class="o">=</span><span class="n">pos_hists</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">],</span>
</span><span id="L-2069"><a href="#L-2069"><span class="linenos">2069</span></a>            <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-2070"><a href="#L-2070"><span class="linenos">2070</span></a>            <span class="n">pos_hists</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos_hists</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span><span class="n">pos_hists</span><span class="p">[</span><span class="n">pos</span><span class="p">])</span>
</span><span id="L-2071"><a href="#L-2071"><span class="linenos">2071</span></a>        <span class="n">pos_hists</span><span class="p">[</span><span class="s2">&quot;FLEX&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span>
</span><span id="L-2072"><a href="#L-2072"><span class="linenos">2072</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;RB&quot;</span><span class="p">,</span> <span class="s2">&quot;WR&quot;</span><span class="p">,</span> <span class="s2">&quot;TE&quot;</span><span class="p">]),</span> <span class="s2">&quot;points&quot;</span><span class="p">],</span>
</span><span id="L-2073"><a href="#L-2073"><span class="linenos">2073</span></a>            <span class="n">bins</span><span class="o">=</span><span class="n">pos_hists</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">],</span>
</span><span id="L-2074"><a href="#L-2074"><span class="linenos">2074</span></a>        <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-2075"><a href="#L-2075"><span class="linenos">2075</span></a>        <span class="n">pos_hists</span><span class="p">[</span><span class="s2">&quot;FLEX&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos_hists</span><span class="p">[</span><span class="s2">&quot;FLEX&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span><span class="n">pos_hists</span><span class="p">[</span><span class="s2">&quot;FLEX&quot;</span><span class="p">])</span>
</span><span id="L-2076"><a href="#L-2076"><span class="linenos">2076</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Simulating an entire team using average players &quot;&quot;&quot;</span>
</span><span id="L-2077"><a href="#L-2077"><span class="linenos">2077</span></a>        <span class="n">sim_scores</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span><span id="L-2078"><a href="#L-2078"><span class="linenos">2078</span></a>            <span class="p">{</span>
</span><span id="L-2079"><a href="#L-2079"><span class="linenos">2079</span></a>                <span class="s2">&quot;QB&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
</span><span id="L-2080"><a href="#L-2080"><span class="linenos">2080</span></a>                    <span class="n">pos_hists</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="o">=</span><span class="n">pos_hists</span><span class="p">[</span><span class="s2">&quot;QB&quot;</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_sims</span>
</span><span id="L-2081"><a href="#L-2081"><span class="linenos">2081</span></a>                <span class="p">),</span>
</span><span id="L-2082"><a href="#L-2082"><span class="linenos">2082</span></a>                <span class="s2">&quot;RB1&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
</span><span id="L-2083"><a href="#L-2083"><span class="linenos">2083</span></a>                    <span class="n">pos_hists</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="o">=</span><span class="n">pos_hists</span><span class="p">[</span><span class="s2">&quot;RB&quot;</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_sims</span>
</span><span id="L-2084"><a href="#L-2084"><span class="linenos">2084</span></a>                <span class="p">),</span>
</span><span id="L-2085"><a href="#L-2085"><span class="linenos">2085</span></a>                <span class="s2">&quot;RB2&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
</span><span id="L-2086"><a href="#L-2086"><span class="linenos">2086</span></a>                    <span class="n">pos_hists</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="o">=</span><span class="n">pos_hists</span><span class="p">[</span><span class="s2">&quot;RB&quot;</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_sims</span>
</span><span id="L-2087"><a href="#L-2087"><span class="linenos">2087</span></a>                <span class="p">),</span>
</span><span id="L-2088"><a href="#L-2088"><span class="linenos">2088</span></a>                <span class="s2">&quot;WR1&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
</span><span id="L-2089"><a href="#L-2089"><span class="linenos">2089</span></a>                    <span class="n">pos_hists</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="o">=</span><span class="n">pos_hists</span><span class="p">[</span><span class="s2">&quot;WR&quot;</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_sims</span>
</span><span id="L-2090"><a href="#L-2090"><span class="linenos">2090</span></a>                <span class="p">),</span>
</span><span id="L-2091"><a href="#L-2091"><span class="linenos">2091</span></a>                <span class="s2">&quot;WR2&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
</span><span id="L-2092"><a href="#L-2092"><span class="linenos">2092</span></a>                    <span class="n">pos_hists</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="o">=</span><span class="n">pos_hists</span><span class="p">[</span><span class="s2">&quot;WR&quot;</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_sims</span>
</span><span id="L-2093"><a href="#L-2093"><span class="linenos">2093</span></a>                <span class="p">),</span>
</span><span id="L-2094"><a href="#L-2094"><span class="linenos">2094</span></a>                <span class="s2">&quot;TE&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
</span><span id="L-2095"><a href="#L-2095"><span class="linenos">2095</span></a>                    <span class="n">pos_hists</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="o">=</span><span class="n">pos_hists</span><span class="p">[</span><span class="s2">&quot;TE&quot;</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_sims</span>
</span><span id="L-2096"><a href="#L-2096"><span class="linenos">2096</span></a>                <span class="p">),</span>
</span><span id="L-2097"><a href="#L-2097"><span class="linenos">2097</span></a>                <span class="s2">&quot;FLEX&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
</span><span id="L-2098"><a href="#L-2098"><span class="linenos">2098</span></a>                    <span class="n">pos_hists</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="o">=</span><span class="n">pos_hists</span><span class="p">[</span><span class="s2">&quot;FLEX&quot;</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_sims</span>
</span><span id="L-2099"><a href="#L-2099"><span class="linenos">2099</span></a>                <span class="p">),</span>
</span><span id="L-2100"><a href="#L-2100"><span class="linenos">2100</span></a>                <span class="s2">&quot;K&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
</span><span id="L-2101"><a href="#L-2101"><span class="linenos">2101</span></a>                    <span class="n">pos_hists</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="o">=</span><span class="n">pos_hists</span><span class="p">[</span><span class="s2">&quot;K&quot;</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_sims</span>
</span><span id="L-2102"><a href="#L-2102"><span class="linenos">2102</span></a>                <span class="p">),</span>
</span><span id="L-2103"><a href="#L-2103"><span class="linenos">2103</span></a>                <span class="s2">&quot;DEF&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
</span><span id="L-2104"><a href="#L-2104"><span class="linenos">2104</span></a>                    <span class="n">pos_hists</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="o">=</span><span class="n">pos_hists</span><span class="p">[</span><span class="s2">&quot;DEF&quot;</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_sims</span>
</span><span id="L-2105"><a href="#L-2105"><span class="linenos">2105</span></a>                <span class="p">),</span>
</span><span id="L-2106"><a href="#L-2106"><span class="linenos">2106</span></a>            <span class="p">}</span>
</span><span id="L-2107"><a href="#L-2107"><span class="linenos">2107</span></a>        <span class="p">)</span>
</span><span id="L-2108"><a href="#L-2108"><span class="linenos">2108</span></a>        <span class="n">sim_scores</span><span class="p">[</span><span class="s2">&quot;Total&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-2109"><a href="#L-2109"><span class="linenos">2109</span></a>            <span class="n">sim_scores</span><span class="o">.</span><span class="n">QB</span>
</span><span id="L-2110"><a href="#L-2110"><span class="linenos">2110</span></a>            <span class="o">+</span> <span class="n">sim_scores</span><span class="o">.</span><span class="n">RB1</span>
</span><span id="L-2111"><a href="#L-2111"><span class="linenos">2111</span></a>            <span class="o">+</span> <span class="n">sim_scores</span><span class="o">.</span><span class="n">RB2</span>
</span><span id="L-2112"><a href="#L-2112"><span class="linenos">2112</span></a>            <span class="o">+</span> <span class="n">sim_scores</span><span class="o">.</span><span class="n">WR1</span>
</span><span id="L-2113"><a href="#L-2113"><span class="linenos">2113</span></a>            <span class="o">+</span> <span class="n">sim_scores</span><span class="o">.</span><span class="n">WR2</span>
</span><span id="L-2114"><a href="#L-2114"><span class="linenos">2114</span></a>            <span class="o">+</span> <span class="n">sim_scores</span><span class="o">.</span><span class="n">TE</span>
</span><span id="L-2115"><a href="#L-2115"><span class="linenos">2115</span></a>            <span class="o">+</span> <span class="n">sim_scores</span><span class="o">.</span><span class="n">FLEX</span>
</span><span id="L-2116"><a href="#L-2116"><span class="linenos">2116</span></a>            <span class="o">+</span> <span class="n">sim_scores</span><span class="o">.</span><span class="n">K</span>
</span><span id="L-2117"><a href="#L-2117"><span class="linenos">2117</span></a>            <span class="o">+</span> <span class="n">sim_scores</span><span class="o">.</span><span class="n">DEF</span>
</span><span id="L-2118"><a href="#L-2118"><span class="linenos">2118</span></a>        <span class="p">)</span>
</span><span id="L-2119"><a href="#L-2119"><span class="linenos">2119</span></a>        <span class="n">player_sims</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span><span id="L-2120"><a href="#L-2120"><span class="linenos">2120</span></a>            <span class="p">{</span>
</span><span id="L-2121"><a href="#L-2121"><span class="linenos">2121</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">]:</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span>
</span><span id="L-2122"><a href="#L-2122"><span class="linenos">2122</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span>
</span><span id="L-2123"><a href="#L-2123"><span class="linenos">2123</span></a>                        <span class="n">loc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span> <span class="s2">&quot;points_rate&quot;</span><span class="p">],</span>
</span><span id="L-2124"><a href="#L-2124"><span class="linenos">2124</span></a>                        <span class="n">scale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span> <span class="s2">&quot;points_stdev&quot;</span><span class="p">],</span>
</span><span id="L-2125"><a href="#L-2125"><span class="linenos">2125</span></a>                        <span class="n">size</span><span class="o">=</span><span class="n">sim_scores</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="L-2126"><a href="#L-2126"><span class="linenos">2126</span></a>                    <span class="p">)</span>
</span><span id="L-2127"><a href="#L-2127"><span class="linenos">2127</span></a>                <span class="p">)</span>
</span><span id="L-2128"><a href="#L-2128"><span class="linenos">2128</span></a>                <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-2129"><a href="#L-2129"><span class="linenos">2129</span></a>            <span class="p">}</span>
</span><span id="L-2130"><a href="#L-2130"><span class="linenos">2130</span></a>        <span class="p">)</span>
</span><span id="L-2131"><a href="#L-2131"><span class="linenos">2131</span></a>        <span class="n">sim_scores</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="L-2132"><a href="#L-2132"><span class="linenos">2132</span></a>            <span class="n">left</span><span class="o">=</span><span class="n">sim_scores</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">player_sims</span><span class="p">,</span> <span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span>
</span><span id="L-2133"><a href="#L-2133"><span class="linenos">2133</span></a>        <span class="p">)</span>
</span><span id="L-2134"><a href="#L-2134"><span class="linenos">2134</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Calculating the number of wins above replacement for each player &quot;&quot;&quot;</span>
</span><span id="L-2135"><a href="#L-2135"><span class="linenos">2135</span></a>        <span class="k">for</span> <span class="n">player</span> <span class="ow">in</span> <span class="n">sim_scores</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">10</span><span class="p">:]:</span>
</span><span id="L-2136"><a href="#L-2136"><span class="linenos">2136</span></a>            <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">player</span><span class="p">):</span>
</span><span id="L-2137"><a href="#L-2137"><span class="linenos">2137</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Null player name for some reason... Skipping...&quot;</span><span class="p">)</span>
</span><span id="L-2138"><a href="#L-2138"><span class="linenos">2138</span></a>                <span class="k">continue</span>
</span><span id="L-2139"><a href="#L-2139"><span class="linenos">2139</span></a>            <span class="n">cols</span> <span class="o">=</span> <span class="n">sim_scores</span><span class="o">.</span><span class="n">columns</span><span class="p">[:</span><span class="mi">9</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="L-2140"><a href="#L-2140"><span class="linenos">2140</span></a>            <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">player</span><span class="p">,</span> <span class="s2">&quot;position&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-2141"><a href="#L-2141"><span class="linenos">2141</span></a>            <span class="k">if</span> <span class="n">pos</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;RB&quot;</span><span class="p">,</span> <span class="s2">&quot;WR&quot;</span><span class="p">]:</span>
</span><span id="L-2142"><a href="#L-2142"><span class="linenos">2142</span></a>                <span class="n">pos</span> <span class="o">+=</span> <span class="s2">&quot;1&quot;</span>
</span><span id="L-2143"><a href="#L-2143"><span class="linenos">2143</span></a>            <span class="n">cols</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">cols</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">pos</span><span class="p">))</span>
</span><span id="L-2144"><a href="#L-2144"><span class="linenos">2144</span></a>            <span class="n">cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">player</span><span class="p">)</span>
</span><span id="L-2145"><a href="#L-2145"><span class="linenos">2145</span></a>            <span class="n">sim_scores</span><span class="p">[</span><span class="s2">&quot;Alt_Total&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sim_scores</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-2146"><a href="#L-2146"><span class="linenos">2146</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">player</span><span class="p">,</span> <span class="s2">&quot;WAR&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-2147"><a href="#L-2147"><span class="linenos">2147</span></a>                <span class="nb">sum</span><span class="p">(</span>
</span><span id="L-2148"><a href="#L-2148"><span class="linenos">2148</span></a>                    <span class="n">sim_scores</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span> <span class="n">sim_scores</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Alt_Total&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="L-2149"><a href="#L-2149"><span class="linenos">2149</span></a>                    <span class="o">&gt;</span> <span class="n">sim_scores</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sim_scores</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span> <span class="p">:,</span> <span class="s2">&quot;Total&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="L-2150"><a href="#L-2150"><span class="linenos">2150</span></a>                <span class="p">)</span>
</span><span id="L-2151"><a href="#L-2151"><span class="linenos">2151</span></a>                <span class="o">/</span> <span class="p">(</span><span class="n">sim_scores</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="L-2152"><a href="#L-2152"><span class="linenos">2152</span></a>                <span class="o">-</span> <span class="mf">0.5</span>
</span><span id="L-2153"><a href="#L-2153"><span class="linenos">2153</span></a>            <span class="p">)</span> <span class="o">*</span> <span class="mi">14</span>
</span><span id="L-2154"><a href="#L-2154"><span class="linenos">2154</span></a>            <span class="k">del</span> <span class="n">sim_scores</span><span class="p">[</span><span class="s2">&quot;Alt_Total&quot;</span><span class="p">]</span>
</span><span id="L-2155"><a href="#L-2155"><span class="linenos">2155</span></a>
</span><span id="L-2156"><a href="#L-2156"><span class="linenos">2156</span></a>    <span class="k">def</span> <span class="nf">possible_pickups</span><span class="p">(</span>
</span><span id="L-2157"><a href="#L-2157"><span class="linenos">2157</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-2158"><a href="#L-2158"><span class="linenos">2158</span></a>        <span class="n">focus_on</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[],</span>
</span><span id="L-2159"><a href="#L-2159"><span class="linenos">2159</span></a>        <span class="n">exclude</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[],</span>
</span><span id="L-2160"><a href="#L-2160"><span class="linenos">2160</span></a>        <span class="n">limit_per</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="L-2161"><a href="#L-2161"><span class="linenos">2161</span></a>        <span class="n">team_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2162"><a href="#L-2162"><span class="linenos">2162</span></a>        <span class="n">postseason</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-2163"><a href="#L-2163"><span class="linenos">2163</span></a>        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-2164"><a href="#L-2164"><span class="linenos">2164</span></a>        <span class="n">payouts</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">800</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
</span><span id="L-2165"><a href="#L-2165"><span class="linenos">2165</span></a>        <span class="n">bestball</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-2166"><a href="#L-2166"><span class="linenos">2166</span></a>        <span class="n">min_rostership</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span>
</span><span id="L-2167"><a href="#L-2167"><span class="linenos">2167</span></a>    <span class="p">):</span>
</span><span id="L-2168"><a href="#L-2168"><span class="linenos">2168</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2169"><a href="#L-2169"><span class="linenos">2169</span></a><span class="sd">        Simulates the remainder of the season with the current roster and compares it to </span>
</span><span id="L-2170"><a href="#L-2170"><span class="linenos">2170</span></a><span class="sd">        a simulation of the roster after a series of potential add &amp; drop transactions.</span>
</span><span id="L-2171"><a href="#L-2171"><span class="linenos">2171</span></a>
</span><span id="L-2172"><a href="#L-2172"><span class="linenos">2172</span></a><span class="sd">        Args:</span>
</span><span id="L-2173"><a href="#L-2173"><span class="linenos">2173</span></a><span class="sd">            focus_on (list, optional): list of players to include in every potential trade, defaults to [].  </span>
</span><span id="L-2174"><a href="#L-2174"><span class="linenos">2174</span></a><span class="sd">            exclude (list, optional): list of players to exclude from every potential trade, defaults to [].  </span>
</span><span id="L-2175"><a href="#L-2175"><span class="linenos">2175</span></a><span class="sd">            limit_per (int, optional): number of players per position to analyze, defaults to 10.  </span>
</span><span id="L-2176"><a href="#L-2176"><span class="linenos">2176</span></a><span class="sd">            team_name (str, optional): name of team to analyze trades for, defaults to None (and therefore team of interest).  </span>
</span><span id="L-2177"><a href="#L-2177"><span class="linenos">2177</span></a><span class="sd">            postseason (bool, optional): whether to analyze postseason gains or just regular season, defaults to True.  </span>
</span><span id="L-2178"><a href="#L-2178"><span class="linenos">2178</span></a><span class="sd">            verbose (bool, optional): whether to print out a status report as the code runs, defaults to True.  </span>
</span><span id="L-2179"><a href="#L-2179"><span class="linenos">2179</span></a><span class="sd">            payouts (list, optional): list of payout amounts for top three finishers, defaults to [800, 300, 100].  </span>
</span><span id="L-2180"><a href="#L-2180"><span class="linenos">2180</span></a><span class="sd">            bestball (bool, optional): whether to use best ball settings during simulation, defaults to False.</span>
</span><span id="L-2181"><a href="#L-2181"><span class="linenos">2181</span></a>
</span><span id="L-2182"><a href="#L-2182"><span class="linenos">2182</span></a><span class="sd">        Returns:</span>
</span><span id="L-2183"><a href="#L-2183"><span class="linenos">2183</span></a><span class="sd">            pd.DataFrame: dataframe containing the impact and value of every add &amp; drop combination analyzed.</span>
</span><span id="L-2184"><a href="#L-2184"><span class="linenos">2184</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2185"><a href="#L-2185"><span class="linenos">2185</span></a>        <span class="n">as_of</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">season</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">week</span>
</span><span id="L-2186"><a href="#L-2186"><span class="linenos">2186</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_oauth</span><span class="p">()</span>
</span><span id="L-2187"><a href="#L-2187"><span class="linenos">2187</span></a>        <span class="k">if</span> <span class="n">bestball</span><span class="p">:</span>
</span><span id="L-2188"><a href="#L-2188"><span class="linenos">2188</span></a>            <span class="n">orig_standings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bestball_sims</span><span class="p">(</span><span class="n">payouts</span><span class="p">)</span>
</span><span id="L-2189"><a href="#L-2189"><span class="linenos">2189</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-2190"><a href="#L-2190"><span class="linenos">2190</span></a>            <span class="n">orig_standings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">season_sims</span><span class="p">(</span><span class="n">postseason</span><span class="p">,</span> <span class="n">payouts</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-2191"><a href="#L-2191"><span class="linenos">2191</span></a>        <span class="n">added_value</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span><span id="L-2192"><a href="#L-2192"><span class="linenos">2192</span></a>            <span class="n">columns</span><span class="o">=</span><span class="p">[</span>
</span><span id="L-2193"><a href="#L-2193"><span class="linenos">2193</span></a>                <span class="s2">&quot;player_to_drop&quot;</span><span class="p">,</span>
</span><span id="L-2194"><a href="#L-2194"><span class="linenos">2194</span></a>                <span class="s2">&quot;player_to_add&quot;</span><span class="p">,</span>
</span><span id="L-2195"><a href="#L-2195"><span class="linenos">2195</span></a>                <span class="s2">&quot;wins_avg&quot;</span><span class="p">,</span>
</span><span id="L-2196"><a href="#L-2196"><span class="linenos">2196</span></a>                <span class="s2">&quot;wins_stdev&quot;</span><span class="p">,</span>
</span><span id="L-2197"><a href="#L-2197"><span class="linenos">2197</span></a>                <span class="s2">&quot;points_avg&quot;</span><span class="p">,</span>
</span><span id="L-2198"><a href="#L-2198"><span class="linenos">2198</span></a>                <span class="s2">&quot;points_stdev&quot;</span><span class="p">,</span>
</span><span id="L-2199"><a href="#L-2199"><span class="linenos">2199</span></a>                <span class="s2">&quot;per_game_avg&quot;</span><span class="p">,</span>
</span><span id="L-2200"><a href="#L-2200"><span class="linenos">2200</span></a>                <span class="s2">&quot;per_game_stdev&quot;</span><span class="p">,</span>
</span><span id="L-2201"><a href="#L-2201"><span class="linenos">2201</span></a>                <span class="s2">&quot;per_game_fano&quot;</span><span class="p">,</span>
</span><span id="L-2202"><a href="#L-2202"><span class="linenos">2202</span></a>                <span class="s2">&quot;playoffs&quot;</span><span class="p">,</span>
</span><span id="L-2203"><a href="#L-2203"><span class="linenos">2203</span></a>                <span class="s2">&quot;playoff_bye&quot;</span><span class="p">,</span>
</span><span id="L-2204"><a href="#L-2204"><span class="linenos">2204</span></a>            <span class="p">]</span>
</span><span id="L-2205"><a href="#L-2205"><span class="linenos">2205</span></a>            <span class="o">+</span> <span class="p">(</span>
</span><span id="L-2206"><a href="#L-2206"><span class="linenos">2206</span></a>                <span class="p">[</span><span class="s2">&quot;winner&quot;</span><span class="p">,</span> <span class="s2">&quot;runner_up&quot;</span><span class="p">,</span> <span class="s2">&quot;third&quot;</span><span class="p">,</span> <span class="s2">&quot;earnings&quot;</span><span class="p">]</span>
</span><span id="L-2207"><a href="#L-2207"><span class="linenos">2207</span></a>                <span class="o">+</span> <span class="p">(</span>
</span><span id="L-2208"><a href="#L-2208"><span class="linenos">2208</span></a>                    <span class="p">[</span><span class="s2">&quot;many_mile&quot;</span><span class="p">]</span>
</span><span id="L-2209"><a href="#L-2209"><span class="linenos">2209</span></a>                    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">team_1</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;The Algorithm&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
</span><span id="L-2210"><a href="#L-2210"><span class="linenos">2210</span></a>                    <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">team_2</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;The Algorithm&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">())</span> \
</span><span id="L-2211"><a href="#L-2211"><span class="linenos">2211</span></a>                    <span class="ow">and</span> <span class="ow">not</span> <span class="n">bestball</span> <span class="k">else</span> <span class="p">[]</span>
</span><span id="L-2212"><a href="#L-2212"><span class="linenos">2212</span></a>                <span class="p">)</span>
</span><span id="L-2213"><a href="#L-2213"><span class="linenos">2213</span></a>                <span class="k">if</span> <span class="n">postseason</span>
</span><span id="L-2214"><a href="#L-2214"><span class="linenos">2214</span></a>                <span class="k">else</span> <span class="p">[]</span>
</span><span id="L-2215"><a href="#L-2215"><span class="linenos">2215</span></a>            <span class="p">)</span>
</span><span id="L-2216"><a href="#L-2216"><span class="linenos">2216</span></a>        <span class="p">)</span>
</span><span id="L-2217"><a href="#L-2217"><span class="linenos">2217</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">team_name</span><span class="p">:</span>
</span><span id="L-2218"><a href="#L-2218"><span class="linenos">2218</span></a>            <span class="n">team_name</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-2219"><a href="#L-2219"><span class="linenos">2219</span></a>                <span class="n">team</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
</span><span id="L-2220"><a href="#L-2220"><span class="linenos">2220</span></a>                <span class="k">for</span> <span class="n">team</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">teams</span>
</span><span id="L-2221"><a href="#L-2221"><span class="linenos">2221</span></a>                <span class="k">if</span> <span class="n">team</span><span class="p">[</span><span class="s2">&quot;team_key&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">lg</span><span class="o">.</span><span class="n">team_key</span><span class="p">()</span>
</span><span id="L-2222"><a href="#L-2222"><span class="linenos">2222</span></a>            <span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-2223"><a href="#L-2223"><span class="linenos">2223</span></a>        <span class="n">players_to_drop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">fantasy_team</span> <span class="o">==</span> <span class="n">team_name</span><span class="p">]</span>
</span><span id="L-2224"><a href="#L-2224"><span class="linenos">2224</span></a>        <span class="k">if</span> <span class="n">players_to_drop</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">focus_on</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-2225"><a href="#L-2225"><span class="linenos">2225</span></a>            <span class="n">players_to_drop</span> <span class="o">=</span> <span class="n">players_to_drop</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">players_to_drop</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">focus_on</span><span class="p">)]</span>
</span><span id="L-2226"><a href="#L-2226"><span class="linenos">2226</span></a>        <span class="k">if</span> <span class="n">players_to_drop</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">exclude</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-2227"><a href="#L-2227"><span class="linenos">2227</span></a>            <span class="n">players_to_drop</span> <span class="o">=</span> <span class="n">players_to_drop</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">players_to_drop</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">exclude</span><span class="p">)]</span>
</span><span id="L-2228"><a href="#L-2228"><span class="linenos">2228</span></a>        <span class="n">available</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">fantasy_team</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span> \
</span><span id="L-2229"><a href="#L-2229"><span class="linenos">2229</span></a>        <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">until</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span> <span class="o">|</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">until</span> <span class="o">&lt;</span> <span class="mi">17</span><span class="p">))</span> \
</span><span id="L-2230"><a href="#L-2230"><span class="linenos">2230</span></a>        <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">pct_rostered</span> <span class="o">&gt;=</span> <span class="n">min_rostership</span><span class="p">)]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-2231"><a href="#L-2231"><span class="linenos">2231</span></a>        <span class="k">for</span> <span class="n">my_player</span> <span class="ow">in</span> <span class="n">players_to_drop</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
</span><span id="L-2232"><a href="#L-2232"><span class="linenos">2232</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">refresh_oauth</span><span class="p">(</span><span class="mi">55</span><span class="p">)</span>
</span><span id="L-2233"><a href="#L-2233"><span class="linenos">2233</span></a>            <span class="k">if</span> <span class="p">(</span>
</span><span id="L-2234"><a href="#L-2234"><span class="linenos">2234</span></a>                <span class="n">players_to_drop</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">players_to_drop</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">my_player</span><span class="p">,</span> <span class="s2">&quot;until&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span>
</span><span id="L-2235"><a href="#L-2235"><span class="linenos">2235</span></a>                    <span class="mi">0</span>
</span><span id="L-2236"><a href="#L-2236"><span class="linenos">2236</span></a>                <span class="p">]</span>
</span><span id="L-2237"><a href="#L-2237"><span class="linenos">2237</span></a>                <span class="o">&gt;=</span> <span class="n">as_of</span> <span class="o">%</span> <span class="mi">100</span>
</span><span id="L-2238"><a href="#L-2238"><span class="linenos">2238</span></a>            <span class="p">):</span>
</span><span id="L-2239"><a href="#L-2239"><span class="linenos">2239</span></a>                <span class="n">possible</span> <span class="o">=</span> <span class="n">available</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">available</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;Average_&quot;</span><span class="p">)]</span>
</span><span id="L-2240"><a href="#L-2240"><span class="linenos">2240</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-2241"><a href="#L-2241"><span class="linenos">2241</span></a>                <span class="n">possible</span> <span class="o">=</span> <span class="n">available</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-2242"><a href="#L-2242"><span class="linenos">2242</span></a>                    <span class="o">~</span><span class="n">available</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;Average_&quot;</span><span class="p">)</span>
</span><span id="L-2243"><a href="#L-2243"><span class="linenos">2243</span></a>                    <span class="o">&amp;</span> <span class="p">(</span>
</span><span id="L-2244"><a href="#L-2244"><span class="linenos">2244</span></a>                        <span class="n">available</span><span class="o">.</span><span class="n">WAR</span>
</span><span id="L-2245"><a href="#L-2245"><span class="linenos">2245</span></a>                        <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-2246"><a href="#L-2246"><span class="linenos">2246</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">my_player</span><span class="p">,</span> <span class="s2">&quot;WAR&quot;</span>
</span><span id="L-2247"><a href="#L-2247"><span class="linenos">2247</span></a>                        <span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-2248"><a href="#L-2248"><span class="linenos">2248</span></a>                        <span class="o">-</span> <span class="mf">0.5</span>
</span><span id="L-2249"><a href="#L-2249"><span class="linenos">2249</span></a>                    <span class="p">)</span>
</span><span id="L-2250"><a href="#L-2250"><span class="linenos">2250</span></a>                <span class="p">]</span>
</span><span id="L-2251"><a href="#L-2251"><span class="linenos">2251</span></a>            <span class="k">if</span> <span class="n">available</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">focus_on</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-2252"><a href="#L-2252"><span class="linenos">2252</span></a>                <span class="n">possible</span> <span class="o">=</span> <span class="n">possible</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">possible</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">focus_on</span><span class="p">)]</span>
</span><span id="L-2253"><a href="#L-2253"><span class="linenos">2253</span></a>            <span class="k">if</span> <span class="n">possible</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">exclude</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-2254"><a href="#L-2254"><span class="linenos">2254</span></a>                <span class="n">possible</span> <span class="o">=</span> <span class="n">possible</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">possible</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">exclude</span><span class="p">)]</span>
</span><span id="L-2255"><a href="#L-2255"><span class="linenos">2255</span></a>            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-2256"><a href="#L-2256"><span class="linenos">2256</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">my_player</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">possible</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; better players&quot;</span><span class="p">)</span>
</span><span id="L-2257"><a href="#L-2257"><span class="linenos">2257</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">())</span>
</span><span id="L-2258"><a href="#L-2258"><span class="linenos">2258</span></a>            <span class="n">possible</span> <span class="o">=</span> <span class="n">possible</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;position&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">limit_per</span><span class="p">)</span>
</span><span id="L-2259"><a href="#L-2259"><span class="linenos">2259</span></a>            <span class="k">for</span> <span class="n">free_agent</span> <span class="ow">in</span> <span class="n">possible</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
</span><span id="L-2260"><a href="#L-2260"><span class="linenos">2260</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">my_player</span><span class="p">,</span> <span class="s2">&quot;fantasy_team&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-2261"><a href="#L-2261"><span class="linenos">2261</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-2262"><a href="#L-2262"><span class="linenos">2262</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">free_agent</span><span class="p">,</span> <span class="s2">&quot;fantasy_team&quot;</span>
</span><span id="L-2263"><a href="#L-2263"><span class="linenos">2263</span></a>                <span class="p">]</span> <span class="o">=</span> <span class="n">team_name</span>
</span><span id="L-2264"><a href="#L-2264"><span class="linenos">2264</span></a>                <span class="k">if</span> <span class="n">bestball</span><span class="p">:</span>
</span><span id="L-2265"><a href="#L-2265"><span class="linenos">2265</span></a>                    <span class="n">new_standings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bestball_sims</span><span class="p">(</span><span class="n">payouts</span><span class="p">)</span>
</span><span id="L-2266"><a href="#L-2266"><span class="linenos">2266</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-2267"><a href="#L-2267"><span class="linenos">2267</span></a>                    <span class="n">new_standings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">season_sims</span><span class="p">(</span><span class="n">postseason</span><span class="p">,</span> <span class="n">payouts</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-2268"><a href="#L-2268"><span class="linenos">2268</span></a>                <span class="n">added_value</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">added_value</span><span class="p">,</span>
</span><span id="L-2269"><a href="#L-2269"><span class="linenos">2269</span></a>                    <span class="n">new_standings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">new_standings</span><span class="o">.</span><span class="n">team</span> <span class="o">==</span> <span class="n">team_name</span><span class="p">]],</span>
</span><span id="L-2270"><a href="#L-2270"><span class="linenos">2270</span></a>                    <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-2271"><a href="#L-2271"><span class="linenos">2271</span></a>                    <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-2272"><a href="#L-2272"><span class="linenos">2272</span></a>                <span class="p">)</span>
</span><span id="L-2273"><a href="#L-2273"><span class="linenos">2273</span></a>                <span class="n">added_value</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">added_value</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;player_to_drop&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">my_player</span>
</span><span id="L-2274"><a href="#L-2274"><span class="linenos">2274</span></a>                <span class="n">added_value</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">added_value</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;player_to_add&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">free_agent</span>
</span><span id="L-2275"><a href="#L-2275"><span class="linenos">2275</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-2276"><a href="#L-2276"><span class="linenos">2276</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">my_player</span><span class="p">,</span> <span class="s2">&quot;fantasy_team&quot;</span>
</span><span id="L-2277"><a href="#L-2277"><span class="linenos">2277</span></a>                <span class="p">]</span> <span class="o">=</span> <span class="n">team_name</span>
</span><span id="L-2278"><a href="#L-2278"><span class="linenos">2278</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">free_agent</span><span class="p">,</span> <span class="s2">&quot;fantasy_team&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-2279"><a href="#L-2279"><span class="linenos">2279</span></a>            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-2280"><a href="#L-2280"><span class="linenos">2280</span></a>                <span class="n">temp</span> <span class="o">=</span> <span class="n">added_value</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">possible</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">:][</span>
</span><span id="L-2281"><a href="#L-2281"><span class="linenos">2281</span></a>                    <span class="p">[</span><span class="s2">&quot;player_to_drop&quot;</span><span class="p">,</span> <span class="s2">&quot;player_to_add&quot;</span><span class="p">,</span> <span class="s2">&quot;earnings&quot;</span><span class="p">]</span>
</span><span id="L-2282"><a href="#L-2282"><span class="linenos">2282</span></a>                <span class="p">]</span>
</span><span id="L-2283"><a href="#L-2283"><span class="linenos">2283</span></a>                <span class="n">temp</span><span class="p">[</span><span class="s2">&quot;earnings&quot;</span><span class="p">]</span> <span class="o">-=</span> <span class="n">orig_standings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-2284"><a href="#L-2284"><span class="linenos">2284</span></a>                    <span class="n">orig_standings</span><span class="o">.</span><span class="n">team</span> <span class="o">==</span> <span class="n">team_name</span><span class="p">,</span> <span class="s2">&quot;earnings&quot;</span>
</span><span id="L-2285"><a href="#L-2285"><span class="linenos">2285</span></a>                <span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-2286"><a href="#L-2286"><span class="linenos">2286</span></a>                <span class="k">if</span> <span class="n">temp</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-2287"><a href="#L-2287"><span class="linenos">2287</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="L-2288"><a href="#L-2288"><span class="linenos">2288</span></a>                        <span class="n">temp</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;earnings&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span>
</span><span id="L-2289"><a href="#L-2289"><span class="linenos">2289</span></a>                            <span class="n">index</span><span class="o">=</span><span class="kc">False</span>
</span><span id="L-2290"><a href="#L-2290"><span class="linenos">2290</span></a>                        <span class="p">)</span>
</span><span id="L-2291"><a href="#L-2291"><span class="linenos">2291</span></a>                    <span class="p">)</span>
</span><span id="L-2292"><a href="#L-2292"><span class="linenos">2292</span></a>                <span class="k">del</span> <span class="n">temp</span>
</span><span id="L-2293"><a href="#L-2293"><span class="linenos">2293</span></a>        <span class="k">if</span> <span class="n">added_value</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-2294"><a href="#L-2294"><span class="linenos">2294</span></a>            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="L-2295"><a href="#L-2295"><span class="linenos">2295</span></a>                <span class="s2">&quot;wins_avg&quot;</span><span class="p">,</span>
</span><span id="L-2296"><a href="#L-2296"><span class="linenos">2296</span></a>                <span class="s2">&quot;wins_stdev&quot;</span><span class="p">,</span>
</span><span id="L-2297"><a href="#L-2297"><span class="linenos">2297</span></a>                <span class="s2">&quot;points_avg&quot;</span><span class="p">,</span>
</span><span id="L-2298"><a href="#L-2298"><span class="linenos">2298</span></a>                <span class="s2">&quot;points_stdev&quot;</span><span class="p">,</span>
</span><span id="L-2299"><a href="#L-2299"><span class="linenos">2299</span></a>                <span class="s2">&quot;playoffs&quot;</span><span class="p">,</span>
</span><span id="L-2300"><a href="#L-2300"><span class="linenos">2300</span></a>                <span class="s2">&quot;playoff_bye&quot;</span><span class="p">,</span>
</span><span id="L-2301"><a href="#L-2301"><span class="linenos">2301</span></a>            <span class="p">]</span> <span class="o">+</span> <span class="p">(</span>
</span><span id="L-2302"><a href="#L-2302"><span class="linenos">2302</span></a>                <span class="p">[</span><span class="s2">&quot;winner&quot;</span><span class="p">,</span> <span class="s2">&quot;runner_up&quot;</span><span class="p">,</span> <span class="s2">&quot;third&quot;</span><span class="p">,</span> <span class="s2">&quot;earnings&quot;</span><span class="p">]</span>
</span><span id="L-2303"><a href="#L-2303"><span class="linenos">2303</span></a>                <span class="o">+</span> <span class="p">(</span>
</span><span id="L-2304"><a href="#L-2304"><span class="linenos">2304</span></a>                    <span class="p">[</span><span class="s2">&quot;many_mile&quot;</span><span class="p">]</span>
</span><span id="L-2305"><a href="#L-2305"><span class="linenos">2305</span></a>                    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">team_1</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;The Algorithm&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
</span><span id="L-2306"><a href="#L-2306"><span class="linenos">2306</span></a>                    <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">team_2</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;The Algorithm&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">())</span> \
</span><span id="L-2307"><a href="#L-2307"><span class="linenos">2307</span></a>                    <span class="ow">and</span> <span class="ow">not</span> <span class="n">bestball</span> <span class="k">else</span> <span class="p">[]</span>
</span><span id="L-2308"><a href="#L-2308"><span class="linenos">2308</span></a>                <span class="p">)</span>
</span><span id="L-2309"><a href="#L-2309"><span class="linenos">2309</span></a>                <span class="k">if</span> <span class="n">postseason</span>
</span><span id="L-2310"><a href="#L-2310"><span class="linenos">2310</span></a>                <span class="k">else</span> <span class="p">[]</span>
</span><span id="L-2311"><a href="#L-2311"><span class="linenos">2311</span></a>            <span class="p">):</span>
</span><span id="L-2312"><a href="#L-2312"><span class="linenos">2312</span></a>                <span class="n">added_value</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">-=</span> <span class="n">orig_standings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-2313"><a href="#L-2313"><span class="linenos">2313</span></a>                    <span class="n">orig_standings</span><span class="o">.</span><span class="n">team</span> <span class="o">==</span> <span class="n">team_name</span><span class="p">,</span> <span class="n">col</span>
</span><span id="L-2314"><a href="#L-2314"><span class="linenos">2314</span></a>                <span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-2315"><a href="#L-2315"><span class="linenos">2315</span></a>                <span class="n">added_value</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">added_value</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="mi">4</span><span class="p">)</span>
</span><span id="L-2316"><a href="#L-2316"><span class="linenos">2316</span></a>            <span class="n">added_value</span> <span class="o">=</span> <span class="n">added_value</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
</span><span id="L-2317"><a href="#L-2317"><span class="linenos">2317</span></a>                <span class="n">by</span><span class="o">=</span><span class="s2">&quot;winner&quot;</span> <span class="k">if</span> <span class="n">postseason</span> <span class="k">else</span> <span class="s2">&quot;playoffs&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span>
</span><span id="L-2318"><a href="#L-2318"><span class="linenos">2318</span></a>            <span class="p">)</span>
</span><span id="L-2319"><a href="#L-2319"><span class="linenos">2319</span></a>        <span class="k">return</span> <span class="n">added_value</span>
</span><span id="L-2320"><a href="#L-2320"><span class="linenos">2320</span></a>
</span><span id="L-2321"><a href="#L-2321"><span class="linenos">2321</span></a>    <span class="k">def</span> <span class="nf">possible_adds</span><span class="p">(</span>
</span><span id="L-2322"><a href="#L-2322"><span class="linenos">2322</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-2323"><a href="#L-2323"><span class="linenos">2323</span></a>        <span class="n">focus_on</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[],</span>
</span><span id="L-2324"><a href="#L-2324"><span class="linenos">2324</span></a>        <span class="n">exclude</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[],</span>
</span><span id="L-2325"><a href="#L-2325"><span class="linenos">2325</span></a>        <span class="n">limit_per</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="L-2326"><a href="#L-2326"><span class="linenos">2326</span></a>        <span class="n">team_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2327"><a href="#L-2327"><span class="linenos">2327</span></a>        <span class="n">postseason</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-2328"><a href="#L-2328"><span class="linenos">2328</span></a>        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-2329"><a href="#L-2329"><span class="linenos">2329</span></a>        <span class="n">payouts</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">800</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
</span><span id="L-2330"><a href="#L-2330"><span class="linenos">2330</span></a>        <span class="n">bestball</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-2331"><a href="#L-2331"><span class="linenos">2331</span></a>        <span class="n">min_rostership</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span>
</span><span id="L-2332"><a href="#L-2332"><span class="linenos">2332</span></a>    <span class="p">):</span>
</span><span id="L-2333"><a href="#L-2333"><span class="linenos">2333</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2334"><a href="#L-2334"><span class="linenos">2334</span></a><span class="sd">        Simulates the remainder of the season with the current roster and compares it to </span>
</span><span id="L-2335"><a href="#L-2335"><span class="linenos">2335</span></a><span class="sd">        a simulation of the roster after a series of potential add transactions.</span>
</span><span id="L-2336"><a href="#L-2336"><span class="linenos">2336</span></a>
</span><span id="L-2337"><a href="#L-2337"><span class="linenos">2337</span></a><span class="sd">        Args:</span>
</span><span id="L-2338"><a href="#L-2338"><span class="linenos">2338</span></a><span class="sd">            focus_on (list, optional): list of players to include in every potential trade, defaults to [].  </span>
</span><span id="L-2339"><a href="#L-2339"><span class="linenos">2339</span></a><span class="sd">            exclude (list, optional): list of players to exclude from every potential trade, defaults to [].  </span>
</span><span id="L-2340"><a href="#L-2340"><span class="linenos">2340</span></a><span class="sd">            limit_per (int, optional): number of players per position to analyze, defaults to 10.  </span>
</span><span id="L-2341"><a href="#L-2341"><span class="linenos">2341</span></a><span class="sd">            team_name (str, optional): name of team to analyze trades for, defaults to None (and therefore team of interest).  </span>
</span><span id="L-2342"><a href="#L-2342"><span class="linenos">2342</span></a><span class="sd">            postseason (bool, optional): whether to analyze postseason gains or just regular season, defaults to True.  </span>
</span><span id="L-2343"><a href="#L-2343"><span class="linenos">2343</span></a><span class="sd">            verbose (bool, optional): whether to print out a status report as the code runs, defaults to True.  </span>
</span><span id="L-2344"><a href="#L-2344"><span class="linenos">2344</span></a><span class="sd">            payouts (list, optional): list of payout amounts for top three finishers, defaults to [800, 300, 100].  </span>
</span><span id="L-2345"><a href="#L-2345"><span class="linenos">2345</span></a><span class="sd">            bestball (bool, optional): whether to use best ball settings during simulation, defaults to False.</span>
</span><span id="L-2346"><a href="#L-2346"><span class="linenos">2346</span></a>
</span><span id="L-2347"><a href="#L-2347"><span class="linenos">2347</span></a><span class="sd">        Returns:</span>
</span><span id="L-2348"><a href="#L-2348"><span class="linenos">2348</span></a><span class="sd">            pd.DataFrame: dataframe containing the impact and value of every possible add analyzed.</span>
</span><span id="L-2349"><a href="#L-2349"><span class="linenos">2349</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2350"><a href="#L-2350"><span class="linenos">2350</span></a>        <span class="n">as_of</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">season</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">week</span>
</span><span id="L-2351"><a href="#L-2351"><span class="linenos">2351</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_oauth</span><span class="p">()</span>
</span><span id="L-2352"><a href="#L-2352"><span class="linenos">2352</span></a>        <span class="k">if</span> <span class="n">bestball</span><span class="p">:</span>
</span><span id="L-2353"><a href="#L-2353"><span class="linenos">2353</span></a>            <span class="n">orig_standings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bestball_sims</span><span class="p">(</span><span class="n">payouts</span><span class="p">)</span>
</span><span id="L-2354"><a href="#L-2354"><span class="linenos">2354</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-2355"><a href="#L-2355"><span class="linenos">2355</span></a>            <span class="n">orig_standings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">season_sims</span><span class="p">(</span><span class="n">postseason</span><span class="p">,</span> <span class="n">payouts</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-2356"><a href="#L-2356"><span class="linenos">2356</span></a>        <span class="n">added_value</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span><span id="L-2357"><a href="#L-2357"><span class="linenos">2357</span></a>            <span class="n">columns</span><span class="o">=</span><span class="p">[</span>
</span><span id="L-2358"><a href="#L-2358"><span class="linenos">2358</span></a>                <span class="s2">&quot;player_to_add&quot;</span><span class="p">,</span>
</span><span id="L-2359"><a href="#L-2359"><span class="linenos">2359</span></a>                <span class="s2">&quot;wins_avg&quot;</span><span class="p">,</span>
</span><span id="L-2360"><a href="#L-2360"><span class="linenos">2360</span></a>                <span class="s2">&quot;wins_stdev&quot;</span><span class="p">,</span>
</span><span id="L-2361"><a href="#L-2361"><span class="linenos">2361</span></a>                <span class="s2">&quot;points_avg&quot;</span><span class="p">,</span>
</span><span id="L-2362"><a href="#L-2362"><span class="linenos">2362</span></a>                <span class="s2">&quot;points_stdev&quot;</span><span class="p">,</span>
</span><span id="L-2363"><a href="#L-2363"><span class="linenos">2363</span></a>                <span class="s2">&quot;per_game_avg&quot;</span><span class="p">,</span>
</span><span id="L-2364"><a href="#L-2364"><span class="linenos">2364</span></a>                <span class="s2">&quot;per_game_stdev&quot;</span><span class="p">,</span>
</span><span id="L-2365"><a href="#L-2365"><span class="linenos">2365</span></a>                <span class="s2">&quot;per_game_fano&quot;</span><span class="p">,</span>
</span><span id="L-2366"><a href="#L-2366"><span class="linenos">2366</span></a>                <span class="s2">&quot;playoffs&quot;</span><span class="p">,</span>
</span><span id="L-2367"><a href="#L-2367"><span class="linenos">2367</span></a>                <span class="s2">&quot;playoff_bye&quot;</span><span class="p">,</span>
</span><span id="L-2368"><a href="#L-2368"><span class="linenos">2368</span></a>            <span class="p">]</span>
</span><span id="L-2369"><a href="#L-2369"><span class="linenos">2369</span></a>            <span class="o">+</span> <span class="p">(</span>
</span><span id="L-2370"><a href="#L-2370"><span class="linenos">2370</span></a>                <span class="p">[</span><span class="s2">&quot;winner&quot;</span><span class="p">,</span> <span class="s2">&quot;runner_up&quot;</span><span class="p">,</span> <span class="s2">&quot;third&quot;</span><span class="p">,</span> <span class="s2">&quot;earnings&quot;</span><span class="p">]</span>
</span><span id="L-2371"><a href="#L-2371"><span class="linenos">2371</span></a>                <span class="o">+</span> <span class="p">(</span>
</span><span id="L-2372"><a href="#L-2372"><span class="linenos">2372</span></a>                    <span class="p">[</span><span class="s2">&quot;many_mile&quot;</span><span class="p">]</span>
</span><span id="L-2373"><a href="#L-2373"><span class="linenos">2373</span></a>                    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">team_1</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;The Algorithm&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
</span><span id="L-2374"><a href="#L-2374"><span class="linenos">2374</span></a>                    <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">team_2</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;The Algorithm&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">())</span> \
</span><span id="L-2375"><a href="#L-2375"><span class="linenos">2375</span></a>                    <span class="ow">and</span> <span class="ow">not</span> <span class="n">bestball</span> <span class="k">else</span> <span class="p">[]</span>
</span><span id="L-2376"><a href="#L-2376"><span class="linenos">2376</span></a>                <span class="p">)</span>
</span><span id="L-2377"><a href="#L-2377"><span class="linenos">2377</span></a>                <span class="k">if</span> <span class="n">postseason</span>
</span><span id="L-2378"><a href="#L-2378"><span class="linenos">2378</span></a>                <span class="k">else</span> <span class="p">[]</span>
</span><span id="L-2379"><a href="#L-2379"><span class="linenos">2379</span></a>            <span class="p">)</span>
</span><span id="L-2380"><a href="#L-2380"><span class="linenos">2380</span></a>        <span class="p">)</span>
</span><span id="L-2381"><a href="#L-2381"><span class="linenos">2381</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">team_name</span><span class="p">:</span>
</span><span id="L-2382"><a href="#L-2382"><span class="linenos">2382</span></a>            <span class="n">team_name</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-2383"><a href="#L-2383"><span class="linenos">2383</span></a>                <span class="n">team</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
</span><span id="L-2384"><a href="#L-2384"><span class="linenos">2384</span></a>                <span class="k">for</span> <span class="n">team</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">teams</span>
</span><span id="L-2385"><a href="#L-2385"><span class="linenos">2385</span></a>                <span class="k">if</span> <span class="n">team</span><span class="p">[</span><span class="s2">&quot;team_key&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">lg</span><span class="o">.</span><span class="n">team_key</span><span class="p">()</span>
</span><span id="L-2386"><a href="#L-2386"><span class="linenos">2386</span></a>            <span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-2387"><a href="#L-2387"><span class="linenos">2387</span></a>        <span class="n">available</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">fantasy_team</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span> \
</span><span id="L-2388"><a href="#L-2388"><span class="linenos">2388</span></a>        <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">until</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span> <span class="o">|</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">until</span> <span class="o">&lt;</span> <span class="mi">17</span><span class="p">))</span> \
</span><span id="L-2389"><a href="#L-2389"><span class="linenos">2389</span></a>        <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">pct_rostered</span> <span class="o">&gt;=</span> <span class="n">min_rostership</span><span class="p">)]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-2390"><a href="#L-2390"><span class="linenos">2390</span></a>        <span class="n">possible</span> <span class="o">=</span> <span class="n">available</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">available</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;Average_&quot;</span><span class="p">)]</span>
</span><span id="L-2391"><a href="#L-2391"><span class="linenos">2391</span></a>        <span class="k">if</span> <span class="n">possible</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">focus_on</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-2392"><a href="#L-2392"><span class="linenos">2392</span></a>            <span class="n">possible</span> <span class="o">=</span> <span class="n">possible</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">possible</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">focus_on</span><span class="p">)]</span>
</span><span id="L-2393"><a href="#L-2393"><span class="linenos">2393</span></a>        <span class="k">if</span> <span class="n">possible</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">exclude</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-2394"><a href="#L-2394"><span class="linenos">2394</span></a>            <span class="n">possible</span> <span class="o">=</span> <span class="n">possible</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">possible</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">exclude</span><span class="p">)]</span>
</span><span id="L-2395"><a href="#L-2395"><span class="linenos">2395</span></a>        <span class="n">possible</span> <span class="o">=</span> <span class="n">possible</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;position&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">limit_per</span><span class="p">)</span>
</span><span id="L-2396"><a href="#L-2396"><span class="linenos">2396</span></a>        <span class="k">for</span> <span class="n">free_agent</span> <span class="ow">in</span> <span class="n">possible</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
</span><span id="L-2397"><a href="#L-2397"><span class="linenos">2397</span></a>            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-2398"><a href="#L-2398"><span class="linenos">2398</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">, </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">free_agent</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()))</span>
</span><span id="L-2399"><a href="#L-2399"><span class="linenos">2399</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-2400"><a href="#L-2400"><span class="linenos">2400</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">free_agent</span><span class="p">,</span> <span class="s2">&quot;fantasy_team&quot;</span>
</span><span id="L-2401"><a href="#L-2401"><span class="linenos">2401</span></a>            <span class="p">]</span> <span class="o">=</span> <span class="n">team_name</span>
</span><span id="L-2402"><a href="#L-2402"><span class="linenos">2402</span></a>            <span class="k">if</span> <span class="n">bestball</span><span class="p">:</span>
</span><span id="L-2403"><a href="#L-2403"><span class="linenos">2403</span></a>                <span class="n">new_standings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bestball_sims</span><span class="p">(</span><span class="n">payouts</span><span class="p">)</span>
</span><span id="L-2404"><a href="#L-2404"><span class="linenos">2404</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-2405"><a href="#L-2405"><span class="linenos">2405</span></a>                <span class="n">new_standings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">season_sims</span><span class="p">(</span><span class="n">postseason</span><span class="p">,</span> <span class="n">payouts</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-2406"><a href="#L-2406"><span class="linenos">2406</span></a>            <span class="n">added_value</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">added_value</span><span class="p">,</span>
</span><span id="L-2407"><a href="#L-2407"><span class="linenos">2407</span></a>                <span class="n">new_standings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">new_standings</span><span class="o">.</span><span class="n">team</span> <span class="o">==</span> <span class="n">team_name</span><span class="p">]],</span>
</span><span id="L-2408"><a href="#L-2408"><span class="linenos">2408</span></a>                <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-2409"><a href="#L-2409"><span class="linenos">2409</span></a>                <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-2410"><a href="#L-2410"><span class="linenos">2410</span></a>            <span class="p">)</span>
</span><span id="L-2411"><a href="#L-2411"><span class="linenos">2411</span></a>            <span class="n">added_value</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">added_value</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;player_to_add&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">free_agent</span>
</span><span id="L-2412"><a href="#L-2412"><span class="linenos">2412</span></a>            <span class="n">added_value</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">added_value</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;position&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">possible</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-2413"><a href="#L-2413"><span class="linenos">2413</span></a>                <span class="n">possible</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">free_agent</span><span class="p">,</span> <span class="s2">&quot;position&quot;</span>
</span><span id="L-2414"><a href="#L-2414"><span class="linenos">2414</span></a>            <span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-2415"><a href="#L-2415"><span class="linenos">2415</span></a>            <span class="n">added_value</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">added_value</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;current_team&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">possible</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-2416"><a href="#L-2416"><span class="linenos">2416</span></a>                <span class="n">possible</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">free_agent</span><span class="p">,</span> <span class="s2">&quot;current_team&quot;</span>
</span><span id="L-2417"><a href="#L-2417"><span class="linenos">2417</span></a>            <span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-2418"><a href="#L-2418"><span class="linenos">2418</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">free_agent</span><span class="p">,</span> <span class="s2">&quot;fantasy_team&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-2419"><a href="#L-2419"><span class="linenos">2419</span></a>        <span class="k">if</span> <span class="n">added_value</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-2420"><a href="#L-2420"><span class="linenos">2420</span></a>            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="L-2421"><a href="#L-2421"><span class="linenos">2421</span></a>                <span class="s2">&quot;wins_avg&quot;</span><span class="p">,</span>
</span><span id="L-2422"><a href="#L-2422"><span class="linenos">2422</span></a>                <span class="s2">&quot;wins_stdev&quot;</span><span class="p">,</span>
</span><span id="L-2423"><a href="#L-2423"><span class="linenos">2423</span></a>                <span class="s2">&quot;points_avg&quot;</span><span class="p">,</span>
</span><span id="L-2424"><a href="#L-2424"><span class="linenos">2424</span></a>                <span class="s2">&quot;points_stdev&quot;</span><span class="p">,</span>
</span><span id="L-2425"><a href="#L-2425"><span class="linenos">2425</span></a>                <span class="s2">&quot;playoffs&quot;</span><span class="p">,</span>
</span><span id="L-2426"><a href="#L-2426"><span class="linenos">2426</span></a>                <span class="s2">&quot;playoff_bye&quot;</span><span class="p">,</span>
</span><span id="L-2427"><a href="#L-2427"><span class="linenos">2427</span></a>            <span class="p">]</span> <span class="o">+</span> <span class="p">(</span>
</span><span id="L-2428"><a href="#L-2428"><span class="linenos">2428</span></a>                <span class="p">[</span><span class="s2">&quot;winner&quot;</span><span class="p">,</span> <span class="s2">&quot;runner_up&quot;</span><span class="p">,</span> <span class="s2">&quot;third&quot;</span><span class="p">,</span> <span class="s2">&quot;earnings&quot;</span><span class="p">]</span>
</span><span id="L-2429"><a href="#L-2429"><span class="linenos">2429</span></a>                <span class="o">+</span> <span class="p">(</span>
</span><span id="L-2430"><a href="#L-2430"><span class="linenos">2430</span></a>                    <span class="p">[</span><span class="s2">&quot;many_mile&quot;</span><span class="p">]</span>
</span><span id="L-2431"><a href="#L-2431"><span class="linenos">2431</span></a>                    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">team_1</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;The Algorithm&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
</span><span id="L-2432"><a href="#L-2432"><span class="linenos">2432</span></a>                    <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">team_2</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;The Algorithm&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">())</span> \
</span><span id="L-2433"><a href="#L-2433"><span class="linenos">2433</span></a>                    <span class="ow">and</span> <span class="ow">not</span> <span class="n">bestball</span> <span class="k">else</span> <span class="p">[]</span>
</span><span id="L-2434"><a href="#L-2434"><span class="linenos">2434</span></a>                <span class="p">)</span>
</span><span id="L-2435"><a href="#L-2435"><span class="linenos">2435</span></a>                <span class="k">if</span> <span class="n">postseason</span>
</span><span id="L-2436"><a href="#L-2436"><span class="linenos">2436</span></a>                <span class="k">else</span> <span class="p">[]</span>
</span><span id="L-2437"><a href="#L-2437"><span class="linenos">2437</span></a>            <span class="p">):</span>
</span><span id="L-2438"><a href="#L-2438"><span class="linenos">2438</span></a>                <span class="n">added_value</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">-=</span> <span class="n">orig_standings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-2439"><a href="#L-2439"><span class="linenos">2439</span></a>                    <span class="n">orig_standings</span><span class="o">.</span><span class="n">team</span> <span class="o">==</span> <span class="n">team_name</span><span class="p">,</span> <span class="n">col</span>
</span><span id="L-2440"><a href="#L-2440"><span class="linenos">2440</span></a>                <span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-2441"><a href="#L-2441"><span class="linenos">2441</span></a>                <span class="n">added_value</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">added_value</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="mi">4</span><span class="p">)</span>
</span><span id="L-2442"><a href="#L-2442"><span class="linenos">2442</span></a>            <span class="n">added_value</span> <span class="o">=</span> <span class="n">added_value</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
</span><span id="L-2443"><a href="#L-2443"><span class="linenos">2443</span></a>                <span class="n">by</span><span class="o">=</span><span class="s2">&quot;winner&quot;</span> <span class="k">if</span> <span class="n">postseason</span> <span class="k">else</span> <span class="s2">&quot;playoffs&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span>
</span><span id="L-2444"><a href="#L-2444"><span class="linenos">2444</span></a>            <span class="p">)</span>
</span><span id="L-2445"><a href="#L-2445"><span class="linenos">2445</span></a>            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-2446"><a href="#L-2446"><span class="linenos">2446</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="L-2447"><a href="#L-2447"><span class="linenos">2447</span></a>                    <span class="n">added_value</span><span class="p">[[</span><span class="s2">&quot;player_to_add&quot;</span><span class="p">,</span> <span class="s2">&quot;earnings&quot;</span><span class="p">]]</span>
</span><span id="L-2448"><a href="#L-2448"><span class="linenos">2448</span></a>                    <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;earnings&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-2449"><a href="#L-2449"><span class="linenos">2449</span></a>                    <span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-2450"><a href="#L-2450"><span class="linenos">2450</span></a>                <span class="p">)</span>
</span><span id="L-2451"><a href="#L-2451"><span class="linenos">2451</span></a>        <span class="k">return</span> <span class="n">added_value</span>
</span><span id="L-2452"><a href="#L-2452"><span class="linenos">2452</span></a>
</span><span id="L-2453"><a href="#L-2453"><span class="linenos">2453</span></a>    <span class="k">def</span> <span class="nf">possible_drops</span><span class="p">(</span>
</span><span id="L-2454"><a href="#L-2454"><span class="linenos">2454</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-2455"><a href="#L-2455"><span class="linenos">2455</span></a>        <span class="n">focus_on</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[],</span>
</span><span id="L-2456"><a href="#L-2456"><span class="linenos">2456</span></a>        <span class="n">exclude</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[],</span>
</span><span id="L-2457"><a href="#L-2457"><span class="linenos">2457</span></a>        <span class="n">team_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2458"><a href="#L-2458"><span class="linenos">2458</span></a>        <span class="n">postseason</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-2459"><a href="#L-2459"><span class="linenos">2459</span></a>        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-2460"><a href="#L-2460"><span class="linenos">2460</span></a>        <span class="n">payouts</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">800</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
</span><span id="L-2461"><a href="#L-2461"><span class="linenos">2461</span></a>        <span class="n">bestball</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-2462"><a href="#L-2462"><span class="linenos">2462</span></a>    <span class="p">):</span>
</span><span id="L-2463"><a href="#L-2463"><span class="linenos">2463</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2464"><a href="#L-2464"><span class="linenos">2464</span></a><span class="sd">        Simulates the remainder of the season with the current roster and compares it to </span>
</span><span id="L-2465"><a href="#L-2465"><span class="linenos">2465</span></a><span class="sd">        a simulation of the roster after a series of potential drop transactions.</span>
</span><span id="L-2466"><a href="#L-2466"><span class="linenos">2466</span></a>
</span><span id="L-2467"><a href="#L-2467"><span class="linenos">2467</span></a><span class="sd">        Args:</span>
</span><span id="L-2468"><a href="#L-2468"><span class="linenos">2468</span></a><span class="sd">            focus_on (list, optional): list of players to include in every potential trade, defaults to [].  </span>
</span><span id="L-2469"><a href="#L-2469"><span class="linenos">2469</span></a><span class="sd">            exclude (list, optional): list of players to exclude from every potential trade, defaults to [].  </span>
</span><span id="L-2470"><a href="#L-2470"><span class="linenos">2470</span></a><span class="sd">            team_name (str, optional): name of team to analyze trades for, defaults to None (and therefore team of interest).  </span>
</span><span id="L-2471"><a href="#L-2471"><span class="linenos">2471</span></a><span class="sd">            postseason (bool, optional): whether to analyze postseason gains or just regular season, defaults to True.  </span>
</span><span id="L-2472"><a href="#L-2472"><span class="linenos">2472</span></a><span class="sd">            verbose (bool, optional): whether to print out a status report as the code runs, defaults to True.  </span>
</span><span id="L-2473"><a href="#L-2473"><span class="linenos">2473</span></a><span class="sd">            payouts (list, optional): list of payout amounts for top three finishers, defaults to [800, 300, 100].  </span>
</span><span id="L-2474"><a href="#L-2474"><span class="linenos">2474</span></a><span class="sd">            bestball (bool, optional): whether to use best ball settings during simulation, defaults to False.</span>
</span><span id="L-2475"><a href="#L-2475"><span class="linenos">2475</span></a>
</span><span id="L-2476"><a href="#L-2476"><span class="linenos">2476</span></a><span class="sd">        Returns:</span>
</span><span id="L-2477"><a href="#L-2477"><span class="linenos">2477</span></a><span class="sd">            pd.DataFrame: dataframe containing the impact and value of every possible drop analyzed.</span>
</span><span id="L-2478"><a href="#L-2478"><span class="linenos">2478</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2479"><a href="#L-2479"><span class="linenos">2479</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_oauth</span><span class="p">()</span>
</span><span id="L-2480"><a href="#L-2480"><span class="linenos">2480</span></a>        <span class="k">if</span> <span class="n">bestball</span><span class="p">:</span>
</span><span id="L-2481"><a href="#L-2481"><span class="linenos">2481</span></a>            <span class="n">orig_standings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bestball_sims</span><span class="p">(</span><span class="n">payouts</span><span class="p">)</span>
</span><span id="L-2482"><a href="#L-2482"><span class="linenos">2482</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-2483"><a href="#L-2483"><span class="linenos">2483</span></a>            <span class="n">orig_standings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">season_sims</span><span class="p">(</span><span class="n">postseason</span><span class="p">,</span> <span class="n">payouts</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-2484"><a href="#L-2484"><span class="linenos">2484</span></a>        <span class="n">reduced_value</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span><span id="L-2485"><a href="#L-2485"><span class="linenos">2485</span></a>            <span class="n">columns</span><span class="o">=</span><span class="p">[</span>
</span><span id="L-2486"><a href="#L-2486"><span class="linenos">2486</span></a>                <span class="s2">&quot;player_to_drop&quot;</span><span class="p">,</span>
</span><span id="L-2487"><a href="#L-2487"><span class="linenos">2487</span></a>                <span class="s2">&quot;wins_avg&quot;</span><span class="p">,</span>
</span><span id="L-2488"><a href="#L-2488"><span class="linenos">2488</span></a>                <span class="s2">&quot;wins_stdev&quot;</span><span class="p">,</span>
</span><span id="L-2489"><a href="#L-2489"><span class="linenos">2489</span></a>                <span class="s2">&quot;points_avg&quot;</span><span class="p">,</span>
</span><span id="L-2490"><a href="#L-2490"><span class="linenos">2490</span></a>                <span class="s2">&quot;points_stdev&quot;</span><span class="p">,</span>
</span><span id="L-2491"><a href="#L-2491"><span class="linenos">2491</span></a>                <span class="s2">&quot;per_game_avg&quot;</span><span class="p">,</span>
</span><span id="L-2492"><a href="#L-2492"><span class="linenos">2492</span></a>                <span class="s2">&quot;per_game_stdev&quot;</span><span class="p">,</span>
</span><span id="L-2493"><a href="#L-2493"><span class="linenos">2493</span></a>                <span class="s2">&quot;per_game_fano&quot;</span><span class="p">,</span>
</span><span id="L-2494"><a href="#L-2494"><span class="linenos">2494</span></a>                <span class="s2">&quot;playoffs&quot;</span><span class="p">,</span>
</span><span id="L-2495"><a href="#L-2495"><span class="linenos">2495</span></a>                <span class="s2">&quot;playoff_bye&quot;</span><span class="p">,</span>
</span><span id="L-2496"><a href="#L-2496"><span class="linenos">2496</span></a>            <span class="p">]</span>
</span><span id="L-2497"><a href="#L-2497"><span class="linenos">2497</span></a>            <span class="o">+</span> <span class="p">(</span>
</span><span id="L-2498"><a href="#L-2498"><span class="linenos">2498</span></a>                <span class="p">[</span><span class="s2">&quot;winner&quot;</span><span class="p">,</span> <span class="s2">&quot;runner_up&quot;</span><span class="p">,</span> <span class="s2">&quot;third&quot;</span><span class="p">,</span> <span class="s2">&quot;earnings&quot;</span><span class="p">]</span>
</span><span id="L-2499"><a href="#L-2499"><span class="linenos">2499</span></a>                <span class="o">+</span> <span class="p">(</span>
</span><span id="L-2500"><a href="#L-2500"><span class="linenos">2500</span></a>                    <span class="p">[</span><span class="s2">&quot;many_mile&quot;</span><span class="p">]</span>
</span><span id="L-2501"><a href="#L-2501"><span class="linenos">2501</span></a>                    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">team_1</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;The Algorithm&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
</span><span id="L-2502"><a href="#L-2502"><span class="linenos">2502</span></a>                    <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">team_2</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;The Algorithm&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">())</span> \
</span><span id="L-2503"><a href="#L-2503"><span class="linenos">2503</span></a>                    <span class="ow">and</span> <span class="ow">not</span> <span class="n">bestball</span> <span class="k">else</span> <span class="p">[]</span>
</span><span id="L-2504"><a href="#L-2504"><span class="linenos">2504</span></a>                <span class="p">)</span>
</span><span id="L-2505"><a href="#L-2505"><span class="linenos">2505</span></a>                <span class="k">if</span> <span class="n">postseason</span>
</span><span id="L-2506"><a href="#L-2506"><span class="linenos">2506</span></a>                <span class="k">else</span> <span class="p">[]</span>
</span><span id="L-2507"><a href="#L-2507"><span class="linenos">2507</span></a>            <span class="p">)</span>
</span><span id="L-2508"><a href="#L-2508"><span class="linenos">2508</span></a>        <span class="p">)</span>
</span><span id="L-2509"><a href="#L-2509"><span class="linenos">2509</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">team_name</span><span class="p">:</span>
</span><span id="L-2510"><a href="#L-2510"><span class="linenos">2510</span></a>            <span class="n">team_name</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-2511"><a href="#L-2511"><span class="linenos">2511</span></a>                <span class="n">team</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
</span><span id="L-2512"><a href="#L-2512"><span class="linenos">2512</span></a>                <span class="k">for</span> <span class="n">team</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">teams</span>
</span><span id="L-2513"><a href="#L-2513"><span class="linenos">2513</span></a>                <span class="k">if</span> <span class="n">team</span><span class="p">[</span><span class="s2">&quot;team_key&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">lg</span><span class="o">.</span><span class="n">team_key</span><span class="p">()</span>
</span><span id="L-2514"><a href="#L-2514"><span class="linenos">2514</span></a>            <span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-2515"><a href="#L-2515"><span class="linenos">2515</span></a>        <span class="n">players_to_drop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">fantasy_team</span> <span class="o">==</span> <span class="n">team_name</span><span class="p">]</span>
</span><span id="L-2516"><a href="#L-2516"><span class="linenos">2516</span></a>        <span class="k">if</span> <span class="n">players_to_drop</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">focus_on</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-2517"><a href="#L-2517"><span class="linenos">2517</span></a>            <span class="n">players_to_drop</span> <span class="o">=</span> <span class="n">players_to_drop</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">players_to_drop</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">focus_on</span><span class="p">)]</span>
</span><span id="L-2518"><a href="#L-2518"><span class="linenos">2518</span></a>        <span class="k">if</span> <span class="n">players_to_drop</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">exclude</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-2519"><a href="#L-2519"><span class="linenos">2519</span></a>            <span class="n">players_to_drop</span> <span class="o">=</span> <span class="n">players_to_drop</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">players_to_drop</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">exclude</span><span class="p">)]</span>
</span><span id="L-2520"><a href="#L-2520"><span class="linenos">2520</span></a>        <span class="k">for</span> <span class="n">my_player</span> <span class="ow">in</span> <span class="n">players_to_drop</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
</span><span id="L-2521"><a href="#L-2521"><span class="linenos">2521</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">my_player</span><span class="p">,</span> <span class="s2">&quot;fantasy_team&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-2522"><a href="#L-2522"><span class="linenos">2522</span></a>            <span class="k">if</span> <span class="n">bestball</span><span class="p">:</span>
</span><span id="L-2523"><a href="#L-2523"><span class="linenos">2523</span></a>                <span class="n">new_standings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bestball_sims</span><span class="p">(</span><span class="n">payouts</span><span class="p">)</span>
</span><span id="L-2524"><a href="#L-2524"><span class="linenos">2524</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-2525"><a href="#L-2525"><span class="linenos">2525</span></a>                <span class="n">new_standings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">season_sims</span><span class="p">(</span><span class="n">postseason</span><span class="p">,</span> <span class="n">payouts</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-2526"><a href="#L-2526"><span class="linenos">2526</span></a>            <span class="n">reduced_value</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">reduced_value</span><span class="p">,</span>
</span><span id="L-2527"><a href="#L-2527"><span class="linenos">2527</span></a>                <span class="n">new_standings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">new_standings</span><span class="o">.</span><span class="n">team</span> <span class="o">==</span> <span class="n">team_name</span><span class="p">]],</span>
</span><span id="L-2528"><a href="#L-2528"><span class="linenos">2528</span></a>                <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-2529"><a href="#L-2529"><span class="linenos">2529</span></a>                <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-2530"><a href="#L-2530"><span class="linenos">2530</span></a>            <span class="p">)</span>
</span><span id="L-2531"><a href="#L-2531"><span class="linenos">2531</span></a>            <span class="n">reduced_value</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">reduced_value</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;player_to_drop&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">my_player</span>
</span><span id="L-2532"><a href="#L-2532"><span class="linenos">2532</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">my_player</span><span class="p">,</span> <span class="s2">&quot;fantasy_team&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">team_name</span>
</span><span id="L-2533"><a href="#L-2533"><span class="linenos">2533</span></a>        <span class="k">if</span> <span class="n">reduced_value</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-2534"><a href="#L-2534"><span class="linenos">2534</span></a>            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="L-2535"><a href="#L-2535"><span class="linenos">2535</span></a>                <span class="s2">&quot;wins_avg&quot;</span><span class="p">,</span>
</span><span id="L-2536"><a href="#L-2536"><span class="linenos">2536</span></a>                <span class="s2">&quot;wins_stdev&quot;</span><span class="p">,</span>
</span><span id="L-2537"><a href="#L-2537"><span class="linenos">2537</span></a>                <span class="s2">&quot;points_avg&quot;</span><span class="p">,</span>
</span><span id="L-2538"><a href="#L-2538"><span class="linenos">2538</span></a>                <span class="s2">&quot;points_stdev&quot;</span><span class="p">,</span>
</span><span id="L-2539"><a href="#L-2539"><span class="linenos">2539</span></a>                <span class="s2">&quot;playoffs&quot;</span><span class="p">,</span>
</span><span id="L-2540"><a href="#L-2540"><span class="linenos">2540</span></a>                <span class="s2">&quot;playoff_bye&quot;</span><span class="p">,</span>
</span><span id="L-2541"><a href="#L-2541"><span class="linenos">2541</span></a>            <span class="p">]</span> <span class="o">+</span> <span class="p">(</span>
</span><span id="L-2542"><a href="#L-2542"><span class="linenos">2542</span></a>                <span class="p">[</span><span class="s2">&quot;winner&quot;</span><span class="p">,</span> <span class="s2">&quot;runner_up&quot;</span><span class="p">,</span> <span class="s2">&quot;third&quot;</span><span class="p">,</span> <span class="s2">&quot;earnings&quot;</span><span class="p">]</span>
</span><span id="L-2543"><a href="#L-2543"><span class="linenos">2543</span></a>                <span class="o">+</span> <span class="p">(</span>
</span><span id="L-2544"><a href="#L-2544"><span class="linenos">2544</span></a>                    <span class="p">[</span><span class="s2">&quot;many_mile&quot;</span><span class="p">]</span>
</span><span id="L-2545"><a href="#L-2545"><span class="linenos">2545</span></a>                    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">team_1</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;The Algorithm&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
</span><span id="L-2546"><a href="#L-2546"><span class="linenos">2546</span></a>                    <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">team_2</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;The Algorithm&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">())</span> \
</span><span id="L-2547"><a href="#L-2547"><span class="linenos">2547</span></a>                    <span class="ow">and</span> <span class="ow">not</span> <span class="n">bestball</span> <span class="k">else</span> <span class="p">[]</span>
</span><span id="L-2548"><a href="#L-2548"><span class="linenos">2548</span></a>                <span class="p">)</span>
</span><span id="L-2549"><a href="#L-2549"><span class="linenos">2549</span></a>                <span class="k">if</span> <span class="n">postseason</span>
</span><span id="L-2550"><a href="#L-2550"><span class="linenos">2550</span></a>                <span class="k">else</span> <span class="p">[]</span>
</span><span id="L-2551"><a href="#L-2551"><span class="linenos">2551</span></a>            <span class="p">):</span>
</span><span id="L-2552"><a href="#L-2552"><span class="linenos">2552</span></a>                <span class="n">reduced_value</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">-=</span> <span class="n">orig_standings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-2553"><a href="#L-2553"><span class="linenos">2553</span></a>                    <span class="n">orig_standings</span><span class="o">.</span><span class="n">team</span> <span class="o">==</span> <span class="n">team_name</span><span class="p">,</span> <span class="n">col</span>
</span><span id="L-2554"><a href="#L-2554"><span class="linenos">2554</span></a>                <span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-2555"><a href="#L-2555"><span class="linenos">2555</span></a>                <span class="n">reduced_value</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">reduced_value</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="mi">4</span><span class="p">)</span>
</span><span id="L-2556"><a href="#L-2556"><span class="linenos">2556</span></a>            <span class="n">reduced_value</span> <span class="o">=</span> <span class="n">reduced_value</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
</span><span id="L-2557"><a href="#L-2557"><span class="linenos">2557</span></a>                <span class="n">by</span><span class="o">=</span><span class="s2">&quot;winner&quot;</span> <span class="k">if</span> <span class="n">postseason</span> <span class="k">else</span> <span class="s2">&quot;playoffs&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span>
</span><span id="L-2558"><a href="#L-2558"><span class="linenos">2558</span></a>            <span class="p">)</span>
</span><span id="L-2559"><a href="#L-2559"><span class="linenos">2559</span></a>            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-2560"><a href="#L-2560"><span class="linenos">2560</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="L-2561"><a href="#L-2561"><span class="linenos">2561</span></a>                    <span class="n">reduced_value</span><span class="p">[[</span><span class="s2">&quot;player_to_drop&quot;</span><span class="p">,</span> <span class="s2">&quot;earnings&quot;</span><span class="p">]]</span>
</span><span id="L-2562"><a href="#L-2562"><span class="linenos">2562</span></a>                    <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;earnings&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-2563"><a href="#L-2563"><span class="linenos">2563</span></a>                    <span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-2564"><a href="#L-2564"><span class="linenos">2564</span></a>                <span class="p">)</span>
</span><span id="L-2565"><a href="#L-2565"><span class="linenos">2565</span></a>        <span class="k">return</span> <span class="n">reduced_value</span>
</span><span id="L-2566"><a href="#L-2566"><span class="linenos">2566</span></a>
</span><span id="L-2567"><a href="#L-2567"><span class="linenos">2567</span></a>    <span class="k">def</span> <span class="nf">possible_trades</span><span class="p">(</span>
</span><span id="L-2568"><a href="#L-2568"><span class="linenos">2568</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-2569"><a href="#L-2569"><span class="linenos">2569</span></a>        <span class="n">focus_on</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[],</span>
</span><span id="L-2570"><a href="#L-2570"><span class="linenos">2570</span></a>        <span class="n">exclude</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[],</span>
</span><span id="L-2571"><a href="#L-2571"><span class="linenos">2571</span></a>        <span class="n">given</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[],</span>
</span><span id="L-2572"><a href="#L-2572"><span class="linenos">2572</span></a>        <span class="n">limit_per</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="L-2573"><a href="#L-2573"><span class="linenos">2573</span></a>        <span class="n">team_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2574"><a href="#L-2574"><span class="linenos">2574</span></a>        <span class="n">postseason</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-2575"><a href="#L-2575"><span class="linenos">2575</span></a>        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-2576"><a href="#L-2576"><span class="linenos">2576</span></a>        <span class="n">payouts</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">800</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
</span><span id="L-2577"><a href="#L-2577"><span class="linenos">2577</span></a>        <span class="n">bestball</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-2578"><a href="#L-2578"><span class="linenos">2578</span></a>    <span class="p">):</span>
</span><span id="L-2579"><a href="#L-2579"><span class="linenos">2579</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2580"><a href="#L-2580"><span class="linenos">2580</span></a><span class="sd">        Simulates the remainder of the season with the current roster and compares it to </span>
</span><span id="L-2581"><a href="#L-2581"><span class="linenos">2581</span></a><span class="sd">        a simulation of the roster after a series of potential trade transactions.</span>
</span><span id="L-2582"><a href="#L-2582"><span class="linenos">2582</span></a>
</span><span id="L-2583"><a href="#L-2583"><span class="linenos">2583</span></a><span class="sd">        Args:</span>
</span><span id="L-2584"><a href="#L-2584"><span class="linenos">2584</span></a><span class="sd">            focus_on (list, optional): list of players to include in every potential trade, defaults to [].  </span>
</span><span id="L-2585"><a href="#L-2585"><span class="linenos">2585</span></a><span class="sd">            exclude (list, optional): list of players to exclude from every potential trade, defaults to [].  </span>
</span><span id="L-2586"><a href="#L-2586"><span class="linenos">2586</span></a><span class="sd">            given (list, optional): list of players to include in the trade in the background, defaults to [].  </span>
</span><span id="L-2587"><a href="#L-2587"><span class="linenos">2587</span></a><span class="sd">            limit_per (int, optional): number of players per position to analyze, defaults to 10.  </span>
</span><span id="L-2588"><a href="#L-2588"><span class="linenos">2588</span></a><span class="sd">            team_name (str, optional): name of team to analyze trades for, defaults to None (and therefore team of interest).  </span>
</span><span id="L-2589"><a href="#L-2589"><span class="linenos">2589</span></a><span class="sd">            postseason (bool, optional): whether to analyze postseason gains or just regular season, defaults to True.  </span>
</span><span id="L-2590"><a href="#L-2590"><span class="linenos">2590</span></a><span class="sd">            verbose (bool, optional): whether to print out a status report as the code runs, defaults to True.  </span>
</span><span id="L-2591"><a href="#L-2591"><span class="linenos">2591</span></a><span class="sd">            payouts (list, optional): list of payout amounts for top three finishers, defaults to [800, 300, 100].  </span>
</span><span id="L-2592"><a href="#L-2592"><span class="linenos">2592</span></a><span class="sd">            bestball (bool, optional): whether to use best ball settings during simulation, defaults to False.</span>
</span><span id="L-2593"><a href="#L-2593"><span class="linenos">2593</span></a>
</span><span id="L-2594"><a href="#L-2594"><span class="linenos">2594</span></a><span class="sd">        Returns:</span>
</span><span id="L-2595"><a href="#L-2595"><span class="linenos">2595</span></a><span class="sd">            pd.DataFrame: dataframe containing the impact and value of every possible trade analyzed.</span>
</span><span id="L-2596"><a href="#L-2596"><span class="linenos">2596</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2597"><a href="#L-2597"><span class="linenos">2597</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_oauth</span><span class="p">()</span>
</span><span id="L-2598"><a href="#L-2598"><span class="linenos">2598</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">team_name</span><span class="p">:</span>
</span><span id="L-2599"><a href="#L-2599"><span class="linenos">2599</span></a>            <span class="n">team_name</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-2600"><a href="#L-2600"><span class="linenos">2600</span></a>                <span class="n">team</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
</span><span id="L-2601"><a href="#L-2601"><span class="linenos">2601</span></a>                <span class="k">for</span> <span class="n">team</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">teams</span>
</span><span id="L-2602"><a href="#L-2602"><span class="linenos">2602</span></a>                <span class="k">if</span> <span class="n">team</span><span class="p">[</span><span class="s2">&quot;team_key&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">lg</span><span class="o">.</span><span class="n">team_key</span><span class="p">()</span>
</span><span id="L-2603"><a href="#L-2603"><span class="linenos">2603</span></a>            <span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-2604"><a href="#L-2604"><span class="linenos">2604</span></a>        <span class="n">my_players</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-2605"><a href="#L-2605"><span class="linenos">2605</span></a>            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">fantasy_team</span> <span class="o">==</span> <span class="n">team_name</span><span class="p">)</span>
</span><span id="L-2606"><a href="#L-2606"><span class="linenos">2606</span></a>            <span class="o">&amp;</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;K&quot;</span><span class="p">,</span> <span class="s2">&quot;DEF&quot;</span><span class="p">])</span>
</span><span id="L-2607"><a href="#L-2607"><span class="linenos">2607</span></a>        <span class="p">]</span>
</span><span id="L-2608"><a href="#L-2608"><span class="linenos">2608</span></a>        <span class="k">if</span> <span class="n">my_players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">focus_on</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-2609"><a href="#L-2609"><span class="linenos">2609</span></a>            <span class="n">my_players</span> <span class="o">=</span> <span class="n">my_players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">my_players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">focus_on</span><span class="p">)]</span>
</span><span id="L-2610"><a href="#L-2610"><span class="linenos">2610</span></a>        <span class="k">if</span> <span class="n">my_players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">exclude</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-2611"><a href="#L-2611"><span class="linenos">2611</span></a>            <span class="n">my_players</span> <span class="o">=</span> <span class="n">my_players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">my_players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">exclude</span><span class="p">)]</span>
</span><span id="L-2612"><a href="#L-2612"><span class="linenos">2612</span></a>        <span class="n">their_players</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-2613"><a href="#L-2613"><span class="linenos">2613</span></a>            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">fantasy_team</span> <span class="o">!=</span> <span class="n">team_name</span><span class="p">)</span>
</span><span id="L-2614"><a href="#L-2614"><span class="linenos">2614</span></a>            <span class="o">&amp;</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;K&quot;</span><span class="p">,</span> <span class="s2">&quot;DEF&quot;</span><span class="p">])</span>
</span><span id="L-2615"><a href="#L-2615"><span class="linenos">2615</span></a>        <span class="p">]</span>
</span><span id="L-2616"><a href="#L-2616"><span class="linenos">2616</span></a>        <span class="k">if</span> <span class="n">their_players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">focus_on</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-2617"><a href="#L-2617"><span class="linenos">2617</span></a>            <span class="n">their_players</span> <span class="o">=</span> <span class="n">their_players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">their_players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">focus_on</span><span class="p">)]</span>
</span><span id="L-2618"><a href="#L-2618"><span class="linenos">2618</span></a>        <span class="k">if</span> <span class="n">their_players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">exclude</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-2619"><a href="#L-2619"><span class="linenos">2619</span></a>            <span class="n">their_players</span> <span class="o">=</span> <span class="n">their_players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">their_players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">exclude</span><span class="p">)]</span>
</span><span id="L-2620"><a href="#L-2620"><span class="linenos">2620</span></a>        <span class="k">if</span> <span class="n">bestball</span><span class="p">:</span>
</span><span id="L-2621"><a href="#L-2621"><span class="linenos">2621</span></a>            <span class="n">orig_standings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bestball_sims</span><span class="p">(</span><span class="n">payouts</span><span class="p">)</span>
</span><span id="L-2622"><a href="#L-2622"><span class="linenos">2622</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-2623"><a href="#L-2623"><span class="linenos">2623</span></a>            <span class="n">orig_standings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">season_sims</span><span class="p">(</span><span class="n">postseason</span><span class="p">,</span> <span class="n">payouts</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-2624"><a href="#L-2624"><span class="linenos">2624</span></a>
</span><span id="L-2625"><a href="#L-2625"><span class="linenos">2625</span></a>        <span class="c1"># Make sure there are two teams and narrow down to that team!!!</span>
</span><span id="L-2626"><a href="#L-2626"><span class="linenos">2626</span></a>        <span class="n">given_check</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-2627"><a href="#L-2627"><span class="linenos">2627</span></a>            <span class="nb">type</span><span class="p">(</span><span class="n">given</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span>
</span><span id="L-2628"><a href="#L-2628"><span class="linenos">2628</span></a>            <span class="ow">and</span> <span class="n">my_players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">given</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
</span><span id="L-2629"><a href="#L-2629"><span class="linenos">2629</span></a>            <span class="ow">and</span> <span class="n">their_players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">their_players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">given</span><span class="p">),</span> <span class="s2">&quot;fantasy_team&quot;</span><span class="p">]</span>
</span><span id="L-2630"><a href="#L-2630"><span class="linenos">2630</span></a>            <span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</span><span id="L-2631"><a href="#L-2631"><span class="linenos">2631</span></a>            <span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-2632"><a href="#L-2632"><span class="linenos">2632</span></a>            <span class="o">==</span> <span class="mi">1</span>
</span><span id="L-2633"><a href="#L-2633"><span class="linenos">2633</span></a>        <span class="p">)</span>
</span><span id="L-2634"><a href="#L-2634"><span class="linenos">2634</span></a>        <span class="k">if</span> <span class="n">given_check</span><span class="p">:</span>
</span><span id="L-2635"><a href="#L-2635"><span class="linenos">2635</span></a>            <span class="n">mine</span> <span class="o">=</span> <span class="p">[</span><span class="n">player</span> <span class="k">for</span> <span class="n">player</span> <span class="ow">in</span> <span class="n">given</span> <span class="k">if</span> <span class="n">my_players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="n">player</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">()]</span>
</span><span id="L-2636"><a href="#L-2636"><span class="linenos">2636</span></a>            <span class="n">theirs</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-2637"><a href="#L-2637"><span class="linenos">2637</span></a>                <span class="n">player</span> <span class="k">for</span> <span class="n">player</span> <span class="ow">in</span> <span class="n">given</span> <span class="k">if</span> <span class="n">their_players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="n">player</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
</span><span id="L-2638"><a href="#L-2638"><span class="linenos">2638</span></a>            <span class="p">]</span>
</span><span id="L-2639"><a href="#L-2639"><span class="linenos">2639</span></a>            <span class="n">their_team</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-2640"><a href="#L-2640"><span class="linenos">2640</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">theirs</span><span class="p">),</span> <span class="s2">&quot;fantasy_team&quot;</span>
</span><span id="L-2641"><a href="#L-2641"><span class="linenos">2641</span></a>            <span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-2642"><a href="#L-2642"><span class="linenos">2642</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">mine</span><span class="p">),</span> <span class="s2">&quot;fantasy_team&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">their_team</span>
</span><span id="L-2643"><a href="#L-2643"><span class="linenos">2643</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">theirs</span><span class="p">),</span> <span class="s2">&quot;fantasy_team&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">team_name</span>
</span><span id="L-2644"><a href="#L-2644"><span class="linenos">2644</span></a>            <span class="n">my_players</span> <span class="o">=</span> <span class="n">my_players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">my_players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">given</span><span class="p">)]</span>
</span><span id="L-2645"><a href="#L-2645"><span class="linenos">2645</span></a>            <span class="n">their_players</span> <span class="o">=</span> <span class="n">their_players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-2646"><a href="#L-2646"><span class="linenos">2646</span></a>                <span class="p">(</span><span class="n">their_players</span><span class="o">.</span><span class="n">fantasy_team</span> <span class="o">==</span> <span class="n">their_team</span><span class="p">)</span>
</span><span id="L-2647"><a href="#L-2647"><span class="linenos">2647</span></a>                <span class="o">&amp;</span> <span class="o">~</span><span class="n">their_players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">given</span><span class="p">)</span>
</span><span id="L-2648"><a href="#L-2648"><span class="linenos">2648</span></a>            <span class="p">]</span>
</span><span id="L-2649"><a href="#L-2649"><span class="linenos">2649</span></a>            <span class="n">my_players</span><span class="p">[</span><span class="s2">&quot;WAR&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-2650"><a href="#L-2650"><span class="linenos">2650</span></a>            <span class="n">their_players</span><span class="p">[</span><span class="s2">&quot;WAR&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-2651"><a href="#L-2651"><span class="linenos">2651</span></a>        <span class="c1"># Make sure there are two teams and narrow down to that teams!!!</span>
</span><span id="L-2652"><a href="#L-2652"><span class="linenos">2652</span></a>
</span><span id="L-2653"><a href="#L-2653"><span class="linenos">2653</span></a>        <span class="n">my_added_value</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="L-2654"><a href="#L-2654"><span class="linenos">2654</span></a>        <span class="n">their_added_value</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="L-2655"><a href="#L-2655"><span class="linenos">2655</span></a>        <span class="k">for</span> <span class="n">my_player</span> <span class="ow">in</span> <span class="n">my_players</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
</span><span id="L-2656"><a href="#L-2656"><span class="linenos">2656</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">refresh_oauth</span><span class="p">(</span><span class="mi">55</span><span class="p">)</span>
</span><span id="L-2657"><a href="#L-2657"><span class="linenos">2657</span></a>            <span class="k">if</span> <span class="n">their_players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">focus_on</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="L-2658"><a href="#L-2658"><span class="linenos">2658</span></a>                <span class="n">possible</span> <span class="o">=</span> <span class="n">their_players</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-2659"><a href="#L-2659"><span class="linenos">2659</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-2660"><a href="#L-2660"><span class="linenos">2660</span></a>                <span class="n">possible</span> <span class="o">=</span> <span class="n">their_players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-2661"><a href="#L-2661"><span class="linenos">2661</span></a>                    <span class="nb">abs</span><span class="p">(</span>
</span><span id="L-2662"><a href="#L-2662"><span class="linenos">2662</span></a>                        <span class="n">their_players</span><span class="o">.</span><span class="n">WAR</span>
</span><span id="L-2663"><a href="#L-2663"><span class="linenos">2663</span></a>                        <span class="o">-</span> <span class="n">my_players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">my_players</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">my_player</span><span class="p">,</span> <span class="s2">&quot;WAR&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-2664"><a href="#L-2664"><span class="linenos">2664</span></a>                    <span class="p">)</span>
</span><span id="L-2665"><a href="#L-2665"><span class="linenos">2665</span></a>                    <span class="o">&lt;=</span> <span class="mf">0.5</span>
</span><span id="L-2666"><a href="#L-2666"><span class="linenos">2666</span></a>                <span class="p">]</span>
</span><span id="L-2667"><a href="#L-2667"><span class="linenos">2667</span></a>            <span class="c1"># possible = their_players.loc[their_players.WAR - my_players.loc[my_players.name == my_player,&#39;WAR&#39;].values[0] &gt; -1.0]</span>
</span><span id="L-2668"><a href="#L-2668"><span class="linenos">2668</span></a>            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-2669"><a href="#L-2669"><span class="linenos">2669</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">my_player</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">possible</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; comparable players&quot;</span><span class="p">)</span>
</span><span id="L-2670"><a href="#L-2670"><span class="linenos">2670</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">())</span>
</span><span id="L-2671"><a href="#L-2671"><span class="linenos">2671</span></a>            <span class="n">possible</span> <span class="o">=</span> <span class="n">possible</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;position&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">limit_per</span><span class="p">)</span>
</span><span id="L-2672"><a href="#L-2672"><span class="linenos">2672</span></a>            <span class="k">for</span> <span class="n">their_player</span> <span class="ow">in</span> <span class="n">possible</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
</span><span id="L-2673"><a href="#L-2673"><span class="linenos">2673</span></a>                <span class="n">their_team</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-2674"><a href="#L-2674"><span class="linenos">2674</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">their_player</span><span class="p">,</span> <span class="s2">&quot;fantasy_team&quot;</span>
</span><span id="L-2675"><a href="#L-2675"><span class="linenos">2675</span></a>                <span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-2676"><a href="#L-2676"><span class="linenos">2676</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-2677"><a href="#L-2677"><span class="linenos">2677</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">my_player</span><span class="p">,</span> <span class="s2">&quot;fantasy_team&quot;</span>
</span><span id="L-2678"><a href="#L-2678"><span class="linenos">2678</span></a>                <span class="p">]</span> <span class="o">=</span> <span class="n">their_team</span>
</span><span id="L-2679"><a href="#L-2679"><span class="linenos">2679</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-2680"><a href="#L-2680"><span class="linenos">2680</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">their_player</span><span class="p">,</span> <span class="s2">&quot;fantasy_team&quot;</span>
</span><span id="L-2681"><a href="#L-2681"><span class="linenos">2681</span></a>                <span class="p">]</span> <span class="o">=</span> <span class="n">team_name</span>
</span><span id="L-2682"><a href="#L-2682"><span class="linenos">2682</span></a>                <span class="k">if</span> <span class="n">bestball</span><span class="p">:</span>
</span><span id="L-2683"><a href="#L-2683"><span class="linenos">2683</span></a>                    <span class="n">new_standings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bestball_sims</span><span class="p">(</span><span class="n">payouts</span><span class="p">)</span>
</span><span id="L-2684"><a href="#L-2684"><span class="linenos">2684</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-2685"><a href="#L-2685"><span class="linenos">2685</span></a>                    <span class="n">new_standings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">season_sims</span><span class="p">(</span><span class="n">postseason</span><span class="p">,</span> <span class="n">payouts</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-2686"><a href="#L-2686"><span class="linenos">2686</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-2687"><a href="#L-2687"><span class="linenos">2687</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">my_player</span><span class="p">,</span> <span class="s2">&quot;fantasy_team&quot;</span>
</span><span id="L-2688"><a href="#L-2688"><span class="linenos">2688</span></a>                <span class="p">]</span> <span class="o">=</span> <span class="n">team_name</span>
</span><span id="L-2689"><a href="#L-2689"><span class="linenos">2689</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-2690"><a href="#L-2690"><span class="linenos">2690</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">their_player</span><span class="p">,</span> <span class="s2">&quot;fantasy_team&quot;</span>
</span><span id="L-2691"><a href="#L-2691"><span class="linenos">2691</span></a>                <span class="p">]</span> <span class="o">=</span> <span class="n">their_team</span>
</span><span id="L-2692"><a href="#L-2692"><span class="linenos">2692</span></a>                <span class="n">new_standings</span><span class="p">[</span><span class="s2">&quot;player_to_trade_away&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">my_player</span>
</span><span id="L-2693"><a href="#L-2693"><span class="linenos">2693</span></a>                <span class="n">new_standings</span><span class="p">[</span><span class="s2">&quot;player_to_trade_for&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">their_player</span>
</span><span id="L-2694"><a href="#L-2694"><span class="linenos">2694</span></a>                <span class="n">my_added_value</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">my_added_value</span><span class="p">,</span>
</span><span id="L-2695"><a href="#L-2695"><span class="linenos">2695</span></a>                    <span class="n">new_standings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">new_standings</span><span class="o">.</span><span class="n">team</span> <span class="o">==</span> <span class="n">team_name</span><span class="p">]],</span>
</span><span id="L-2696"><a href="#L-2696"><span class="linenos">2696</span></a>                    <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-2697"><a href="#L-2697"><span class="linenos">2697</span></a>                <span class="p">)</span>
</span><span id="L-2698"><a href="#L-2698"><span class="linenos">2698</span></a>                <span class="n">their_added_value</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">their_added_value</span><span class="p">,</span>
</span><span id="L-2699"><a href="#L-2699"><span class="linenos">2699</span></a>                    <span class="n">new_standings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">new_standings</span><span class="o">.</span><span class="n">team</span> <span class="o">==</span> <span class="n">their_team</span><span class="p">]],</span>
</span><span id="L-2700"><a href="#L-2700"><span class="linenos">2700</span></a>                    <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-2701"><a href="#L-2701"><span class="linenos">2701</span></a>                <span class="p">)</span>
</span><span id="L-2702"><a href="#L-2702"><span class="linenos">2702</span></a>            <span class="k">if</span> <span class="n">verbose</span> <span class="ow">and</span> <span class="n">possible</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-2703"><a href="#L-2703"><span class="linenos">2703</span></a>                <span class="n">me</span> <span class="o">=</span> <span class="n">my_added_value</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">possible</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">:][</span>
</span><span id="L-2704"><a href="#L-2704"><span class="linenos">2704</span></a>                    <span class="p">[</span><span class="s2">&quot;player_to_trade_away&quot;</span><span class="p">,</span> <span class="s2">&quot;player_to_trade_for&quot;</span><span class="p">,</span> <span class="s2">&quot;earnings&quot;</span><span class="p">]</span>
</span><span id="L-2705"><a href="#L-2705"><span class="linenos">2705</span></a>                <span class="p">]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;earnings&quot;</span><span class="p">:</span> <span class="s2">&quot;my_earnings&quot;</span><span class="p">})</span>
</span><span id="L-2706"><a href="#L-2706"><span class="linenos">2706</span></a>                <span class="n">them</span> <span class="o">=</span> <span class="n">their_added_value</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">possible</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">:][</span>
</span><span id="L-2707"><a href="#L-2707"><span class="linenos">2707</span></a>                    <span class="p">[</span><span class="s2">&quot;player_to_trade_away&quot;</span><span class="p">,</span> <span class="s2">&quot;player_to_trade_for&quot;</span><span class="p">,</span> <span class="s2">&quot;team&quot;</span><span class="p">,</span> <span class="s2">&quot;earnings&quot;</span><span class="p">]</span>
</span><span id="L-2708"><a href="#L-2708"><span class="linenos">2708</span></a>                <span class="p">]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;earnings&quot;</span><span class="p">:</span> <span class="s2">&quot;their_earnings&quot;</span><span class="p">})</span>
</span><span id="L-2709"><a href="#L-2709"><span class="linenos">2709</span></a>                <span class="n">me</span><span class="p">[</span><span class="s2">&quot;my_earnings&quot;</span><span class="p">]</span> <span class="o">-=</span> <span class="n">orig_standings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-2710"><a href="#L-2710"><span class="linenos">2710</span></a>                    <span class="n">orig_standings</span><span class="o">.</span><span class="n">team</span> <span class="o">==</span> <span class="n">team_name</span><span class="p">,</span> <span class="s2">&quot;earnings&quot;</span>
</span><span id="L-2711"><a href="#L-2711"><span class="linenos">2711</span></a>                <span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-2712"><a href="#L-2712"><span class="linenos">2712</span></a>                <span class="k">for</span> <span class="n">their_team</span> <span class="ow">in</span> <span class="n">them</span><span class="o">.</span><span class="n">team</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
</span><span id="L-2713"><a href="#L-2713"><span class="linenos">2713</span></a>                    <span class="n">them</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-2714"><a href="#L-2714"><span class="linenos">2714</span></a>                        <span class="n">them</span><span class="o">.</span><span class="n">team</span> <span class="o">==</span> <span class="n">their_team</span><span class="p">,</span> <span class="s2">&quot;their_earnings&quot;</span>
</span><span id="L-2715"><a href="#L-2715"><span class="linenos">2715</span></a>                    <span class="p">]</span> <span class="o">-=</span> <span class="n">orig_standings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-2716"><a href="#L-2716"><span class="linenos">2716</span></a>                        <span class="n">orig_standings</span><span class="o">.</span><span class="n">team</span> <span class="o">==</span> <span class="n">their_team</span><span class="p">,</span> <span class="s2">&quot;earnings&quot;</span>
</span><span id="L-2717"><a href="#L-2717"><span class="linenos">2717</span></a>                    <span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span>
</span><span id="L-2718"><a href="#L-2718"><span class="linenos">2718</span></a>                        <span class="mi">0</span>
</span><span id="L-2719"><a href="#L-2719"><span class="linenos">2719</span></a>                    <span class="p">]</span>
</span><span id="L-2720"><a href="#L-2720"><span class="linenos">2720</span></a>                <span class="n">temp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="L-2721"><a href="#L-2721"><span class="linenos">2721</span></a>                    <span class="n">left</span><span class="o">=</span><span class="n">me</span><span class="p">,</span>
</span><span id="L-2722"><a href="#L-2722"><span class="linenos">2722</span></a>                    <span class="n">right</span><span class="o">=</span><span class="n">them</span><span class="p">,</span>
</span><span id="L-2723"><a href="#L-2723"><span class="linenos">2723</span></a>                    <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">,</span>
</span><span id="L-2724"><a href="#L-2724"><span class="linenos">2724</span></a>                    <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;player_to_trade_away&quot;</span><span class="p">,</span> <span class="s2">&quot;player_to_trade_for&quot;</span><span class="p">],</span>
</span><span id="L-2725"><a href="#L-2725"><span class="linenos">2725</span></a>                <span class="p">)</span>
</span><span id="L-2726"><a href="#L-2726"><span class="linenos">2726</span></a>                <span class="k">if</span> <span class="n">temp</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-2727"><a href="#L-2727"><span class="linenos">2727</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="L-2728"><a href="#L-2728"><span class="linenos">2728</span></a>                        <span class="n">temp</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;my_earnings&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span>
</span><span id="L-2729"><a href="#L-2729"><span class="linenos">2729</span></a>                            <span class="n">index</span><span class="o">=</span><span class="kc">False</span>
</span><span id="L-2730"><a href="#L-2730"><span class="linenos">2730</span></a>                        <span class="p">)</span>
</span><span id="L-2731"><a href="#L-2731"><span class="linenos">2731</span></a>                    <span class="p">)</span>
</span><span id="L-2732"><a href="#L-2732"><span class="linenos">2732</span></a>                <span class="k">del</span> <span class="n">me</span><span class="p">,</span> <span class="n">them</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">their_team</span>
</span><span id="L-2733"><a href="#L-2733"><span class="linenos">2733</span></a>
</span><span id="L-2734"><a href="#L-2734"><span class="linenos">2734</span></a>        <span class="k">if</span> <span class="n">given_check</span><span class="p">:</span>
</span><span id="L-2735"><a href="#L-2735"><span class="linenos">2735</span></a>            <span class="n">mine</span> <span class="o">=</span> <span class="p">[</span><span class="n">player</span> <span class="k">for</span> <span class="n">player</span> <span class="ow">in</span> <span class="n">given</span> <span class="k">if</span> <span class="n">my_players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="n">player</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">()]</span>
</span><span id="L-2736"><a href="#L-2736"><span class="linenos">2736</span></a>            <span class="n">theirs</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-2737"><a href="#L-2737"><span class="linenos">2737</span></a>                <span class="n">player</span> <span class="k">for</span> <span class="n">player</span> <span class="ow">in</span> <span class="n">given</span> <span class="k">if</span> <span class="n">their_players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="n">player</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
</span><span id="L-2738"><a href="#L-2738"><span class="linenos">2738</span></a>            <span class="p">]</span>
</span><span id="L-2739"><a href="#L-2739"><span class="linenos">2739</span></a>            <span class="n">their_team</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-2740"><a href="#L-2740"><span class="linenos">2740</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">theirs</span><span class="p">),</span> <span class="s2">&quot;fantasy_team&quot;</span>
</span><span id="L-2741"><a href="#L-2741"><span class="linenos">2741</span></a>            <span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-2742"><a href="#L-2742"><span class="linenos">2742</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">mine</span><span class="p">),</span> <span class="s2">&quot;fantasy_team&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">their_team</span>
</span><span id="L-2743"><a href="#L-2743"><span class="linenos">2743</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">theirs</span><span class="p">),</span> <span class="s2">&quot;fantasy_team&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">team_name</span>
</span><span id="L-2744"><a href="#L-2744"><span class="linenos">2744</span></a>
</span><span id="L-2745"><a href="#L-2745"><span class="linenos">2745</span></a>        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="L-2746"><a href="#L-2746"><span class="linenos">2746</span></a>            <span class="s2">&quot;wins_avg&quot;</span><span class="p">,</span>
</span><span id="L-2747"><a href="#L-2747"><span class="linenos">2747</span></a>            <span class="s2">&quot;wins_stdev&quot;</span><span class="p">,</span>
</span><span id="L-2748"><a href="#L-2748"><span class="linenos">2748</span></a>            <span class="s2">&quot;points_avg&quot;</span><span class="p">,</span>
</span><span id="L-2749"><a href="#L-2749"><span class="linenos">2749</span></a>            <span class="s2">&quot;points_stdev&quot;</span><span class="p">,</span>
</span><span id="L-2750"><a href="#L-2750"><span class="linenos">2750</span></a>            <span class="s2">&quot;per_game_avg&quot;</span><span class="p">,</span>
</span><span id="L-2751"><a href="#L-2751"><span class="linenos">2751</span></a>            <span class="s2">&quot;per_game_stdev&quot;</span><span class="p">,</span>
</span><span id="L-2752"><a href="#L-2752"><span class="linenos">2752</span></a>            <span class="s2">&quot;per_game_fano&quot;</span><span class="p">,</span>
</span><span id="L-2753"><a href="#L-2753"><span class="linenos">2753</span></a>            <span class="s2">&quot;playoffs&quot;</span><span class="p">,</span>
</span><span id="L-2754"><a href="#L-2754"><span class="linenos">2754</span></a>            <span class="s2">&quot;playoff_bye&quot;</span><span class="p">,</span>
</span><span id="L-2755"><a href="#L-2755"><span class="linenos">2755</span></a>        <span class="p">]</span> <span class="o">+</span> <span class="p">([</span><span class="s2">&quot;winner&quot;</span><span class="p">,</span> <span class="s2">&quot;runner_up&quot;</span><span class="p">,</span> <span class="s2">&quot;third&quot;</span><span class="p">,</span> <span class="s2">&quot;earnings&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">postseason</span> <span class="k">else</span> <span class="p">[]):</span>
</span><span id="L-2756"><a href="#L-2756"><span class="linenos">2756</span></a>            <span class="n">my_added_value</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">-=</span> <span class="n">orig_standings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-2757"><a href="#L-2757"><span class="linenos">2757</span></a>                <span class="n">orig_standings</span><span class="o">.</span><span class="n">team</span> <span class="o">==</span> <span class="n">team_name</span><span class="p">,</span> <span class="n">col</span>
</span><span id="L-2758"><a href="#L-2758"><span class="linenos">2758</span></a>            <span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-2759"><a href="#L-2759"><span class="linenos">2759</span></a>            <span class="n">my_added_value</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">my_added_value</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="mi">4</span><span class="p">)</span>
</span><span id="L-2760"><a href="#L-2760"><span class="linenos">2760</span></a>        <span class="k">for</span> <span class="n">their_team</span> <span class="ow">in</span> <span class="n">their_added_value</span><span class="o">.</span><span class="n">team</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
</span><span id="L-2761"><a href="#L-2761"><span class="linenos">2761</span></a>            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="L-2762"><a href="#L-2762"><span class="linenos">2762</span></a>                <span class="s2">&quot;wins_avg&quot;</span><span class="p">,</span>
</span><span id="L-2763"><a href="#L-2763"><span class="linenos">2763</span></a>                <span class="s2">&quot;wins_stdev&quot;</span><span class="p">,</span>
</span><span id="L-2764"><a href="#L-2764"><span class="linenos">2764</span></a>                <span class="s2">&quot;points_avg&quot;</span><span class="p">,</span>
</span><span id="L-2765"><a href="#L-2765"><span class="linenos">2765</span></a>                <span class="s2">&quot;points_stdev&quot;</span><span class="p">,</span>
</span><span id="L-2766"><a href="#L-2766"><span class="linenos">2766</span></a>                <span class="s2">&quot;per_game_avg&quot;</span><span class="p">,</span>
</span><span id="L-2767"><a href="#L-2767"><span class="linenos">2767</span></a>                <span class="s2">&quot;per_game_stdev&quot;</span><span class="p">,</span>
</span><span id="L-2768"><a href="#L-2768"><span class="linenos">2768</span></a>                <span class="s2">&quot;per_game_fano&quot;</span><span class="p">,</span>
</span><span id="L-2769"><a href="#L-2769"><span class="linenos">2769</span></a>                <span class="s2">&quot;playoffs&quot;</span><span class="p">,</span>
</span><span id="L-2770"><a href="#L-2770"><span class="linenos">2770</span></a>                <span class="s2">&quot;playoff_bye&quot;</span><span class="p">,</span>
</span><span id="L-2771"><a href="#L-2771"><span class="linenos">2771</span></a>            <span class="p">]</span> <span class="o">+</span> <span class="p">([</span><span class="s2">&quot;winner&quot;</span><span class="p">,</span> <span class="s2">&quot;runner_up&quot;</span><span class="p">,</span> <span class="s2">&quot;third&quot;</span><span class="p">,</span> <span class="s2">&quot;earnings&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">postseason</span> <span class="k">else</span> <span class="p">[]):</span>
</span><span id="L-2772"><a href="#L-2772"><span class="linenos">2772</span></a>                <span class="n">their_added_value</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-2773"><a href="#L-2773"><span class="linenos">2773</span></a>                    <span class="n">their_added_value</span><span class="o">.</span><span class="n">team</span> <span class="o">==</span> <span class="n">their_team</span><span class="p">,</span> <span class="n">col</span>
</span><span id="L-2774"><a href="#L-2774"><span class="linenos">2774</span></a>                <span class="p">]</span> <span class="o">-=</span> <span class="n">orig_standings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">orig_standings</span><span class="o">.</span><span class="n">team</span> <span class="o">==</span> <span class="n">their_team</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span>
</span><span id="L-2775"><a href="#L-2775"><span class="linenos">2775</span></a>                    <span class="mi">0</span>
</span><span id="L-2776"><a href="#L-2776"><span class="linenos">2776</span></a>                <span class="p">]</span>
</span><span id="L-2777"><a href="#L-2777"><span class="linenos">2777</span></a>                <span class="n">their_added_value</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">their_added_value</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="mi">4</span><span class="p">)</span>
</span><span id="L-2778"><a href="#L-2778"><span class="linenos">2778</span></a>        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="L-2779"><a href="#L-2779"><span class="linenos">2779</span></a>            <span class="s2">&quot;team&quot;</span><span class="p">,</span>
</span><span id="L-2780"><a href="#L-2780"><span class="linenos">2780</span></a>            <span class="s2">&quot;wins_avg&quot;</span><span class="p">,</span>
</span><span id="L-2781"><a href="#L-2781"><span class="linenos">2781</span></a>            <span class="s2">&quot;wins_stdev&quot;</span><span class="p">,</span>
</span><span id="L-2782"><a href="#L-2782"><span class="linenos">2782</span></a>            <span class="s2">&quot;points_avg&quot;</span><span class="p">,</span>
</span><span id="L-2783"><a href="#L-2783"><span class="linenos">2783</span></a>            <span class="s2">&quot;points_stdev&quot;</span><span class="p">,</span>
</span><span id="L-2784"><a href="#L-2784"><span class="linenos">2784</span></a>            <span class="s2">&quot;per_game_avg&quot;</span><span class="p">,</span>
</span><span id="L-2785"><a href="#L-2785"><span class="linenos">2785</span></a>            <span class="s2">&quot;per_game_stdev&quot;</span><span class="p">,</span>
</span><span id="L-2786"><a href="#L-2786"><span class="linenos">2786</span></a>            <span class="s2">&quot;per_game_fano&quot;</span><span class="p">,</span>
</span><span id="L-2787"><a href="#L-2787"><span class="linenos">2787</span></a>            <span class="s2">&quot;playoffs&quot;</span><span class="p">,</span>
</span><span id="L-2788"><a href="#L-2788"><span class="linenos">2788</span></a>            <span class="s2">&quot;playoff_bye&quot;</span><span class="p">,</span>
</span><span id="L-2789"><a href="#L-2789"><span class="linenos">2789</span></a>        <span class="p">]</span> <span class="o">+</span> <span class="p">([</span><span class="s2">&quot;winner&quot;</span><span class="p">,</span> <span class="s2">&quot;runner_up&quot;</span><span class="p">,</span> <span class="s2">&quot;third&quot;</span><span class="p">,</span> <span class="s2">&quot;earnings&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">postseason</span> <span class="k">else</span> <span class="p">[]):</span>
</span><span id="L-2790"><a href="#L-2790"><span class="linenos">2790</span></a>            <span class="n">my_added_value</span> <span class="o">=</span> <span class="n">my_added_value</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
</span><span id="L-2791"><a href="#L-2791"><span class="linenos">2791</span></a>                <span class="n">index</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">col</span><span class="p">:</span> <span class="s2">&quot;my_&quot;</span> <span class="o">+</span> <span class="n">col</span><span class="p">}</span>
</span><span id="L-2792"><a href="#L-2792"><span class="linenos">2792</span></a>            <span class="p">)</span>
</span><span id="L-2793"><a href="#L-2793"><span class="linenos">2793</span></a>            <span class="n">their_added_value</span> <span class="o">=</span> <span class="n">their_added_value</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
</span><span id="L-2794"><a href="#L-2794"><span class="linenos">2794</span></a>                <span class="n">index</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">col</span><span class="p">:</span> <span class="s2">&quot;their_&quot;</span> <span class="o">+</span> <span class="n">col</span><span class="p">}</span>
</span><span id="L-2795"><a href="#L-2795"><span class="linenos">2795</span></a>            <span class="p">)</span>
</span><span id="L-2796"><a href="#L-2796"><span class="linenos">2796</span></a>        <span class="n">added_value</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="L-2797"><a href="#L-2797"><span class="linenos">2797</span></a>            <span class="n">left</span><span class="o">=</span><span class="n">my_added_value</span><span class="p">,</span>
</span><span id="L-2798"><a href="#L-2798"><span class="linenos">2798</span></a>            <span class="n">right</span><span class="o">=</span><span class="n">their_added_value</span><span class="p">,</span>
</span><span id="L-2799"><a href="#L-2799"><span class="linenos">2799</span></a>            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">,</span>
</span><span id="L-2800"><a href="#L-2800"><span class="linenos">2800</span></a>            <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;player_to_trade_away&quot;</span><span class="p">,</span> <span class="s2">&quot;player_to_trade_for&quot;</span><span class="p">],</span>
</span><span id="L-2801"><a href="#L-2801"><span class="linenos">2801</span></a>        <span class="p">)</span>
</span><span id="L-2802"><a href="#L-2802"><span class="linenos">2802</span></a>        <span class="n">added_value</span> <span class="o">=</span> <span class="n">added_value</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
</span><span id="L-2803"><a href="#L-2803"><span class="linenos">2803</span></a>            <span class="n">by</span><span class="o">=</span><span class="s2">&quot;my_winner&quot;</span> <span class="k">if</span> <span class="n">postseason</span> <span class="k">else</span> <span class="s2">&quot;playoffs&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span>
</span><span id="L-2804"><a href="#L-2804"><span class="linenos">2804</span></a>        <span class="p">)</span>
</span><span id="L-2805"><a href="#L-2805"><span class="linenos">2805</span></a>        <span class="k">return</span> <span class="n">added_value</span>
</span><span id="L-2806"><a href="#L-2806"><span class="linenos">2806</span></a>
</span><span id="L-2807"><a href="#L-2807"><span class="linenos">2807</span></a>    <span class="k">def</span> <span class="nf">perGameDelta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">team_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">postseason</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">payouts</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">800</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">100</span><span class="p">]):</span>
</span><span id="L-2808"><a href="#L-2808"><span class="linenos">2808</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2809"><a href="#L-2809"><span class="linenos">2809</span></a><span class="sd">        Simulates the remainder of the season and compares it to a simulation </span>
</span><span id="L-2810"><a href="#L-2810"><span class="linenos">2810</span></a><span class="sd">        of the season given one team winning or losing each matchup.</span>
</span><span id="L-2811"><a href="#L-2811"><span class="linenos">2811</span></a>
</span><span id="L-2812"><a href="#L-2812"><span class="linenos">2812</span></a><span class="sd">        Args:</span>
</span><span id="L-2813"><a href="#L-2813"><span class="linenos">2813</span></a><span class="sd">            team_name (str, optional): name of team to analyze matchup values for, defaults to None (and therefore team of interest).  </span>
</span><span id="L-2814"><a href="#L-2814"><span class="linenos">2814</span></a><span class="sd">            postseason (bool, optional): whether to analyze postseason gains or just regular season, defaults to True.  </span>
</span><span id="L-2815"><a href="#L-2815"><span class="linenos">2815</span></a><span class="sd">            payouts (list, optional): list of payout amounts for top three finishers, defaults to [800, 300, 100].</span>
</span><span id="L-2816"><a href="#L-2816"><span class="linenos">2816</span></a>
</span><span id="L-2817"><a href="#L-2817"><span class="linenos">2817</span></a><span class="sd">        Returns:</span>
</span><span id="L-2818"><a href="#L-2818"><span class="linenos">2818</span></a><span class="sd">            pd.DataFrame: dataframe containing the impact and value of every matchup during the week of interest.</span>
</span><span id="L-2819"><a href="#L-2819"><span class="linenos">2819</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2820"><a href="#L-2820"><span class="linenos">2820</span></a>        <span class="n">as_of</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">season</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">week</span>
</span><span id="L-2821"><a href="#L-2821"><span class="linenos">2821</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_oauth</span><span class="p">()</span>
</span><span id="L-2822"><a href="#L-2822"><span class="linenos">2822</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">team_name</span><span class="p">:</span>
</span><span id="L-2823"><a href="#L-2823"><span class="linenos">2823</span></a>            <span class="n">team_name</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-2824"><a href="#L-2824"><span class="linenos">2824</span></a>                <span class="n">team</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
</span><span id="L-2825"><a href="#L-2825"><span class="linenos">2825</span></a>                <span class="k">for</span> <span class="n">team</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">teams</span>
</span><span id="L-2826"><a href="#L-2826"><span class="linenos">2826</span></a>                <span class="k">if</span> <span class="n">team</span><span class="p">[</span><span class="s2">&quot;team_key&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">lg</span><span class="o">.</span><span class="n">team_key</span><span class="p">()</span>
</span><span id="L-2827"><a href="#L-2827"><span class="linenos">2827</span></a>            <span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-2828"><a href="#L-2828"><span class="linenos">2828</span></a>        <span class="n">deltas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">season_sims</span><span class="p">(</span><span class="n">postseason</span><span class="p">,</span> <span class="n">payouts</span><span class="p">)[</span><span class="mi">1</span><span class="p">][[</span><span class="s2">&quot;team&quot;</span><span class="p">,</span> <span class="s2">&quot;earnings&quot;</span><span class="p">]]</span>
</span><span id="L-2829"><a href="#L-2829"><span class="linenos">2829</span></a>        <span class="k">for</span> <span class="n">team</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">fantasy_team</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
</span><span id="L-2830"><a href="#L-2830"><span class="linenos">2830</span></a>            <span class="n">new_standings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">season_sims</span><span class="p">(</span>
</span><span id="L-2831"><a href="#L-2831"><span class="linenos">2831</span></a>                <span class="n">postseason</span><span class="p">,</span> <span class="n">payouts</span><span class="p">,</span> <span class="n">fixed_winner</span><span class="o">=</span><span class="p">[</span><span class="n">as_of</span> <span class="o">%</span> <span class="mi">100</span><span class="p">,</span> <span class="n">team</span><span class="p">]</span>
</span><span id="L-2832"><a href="#L-2832"><span class="linenos">2832</span></a>            <span class="p">)[</span><span class="mi">1</span><span class="p">][[</span><span class="s2">&quot;team&quot;</span><span class="p">,</span> <span class="s2">&quot;earnings&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;earnings&quot;</span><span class="p">:</span> <span class="s2">&quot;earnings_new&quot;</span><span class="p">})</span>
</span><span id="L-2833"><a href="#L-2833"><span class="linenos">2833</span></a>            <span class="n">deltas</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">deltas</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">new_standings</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;team&quot;</span><span class="p">)</span>
</span><span id="L-2834"><a href="#L-2834"><span class="linenos">2834</span></a>            <span class="n">deltas</span><span class="p">[</span><span class="n">team</span><span class="p">]</span> <span class="o">=</span> <span class="n">deltas</span><span class="p">[</span><span class="s2">&quot;earnings_new&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">deltas</span><span class="p">[</span><span class="s2">&quot;earnings&quot;</span><span class="p">]</span>
</span><span id="L-2835"><a href="#L-2835"><span class="linenos">2835</span></a>            <span class="k">del</span> <span class="n">deltas</span><span class="p">[</span><span class="s2">&quot;earnings_new&quot;</span><span class="p">]</span>
</span><span id="L-2836"><a href="#L-2836"><span class="linenos">2836</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">deltas</span><span class="p">[[</span><span class="s2">&quot;team&quot;</span><span class="p">,</span> <span class="n">team</span><span class="p">]]</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
</span><span id="L-2837"><a href="#L-2837"><span class="linenos">2837</span></a>        <span class="k">del</span> <span class="n">deltas</span><span class="p">[</span><span class="s2">&quot;earnings&quot;</span><span class="p">]</span>
</span><span id="L-2838"><a href="#L-2838"><span class="linenos">2838</span></a>        <span class="k">return</span> <span class="p">(</span>
</span><span id="L-2839"><a href="#L-2839"><span class="linenos">2839</span></a>            <span class="n">deltas</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;team&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;index&quot;</span><span class="p">:</span> <span class="s2">&quot;winner&quot;</span><span class="p">})</span>
</span><span id="L-2840"><a href="#L-2840"><span class="linenos">2840</span></a>        <span class="p">)</span>
</span><span id="L-2841"><a href="#L-2841"><span class="linenos">2841</span></a>
</span><span id="L-2842"><a href="#L-2842"><span class="linenos">2842</span></a>
</span><span id="L-2843"><a href="#L-2843"><span class="linenos">2843</span></a><span class="k">def</span> <span class="nf">excelAutofit</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">writer</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelWriter</span><span class="p">,</span> <span class="n">freeze_cols</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="L-2844"><a href="#L-2844"><span class="linenos">2844</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2845"><a href="#L-2845"><span class="linenos">2845</span></a><span class="sd">    Writes the provided dataframe to a new tab in an excel spreadsheet </span>
</span><span id="L-2846"><a href="#L-2846"><span class="linenos">2846</span></a><span class="sd">    with the columns autofitted and autoformatted.</span>
</span><span id="L-2847"><a href="#L-2847"><span class="linenos">2847</span></a>
</span><span id="L-2848"><a href="#L-2848"><span class="linenos">2848</span></a><span class="sd">    Args:</span>
</span><span id="L-2849"><a href="#L-2849"><span class="linenos">2849</span></a><span class="sd">        df (pd.DataFrame): dataframe to print to the excel spreadsheet.  </span>
</span><span id="L-2850"><a href="#L-2850"><span class="linenos">2850</span></a><span class="sd">        name (str): name of the new tab to be added.  </span>
</span><span id="L-2851"><a href="#L-2851"><span class="linenos">2851</span></a><span class="sd">        writer (pd.ExcelWriter): ExcelWriter object representing the excel spreadsheet.</span>
</span><span id="L-2852"><a href="#L-2852"><span class="linenos">2852</span></a>
</span><span id="L-2853"><a href="#L-2853"><span class="linenos">2853</span></a><span class="sd">    Returns:</span>
</span><span id="L-2854"><a href="#L-2854"><span class="linenos">2854</span></a><span class="sd">        pd.ExcelWriter: same excel spreadsheet provided originally with the new tab added.</span>
</span><span id="L-2855"><a href="#L-2855"><span class="linenos">2855</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-2856"><a href="#L-2856"><span class="linenos">2856</span></a>    <span class="n">f</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">book</span><span class="o">.</span><span class="n">add_format</span><span class="p">()</span>
</span><span id="L-2857"><a href="#L-2857"><span class="linenos">2857</span></a>    <span class="n">f</span><span class="o">.</span><span class="n">set_align</span><span class="p">(</span><span class="s2">&quot;center&quot;</span><span class="p">)</span>
</span><span id="L-2858"><a href="#L-2858"><span class="linenos">2858</span></a>    <span class="n">f</span><span class="o">.</span><span class="n">set_align</span><span class="p">(</span><span class="s2">&quot;vcenter&quot;</span><span class="p">)</span>
</span><span id="L-2859"><a href="#L-2859"><span class="linenos">2859</span></a>    <span class="n">m</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">book</span><span class="o">.</span><span class="n">add_format</span><span class="p">({</span><span class="s2">&quot;num_format&quot;</span><span class="p">:</span> <span class="s2">&quot;$0.00&quot;</span><span class="p">})</span>
</span><span id="L-2860"><a href="#L-2860"><span class="linenos">2860</span></a>    <span class="n">m</span><span class="o">.</span><span class="n">set_align</span><span class="p">(</span><span class="s2">&quot;center&quot;</span><span class="p">)</span>
</span><span id="L-2861"><a href="#L-2861"><span class="linenos">2861</span></a>    <span class="n">m</span><span class="o">.</span><span class="n">set_align</span><span class="p">(</span><span class="s2">&quot;vcenter&quot;</span><span class="p">)</span>
</span><span id="L-2862"><a href="#L-2862"><span class="linenos">2862</span></a>    <span class="n">p</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">book</span><span class="o">.</span><span class="n">add_format</span><span class="p">({</span><span class="s2">&quot;num_format&quot;</span><span class="p">:</span> <span class="s2">&quot;0.0%&quot;</span><span class="p">})</span>
</span><span id="L-2863"><a href="#L-2863"><span class="linenos">2863</span></a>    <span class="n">p</span><span class="o">.</span><span class="n">set_align</span><span class="p">(</span><span class="s2">&quot;center&quot;</span><span class="p">)</span>
</span><span id="L-2864"><a href="#L-2864"><span class="linenos">2864</span></a>    <span class="n">p</span><span class="o">.</span><span class="n">set_align</span><span class="p">(</span><span class="s2">&quot;vcenter&quot;</span><span class="p">)</span>
</span><span id="L-2865"><a href="#L-2865"><span class="linenos">2865</span></a>    <span class="n">df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-2866"><a href="#L-2866"><span class="linenos">2866</span></a>    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
</span><span id="L-2867"><a href="#L-2867"><span class="linenos">2867</span></a>        <span class="n">series</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span>
</span><span id="L-2868"><a href="#L-2868"><span class="linenos">2868</span></a>        <span class="n">max_len</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span>
</span><span id="L-2869"><a href="#L-2869"><span class="linenos">2869</span></a>            <span class="nb">max</span><span class="p">((</span><span class="n">series</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="nb">len</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">series</span><span class="o">.</span><span class="n">name</span><span class="p">))))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">50</span>
</span><span id="L-2870"><a href="#L-2870"><span class="linenos">2870</span></a>        <span class="p">)</span>
</span><span id="L-2871"><a href="#L-2871"><span class="linenos">2871</span></a>        <span class="k">if</span> <span class="s2">&quot;earnings&quot;</span> <span class="ow">in</span> <span class="n">col</span> <span class="ow">or</span> <span class="p">(</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;Deltas&quot;</span> <span class="ow">and</span> <span class="n">col</span> <span class="o">!=</span> <span class="s2">&quot;team&quot;</span><span class="p">):</span>
</span><span id="L-2872"><a href="#L-2872"><span class="linenos">2872</span></a>            <span class="n">writer</span><span class="o">.</span><span class="n">sheets</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">set_column</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">max_len</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
</span><span id="L-2873"><a href="#L-2873"><span class="linenos">2873</span></a>        <span class="k">elif</span> <span class="s2">&quot;per_game_&quot;</span> <span class="ow">in</span> <span class="n">col</span> <span class="ow">or</span> <span class="n">col</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_factor&quot;</span><span class="p">):</span>
</span><span id="L-2874"><a href="#L-2874"><span class="linenos">2874</span></a>            <span class="n">writer</span><span class="o">.</span><span class="n">sheets</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">set_column</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">max_len</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;hidden&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>
</span><span id="L-2875"><a href="#L-2875"><span class="linenos">2875</span></a>        <span class="k">elif</span> <span class="n">col</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;my_&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;their_&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_delta&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
</span><span id="L-2876"><a href="#L-2876"><span class="linenos">2876</span></a>            <span class="s2">&quot;_1&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-2877"><a href="#L-2877"><span class="linenos">2877</span></a>        <span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_2&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="L-2878"><a href="#L-2878"><span class="linenos">2878</span></a>            <span class="s2">&quot;playoffs&quot;</span><span class="p">,</span>
</span><span id="L-2879"><a href="#L-2879"><span class="linenos">2879</span></a>            <span class="s2">&quot;playoff_bye&quot;</span><span class="p">,</span>
</span><span id="L-2880"><a href="#L-2880"><span class="linenos">2880</span></a>            <span class="s2">&quot;winner&quot;</span><span class="p">,</span>
</span><span id="L-2881"><a href="#L-2881"><span class="linenos">2881</span></a>            <span class="s2">&quot;runner_up&quot;</span><span class="p">,</span>
</span><span id="L-2882"><a href="#L-2882"><span class="linenos">2882</span></a>            <span class="s2">&quot;third&quot;</span><span class="p">,</span>
</span><span id="L-2883"><a href="#L-2883"><span class="linenos">2883</span></a>            <span class="s2">&quot;many_mile&quot;</span><span class="p">,</span>
</span><span id="L-2884"><a href="#L-2884"><span class="linenos">2884</span></a>            <span class="s2">&quot;pct_rostered&quot;</span><span class="p">,</span>
</span><span id="L-2885"><a href="#L-2885"><span class="linenos">2885</span></a>        <span class="p">]:</span>
</span><span id="L-2886"><a href="#L-2886"><span class="linenos">2886</span></a>            <span class="n">writer</span><span class="o">.</span><span class="n">sheets</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">set_column</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">max_len</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
</span><span id="L-2887"><a href="#L-2887"><span class="linenos">2887</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-2888"><a href="#L-2888"><span class="linenos">2888</span></a>            <span class="n">writer</span><span class="o">.</span><span class="n">sheets</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">set_column</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">max_len</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</span><span id="L-2889"><a href="#L-2889"><span class="linenos">2889</span></a>    <span class="n">writer</span><span class="o">.</span><span class="n">sheets</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">autofilter</span><span class="p">(</span>
</span><span id="L-2890"><a href="#L-2890"><span class="linenos">2890</span></a>        <span class="s2">&quot;A1:&quot;</span>
</span><span id="L-2891"><a href="#L-2891"><span class="linenos">2891</span></a>        <span class="o">+</span> <span class="p">(</span>
</span><span id="L-2892"><a href="#L-2892"><span class="linenos">2892</span></a>            <span class="nb">chr</span><span class="p">(</span><span class="mi">64</span> <span class="o">+</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">26</span><span class="p">)</span> <span class="o">+</span> <span class="nb">chr</span><span class="p">(</span><span class="mi">65</span> <span class="o">+</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">26</span><span class="p">)</span>
</span><span id="L-2893"><a href="#L-2893"><span class="linenos">2893</span></a>        <span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;@&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="L-2894"><a href="#L-2894"><span class="linenos">2894</span></a>        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-2895"><a href="#L-2895"><span class="linenos">2895</span></a>    <span class="p">)</span>
</span><span id="L-2896"><a href="#L-2896"><span class="linenos">2896</span></a>    <span class="n">writer</span><span class="o">.</span><span class="n">sheets</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">freeze_panes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">freeze_cols</span><span class="p">)</span>
</span><span id="L-2897"><a href="#L-2897"><span class="linenos">2897</span></a>    <span class="k">return</span> <span class="n">writer</span>
</span><span id="L-2898"><a href="#L-2898"><span class="linenos">2898</span></a>
</span><span id="L-2899"><a href="#L-2899"><span class="linenos">2899</span></a>
</span><span id="L-2900"><a href="#L-2900"><span class="linenos">2900</span></a><span class="k">def</span> <span class="nf">sendEmail</span><span class="p">(</span><span class="n">subject</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">body</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-2901"><a href="#L-2901"><span class="linenos">2901</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2902"><a href="#L-2902"><span class="linenos">2902</span></a><span class="sd">    Sends an email to the address provided with whichever subject, body, and attachements desired.</span>
</span><span id="L-2903"><a href="#L-2903"><span class="linenos">2903</span></a>
</span><span id="L-2904"><a href="#L-2904"><span class="linenos">2904</span></a><span class="sd">    Args:</span>
</span><span id="L-2905"><a href="#L-2905"><span class="linenos">2905</span></a><span class="sd">        subject (str): subject line of the email to be sent.  </span>
</span><span id="L-2906"><a href="#L-2906"><span class="linenos">2906</span></a><span class="sd">        body (str): body text of the email to be sent.  </span>
</span><span id="L-2907"><a href="#L-2907"><span class="linenos">2907</span></a><span class="sd">        address (str): email address to send the message to.  </span>
</span><span id="L-2908"><a href="#L-2908"><span class="linenos">2908</span></a><span class="sd">        filename (str, optional): location of a file to be attached to the email, defaults to None.</span>
</span><span id="L-2909"><a href="#L-2909"><span class="linenos">2909</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-2910"><a href="#L-2910"><span class="linenos">2910</span></a>    <span class="n">message</span> <span class="o">=</span> <span class="n">MIMEMultipart</span><span class="p">()</span>
</span><span id="L-2911"><a href="#L-2911"><span class="linenos">2911</span></a>    <span class="n">message</span><span class="p">[</span><span class="s2">&quot;From&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;EMAIL_SENDER&quot;</span><span class="p">]</span>
</span><span id="L-2912"><a href="#L-2912"><span class="linenos">2912</span></a>    <span class="n">message</span><span class="p">[</span><span class="s2">&quot;To&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">address</span>
</span><span id="L-2913"><a href="#L-2913"><span class="linenos">2913</span></a>    <span class="n">message</span><span class="p">[</span><span class="s2">&quot;Subject&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">subject</span>
</span><span id="L-2914"><a href="#L-2914"><span class="linenos">2914</span></a>    <span class="n">message</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">MIMEText</span><span class="p">(</span><span class="n">body</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;plain&quot;</span><span class="p">))</span>
</span><span id="L-2915"><a href="#L-2915"><span class="linenos">2915</span></a>    <span class="k">if</span> <span class="n">filename</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">filename</span><span class="p">)):</span>
</span><span id="L-2916"><a href="#L-2916"><span class="linenos">2916</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">attachment</span><span class="p">:</span>
</span><span id="L-2917"><a href="#L-2917"><span class="linenos">2917</span></a>            <span class="n">part</span> <span class="o">=</span> <span class="n">MIMEBase</span><span class="p">(</span><span class="s2">&quot;application&quot;</span><span class="p">,</span> <span class="s2">&quot;octet-stream&quot;</span><span class="p">)</span>
</span><span id="L-2918"><a href="#L-2918"><span class="linenos">2918</span></a>            <span class="n">part</span><span class="o">.</span><span class="n">set_payload</span><span class="p">(</span><span class="n">attachment</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</span><span id="L-2919"><a href="#L-2919"><span class="linenos">2919</span></a>        <span class="n">encoders</span><span class="o">.</span><span class="n">encode_base64</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>
</span><span id="L-2920"><a href="#L-2920"><span class="linenos">2920</span></a>        <span class="n">part</span><span class="o">.</span><span class="n">add_header</span><span class="p">(</span>
</span><span id="L-2921"><a href="#L-2921"><span class="linenos">2921</span></a>            <span class="s2">&quot;Content-Disposition&quot;</span><span class="p">,</span> <span class="s2">&quot;attachment; filename= &quot;</span> <span class="o">+</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-2922"><a href="#L-2922"><span class="linenos">2922</span></a>        <span class="p">)</span>
</span><span id="L-2923"><a href="#L-2923"><span class="linenos">2923</span></a>        <span class="n">message</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>
</span><span id="L-2924"><a href="#L-2924"><span class="linenos">2924</span></a>    <span class="n">text</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">as_string</span><span class="p">()</span>
</span><span id="L-2925"><a href="#L-2925"><span class="linenos">2925</span></a>    <span class="n">context</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">create_default_context</span><span class="p">()</span>
</span><span id="L-2926"><a href="#L-2926"><span class="linenos">2926</span></a>    <span class="k">with</span> <span class="n">smtplib</span><span class="o">.</span><span class="n">SMTP_SSL</span><span class="p">(</span><span class="s2">&quot;smtp.gmail.com&quot;</span><span class="p">,</span> <span class="mi">465</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span> <span class="k">as</span> <span class="n">server</span><span class="p">:</span>
</span><span id="L-2927"><a href="#L-2927"><span class="linenos">2927</span></a>        <span class="n">server</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;EMAIL_SENDER&quot;</span><span class="p">],</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;EMAIL_PW&quot;</span><span class="p">])</span>
</span><span id="L-2928"><a href="#L-2928"><span class="linenos">2928</span></a>        <span class="n">server</span><span class="o">.</span><span class="n">sendmail</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;EMAIL_SENDER&quot;</span><span class="p">],</span> <span class="n">address</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
</span><span id="L-2929"><a href="#L-2929"><span class="linenos">2929</span></a>
</span><span id="L-2930"><a href="#L-2930"><span class="linenos">2930</span></a>
</span><span id="L-2931"><a href="#L-2931"><span class="linenos">2931</span></a><span class="k">def</span> <span class="nf">initialize_inputs</span><span class="p">():</span>
</span><span id="L-2932"><a href="#L-2932"><span class="linenos">2932</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2933"><a href="#L-2933"><span class="linenos">2933</span></a><span class="sd">    Initializing arguments based on command line inputs provided by the user.</span>
</span><span id="L-2934"><a href="#L-2934"><span class="linenos">2934</span></a>
</span><span id="L-2935"><a href="#L-2935"><span class="linenos">2935</span></a><span class="sd">    Returns:</span>
</span><span id="L-2936"><a href="#L-2936"><span class="linenos">2936</span></a><span class="sd">        optparse.Values: collection of cleaned input values based on inputs and basic logic.</span>
</span><span id="L-2937"><a href="#L-2937"><span class="linenos">2937</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-2938"><a href="#L-2938"><span class="linenos">2938</span></a>    <span class="n">parser</span> <span class="o">=</span> <span class="n">optparse</span><span class="o">.</span><span class="n">OptionParser</span><span class="p">()</span>
</span><span id="L-2939"><a href="#L-2939"><span class="linenos">2939</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
</span><span id="L-2940"><a href="#L-2940"><span class="linenos">2940</span></a>        <span class="s2">&quot;--season&quot;</span><span class="p">,</span>
</span><span id="L-2941"><a href="#L-2941"><span class="linenos">2941</span></a>        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span>
</span><span id="L-2942"><a href="#L-2942"><span class="linenos">2942</span></a>        <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;int&quot;</span><span class="p">,</span>
</span><span id="L-2943"><a href="#L-2943"><span class="linenos">2943</span></a>        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;season&quot;</span><span class="p">,</span>
</span><span id="L-2944"><a href="#L-2944"><span class="linenos">2944</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;season of interest&quot;</span>
</span><span id="L-2945"><a href="#L-2945"><span class="linenos">2945</span></a>    <span class="p">)</span>
</span><span id="L-2946"><a href="#L-2946"><span class="linenos">2946</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
</span><span id="L-2947"><a href="#L-2947"><span class="linenos">2947</span></a>        <span class="s2">&quot;--week&quot;</span><span class="p">,</span>
</span><span id="L-2948"><a href="#L-2948"><span class="linenos">2948</span></a>        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span>
</span><span id="L-2949"><a href="#L-2949"><span class="linenos">2949</span></a>        <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;int&quot;</span><span class="p">,</span>
</span><span id="L-2950"><a href="#L-2950"><span class="linenos">2950</span></a>        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;week&quot;</span><span class="p">,</span>
</span><span id="L-2951"><a href="#L-2951"><span class="linenos">2951</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;week to project the season from&quot;</span>
</span><span id="L-2952"><a href="#L-2952"><span class="linenos">2952</span></a>    <span class="p">)</span>
</span><span id="L-2953"><a href="#L-2953"><span class="linenos">2953</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
</span><span id="L-2954"><a href="#L-2954"><span class="linenos">2954</span></a>        <span class="s2">&quot;--name&quot;</span><span class="p">,</span>
</span><span id="L-2955"><a href="#L-2955"><span class="linenos">2955</span></a>        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span>
</span><span id="L-2956"><a href="#L-2956"><span class="linenos">2956</span></a>        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;name&quot;</span><span class="p">,</span>
</span><span id="L-2957"><a href="#L-2957"><span class="linenos">2957</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;name of team to analyze in the case of multiple teams in a single season&quot;</span><span class="p">,</span>
</span><span id="L-2958"><a href="#L-2958"><span class="linenos">2958</span></a>    <span class="p">)</span>
</span><span id="L-2959"><a href="#L-2959"><span class="linenos">2959</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
</span><span id="L-2960"><a href="#L-2960"><span class="linenos">2960</span></a>        <span class="s2">&quot;--earliest&quot;</span><span class="p">,</span>
</span><span id="L-2961"><a href="#L-2961"><span class="linenos">2961</span></a>        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span>
</span><span id="L-2962"><a href="#L-2962"><span class="linenos">2962</span></a>        <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;int&quot;</span><span class="p">,</span>
</span><span id="L-2963"><a href="#L-2963"><span class="linenos">2963</span></a>        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;earliest&quot;</span><span class="p">,</span>
</span><span id="L-2964"><a href="#L-2964"><span class="linenos">2964</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;earliest week of stats being considered, e.g. 201807 corresponds to week 7 of the 2018 season&quot;</span><span class="p">,</span>
</span><span id="L-2965"><a href="#L-2965"><span class="linenos">2965</span></a>    <span class="p">)</span>
</span><span id="L-2966"><a href="#L-2966"><span class="linenos">2966</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
</span><span id="L-2967"><a href="#L-2967"><span class="linenos">2967</span></a>        <span class="s2">&quot;--games&quot;</span><span class="p">,</span>
</span><span id="L-2968"><a href="#L-2968"><span class="linenos">2968</span></a>        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span>
</span><span id="L-2969"><a href="#L-2969"><span class="linenos">2969</span></a>        <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;int&quot;</span><span class="p">,</span>
</span><span id="L-2970"><a href="#L-2970"><span class="linenos">2970</span></a>        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;games&quot;</span><span class="p">,</span>
</span><span id="L-2971"><a href="#L-2971"><span class="linenos">2971</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;number of games to build each player&#39;s prior off of&quot;</span><span class="p">,</span>
</span><span id="L-2972"><a href="#L-2972"><span class="linenos">2972</span></a>    <span class="p">)</span>
</span><span id="L-2973"><a href="#L-2973"><span class="linenos">2973</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
</span><span id="L-2974"><a href="#L-2974"><span class="linenos">2974</span></a>        <span class="s2">&quot;--basaloppstringtime&quot;</span><span class="p">,</span>
</span><span id="L-2975"><a href="#L-2975"><span class="linenos">2975</span></a>        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span>
</span><span id="L-2976"><a href="#L-2976"><span class="linenos">2976</span></a>        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;basaloppstringtime&quot;</span><span class="p">,</span>
</span><span id="L-2977"><a href="#L-2977"><span class="linenos">2977</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;scaling factors for basal/opponent/depthchart/time factors, comma-separated string of values&quot;</span><span class="p">,</span>
</span><span id="L-2978"><a href="#L-2978"><span class="linenos">2978</span></a>    <span class="p">)</span>
</span><span id="L-2979"><a href="#L-2979"><span class="linenos">2979</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
</span><span id="L-2980"><a href="#L-2980"><span class="linenos">2980</span></a>        <span class="s2">&quot;--sims&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;int&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;sims&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;number of season simulations&quot;</span>
</span><span id="L-2981"><a href="#L-2981"><span class="linenos">2981</span></a>    <span class="p">)</span>
</span><span id="L-2982"><a href="#L-2982"><span class="linenos">2982</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
</span><span id="L-2983"><a href="#L-2983"><span class="linenos">2983</span></a>        <span class="s2">&quot;--payouts&quot;</span><span class="p">,</span>
</span><span id="L-2984"><a href="#L-2984"><span class="linenos">2984</span></a>        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span>
</span><span id="L-2985"><a href="#L-2985"><span class="linenos">2985</span></a>        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;payouts&quot;</span><span class="p">,</span>
</span><span id="L-2986"><a href="#L-2986"><span class="linenos">2986</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;comma separated string containing integer payouts for 1st, 2nd, and 3rd&quot;</span><span class="p">,</span>
</span><span id="L-2987"><a href="#L-2987"><span class="linenos">2987</span></a>    <span class="p">)</span>
</span><span id="L-2988"><a href="#L-2988"><span class="linenos">2988</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
</span><span id="L-2989"><a href="#L-2989"><span class="linenos">2989</span></a>        <span class="s2">&quot;--injurytries&quot;</span><span class="p">,</span>
</span><span id="L-2990"><a href="#L-2990"><span class="linenos">2990</span></a>        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span>
</span><span id="L-2991"><a href="#L-2991"><span class="linenos">2991</span></a>        <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;int&quot;</span><span class="p">,</span>
</span><span id="L-2992"><a href="#L-2992"><span class="linenos">2992</span></a>        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;injurytries&quot;</span><span class="p">,</span>
</span><span id="L-2993"><a href="#L-2993"><span class="linenos">2993</span></a>        <span class="n">default</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
</span><span id="L-2994"><a href="#L-2994"><span class="linenos">2994</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;number of times to try pulling injury statuses before rolling with it&quot;</span><span class="p">,</span>
</span><span id="L-2995"><a href="#L-2995"><span class="linenos">2995</span></a>    <span class="p">)</span>
</span><span id="L-2996"><a href="#L-2996"><span class="linenos">2996</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
</span><span id="L-2997"><a href="#L-2997"><span class="linenos">2997</span></a>        <span class="s2">&quot;--bestball&quot;</span><span class="p">,</span>
</span><span id="L-2998"><a href="#L-2998"><span class="linenos">2998</span></a>        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
</span><span id="L-2999"><a href="#L-2999"><span class="linenos">2999</span></a>        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;bestball&quot;</span><span class="p">,</span>
</span><span id="L-3000"><a href="#L-3000"><span class="linenos">3000</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;whether to assess the league of interest in the context of bestball (simulates bench contributions better)&quot;</span><span class="p">,</span>
</span><span id="L-3001"><a href="#L-3001"><span class="linenos">3001</span></a>    <span class="p">)</span>
</span><span id="L-3002"><a href="#L-3002"><span class="linenos">3002</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
</span><span id="L-3003"><a href="#L-3003"><span class="linenos">3003</span></a>        <span class="s2">&quot;--pickups&quot;</span><span class="p">,</span>
</span><span id="L-3004"><a href="#L-3004"><span class="linenos">3004</span></a>        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span>
</span><span id="L-3005"><a href="#L-3005"><span class="linenos">3005</span></a>        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;pickups&quot;</span><span class="p">,</span>
</span><span id="L-3006"><a href="#L-3006"><span class="linenos">3006</span></a>        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;assess possible free agent pickups for the players specified (&quot;all&quot; will analyze all possible pickups)&#39;</span><span class="p">,</span>
</span><span id="L-3007"><a href="#L-3007"><span class="linenos">3007</span></a>    <span class="p">)</span>
</span><span id="L-3008"><a href="#L-3008"><span class="linenos">3008</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
</span><span id="L-3009"><a href="#L-3009"><span class="linenos">3009</span></a>        <span class="s2">&quot;--adds&quot;</span><span class="p">,</span>
</span><span id="L-3010"><a href="#L-3010"><span class="linenos">3010</span></a>        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
</span><span id="L-3011"><a href="#L-3011"><span class="linenos">3011</span></a>        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;adds&quot;</span><span class="p">,</span>
</span><span id="L-3012"><a href="#L-3012"><span class="linenos">3012</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;whether to assess possible free agent adds&quot;</span><span class="p">,</span>
</span><span id="L-3013"><a href="#L-3013"><span class="linenos">3013</span></a>    <span class="p">)</span>
</span><span id="L-3014"><a href="#L-3014"><span class="linenos">3014</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
</span><span id="L-3015"><a href="#L-3015"><span class="linenos">3015</span></a>        <span class="s2">&quot;--drops&quot;</span><span class="p">,</span>
</span><span id="L-3016"><a href="#L-3016"><span class="linenos">3016</span></a>        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
</span><span id="L-3017"><a href="#L-3017"><span class="linenos">3017</span></a>        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;drops&quot;</span><span class="p">,</span>
</span><span id="L-3018"><a href="#L-3018"><span class="linenos">3018</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;whether to assess possible drops&quot;</span><span class="p">,</span>
</span><span id="L-3019"><a href="#L-3019"><span class="linenos">3019</span></a>    <span class="p">)</span>
</span><span id="L-3020"><a href="#L-3020"><span class="linenos">3020</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
</span><span id="L-3021"><a href="#L-3021"><span class="linenos">3021</span></a>        <span class="s2">&quot;--trades&quot;</span><span class="p">,</span>
</span><span id="L-3022"><a href="#L-3022"><span class="linenos">3022</span></a>        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span>
</span><span id="L-3023"><a href="#L-3023"><span class="linenos">3023</span></a>        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;trades&quot;</span><span class="p">,</span>
</span><span id="L-3024"><a href="#L-3024"><span class="linenos">3024</span></a>        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;assess possible trades for the players specified (&quot;all&quot; will analyze all possible trades)&#39;</span><span class="p">,</span>
</span><span id="L-3025"><a href="#L-3025"><span class="linenos">3025</span></a>    <span class="p">)</span>
</span><span id="L-3026"><a href="#L-3026"><span class="linenos">3026</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
</span><span id="L-3027"><a href="#L-3027"><span class="linenos">3027</span></a>        <span class="s2">&quot;--given&quot;</span><span class="p">,</span>
</span><span id="L-3028"><a href="#L-3028"><span class="linenos">3028</span></a>        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span>
</span><span id="L-3029"><a href="#L-3029"><span class="linenos">3029</span></a>        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;given&quot;</span><span class="p">,</span>
</span><span id="L-3030"><a href="#L-3030"><span class="linenos">3030</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;given players to start with for multi-player trades&quot;</span><span class="p">,</span>
</span><span id="L-3031"><a href="#L-3031"><span class="linenos">3031</span></a>    <span class="p">)</span>
</span><span id="L-3032"><a href="#L-3032"><span class="linenos">3032</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
</span><span id="L-3033"><a href="#L-3033"><span class="linenos">3033</span></a>        <span class="s2">&quot;--deltas&quot;</span><span class="p">,</span>
</span><span id="L-3034"><a href="#L-3034"><span class="linenos">3034</span></a>        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
</span><span id="L-3035"><a href="#L-3035"><span class="linenos">3035</span></a>        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;deltas&quot;</span><span class="p">,</span>
</span><span id="L-3036"><a href="#L-3036"><span class="linenos">3036</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;whether to assess deltas for each matchup of the current week&quot;</span><span class="p">,</span>
</span><span id="L-3037"><a href="#L-3037"><span class="linenos">3037</span></a>    <span class="p">)</span>
</span><span id="L-3038"><a href="#L-3038"><span class="linenos">3038</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
</span><span id="L-3039"><a href="#L-3039"><span class="linenos">3039</span></a>        <span class="s2">&quot;--output&quot;</span><span class="p">,</span>
</span><span id="L-3040"><a href="#L-3040"><span class="linenos">3040</span></a>        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span>
</span><span id="L-3041"><a href="#L-3041"><span class="linenos">3041</span></a>        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;output&quot;</span><span class="p">,</span>
</span><span id="L-3042"><a href="#L-3042"><span class="linenos">3042</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;where to save the final projections spreadsheet&quot;</span><span class="p">,</span>
</span><span id="L-3043"><a href="#L-3043"><span class="linenos">3043</span></a>    <span class="p">)</span>
</span><span id="L-3044"><a href="#L-3044"><span class="linenos">3044</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
</span><span id="L-3045"><a href="#L-3045"><span class="linenos">3045</span></a>        <span class="s2">&quot;--email&quot;</span><span class="p">,</span>
</span><span id="L-3046"><a href="#L-3046"><span class="linenos">3046</span></a>        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span>
</span><span id="L-3047"><a href="#L-3047"><span class="linenos">3047</span></a>        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;email&quot;</span><span class="p">,</span>
</span><span id="L-3048"><a href="#L-3048"><span class="linenos">3048</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;where to send the final projections spreadsheet&quot;</span><span class="p">,</span>
</span><span id="L-3049"><a href="#L-3049"><span class="linenos">3049</span></a>    <span class="p">)</span>
</span><span id="L-3050"><a href="#L-3050"><span class="linenos">3050</span></a>    <span class="n">options</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
</span><span id="L-3051"><a href="#L-3051"><span class="linenos">3051</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">options</span><span class="o">.</span><span class="n">season</span><span class="p">:</span>
</span><span id="L-3052"><a href="#L-3052"><span class="linenos">3052</span></a>        <span class="n">options</span><span class="o">.</span><span class="n">season</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">year</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">month</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">)</span>
</span><span id="L-3053"><a href="#L-3053"><span class="linenos">3053</span></a>    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">basaloppstringtime</span><span class="p">:</span>
</span><span id="L-3054"><a href="#L-3054"><span class="linenos">3054</span></a>        <span class="n">options</span><span class="o">.</span><span class="n">basaloppstringtime</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">basaloppstringtime</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
</span><span id="L-3055"><a href="#L-3055"><span class="linenos">3055</span></a>        <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="n">val</span><span class="o">.</span><span class="n">isnumeric</span><span class="p">()</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">basaloppstringtime</span><span class="p">])</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">basal_oppstringtime</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
</span><span id="L-3056"><a href="#L-3056"><span class="linenos">3056</span></a>            <span class="n">options</span><span class="o">.</span><span class="n">basaloppstringtime</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">basaloppstringtime</span><span class="p">]</span>
</span><span id="L-3057"><a href="#L-3057"><span class="linenos">3057</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-3058"><a href="#L-3058"><span class="linenos">3058</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Invalid rate inference parameters, using defaults...&quot;</span><span class="p">)</span>
</span><span id="L-3059"><a href="#L-3059"><span class="linenos">3059</span></a>            <span class="n">options</span><span class="o">.</span><span class="n">basaloppstringtime</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-3060"><a href="#L-3060"><span class="linenos">3060</span></a>    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">payouts</span><span class="p">:</span>
</span><span id="L-3061"><a href="#L-3061"><span class="linenos">3061</span></a>        <span class="n">options</span><span class="o">.</span><span class="n">payouts</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">payouts</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
</span><span id="L-3062"><a href="#L-3062"><span class="linenos">3062</span></a>        <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="n">val</span><span class="o">.</span><span class="n">isnumeric</span><span class="p">()</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">payouts</span><span class="p">])</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">payouts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="L-3063"><a href="#L-3063"><span class="linenos">3063</span></a>            <span class="n">options</span><span class="o">.</span><span class="n">payouts</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">payouts</span><span class="p">]</span>
</span><span id="L-3064"><a href="#L-3064"><span class="linenos">3064</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-3065"><a href="#L-3065"><span class="linenos">3065</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Weird values provided for payouts... Assuming standard payouts...&quot;</span><span class="p">)</span>
</span><span id="L-3066"><a href="#L-3066"><span class="linenos">3066</span></a>            <span class="n">options</span><span class="o">.</span><span class="n">payouts</span> <span class="o">=</span> <span class="p">[</span><span class="mf">60.0</span><span class="p">,</span><span class="mf">30.0</span><span class="p">,</span><span class="mf">10.0</span><span class="p">]</span>
</span><span id="L-3067"><a href="#L-3067"><span class="linenos">3067</span></a>    <span class="k">elif</span> <span class="n">options</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;The Algorithm&quot;</span><span class="p">:</span>
</span><span id="L-3068"><a href="#L-3068"><span class="linenos">3068</span></a>        <span class="n">options</span><span class="o">.</span><span class="n">payouts</span> <span class="o">=</span> <span class="p">[</span><span class="mi">720</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="mi">120</span><span class="p">]</span>
</span><span id="L-3069"><a href="#L-3069"><span class="linenos">3069</span></a>    <span class="k">elif</span> <span class="n">options</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;Toothless Wonders&quot;</span><span class="p">:</span>
</span><span id="L-3070"><a href="#L-3070"><span class="linenos">3070</span></a>        <span class="n">options</span><span class="o">.</span><span class="n">payouts</span> <span class="o">=</span> <span class="p">[</span><span class="mi">350</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">50</span><span class="p">]</span>
</span><span id="L-3071"><a href="#L-3071"><span class="linenos">3071</span></a>    <span class="k">elif</span> <span class="n">options</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;The GENIEs&quot;</span><span class="p">:</span>
</span><span id="L-3072"><a href="#L-3072"><span class="linenos">3072</span></a>        <span class="n">options</span><span class="o">.</span><span class="n">payouts</span> <span class="o">=</span> <span class="p">[</span><span class="mi">120</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="L-3073"><a href="#L-3073"><span class="linenos">3073</span></a>    <span class="k">elif</span> <span class="n">options</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;The Great Gadsby&#39;s&quot;</span><span class="p">:</span>
</span><span id="L-3074"><a href="#L-3074"><span class="linenos">3074</span></a>        <span class="n">options</span><span class="o">.</span><span class="n">payouts</span> <span class="o">=</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">15</span><span class="p">]</span>
</span><span id="L-3075"><a href="#L-3075"><span class="linenos">3075</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-3076"><a href="#L-3076"><span class="linenos">3076</span></a>        <span class="n">options</span><span class="o">.</span><span class="n">payouts</span> <span class="o">=</span> <span class="p">[</span><span class="mf">60.0</span><span class="p">,</span><span class="mf">30.0</span><span class="p">,</span><span class="mf">10.0</span><span class="p">]</span>
</span><span id="L-3077"><a href="#L-3077"><span class="linenos">3077</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">options</span><span class="o">.</span><span class="n">output</span><span class="p">:</span>
</span><span id="L-3078"><a href="#L-3078"><span class="linenos">3078</span></a>        <span class="n">options</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-3079"><a href="#L-3079"><span class="linenos">3079</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s2">&quot;~/Documents/&quot;</span><span class="p">)</span>
</span><span id="L-3080"><a href="#L-3080"><span class="linenos">3080</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s2">&quot;~/Documents/&quot;</span><span class="p">))</span>
</span><span id="L-3081"><a href="#L-3081"><span class="linenos">3081</span></a>            <span class="k">else</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s2">&quot;~/&quot;</span><span class="p">)</span>
</span><span id="L-3082"><a href="#L-3082"><span class="linenos">3082</span></a>        <span class="p">)</span>
</span><span id="L-3083"><a href="#L-3083"><span class="linenos">3083</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">output</span> <span class="o">+</span> <span class="n">options</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)):</span>
</span><span id="L-3084"><a href="#L-3084"><span class="linenos">3084</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">output</span> <span class="o">+</span> <span class="n">options</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
</span><span id="L-3085"><a href="#L-3085"><span class="linenos">3085</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span>
</span><span id="L-3086"><a href="#L-3086"><span class="linenos">3086</span></a>            <span class="n">options</span><span class="o">.</span><span class="n">output</span> <span class="o">+</span> <span class="n">options</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">season</span><span class="p">)</span>
</span><span id="L-3087"><a href="#L-3087"><span class="linenos">3087</span></a>        <span class="p">):</span>
</span><span id="L-3088"><a href="#L-3088"><span class="linenos">3088</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span>
</span><span id="L-3089"><a href="#L-3089"><span class="linenos">3089</span></a>                <span class="n">options</span><span class="o">.</span><span class="n">output</span>
</span><span id="L-3090"><a href="#L-3090"><span class="linenos">3090</span></a>                <span class="o">+</span> <span class="n">options</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="L-3091"><a href="#L-3091"><span class="linenos">3091</span></a>                <span class="o">+</span> <span class="s2">&quot;/&quot;</span>
</span><span id="L-3092"><a href="#L-3092"><span class="linenos">3092</span></a>                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">season</span><span class="p">)</span>
</span><span id="L-3093"><a href="#L-3093"><span class="linenos">3093</span></a>            <span class="p">)</span>
</span><span id="L-3094"><a href="#L-3094"><span class="linenos">3094</span></a>        <span class="n">options</span><span class="o">.</span><span class="n">output</span> <span class="o">+=</span> <span class="n">options</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">season</span><span class="p">)</span>
</span><span id="L-3095"><a href="#L-3095"><span class="linenos">3095</span></a>    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">output</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;/&quot;</span><span class="p">:</span>
</span><span id="L-3096"><a href="#L-3096"><span class="linenos">3096</span></a>        <span class="n">options</span><span class="o">.</span><span class="n">output</span> <span class="o">+=</span> <span class="s2">&quot;/&quot;</span>
</span><span id="L-3097"><a href="#L-3097"><span class="linenos">3097</span></a>    <span class="k">return</span> <span class="n">options</span>
</span><span id="L-3098"><a href="#L-3098"><span class="linenos">3098</span></a>
</span><span id="L-3099"><a href="#L-3099"><span class="linenos">3099</span></a>
</span><span id="L-3100"><a href="#L-3100"><span class="linenos">3100</span></a><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
</span><span id="L-3101"><a href="#L-3101"><span class="linenos">3101</span></a>    <span class="n">options</span> <span class="o">=</span> <span class="n">initialize_inputs</span><span class="p">()</span>
</span><span id="L-3102"><a href="#L-3102"><span class="linenos">3102</span></a>    <span class="n">league</span> <span class="o">=</span> <span class="n">League</span><span class="p">(</span>
</span><span id="L-3103"><a href="#L-3103"><span class="linenos">3103</span></a>        <span class="n">name</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span id="L-3104"><a href="#L-3104"><span class="linenos">3104</span></a>        <span class="n">season</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">season</span><span class="p">,</span>
</span><span id="L-3105"><a href="#L-3105"><span class="linenos">3105</span></a>        <span class="n">week</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">week</span><span class="p">,</span>
</span><span id="L-3106"><a href="#L-3106"><span class="linenos">3106</span></a>        <span class="n">injurytries</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">injurytries</span><span class="p">,</span>
</span><span id="L-3107"><a href="#L-3107"><span class="linenos">3107</span></a>        <span class="n">num_sims</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">sims</span><span class="p">,</span>
</span><span id="L-3108"><a href="#L-3108"><span class="linenos">3108</span></a>        <span class="n">earliest</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">earliest</span><span class="p">,</span>
</span><span id="L-3109"><a href="#L-3109"><span class="linenos">3109</span></a>        <span class="n">reference_games</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">games</span><span class="p">,</span>
</span><span id="L-3110"><a href="#L-3110"><span class="linenos">3110</span></a>        <span class="n">basaloppstringtime</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">basaloppstringtime</span><span class="p">,</span>
</span><span id="L-3111"><a href="#L-3111"><span class="linenos">3111</span></a>    <span class="p">)</span>
</span><span id="L-3112"><a href="#L-3112"><span class="linenos">3112</span></a>    <span class="n">writer</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelWriter</span><span class="p">(</span>
</span><span id="L-3113"><a href="#L-3113"><span class="linenos">3113</span></a>        <span class="n">options</span><span class="o">.</span><span class="n">output</span>
</span><span id="L-3114"><a href="#L-3114"><span class="linenos">3114</span></a>        <span class="o">+</span> <span class="s2">&quot;FantasyFootballProjections_</span><span class="si">{}</span><span class="s2">Week</span><span class="si">{}{}</span><span class="s2">.xlsx&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="L-3115"><a href="#L-3115"><span class="linenos">3115</span></a>            <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%A&quot;</span><span class="p">),</span> <span class="n">league</span><span class="o">.</span><span class="n">week</span><span class="p">,</span> <span class="s2">&quot;_BestBall&quot;</span> <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">bestball</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-3116"><a href="#L-3116"><span class="linenos">3116</span></a>        <span class="p">),</span>
</span><span id="L-3117"><a href="#L-3117"><span class="linenos">3117</span></a>        <span class="n">engine</span><span class="o">=</span><span class="s2">&quot;xlsxwriter&quot;</span><span class="p">,</span>
</span><span id="L-3118"><a href="#L-3118"><span class="linenos">3118</span></a>    <span class="p">)</span>
</span><span id="L-3119"><a href="#L-3119"><span class="linenos">3119</span></a>    <span class="n">writer</span><span class="o">.</span><span class="n">book</span><span class="o">.</span><span class="n">add_format</span><span class="p">({</span><span class="s2">&quot;align&quot;</span><span class="p">:</span> <span class="s2">&quot;vcenter&quot;</span><span class="p">})</span>
</span><span id="L-3120"><a href="#L-3120"><span class="linenos">3120</span></a>
</span><span id="L-3121"><a href="#L-3121"><span class="linenos">3121</span></a>    <span class="n">rosters</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-3122"><a href="#L-3122"><span class="linenos">3122</span></a>        <span class="n">league</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">league</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">fantasy_team</span><span class="o">.</span><span class="n">isnull</span><span class="p">()]</span>
</span><span id="L-3123"><a href="#L-3123"><span class="linenos">3123</span></a>        <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;fantasy_team&quot;</span><span class="p">,</span> <span class="s2">&quot;WAR&quot;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">])</span>
</span><span id="L-3124"><a href="#L-3124"><span class="linenos">3124</span></a>        <span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-3125"><a href="#L-3125"><span class="linenos">3125</span></a>    <span class="p">)</span>
</span><span id="L-3126"><a href="#L-3126"><span class="linenos">3126</span></a>    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="L-3127"><a href="#L-3127"><span class="linenos">3127</span></a>        <span class="s2">&quot;points_avg&quot;</span><span class="p">,</span>
</span><span id="L-3128"><a href="#L-3128"><span class="linenos">3128</span></a>        <span class="s2">&quot;points_stdev&quot;</span><span class="p">,</span>
</span><span id="L-3129"><a href="#L-3129"><span class="linenos">3129</span></a>        <span class="s2">&quot;WAR&quot;</span><span class="p">,</span>
</span><span id="L-3130"><a href="#L-3130"><span class="linenos">3130</span></a>        <span class="s2">&quot;game_factor&quot;</span><span class="p">,</span>
</span><span id="L-3131"><a href="#L-3131"><span class="linenos">3131</span></a>        <span class="s2">&quot;opp_factor&quot;</span><span class="p">,</span>
</span><span id="L-3132"><a href="#L-3132"><span class="linenos">3132</span></a>        <span class="s2">&quot;string_factor&quot;</span><span class="p">,</span>
</span><span id="L-3133"><a href="#L-3133"><span class="linenos">3133</span></a>    <span class="p">]:</span>
</span><span id="L-3134"><a href="#L-3134"><span class="linenos">3134</span></a>        <span class="n">rosters</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">rosters</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="L-3135"><a href="#L-3135"><span class="linenos">3135</span></a>    <span class="n">writer</span> <span class="o">=</span> <span class="n">excelAutofit</span><span class="p">(</span>
</span><span id="L-3136"><a href="#L-3136"><span class="linenos">3136</span></a>        <span class="n">rosters</span><span class="p">[</span>
</span><span id="L-3137"><a href="#L-3137"><span class="linenos">3137</span></a>            <span class="p">[</span>
</span><span id="L-3138"><a href="#L-3138"><span class="linenos">3138</span></a>                <span class="s2">&quot;name&quot;</span><span class="p">,</span>
</span><span id="L-3139"><a href="#L-3139"><span class="linenos">3139</span></a>                <span class="s2">&quot;position&quot;</span><span class="p">,</span>
</span><span id="L-3140"><a href="#L-3140"><span class="linenos">3140</span></a>                <span class="s2">&quot;current_team&quot;</span><span class="p">,</span>
</span><span id="L-3141"><a href="#L-3141"><span class="linenos">3141</span></a>                <span class="s2">&quot;points_avg&quot;</span><span class="p">,</span>
</span><span id="L-3142"><a href="#L-3142"><span class="linenos">3142</span></a>                <span class="s2">&quot;points_stdev&quot;</span><span class="p">,</span>
</span><span id="L-3143"><a href="#L-3143"><span class="linenos">3143</span></a>                <span class="s2">&quot;WAR&quot;</span><span class="p">,</span>
</span><span id="L-3144"><a href="#L-3144"><span class="linenos">3144</span></a>                <span class="s2">&quot;fantasy_team&quot;</span><span class="p">,</span>
</span><span id="L-3145"><a href="#L-3145"><span class="linenos">3145</span></a>                <span class="s2">&quot;num_games&quot;</span><span class="p">,</span>
</span><span id="L-3146"><a href="#L-3146"><span class="linenos">3146</span></a>                <span class="s2">&quot;game_factor&quot;</span><span class="p">,</span>
</span><span id="L-3147"><a href="#L-3147"><span class="linenos">3147</span></a>                <span class="s2">&quot;opp_factor&quot;</span><span class="p">,</span>
</span><span id="L-3148"><a href="#L-3148"><span class="linenos">3148</span></a>                <span class="s2">&quot;string_factor&quot;</span><span class="p">,</span>
</span><span id="L-3149"><a href="#L-3149"><span class="linenos">3149</span></a>                <span class="s2">&quot;status&quot;</span><span class="p">,</span>
</span><span id="L-3150"><a href="#L-3150"><span class="linenos">3150</span></a>                <span class="s2">&quot;bye_week&quot;</span><span class="p">,</span>
</span><span id="L-3151"><a href="#L-3151"><span class="linenos">3151</span></a>                <span class="s2">&quot;until&quot;</span><span class="p">,</span>
</span><span id="L-3152"><a href="#L-3152"><span class="linenos">3152</span></a>                <span class="s2">&quot;starter&quot;</span><span class="p">,</span>
</span><span id="L-3153"><a href="#L-3153"><span class="linenos">3153</span></a>                <span class="s2">&quot;injured&quot;</span><span class="p">,</span>
</span><span id="L-3154"><a href="#L-3154"><span class="linenos">3154</span></a>                <span class="s2">&quot;pct_rostered&quot;</span><span class="p">,</span>
</span><span id="L-3155"><a href="#L-3155"><span class="linenos">3155</span></a>            <span class="p">]</span>
</span><span id="L-3156"><a href="#L-3156"><span class="linenos">3156</span></a>        <span class="p">],</span>
</span><span id="L-3157"><a href="#L-3157"><span class="linenos">3157</span></a>        <span class="s2">&quot;Rosters&quot;</span><span class="p">,</span>
</span><span id="L-3158"><a href="#L-3158"><span class="linenos">3158</span></a>        <span class="n">writer</span><span class="p">,</span>
</span><span id="L-3159"><a href="#L-3159"><span class="linenos">3159</span></a>    <span class="p">)</span>
</span><span id="L-3160"><a href="#L-3160"><span class="linenos">3160</span></a>    <span class="n">writer</span><span class="o">.</span><span class="n">sheets</span><span class="p">[</span><span class="s2">&quot;Rosters&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">conditional_format</span><span class="p">(</span>
</span><span id="L-3161"><a href="#L-3161"><span class="linenos">3161</span></a>        <span class="s2">&quot;F2:F&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rosters</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="L-3162"><a href="#L-3162"><span class="linenos">3162</span></a>        <span class="p">{</span>
</span><span id="L-3163"><a href="#L-3163"><span class="linenos">3163</span></a>            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;3_color_scale&quot;</span><span class="p">,</span>
</span><span id="L-3164"><a href="#L-3164"><span class="linenos">3164</span></a>            <span class="s2">&quot;min_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FF6347&quot;</span><span class="p">,</span>
</span><span id="L-3165"><a href="#L-3165"><span class="linenos">3165</span></a>            <span class="s2">&quot;mid_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FFD700&quot;</span><span class="p">,</span>
</span><span id="L-3166"><a href="#L-3166"><span class="linenos">3166</span></a>            <span class="s2">&quot;max_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#3CB371&quot;</span><span class="p">,</span>
</span><span id="L-3167"><a href="#L-3167"><span class="linenos">3167</span></a>        <span class="p">},</span>
</span><span id="L-3168"><a href="#L-3168"><span class="linenos">3168</span></a>    <span class="p">)</span>
</span><span id="L-3169"><a href="#L-3169"><span class="linenos">3169</span></a>    <span class="n">available</span> <span class="o">=</span> <span class="n">league</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-3170"><a href="#L-3170"><span class="linenos">3170</span></a>        <span class="n">league</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">fantasy_team</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span>
</span><span id="L-3171"><a href="#L-3171"><span class="linenos">3171</span></a>        <span class="o">&amp;</span> <span class="p">(</span><span class="n">league</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">until</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span> <span class="o">|</span> <span class="p">(</span><span class="n">league</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">until</span> <span class="o">&lt;</span> <span class="mi">17</span><span class="p">))</span>
</span><span id="L-3172"><a href="#L-3172"><span class="linenos">3172</span></a>    <span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;WAR&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-3173"><a href="#L-3173"><span class="linenos">3173</span></a>    <span class="k">del</span> <span class="n">available</span><span class="p">[</span><span class="s2">&quot;fantasy_team&quot;</span><span class="p">]</span>
</span><span id="L-3174"><a href="#L-3174"><span class="linenos">3174</span></a>    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="L-3175"><a href="#L-3175"><span class="linenos">3175</span></a>        <span class="s2">&quot;points_avg&quot;</span><span class="p">,</span>
</span><span id="L-3176"><a href="#L-3176"><span class="linenos">3176</span></a>        <span class="s2">&quot;points_stdev&quot;</span><span class="p">,</span>
</span><span id="L-3177"><a href="#L-3177"><span class="linenos">3177</span></a>        <span class="s2">&quot;WAR&quot;</span><span class="p">,</span>
</span><span id="L-3178"><a href="#L-3178"><span class="linenos">3178</span></a>        <span class="s2">&quot;game_factor&quot;</span><span class="p">,</span>
</span><span id="L-3179"><a href="#L-3179"><span class="linenos">3179</span></a>        <span class="s2">&quot;opp_factor&quot;</span><span class="p">,</span>
</span><span id="L-3180"><a href="#L-3180"><span class="linenos">3180</span></a>        <span class="s2">&quot;string_factor&quot;</span><span class="p">,</span>
</span><span id="L-3181"><a href="#L-3181"><span class="linenos">3181</span></a>    <span class="p">]:</span>
</span><span id="L-3182"><a href="#L-3182"><span class="linenos">3182</span></a>        <span class="n">available</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">available</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="L-3183"><a href="#L-3183"><span class="linenos">3183</span></a>    <span class="n">writer</span> <span class="o">=</span> <span class="n">excelAutofit</span><span class="p">(</span>
</span><span id="L-3184"><a href="#L-3184"><span class="linenos">3184</span></a>        <span class="n">available</span><span class="p">[</span>
</span><span id="L-3185"><a href="#L-3185"><span class="linenos">3185</span></a>            <span class="p">[</span>
</span><span id="L-3186"><a href="#L-3186"><span class="linenos">3186</span></a>                <span class="s2">&quot;name&quot;</span><span class="p">,</span>
</span><span id="L-3187"><a href="#L-3187"><span class="linenos">3187</span></a>                <span class="s2">&quot;position&quot;</span><span class="p">,</span>
</span><span id="L-3188"><a href="#L-3188"><span class="linenos">3188</span></a>                <span class="s2">&quot;current_team&quot;</span><span class="p">,</span>
</span><span id="L-3189"><a href="#L-3189"><span class="linenos">3189</span></a>                <span class="s2">&quot;points_avg&quot;</span><span class="p">,</span>
</span><span id="L-3190"><a href="#L-3190"><span class="linenos">3190</span></a>                <span class="s2">&quot;points_stdev&quot;</span><span class="p">,</span>
</span><span id="L-3191"><a href="#L-3191"><span class="linenos">3191</span></a>                <span class="s2">&quot;WAR&quot;</span><span class="p">,</span>
</span><span id="L-3192"><a href="#L-3192"><span class="linenos">3192</span></a>                <span class="s2">&quot;num_games&quot;</span><span class="p">,</span>
</span><span id="L-3193"><a href="#L-3193"><span class="linenos">3193</span></a>                <span class="s2">&quot;game_factor&quot;</span><span class="p">,</span>
</span><span id="L-3194"><a href="#L-3194"><span class="linenos">3194</span></a>                <span class="s2">&quot;opp_factor&quot;</span><span class="p">,</span>
</span><span id="L-3195"><a href="#L-3195"><span class="linenos">3195</span></a>                <span class="s2">&quot;string_factor&quot;</span><span class="p">,</span>
</span><span id="L-3196"><a href="#L-3196"><span class="linenos">3196</span></a>                <span class="s2">&quot;status&quot;</span><span class="p">,</span>
</span><span id="L-3197"><a href="#L-3197"><span class="linenos">3197</span></a>                <span class="s2">&quot;bye_week&quot;</span><span class="p">,</span>
</span><span id="L-3198"><a href="#L-3198"><span class="linenos">3198</span></a>                <span class="s2">&quot;until&quot;</span><span class="p">,</span>
</span><span id="L-3199"><a href="#L-3199"><span class="linenos">3199</span></a>                <span class="s2">&quot;pct_rostered&quot;</span><span class="p">,</span>
</span><span id="L-3200"><a href="#L-3200"><span class="linenos">3200</span></a>            <span class="p">]</span>
</span><span id="L-3201"><a href="#L-3201"><span class="linenos">3201</span></a>        <span class="p">],</span>
</span><span id="L-3202"><a href="#L-3202"><span class="linenos">3202</span></a>        <span class="s2">&quot;Available&quot;</span><span class="p">,</span>
</span><span id="L-3203"><a href="#L-3203"><span class="linenos">3203</span></a>        <span class="n">writer</span><span class="p">,</span>
</span><span id="L-3204"><a href="#L-3204"><span class="linenos">3204</span></a>    <span class="p">)</span>
</span><span id="L-3205"><a href="#L-3205"><span class="linenos">3205</span></a>    <span class="n">writer</span><span class="o">.</span><span class="n">sheets</span><span class="p">[</span><span class="s2">&quot;Available&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">conditional_format</span><span class="p">(</span>
</span><span id="L-3206"><a href="#L-3206"><span class="linenos">3206</span></a>        <span class="s2">&quot;F2:F&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">available</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="L-3207"><a href="#L-3207"><span class="linenos">3207</span></a>        <span class="p">{</span>
</span><span id="L-3208"><a href="#L-3208"><span class="linenos">3208</span></a>            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;3_color_scale&quot;</span><span class="p">,</span>
</span><span id="L-3209"><a href="#L-3209"><span class="linenos">3209</span></a>            <span class="s2">&quot;min_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FF6347&quot;</span><span class="p">,</span>
</span><span id="L-3210"><a href="#L-3210"><span class="linenos">3210</span></a>            <span class="s2">&quot;mid_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FFD700&quot;</span><span class="p">,</span>
</span><span id="L-3211"><a href="#L-3211"><span class="linenos">3211</span></a>            <span class="s2">&quot;max_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#3CB371&quot;</span><span class="p">,</span>
</span><span id="L-3212"><a href="#L-3212"><span class="linenos">3212</span></a>        <span class="p">},</span>
</span><span id="L-3213"><a href="#L-3213"><span class="linenos">3213</span></a>    <span class="p">)</span>
</span><span id="L-3214"><a href="#L-3214"><span class="linenos">3214</span></a>
</span><span id="L-3215"><a href="#L-3215"><span class="linenos">3215</span></a>    <span class="c1"># # ASSESS WAR VALUES FOR EACH TEAM&#39;S STARTERS!!!</span>
</span><span id="L-3216"><a href="#L-3216"><span class="linenos">3216</span></a>    <span class="c1"># war_inds = rosters.starter &amp; ~rosters.position.isin([&quot;DEF&quot;,&quot;K&quot;])</span>
</span><span id="L-3217"><a href="#L-3217"><span class="linenos">3217</span></a>    <span class="c1"># war_vals = pd.merge(left=rosters.loc[war_inds].groupby([&quot;fantasy_team&quot;,&quot;position&quot;]).WAR.mean().unstack().reset_index(),\</span>
</span><span id="L-3218"><a href="#L-3218"><span class="linenos">3218</span></a>    <span class="c1"># right=rosters.loc[war_inds].groupby(&quot;fantasy_team&quot;).WAR.mean().reset_index().rename(columns={&quot;WAR&quot;:&quot;Overall&quot;}),how=&#39;inner&#39;,on=&#39;fantasy_team&#39;)</span>
</span><span id="L-3219"><a href="#L-3219"><span class="linenos">3219</span></a>    <span class="c1"># print(war_vals[[&quot;fantasy_team&quot;,&quot;QB&quot;,&quot;WR&quot;,&quot;RB&quot;]].set_index(&#39;fantasy_team&#39;).T.corr())</span>
</span><span id="L-3220"><a href="#L-3220"><span class="linenos">3220</span></a>    <span class="c1"># for col in war_vals.columns:</span>
</span><span id="L-3221"><a href="#L-3221"><span class="linenos">3221</span></a>    <span class="c1">#     if col != &quot;fantasy_team&quot;:</span>
</span><span id="L-3222"><a href="#L-3222"><span class="linenos">3222</span></a>    <span class="c1">#         war_vals[col] = round(war_vals[col],3)</span>
</span><span id="L-3223"><a href="#L-3223"><span class="linenos">3223</span></a>    <span class="c1"># writer = excelAutofit(war_vals,&quot;Team WAR&quot;,writer)</span>
</span><span id="L-3224"><a href="#L-3224"><span class="linenos">3224</span></a>    <span class="c1"># writer.sheets[&quot;Team WAR&quot;].conditional_format(</span>
</span><span id="L-3225"><a href="#L-3225"><span class="linenos">3225</span></a>    <span class="c1">#     &quot;B2:F&quot; + str(rosters.shape[0] + 1),</span>
</span><span id="L-3226"><a href="#L-3226"><span class="linenos">3226</span></a>    <span class="c1">#     {</span>
</span><span id="L-3227"><a href="#L-3227"><span class="linenos">3227</span></a>    <span class="c1">#         &quot;type&quot;: &quot;3_color_scale&quot;,</span>
</span><span id="L-3228"><a href="#L-3228"><span class="linenos">3228</span></a>    <span class="c1">#         &quot;min_color&quot;: &quot;#FF6347&quot;,</span>
</span><span id="L-3229"><a href="#L-3229"><span class="linenos">3229</span></a>    <span class="c1">#         &quot;mid_color&quot;: &quot;#FFD700&quot;,</span>
</span><span id="L-3230"><a href="#L-3230"><span class="linenos">3230</span></a>    <span class="c1">#         &quot;max_color&quot;: &quot;#3CB371&quot;,</span>
</span><span id="L-3231"><a href="#L-3231"><span class="linenos">3231</span></a>    <span class="c1">#     },</span>
</span><span id="L-3232"><a href="#L-3232"><span class="linenos">3232</span></a>    <span class="c1"># )</span>
</span><span id="L-3233"><a href="#L-3233"><span class="linenos">3233</span></a>    <span class="c1"># # ASSESS WAR VALUES FOR EACH TEAM&#39;S STARTERS!!!</span>
</span><span id="L-3234"><a href="#L-3234"><span class="linenos">3234</span></a>
</span><span id="L-3235"><a href="#L-3235"><span class="linenos">3235</span></a>    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">bestball</span><span class="p">:</span>
</span><span id="L-3236"><a href="#L-3236"><span class="linenos">3236</span></a>        <span class="n">standings_sim</span> <span class="o">=</span> <span class="n">league</span><span class="o">.</span><span class="n">bestball_sims</span><span class="p">(</span><span class="n">payouts</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">payouts</span><span class="p">)</span>
</span><span id="L-3237"><a href="#L-3237"><span class="linenos">3237</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-3238"><a href="#L-3238"><span class="linenos">3238</span></a>        <span class="n">schedule_sim</span><span class="p">,</span> <span class="n">standings_sim</span> <span class="o">=</span> <span class="n">league</span><span class="o">.</span><span class="n">season_sims</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">payouts</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">payouts</span><span class="p">)</span>
</span><span id="L-3239"><a href="#L-3239"><span class="linenos">3239</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="L-3240"><a href="#L-3240"><span class="linenos">3240</span></a>            <span class="n">schedule_sim</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-3241"><a href="#L-3241"><span class="linenos">3241</span></a>                <span class="n">schedule_sim</span><span class="o">.</span><span class="n">week</span> <span class="o">==</span> <span class="n">league</span><span class="o">.</span><span class="n">week</span><span class="p">,</span>
</span><span id="L-3242"><a href="#L-3242"><span class="linenos">3242</span></a>                <span class="p">[</span>
</span><span id="L-3243"><a href="#L-3243"><span class="linenos">3243</span></a>                    <span class="s2">&quot;week&quot;</span><span class="p">,</span>
</span><span id="L-3244"><a href="#L-3244"><span class="linenos">3244</span></a>                    <span class="s2">&quot;team_1&quot;</span><span class="p">,</span>
</span><span id="L-3245"><a href="#L-3245"><span class="linenos">3245</span></a>                    <span class="s2">&quot;team_2&quot;</span><span class="p">,</span>
</span><span id="L-3246"><a href="#L-3246"><span class="linenos">3246</span></a>                    <span class="s2">&quot;win_1&quot;</span><span class="p">,</span>
</span><span id="L-3247"><a href="#L-3247"><span class="linenos">3247</span></a>                    <span class="s2">&quot;win_2&quot;</span><span class="p">,</span>
</span><span id="L-3248"><a href="#L-3248"><span class="linenos">3248</span></a>                    <span class="s2">&quot;points_avg_1&quot;</span><span class="p">,</span>
</span><span id="L-3249"><a href="#L-3249"><span class="linenos">3249</span></a>                    <span class="s2">&quot;points_avg_2&quot;</span><span class="p">,</span>
</span><span id="L-3250"><a href="#L-3250"><span class="linenos">3250</span></a>                <span class="p">],</span>
</span><span id="L-3251"><a href="#L-3251"><span class="linenos">3251</span></a>            <span class="p">]</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-3252"><a href="#L-3252"><span class="linenos">3252</span></a>        <span class="p">)</span>
</span><span id="L-3253"><a href="#L-3253"><span class="linenos">3253</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="L-3254"><a href="#L-3254"><span class="linenos">3254</span></a>            <span class="n">standings_sim</span><span class="p">[</span>
</span><span id="L-3255"><a href="#L-3255"><span class="linenos">3255</span></a>                <span class="p">[</span>
</span><span id="L-3256"><a href="#L-3256"><span class="linenos">3256</span></a>                    <span class="s2">&quot;team&quot;</span><span class="p">,</span>
</span><span id="L-3257"><a href="#L-3257"><span class="linenos">3257</span></a>                    <span class="s2">&quot;wins_avg&quot;</span><span class="p">,</span>
</span><span id="L-3258"><a href="#L-3258"><span class="linenos">3258</span></a>                    <span class="s2">&quot;points_avg&quot;</span><span class="p">,</span>
</span><span id="L-3259"><a href="#L-3259"><span class="linenos">3259</span></a>                    <span class="s2">&quot;playoffs&quot;</span><span class="p">,</span>
</span><span id="L-3260"><a href="#L-3260"><span class="linenos">3260</span></a>                    <span class="s2">&quot;playoff_bye&quot;</span><span class="p">,</span>
</span><span id="L-3261"><a href="#L-3261"><span class="linenos">3261</span></a>                    <span class="s2">&quot;winner&quot;</span><span class="p">,</span>
</span><span id="L-3262"><a href="#L-3262"><span class="linenos">3262</span></a>                    <span class="s2">&quot;earnings&quot;</span><span class="p">,</span>
</span><span id="L-3263"><a href="#L-3263"><span class="linenos">3263</span></a>                <span class="p">]</span>
</span><span id="L-3264"><a href="#L-3264"><span class="linenos">3264</span></a>                <span class="o">+</span> <span class="p">([</span><span class="s2">&quot;many_mile&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">league</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;The Algorithm&quot;</span> <span class="k">else</span> <span class="p">[])</span>
</span><span id="L-3265"><a href="#L-3265"><span class="linenos">3265</span></a>            <span class="p">]</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-3266"><a href="#L-3266"><span class="linenos">3266</span></a>        <span class="p">)</span>
</span><span id="L-3267"><a href="#L-3267"><span class="linenos">3267</span></a>        <span class="n">writer</span> <span class="o">=</span> <span class="n">excelAutofit</span><span class="p">(</span>
</span><span id="L-3268"><a href="#L-3268"><span class="linenos">3268</span></a>            <span class="n">schedule_sim</span><span class="p">[</span>
</span><span id="L-3269"><a href="#L-3269"><span class="linenos">3269</span></a>                <span class="p">[</span>
</span><span id="L-3270"><a href="#L-3270"><span class="linenos">3270</span></a>                    <span class="s2">&quot;week&quot;</span><span class="p">,</span>
</span><span id="L-3271"><a href="#L-3271"><span class="linenos">3271</span></a>                    <span class="s2">&quot;team_1&quot;</span><span class="p">,</span>
</span><span id="L-3272"><a href="#L-3272"><span class="linenos">3272</span></a>                    <span class="s2">&quot;team_2&quot;</span><span class="p">,</span>
</span><span id="L-3273"><a href="#L-3273"><span class="linenos">3273</span></a>                    <span class="s2">&quot;win_1&quot;</span><span class="p">,</span>
</span><span id="L-3274"><a href="#L-3274"><span class="linenos">3274</span></a>                    <span class="s2">&quot;win_2&quot;</span><span class="p">,</span>
</span><span id="L-3275"><a href="#L-3275"><span class="linenos">3275</span></a>                    <span class="s2">&quot;points_avg_1&quot;</span><span class="p">,</span>
</span><span id="L-3276"><a href="#L-3276"><span class="linenos">3276</span></a>                    <span class="s2">&quot;points_stdev_1&quot;</span><span class="p">,</span>
</span><span id="L-3277"><a href="#L-3277"><span class="linenos">3277</span></a>                    <span class="s2">&quot;points_avg_2&quot;</span><span class="p">,</span>
</span><span id="L-3278"><a href="#L-3278"><span class="linenos">3278</span></a>                    <span class="s2">&quot;points_stdev_2&quot;</span><span class="p">,</span>
</span><span id="L-3279"><a href="#L-3279"><span class="linenos">3279</span></a>                    <span class="s2">&quot;me&quot;</span><span class="p">,</span>
</span><span id="L-3280"><a href="#L-3280"><span class="linenos">3280</span></a>                <span class="p">]</span>
</span><span id="L-3281"><a href="#L-3281"><span class="linenos">3281</span></a>            <span class="p">],</span>
</span><span id="L-3282"><a href="#L-3282"><span class="linenos">3282</span></a>            <span class="s2">&quot;Schedule&quot;</span><span class="p">,</span>
</span><span id="L-3283"><a href="#L-3283"><span class="linenos">3283</span></a>            <span class="n">writer</span><span class="p">,</span>
</span><span id="L-3284"><a href="#L-3284"><span class="linenos">3284</span></a>            <span class="mi">3</span><span class="p">,</span>
</span><span id="L-3285"><a href="#L-3285"><span class="linenos">3285</span></a>        <span class="p">)</span>
</span><span id="L-3286"><a href="#L-3286"><span class="linenos">3286</span></a>        <span class="n">writer</span><span class="o">.</span><span class="n">sheets</span><span class="p">[</span><span class="s2">&quot;Schedule&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">conditional_format</span><span class="p">(</span>
</span><span id="L-3287"><a href="#L-3287"><span class="linenos">3287</span></a>            <span class="s2">&quot;D2:E&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">schedule_sim</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="L-3288"><a href="#L-3288"><span class="linenos">3288</span></a>            <span class="p">{</span>
</span><span id="L-3289"><a href="#L-3289"><span class="linenos">3289</span></a>                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;3_color_scale&quot;</span><span class="p">,</span>
</span><span id="L-3290"><a href="#L-3290"><span class="linenos">3290</span></a>                <span class="s2">&quot;min_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FF6347&quot;</span><span class="p">,</span>
</span><span id="L-3291"><a href="#L-3291"><span class="linenos">3291</span></a>                <span class="s2">&quot;mid_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FFD700&quot;</span><span class="p">,</span>
</span><span id="L-3292"><a href="#L-3292"><span class="linenos">3292</span></a>                <span class="s2">&quot;max_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#3CB371&quot;</span><span class="p">,</span>
</span><span id="L-3293"><a href="#L-3293"><span class="linenos">3293</span></a>            <span class="p">},</span>
</span><span id="L-3294"><a href="#L-3294"><span class="linenos">3294</span></a>        <span class="p">)</span>
</span><span id="L-3295"><a href="#L-3295"><span class="linenos">3295</span></a>    <span class="n">writer</span> <span class="o">=</span> <span class="n">excelAutofit</span><span class="p">(</span>
</span><span id="L-3296"><a href="#L-3296"><span class="linenos">3296</span></a>        <span class="n">standings_sim</span><span class="p">[</span>
</span><span id="L-3297"><a href="#L-3297"><span class="linenos">3297</span></a>            <span class="p">[</span>
</span><span id="L-3298"><a href="#L-3298"><span class="linenos">3298</span></a>                <span class="s2">&quot;team&quot;</span><span class="p">,</span>
</span><span id="L-3299"><a href="#L-3299"><span class="linenos">3299</span></a>                <span class="s2">&quot;wins_avg&quot;</span><span class="p">,</span>
</span><span id="L-3300"><a href="#L-3300"><span class="linenos">3300</span></a>                <span class="s2">&quot;wins_stdev&quot;</span><span class="p">,</span>
</span><span id="L-3301"><a href="#L-3301"><span class="linenos">3301</span></a>                <span class="s2">&quot;points_avg&quot;</span><span class="p">,</span>
</span><span id="L-3302"><a href="#L-3302"><span class="linenos">3302</span></a>                <span class="s2">&quot;points_stdev&quot;</span><span class="p">,</span>
</span><span id="L-3303"><a href="#L-3303"><span class="linenos">3303</span></a>            <span class="p">]</span>
</span><span id="L-3304"><a href="#L-3304"><span class="linenos">3304</span></a>            <span class="o">+</span> <span class="p">([</span>
</span><span id="L-3305"><a href="#L-3305"><span class="linenos">3305</span></a>                <span class="s2">&quot;per_game_avg&quot;</span><span class="p">,</span>
</span><span id="L-3306"><a href="#L-3306"><span class="linenos">3306</span></a>                <span class="s2">&quot;per_game_stdev&quot;</span><span class="p">,</span>
</span><span id="L-3307"><a href="#L-3307"><span class="linenos">3307</span></a>                <span class="s2">&quot;per_game_fano&quot;</span><span class="p">,</span>
</span><span id="L-3308"><a href="#L-3308"><span class="linenos">3308</span></a>            <span class="p">]</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">options</span><span class="o">.</span><span class="n">bestball</span> <span class="k">else</span> <span class="p">[])</span> 
</span><span id="L-3309"><a href="#L-3309"><span class="linenos">3309</span></a>            <span class="o">+</span> <span class="p">[</span>
</span><span id="L-3310"><a href="#L-3310"><span class="linenos">3310</span></a>                <span class="s2">&quot;playoffs&quot;</span><span class="p">,</span>
</span><span id="L-3311"><a href="#L-3311"><span class="linenos">3311</span></a>                <span class="s2">&quot;playoff_bye&quot;</span><span class="p">,</span>
</span><span id="L-3312"><a href="#L-3312"><span class="linenos">3312</span></a>                <span class="s2">&quot;winner&quot;</span><span class="p">,</span>
</span><span id="L-3313"><a href="#L-3313"><span class="linenos">3313</span></a>                <span class="s2">&quot;runner_up&quot;</span><span class="p">,</span>
</span><span id="L-3314"><a href="#L-3314"><span class="linenos">3314</span></a>                <span class="s2">&quot;third&quot;</span><span class="p">,</span>
</span><span id="L-3315"><a href="#L-3315"><span class="linenos">3315</span></a>                <span class="s2">&quot;earnings&quot;</span><span class="p">,</span>
</span><span id="L-3316"><a href="#L-3316"><span class="linenos">3316</span></a>            <span class="p">]</span>
</span><span id="L-3317"><a href="#L-3317"><span class="linenos">3317</span></a>            <span class="o">+</span> <span class="p">([</span><span class="s2">&quot;many_mile&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">league</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;The Algorithm&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">options</span><span class="o">.</span><span class="n">bestball</span> <span class="k">else</span> <span class="p">[])</span>
</span><span id="L-3318"><a href="#L-3318"><span class="linenos">3318</span></a>        <span class="p">],</span>
</span><span id="L-3319"><a href="#L-3319"><span class="linenos">3319</span></a>        <span class="s2">&quot;Standings&quot;</span><span class="p">,</span>
</span><span id="L-3320"><a href="#L-3320"><span class="linenos">3320</span></a>        <span class="n">writer</span><span class="p">,</span>
</span><span id="L-3321"><a href="#L-3321"><span class="linenos">3321</span></a>    <span class="p">)</span>
</span><span id="L-3322"><a href="#L-3322"><span class="linenos">3322</span></a>    <span class="n">writer</span><span class="o">.</span><span class="n">sheets</span><span class="p">[</span><span class="s2">&quot;Standings&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">conditional_format</span><span class="p">(</span>
</span><span id="L-3323"><a href="#L-3323"><span class="linenos">3323</span></a>        <span class="s2">&quot;I2:M&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">standings_sim</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="L-3324"><a href="#L-3324"><span class="linenos">3324</span></a>        <span class="p">{</span>
</span><span id="L-3325"><a href="#L-3325"><span class="linenos">3325</span></a>            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;3_color_scale&quot;</span><span class="p">,</span>
</span><span id="L-3326"><a href="#L-3326"><span class="linenos">3326</span></a>            <span class="s2">&quot;min_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FF6347&quot;</span><span class="p">,</span>
</span><span id="L-3327"><a href="#L-3327"><span class="linenos">3327</span></a>            <span class="s2">&quot;mid_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FFD700&quot;</span><span class="p">,</span>
</span><span id="L-3328"><a href="#L-3328"><span class="linenos">3328</span></a>            <span class="s2">&quot;max_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#3CB371&quot;</span><span class="p">,</span>
</span><span id="L-3329"><a href="#L-3329"><span class="linenos">3329</span></a>        <span class="p">},</span>
</span><span id="L-3330"><a href="#L-3330"><span class="linenos">3330</span></a>    <span class="p">)</span>
</span><span id="L-3331"><a href="#L-3331"><span class="linenos">3331</span></a>    <span class="n">writer</span><span class="o">.</span><span class="n">sheets</span><span class="p">[</span><span class="s2">&quot;Standings&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">conditional_format</span><span class="p">(</span>
</span><span id="L-3332"><a href="#L-3332"><span class="linenos">3332</span></a>        <span class="s2">&quot;N2:N&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">standings_sim</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="L-3333"><a href="#L-3333"><span class="linenos">3333</span></a>        <span class="p">{</span>
</span><span id="L-3334"><a href="#L-3334"><span class="linenos">3334</span></a>            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;3_color_scale&quot;</span><span class="p">,</span>
</span><span id="L-3335"><a href="#L-3335"><span class="linenos">3335</span></a>            <span class="s2">&quot;min_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FF6347&quot;</span><span class="p">,</span>
</span><span id="L-3336"><a href="#L-3336"><span class="linenos">3336</span></a>            <span class="s2">&quot;mid_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FFD700&quot;</span><span class="p">,</span>
</span><span id="L-3337"><a href="#L-3337"><span class="linenos">3337</span></a>            <span class="s2">&quot;max_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#3CB371&quot;</span><span class="p">,</span>
</span><span id="L-3338"><a href="#L-3338"><span class="linenos">3338</span></a>        <span class="p">},</span>
</span><span id="L-3339"><a href="#L-3339"><span class="linenos">3339</span></a>    <span class="p">)</span>
</span><span id="L-3340"><a href="#L-3340"><span class="linenos">3340</span></a>    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;The Algorithm&quot;</span><span class="p">:</span>
</span><span id="L-3341"><a href="#L-3341"><span class="linenos">3341</span></a>        <span class="n">writer</span><span class="o">.</span><span class="n">sheets</span><span class="p">[</span><span class="s2">&quot;Standings&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">conditional_format</span><span class="p">(</span>
</span><span id="L-3342"><a href="#L-3342"><span class="linenos">3342</span></a>            <span class="s2">&quot;O2:O&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">standings_sim</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="L-3343"><a href="#L-3343"><span class="linenos">3343</span></a>            <span class="p">{</span>
</span><span id="L-3344"><a href="#L-3344"><span class="linenos">3344</span></a>                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;3_color_scale&quot;</span><span class="p">,</span>
</span><span id="L-3345"><a href="#L-3345"><span class="linenos">3345</span></a>                <span class="s2">&quot;max_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FF6347&quot;</span><span class="p">,</span>
</span><span id="L-3346"><a href="#L-3346"><span class="linenos">3346</span></a>                <span class="s2">&quot;mid_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FFD700&quot;</span><span class="p">,</span>
</span><span id="L-3347"><a href="#L-3347"><span class="linenos">3347</span></a>                <span class="s2">&quot;min_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#3CB371&quot;</span><span class="p">,</span>
</span><span id="L-3348"><a href="#L-3348"><span class="linenos">3348</span></a>            <span class="p">},</span>
</span><span id="L-3349"><a href="#L-3349"><span class="linenos">3349</span></a>        <span class="p">)</span>
</span><span id="L-3350"><a href="#L-3350"><span class="linenos">3350</span></a>
</span><span id="L-3351"><a href="#L-3351"><span class="linenos">3351</span></a>    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">pickups</span><span class="p">:</span>
</span><span id="L-3352"><a href="#L-3352"><span class="linenos">3352</span></a>        <span class="n">pickups</span> <span class="o">=</span> <span class="n">league</span><span class="o">.</span><span class="n">possible_pickups</span><span class="p">(</span>
</span><span id="L-3353"><a href="#L-3353"><span class="linenos">3353</span></a>            <span class="n">focus_on</span><span class="o">=</span><span class="p">[</span><span class="n">val</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">pickups</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)]</span>
</span><span id="L-3354"><a href="#L-3354"><span class="linenos">3354</span></a>            <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">pickups</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;all&quot;</span>
</span><span id="L-3355"><a href="#L-3355"><span class="linenos">3355</span></a>            <span class="k">else</span> <span class="p">[],</span>
</span><span id="L-3356"><a href="#L-3356"><span class="linenos">3356</span></a>            <span class="n">exclude</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Tom Brady&quot;</span><span class="p">],</span>
</span><span id="L-3357"><a href="#L-3357"><span class="linenos">3357</span></a>            <span class="n">limit_per</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
</span><span id="L-3358"><a href="#L-3358"><span class="linenos">3358</span></a>            <span class="n">payouts</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">payouts</span><span class="p">,</span>
</span><span id="L-3359"><a href="#L-3359"><span class="linenos">3359</span></a>            <span class="n">bestball</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">bestball</span><span class="p">,</span>
</span><span id="L-3360"><a href="#L-3360"><span class="linenos">3360</span></a>        <span class="p">)</span>
</span><span id="L-3361"><a href="#L-3361"><span class="linenos">3361</span></a>        <span class="n">writer</span> <span class="o">=</span> <span class="n">excelAutofit</span><span class="p">(</span>
</span><span id="L-3362"><a href="#L-3362"><span class="linenos">3362</span></a>            <span class="n">pickups</span><span class="p">[</span>
</span><span id="L-3363"><a href="#L-3363"><span class="linenos">3363</span></a>                <span class="p">[</span>
</span><span id="L-3364"><a href="#L-3364"><span class="linenos">3364</span></a>                    <span class="s2">&quot;player_to_drop&quot;</span><span class="p">,</span>
</span><span id="L-3365"><a href="#L-3365"><span class="linenos">3365</span></a>                    <span class="s2">&quot;player_to_add&quot;</span><span class="p">,</span>
</span><span id="L-3366"><a href="#L-3366"><span class="linenos">3366</span></a>                    <span class="s2">&quot;wins_avg&quot;</span><span class="p">,</span>
</span><span id="L-3367"><a href="#L-3367"><span class="linenos">3367</span></a>                    <span class="s2">&quot;wins_stdev&quot;</span><span class="p">,</span>
</span><span id="L-3368"><a href="#L-3368"><span class="linenos">3368</span></a>                    <span class="s2">&quot;points_avg&quot;</span><span class="p">,</span>
</span><span id="L-3369"><a href="#L-3369"><span class="linenos">3369</span></a>                    <span class="s2">&quot;points_stdev&quot;</span><span class="p">,</span>
</span><span id="L-3370"><a href="#L-3370"><span class="linenos">3370</span></a>                    <span class="s2">&quot;per_game_avg&quot;</span><span class="p">,</span>
</span><span id="L-3371"><a href="#L-3371"><span class="linenos">3371</span></a>                    <span class="s2">&quot;per_game_stdev&quot;</span><span class="p">,</span>
</span><span id="L-3372"><a href="#L-3372"><span class="linenos">3372</span></a>                    <span class="s2">&quot;per_game_fano&quot;</span><span class="p">,</span>
</span><span id="L-3373"><a href="#L-3373"><span class="linenos">3373</span></a>                    <span class="s2">&quot;playoffs&quot;</span><span class="p">,</span>
</span><span id="L-3374"><a href="#L-3374"><span class="linenos">3374</span></a>                    <span class="s2">&quot;playoff_bye&quot;</span><span class="p">,</span>
</span><span id="L-3375"><a href="#L-3375"><span class="linenos">3375</span></a>                    <span class="s2">&quot;winner&quot;</span><span class="p">,</span>
</span><span id="L-3376"><a href="#L-3376"><span class="linenos">3376</span></a>                    <span class="s2">&quot;runner_up&quot;</span><span class="p">,</span>
</span><span id="L-3377"><a href="#L-3377"><span class="linenos">3377</span></a>                    <span class="s2">&quot;third&quot;</span><span class="p">,</span>
</span><span id="L-3378"><a href="#L-3378"><span class="linenos">3378</span></a>                    <span class="s2">&quot;earnings&quot;</span><span class="p">,</span>
</span><span id="L-3379"><a href="#L-3379"><span class="linenos">3379</span></a>                <span class="p">]</span>
</span><span id="L-3380"><a href="#L-3380"><span class="linenos">3380</span></a>                <span class="o">+</span> <span class="p">([</span><span class="s2">&quot;many_mile&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;The Algorithm&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">options</span><span class="o">.</span><span class="n">bestball</span> <span class="k">else</span> <span class="p">[])</span>
</span><span id="L-3381"><a href="#L-3381"><span class="linenos">3381</span></a>            <span class="p">],</span>
</span><span id="L-3382"><a href="#L-3382"><span class="linenos">3382</span></a>            <span class="s2">&quot;Pickups&quot;</span><span class="p">,</span>
</span><span id="L-3383"><a href="#L-3383"><span class="linenos">3383</span></a>            <span class="n">writer</span><span class="p">,</span>
</span><span id="L-3384"><a href="#L-3384"><span class="linenos">3384</span></a>            <span class="mi">2</span><span class="p">,</span>
</span><span id="L-3385"><a href="#L-3385"><span class="linenos">3385</span></a>        <span class="p">)</span>
</span><span id="L-3386"><a href="#L-3386"><span class="linenos">3386</span></a>        <span class="n">writer</span><span class="o">.</span><span class="n">sheets</span><span class="p">[</span><span class="s2">&quot;Pickups&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">conditional_format</span><span class="p">(</span>
</span><span id="L-3387"><a href="#L-3387"><span class="linenos">3387</span></a>            <span class="s2">&quot;J2:N&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">pickups</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="L-3388"><a href="#L-3388"><span class="linenos">3388</span></a>            <span class="p">{</span>
</span><span id="L-3389"><a href="#L-3389"><span class="linenos">3389</span></a>                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;3_color_scale&quot;</span><span class="p">,</span>
</span><span id="L-3390"><a href="#L-3390"><span class="linenos">3390</span></a>                <span class="s2">&quot;min_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FF6347&quot;</span><span class="p">,</span>
</span><span id="L-3391"><a href="#L-3391"><span class="linenos">3391</span></a>                <span class="s2">&quot;mid_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FFD700&quot;</span><span class="p">,</span>
</span><span id="L-3392"><a href="#L-3392"><span class="linenos">3392</span></a>                <span class="s2">&quot;max_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#3CB371&quot;</span><span class="p">,</span>
</span><span id="L-3393"><a href="#L-3393"><span class="linenos">3393</span></a>            <span class="p">},</span>
</span><span id="L-3394"><a href="#L-3394"><span class="linenos">3394</span></a>        <span class="p">)</span>
</span><span id="L-3395"><a href="#L-3395"><span class="linenos">3395</span></a>        <span class="n">writer</span><span class="o">.</span><span class="n">sheets</span><span class="p">[</span><span class="s2">&quot;Pickups&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">conditional_format</span><span class="p">(</span>
</span><span id="L-3396"><a href="#L-3396"><span class="linenos">3396</span></a>            <span class="s2">&quot;O2:O&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">pickups</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="L-3397"><a href="#L-3397"><span class="linenos">3397</span></a>            <span class="p">{</span>
</span><span id="L-3398"><a href="#L-3398"><span class="linenos">3398</span></a>                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;3_color_scale&quot;</span><span class="p">,</span>
</span><span id="L-3399"><a href="#L-3399"><span class="linenos">3399</span></a>                <span class="s2">&quot;min_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FF6347&quot;</span><span class="p">,</span>
</span><span id="L-3400"><a href="#L-3400"><span class="linenos">3400</span></a>                <span class="s2">&quot;mid_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FFD700&quot;</span><span class="p">,</span>
</span><span id="L-3401"><a href="#L-3401"><span class="linenos">3401</span></a>                <span class="s2">&quot;max_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#3CB371&quot;</span><span class="p">,</span>
</span><span id="L-3402"><a href="#L-3402"><span class="linenos">3402</span></a>            <span class="p">},</span>
</span><span id="L-3403"><a href="#L-3403"><span class="linenos">3403</span></a>        <span class="p">)</span>
</span><span id="L-3404"><a href="#L-3404"><span class="linenos">3404</span></a>        <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;The Algorithm&quot;</span><span class="p">:</span>
</span><span id="L-3405"><a href="#L-3405"><span class="linenos">3405</span></a>            <span class="n">writer</span><span class="o">.</span><span class="n">sheets</span><span class="p">[</span><span class="s2">&quot;Pickups&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">conditional_format</span><span class="p">(</span>
</span><span id="L-3406"><a href="#L-3406"><span class="linenos">3406</span></a>                <span class="s2">&quot;P2:P&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">pickups</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="L-3407"><a href="#L-3407"><span class="linenos">3407</span></a>                <span class="p">{</span>
</span><span id="L-3408"><a href="#L-3408"><span class="linenos">3408</span></a>                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;3_color_scale&quot;</span><span class="p">,</span>
</span><span id="L-3409"><a href="#L-3409"><span class="linenos">3409</span></a>                    <span class="s2">&quot;max_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FF6347&quot;</span><span class="p">,</span>
</span><span id="L-3410"><a href="#L-3410"><span class="linenos">3410</span></a>                    <span class="s2">&quot;mid_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FFD700&quot;</span><span class="p">,</span>
</span><span id="L-3411"><a href="#L-3411"><span class="linenos">3411</span></a>                    <span class="s2">&quot;min_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#3CB371&quot;</span><span class="p">,</span>
</span><span id="L-3412"><a href="#L-3412"><span class="linenos">3412</span></a>                <span class="p">},</span>
</span><span id="L-3413"><a href="#L-3413"><span class="linenos">3413</span></a>            <span class="p">)</span>
</span><span id="L-3414"><a href="#L-3414"><span class="linenos">3414</span></a>
</span><span id="L-3415"><a href="#L-3415"><span class="linenos">3415</span></a>    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">adds</span><span class="p">:</span>
</span><span id="L-3416"><a href="#L-3416"><span class="linenos">3416</span></a>        <span class="n">adds</span> <span class="o">=</span> <span class="n">league</span><span class="o">.</span><span class="n">possible_adds</span><span class="p">(</span>
</span><span id="L-3417"><a href="#L-3417"><span class="linenos">3417</span></a>            <span class="n">exclude</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Tom Brady&quot;</span><span class="p">],</span>
</span><span id="L-3418"><a href="#L-3418"><span class="linenos">3418</span></a>            <span class="n">limit_per</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
</span><span id="L-3419"><a href="#L-3419"><span class="linenos">3419</span></a>            <span class="n">payouts</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">payouts</span><span class="p">,</span>
</span><span id="L-3420"><a href="#L-3420"><span class="linenos">3420</span></a>            <span class="n">bestball</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">bestball</span><span class="p">,</span>
</span><span id="L-3421"><a href="#L-3421"><span class="linenos">3421</span></a>        <span class="p">)</span>
</span><span id="L-3422"><a href="#L-3422"><span class="linenos">3422</span></a>        <span class="n">writer</span> <span class="o">=</span> <span class="n">excelAutofit</span><span class="p">(</span>
</span><span id="L-3423"><a href="#L-3423"><span class="linenos">3423</span></a>            <span class="n">adds</span><span class="p">[</span>
</span><span id="L-3424"><a href="#L-3424"><span class="linenos">3424</span></a>                <span class="p">[</span>
</span><span id="L-3425"><a href="#L-3425"><span class="linenos">3425</span></a>                    <span class="s2">&quot;player_to_add&quot;</span><span class="p">,</span>
</span><span id="L-3426"><a href="#L-3426"><span class="linenos">3426</span></a>                    <span class="s2">&quot;wins_avg&quot;</span><span class="p">,</span>
</span><span id="L-3427"><a href="#L-3427"><span class="linenos">3427</span></a>                    <span class="s2">&quot;wins_stdev&quot;</span><span class="p">,</span>
</span><span id="L-3428"><a href="#L-3428"><span class="linenos">3428</span></a>                    <span class="s2">&quot;points_avg&quot;</span><span class="p">,</span>
</span><span id="L-3429"><a href="#L-3429"><span class="linenos">3429</span></a>                    <span class="s2">&quot;points_stdev&quot;</span><span class="p">,</span>
</span><span id="L-3430"><a href="#L-3430"><span class="linenos">3430</span></a>                    <span class="s2">&quot;per_game_avg&quot;</span><span class="p">,</span>
</span><span id="L-3431"><a href="#L-3431"><span class="linenos">3431</span></a>                    <span class="s2">&quot;per_game_stdev&quot;</span><span class="p">,</span>
</span><span id="L-3432"><a href="#L-3432"><span class="linenos">3432</span></a>                    <span class="s2">&quot;per_game_fano&quot;</span><span class="p">,</span>
</span><span id="L-3433"><a href="#L-3433"><span class="linenos">3433</span></a>                    <span class="s2">&quot;playoffs&quot;</span><span class="p">,</span>
</span><span id="L-3434"><a href="#L-3434"><span class="linenos">3434</span></a>                    <span class="s2">&quot;playoff_bye&quot;</span><span class="p">,</span>
</span><span id="L-3435"><a href="#L-3435"><span class="linenos">3435</span></a>                    <span class="s2">&quot;winner&quot;</span><span class="p">,</span>
</span><span id="L-3436"><a href="#L-3436"><span class="linenos">3436</span></a>                    <span class="s2">&quot;runner_up&quot;</span><span class="p">,</span>
</span><span id="L-3437"><a href="#L-3437"><span class="linenos">3437</span></a>                    <span class="s2">&quot;third&quot;</span><span class="p">,</span>
</span><span id="L-3438"><a href="#L-3438"><span class="linenos">3438</span></a>                    <span class="s2">&quot;earnings&quot;</span><span class="p">,</span>
</span><span id="L-3439"><a href="#L-3439"><span class="linenos">3439</span></a>                <span class="p">]</span>
</span><span id="L-3440"><a href="#L-3440"><span class="linenos">3440</span></a>                <span class="o">+</span> <span class="p">([</span><span class="s2">&quot;many_mile&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;The Algorithm&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">options</span><span class="o">.</span><span class="n">bestball</span> <span class="k">else</span> <span class="p">[])</span>
</span><span id="L-3441"><a href="#L-3441"><span class="linenos">3441</span></a>            <span class="p">],</span>
</span><span id="L-3442"><a href="#L-3442"><span class="linenos">3442</span></a>            <span class="s2">&quot;Adds&quot;</span><span class="p">,</span>
</span><span id="L-3443"><a href="#L-3443"><span class="linenos">3443</span></a>            <span class="n">writer</span><span class="p">,</span>
</span><span id="L-3444"><a href="#L-3444"><span class="linenos">3444</span></a>        <span class="p">)</span>
</span><span id="L-3445"><a href="#L-3445"><span class="linenos">3445</span></a>        <span class="n">writer</span><span class="o">.</span><span class="n">sheets</span><span class="p">[</span><span class="s2">&quot;Adds&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">conditional_format</span><span class="p">(</span>
</span><span id="L-3446"><a href="#L-3446"><span class="linenos">3446</span></a>            <span class="s2">&quot;J2:N&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">adds</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="L-3447"><a href="#L-3447"><span class="linenos">3447</span></a>            <span class="p">{</span>
</span><span id="L-3448"><a href="#L-3448"><span class="linenos">3448</span></a>                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;3_color_scale&quot;</span><span class="p">,</span>
</span><span id="L-3449"><a href="#L-3449"><span class="linenos">3449</span></a>                <span class="s2">&quot;min_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FF6347&quot;</span><span class="p">,</span>
</span><span id="L-3450"><a href="#L-3450"><span class="linenos">3450</span></a>                <span class="s2">&quot;mid_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FFD700&quot;</span><span class="p">,</span>
</span><span id="L-3451"><a href="#L-3451"><span class="linenos">3451</span></a>                <span class="s2">&quot;max_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#3CB371&quot;</span><span class="p">,</span>
</span><span id="L-3452"><a href="#L-3452"><span class="linenos">3452</span></a>            <span class="p">},</span>
</span><span id="L-3453"><a href="#L-3453"><span class="linenos">3453</span></a>        <span class="p">)</span>
</span><span id="L-3454"><a href="#L-3454"><span class="linenos">3454</span></a>        <span class="n">writer</span><span class="o">.</span><span class="n">sheets</span><span class="p">[</span><span class="s2">&quot;Adds&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">conditional_format</span><span class="p">(</span>
</span><span id="L-3455"><a href="#L-3455"><span class="linenos">3455</span></a>            <span class="s2">&quot;O2:O&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">adds</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="L-3456"><a href="#L-3456"><span class="linenos">3456</span></a>            <span class="p">{</span>
</span><span id="L-3457"><a href="#L-3457"><span class="linenos">3457</span></a>                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;3_color_scale&quot;</span><span class="p">,</span>
</span><span id="L-3458"><a href="#L-3458"><span class="linenos">3458</span></a>                <span class="s2">&quot;min_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FF6347&quot;</span><span class="p">,</span>
</span><span id="L-3459"><a href="#L-3459"><span class="linenos">3459</span></a>                <span class="s2">&quot;mid_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FFD700&quot;</span><span class="p">,</span>
</span><span id="L-3460"><a href="#L-3460"><span class="linenos">3460</span></a>                <span class="s2">&quot;max_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#3CB371&quot;</span><span class="p">,</span>
</span><span id="L-3461"><a href="#L-3461"><span class="linenos">3461</span></a>            <span class="p">},</span>
</span><span id="L-3462"><a href="#L-3462"><span class="linenos">3462</span></a>        <span class="p">)</span>
</span><span id="L-3463"><a href="#L-3463"><span class="linenos">3463</span></a>        <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;The Algorithm&quot;</span><span class="p">:</span>
</span><span id="L-3464"><a href="#L-3464"><span class="linenos">3464</span></a>            <span class="n">writer</span><span class="o">.</span><span class="n">sheets</span><span class="p">[</span><span class="s2">&quot;Adds&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">conditional_format</span><span class="p">(</span>
</span><span id="L-3465"><a href="#L-3465"><span class="linenos">3465</span></a>                <span class="s2">&quot;P2:P&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">adds</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="L-3466"><a href="#L-3466"><span class="linenos">3466</span></a>                <span class="p">{</span>
</span><span id="L-3467"><a href="#L-3467"><span class="linenos">3467</span></a>                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;3_color_scale&quot;</span><span class="p">,</span>
</span><span id="L-3468"><a href="#L-3468"><span class="linenos">3468</span></a>                    <span class="s2">&quot;max_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FF6347&quot;</span><span class="p">,</span>
</span><span id="L-3469"><a href="#L-3469"><span class="linenos">3469</span></a>                    <span class="s2">&quot;mid_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FFD700&quot;</span><span class="p">,</span>
</span><span id="L-3470"><a href="#L-3470"><span class="linenos">3470</span></a>                    <span class="s2">&quot;min_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#3CB371&quot;</span><span class="p">,</span>
</span><span id="L-3471"><a href="#L-3471"><span class="linenos">3471</span></a>                <span class="p">},</span>
</span><span id="L-3472"><a href="#L-3472"><span class="linenos">3472</span></a>            <span class="p">)</span>
</span><span id="L-3473"><a href="#L-3473"><span class="linenos">3473</span></a>
</span><span id="L-3474"><a href="#L-3474"><span class="linenos">3474</span></a>    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">drops</span><span class="p">:</span>
</span><span id="L-3475"><a href="#L-3475"><span class="linenos">3475</span></a>        <span class="n">drops</span> <span class="o">=</span> <span class="n">league</span><span class="o">.</span><span class="n">possible_drops</span><span class="p">(</span>
</span><span id="L-3476"><a href="#L-3476"><span class="linenos">3476</span></a>            <span class="n">payouts</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">payouts</span><span class="p">,</span>
</span><span id="L-3477"><a href="#L-3477"><span class="linenos">3477</span></a>            <span class="n">bestball</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">bestball</span><span class="p">,</span>
</span><span id="L-3478"><a href="#L-3478"><span class="linenos">3478</span></a>        <span class="p">)</span>
</span><span id="L-3479"><a href="#L-3479"><span class="linenos">3479</span></a>        <span class="n">writer</span> <span class="o">=</span> <span class="n">excelAutofit</span><span class="p">(</span>
</span><span id="L-3480"><a href="#L-3480"><span class="linenos">3480</span></a>            <span class="n">drops</span><span class="p">[</span>
</span><span id="L-3481"><a href="#L-3481"><span class="linenos">3481</span></a>                <span class="p">[</span>
</span><span id="L-3482"><a href="#L-3482"><span class="linenos">3482</span></a>                    <span class="s2">&quot;player_to_drop&quot;</span><span class="p">,</span>
</span><span id="L-3483"><a href="#L-3483"><span class="linenos">3483</span></a>                    <span class="s2">&quot;wins_avg&quot;</span><span class="p">,</span>
</span><span id="L-3484"><a href="#L-3484"><span class="linenos">3484</span></a>                    <span class="s2">&quot;wins_stdev&quot;</span><span class="p">,</span>
</span><span id="L-3485"><a href="#L-3485"><span class="linenos">3485</span></a>                    <span class="s2">&quot;points_avg&quot;</span><span class="p">,</span>
</span><span id="L-3486"><a href="#L-3486"><span class="linenos">3486</span></a>                    <span class="s2">&quot;points_stdev&quot;</span><span class="p">,</span>
</span><span id="L-3487"><a href="#L-3487"><span class="linenos">3487</span></a>                    <span class="s2">&quot;per_game_avg&quot;</span><span class="p">,</span>
</span><span id="L-3488"><a href="#L-3488"><span class="linenos">3488</span></a>                    <span class="s2">&quot;per_game_stdev&quot;</span><span class="p">,</span>
</span><span id="L-3489"><a href="#L-3489"><span class="linenos">3489</span></a>                    <span class="s2">&quot;per_game_fano&quot;</span><span class="p">,</span>
</span><span id="L-3490"><a href="#L-3490"><span class="linenos">3490</span></a>                    <span class="s2">&quot;playoffs&quot;</span><span class="p">,</span>
</span><span id="L-3491"><a href="#L-3491"><span class="linenos">3491</span></a>                    <span class="s2">&quot;playoff_bye&quot;</span><span class="p">,</span>
</span><span id="L-3492"><a href="#L-3492"><span class="linenos">3492</span></a>                    <span class="s2">&quot;winner&quot;</span><span class="p">,</span>
</span><span id="L-3493"><a href="#L-3493"><span class="linenos">3493</span></a>                    <span class="s2">&quot;runner_up&quot;</span><span class="p">,</span>
</span><span id="L-3494"><a href="#L-3494"><span class="linenos">3494</span></a>                    <span class="s2">&quot;third&quot;</span><span class="p">,</span>
</span><span id="L-3495"><a href="#L-3495"><span class="linenos">3495</span></a>                    <span class="s2">&quot;earnings&quot;</span><span class="p">,</span>
</span><span id="L-3496"><a href="#L-3496"><span class="linenos">3496</span></a>                <span class="p">]</span>
</span><span id="L-3497"><a href="#L-3497"><span class="linenos">3497</span></a>                <span class="o">+</span> <span class="p">([</span><span class="s2">&quot;many_mile&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;The Algorithm&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">options</span><span class="o">.</span><span class="n">bestball</span> <span class="k">else</span> <span class="p">[])</span>
</span><span id="L-3498"><a href="#L-3498"><span class="linenos">3498</span></a>            <span class="p">],</span>
</span><span id="L-3499"><a href="#L-3499"><span class="linenos">3499</span></a>            <span class="s2">&quot;Drops&quot;</span><span class="p">,</span>
</span><span id="L-3500"><a href="#L-3500"><span class="linenos">3500</span></a>            <span class="n">writer</span><span class="p">,</span>
</span><span id="L-3501"><a href="#L-3501"><span class="linenos">3501</span></a>        <span class="p">)</span>
</span><span id="L-3502"><a href="#L-3502"><span class="linenos">3502</span></a>        <span class="n">writer</span><span class="o">.</span><span class="n">sheets</span><span class="p">[</span><span class="s2">&quot;Drops&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">conditional_format</span><span class="p">(</span>
</span><span id="L-3503"><a href="#L-3503"><span class="linenos">3503</span></a>            <span class="s2">&quot;J2:N&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">drops</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="L-3504"><a href="#L-3504"><span class="linenos">3504</span></a>            <span class="p">{</span>
</span><span id="L-3505"><a href="#L-3505"><span class="linenos">3505</span></a>                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;3_color_scale&quot;</span><span class="p">,</span>
</span><span id="L-3506"><a href="#L-3506"><span class="linenos">3506</span></a>                <span class="s2">&quot;min_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FF6347&quot;</span><span class="p">,</span>
</span><span id="L-3507"><a href="#L-3507"><span class="linenos">3507</span></a>                <span class="s2">&quot;mid_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FFD700&quot;</span><span class="p">,</span>
</span><span id="L-3508"><a href="#L-3508"><span class="linenos">3508</span></a>                <span class="s2">&quot;max_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#3CB371&quot;</span><span class="p">,</span>
</span><span id="L-3509"><a href="#L-3509"><span class="linenos">3509</span></a>            <span class="p">},</span>
</span><span id="L-3510"><a href="#L-3510"><span class="linenos">3510</span></a>        <span class="p">)</span>
</span><span id="L-3511"><a href="#L-3511"><span class="linenos">3511</span></a>        <span class="n">writer</span><span class="o">.</span><span class="n">sheets</span><span class="p">[</span><span class="s2">&quot;Drops&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">conditional_format</span><span class="p">(</span>
</span><span id="L-3512"><a href="#L-3512"><span class="linenos">3512</span></a>            <span class="s2">&quot;O2:O&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">drops</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="L-3513"><a href="#L-3513"><span class="linenos">3513</span></a>            <span class="p">{</span>
</span><span id="L-3514"><a href="#L-3514"><span class="linenos">3514</span></a>                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;3_color_scale&quot;</span><span class="p">,</span>
</span><span id="L-3515"><a href="#L-3515"><span class="linenos">3515</span></a>                <span class="s2">&quot;min_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FF6347&quot;</span><span class="p">,</span>
</span><span id="L-3516"><a href="#L-3516"><span class="linenos">3516</span></a>                <span class="s2">&quot;mid_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FFD700&quot;</span><span class="p">,</span>
</span><span id="L-3517"><a href="#L-3517"><span class="linenos">3517</span></a>                <span class="s2">&quot;max_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#3CB371&quot;</span><span class="p">,</span>
</span><span id="L-3518"><a href="#L-3518"><span class="linenos">3518</span></a>            <span class="p">},</span>
</span><span id="L-3519"><a href="#L-3519"><span class="linenos">3519</span></a>        <span class="p">)</span>
</span><span id="L-3520"><a href="#L-3520"><span class="linenos">3520</span></a>        <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;The Algorithm&quot;</span><span class="p">:</span>
</span><span id="L-3521"><a href="#L-3521"><span class="linenos">3521</span></a>            <span class="n">writer</span><span class="o">.</span><span class="n">sheets</span><span class="p">[</span><span class="s2">&quot;Drops&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">conditional_format</span><span class="p">(</span>
</span><span id="L-3522"><a href="#L-3522"><span class="linenos">3522</span></a>                <span class="s2">&quot;P2:P&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">drops</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="L-3523"><a href="#L-3523"><span class="linenos">3523</span></a>                <span class="p">{</span>
</span><span id="L-3524"><a href="#L-3524"><span class="linenos">3524</span></a>                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;3_color_scale&quot;</span><span class="p">,</span>
</span><span id="L-3525"><a href="#L-3525"><span class="linenos">3525</span></a>                    <span class="s2">&quot;max_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FF6347&quot;</span><span class="p">,</span>
</span><span id="L-3526"><a href="#L-3526"><span class="linenos">3526</span></a>                    <span class="s2">&quot;mid_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FFD700&quot;</span><span class="p">,</span>
</span><span id="L-3527"><a href="#L-3527"><span class="linenos">3527</span></a>                    <span class="s2">&quot;min_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#3CB371&quot;</span><span class="p">,</span>
</span><span id="L-3528"><a href="#L-3528"><span class="linenos">3528</span></a>                <span class="p">},</span>
</span><span id="L-3529"><a href="#L-3529"><span class="linenos">3529</span></a>            <span class="p">)</span>
</span><span id="L-3530"><a href="#L-3530"><span class="linenos">3530</span></a>
</span><span id="L-3531"><a href="#L-3531"><span class="linenos">3531</span></a>    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">trades</span> <span class="ow">or</span> <span class="n">options</span><span class="o">.</span><span class="n">given</span><span class="p">:</span>
</span><span id="L-3532"><a href="#L-3532"><span class="linenos">3532</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">options</span><span class="o">.</span><span class="n">trades</span><span class="p">:</span>
</span><span id="L-3533"><a href="#L-3533"><span class="linenos">3533</span></a>            <span class="n">options</span><span class="o">.</span><span class="n">trades</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span>
</span><span id="L-3534"><a href="#L-3534"><span class="linenos">3534</span></a>        <span class="n">trades</span> <span class="o">=</span> <span class="n">league</span><span class="o">.</span><span class="n">possible_trades</span><span class="p">(</span>
</span><span id="L-3535"><a href="#L-3535"><span class="linenos">3535</span></a>            <span class="n">focus_on</span><span class="o">=</span><span class="p">[</span><span class="n">val</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">trades</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)]</span>
</span><span id="L-3536"><a href="#L-3536"><span class="linenos">3536</span></a>            <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">trades</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;all&quot;</span>
</span><span id="L-3537"><a href="#L-3537"><span class="linenos">3537</span></a>            <span class="k">else</span> <span class="p">[],</span>
</span><span id="L-3538"><a href="#L-3538"><span class="linenos">3538</span></a>            <span class="n">exclude</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Tom Brady&quot;</span><span class="p">],</span>
</span><span id="L-3539"><a href="#L-3539"><span class="linenos">3539</span></a>            <span class="n">given</span><span class="o">=</span><span class="p">[</span><span class="n">val</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">given</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)]</span> <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">given</span> <span class="k">else</span> <span class="p">[],</span>
</span><span id="L-3540"><a href="#L-3540"><span class="linenos">3540</span></a>            <span class="n">limit_per</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
</span><span id="L-3541"><a href="#L-3541"><span class="linenos">3541</span></a>            <span class="n">payouts</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">payouts</span><span class="p">,</span>
</span><span id="L-3542"><a href="#L-3542"><span class="linenos">3542</span></a>            <span class="n">bestball</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">bestball</span><span class="p">,</span>
</span><span id="L-3543"><a href="#L-3543"><span class="linenos">3543</span></a>        <span class="p">)</span>
</span><span id="L-3544"><a href="#L-3544"><span class="linenos">3544</span></a>        <span class="n">writer</span> <span class="o">=</span> <span class="n">excelAutofit</span><span class="p">(</span>
</span><span id="L-3545"><a href="#L-3545"><span class="linenos">3545</span></a>            <span class="n">trades</span><span class="p">[</span>
</span><span id="L-3546"><a href="#L-3546"><span class="linenos">3546</span></a>                <span class="p">[</span>
</span><span id="L-3547"><a href="#L-3547"><span class="linenos">3547</span></a>                    <span class="s2">&quot;player_to_trade_away&quot;</span><span class="p">,</span>
</span><span id="L-3548"><a href="#L-3548"><span class="linenos">3548</span></a>                    <span class="s2">&quot;player_to_trade_for&quot;</span><span class="p">,</span>
</span><span id="L-3549"><a href="#L-3549"><span class="linenos">3549</span></a>                    <span class="s2">&quot;their_team&quot;</span><span class="p">,</span>
</span><span id="L-3550"><a href="#L-3550"><span class="linenos">3550</span></a>                    <span class="s2">&quot;my_wins_avg&quot;</span><span class="p">,</span>
</span><span id="L-3551"><a href="#L-3551"><span class="linenos">3551</span></a>                    <span class="s2">&quot;my_wins_stdev&quot;</span><span class="p">,</span>
</span><span id="L-3552"><a href="#L-3552"><span class="linenos">3552</span></a>                    <span class="s2">&quot;my_points_avg&quot;</span><span class="p">,</span>
</span><span id="L-3553"><a href="#L-3553"><span class="linenos">3553</span></a>                    <span class="s2">&quot;my_points_stdev&quot;</span><span class="p">,</span>
</span><span id="L-3554"><a href="#L-3554"><span class="linenos">3554</span></a>                    <span class="s2">&quot;my_per_game_avg&quot;</span><span class="p">,</span>
</span><span id="L-3555"><a href="#L-3555"><span class="linenos">3555</span></a>                    <span class="s2">&quot;my_per_game_stdev&quot;</span><span class="p">,</span>
</span><span id="L-3556"><a href="#L-3556"><span class="linenos">3556</span></a>                    <span class="s2">&quot;my_per_game_fano&quot;</span><span class="p">,</span>
</span><span id="L-3557"><a href="#L-3557"><span class="linenos">3557</span></a>                    <span class="s2">&quot;my_playoffs&quot;</span><span class="p">,</span>
</span><span id="L-3558"><a href="#L-3558"><span class="linenos">3558</span></a>                    <span class="s2">&quot;my_playoff_bye&quot;</span><span class="p">,</span>
</span><span id="L-3559"><a href="#L-3559"><span class="linenos">3559</span></a>                    <span class="s2">&quot;my_winner&quot;</span><span class="p">,</span>
</span><span id="L-3560"><a href="#L-3560"><span class="linenos">3560</span></a>                    <span class="s2">&quot;my_runner_up&quot;</span><span class="p">,</span>
</span><span id="L-3561"><a href="#L-3561"><span class="linenos">3561</span></a>                    <span class="s2">&quot;my_third&quot;</span><span class="p">,</span>
</span><span id="L-3562"><a href="#L-3562"><span class="linenos">3562</span></a>                    <span class="s2">&quot;my_earnings&quot;</span><span class="p">,</span>
</span><span id="L-3563"><a href="#L-3563"><span class="linenos">3563</span></a>                    <span class="s2">&quot;their_wins_avg&quot;</span><span class="p">,</span>
</span><span id="L-3564"><a href="#L-3564"><span class="linenos">3564</span></a>                    <span class="s2">&quot;their_wins_stdev&quot;</span><span class="p">,</span>
</span><span id="L-3565"><a href="#L-3565"><span class="linenos">3565</span></a>                    <span class="s2">&quot;their_points_avg&quot;</span><span class="p">,</span>
</span><span id="L-3566"><a href="#L-3566"><span class="linenos">3566</span></a>                    <span class="s2">&quot;their_points_stdev&quot;</span><span class="p">,</span>
</span><span id="L-3567"><a href="#L-3567"><span class="linenos">3567</span></a>                    <span class="s2">&quot;their_per_game_avg&quot;</span><span class="p">,</span>
</span><span id="L-3568"><a href="#L-3568"><span class="linenos">3568</span></a>                    <span class="s2">&quot;their_per_game_stdev&quot;</span><span class="p">,</span>
</span><span id="L-3569"><a href="#L-3569"><span class="linenos">3569</span></a>                    <span class="s2">&quot;their_per_game_fano&quot;</span><span class="p">,</span>
</span><span id="L-3570"><a href="#L-3570"><span class="linenos">3570</span></a>                    <span class="s2">&quot;their_playoffs&quot;</span><span class="p">,</span>
</span><span id="L-3571"><a href="#L-3571"><span class="linenos">3571</span></a>                    <span class="s2">&quot;their_playoff_bye&quot;</span><span class="p">,</span>
</span><span id="L-3572"><a href="#L-3572"><span class="linenos">3572</span></a>                    <span class="s2">&quot;their_winner&quot;</span><span class="p">,</span>
</span><span id="L-3573"><a href="#L-3573"><span class="linenos">3573</span></a>                    <span class="s2">&quot;their_runner_up&quot;</span><span class="p">,</span>
</span><span id="L-3574"><a href="#L-3574"><span class="linenos">3574</span></a>                    <span class="s2">&quot;their_third&quot;</span><span class="p">,</span>
</span><span id="L-3575"><a href="#L-3575"><span class="linenos">3575</span></a>                    <span class="s2">&quot;their_earnings&quot;</span><span class="p">,</span>
</span><span id="L-3576"><a href="#L-3576"><span class="linenos">3576</span></a>                <span class="p">]</span>
</span><span id="L-3577"><a href="#L-3577"><span class="linenos">3577</span></a>            <span class="p">],</span>
</span><span id="L-3578"><a href="#L-3578"><span class="linenos">3578</span></a>            <span class="s2">&quot;Trades&quot;</span><span class="p">,</span>
</span><span id="L-3579"><a href="#L-3579"><span class="linenos">3579</span></a>            <span class="n">writer</span><span class="p">,</span>
</span><span id="L-3580"><a href="#L-3580"><span class="linenos">3580</span></a>            <span class="mi">3</span><span class="p">,</span>
</span><span id="L-3581"><a href="#L-3581"><span class="linenos">3581</span></a>        <span class="p">)</span>
</span><span id="L-3582"><a href="#L-3582"><span class="linenos">3582</span></a>        <span class="n">writer</span><span class="o">.</span><span class="n">sheets</span><span class="p">[</span><span class="s2">&quot;Trades&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">conditional_format</span><span class="p">(</span>
</span><span id="L-3583"><a href="#L-3583"><span class="linenos">3583</span></a>            <span class="s2">&quot;K2:O&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">trades</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="L-3584"><a href="#L-3584"><span class="linenos">3584</span></a>            <span class="p">{</span>
</span><span id="L-3585"><a href="#L-3585"><span class="linenos">3585</span></a>                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;3_color_scale&quot;</span><span class="p">,</span>
</span><span id="L-3586"><a href="#L-3586"><span class="linenos">3586</span></a>                <span class="s2">&quot;min_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FF6347&quot;</span><span class="p">,</span>
</span><span id="L-3587"><a href="#L-3587"><span class="linenos">3587</span></a>                <span class="s2">&quot;mid_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FFD700&quot;</span><span class="p">,</span>
</span><span id="L-3588"><a href="#L-3588"><span class="linenos">3588</span></a>                <span class="s2">&quot;max_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#3CB371&quot;</span><span class="p">,</span>
</span><span id="L-3589"><a href="#L-3589"><span class="linenos">3589</span></a>            <span class="p">},</span>
</span><span id="L-3590"><a href="#L-3590"><span class="linenos">3590</span></a>        <span class="p">)</span>
</span><span id="L-3591"><a href="#L-3591"><span class="linenos">3591</span></a>        <span class="n">writer</span><span class="o">.</span><span class="n">sheets</span><span class="p">[</span><span class="s2">&quot;Trades&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">conditional_format</span><span class="p">(</span>
</span><span id="L-3592"><a href="#L-3592"><span class="linenos">3592</span></a>            <span class="s2">&quot;P2:P&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">trades</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="L-3593"><a href="#L-3593"><span class="linenos">3593</span></a>            <span class="p">{</span>
</span><span id="L-3594"><a href="#L-3594"><span class="linenos">3594</span></a>                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;3_color_scale&quot;</span><span class="p">,</span>
</span><span id="L-3595"><a href="#L-3595"><span class="linenos">3595</span></a>                <span class="s2">&quot;min_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FF6347&quot;</span><span class="p">,</span>
</span><span id="L-3596"><a href="#L-3596"><span class="linenos">3596</span></a>                <span class="s2">&quot;mid_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FFD700&quot;</span><span class="p">,</span>
</span><span id="L-3597"><a href="#L-3597"><span class="linenos">3597</span></a>                <span class="s2">&quot;max_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#3CB371&quot;</span><span class="p">,</span>
</span><span id="L-3598"><a href="#L-3598"><span class="linenos">3598</span></a>            <span class="p">},</span>
</span><span id="L-3599"><a href="#L-3599"><span class="linenos">3599</span></a>        <span class="p">)</span>
</span><span id="L-3600"><a href="#L-3600"><span class="linenos">3600</span></a>        <span class="n">writer</span><span class="o">.</span><span class="n">sheets</span><span class="p">[</span><span class="s2">&quot;Trades&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">conditional_format</span><span class="p">(</span>
</span><span id="L-3601"><a href="#L-3601"><span class="linenos">3601</span></a>            <span class="s2">&quot;X2:AB&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">trades</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="L-3602"><a href="#L-3602"><span class="linenos">3602</span></a>            <span class="p">{</span>
</span><span id="L-3603"><a href="#L-3603"><span class="linenos">3603</span></a>                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;3_color_scale&quot;</span><span class="p">,</span>
</span><span id="L-3604"><a href="#L-3604"><span class="linenos">3604</span></a>                <span class="s2">&quot;min_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FF6347&quot;</span><span class="p">,</span>
</span><span id="L-3605"><a href="#L-3605"><span class="linenos">3605</span></a>                <span class="s2">&quot;mid_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FFD700&quot;</span><span class="p">,</span>
</span><span id="L-3606"><a href="#L-3606"><span class="linenos">3606</span></a>                <span class="s2">&quot;max_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#3CB371&quot;</span><span class="p">,</span>
</span><span id="L-3607"><a href="#L-3607"><span class="linenos">3607</span></a>            <span class="p">},</span>
</span><span id="L-3608"><a href="#L-3608"><span class="linenos">3608</span></a>        <span class="p">)</span>
</span><span id="L-3609"><a href="#L-3609"><span class="linenos">3609</span></a>        <span class="n">writer</span><span class="o">.</span><span class="n">sheets</span><span class="p">[</span><span class="s2">&quot;Trades&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">conditional_format</span><span class="p">(</span>
</span><span id="L-3610"><a href="#L-3610"><span class="linenos">3610</span></a>            <span class="s2">&quot;AC2:AC&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">trades</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="L-3611"><a href="#L-3611"><span class="linenos">3611</span></a>            <span class="p">{</span>
</span><span id="L-3612"><a href="#L-3612"><span class="linenos">3612</span></a>                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;3_color_scale&quot;</span><span class="p">,</span>
</span><span id="L-3613"><a href="#L-3613"><span class="linenos">3613</span></a>                <span class="s2">&quot;min_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FF6347&quot;</span><span class="p">,</span>
</span><span id="L-3614"><a href="#L-3614"><span class="linenos">3614</span></a>                <span class="s2">&quot;mid_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FFD700&quot;</span><span class="p">,</span>
</span><span id="L-3615"><a href="#L-3615"><span class="linenos">3615</span></a>                <span class="s2">&quot;max_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#3CB371&quot;</span><span class="p">,</span>
</span><span id="L-3616"><a href="#L-3616"><span class="linenos">3616</span></a>            <span class="p">},</span>
</span><span id="L-3617"><a href="#L-3617"><span class="linenos">3617</span></a>        <span class="p">)</span>
</span><span id="L-3618"><a href="#L-3618"><span class="linenos">3618</span></a>
</span><span id="L-3619"><a href="#L-3619"><span class="linenos">3619</span></a>    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">deltas</span><span class="p">:</span>
</span><span id="L-3620"><a href="#L-3620"><span class="linenos">3620</span></a>        <span class="n">deltas</span> <span class="o">=</span> <span class="n">league</span><span class="o">.</span><span class="n">perGameDelta</span><span class="p">(</span><span class="n">payouts</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">payouts</span><span class="p">)</span>
</span><span id="L-3621"><a href="#L-3621"><span class="linenos">3621</span></a>        <span class="n">writer</span> <span class="o">=</span> <span class="n">excelAutofit</span><span class="p">(</span><span class="n">deltas</span><span class="p">,</span> <span class="s2">&quot;Deltas&quot;</span><span class="p">,</span> <span class="n">writer</span><span class="p">)</span>
</span><span id="L-3622"><a href="#L-3622"><span class="linenos">3622</span></a>        <span class="n">writer</span><span class="o">.</span><span class="n">sheets</span><span class="p">[</span><span class="s2">&quot;Deltas&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">conditional_format</span><span class="p">(</span>
</span><span id="L-3623"><a href="#L-3623"><span class="linenos">3623</span></a>            <span class="s2">&quot;B2:&quot;</span> <span class="o">+</span> <span class="nb">chr</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">deltas</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">deltas</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="L-3624"><a href="#L-3624"><span class="linenos">3624</span></a>            <span class="p">{</span>
</span><span id="L-3625"><a href="#L-3625"><span class="linenos">3625</span></a>                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;3_color_scale&quot;</span><span class="p">,</span>
</span><span id="L-3626"><a href="#L-3626"><span class="linenos">3626</span></a>                <span class="s2">&quot;min_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FF6347&quot;</span><span class="p">,</span>
</span><span id="L-3627"><a href="#L-3627"><span class="linenos">3627</span></a>                <span class="s2">&quot;mid_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FFD700&quot;</span><span class="p">,</span>
</span><span id="L-3628"><a href="#L-3628"><span class="linenos">3628</span></a>                <span class="s2">&quot;max_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#3CB371&quot;</span><span class="p">,</span>
</span><span id="L-3629"><a href="#L-3629"><span class="linenos">3629</span></a>            <span class="p">},</span>
</span><span id="L-3630"><a href="#L-3630"><span class="linenos">3630</span></a>        <span class="p">)</span>
</span><span id="L-3631"><a href="#L-3631"><span class="linenos">3631</span></a>
</span><span id="L-3632"><a href="#L-3632"><span class="linenos">3632</span></a>    <span class="n">writer</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-3633"><a href="#L-3633"><span class="linenos">3633</span></a>    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span>
</span><span id="L-3634"><a href="#L-3634"><span class="linenos">3634</span></a>        <span class="s1">&#39;touch -t </span><span class="si">{}</span><span class="s1"> &quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="L-3635"><a href="#L-3635"><span class="linenos">3635</span></a>            <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">%H%M&quot;</span><span class="p">),</span>
</span><span id="L-3636"><a href="#L-3636"><span class="linenos">3636</span></a>            <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]),</span>
</span><span id="L-3637"><a href="#L-3637"><span class="linenos">3637</span></a>        <span class="p">)</span>
</span><span id="L-3638"><a href="#L-3638"><span class="linenos">3638</span></a>    <span class="p">)</span>
</span><span id="L-3639"><a href="#L-3639"><span class="linenos">3639</span></a>    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">email</span><span class="p">:</span>
</span><span id="L-3640"><a href="#L-3640"><span class="linenos">3640</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-3641"><a href="#L-3641"><span class="linenos">3641</span></a>            <span class="n">sendEmail</span><span class="p">(</span>
</span><span id="L-3642"><a href="#L-3642"><span class="linenos">3642</span></a>                <span class="s2">&quot;Fantasy Football Projections for &quot;</span> <span class="o">+</span> <span class="n">options</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span id="L-3643"><a href="#L-3643"><span class="linenos">3643</span></a>                <span class="s2">&quot;Best of luck to you this fantasy football season!!!&quot;</span><span class="p">,</span>
</span><span id="L-3644"><a href="#L-3644"><span class="linenos">3644</span></a>                <span class="n">options</span><span class="o">.</span><span class="n">email</span><span class="p">,</span>
</span><span id="L-3645"><a href="#L-3645"><span class="linenos">3645</span></a>                <span class="n">options</span><span class="o">.</span><span class="n">output</span>
</span><span id="L-3646"><a href="#L-3646"><span class="linenos">3646</span></a>                <span class="o">+</span> <span class="s2">&quot;FantasyFootballProjections_</span><span class="si">{}</span><span class="s2">Week</span><span class="si">{}</span><span class="s2">.xlsx&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="L-3647"><a href="#L-3647"><span class="linenos">3647</span></a>                    <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%A&quot;</span><span class="p">),</span> <span class="n">league</span><span class="o">.</span><span class="n">week</span>
</span><span id="L-3648"><a href="#L-3648"><span class="linenos">3648</span></a>                <span class="p">),</span>
</span><span id="L-3649"><a href="#L-3649"><span class="linenos">3649</span></a>            <span class="p">)</span>
</span><span id="L-3650"><a href="#L-3650"><span class="linenos">3650</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="L-3651"><a href="#L-3651"><span class="linenos">3651</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="L-3652"><a href="#L-3652"><span class="linenos">3652</span></a>                <span class="s2">&quot;Couldn&#39;t email results, maybe no wifi...</span><span class="se">\n</span><span class="s2">Results saved to &quot;</span>
</span><span id="L-3653"><a href="#L-3653"><span class="linenos">3653</span></a>                <span class="o">+</span> <span class="n">options</span><span class="o">.</span><span class="n">output</span>
</span><span id="L-3654"><a href="#L-3654"><span class="linenos">3654</span></a>                <span class="o">+</span> <span class="s2">&quot;FantasyFootballProjections_</span><span class="si">{}</span><span class="s2">Week</span><span class="si">{}</span><span class="s2">.xlsx&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="L-3655"><a href="#L-3655"><span class="linenos">3655</span></a>                    <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%A&quot;</span><span class="p">),</span> <span class="n">league</span><span class="o">.</span><span class="n">week</span>
</span><span id="L-3656"><a href="#L-3656"><span class="linenos">3656</span></a>                <span class="p">)</span>
</span><span id="L-3657"><a href="#L-3657"><span class="linenos">3657</span></a>            <span class="p">)</span>
</span><span id="L-3658"><a href="#L-3658"><span class="linenos">3658</span></a>
</span><span id="L-3659"><a href="#L-3659"><span class="linenos">3659</span></a>
</span><span id="L-3660"><a href="#L-3660"><span class="linenos">3660</span></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="L-3661"><a href="#L-3661"><span class="linenos">3661</span></a>    <span class="n">main</span><span class="p">()</span>
</span></pre></div>


            </section>
                <section id="League">
                            <input id="League-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">League</span>:

                <label class="view-source-button" for="League-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#League"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="League-34"><a href="#League-34"><span class="linenos">  34</span></a><span class="k">class</span> <span class="nc">League</span><span class="p">:</span>
</span><span id="League-35"><a href="#League-35"><span class="linenos">  35</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="League-36"><a href="#League-36"><span class="linenos">  36</span></a><span class="sd">    League class that gathers all relevant settings and statistics</span>
</span><span id="League-37"><a href="#League-37"><span class="linenos">  37</span></a><span class="sd">    to simulate and assess the fantasy league in question.</span>
</span><span id="League-38"><a href="#League-38"><span class="linenos">  38</span></a>
</span><span id="League-39"><a href="#League-39"><span class="linenos">  39</span></a><span class="sd">    Attributes:  </span>
</span><span id="League-40"><a href="#League-40"><span class="linenos">  40</span></a><span class="sd">        season: integer specifying the season of interest  </span>
</span><span id="League-41"><a href="#League-41"><span class="linenos">  41</span></a><span class="sd">        week: integer specifiying the week of interest  </span>
</span><span id="League-42"><a href="#League-42"><span class="linenos">  42</span></a><span class="sd">        oauth: yahoo_oauth object contain user credentials and auth tokens  </span>
</span><span id="League-43"><a href="#League-43"><span class="linenos">  43</span></a><span class="sd">        lg: yahoo_fantasy_api league object used to connect to Yahoo&#39;s API  </span>
</span><span id="League-44"><a href="#League-44"><span class="linenos">  44</span></a><span class="sd">        gm: yahoo_fantasy_api game object used to connect to Yahoo&#39;s API  </span>
</span><span id="League-45"><a href="#League-45"><span class="linenos">  45</span></a><span class="sd">        name: string specifying the name of the fantasy to be analyzed  </span>
</span><span id="League-46"><a href="#League-46"><span class="linenos">  46</span></a><span class="sd">        settings: dictionary containing the scheduling and roster settings for the league in question  </span>
</span><span id="League-47"><a href="#League-47"><span class="linenos">  47</span></a><span class="sd">        scoring: dictionary containing the scoring categories and values for the league in question  </span>
</span><span id="League-48"><a href="#League-48"><span class="linenos">  48</span></a><span class="sd">        teams: list of dictionaries containing identifiers for each fantasy team in the league  </span>
</span><span id="League-49"><a href="#League-49"><span class="linenos">  49</span></a><span class="sd">        nfl_teams: dataframe containing different identifiers for each NFL team  </span>
</span><span id="League-50"><a href="#League-50"><span class="linenos">  50</span></a><span class="sd">        nfl_schedule: dataframe containing NFL schedules throughout the years with elo statistics for both teams  </span>
</span><span id="League-51"><a href="#League-51"><span class="linenos">  51</span></a><span class="sd">        players: dataframe containing demographics and rates for current NFL players  </span>
</span><span id="League-52"><a href="#League-52"><span class="linenos">  52</span></a><span class="sd">        num_sims: integer specifying the number of Monte Carlo simulations to run  </span>
</span><span id="League-53"><a href="#League-53"><span class="linenos">  53</span></a><span class="sd">        earliest: integer describing the earliest week to pull statistics from (YYYYWW)  </span>
</span><span id="League-54"><a href="#League-54"><span class="linenos">  54</span></a><span class="sd">        reference_games: integer describing the number of games to use as a prior for rates  </span>
</span><span id="League-55"><a href="#League-55"><span class="linenos">  55</span></a><span class="sd">        basaloppstringtime: list of the four weighting factors when calculating rates  </span>
</span><span id="League-56"><a href="#League-56"><span class="linenos">  56</span></a><span class="sd">        schedule: dataframe containing the fantasy schedule for the league and season in question</span>
</span><span id="League-57"><a href="#League-57"><span class="linenos">  57</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="League-58"><a href="#League-58"><span class="linenos">  58</span></a>
</span><span id="League-59"><a href="#League-59"><span class="linenos">  59</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="League-60"><a href="#League-60"><span class="linenos">  60</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="League-61"><a href="#League-61"><span class="linenos">  61</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="League-62"><a href="#League-62"><span class="linenos">  62</span></a>        <span class="n">season</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="League-63"><a href="#League-63"><span class="linenos">  63</span></a>        <span class="n">week</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="League-64"><a href="#League-64"><span class="linenos">  64</span></a>        <span class="n">injurytries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="League-65"><a href="#League-65"><span class="linenos">  65</span></a>        <span class="n">num_sims</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">,</span>
</span><span id="League-66"><a href="#League-66"><span class="linenos">  66</span></a>        <span class="n">earliest</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="League-67"><a href="#League-67"><span class="linenos">  67</span></a>        <span class="n">reference_games</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="League-68"><a href="#League-68"><span class="linenos">  68</span></a>        <span class="n">basaloppstringtime</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[],</span>
</span><span id="League-69"><a href="#League-69"><span class="linenos">  69</span></a>        <span class="n">sfb</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="League-70"><a href="#League-70"><span class="linenos">  70</span></a>        <span class="n">bestball</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="League-71"><a href="#League-71"><span class="linenos">  71</span></a>    <span class="p">):</span>
</span><span id="League-72"><a href="#League-72"><span class="linenos">  72</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="League-73"><a href="#League-73"><span class="linenos">  73</span></a><span class="sd">        Initializes a League object using the parameters provided and class functions defined below.</span>
</span><span id="League-74"><a href="#League-74"><span class="linenos">  74</span></a>
</span><span id="League-75"><a href="#League-75"><span class="linenos">  75</span></a><span class="sd">        Args:</span>
</span><span id="League-76"><a href="#League-76"><span class="linenos">  76</span></a><span class="sd">            name (str, optional): string describing the name of the fantasy team in question, defaults to None.  </span>
</span><span id="League-77"><a href="#League-77"><span class="linenos">  77</span></a><span class="sd">            season (int, optional): integer specifying the season of interest, defaults to None.  </span>
</span><span id="League-78"><a href="#League-78"><span class="linenos">  78</span></a><span class="sd">            week (int, optional): integer specifiying the week of interest, defaults to None.  </span>
</span><span id="League-79"><a href="#League-79"><span class="linenos">  79</span></a><span class="sd">            injurytries (int, optional): integer specifying the number of attempts to pull injury statuses, defaults to 10.  </span>
</span><span id="League-80"><a href="#League-80"><span class="linenos">  80</span></a><span class="sd">            num_sims (int, optional): integer specifying the number of Monte Carlo simulations to run, defaults to 10000.  </span>
</span><span id="League-81"><a href="#League-81"><span class="linenos">  81</span></a><span class="sd">            earliest (int, optional): integer describing the earliest week to pull statistics from (YYYYWW), defaults to None.  </span>
</span><span id="League-82"><a href="#League-82"><span class="linenos">  82</span></a><span class="sd">            reference_games (int, optional): integer describing the number of games to use as a prior for rates, defaults to None.  </span>
</span><span id="League-83"><a href="#League-83"><span class="linenos">  83</span></a><span class="sd">            basaloppstringtime (list, optional): list of the four weighting factors when calculating rates, defaults to an empty list.  </span>
</span><span id="League-84"><a href="#League-84"><span class="linenos">  84</span></a><span class="sd">            sfb (bool, optional): whether to implement SFB13 settings and scoring, defaults to False.  </span>
</span><span id="League-85"><a href="#League-85"><span class="linenos">  85</span></a><span class="sd">            bestball (str, optional): which platform to use when implementing best ball settings/scoring, defaults to a blank string (no bestball).</span>
</span><span id="League-86"><a href="#League-86"><span class="linenos">  86</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="League-87"><a href="#League-87"><span class="linenos">  87</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">latest_season</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">year</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">month</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">)</span>
</span><span id="League-88"><a href="#League-88"><span class="linenos">  88</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Year of the most recent season &quot;&quot;&quot;</span>
</span><span id="League-89"><a href="#League-89"><span class="linenos">  89</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">season</span> <span class="o">=</span> <span class="n">season</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">season</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">latest_season</span>
</span><span id="League-90"><a href="#League-90"><span class="linenos">  90</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Season of interest, defaults to most recent season when no value is provided &quot;&quot;&quot;</span>
</span><span id="League-91"><a href="#League-91"><span class="linenos">  91</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">load_credentials</span><span class="p">()</span>
</span><span id="League-92"><a href="#League-92"><span class="linenos">  92</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">load_oauth</span><span class="p">()</span>
</span><span id="League-93"><a href="#League-93"><span class="linenos">  93</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">load_league</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</span><span id="League-94"><a href="#League-94"><span class="linenos">  94</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">current_week</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lg</span><span class="o">.</span><span class="n">current_week</span><span class="p">()</span>
</span><span id="League-95"><a href="#League-95"><span class="linenos">  95</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Most recent week of the season of interest &quot;&quot;&quot;</span>
</span><span id="League-96"><a href="#League-96"><span class="linenos">  96</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">week</span> <span class="o">=</span> <span class="n">week</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">week</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_week</span>
</span><span id="League-97"><a href="#League-97"><span class="linenos">  97</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Week of interest during the season of interest, defaults to most recent week &quot;&quot;&quot;</span>
</span><span id="League-98"><a href="#League-98"><span class="linenos">  98</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">load_settings</span><span class="p">(</span><span class="n">sfb</span><span class="p">,</span> <span class="n">bestball</span><span class="p">)</span>
</span><span id="League-99"><a href="#League-99"><span class="linenos">  99</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">load_fantasy_teams</span><span class="p">()</span>
</span><span id="League-100"><a href="#League-100"><span class="linenos"> 100</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">load_nfl_abbrevs</span><span class="p">()</span>
</span><span id="League-101"><a href="#League-101"><span class="linenos"> 101</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">load_nfl_schedule</span><span class="p">()</span>
</span><span id="League-102"><a href="#League-102"><span class="linenos"> 102</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">get_yahoo_players</span><span class="p">(</span><span class="n">injurytries</span><span class="p">)</span>
</span><span id="League-103"><a href="#League-103"><span class="linenos"> 103</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">get_fantasy_rosters</span><span class="p">()</span>
</span><span id="League-104"><a href="#League-104"><span class="linenos"> 104</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name_corrections</span><span class="p">()</span>
</span><span id="League-105"><a href="#League-105"><span class="linenos"> 105</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">get_player_ids</span><span class="p">()</span>
</span><span id="League-106"><a href="#League-106"><span class="linenos"> 106</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_injuries</span><span class="p">()</span>
</span><span id="League-107"><a href="#League-107"><span class="linenos"> 107</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_bye_weeks</span><span class="p">()</span>
</span><span id="League-108"><a href="#League-108"><span class="linenos"> 108</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_roster_pcts</span><span class="p">()</span>
</span><span id="League-109"><a href="#League-109"><span class="linenos"> 109</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_depth_charts</span><span class="p">()</span>
</span><span id="League-110"><a href="#League-110"><span class="linenos"> 110</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">load_parameters</span><span class="p">(</span><span class="n">earliest</span><span class="p">,</span> <span class="n">reference_games</span><span class="p">,</span> <span class="n">basaloppstringtime</span><span class="p">)</span>
</span><span id="League-111"><a href="#League-111"><span class="linenos"> 111</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">num_sims</span> <span class="o">=</span> <span class="n">num_sims</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">num_sims</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span> <span class="k">else</span> <span class="mi">10000</span>
</span><span id="League-112"><a href="#League-112"><span class="linenos"> 112</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Number of simulations to run when assessing the league of interest &quot;&quot;&quot;</span>
</span><span id="League-113"><a href="#League-113"><span class="linenos"> 113</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">get_rates</span><span class="p">()</span>
</span><span id="League-114"><a href="#League-114"><span class="linenos"> 114</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">war_sim</span><span class="p">()</span>
</span><span id="League-115"><a href="#League-115"><span class="linenos"> 115</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">get_schedule</span><span class="p">()</span>
</span><span id="League-116"><a href="#League-116"><span class="linenos"> 116</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">starters</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">week</span><span class="p">)</span>
</span><span id="League-117"><a href="#League-117"><span class="linenos"> 117</span></a>
</span><span id="League-118"><a href="#League-118"><span class="linenos"> 118</span></a>    <span class="k">def</span> <span class="nf">load_credentials</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="League-119"><a href="#League-119"><span class="linenos"> 119</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="League-120"><a href="#League-120"><span class="linenos"> 120</span></a><span class="sd">        Loads user credentials from the .env file, specifically the Yahoo consumer key/secret</span>
</span><span id="League-121"><a href="#League-121"><span class="linenos"> 121</span></a><span class="sd">        and email credentials to use when emailing a copy of the results to the user.</span>
</span><span id="League-122"><a href="#League-122"><span class="linenos"> 122</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="League-123"><a href="#League-123"><span class="linenos"> 123</span></a>        <span class="c1"># Loading Yahoo OAuth credentials from environment variables</span>
</span><span id="League-124"><a href="#League-124"><span class="linenos"> 124</span></a>        <span class="n">load_dotenv</span><span class="p">()</span>
</span><span id="League-125"><a href="#League-125"><span class="linenos"> 125</span></a>        <span class="k">if</span> <span class="s2">&quot;CONSUMER_KEY&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span> <span class="ow">or</span> <span class="s2">&quot;CONSUMER_SECRET&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
</span><span id="League-126"><a href="#League-126"><span class="linenos"> 126</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No valid .env file present, copying from .env.example&quot;</span><span class="p">)</span>
</span><span id="League-127"><a href="#League-127"><span class="linenos"> 127</span></a>            <span class="n">shutil</span><span class="o">.</span><span class="n">copyfile</span><span class="p">(</span><span class="s2">&quot;.env.example&quot;</span><span class="p">,</span> <span class="s2">&quot;.env&quot;</span><span class="p">)</span>
</span><span id="League-128"><a href="#League-128"><span class="linenos"> 128</span></a>        <span class="c1"># Updating .env file if default values are still present</span>
</span><span id="League-129"><a href="#League-129"><span class="linenos"> 129</span></a>        <span class="k">if</span> <span class="p">(</span>
</span><span id="League-130"><a href="#League-130"><span class="linenos"> 130</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;CONSUMER_KEY&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;updatekey&quot;</span>
</span><span id="League-131"><a href="#League-131"><span class="linenos"> 131</span></a>            <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;CONSUMER_SECRET&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;updatesecret&quot;</span>
</span><span id="League-132"><a href="#League-132"><span class="linenos"> 132</span></a>        <span class="p">):</span>
</span><span id="League-133"><a href="#League-133"><span class="linenos"> 133</span></a>            <span class="c1"># Only have to do this once since we&#39;re storing them in environment variables</span>
</span><span id="League-134"><a href="#League-134"><span class="linenos"> 134</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;It appears you haven&#39;t updated your Yahoo OAuth credentials...&quot;</span><span class="p">)</span>
</span><span id="League-135"><a href="#League-135"><span class="linenos"> 135</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;To get credentials: https://developer.yahoo.com/apps/create/&quot;</span><span class="p">)</span>
</span><span id="League-136"><a href="#League-136"><span class="linenos"> 136</span></a>            <span class="n">consumer_key</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Yahoo OAuth Key: &quot;</span><span class="p">)</span>
</span><span id="League-137"><a href="#League-137"><span class="linenos"> 137</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;sed -i &#39;s/updatekey/</span><span class="si">{}</span><span class="s2">/g&#39; .env&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">consumer_key</span><span class="p">))</span>
</span><span id="League-138"><a href="#League-138"><span class="linenos"> 138</span></a>            <span class="n">consumer_secret</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Yahoo OAuth Secret: &quot;</span><span class="p">)</span>
</span><span id="League-139"><a href="#League-139"><span class="linenos"> 139</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;sed -i &#39;s/updatesecret/</span><span class="si">{}</span><span class="s2">/g&#39; .env&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">consumer_secret</span><span class="p">))</span>
</span><span id="League-140"><a href="#League-140"><span class="linenos"> 140</span></a>            <span class="n">load_dotenv</span><span class="p">()</span>
</span><span id="League-141"><a href="#League-141"><span class="linenos"> 141</span></a>            <span class="c1"># Previous oauth file is probably bad if it exists, deleting it just in case</span>
</span><span id="League-142"><a href="#League-142"><span class="linenos"> 142</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;oauth2.json&quot;</span><span class="p">):</span>
</span><span id="League-143"><a href="#League-143"><span class="linenos"> 143</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;oauth.json&quot;</span><span class="p">)</span>
</span><span id="League-144"><a href="#League-144"><span class="linenos"> 144</span></a>
</span><span id="League-145"><a href="#League-145"><span class="linenos"> 145</span></a>    <span class="k">def</span> <span class="nf">load_oauth</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="League-146"><a href="#League-146"><span class="linenos"> 146</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="League-147"><a href="#League-147"><span class="linenos"> 147</span></a><span class="sd">        Initializes an OAuth2 authentication object to connect with Yahoo&#39;s API</span>
</span><span id="League-148"><a href="#League-148"><span class="linenos"> 148</span></a><span class="sd">        using the credentials loaded above in the load_credentials function.</span>
</span><span id="League-149"><a href="#League-149"><span class="linenos"> 149</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="League-150"><a href="#League-150"><span class="linenos"> 150</span></a>        <span class="c1"># Creating oauth file from credentials provided</span>
</span><span id="League-151"><a href="#League-151"><span class="linenos"> 151</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;oauth2.json&quot;</span><span class="p">):</span>
</span><span id="League-152"><a href="#League-152"><span class="linenos"> 152</span></a>            <span class="n">creds</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="League-153"><a href="#League-153"><span class="linenos"> 153</span></a>                <span class="s2">&quot;consumer_key&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;CONSUMER_KEY&quot;</span><span class="p">],</span>
</span><span id="League-154"><a href="#League-154"><span class="linenos"> 154</span></a>                <span class="s2">&quot;consumer_secret&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;CONSUMER_SECRET&quot;</span><span class="p">],</span>
</span><span id="League-155"><a href="#League-155"><span class="linenos"> 155</span></a>            <span class="p">}</span>
</span><span id="League-156"><a href="#League-156"><span class="linenos"> 156</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;oauth2.json&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="League-157"><a href="#League-157"><span class="linenos"> 157</span></a>                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">creds</span><span class="p">))</span>
</span><span id="League-158"><a href="#League-158"><span class="linenos"> 158</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">oauth</span> <span class="o">=</span> <span class="n">OAuth2</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">from_file</span><span class="o">=</span><span class="s2">&quot;oauth2.json&quot;</span><span class="p">)</span>
</span><span id="League-159"><a href="#League-159"><span class="linenos"> 159</span></a>
</span><span id="League-160"><a href="#League-160"><span class="linenos"> 160</span></a>    <span class="k">def</span> <span class="nf">load_league</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="League-161"><a href="#League-161"><span class="linenos"> 161</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="League-162"><a href="#League-162"><span class="linenos"> 162</span></a><span class="sd">        Initializes yahoo_fantasy_api game and league objects used to query Yahoo&#39;s API</span>
</span><span id="League-163"><a href="#League-163"><span class="linenos"> 163</span></a><span class="sd">        for details about the league in question. Also identifies fantasy team name and </span>
</span><span id="League-164"><a href="#League-164"><span class="linenos"> 164</span></a><span class="sd">        fantasy league id for future reference throughout the script.</span>
</span><span id="League-165"><a href="#League-165"><span class="linenos"> 165</span></a>
</span><span id="League-166"><a href="#League-166"><span class="linenos"> 166</span></a><span class="sd">        Args:</span>
</span><span id="League-167"><a href="#League-167"><span class="linenos"> 167</span></a><span class="sd">            name (str, optional): string specifiying the name of the team of interest </span>
</span><span id="League-168"><a href="#League-168"><span class="linenos"> 168</span></a><span class="sd">            in case a user has multiple leagues, defaults to None.</span>
</span><span id="League-169"><a href="#League-169"><span class="linenos"> 169</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="League-170"><a href="#League-170"><span class="linenos"> 170</span></a>        <span class="c1"># Pulling user&#39;s Yahoo fantasy games</span>
</span><span id="League-171"><a href="#League-171"><span class="linenos"> 171</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gm</span> <span class="o">=</span> <span class="n">yfa</span><span class="o">.</span><span class="n">Game</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">oauth</span><span class="p">,</span> <span class="s2">&quot;nfl&quot;</span><span class="p">)</span>
</span><span id="League-172"><a href="#League-172"><span class="linenos"> 172</span></a>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="League-173"><a href="#League-173"><span class="linenos"> 173</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="League-174"><a href="#League-174"><span class="linenos"> 174</span></a>                <span class="n">profile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gm</span><span class="o">.</span><span class="n">yhandler</span><span class="o">.</span><span class="n">get_teams_raw</span><span class="p">()[</span><span class="s2">&quot;fantasy_content&quot;</span><span class="p">]</span>
</span><span id="League-175"><a href="#League-175"><span class="linenos"> 175</span></a>                <span class="n">leagues</span> <span class="o">=</span> <span class="n">profile</span><span class="p">[</span><span class="s2">&quot;users&quot;</span><span class="p">][</span><span class="s2">&quot;0&quot;</span><span class="p">][</span><span class="s2">&quot;user&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;games&quot;</span><span class="p">]</span>
</span><span id="League-176"><a href="#League-176"><span class="linenos"> 176</span></a>                <span class="k">break</span>
</span><span id="League-177"><a href="#League-177"><span class="linenos"> 177</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="League-178"><a href="#League-178"><span class="linenos"> 178</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="League-179"><a href="#League-179"><span class="linenos"> 179</span></a>                    <span class="s2">&quot;Teams query crapped out... Waiting 30 seconds and trying again...&quot;</span>
</span><span id="League-180"><a href="#League-180"><span class="linenos"> 180</span></a>                <span class="p">)</span>
</span><span id="League-181"><a href="#League-181"><span class="linenos"> 181</span></a>                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
</span><span id="League-182"><a href="#League-182"><span class="linenos"> 182</span></a>        <span class="c1"># Identifying user&#39;s NFL Yahoo fantasy games</span>
</span><span id="League-183"><a href="#League-183"><span class="linenos"> 183</span></a>        <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">leagues</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="League-184"><a href="#League-184"><span class="linenos"> 184</span></a>            <span class="n">game</span> <span class="o">=</span> <span class="n">leagues</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">ind</span><span class="p">)][</span><span class="s2">&quot;game&quot;</span><span class="p">]</span>
</span><span id="League-185"><a href="#League-185"><span class="linenos"> 185</span></a>            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">game</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="League-186"><a href="#League-186"><span class="linenos"> 186</span></a>                <span class="k">continue</span>
</span><span id="League-187"><a href="#League-187"><span class="linenos"> 187</span></a>            <span class="k">if</span> <span class="n">game</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;code&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;nfl&quot;</span> <span class="ow">and</span> <span class="n">game</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;season&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">season</span><span class="p">):</span>
</span><span id="League-188"><a href="#League-188"><span class="linenos"> 188</span></a>                <span class="n">teams</span> <span class="o">=</span> <span class="n">game</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;teams&quot;</span><span class="p">]</span>
</span><span id="League-189"><a href="#League-189"><span class="linenos"> 189</span></a>                <span class="n">details</span> <span class="o">=</span> <span class="p">[</span><span class="n">teams</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">ind</span><span class="p">)][</span><span class="s2">&quot;team&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">teams</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">])]</span>
</span><span id="League-190"><a href="#League-190"><span class="linenos"> 190</span></a>                <span class="n">names</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="League-191"><a href="#League-191"><span class="linenos"> 191</span></a>                    <span class="p">[</span><span class="n">val</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">team</span> <span class="k">if</span> <span class="s2">&quot;name&quot;</span> <span class="ow">in</span> <span class="n">val</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League-192"><a href="#League-192"><span class="linenos"> 192</span></a>                    <span class="k">for</span> <span class="n">team</span> <span class="ow">in</span> <span class="n">details</span>
</span><span id="League-193"><a href="#League-193"><span class="linenos"> 193</span></a>                <span class="p">]</span>
</span><span id="League-194"><a href="#League-194"><span class="linenos"> 194</span></a>                <span class="k">if</span> <span class="n">teams</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="League-195"><a href="#League-195"><span class="linenos"> 195</span></a>                    <span class="c1"># If user has more than one team, use the name input or prompt them to pick one</span>
</span><span id="League-196"><a href="#League-196"><span class="linenos"> 196</span></a>                    <span class="k">while</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
</span><span id="League-197"><a href="#League-197"><span class="linenos"> 197</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Found multiple fantasy teams: &quot;</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">names</span><span class="p">))</span>
</span><span id="League-198"><a href="#League-198"><span class="linenos"> 198</span></a>                        <span class="n">name</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Which team would you like to analyze? &quot;</span><span class="p">)</span>
</span><span id="League-199"><a href="#League-199"><span class="linenos"> 199</span></a>                    <span class="n">team</span> <span class="o">=</span> <span class="n">teams</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">name</span><span class="p">))][</span><span class="s2">&quot;team&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League-200"><a href="#League-200"><span class="linenos"> 200</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="League-201"><a href="#League-201"><span class="linenos"> 201</span></a>                    <span class="c1"># If user has only one team, use that one and override whatever name was given</span>
</span><span id="League-202"><a href="#League-202"><span class="linenos"> 202</span></a>                    <span class="n">team</span> <span class="o">=</span> <span class="n">teams</span><span class="p">[</span><span class="s2">&quot;0&quot;</span><span class="p">][</span><span class="s2">&quot;team&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League-203"><a href="#League-203"><span class="linenos"> 203</span></a>                    <span class="n">name</span> <span class="o">=</span> <span class="n">names</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League-204"><a href="#League-204"><span class="linenos"> 204</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="League-205"><a href="#League-205"><span class="linenos"> 205</span></a>                <span class="n">team_key</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span><span class="p">[</span><span class="s2">&quot;team_key&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">team</span> <span class="k">if</span> <span class="s2">&quot;team_key&quot;</span> <span class="ow">in</span> <span class="n">val</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League-206"><a href="#League-206"><span class="linenos"> 206</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">lg_id</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">team_key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[:</span><span class="mi">3</span><span class="p">])</span>
</span><span id="League-207"><a href="#League-207"><span class="linenos"> 207</span></a>                <span class="k">break</span>
</span><span id="League-208"><a href="#League-208"><span class="linenos"> 208</span></a>        <span class="c1"># Creating league object</span>
</span><span id="League-209"><a href="#League-209"><span class="linenos"> 209</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gm</span><span class="o">.</span><span class="n">to_league</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lg_id</span><span class="p">)</span>
</span><span id="League-210"><a href="#League-210"><span class="linenos"> 210</span></a>
</span><span id="League-211"><a href="#League-211"><span class="linenos"> 211</span></a>    <span class="k">def</span> <span class="nf">load_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sfb</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">bestball</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
</span><span id="League-212"><a href="#League-212"><span class="linenos"> 212</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="League-213"><a href="#League-213"><span class="linenos"> 213</span></a><span class="sd">        Pulls league roster/schedule settings and scoring modifiers</span>
</span><span id="League-214"><a href="#League-214"><span class="linenos"> 214</span></a>
</span><span id="League-215"><a href="#League-215"><span class="linenos"> 215</span></a><span class="sd">        Args:</span>
</span><span id="League-216"><a href="#League-216"><span class="linenos"> 216</span></a><span class="sd">            sfb (bool, optional): whether to use Scott Fish Bowl 13 settings, defaults to False.  </span>
</span><span id="League-217"><a href="#League-217"><span class="linenos"> 217</span></a><span class="sd">            bestball (str, optional): which best ball settings to use if desired, defaults to &quot;&quot; (redraft).</span>
</span><span id="League-218"><a href="#League-218"><span class="linenos"> 218</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="League-219"><a href="#League-219"><span class="linenos"> 219</span></a>        <span class="c1"># Pulling league settings</span>
</span><span id="League-220"><a href="#League-220"><span class="linenos"> 220</span></a>        <span class="n">settings_json</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lg</span><span class="o">.</span><span class="n">yhandler</span><span class="o">.</span><span class="n">get_settings_raw</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lg_id</span><span class="p">)</span>
</span><span id="League-221"><a href="#League-221"><span class="linenos"> 221</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span> <span class="o">=</span> <span class="n">settings_json</span><span class="p">[</span><span class="s2">&quot;fantasy_content&quot;</span><span class="p">][</span><span class="s2">&quot;league&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;settings&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League-222"><a href="#League-222"><span class="linenos"> 222</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;playoff_start_week&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;playoff_start_week&quot;</span><span class="p">])</span>
</span><span id="League-223"><a href="#League-223"><span class="linenos"> 223</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;num_playoff_teams&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;num_playoff_teams&quot;</span><span class="p">])</span>
</span><span id="League-224"><a href="#League-224"><span class="linenos"> 224</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">roster_spots</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">pos</span><span class="p">[</span><span class="s2">&quot;roster_position&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;roster_positions&quot;</span><span class="p">]])</span>
</span><span id="League-225"><a href="#League-225"><span class="linenos"> 225</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">roster_spots</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">roster_spots</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="League-226"><a href="#League-226"><span class="linenos"> 226</span></a>        <span class="n">categories</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span><span id="League-227"><a href="#League-227"><span class="linenos"> 227</span></a>            <span class="p">[</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;stat&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">stat</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;stat_categories&quot;</span><span class="p">][</span><span class="s2">&quot;stats&quot;</span><span class="p">]]</span>
</span><span id="League-228"><a href="#League-228"><span class="linenos"> 228</span></a>        <span class="p">)</span>
</span><span id="League-229"><a href="#League-229"><span class="linenos"> 229</span></a>        <span class="n">modifiers</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span><span id="League-230"><a href="#League-230"><span class="linenos"> 230</span></a>            <span class="p">[</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;stat&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">stat</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;stat_modifiers&quot;</span><span class="p">][</span><span class="s2">&quot;stats&quot;</span><span class="p">]]</span>
</span><span id="League-231"><a href="#League-231"><span class="linenos"> 231</span></a>        <span class="p">)</span>
</span><span id="League-232"><a href="#League-232"><span class="linenos"> 232</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League-233"><a href="#League-233"><span class="linenos"> 233</span></a>            <span class="n">left</span><span class="o">=</span><span class="n">categories</span><span class="p">,</span>
</span><span id="League-234"><a href="#League-234"><span class="linenos"> 234</span></a>            <span class="n">right</span><span class="o">=</span><span class="n">modifiers</span><span class="p">,</span>
</span><span id="League-235"><a href="#League-235"><span class="linenos"> 235</span></a>            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">,</span>
</span><span id="League-236"><a href="#League-236"><span class="linenos"> 236</span></a>            <span class="n">on</span><span class="o">=</span><span class="s2">&quot;stat_id&quot;</span><span class="p">,</span>
</span><span id="League-237"><a href="#League-237"><span class="linenos"> 237</span></a>        <span class="p">)[[</span><span class="s2">&quot;display_name&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">({</span><span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">})</span>
</span><span id="League-238"><a href="#League-238"><span class="linenos"> 238</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="o">.</span><span class="n">display_name</span> <span class="o">==</span> <span class="s2">&quot;Int&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="o">.</span><span class="n">value</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">),</span><span class="s2">&quot;display_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Int Thrown&quot;</span>
</span><span id="League-239"><a href="#League-239"><span class="linenos"> 239</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;display_name&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;display_name&quot;</span><span class="p">)[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
</span><span id="League-240"><a href="#League-240"><span class="linenos"> 240</span></a>        <span class="k">if</span> <span class="n">sfb</span><span class="p">:</span>
</span><span id="League-241"><a href="#League-241"><span class="linenos"> 241</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;playoff_start_week&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12</span>
</span><span id="League-242"><a href="#League-242"><span class="linenos"> 242</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;num_playoff_teams&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6</span>
</span><span id="League-243"><a href="#League-243"><span class="linenos"> 243</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Pass Yds&#39;</span><span class="p">:</span><span class="mf">0.04</span><span class="p">,</span><span class="s1">&#39;Pass Comp&#39;</span><span class="p">:</span><span class="mf">0.1</span><span class="p">,</span><span class="s1">&#39;Pass TD&#39;</span><span class="p">:</span><span class="mf">6.0</span><span class="p">,</span><span class="s1">&#39;Pass 1D&#39;</span><span class="p">:</span><span class="mf">0.1</span><span class="p">,</span><span class="s1">&#39;Pass 300+&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span>\
</span><span id="League-244"><a href="#League-244"><span class="linenos"> 244</span></a>            <span class="s1">&#39;Int Thrown&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Rush Yds&#39;</span><span class="p">:</span><span class="mf">0.1</span><span class="p">,</span><span class="s1">&#39;Rush Att&#39;</span><span class="p">:</span><span class="mf">0.25</span><span class="p">,</span><span class="s1">&#39;Rush TD&#39;</span><span class="p">:</span><span class="mf">6.0</span><span class="p">,</span><span class="s1">&#39;Rush 1D&#39;</span><span class="p">:</span><span class="mf">1.0</span><span class="p">,</span><span class="s1">&#39;Rush 100+&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span>\
</span><span id="League-245"><a href="#League-245"><span class="linenos"> 245</span></a>            <span class="s1">&#39;Rec Yds&#39;</span><span class="p">:</span><span class="mf">0.1</span><span class="p">,</span><span class="s1">&#39;Rec&#39;</span><span class="p">:</span><span class="mf">1.0</span><span class="p">,</span><span class="s1">&#39;Rec TD&#39;</span><span class="p">:</span><span class="mf">6.0</span><span class="p">,</span><span class="s1">&#39;Rec 1D&#39;</span><span class="p">:</span><span class="mf">1.0</span><span class="p">,</span><span class="s1">&#39;Rec 100+&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Ret Yds&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Ret TD&#39;</span><span class="p">:</span><span class="mf">6.0</span><span class="p">,</span>\
</span><span id="League-246"><a href="#League-246"><span class="linenos"> 246</span></a>            <span class="s1">&#39;TE Rec Bonus&#39;</span><span class="p">:</span><span class="mf">1.0</span><span class="p">,</span><span class="s1">&#39;TE 1D Bonus&#39;</span><span class="p">:</span><span class="mf">1.0</span><span class="p">,</span><span class="s1">&#39;2-PT&#39;</span><span class="p">:</span><span class="mf">2.0</span><span class="p">,</span><span class="s1">&#39;Fum Lost&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Fum Ret TD&#39;</span><span class="p">:</span><span class="mf">6.0</span><span class="p">,</span>\
</span><span id="League-247"><a href="#League-247"><span class="linenos"> 247</span></a>            <span class="s1">&#39;FG 0-19&#39;</span><span class="p">:</span><span class="mf">2.0</span><span class="p">,</span><span class="s1">&#39;FG 20-29&#39;</span><span class="p">:</span><span class="mf">2.5</span><span class="p">,</span><span class="s1">&#39;FG 30-39&#39;</span><span class="p">:</span><span class="mf">3.5</span><span class="p">,</span><span class="s1">&#39;FG 40-49&#39;</span><span class="p">:</span><span class="mf">4.5</span><span class="p">,</span><span class="s1">&#39;FG 50+&#39;</span><span class="p">:</span><span class="mf">5.5</span><span class="p">,</span><span class="s1">&#39;PAT Made&#39;</span><span class="p">:</span><span class="mf">3.3</span><span class="p">,</span>\
</span><span id="League-248"><a href="#League-248"><span class="linenos"> 248</span></a>            <span class="s1">&#39;Sack&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Int&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Fum Rec&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;TD&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Safe&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Blk Kick&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span>\
</span><span id="League-249"><a href="#League-249"><span class="linenos"> 249</span></a>            <span class="s1">&#39;Pts Allow 0&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Pts Allow 1-6&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Pts Allow 7-13&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Pts Allow 14-20&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span>\
</span><span id="League-250"><a href="#League-250"><span class="linenos"> 250</span></a>            <span class="s1">&#39;Pts Allow 21-27&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Pts Allow 28-34&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Pts Allow 35+&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;XPR&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">}</span>
</span><span id="League-251"><a href="#League-251"><span class="linenos"> 251</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">roster_spots</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;position&#39;</span><span class="p">:[</span><span class="s1">&#39;QB&#39;</span><span class="p">,</span><span class="s1">&#39;RB&#39;</span><span class="p">,</span><span class="s1">&#39;WR&#39;</span><span class="p">,</span><span class="s1">&#39;TE&#39;</span><span class="p">,</span><span class="s1">&#39;W/R/T&#39;</span><span class="p">,</span><span class="s1">&#39;Q/W/R/T&#39;</span><span class="p">,</span><span class="s1">&#39;K&#39;</span><span class="p">,</span><span class="s1">&#39;BN&#39;</span><span class="p">],</span><span class="s1">&#39;count&#39;</span><span class="p">:[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">]})</span>
</span><span id="League-252"><a href="#League-252"><span class="linenos"> 252</span></a>        <span class="k">elif</span> <span class="nb">str</span><span class="p">(</span><span class="n">bestball</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;dk&quot;</span><span class="p">,</span> <span class="s2">&quot;draftkings&quot;</span><span class="p">]:</span>
</span><span id="League-253"><a href="#League-253"><span class="linenos"> 253</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;playoff_start_week&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">14</span>
</span><span id="League-254"><a href="#League-254"><span class="linenos"> 254</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;num_playoff_teams&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="League-255"><a href="#League-255"><span class="linenos"> 255</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Pass Yds&#39;</span><span class="p">:</span><span class="mf">0.04</span><span class="p">,</span><span class="s1">&#39;Pass Comp&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Pass TD&#39;</span><span class="p">:</span><span class="mf">4.0</span><span class="p">,</span><span class="s1">&#39;Pass 1D&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Pass 300+&#39;</span><span class="p">:</span><span class="mf">3.0</span><span class="p">,</span>\
</span><span id="League-256"><a href="#League-256"><span class="linenos"> 256</span></a>            <span class="s1">&#39;Int Thrown&#39;</span><span class="p">:</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span><span class="s1">&#39;Rush Yds&#39;</span><span class="p">:</span><span class="mf">0.1</span><span class="p">,</span><span class="s1">&#39;Rush Att&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Rush TD&#39;</span><span class="p">:</span><span class="mf">6.0</span><span class="p">,</span><span class="s1">&#39;Rush 1D&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Rush 100+&#39;</span><span class="p">:</span><span class="mf">3.0</span><span class="p">,</span>\
</span><span id="League-257"><a href="#League-257"><span class="linenos"> 257</span></a>            <span class="s1">&#39;Rec Yds&#39;</span><span class="p">:</span><span class="mf">0.1</span><span class="p">,</span><span class="s1">&#39;Rec&#39;</span><span class="p">:</span><span class="mf">1.0</span><span class="p">,</span><span class="s1">&#39;Rec TD&#39;</span><span class="p">:</span><span class="mf">6.0</span><span class="p">,</span><span class="s1">&#39;Rec 1D&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Rec 100+&#39;</span><span class="p">:</span><span class="mf">3.0</span><span class="p">,</span><span class="s1">&#39;Ret Yds&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Ret TD&#39;</span><span class="p">:</span><span class="mf">6.0</span><span class="p">,</span>\
</span><span id="League-258"><a href="#League-258"><span class="linenos"> 258</span></a>            <span class="s1">&#39;TE Rec Bonus&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;TE 1D Bonus&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;2-PT&#39;</span><span class="p">:</span><span class="mf">2.0</span><span class="p">,</span><span class="s1">&#39;Fum Lost&#39;</span><span class="p">:</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span><span class="s1">&#39;Fum Ret TD&#39;</span><span class="p">:</span><span class="mf">6.0</span><span class="p">,</span>\
</span><span id="League-259"><a href="#League-259"><span class="linenos"> 259</span></a>            <span class="s1">&#39;FG 0-19&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;FG 20-29&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;FG 30-39&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;FG 40-49&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;FG 50+&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;PAT Made&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span>\
</span><span id="League-260"><a href="#League-260"><span class="linenos"> 260</span></a>            <span class="s1">&#39;Sack&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Int&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Fum Rec&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;TD&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Safe&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Blk Kick&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span>\
</span><span id="League-261"><a href="#League-261"><span class="linenos"> 261</span></a>            <span class="s1">&#39;Pts Allow 0&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Pts Allow 1-6&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Pts Allow 7-13&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Pts Allow 14-20&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span>\
</span><span id="League-262"><a href="#League-262"><span class="linenos"> 262</span></a>            <span class="s1">&#39;Pts Allow 21-27&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Pts Allow 28-34&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Pts Allow 35+&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;XPR&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">}</span>
</span><span id="League-263"><a href="#League-263"><span class="linenos"> 263</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">roster_spots</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;position&#39;</span><span class="p">:[</span><span class="s1">&#39;QB&#39;</span><span class="p">,</span><span class="s1">&#39;RB&#39;</span><span class="p">,</span><span class="s1">&#39;WR&#39;</span><span class="p">,</span><span class="s1">&#39;TE&#39;</span><span class="p">,</span><span class="s1">&#39;W/R/T&#39;</span><span class="p">,</span><span class="s1">&#39;Q/W/R/T&#39;</span><span class="p">,</span><span class="s1">&#39;K&#39;</span><span class="p">,</span><span class="s1">&#39;BN&#39;</span><span class="p">],</span><span class="s1">&#39;count&#39;</span><span class="p">:[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">12</span><span class="p">]})</span>
</span><span id="League-264"><a href="#League-264"><span class="linenos"> 264</span></a>        <span class="k">elif</span> <span class="nb">str</span><span class="p">(</span><span class="n">bestball</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;underdog&quot;</span><span class="p">]:</span>
</span><span id="League-265"><a href="#League-265"><span class="linenos"> 265</span></a>            <span class="c1"># Slow Puppy</span>
</span><span id="League-266"><a href="#League-266"><span class="linenos"> 266</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;playoff_start_week&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">14</span>
</span><span id="League-267"><a href="#League-267"><span class="linenos"> 267</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;num_playoff_teams&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="League-268"><a href="#League-268"><span class="linenos"> 268</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Pass Yds&#39;</span><span class="p">:</span><span class="mf">0.04</span><span class="p">,</span><span class="s1">&#39;Pass Comp&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Pass TD&#39;</span><span class="p">:</span><span class="mf">4.0</span><span class="p">,</span><span class="s1">&#39;Pass 1D&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Pass 300+&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span>\
</span><span id="League-269"><a href="#League-269"><span class="linenos"> 269</span></a>            <span class="s1">&#39;Int Thrown&#39;</span><span class="p">:</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span><span class="s1">&#39;Rush Yds&#39;</span><span class="p">:</span><span class="mf">0.1</span><span class="p">,</span><span class="s1">&#39;Rush Att&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Rush TD&#39;</span><span class="p">:</span><span class="mf">6.0</span><span class="p">,</span><span class="s1">&#39;Rush 1D&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Rush 100+&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span>\
</span><span id="League-270"><a href="#League-270"><span class="linenos"> 270</span></a>            <span class="s1">&#39;Rec Yds&#39;</span><span class="p">:</span><span class="mf">0.1</span><span class="p">,</span><span class="s1">&#39;Rec&#39;</span><span class="p">:</span><span class="mf">0.5</span><span class="p">,</span><span class="s1">&#39;Rec TD&#39;</span><span class="p">:</span><span class="mf">6.0</span><span class="p">,</span><span class="s1">&#39;Rec 1D&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Rec 100+&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Ret Yds&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Ret TD&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span>\
</span><span id="League-271"><a href="#League-271"><span class="linenos"> 271</span></a>            <span class="s1">&#39;TE Rec Bonus&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;TE 1D Bonus&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;2-PT&#39;</span><span class="p">:</span><span class="mf">2.0</span><span class="p">,</span><span class="s1">&#39;Fum Lost&#39;</span><span class="p">:</span><span class="o">-</span><span class="mf">2.0</span><span class="p">,</span><span class="s1">&#39;Fum Ret TD&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span>\
</span><span id="League-272"><a href="#League-272"><span class="linenos"> 272</span></a>            <span class="s1">&#39;FG 0-19&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;FG 20-29&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;FG 30-39&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;FG 40-49&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;FG 50+&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;PAT Made&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span>\
</span><span id="League-273"><a href="#League-273"><span class="linenos"> 273</span></a>            <span class="s1">&#39;Sack&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Int&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Fum Rec&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;TD&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Safe&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Blk Kick&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span>\
</span><span id="League-274"><a href="#League-274"><span class="linenos"> 274</span></a>            <span class="s1">&#39;Pts Allow 0&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Pts Allow 1-6&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Pts Allow 7-13&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Pts Allow 14-20&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span>\
</span><span id="League-275"><a href="#League-275"><span class="linenos"> 275</span></a>            <span class="s1">&#39;Pts Allow 21-27&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Pts Allow 28-34&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Pts Allow 35+&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;XPR&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">}</span>
</span><span id="League-276"><a href="#League-276"><span class="linenos"> 276</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">roster_spots</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;position&#39;</span><span class="p">:[</span><span class="s1">&#39;QB&#39;</span><span class="p">,</span><span class="s1">&#39;RB&#39;</span><span class="p">,</span><span class="s1">&#39;WR&#39;</span><span class="p">,</span><span class="s1">&#39;TE&#39;</span><span class="p">,</span><span class="s1">&#39;W/R/T&#39;</span><span class="p">,</span><span class="s1">&#39;Q/W/R/T&#39;</span><span class="p">,</span><span class="s1">&#39;K&#39;</span><span class="p">,</span><span class="s1">&#39;BN&#39;</span><span class="p">],</span><span class="s1">&#39;count&#39;</span><span class="p">:[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">]})</span>
</span><span id="League-277"><a href="#League-277"><span class="linenos"> 277</span></a>            <span class="c1"># # Pomeranian Superflex</span>
</span><span id="League-278"><a href="#League-278"><span class="linenos"> 278</span></a>            <span class="c1"># self.settings[&#39;num_playoff_teams&#39;] = 3</span>
</span><span id="League-279"><a href="#League-279"><span class="linenos"> 279</span></a>            <span class="c1"># self.roster_spots = pd.DataFrame({&#39;position&#39;:[&#39;QB&#39;,&#39;RB&#39;,&#39;WR&#39;,&#39;TE&#39;,&#39;W/R/T&#39;,&#39;Q/W/R/T&#39;,&#39;K&#39;,&#39;BN&#39;],&#39;count&#39;:[1,2,2,1,1,1,0,12]})</span>
</span><span id="League-280"><a href="#League-280"><span class="linenos"> 280</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="League-281"><a href="#League-281"><span class="linenos"> 281</span></a>            <span class="k">if</span> <span class="s2">&quot;FG 0-19&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">:</span>
</span><span id="League-282"><a href="#League-282"><span class="linenos"> 282</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;FG 0-19&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
</span><span id="League-283"><a href="#League-283"><span class="linenos"> 283</span></a>            <span class="k">if</span> <span class="s2">&quot;Rec&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">:</span>
</span><span id="League-284"><a href="#League-284"><span class="linenos"> 284</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Rec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="League-285"><a href="#League-285"><span class="linenos"> 285</span></a>            <span class="k">if</span> <span class="s2">&quot;Ret Yds&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">:</span>
</span><span id="League-286"><a href="#League-286"><span class="linenos"> 286</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Ret Yds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="League-287"><a href="#League-287"><span class="linenos"> 287</span></a>            <span class="k">for</span> <span class="n">stat</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Pass Comp&#39;</span><span class="p">,</span><span class="s1">&#39;Pass 1D&#39;</span><span class="p">,</span><span class="s1">&#39;Rush Att&#39;</span><span class="p">,</span><span class="s1">&#39;Rush 1D&#39;</span><span class="p">,</span><span class="s1">&#39;Rec 1D&#39;</span><span class="p">,</span>\
</span><span id="League-288"><a href="#League-288"><span class="linenos"> 288</span></a>            <span class="s1">&#39;TE Rec Bonus&#39;</span><span class="p">,</span><span class="s1">&#39;TE 1D Bonus&#39;</span><span class="p">,</span><span class="s1">&#39;Pass 300+&#39;</span><span class="p">,</span><span class="s1">&#39;Rush 100+&#39;</span><span class="p">,</span><span class="s1">&#39;Rec 100+&#39;</span><span class="p">]:</span>
</span><span id="League-289"><a href="#League-289"><span class="linenos"> 289</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="n">stat</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="League-290"><a href="#League-290"><span class="linenos"> 290</span></a>
</span><span id="League-291"><a href="#League-291"><span class="linenos"> 291</span></a>    <span class="k">def</span> <span class="nf">load_fantasy_teams</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="League-292"><a href="#League-292"><span class="linenos"> 292</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="League-293"><a href="#League-293"><span class="linenos"> 293</span></a><span class="sd">        Pulls a list of all fantasy team names and ids for the league in question.</span>
</span><span id="League-294"><a href="#League-294"><span class="linenos"> 294</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="League-295"><a href="#League-295"><span class="linenos"> 295</span></a>        <span class="c1"># Pulling list of teams in the fantasy league</span>
</span><span id="League-296"><a href="#League-296"><span class="linenos"> 296</span></a>        <span class="n">league_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lg</span><span class="o">.</span><span class="n">yhandler</span><span class="o">.</span><span class="n">get_standings_raw</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lg_id</span><span class="p">)[</span><span class="s2">&quot;fantasy_content&quot;</span><span class="p">]</span>
</span><span id="League-297"><a href="#League-297"><span class="linenos"> 297</span></a>        <span class="n">teams_info</span> <span class="o">=</span> <span class="n">league_info</span><span class="p">[</span><span class="s2">&quot;league&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;standings&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;teams&quot;</span><span class="p">]</span>
</span><span id="League-298"><a href="#League-298"><span class="linenos"> 298</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">teams</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="League-299"><a href="#League-299"><span class="linenos"> 299</span></a>            <span class="p">{</span>
</span><span id="League-300"><a href="#League-300"><span class="linenos"> 300</span></a>                <span class="s2">&quot;team_key&quot;</span><span class="p">:</span> <span class="n">teams_info</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">ind</span><span class="p">)][</span><span class="s2">&quot;team&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;team_key&quot;</span><span class="p">],</span>
</span><span id="League-301"><a href="#League-301"><span class="linenos"> 301</span></a>                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">teams_info</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">ind</span><span class="p">)][</span><span class="s2">&quot;team&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
</span><span id="League-302"><a href="#League-302"><span class="linenos"> 302</span></a>                <span class="s2">&quot;manager&quot;</span><span class="p">:</span> <span class="n">teams_info</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">ind</span><span class="p">)][</span><span class="s2">&quot;team&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;managers&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;manager&#39;</span><span class="p">][</span><span class="s1">&#39;nickname&#39;</span><span class="p">],</span>
</span><span id="League-303"><a href="#League-303"><span class="linenos"> 303</span></a>            <span class="p">}</span>
</span><span id="League-304"><a href="#League-304"><span class="linenos"> 304</span></a>            <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">teams_info</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">])</span>
</span><span id="League-305"><a href="#League-305"><span class="linenos"> 305</span></a>        <span class="p">]</span>
</span><span id="League-306"><a href="#League-306"><span class="linenos"> 306</span></a>
</span><span id="League-307"><a href="#League-307"><span class="linenos"> 307</span></a>    <span class="k">def</span> <span class="nf">load_nfl_abbrevs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="League-308"><a href="#League-308"><span class="linenos"> 308</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="League-309"><a href="#League-309"><span class="linenos"> 309</span></a><span class="sd">        Loads a translation table for all NFL team abbreviations across platforms</span>
</span><span id="League-310"><a href="#League-310"><span class="linenos"> 310</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="League-311"><a href="#League-311"><span class="linenos"> 311</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">nfl_teams</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
</span><span id="League-312"><a href="#League-312"><span class="linenos"> 312</span></a>            <span class="s2">&quot;https://raw.githubusercontent.com/&quot;</span>
</span><span id="League-313"><a href="#League-313"><span class="linenos"> 313</span></a>            <span class="o">+</span> <span class="s2">&quot;tefirman/FantasySports/main/res/football/team_abbrevs.csv&quot;</span>
</span><span id="League-314"><a href="#League-314"><span class="linenos"> 314</span></a>        <span class="p">)</span>
</span><span id="League-315"><a href="#League-315"><span class="linenos"> 315</span></a>
</span><span id="League-316"><a href="#League-316"><span class="linenos"> 316</span></a>    <span class="k">def</span> <span class="nf">load_nfl_schedule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;NFLSchedule.csv&quot;</span><span class="p">):</span>
</span><span id="League-317"><a href="#League-317"><span class="linenos"> 317</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="League-318"><a href="#League-318"><span class="linenos"> 318</span></a><span class="sd">        Loads and processes the NFL schedule for use in future simulations</span>
</span><span id="League-319"><a href="#League-319"><span class="linenos"> 319</span></a>
</span><span id="League-320"><a href="#League-320"><span class="linenos"> 320</span></a><span class="sd">        Args:</span>
</span><span id="League-321"><a href="#League-321"><span class="linenos"> 321</span></a><span class="sd">            path (str, optional): location of saved NFL schedule, defaults to &quot;NFLSchedule.csv&quot;.</span>
</span><span id="League-322"><a href="#League-322"><span class="linenos"> 322</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="League-323"><a href="#League-323"><span class="linenos"> 323</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
</span><span id="League-324"><a href="#League-324"><span class="linenos"> 324</span></a>            <span class="n">nfl_schedule</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="League-325"><a href="#League-325"><span class="linenos"> 325</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="League-326"><a href="#League-326"><span class="linenos"> 326</span></a>            <span class="n">nfl_schedule</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;season&#39;</span><span class="p">,</span><span class="s1">&#39;week&#39;</span><span class="p">,</span><span class="s1">&#39;score1&#39;</span><span class="p">,</span><span class="s1">&#39;score2&#39;</span><span class="p">])</span>
</span><span id="League-327"><a href="#League-327"><span class="linenos"> 327</span></a>        <span class="n">before</span> <span class="o">=</span> <span class="n">nfl_schedule</span><span class="o">.</span><span class="n">season</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="n">nfl_schedule</span><span class="o">.</span><span class="n">week</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">season</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">week</span>
</span><span id="League-328"><a href="#League-328"><span class="linenos"> 328</span></a>        <span class="n">missing</span> <span class="o">=</span> <span class="n">before</span> <span class="o">&amp;</span> <span class="n">nfl_schedule</span><span class="o">.</span><span class="n">score1</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">nfl_schedule</span><span class="o">.</span><span class="n">score2</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span>
</span><span id="League-329"><a href="#League-329"><span class="linenos"> 329</span></a>        <span class="k">if</span> <span class="n">missing</span><span class="o">.</span><span class="n">any</span><span class="p">()</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">season</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">nfl_schedule</span><span class="o">.</span><span class="n">season</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
</span><span id="League-330"><a href="#League-330"><span class="linenos"> 330</span></a>            <span class="n">s</span> <span class="o">=</span> <span class="n">sr</span><span class="o">.</span><span class="n">Schedule</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">season</span> <span class="o">-</span> <span class="mi">8</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">season</span><span class="p">,</span><span class="kc">False</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="kc">False</span><span class="p">)</span>
</span><span id="League-331"><a href="#League-331"><span class="linenos"> 331</span></a>            <span class="n">s</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="League-332"><a href="#League-332"><span class="linenos"> 332</span></a>            <span class="n">nfl_schedule</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="League-333"><a href="#League-333"><span class="linenos"> 333</span></a>        
</span><span id="League-334"><a href="#League-334"><span class="linenos"> 334</span></a>        <span class="n">nfl_schedule</span> <span class="o">=</span> <span class="n">nfl_schedule</span><span class="p">[[</span>
</span><span id="League-335"><a href="#League-335"><span class="linenos"> 335</span></a>                <span class="s2">&quot;season&quot;</span><span class="p">,</span>
</span><span id="League-336"><a href="#League-336"><span class="linenos"> 336</span></a>                <span class="s2">&quot;game_date&quot;</span><span class="p">,</span>
</span><span id="League-337"><a href="#League-337"><span class="linenos"> 337</span></a>                <span class="s2">&quot;week&quot;</span><span class="p">,</span>
</span><span id="League-338"><a href="#League-338"><span class="linenos"> 338</span></a>                <span class="s2">&quot;team1_abbrev&quot;</span><span class="p">,</span>
</span><span id="League-339"><a href="#League-339"><span class="linenos"> 339</span></a>                <span class="s2">&quot;team2_abbrev&quot;</span><span class="p">,</span>
</span><span id="League-340"><a href="#League-340"><span class="linenos"> 340</span></a>                <span class="s2">&quot;elo1_pre&quot;</span><span class="p">,</span>
</span><span id="League-341"><a href="#League-341"><span class="linenos"> 341</span></a>                <span class="s2">&quot;elo2_pre&quot;</span><span class="p">,</span>
</span><span id="League-342"><a href="#League-342"><span class="linenos"> 342</span></a>                <span class="s2">&quot;elo_diff&quot;</span><span class="p">,</span>
</span><span id="League-343"><a href="#League-343"><span class="linenos"> 343</span></a>            <span class="p">]]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
</span><span id="League-344"><a href="#League-344"><span class="linenos"> 344</span></a>            <span class="n">columns</span><span class="o">=</span><span class="p">{</span>
</span><span id="League-345"><a href="#League-345"><span class="linenos"> 345</span></a>                <span class="s2">&quot;game_date&quot;</span><span class="p">:</span> <span class="s2">&quot;date&quot;</span><span class="p">,</span>
</span><span id="League-346"><a href="#League-346"><span class="linenos"> 346</span></a>                <span class="s2">&quot;team1_abbrev&quot;</span><span class="p">:</span> <span class="s2">&quot;home_team&quot;</span><span class="p">,</span>
</span><span id="League-347"><a href="#League-347"><span class="linenos"> 347</span></a>                <span class="s2">&quot;team2_abbrev&quot;</span><span class="p">:</span> <span class="s2">&quot;away_team&quot;</span><span class="p">,</span>
</span><span id="League-348"><a href="#League-348"><span class="linenos"> 348</span></a>                <span class="s2">&quot;elo1_pre&quot;</span><span class="p">:</span> <span class="s2">&quot;home_elo&quot;</span><span class="p">,</span>
</span><span id="League-349"><a href="#League-349"><span class="linenos"> 349</span></a>                <span class="s2">&quot;elo2_pre&quot;</span><span class="p">:</span> <span class="s2">&quot;away_elo&quot;</span><span class="p">,</span>
</span><span id="League-350"><a href="#League-350"><span class="linenos"> 350</span></a>                <span class="s2">&quot;elo_diff&quot;</span><span class="p">:</span> <span class="s2">&quot;home_elo_diff&quot;</span><span class="p">,</span>
</span><span id="League-351"><a href="#League-351"><span class="linenos"> 351</span></a>            <span class="p">},</span>
</span><span id="League-352"><a href="#League-352"><span class="linenos"> 352</span></a>        <span class="p">)</span>
</span><span id="League-353"><a href="#League-353"><span class="linenos"> 353</span></a>        <span class="n">nfl_schedule</span><span class="p">[</span><span class="s2">&quot;away_elo_diff&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">nfl_schedule</span><span class="p">[</span><span class="s2">&quot;home_elo_diff&quot;</span><span class="p">]</span>
</span><span id="League-354"><a href="#League-354"><span class="linenos"> 354</span></a>        <span class="n">home</span> <span class="o">=</span> <span class="n">nfl_schedule</span><span class="p">[[</span><span class="s2">&quot;season&quot;</span><span class="p">,</span> <span class="s2">&quot;week&quot;</span><span class="p">,</span> <span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="s2">&quot;home_team&quot;</span><span class="p">,</span> <span class="s2">&quot;home_elo_diff&quot;</span><span class="p">,</span> <span class="s2">&quot;away_elo&quot;</span><span class="p">]]</span>\
</span><span id="League-355"><a href="#League-355"><span class="linenos"> 355</span></a>        <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;home_team&quot;</span><span class="p">:</span> <span class="s2">&quot;team&quot;</span><span class="p">,</span> <span class="s2">&quot;home_elo_diff&quot;</span><span class="p">:</span> <span class="s2">&quot;elo_diff&quot;</span><span class="p">,</span> <span class="s2">&quot;away_elo&quot;</span><span class="p">:</span> <span class="s2">&quot;opp_elo&quot;</span><span class="p">})</span>
</span><span id="League-356"><a href="#League-356"><span class="linenos"> 356</span></a>        <span class="n">home</span><span class="p">[</span><span class="s2">&quot;home_away&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Home&quot;</span>
</span><span id="League-357"><a href="#League-357"><span class="linenos"> 357</span></a>        <span class="n">away</span> <span class="o">=</span> <span class="n">nfl_schedule</span><span class="p">[[</span><span class="s2">&quot;season&quot;</span><span class="p">,</span> <span class="s2">&quot;week&quot;</span><span class="p">,</span> <span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="s2">&quot;away_team&quot;</span><span class="p">,</span> <span class="s2">&quot;away_elo_diff&quot;</span><span class="p">,</span> <span class="s2">&quot;home_elo&quot;</span><span class="p">]]</span>\
</span><span id="League-358"><a href="#League-358"><span class="linenos"> 358</span></a>        <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;away_team&quot;</span><span class="p">:</span> <span class="s2">&quot;team&quot;</span><span class="p">,</span> <span class="s2">&quot;away_elo_diff&quot;</span><span class="p">:</span> <span class="s2">&quot;elo_diff&quot;</span><span class="p">,</span> <span class="s2">&quot;home_elo&quot;</span><span class="p">:</span> <span class="s2">&quot;opp_elo&quot;</span><span class="p">})</span>
</span><span id="League-359"><a href="#League-359"><span class="linenos"> 359</span></a>        <span class="n">away</span><span class="p">[</span><span class="s2">&quot;home_away&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Away&quot;</span>
</span><span id="League-360"><a href="#League-360"><span class="linenos"> 360</span></a>        <span class="n">nfl_schedule</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">home</span><span class="p">,</span> <span class="n">away</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="League-361"><a href="#League-361"><span class="linenos"> 361</span></a>        <span class="n">nfl_schedule</span><span class="o">.</span><span class="n">elo_diff</span> <span class="o">=</span> <span class="n">nfl_schedule</span><span class="o">.</span><span class="n">elo_diff</span> <span class="o">/</span> <span class="mi">1500</span>
</span><span id="League-362"><a href="#League-362"><span class="linenos"> 362</span></a>        <span class="n">nfl_schedule</span><span class="o">.</span><span class="n">opp_elo</span> <span class="o">=</span> <span class="mi">1500</span> <span class="o">/</span> <span class="n">nfl_schedule</span><span class="o">.</span><span class="n">opp_elo</span>
</span><span id="League-363"><a href="#League-363"><span class="linenos"> 363</span></a>        <span class="n">nfl_schedule</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">nfl_schedule</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;%m/</span><span class="si">%d</span><span class="s2">/%y&quot;</span><span class="p">)</span>
</span><span id="League-364"><a href="#League-364"><span class="linenos"> 364</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">nfl_schedule</span> <span class="o">=</span> <span class="n">nfl_schedule</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">,</span> <span class="s2">&quot;week&quot;</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="League-365"><a href="#League-365"><span class="linenos"> 365</span></a>
</span><span id="League-366"><a href="#League-366"><span class="linenos"> 366</span></a>    <span class="k">def</span> <span class="nf">refresh_oauth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threshold</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">59</span><span class="p">):</span>
</span><span id="League-367"><a href="#League-367"><span class="linenos"> 367</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="League-368"><a href="#League-368"><span class="linenos"> 368</span></a><span class="sd">        Checks the status of the current authentication token and refreshes it if expired (1hr).</span>
</span><span id="League-369"><a href="#League-369"><span class="linenos"> 369</span></a>
</span><span id="League-370"><a href="#League-370"><span class="linenos"> 370</span></a><span class="sd">        Args:</span>
</span><span id="League-371"><a href="#League-371"><span class="linenos"> 371</span></a><span class="sd">            threshold (int, optional): integer specifying the number of minutes an auth token </span>
</span><span id="League-372"><a href="#League-372"><span class="linenos"> 372</span></a><span class="sd">            can exist for before the code waits for it to expire and refreshes it, defaults to 59.</span>
</span><span id="League-373"><a href="#League-373"><span class="linenos"> 373</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="League-374"><a href="#League-374"><span class="linenos"> 374</span></a>        <span class="n">diff</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League-375"><a href="#League-375"><span class="linenos"> 375</span></a>            <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="p">(</span><span class="s2">&quot;GMT&quot;</span><span class="p">))</span>
</span><span id="League-376"><a href="#League-376"><span class="linenos"> 376</span></a>            <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1970</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">timezone</span><span class="p">(</span><span class="s2">&quot;GMT&quot;</span><span class="p">))</span>
</span><span id="League-377"><a href="#League-377"><span class="linenos"> 377</span></a>        <span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">oauth</span><span class="o">.</span><span class="n">token_time</span>
</span><span id="League-378"><a href="#League-378"><span class="linenos"> 378</span></a>        <span class="k">if</span> <span class="n">diff</span> <span class="o">&gt;=</span> <span class="n">threshold</span> <span class="o">*</span> <span class="mi">60</span><span class="p">:</span>
</span><span id="League-379"><a href="#League-379"><span class="linenos"> 379</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">3600</span> <span class="o">-</span> <span class="n">diff</span> <span class="o">+</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="League-380"><a href="#League-380"><span class="linenos"> 380</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">oauth</span> <span class="o">=</span> <span class="n">OAuth2</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">from_file</span><span class="o">=</span><span class="s2">&quot;oauth2.json&quot;</span><span class="p">)</span>
</span><span id="League-381"><a href="#League-381"><span class="linenos"> 381</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">gm</span> <span class="o">=</span> <span class="n">yfa</span><span class="o">.</span><span class="n">Game</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">oauth</span><span class="p">,</span> <span class="s2">&quot;nfl&quot;</span><span class="p">)</span>
</span><span id="League-382"><a href="#League-382"><span class="linenos"> 382</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">lg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gm</span><span class="o">.</span><span class="n">to_league</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lg_id</span><span class="p">)</span>
</span><span id="League-383"><a href="#League-383"><span class="linenos"> 383</span></a>
</span><span id="League-384"><a href="#League-384"><span class="linenos"> 384</span></a>    <span class="k">def</span> <span class="nf">get_yahoo_players</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">injurytries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">):</span>
</span><span id="League-385"><a href="#League-385"><span class="linenos"> 385</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="League-386"><a href="#League-386"><span class="linenos"> 386</span></a><span class="sd">        Pulls a dataframe containing details about all NFL players that are eligible </span>
</span><span id="League-387"><a href="#League-387"><span class="linenos"> 387</span></a><span class="sd">        to be rostered in the fantasy league in question. Injury statuses will occasionally </span>
</span><span id="League-388"><a href="#League-388"><span class="linenos"> 388</span></a><span class="sd">        be excluded by API; in that case, the function will repeat the pull until it sees </span>
</span><span id="League-389"><a href="#League-389"><span class="linenos"> 389</span></a><span class="sd">        the injury statuses or hits the upper limit provided in injurytries.</span>
</span><span id="League-390"><a href="#League-390"><span class="linenos"> 390</span></a>
</span><span id="League-391"><a href="#League-391"><span class="linenos"> 391</span></a><span class="sd">        Args:</span>
</span><span id="League-392"><a href="#League-392"><span class="linenos"> 392</span></a><span class="sd">            injurytries (int, optional): maximum number of times the code will try to pull the player list, defaults to 10.</span>
</span><span id="League-393"><a href="#League-393"><span class="linenos"> 393</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="League-394"><a href="#League-394"><span class="linenos"> 394</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_oauth</span><span class="p">()</span>
</span><span id="League-395"><a href="#League-395"><span class="linenos"> 395</span></a>        <span class="n">tries</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="League-396"><a href="#League-396"><span class="linenos"> 396</span></a>        <span class="k">while</span> <span class="n">tries</span> <span class="o">&lt;</span> <span class="n">injurytries</span><span class="p">:</span>
</span><span id="League-397"><a href="#League-397"><span class="linenos"> 397</span></a>            <span class="n">tries</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="League-398"><a href="#League-398"><span class="linenos"> 398</span></a>            <span class="n">players</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="League-399"><a href="#League-399"><span class="linenos"> 399</span></a>            <span class="c1"># Rostered Players</span>
</span><span id="League-400"><a href="#League-400"><span class="linenos"> 400</span></a>            <span class="k">for</span> <span class="n">page_ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
</span><span id="League-401"><a href="#League-401"><span class="linenos"> 401</span></a>                <span class="n">page</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lg</span><span class="o">.</span><span class="n">yhandler</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="League-402"><a href="#League-402"><span class="linenos"> 402</span></a>                    <span class="s2">&quot;league/</span><span class="si">{}</span><span class="s2">/players;start=</span><span class="si">{}</span><span class="s2">;count=25;status=T/&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="League-403"><a href="#League-403"><span class="linenos"> 403</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">lg_id</span><span class="p">,</span> <span class="n">page_ind</span> <span class="o">*</span> <span class="mi">25</span>
</span><span id="League-404"><a href="#League-404"><span class="linenos"> 404</span></a>                    <span class="p">)</span>
</span><span id="League-405"><a href="#League-405"><span class="linenos"> 405</span></a>                <span class="p">)[</span><span class="s2">&quot;fantasy_content&quot;</span><span class="p">][</span><span class="s2">&quot;league&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;players&quot;</span><span class="p">]</span>
</span><span id="League-406"><a href="#League-406"><span class="linenos"> 406</span></a>                <span class="k">if</span> <span class="n">page</span> <span class="o">==</span> <span class="p">[]:</span>
</span><span id="League-407"><a href="#League-407"><span class="linenos"> 407</span></a>                    <span class="k">break</span>
</span><span id="League-408"><a href="#League-408"><span class="linenos"> 408</span></a>                <span class="k">for</span> <span class="n">player_ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">page</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]):</span>
</span><span id="League-409"><a href="#League-409"><span class="linenos"> 409</span></a>                    <span class="n">player</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="League-410"><a href="#League-410"><span class="linenos"> 410</span></a>                        <span class="n">field</span>
</span><span id="League-411"><a href="#League-411"><span class="linenos"> 411</span></a>                        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">page</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">player_ind</span><span class="p">)][</span><span class="s2">&quot;player&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League-412"><a href="#League-412"><span class="linenos"> 412</span></a>                        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">field</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span>
</span><span id="League-413"><a href="#League-413"><span class="linenos"> 413</span></a>                    <span class="p">]</span>
</span><span id="League-414"><a href="#League-414"><span class="linenos"> 414</span></a>                    <span class="n">vals</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="League-415"><a href="#League-415"><span class="linenos"> 415</span></a>                    <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">player</span><span class="p">:</span>
</span><span id="League-416"><a href="#League-416"><span class="linenos"> 416</span></a>                        <span class="n">vals</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
</span><span id="League-417"><a href="#League-417"><span class="linenos"> 417</span></a>                    <span class="n">vals</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vals</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">][</span><span class="s2">&quot;full&quot;</span><span class="p">]</span>
</span><span id="League-418"><a href="#League-418"><span class="linenos"> 418</span></a>                    <span class="n">vals</span><span class="p">[</span><span class="s2">&quot;eligible_positions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="League-419"><a href="#League-419"><span class="linenos"> 419</span></a>                        <span class="n">pos</span><span class="p">[</span><span class="s2">&quot;position&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">[</span><span class="s2">&quot;eligible_positions&quot;</span><span class="p">]</span>
</span><span id="League-420"><a href="#League-420"><span class="linenos"> 420</span></a>                    <span class="p">]</span>
</span><span id="League-421"><a href="#League-421"><span class="linenos"> 421</span></a>                    <span class="n">vals</span><span class="p">[</span><span class="s2">&quot;bye_weeks&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vals</span><span class="p">[</span><span class="s2">&quot;bye_weeks&quot;</span><span class="p">][</span><span class="s2">&quot;week&quot;</span><span class="p">]</span>
</span><span id="League-422"><a href="#League-422"><span class="linenos"> 422</span></a>                    <span class="n">players</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>
</span><span id="League-423"><a href="#League-423"><span class="linenos"> 423</span></a>            <span class="c1"># Available Players</span>
</span><span id="League-424"><a href="#League-424"><span class="linenos"> 424</span></a>            <span class="k">for</span> <span class="n">page_ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
</span><span id="League-425"><a href="#League-425"><span class="linenos"> 425</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;Accounting for a weird player_id deletion in 2015...&quot;&quot;&quot;</span>
</span><span id="League-426"><a href="#League-426"><span class="linenos"> 426</span></a>                <span class="n">page</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lg</span><span class="o">.</span><span class="n">yhandler</span><span class="o">.</span><span class="n">get_players_raw</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lg_id</span><span class="p">,</span> <span class="n">page_ind</span> <span class="o">*</span> <span class="mi">25</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">)</span>
</span><span id="League-427"><a href="#League-427"><span class="linenos"> 427</span></a>                <span class="n">page</span> <span class="o">=</span> <span class="n">page</span><span class="p">[</span><span class="s2">&quot;fantasy_content&quot;</span><span class="p">][</span><span class="s2">&quot;league&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;players&quot;</span><span class="p">]</span>
</span><span id="League-428"><a href="#League-428"><span class="linenos"> 428</span></a>                <span class="k">if</span> <span class="n">page</span> <span class="o">==</span> <span class="p">[]:</span>
</span><span id="League-429"><a href="#League-429"><span class="linenos"> 429</span></a>                    <span class="k">break</span>
</span><span id="League-430"><a href="#League-430"><span class="linenos"> 430</span></a>                <span class="k">for</span> <span class="n">player_ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">page</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]):</span>
</span><span id="League-431"><a href="#League-431"><span class="linenos"> 431</span></a>                    <span class="n">player</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="League-432"><a href="#League-432"><span class="linenos"> 432</span></a>                        <span class="n">field</span>
</span><span id="League-433"><a href="#League-433"><span class="linenos"> 433</span></a>                        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">page</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">player_ind</span><span class="p">)][</span><span class="s2">&quot;player&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League-434"><a href="#League-434"><span class="linenos"> 434</span></a>                        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">field</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span>
</span><span id="League-435"><a href="#League-435"><span class="linenos"> 435</span></a>                    <span class="p">]</span>
</span><span id="League-436"><a href="#League-436"><span class="linenos"> 436</span></a>                    <span class="n">vals</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="League-437"><a href="#League-437"><span class="linenos"> 437</span></a>                    <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">player</span><span class="p">:</span>
</span><span id="League-438"><a href="#League-438"><span class="linenos"> 438</span></a>                        <span class="n">vals</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
</span><span id="League-439"><a href="#League-439"><span class="linenos"> 439</span></a>                    <span class="n">vals</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vals</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">][</span><span class="s2">&quot;full&quot;</span><span class="p">]</span>
</span><span id="League-440"><a href="#League-440"><span class="linenos"> 440</span></a>                    <span class="n">vals</span><span class="p">[</span><span class="s2">&quot;eligible_positions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="League-441"><a href="#League-441"><span class="linenos"> 441</span></a>                        <span class="n">pos</span><span class="p">[</span><span class="s2">&quot;position&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">[</span><span class="s2">&quot;eligible_positions&quot;</span><span class="p">]</span>
</span><span id="League-442"><a href="#League-442"><span class="linenos"> 442</span></a>                    <span class="p">]</span>
</span><span id="League-443"><a href="#League-443"><span class="linenos"> 443</span></a>                    <span class="n">vals</span><span class="p">[</span><span class="s2">&quot;bye_weeks&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vals</span><span class="p">[</span><span class="s2">&quot;bye_weeks&quot;</span><span class="p">][</span><span class="s2">&quot;week&quot;</span><span class="p">]</span>
</span><span id="League-444"><a href="#League-444"><span class="linenos"> 444</span></a>                    <span class="n">players</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>
</span><span id="League-445"><a href="#League-445"><span class="linenos"> 445</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">players</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">players</span><span class="p">)</span>
</span><span id="League-446"><a href="#League-446"><span class="linenos"> 446</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">player_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">player_id</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="League-447"><a href="#League-447"><span class="linenos"> 447</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
</span><span id="League-448"><a href="#League-448"><span class="linenos"> 448</span></a>                <span class="k">break</span>
</span><span id="League-449"><a href="#League-449"><span class="linenos"> 449</span></a>
</span><span id="League-450"><a href="#League-450"><span class="linenos"> 450</span></a>    <span class="k">def</span> <span class="nf">get_fantasy_rosters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="League-451"><a href="#League-451"><span class="linenos"> 451</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="League-452"><a href="#League-452"><span class="linenos"> 452</span></a><span class="sd">        Pulls the current fantasy team of each eligible NFL player </span>
</span><span id="League-453"><a href="#League-453"><span class="linenos"> 453</span></a><span class="sd">        and merges it into the players dataframe.</span>
</span><span id="League-454"><a href="#League-454"><span class="linenos"> 454</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="League-455"><a href="#League-455"><span class="linenos"> 455</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_oauth</span><span class="p">()</span>
</span><span id="League-456"><a href="#League-456"><span class="linenos"> 456</span></a>        <span class="n">selected</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span><span id="League-457"><a href="#League-457"><span class="linenos"> 457</span></a>            <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;player_id&quot;</span><span class="p">,</span> <span class="s2">&quot;selected_position&quot;</span><span class="p">,</span> <span class="s2">&quot;fantasy_team&quot;</span><span class="p">]</span>
</span><span id="League-458"><a href="#League-458"><span class="linenos"> 458</span></a>        <span class="p">)</span>
</span><span id="League-459"><a href="#League-459"><span class="linenos"> 459</span></a>        <span class="k">for</span> <span class="n">team</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">teams</span><span class="p">:</span>
</span><span id="League-460"><a href="#League-460"><span class="linenos"> 460</span></a>            <span class="n">tm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lg</span><span class="o">.</span><span class="n">to_team</span><span class="p">(</span><span class="n">team</span><span class="p">[</span><span class="s2">&quot;team_key&quot;</span><span class="p">])</span>
</span><span id="League-461"><a href="#League-461"><span class="linenos"> 461</span></a>            <span class="n">players</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">tm</span><span class="o">.</span><span class="n">roster</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">week</span><span class="p">))</span>
</span><span id="League-462"><a href="#League-462"><span class="linenos"> 462</span></a>            <span class="k">if</span> <span class="n">players</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="League-463"><a href="#League-463"><span class="linenos"> 463</span></a>                <span class="k">continue</span>
</span><span id="League-464"><a href="#League-464"><span class="linenos"> 464</span></a>            <span class="k">if</span> <span class="p">(</span><span class="o">~</span><span class="n">players</span><span class="o">.</span><span class="n">player_id</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">player_id</span><span class="p">))</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="League-465"><a href="#League-465"><span class="linenos"> 465</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="League-466"><a href="#League-466"><span class="linenos"> 466</span></a>                    <span class="s2">&quot;Some players are missing... &quot;</span>
</span><span id="League-467"><a href="#League-467"><span class="linenos"> 467</span></a>                    <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="League-468"><a href="#League-468"><span class="linenos"> 468</span></a>                        <span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">players</span><span class="o">.</span><span class="n">player_id</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">rosters</span><span class="o">.</span><span class="n">player_id</span><span class="p">),</span> <span class="s2">&quot;name&quot;</span><span class="p">]</span>
</span><span id="League-469"><a href="#League-469"><span class="linenos"> 469</span></a>                    <span class="p">)</span>
</span><span id="League-470"><a href="#League-470"><span class="linenos"> 470</span></a>                <span class="p">)</span>
</span><span id="League-471"><a href="#League-471"><span class="linenos"> 471</span></a>            <span class="n">players</span><span class="p">[</span><span class="s2">&quot;fantasy_team&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">team</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
</span><span id="League-472"><a href="#League-472"><span class="linenos"> 472</span></a>            <span class="n">selected</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">selected</span><span class="p">,</span>
</span><span id="League-473"><a href="#League-473"><span class="linenos"> 473</span></a>                <span class="n">players</span><span class="p">[[</span><span class="s2">&quot;player_id&quot;</span><span class="p">,</span> <span class="s2">&quot;selected_position&quot;</span><span class="p">,</span> <span class="s2">&quot;fantasy_team&quot;</span><span class="p">]]],</span>
</span><span id="League-474"><a href="#League-474"><span class="linenos"> 474</span></a>                <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="League-475"><a href="#League-475"><span class="linenos"> 475</span></a>                <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="League-476"><a href="#League-476"><span class="linenos"> 476</span></a>            <span class="p">)</span>
</span><span id="League-477"><a href="#League-477"><span class="linenos"> 477</span></a>        <span class="n">rosters</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League-478"><a href="#League-478"><span class="linenos"> 478</span></a>            <span class="n">left</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">selected</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;player_id&quot;</span>
</span><span id="League-479"><a href="#League-479"><span class="linenos"> 479</span></a>        <span class="p">)</span>
</span><span id="League-480"><a href="#League-480"><span class="linenos"> 480</span></a>        <span class="k">if</span> <span class="s2">&quot;fantasy_team&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">rosters</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="League-481"><a href="#League-481"><span class="linenos"> 481</span></a>            <span class="n">rosters</span><span class="p">[</span><span class="s2">&quot;fantasy_team&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="League-482"><a href="#League-482"><span class="linenos"> 482</span></a>        <span class="n">rosters</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">rosters</span><span class="o">.</span><span class="n">player_id</span> <span class="o">==</span> <span class="mi">100014</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="s2">&quot; Rams&quot;</span>
</span><span id="League-483"><a href="#League-483"><span class="linenos"> 483</span></a>        <span class="n">rosters</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">rosters</span><span class="o">.</span><span class="n">player_id</span> <span class="o">==</span> <span class="mi">100024</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="s2">&quot; Chargers&quot;</span>
</span><span id="League-484"><a href="#League-484"><span class="linenos"> 484</span></a>        <span class="n">rosters</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">rosters</span><span class="o">.</span><span class="n">player_id</span> <span class="o">==</span> <span class="mi">100020</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="s2">&quot; Jets&quot;</span>
</span><span id="League-485"><a href="#League-485"><span class="linenos"> 485</span></a>        <span class="n">rosters</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">rosters</span><span class="o">.</span><span class="n">player_id</span> <span class="o">==</span> <span class="mi">100019</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="s2">&quot; Giants&quot;</span>
</span><span id="League-486"><a href="#League-486"><span class="linenos"> 486</span></a>        <span class="n">rosters</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League-487"><a href="#League-487"><span class="linenos"> 487</span></a>            <span class="n">left</span><span class="o">=</span><span class="n">rosters</span><span class="p">,</span>
</span><span id="League-488"><a href="#League-488"><span class="linenos"> 488</span></a>            <span class="n">right</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nfl_teams</span><span class="p">[[</span><span class="s2">&quot;real_abbrev&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">]],</span>
</span><span id="League-489"><a href="#League-489"><span class="linenos"> 489</span></a>            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
</span><span id="League-490"><a href="#League-490"><span class="linenos"> 490</span></a>            <span class="n">on</span><span class="o">=</span><span class="s2">&quot;name&quot;</span><span class="p">,</span>
</span><span id="League-491"><a href="#League-491"><span class="linenos"> 491</span></a>        <span class="p">)</span>
</span><span id="League-492"><a href="#League-492"><span class="linenos"> 492</span></a>        <span class="n">rosters</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">rosters</span><span class="o">.</span><span class="n">real_abbrev</span><span class="o">.</span><span class="n">isnull</span><span class="p">(),</span> <span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rosters</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League-493"><a href="#League-493"><span class="linenos"> 493</span></a>            <span class="o">~</span><span class="n">rosters</span><span class="o">.</span><span class="n">real_abbrev</span><span class="o">.</span><span class="n">isnull</span><span class="p">(),</span> <span class="s2">&quot;real_abbrev&quot;</span>
</span><span id="League-494"><a href="#League-494"><span class="linenos"> 494</span></a>        <span class="p">]</span>
</span><span id="League-495"><a href="#League-495"><span class="linenos"> 495</span></a>        <span class="n">rosters</span><span class="p">[</span><span class="s2">&quot;position&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rosters</span><span class="o">.</span><span class="n">display_position</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
</span><span id="League-496"><a href="#League-496"><span class="linenos"> 496</span></a>            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span><span class="n">pos</span> <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">pos</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;QB&#39;</span><span class="p">,</span><span class="s1">&#39;WR&#39;</span><span class="p">,</span><span class="s1">&#39;TE&#39;</span><span class="p">,</span><span class="s1">&#39;K&#39;</span><span class="p">,</span><span class="s1">&#39;RB&#39;</span><span class="p">,</span><span class="s1">&#39;DEF&#39;</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League-497"><a href="#League-497"><span class="linenos"> 497</span></a>        <span class="p">)</span>
</span><span id="League-498"><a href="#League-498"><span class="linenos"> 498</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span> <span class="o">=</span> <span class="n">rosters</span><span class="p">[</span>
</span><span id="League-499"><a href="#League-499"><span class="linenos"> 499</span></a>            <span class="p">[</span>
</span><span id="League-500"><a href="#League-500"><span class="linenos"> 500</span></a>                <span class="s2">&quot;name&quot;</span><span class="p">,</span>
</span><span id="League-501"><a href="#League-501"><span class="linenos"> 501</span></a>                <span class="s2">&quot;eligible_positions&quot;</span><span class="p">,</span>
</span><span id="League-502"><a href="#League-502"><span class="linenos"> 502</span></a>                <span class="s2">&quot;selected_position&quot;</span><span class="p">,</span>
</span><span id="League-503"><a href="#League-503"><span class="linenos"> 503</span></a>                <span class="s2">&quot;status&quot;</span><span class="p">,</span>
</span><span id="League-504"><a href="#League-504"><span class="linenos"> 504</span></a>                <span class="s2">&quot;player_id&quot;</span><span class="p">,</span>
</span><span id="League-505"><a href="#League-505"><span class="linenos"> 505</span></a>                <span class="s2">&quot;editorial_team_abbr&quot;</span><span class="p">,</span>
</span><span id="League-506"><a href="#League-506"><span class="linenos"> 506</span></a>                <span class="s2">&quot;fantasy_team&quot;</span><span class="p">,</span>
</span><span id="League-507"><a href="#League-507"><span class="linenos"> 507</span></a>                <span class="s2">&quot;position&quot;</span><span class="p">,</span>
</span><span id="League-508"><a href="#League-508"><span class="linenos"> 508</span></a>            <span class="p">]</span>
</span><span id="League-509"><a href="#League-509"><span class="linenos"> 509</span></a>        <span class="p">]</span>
</span><span id="League-510"><a href="#League-510"><span class="linenos"> 510</span></a>
</span><span id="League-511"><a href="#League-511"><span class="linenos"> 511</span></a>    <span class="k">def</span> <span class="nf">pull_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">finish</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;GameByGameFantasyFootballStats.csv&quot;</span><span class="p">):</span>
</span><span id="League-512"><a href="#League-512"><span class="linenos"> 512</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="League-513"><a href="#League-513"><span class="linenos"> 513</span></a><span class="sd">        Pulls a dataframe containing event rates based on per-game statistics during the specified timeframe.</span>
</span><span id="League-514"><a href="#League-514"><span class="linenos"> 514</span></a>
</span><span id="League-515"><a href="#League-515"><span class="linenos"> 515</span></a><span class="sd">        Args:</span>
</span><span id="League-516"><a href="#League-516"><span class="linenos"> 516</span></a><span class="sd">            start (int): year and number of the first week of interest (YYYYWW, e.g. 202102 = week 2 of 2021).  </span>
</span><span id="League-517"><a href="#League-517"><span class="linenos"> 517</span></a><span class="sd">            finish (int): year and number of the last week of interest (YYYYWW, e.g. 202307 = week 7 of 2023).  </span>
</span><span id="League-518"><a href="#League-518"><span class="linenos"> 518</span></a><span class="sd">            path (str, optional): location of saved per-game statistics, defaults to &quot;GameByGameFantasyFootballStats.csv&quot;.</span>
</span><span id="League-519"><a href="#League-519"><span class="linenos"> 519</span></a>
</span><span id="League-520"><a href="#League-520"><span class="linenos"> 520</span></a><span class="sd">        Returns:</span>
</span><span id="League-521"><a href="#League-521"><span class="linenos"> 521</span></a><span class="sd">            pd.DataFrame: dataframe containing player rates based on games during the timespan of interest.</span>
</span><span id="League-522"><a href="#League-522"><span class="linenos"> 522</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="League-523"><a href="#League-523"><span class="linenos"> 523</span></a>        <span class="n">stats</span> <span class="o">=</span> <span class="n">sr</span><span class="o">.</span><span class="n">get_bulk_stats</span><span class="p">(</span><span class="n">start</span><span class="o">//</span><span class="mi">100</span><span class="p">,</span><span class="n">start</span><span class="o">%</span><span class="mi">100</span><span class="p">,</span><span class="n">finish</span><span class="o">//</span><span class="mi">100</span><span class="p">,</span><span class="n">finish</span><span class="o">%</span><span class="mi">100</span><span class="p">,</span><span class="kc">False</span><span class="p">,</span><span class="n">path</span><span class="p">)</span>
</span><span id="League-524"><a href="#League-524"><span class="linenos"> 524</span></a>        <span class="n">s</span> <span class="o">=</span> <span class="n">sr</span><span class="o">.</span><span class="n">Schedule</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">season</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="n">stats</span><span class="o">.</span><span class="n">season</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</span><span id="League-525"><a href="#League-525"><span class="linenos"> 525</span></a>        <span class="n">pts_allowed</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">s</span><span class="o">.</span><span class="n">schedule</span><span class="p">[[</span><span class="s1">&#39;boxscore_abbrev&#39;</span><span class="p">,</span><span class="s1">&#39;team1_abbrev&#39;</span><span class="p">,</span><span class="s1">&#39;score2&#39;</span><span class="p">]]</span>\
</span><span id="League-526"><a href="#League-526"><span class="linenos"> 526</span></a>        <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;boxscore_abbrev&#39;</span><span class="p">:</span><span class="s1">&#39;game_id&#39;</span><span class="p">,</span><span class="s1">&#39;team1_abbrev&#39;</span><span class="p">:</span><span class="s1">&#39;team&#39;</span><span class="p">,</span><span class="s1">&#39;score2&#39;</span><span class="p">:</span><span class="s1">&#39;points_allowed&#39;</span><span class="p">}),</span>\
</span><span id="League-527"><a href="#League-527"><span class="linenos"> 527</span></a>        <span class="n">s</span><span class="o">.</span><span class="n">schedule</span><span class="p">[[</span><span class="s1">&#39;boxscore_abbrev&#39;</span><span class="p">,</span><span class="s1">&#39;team2_abbrev&#39;</span><span class="p">,</span><span class="s1">&#39;score1&#39;</span><span class="p">]]</span>\
</span><span id="League-528"><a href="#League-528"><span class="linenos"> 528</span></a>        <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;boxscore_abbrev&#39;</span><span class="p">:</span><span class="s1">&#39;game_id&#39;</span><span class="p">,</span><span class="s1">&#39;team2_abbrev&#39;</span><span class="p">:</span><span class="s1">&#39;team&#39;</span><span class="p">,</span><span class="s1">&#39;score1&#39;</span><span class="p">:</span><span class="s1">&#39;points_allowed&#39;</span><span class="p">})],</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="League-529"><a href="#League-529"><span class="linenos"> 529</span></a>        <span class="n">stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">stats</span><span class="p">,</span><span class="n">right</span><span class="o">=</span><span class="n">pts_allowed</span><span class="p">,</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;game_id&#39;</span><span class="p">,</span><span class="s1">&#39;team&#39;</span><span class="p">])</span>
</span><span id="League-530"><a href="#League-530"><span class="linenos"> 530</span></a>        <span class="n">pos_corrections</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
</span><span id="League-531"><a href="#League-531"><span class="linenos"> 531</span></a>            <span class="s2">&quot;https://raw.githubusercontent.com/&quot;</span>
</span><span id="League-532"><a href="#League-532"><span class="linenos"> 532</span></a>            <span class="o">+</span> <span class="s2">&quot;tefirman/FantasySports/main/res/football/pos_corrections.csv&quot;</span>
</span><span id="League-533"><a href="#League-533"><span class="linenos"> 533</span></a>        <span class="p">)</span>
</span><span id="League-534"><a href="#League-534"><span class="linenos"> 534</span></a>        <span class="n">stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">stats</span><span class="p">,</span><span class="n">right</span><span class="o">=</span><span class="n">pos_corrections</span><span class="p">[[</span><span class="s1">&#39;player_id&#39;</span><span class="p">,</span><span class="s1">&#39;actual_pos&#39;</span><span class="p">]],</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;player_id&#39;</span><span class="p">])</span>
</span><span id="League-535"><a href="#League-535"><span class="linenos"> 535</span></a>        <span class="n">stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">stats</span><span class="o">.</span><span class="n">actual_pos</span><span class="o">.</span><span class="n">isnull</span><span class="p">(),</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">stats</span><span class="o">.</span><span class="n">actual_pos</span><span class="o">.</span><span class="n">isnull</span><span class="p">(),</span><span class="s1">&#39;actual_pos&#39;</span><span class="p">]</span>
</span><span id="League-536"><a href="#League-536"><span class="linenos"> 536</span></a>        <span class="k">del</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;actual_pos&#39;</span><span class="p">]</span>
</span><span id="League-537"><a href="#League-537"><span class="linenos"> 537</span></a>        <span class="n">to_fix</span> <span class="o">=</span> <span class="o">~</span><span class="n">stats</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;QB&quot;</span><span class="p">,</span> <span class="s2">&quot;RB&quot;</span><span class="p">,</span> <span class="s2">&quot;WR&quot;</span><span class="p">,</span> <span class="s2">&quot;TE&quot;</span><span class="p">,</span> <span class="s2">&quot;K&quot;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span>
</span><span id="League-538"><a href="#League-538"><span class="linenos"> 538</span></a>            <span class="n">stats</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;QB&quot;</span><span class="p">)</span>
</span><span id="League-539"><a href="#League-539"><span class="linenos"> 539</span></a>            <span class="o">|</span> <span class="n">stats</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;WR&quot;</span><span class="p">)</span>
</span><span id="League-540"><a href="#League-540"><span class="linenos"> 540</span></a>            <span class="o">|</span> <span class="n">stats</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;RB&quot;</span><span class="p">)</span>
</span><span id="League-541"><a href="#League-541"><span class="linenos"> 541</span></a>            <span class="o">|</span> <span class="n">stats</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;TE&quot;</span><span class="p">)</span>
</span><span id="League-542"><a href="#League-542"><span class="linenos"> 542</span></a>            <span class="o">|</span> <span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;K&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">stats</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;MIKE&quot;</span><span class="p">,</span><span class="s2">&quot;JACK&quot;</span><span class="p">]))</span>
</span><span id="League-543"><a href="#League-543"><span class="linenos"> 543</span></a>        <span class="p">)</span>
</span><span id="League-544"><a href="#League-544"><span class="linenos"> 544</span></a>        <span class="k">if</span> <span class="n">to_fix</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="League-545"><a href="#League-545"><span class="linenos"> 545</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Weird positions in game-by-game stats...&#39;</span><span class="p">)</span>
</span><span id="League-546"><a href="#League-546"><span class="linenos"> 546</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">to_fix</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;player_id&quot;</span><span class="p">,</span> <span class="s2">&quot;player&quot;</span><span class="p">,</span> <span class="s2">&quot;pos&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
</span><span id="League-547"><a href="#League-547"><span class="linenos"> 547</span></a>        <span class="n">defenses</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League-548"><a href="#League-548"><span class="linenos"> 548</span></a>            <span class="n">stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">stats</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;QB&quot;</span><span class="p">,</span> <span class="s2">&quot;RB&quot;</span><span class="p">,</span> <span class="s2">&quot;WR&quot;</span><span class="p">,</span> <span class="s2">&quot;TE&quot;</span><span class="p">,</span> <span class="s2">&quot;K&quot;</span><span class="p">])]</span>
</span><span id="League-549"><a href="#League-549"><span class="linenos"> 549</span></a>            <span class="o">.</span><span class="n">groupby</span><span class="p">(</span>
</span><span id="League-550"><a href="#League-550"><span class="linenos"> 550</span></a>                <span class="p">[</span><span class="s2">&quot;game_id&quot;</span><span class="p">,</span> <span class="s2">&quot;season&quot;</span><span class="p">,</span> <span class="s2">&quot;week&quot;</span><span class="p">,</span> <span class="s2">&quot;team&quot;</span><span class="p">,</span> <span class="s2">&quot;opponent&quot;</span><span class="p">,</span> <span class="s2">&quot;points_allowed&quot;</span><span class="p">]</span>
</span><span id="League-551"><a href="#League-551"><span class="linenos"> 551</span></a>            <span class="p">)</span>
</span><span id="League-552"><a href="#League-552"><span class="linenos"> 552</span></a>            <span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">numeric_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="League-553"><a href="#League-553"><span class="linenos"> 553</span></a>            <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="League-554"><a href="#League-554"><span class="linenos"> 554</span></a>        <span class="p">)</span>
</span><span id="League-555"><a href="#League-555"><span class="linenos"> 555</span></a>        <span class="n">defenses</span><span class="p">[</span><span class="s2">&quot;player&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">defenses</span><span class="p">[</span><span class="s2">&quot;team&quot;</span><span class="p">]</span>
</span><span id="League-556"><a href="#League-556"><span class="linenos"> 556</span></a>        <span class="n">defenses</span><span class="p">[</span><span class="s2">&quot;player_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">defenses</span><span class="p">[</span><span class="s2">&quot;player&quot;</span><span class="p">]</span>
</span><span id="League-557"><a href="#League-557"><span class="linenos"> 557</span></a>        <span class="n">defenses</span><span class="p">[</span><span class="s2">&quot;pos&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;DEF&quot;</span>
</span><span id="League-558"><a href="#League-558"><span class="linenos"> 558</span></a>        <span class="k">if</span> <span class="s2">&quot;string&quot;</span> <span class="ow">in</span> <span class="n">defenses</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="League-559"><a href="#League-559"><span class="linenos"> 559</span></a>            <span class="n">defenses</span><span class="p">[</span><span class="s2">&quot;string&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="League-560"><a href="#League-560"><span class="linenos"> 560</span></a>        <span class="n">defenses</span> <span class="o">=</span> <span class="n">defenses</span><span class="p">[[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">stats</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">defenses</span><span class="o">.</span><span class="n">columns</span><span class="p">]]</span>
</span><span id="League-561"><a href="#League-561"><span class="linenos"> 561</span></a>        <span class="n">stats</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">stats</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;QB&quot;</span><span class="p">,</span> <span class="s2">&quot;RB&quot;</span><span class="p">,</span> <span class="s2">&quot;WR&quot;</span><span class="p">,</span> <span class="s2">&quot;TE&quot;</span><span class="p">,</span> <span class="s2">&quot;K&quot;</span><span class="p">])]</span>
</span><span id="League-562"><a href="#League-562"><span class="linenos"> 562</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">stats</span><span class="p">,</span><span class="n">defenses</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>\
</span><span id="League-563"><a href="#League-563"><span class="linenos"> 563</span></a>        <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;pos&#39;</span><span class="p">:</span><span class="s1">&#39;position&#39;</span><span class="p">,</span><span class="s1">&#39;player&#39;</span><span class="p">:</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;player_id&#39;</span><span class="p">:</span><span class="s1">&#39;player_id_sr&#39;</span><span class="p">})</span>
</span><span id="League-564"><a href="#League-564"><span class="linenos"> 564</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;weeks_ago&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">game_id</span><span class="o">.</span><span class="n">str</span><span class="p">[:</span><span class="mi">8</span><span class="p">]))</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">days</span> <span class="o">/</span> <span class="mf">7.0</span>
</span><span id="League-565"><a href="#League-565"><span class="linenos"> 565</span></a>
</span><span id="League-566"><a href="#League-566"><span class="linenos"> 566</span></a>    <span class="k">def</span> <span class="nf">add_points</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="League-567"><a href="#League-567"><span class="linenos"> 567</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="League-568"><a href="#League-568"><span class="linenos"> 568</span></a><span class="sd">        Calculates per-game fantasy points based on per-game statistics and provided scoring settings.</span>
</span><span id="League-569"><a href="#League-569"><span class="linenos"> 569</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="League-570"><a href="#League-570"><span class="linenos"> 570</span></a>        <span class="n">offense</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">position</span> <span class="o">!=</span> <span class="s2">&quot;DEF&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="League-571"><a href="#League-571"><span class="linenos"> 571</span></a>        <span class="n">offense</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League-572"><a href="#League-572"><span class="linenos"> 572</span></a>            <span class="n">offense</span><span class="p">[</span><span class="s2">&quot;rush_yds&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Rush Yds&quot;</span><span class="p">]</span>
</span><span id="League-573"><a href="#League-573"><span class="linenos"> 573</span></a>            <span class="o">+</span> <span class="n">offense</span><span class="p">[</span><span class="s2">&quot;rush_att&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Rush Att&quot;</span><span class="p">]</span>
</span><span id="League-574"><a href="#League-574"><span class="linenos"> 574</span></a>            <span class="o">+</span> <span class="n">offense</span><span class="p">[</span><span class="s2">&quot;rush_td&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Rush TD&quot;</span><span class="p">]</span>
</span><span id="League-575"><a href="#League-575"><span class="linenos"> 575</span></a>            <span class="o">+</span> <span class="n">offense</span><span class="p">[</span><span class="s2">&quot;rush_first_down&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Rush 1D&quot;</span><span class="p">]</span>
</span><span id="League-576"><a href="#League-576"><span class="linenos"> 576</span></a>            <span class="o">+</span> <span class="n">offense</span><span class="p">[</span><span class="s2">&quot;rec&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Rec&quot;</span><span class="p">]</span>
</span><span id="League-577"><a href="#League-577"><span class="linenos"> 577</span></a>            <span class="o">+</span> <span class="n">offense</span><span class="p">[</span><span class="s2">&quot;rec_yds&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Rec Yds&quot;</span><span class="p">]</span>
</span><span id="League-578"><a href="#League-578"><span class="linenos"> 578</span></a>            <span class="o">+</span> <span class="n">offense</span><span class="p">[</span><span class="s2">&quot;rec_td&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Rec TD&quot;</span><span class="p">]</span>
</span><span id="League-579"><a href="#League-579"><span class="linenos"> 579</span></a>            <span class="o">+</span> <span class="n">offense</span><span class="p">[</span><span class="s2">&quot;rec_first_down&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Rec 1D&quot;</span><span class="p">]</span>
</span><span id="League-580"><a href="#League-580"><span class="linenos"> 580</span></a>            <span class="o">+</span> <span class="n">offense</span><span class="p">[</span><span class="s2">&quot;pass_yds&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Pass Yds&quot;</span><span class="p">]</span>
</span><span id="League-581"><a href="#League-581"><span class="linenos"> 581</span></a>            <span class="o">+</span> <span class="n">offense</span><span class="p">[</span><span class="s2">&quot;pass_cmp&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Pass Comp&quot;</span><span class="p">]</span>
</span><span id="League-582"><a href="#League-582"><span class="linenos"> 582</span></a>            <span class="o">+</span> <span class="n">offense</span><span class="p">[</span><span class="s2">&quot;pass_td&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Pass TD&quot;</span><span class="p">]</span>
</span><span id="League-583"><a href="#League-583"><span class="linenos"> 583</span></a>            <span class="o">+</span> <span class="n">offense</span><span class="p">[</span><span class="s2">&quot;pass_first_down&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Pass 1D&quot;</span><span class="p">]</span>
</span><span id="League-584"><a href="#League-584"><span class="linenos"> 584</span></a>            <span class="o">+</span> <span class="n">offense</span><span class="p">[</span><span class="s2">&quot;pass_int&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Int Thrown&quot;</span><span class="p">]</span>
</span><span id="League-585"><a href="#League-585"><span class="linenos"> 585</span></a>            <span class="o">+</span> <span class="n">offense</span><span class="p">[</span><span class="s2">&quot;fumbles_lost&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Fum Lost&quot;</span><span class="p">]</span>
</span><span id="League-586"><a href="#League-586"><span class="linenos"> 586</span></a>            <span class="o">+</span> <span class="p">(</span><span class="n">offense</span><span class="p">[</span><span class="s2">&quot;kick_ret_yds&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">offense</span><span class="p">[</span><span class="s2">&quot;punt_ret_yds&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Ret Yds&quot;</span><span class="p">]</span>
</span><span id="League-587"><a href="#League-587"><span class="linenos"> 587</span></a>            <span class="o">+</span> <span class="p">(</span><span class="n">offense</span><span class="p">[</span><span class="s2">&quot;kick_ret_td&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">offense</span><span class="p">[</span><span class="s2">&quot;punt_ret_td&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Ret TD&quot;</span><span class="p">]</span>
</span><span id="League-588"><a href="#League-588"><span class="linenos"> 588</span></a>            <span class="o">+</span> <span class="n">offense</span><span class="p">[</span><span class="s2">&quot;xpm&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;PAT Made&quot;</span><span class="p">]</span>
</span><span id="League-589"><a href="#League-589"><span class="linenos"> 589</span></a>            <span class="o">+</span> <span class="n">offense</span><span class="p">[</span><span class="s2">&quot;fgm&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;FG 0-19&quot;</span><span class="p">]</span>
</span><span id="League-590"><a href="#League-590"><span class="linenos"> 590</span></a>        <span class="p">)</span>
</span><span id="League-591"><a href="#League-591"><span class="linenos"> 591</span></a>        <span class="n">tes</span> <span class="o">=</span> <span class="n">offense</span><span class="o">.</span><span class="n">position</span> <span class="o">==</span> <span class="s1">&#39;TE&#39;</span>
</span><span id="League-592"><a href="#League-592"><span class="linenos"> 592</span></a>        <span class="n">offense</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">tes</span><span class="p">,</span><span class="s1">&#39;points&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">offense</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">tes</span><span class="p">,</span><span class="s1">&#39;rec&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s1">&#39;TE Rec Bonus&#39;</span><span class="p">]</span> <span class="o">+</span> \
</span><span id="League-593"><a href="#League-593"><span class="linenos"> 593</span></a>        <span class="p">(</span><span class="n">offense</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">tes</span><span class="p">,</span><span class="s1">&#39;rush_first_down&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">offense</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">tes</span><span class="p">,</span><span class="s1">&#39;rec_first_down&#39;</span><span class="p">]</span> <span class="o">+</span> \
</span><span id="League-594"><a href="#League-594"><span class="linenos"> 594</span></a>        <span class="n">offense</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">tes</span><span class="p">,</span><span class="s1">&#39;pass_first_down&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s1">&#39;TE 1D Bonus&#39;</span><span class="p">]</span>
</span><span id="League-595"><a href="#League-595"><span class="linenos"> 595</span></a>        <span class="n">offense</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">offense</span><span class="o">.</span><span class="n">pass_yds</span> <span class="o">&gt;=</span> <span class="mi">300</span><span class="p">,</span><span class="s1">&#39;points&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s1">&#39;Pass 300+&#39;</span><span class="p">]</span>
</span><span id="League-596"><a href="#League-596"><span class="linenos"> 596</span></a>        <span class="n">offense</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">offense</span><span class="o">.</span><span class="n">rush_yds</span> <span class="o">&gt;=</span> <span class="mi">100</span><span class="p">,</span><span class="s1">&#39;points&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s1">&#39;Rush 100+&#39;</span><span class="p">]</span>
</span><span id="League-597"><a href="#League-597"><span class="linenos"> 597</span></a>        <span class="n">offense</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">offense</span><span class="o">.</span><span class="n">rec_yds</span> <span class="o">&gt;=</span> <span class="mi">100</span><span class="p">,</span><span class="s1">&#39;points&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s1">&#39;Rec 100+&#39;</span><span class="p">]</span>
</span><span id="League-598"><a href="#League-598"><span class="linenos"> 598</span></a>        <span class="n">defense</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">position</span> <span class="o">==</span> <span class="s2">&quot;DEF&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="League-599"><a href="#League-599"><span class="linenos"> 599</span></a>        <span class="n">defense</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League-600"><a href="#League-600"><span class="linenos"> 600</span></a>            <span class="n">defense</span><span class="p">[</span><span class="s2">&quot;sacks&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Sack&quot;</span><span class="p">]</span>
</span><span id="League-601"><a href="#League-601"><span class="linenos"> 601</span></a>            <span class="o">+</span> <span class="n">defense</span><span class="p">[</span><span class="s2">&quot;def_int&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Int&quot;</span><span class="p">]</span>
</span><span id="League-602"><a href="#League-602"><span class="linenos"> 602</span></a>            <span class="o">+</span> <span class="n">defense</span><span class="p">[</span><span class="s2">&quot;fumbles_rec&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Fum Rec&quot;</span><span class="p">]</span>
</span><span id="League-603"><a href="#League-603"><span class="linenos"> 603</span></a>            <span class="o">+</span> <span class="p">(</span><span class="n">defense</span><span class="p">[</span><span class="s2">&quot;def_int_td&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">defense</span><span class="p">[</span><span class="s1">&#39;fumbles_rec_td&#39;</span><span class="p">]</span> 
</span><span id="League-604"><a href="#League-604"><span class="linenos"> 604</span></a>            <span class="o">+</span> <span class="n">defense</span><span class="p">[</span><span class="s2">&quot;kick_ret_td&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">defense</span><span class="p">[</span><span class="s2">&quot;punt_ret_td&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Ret TD&quot;</span><span class="p">]</span>
</span><span id="League-605"><a href="#League-605"><span class="linenos"> 605</span></a>        <span class="p">)</span>
</span><span id="League-606"><a href="#League-606"><span class="linenos"> 606</span></a>        <span class="n">defense</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">defense</span><span class="o">.</span><span class="n">points_allowed</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;points&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Pts Allow 0&quot;</span><span class="p">]</span>
</span><span id="League-607"><a href="#League-607"><span class="linenos"> 607</span></a>        <span class="n">defense</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League-608"><a href="#League-608"><span class="linenos"> 608</span></a>            <span class="p">(</span><span class="n">defense</span><span class="o">.</span><span class="n">points_allowed</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">defense</span><span class="o">.</span><span class="n">points_allowed</span> <span class="o">&lt;=</span> <span class="mi">6</span><span class="p">),</span> <span class="s2">&quot;points&quot;</span>
</span><span id="League-609"><a href="#League-609"><span class="linenos"> 609</span></a>        <span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Pts Allow 1-6&quot;</span><span class="p">]</span>
</span><span id="League-610"><a href="#League-610"><span class="linenos"> 610</span></a>        <span class="n">defense</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League-611"><a href="#League-611"><span class="linenos"> 611</span></a>            <span class="p">(</span><span class="n">defense</span><span class="o">.</span><span class="n">points_allowed</span> <span class="o">&gt;=</span> <span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">defense</span><span class="o">.</span><span class="n">points_allowed</span> <span class="o">&lt;=</span> <span class="mi">13</span><span class="p">),</span> <span class="s2">&quot;points&quot;</span>
</span><span id="League-612"><a href="#League-612"><span class="linenos"> 612</span></a>        <span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Pts Allow 7-13&quot;</span><span class="p">]</span>
</span><span id="League-613"><a href="#League-613"><span class="linenos"> 613</span></a>        <span class="n">defense</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League-614"><a href="#League-614"><span class="linenos"> 614</span></a>            <span class="p">(</span><span class="n">defense</span><span class="o">.</span><span class="n">points_allowed</span> <span class="o">&gt;=</span> <span class="mi">14</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">defense</span><span class="o">.</span><span class="n">points_allowed</span> <span class="o">&lt;=</span> <span class="mi">20</span><span class="p">),</span> <span class="s2">&quot;points&quot;</span>
</span><span id="League-615"><a href="#League-615"><span class="linenos"> 615</span></a>        <span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Pts Allow 14-20&quot;</span><span class="p">]</span>
</span><span id="League-616"><a href="#League-616"><span class="linenos"> 616</span></a>        <span class="n">defense</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League-617"><a href="#League-617"><span class="linenos"> 617</span></a>            <span class="p">(</span><span class="n">defense</span><span class="o">.</span><span class="n">points_allowed</span> <span class="o">&gt;=</span> <span class="mi">21</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">defense</span><span class="o">.</span><span class="n">points_allowed</span> <span class="o">&lt;=</span> <span class="mi">27</span><span class="p">),</span> <span class="s2">&quot;points&quot;</span>
</span><span id="League-618"><a href="#League-618"><span class="linenos"> 618</span></a>        <span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Pts Allow 21-27&quot;</span><span class="p">]</span>
</span><span id="League-619"><a href="#League-619"><span class="linenos"> 619</span></a>        <span class="n">defense</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League-620"><a href="#League-620"><span class="linenos"> 620</span></a>            <span class="p">(</span><span class="n">defense</span><span class="o">.</span><span class="n">points_allowed</span> <span class="o">&gt;=</span> <span class="mi">28</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">defense</span><span class="o">.</span><span class="n">points_allowed</span> <span class="o">&lt;=</span> <span class="mi">34</span><span class="p">),</span> <span class="s2">&quot;points&quot;</span>
</span><span id="League-621"><a href="#League-621"><span class="linenos"> 621</span></a>        <span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Pts Allow 28-34&quot;</span><span class="p">]</span>
</span><span id="League-622"><a href="#League-622"><span class="linenos"> 622</span></a>        <span class="n">defense</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">defense</span><span class="o">.</span><span class="n">points_allowed</span> <span class="o">&gt;=</span> <span class="mi">35</span><span class="p">),</span> <span class="s2">&quot;points&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Pts Allow 35+&quot;</span><span class="p">]</span>
</span><span id="League-623"><a href="#League-623"><span class="linenos"> 623</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">offense</span><span class="p">,</span><span class="n">defense</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="League-624"><a href="#League-624"><span class="linenos"> 624</span></a>    
</span><span id="League-625"><a href="#League-625"><span class="linenos"> 625</span></a>    <span class="k">def</span> <span class="nf">load_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">finish</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="League-626"><a href="#League-626"><span class="linenos"> 626</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="League-627"><a href="#League-627"><span class="linenos"> 627</span></a><span class="sd">        Loads individual player statistics for each game in the specified timeframe </span>
</span><span id="League-628"><a href="#League-628"><span class="linenos"> 628</span></a><span class="sd">        and calculates fantasy points based on league settings. Initially looks for </span>
</span><span id="League-629"><a href="#League-629"><span class="linenos"> 629</span></a><span class="sd">        pre-pulled statistics saved locally and pulls new stats when necessary.</span>
</span><span id="League-630"><a href="#League-630"><span class="linenos"> 630</span></a>
</span><span id="League-631"><a href="#League-631"><span class="linenos"> 631</span></a><span class="sd">        Args:</span>
</span><span id="League-632"><a href="#League-632"><span class="linenos"> 632</span></a><span class="sd">            start (int): year and number of the first week of interest (YYYYWW, e.g. 202102 = week 2 of 2021).  </span>
</span><span id="League-633"><a href="#League-633"><span class="linenos"> 633</span></a><span class="sd">            finish (int): year and number of the last week of interest (YYYYWW, e.g. 202307 = week 7 of 2023).</span>
</span><span id="League-634"><a href="#League-634"><span class="linenos"> 634</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="League-635"><a href="#League-635"><span class="linenos"> 635</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pull_stats</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">finish</span><span class="p">)</span>
</span><span id="League-636"><a href="#League-636"><span class="linenos"> 636</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_points</span><span class="p">()</span>
</span><span id="League-637"><a href="#League-637"><span class="linenos"> 637</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League-638"><a href="#League-638"><span class="linenos"> 638</span></a>            <span class="n">left</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">,</span>
</span><span id="League-639"><a href="#League-639"><span class="linenos"> 639</span></a>            <span class="n">right</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nfl_schedule</span><span class="p">,</span>
</span><span id="League-640"><a href="#League-640"><span class="linenos"> 640</span></a>            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
</span><span id="League-641"><a href="#League-641"><span class="linenos"> 641</span></a>            <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">,</span> <span class="s2">&quot;week&quot;</span><span class="p">,</span> <span class="s2">&quot;team&quot;</span><span class="p">],</span>
</span><span id="League-642"><a href="#League-642"><span class="linenos"> 642</span></a>        <span class="p">)</span>
</span><span id="League-643"><a href="#League-643"><span class="linenos"> 643</span></a>
</span><span id="League-644"><a href="#League-644"><span class="linenos"> 644</span></a>    <span class="k">def</span> <span class="nf">name_corrections</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="League-645"><a href="#League-645"><span class="linenos"> 645</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="League-646"><a href="#League-646"><span class="linenos"> 646</span></a><span class="sd">        Applies name corrections between Pro Football Reference and Yahoo.</span>
</span><span id="League-647"><a href="#League-647"><span class="linenos"> 647</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="League-648"><a href="#League-648"><span class="linenos"> 648</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">load_stats</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">season</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">season</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">week</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="League-649"><a href="#League-649"><span class="linenos"> 649</span></a>        <span class="n">corrections</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
</span><span id="League-650"><a href="#League-650"><span class="linenos"> 650</span></a>            <span class="s2">&quot;https://raw.githubusercontent.com/&quot;</span>
</span><span id="League-651"><a href="#League-651"><span class="linenos"> 651</span></a>            <span class="o">+</span> <span class="s2">&quot;tefirman/FantasySports/main/res/football/name_corrections.csv&quot;</span>
</span><span id="League-652"><a href="#League-652"><span class="linenos"> 652</span></a>        <span class="p">)</span>
</span><span id="League-653"><a href="#League-653"><span class="linenos"> 653</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League-654"><a href="#League-654"><span class="linenos"> 654</span></a>            <span class="n">left</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">corrections</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;name&quot;</span>
</span><span id="League-655"><a href="#League-655"><span class="linenos"> 655</span></a>        <span class="p">)</span>
</span><span id="League-656"><a href="#League-656"><span class="linenos"> 656</span></a>        <span class="n">to_fix</span> <span class="o">=</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">new_name</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span>
</span><span id="League-657"><a href="#League-657"><span class="linenos"> 657</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">to_fix</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">to_fix</span><span class="p">,</span> <span class="s2">&quot;new_name&quot;</span><span class="p">]</span>
</span><span id="League-658"><a href="#League-658"><span class="linenos"> 658</span></a>
</span><span id="League-659"><a href="#League-659"><span class="linenos"> 659</span></a>    <span class="k">def</span> <span class="nf">get_player_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="League-660"><a href="#League-660"><span class="linenos"> 660</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="League-661"><a href="#League-661"><span class="linenos"> 661</span></a><span class="sd">        Maps between Yahoo player ID&#39;s and SportsRef player ID&#39;s based on team rosters and draft results.</span>
</span><span id="League-662"><a href="#League-662"><span class="linenos"> 662</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="League-663"><a href="#League-663"><span class="linenos"> 663</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">nfl_rosters</span> <span class="o">=</span> <span class="n">sr</span><span class="o">.</span><span class="n">get_bulk_rosters</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">season</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">latest_season</span><span class="p">,</span><span class="s2">&quot;NFLRosters.csv&quot;</span><span class="p">)</span>
</span><span id="League-664"><a href="#League-664"><span class="linenos"> 664</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">nfl_rosters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nfl_rosters</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;player&#39;</span><span class="p">:</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;player_id&#39;</span><span class="p">:</span><span class="s1">&#39;player_id_sr&#39;</span><span class="p">,</span><span class="s1">&#39;team&#39;</span><span class="p">:</span><span class="s1">&#39;current_team&#39;</span><span class="p">})</span>
</span><span id="League-665"><a href="#League-665"><span class="linenos"> 665</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League-666"><a href="#League-666"><span class="linenos"> 666</span></a>            <span class="n">left</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">,</span><span class="n">right</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nfl_teams</span><span class="p">[[</span><span class="s2">&quot;real_abbrev&quot;</span><span class="p">,</span> <span class="s2">&quot;yahoo&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
</span><span id="League-667"><a href="#League-667"><span class="linenos"> 667</span></a>                <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;yahoo&quot;</span><span class="p">:</span> <span class="s2">&quot;editorial_team_abbr&quot;</span><span class="p">,</span> <span class="s2">&quot;real_abbrev&quot;</span><span class="p">:</span> <span class="s2">&quot;current_team&quot;</span><span class="p">}</span>
</span><span id="League-668"><a href="#League-668"><span class="linenos"> 668</span></a>            <span class="p">),</span>
</span><span id="League-669"><a href="#League-669"><span class="linenos"> 669</span></a>            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">,</span>
</span><span id="League-670"><a href="#League-670"><span class="linenos"> 670</span></a>            <span class="n">on</span><span class="o">=</span><span class="s2">&quot;editorial_team_abbr&quot;</span><span class="p">,</span>
</span><span id="League-671"><a href="#League-671"><span class="linenos"> 671</span></a>        <span class="p">)</span>
</span><span id="League-672"><a href="#League-672"><span class="linenos"> 672</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">,</span><span class="n">right</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nfl_rosters</span><span class="p">[[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;current_team&#39;</span><span class="p">,</span><span class="s1">&#39;player_id_sr&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>\
</span><span id="League-673"><a href="#League-673"><span class="linenos"> 673</span></a>        <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;player&#39;</span><span class="p">:</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;player_id&#39;</span><span class="p">:</span><span class="s1">&#39;player_id_sr&#39;</span><span class="p">,</span><span class="s1">&#39;team&#39;</span><span class="p">:</span><span class="s1">&#39;current_team&#39;</span><span class="p">}),</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;current_team&#39;</span><span class="p">])</span>
</span><span id="League-674"><a href="#League-674"><span class="linenos"> 674</span></a>        <span class="c1"># Two Michael Carter&#39;s on the same team. What are the odds...</span>
</span><span id="League-675"><a href="#League-675"><span class="linenos"> 675</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">player_id_sr</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;CartMi02&#39;</span><span class="p">])]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="League-676"><a href="#League-676"><span class="linenos"> 676</span></a>        <span class="n">id_check</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;player_id_sr&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;freq&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="League-677"><a href="#League-677"><span class="linenos"> 677</span></a>        <span class="k">if</span> <span class="n">id_check</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="League-678"><a href="#League-678"><span class="linenos"> 678</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Found the same player ID on multiple players: &#39;</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">id_check</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">id_check</span><span class="o">.</span><span class="n">freq</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">,</span><span class="s1">&#39;player_id_sr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()))</span>
</span><span id="League-679"><a href="#League-679"><span class="linenos"> 679</span></a>        <span class="n">defenses</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;DEF&#39;</span><span class="p">])</span>
</span><span id="League-680"><a href="#League-680"><span class="linenos"> 680</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">defenses</span><span class="p">,</span><span class="s1">&#39;player_id_sr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">defenses</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
</span><span id="League-681"><a href="#League-681"><span class="linenos"> 681</span></a>        <span class="n">latest_draft</span> <span class="o">=</span> <span class="n">sr</span><span class="o">.</span><span class="n">get_draft</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">latest_season</span><span class="p">)[[</span><span class="s1">&#39;player&#39;</span><span class="p">,</span><span class="s1">&#39;player_id&#39;</span><span class="p">,</span><span class="s1">&#39;team_abbrev&#39;</span><span class="p">]]</span>\
</span><span id="League-682"><a href="#League-682"><span class="linenos"> 682</span></a>        <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;player&#39;</span><span class="p">:</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;player_id&#39;</span><span class="p">:</span><span class="s1">&#39;player_id_sr&#39;</span><span class="p">,</span><span class="s1">&#39;team_abbrev&#39;</span><span class="p">:</span><span class="s1">&#39;current_team&#39;</span><span class="p">})</span>
</span><span id="League-683"><a href="#League-683"><span class="linenos"> 683</span></a>        <span class="n">missing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">player_id_sr</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">latest_draft</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
</span><span id="League-684"><a href="#League-684"><span class="linenos"> 684</span></a>        <span class="n">unsigned</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[</span><span class="n">missing</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="League-685"><a href="#League-685"><span class="linenos"> 685</span></a>        <span class="k">del</span> <span class="n">unsigned</span><span class="p">[</span><span class="s1">&#39;player_id_sr&#39;</span><span class="p">]</span>
</span><span id="League-686"><a href="#League-686"><span class="linenos"> 686</span></a>        <span class="n">unsigned</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">unsigned</span><span class="p">,</span><span class="n">right</span><span class="o">=</span><span class="n">latest_draft</span><span class="p">[[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;current_team&#39;</span><span class="p">,</span><span class="s1">&#39;player_id_sr&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span><span class="n">keep</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">),</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;current_team&#39;</span><span class="p">])</span>
</span><span id="League-687"><a href="#League-687"><span class="linenos"> 687</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[</span><span class="o">~</span><span class="n">missing</span><span class="p">],</span><span class="n">unsigned</span><span class="p">],</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="League-688"><a href="#League-688"><span class="linenos"> 688</span></a>        <span class="n">missing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">player_id_sr</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nfl_rosters</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
</span><span id="League-689"><a href="#League-689"><span class="linenos"> 689</span></a>        <span class="n">closest</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[</span><span class="n">missing</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="League-690"><a href="#League-690"><span class="linenos"> 690</span></a>        <span class="k">del</span> <span class="n">closest</span><span class="p">[</span><span class="s1">&#39;player_id_sr&#39;</span><span class="p">],</span> <span class="n">closest</span><span class="p">[</span><span class="s1">&#39;current_team&#39;</span><span class="p">]</span>
</span><span id="League-691"><a href="#League-691"><span class="linenos"> 691</span></a>        <span class="n">closest</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">closest</span><span class="p">,</span><span class="n">right</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nfl_rosters</span><span class="p">[[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;current_team&#39;</span><span class="p">,</span><span class="s1">&#39;player_id_sr&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span><span class="n">keep</span><span class="o">=</span><span class="s1">&#39;last&#39;</span><span class="p">),</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
</span><span id="League-692"><a href="#League-692"><span class="linenos"> 692</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[</span><span class="o">~</span><span class="n">missing</span><span class="p">],</span><span class="n">closest</span><span class="p">],</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="League-693"><a href="#League-693"><span class="linenos"> 693</span></a>        <span class="n">still_missing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">player_id_sr</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span>
</span><span id="League-694"><a href="#League-694"><span class="linenos"> 694</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">still_missing</span><span class="p">,</span><span class="s1">&#39;player_id_sr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">still_missing</span><span class="p">,</span><span class="s1">&#39;player_id&#39;</span><span class="p">]</span>
</span><span id="League-695"><a href="#League-695"><span class="linenos"> 695</span></a>
</span><span id="League-696"><a href="#League-696"><span class="linenos"> 696</span></a>    <span class="k">def</span> <span class="nf">load_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">earliest</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">reference_games</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">basaloppstringtime</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]):</span>
</span><span id="League-697"><a href="#League-697"><span class="linenos"> 697</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="League-698"><a href="#League-698"><span class="linenos"> 698</span></a><span class="sd">        Initializes rate adjustment parameters for future season simulations. </span>
</span><span id="League-699"><a href="#League-699"><span class="linenos"> 699</span></a><span class="sd">        If parameters are not manually, optimal values are chosen based on </span>
</span><span id="League-700"><a href="#League-700"><span class="linenos"> 700</span></a><span class="sd">        maximum likelihood fitting over five years.</span>
</span><span id="League-701"><a href="#League-701"><span class="linenos"> 701</span></a>
</span><span id="League-702"><a href="#League-702"><span class="linenos"> 702</span></a><span class="sd">        Args:</span>
</span><span id="League-703"><a href="#League-703"><span class="linenos"> 703</span></a><span class="sd">            earliest (int, optional): year and number of the earliest week to be included in the prior for rate calculation, defaults to None.  </span>
</span><span id="League-704"><a href="#League-704"><span class="linenos"> 704</span></a><span class="sd">            reference_games (int, optional): number of games to include the prior for rate calculation, defaults to None.  </span>
</span><span id="League-705"><a href="#League-705"><span class="linenos"> 705</span></a><span class="sd">            basaloppstringtime (list, optional): list containing the basal factor, opponent elo factor, and depth chart factor, defaults to [].</span>
</span><span id="League-706"><a href="#League-706"><span class="linenos"> 706</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="League-707"><a href="#League-707"><span class="linenos"> 707</span></a>        <span class="n">params</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
</span><span id="League-708"><a href="#League-708"><span class="linenos"> 708</span></a>            <span class="s2">&quot;https://raw.githubusercontent.com/&quot;</span>
</span><span id="League-709"><a href="#League-709"><span class="linenos"> 709</span></a>            <span class="o">+</span> <span class="s2">&quot;tefirman/FantasySports/main/res/football/weighting_factors.csv&quot;</span>
</span><span id="League-710"><a href="#League-710"><span class="linenos"> 710</span></a>        <span class="p">)</span>
</span><span id="League-711"><a href="#League-711"><span class="linenos"> 711</span></a>        <span class="k">if</span> <span class="n">earliest</span><span class="p">:</span>
</span><span id="League-712"><a href="#League-712"><span class="linenos"> 712</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">earliest</span> <span class="o">=</span> <span class="n">earliest</span>
</span><span id="League-713"><a href="#League-713"><span class="linenos"> 713</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="League-714"><a href="#League-714"><span class="linenos"> 714</span></a>            <span class="n">prior</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">params</span><span class="o">.</span><span class="n">week</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">week</span><span class="p">,</span> <span class="s2">&quot;prior&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League-715"><a href="#League-715"><span class="linenos"> 715</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">earliest</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">season</span> <span class="o">-</span> <span class="n">prior</span> <span class="o">//</span> <span class="mi">17</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">week</span> <span class="o">-</span> <span class="n">prior</span> <span class="o">%</span> <span class="mi">17</span>
</span><span id="League-716"><a href="#League-716"><span class="linenos"> 716</span></a>            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">earliest</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">earliest</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">):</span>
</span><span id="League-717"><a href="#League-717"><span class="linenos"> 717</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">earliest</span> <span class="o">-=</span> <span class="mi">83</span>  <span class="c1"># Assuming 17 weeks... Need to change this soon...</span>
</span><span id="League-718"><a href="#League-718"><span class="linenos"> 718</span></a>        <span class="k">if</span> <span class="n">reference_games</span><span class="p">:</span>
</span><span id="League-719"><a href="#League-719"><span class="linenos"> 719</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">reference_games</span> <span class="o">=</span> <span class="n">reference_games</span>
</span><span id="League-720"><a href="#League-720"><span class="linenos"> 720</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="League-721"><a href="#League-721"><span class="linenos"> 721</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">reference_games</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">params</span><span class="o">.</span><span class="n">week</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">week</span><span class="p">,</span> <span class="s2">&quot;games&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League-722"><a href="#League-722"><span class="linenos"> 722</span></a>        <span class="k">if</span> <span class="n">basaloppstringtime</span><span class="p">:</span>
</span><span id="League-723"><a href="#League-723"><span class="linenos"> 723</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">basaloppstringtime</span> <span class="o">=</span> <span class="n">basaloppstringtime</span>
</span><span id="League-724"><a href="#League-724"><span class="linenos"> 724</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="League-725"><a href="#League-725"><span class="linenos"> 725</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">basaloppstringtime</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="League-726"><a href="#League-726"><span class="linenos"> 726</span></a>                <span class="n">params</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League-727"><a href="#League-727"><span class="linenos"> 727</span></a>                    <span class="n">params</span><span class="o">.</span><span class="n">week</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">week</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;basal&quot;</span><span class="p">,</span> <span class="s2">&quot;opp_elo&quot;</span><span class="p">,</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="s2">&quot;time_factor&quot;</span><span class="p">]</span>
</span><span id="League-728"><a href="#League-728"><span class="linenos"> 728</span></a>                <span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League-729"><a href="#League-729"><span class="linenos"> 729</span></a>            <span class="p">)</span>
</span><span id="League-730"><a href="#League-730"><span class="linenos"> 730</span></a>
</span><span id="League-731"><a href="#League-731"><span class="linenos"> 731</span></a>    <span class="k">def</span> <span class="nf">add_injuries</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="League-732"><a href="#League-732"><span class="linenos"> 732</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="League-733"><a href="#League-733"><span class="linenos"> 733</span></a><span class="sd">        Adds manual projections for injury timespans. If a new injury pops up </span>
</span><span id="League-734"><a href="#League-734"><span class="linenos"> 734</span></a><span class="sd">        and no projection has been provided yet, timespan defaults to one week.</span>
</span><span id="League-735"><a href="#League-735"><span class="linenos"> 735</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="League-736"><a href="#League-736"><span class="linenos"> 736</span></a>        <span class="n">as_of</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">season</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">week</span>
</span><span id="League-737"><a href="#League-737"><span class="linenos"> 737</span></a>        <span class="k">if</span> <span class="s2">&quot;until&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="League-738"><a href="#League-738"><span class="linenos"> 738</span></a>            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[</span><span class="s2">&quot;until&quot;</span><span class="p">]</span>
</span><span id="League-739"><a href="#League-739"><span class="linenos"> 739</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[</span><span class="s2">&quot;until&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;NaN&quot;</span><span class="p">)</span>
</span><span id="League-740"><a href="#League-740"><span class="linenos"> 740</span></a>        <span class="k">if</span> <span class="n">as_of</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">latest_season</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_week</span><span class="p">:</span>
</span><span id="League-741"><a href="#League-741"><span class="linenos"> 741</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">load_stats</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">season</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">season</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="mi">17</span><span class="p">)</span>
</span><span id="League-742"><a href="#League-742"><span class="linenos"> 742</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League-743"><a href="#League-743"><span class="linenos"> 743</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">season</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">week</span> <span class="o">&gt;=</span> <span class="n">as_of</span>
</span><span id="League-744"><a href="#League-744"><span class="linenos"> 744</span></a>            <span class="p">]</span>
</span><span id="League-745"><a href="#League-745"><span class="linenos"> 745</span></a>            <span class="n">healthy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League-746"><a href="#League-746"><span class="linenos"> 746</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">season</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">week</span> <span class="o">==</span> <span class="n">as_of</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span>
</span><span id="League-747"><a href="#League-747"><span class="linenos"> 747</span></a>            <span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="League-748"><a href="#League-748"><span class="linenos"> 748</span></a>            <span class="n">injured</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League-749"><a href="#League-749"><span class="linenos"> 749</span></a>                <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">healthy</span><span class="p">),</span> <span class="s2">&quot;name&quot;</span>
</span><span id="League-750"><a href="#League-750"><span class="linenos"> 750</span></a>            <span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="League-751"><a href="#League-751"><span class="linenos"> 751</span></a>            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">injured</span><span class="p">:</span>
</span><span id="League-752"><a href="#League-752"><span class="linenos"> 752</span></a>                <span class="n">until</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">name</span><span class="p">,</span> <span class="s2">&quot;week&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="League-753"><a href="#League-753"><span class="linenos"> 753</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">until</span><span class="p">):</span>
</span><span id="League-754"><a href="#League-754"><span class="linenos"> 754</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">name</span><span class="p">,</span> <span class="s2">&quot;until&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">until</span>
</span><span id="League-755"><a href="#League-755"><span class="linenos"> 755</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">season</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">latest_season</span><span class="p">:</span>
</span><span id="League-756"><a href="#League-756"><span class="linenos"> 756</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">name</span><span class="p">,</span> <span class="s2">&quot;until&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">17</span>
</span><span id="League-757"><a href="#League-757"><span class="linenos"> 757</span></a>        <span class="k">if</span> <span class="n">as_of</span> <span class="o">//</span> <span class="mi">100</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">latest_season</span><span class="p">:</span>
</span><span id="League-758"><a href="#League-758"><span class="linenos"> 758</span></a>            <span class="n">inj_proj</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
</span><span id="League-759"><a href="#League-759"><span class="linenos"> 759</span></a>                <span class="s2">&quot;https://raw.githubusercontent.com/&quot;</span>
</span><span id="League-760"><a href="#League-760"><span class="linenos"> 760</span></a>                <span class="o">+</span> <span class="s2">&quot;tefirman/FantasySports/main/res/football/injured_list.csv&quot;</span>
</span><span id="League-761"><a href="#League-761"><span class="linenos"> 761</span></a>            <span class="p">)</span>
</span><span id="League-762"><a href="#League-762"><span class="linenos"> 762</span></a>            <span class="n">inj_proj</span> <span class="o">=</span> <span class="n">inj_proj</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inj_proj</span><span class="o">.</span><span class="n">until</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_week</span><span class="p">]</span>
</span><span id="League-763"><a href="#League-763"><span class="linenos"> 763</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">players</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League-764"><a href="#League-764"><span class="linenos"> 764</span></a>                <span class="n">left</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;until&quot;</span><span class="p">:</span> <span class="s2">&quot;until_orig&quot;</span><span class="p">}),</span>
</span><span id="League-765"><a href="#League-765"><span class="linenos"> 765</span></a>                <span class="n">right</span><span class="o">=</span><span class="n">inj_proj</span><span class="p">,</span>
</span><span id="League-766"><a href="#League-766"><span class="linenos"> 766</span></a>                <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
</span><span id="League-767"><a href="#League-767"><span class="linenos"> 767</span></a>                <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;player_id_sr&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;position&quot;</span><span class="p">],</span>
</span><span id="League-768"><a href="#League-768"><span class="linenos"> 768</span></a>            <span class="p">)</span>
</span><span id="League-769"><a href="#League-769"><span class="linenos"> 769</span></a>            <span class="k">if</span> <span class="n">as_of</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_week</span><span class="p">:</span>
</span><span id="League-770"><a href="#League-770"><span class="linenos"> 770</span></a>                <span class="n">newInjury</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League-771"><a href="#League-771"><span class="linenos"> 771</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span>
</span><span id="League-772"><a href="#League-772"><span class="linenos"> 772</span></a>                        <span class="p">[</span>
</span><span id="League-773"><a href="#League-773"><span class="linenos"> 773</span></a>                            <span class="s2">&quot;O&quot;</span><span class="p">,</span>
</span><span id="League-774"><a href="#League-774"><span class="linenos"> 774</span></a>                            <span class="s2">&quot;D&quot;</span><span class="p">,</span>
</span><span id="League-775"><a href="#League-775"><span class="linenos"> 775</span></a>                            <span class="s2">&quot;SUSP&quot;</span><span class="p">,</span>
</span><span id="League-776"><a href="#League-776"><span class="linenos"> 776</span></a>                            <span class="s2">&quot;IR&quot;</span><span class="p">,</span>
</span><span id="League-777"><a href="#League-777"><span class="linenos"> 777</span></a>                            <span class="s2">&quot;PUP-R&quot;</span><span class="p">,</span>
</span><span id="League-778"><a href="#League-778"><span class="linenos"> 778</span></a>                            <span class="s2">&quot;PUP-P&quot;</span><span class="p">,</span>
</span><span id="League-779"><a href="#League-779"><span class="linenos"> 779</span></a>                            <span class="s2">&quot;NFI-R&quot;</span><span class="p">,</span>
</span><span id="League-780"><a href="#League-780"><span class="linenos"> 780</span></a>                            <span class="s2">&quot;NA&quot;</span><span class="p">,</span>
</span><span id="League-781"><a href="#League-781"><span class="linenos"> 781</span></a>                            <span class="s2">&quot;COVID-19&quot;</span><span class="p">,</span>
</span><span id="League-782"><a href="#League-782"><span class="linenos"> 782</span></a>                        <span class="p">]</span>
</span><span id="League-783"><a href="#League-783"><span class="linenos"> 783</span></a>                    <span class="p">)</span>
</span><span id="League-784"><a href="#League-784"><span class="linenos"> 784</span></a>                    <span class="o">&amp;</span> <span class="p">(</span>
</span><span id="League-785"><a href="#League-785"><span class="linenos"> 785</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">until</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span>
</span><span id="League-786"><a href="#League-786"><span class="linenos"> 786</span></a>                        <span class="o">|</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">until</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_week</span><span class="p">)</span>
</span><span id="League-787"><a href="#League-787"><span class="linenos"> 787</span></a>                    <span class="p">)</span>
</span><span id="League-788"><a href="#League-788"><span class="linenos"> 788</span></a>                    <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">fantasy_team</span><span class="o">.</span><span class="n">isnull</span><span class="p">())</span>
</span><span id="League-789"><a href="#League-789"><span class="linenos"> 789</span></a>                <span class="p">)</span>  <span class="c1"># | (self.players.WAR &gt;= 0))</span>
</span><span id="League-790"><a href="#League-790"><span class="linenos"> 790</span></a>                <span class="k">if</span> <span class="n">newInjury</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="League-791"><a href="#League-791"><span class="linenos"> 791</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="League-792"><a href="#League-792"><span class="linenos"> 792</span></a>                        <span class="s2">&quot;Need to look up new injuries... &quot;</span>
</span><span id="League-793"><a href="#League-793"><span class="linenos"> 793</span></a>                        <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">newInjury</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
</span><span id="League-794"><a href="#League-794"><span class="linenos"> 794</span></a>                    <span class="p">)</span>
</span><span id="League-795"><a href="#League-795"><span class="linenos"> 795</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">newInjury</span><span class="p">,</span> <span class="s2">&quot;until&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_week</span>
</span><span id="League-796"><a href="#League-796"><span class="linenos"> 796</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">newInjury</span><span class="p">,[</span><span class="s2">&quot;player_id_sr&quot;</span><span class="p">,</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="s2">&quot;position&quot;</span><span class="p">,</span><span class="s2">&quot;status&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;NewInjuries.csv&quot;</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="League-797"><a href="#League-797"><span class="linenos"> 797</span></a>                <span class="n">oldInjury</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League-798"><a href="#League-798"><span class="linenos"> 798</span></a>                    <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span>
</span><span id="League-799"><a href="#League-799"><span class="linenos"> 799</span></a>                        <span class="p">[</span>
</span><span id="League-800"><a href="#League-800"><span class="linenos"> 800</span></a>                            <span class="s2">&quot;O&quot;</span><span class="p">,</span>
</span><span id="League-801"><a href="#League-801"><span class="linenos"> 801</span></a>                            <span class="s2">&quot;D&quot;</span><span class="p">,</span>
</span><span id="League-802"><a href="#League-802"><span class="linenos"> 802</span></a>                            <span class="s2">&quot;SUSP&quot;</span><span class="p">,</span>
</span><span id="League-803"><a href="#League-803"><span class="linenos"> 803</span></a>                            <span class="s2">&quot;IR&quot;</span><span class="p">,</span>
</span><span id="League-804"><a href="#League-804"><span class="linenos"> 804</span></a>                            <span class="s2">&quot;PUP-R&quot;</span><span class="p">,</span>
</span><span id="League-805"><a href="#League-805"><span class="linenos"> 805</span></a>                            <span class="s2">&quot;PUP-P&quot;</span><span class="p">,</span>
</span><span id="League-806"><a href="#League-806"><span class="linenos"> 806</span></a>                            <span class="s2">&quot;NFI-R&quot;</span><span class="p">,</span>
</span><span id="League-807"><a href="#League-807"><span class="linenos"> 807</span></a>                            <span class="s2">&quot;NA&quot;</span><span class="p">,</span>
</span><span id="League-808"><a href="#League-808"><span class="linenos"> 808</span></a>                            <span class="s2">&quot;COVID-19&quot;</span><span class="p">,</span>
</span><span id="League-809"><a href="#League-809"><span class="linenos"> 809</span></a>                        <span class="p">]</span>
</span><span id="League-810"><a href="#League-810"><span class="linenos"> 810</span></a>                    <span class="p">)</span>
</span><span id="League-811"><a href="#League-811"><span class="linenos"> 811</span></a>                    <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">until</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_week</span><span class="p">)</span>
</span><span id="League-812"><a href="#League-812"><span class="linenos"> 812</span></a>                    <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">fantasy_team</span><span class="o">.</span><span class="n">isnull</span><span class="p">())</span>
</span><span id="League-813"><a href="#League-813"><span class="linenos"> 813</span></a>                <span class="p">)</span>  <span class="c1"># | (self.players.WAR &gt;= 0))</span>
</span><span id="League-814"><a href="#League-814"><span class="linenos"> 814</span></a>                <span class="k">if</span> <span class="n">oldInjury</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="League-815"><a href="#League-815"><span class="linenos"> 815</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="League-816"><a href="#League-816"><span class="linenos"> 816</span></a>                        <span class="s2">&quot;Need to update old injuries... &quot;</span>
</span><span id="League-817"><a href="#League-817"><span class="linenos"> 817</span></a>                        <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">oldInjury</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
</span><span id="League-818"><a href="#League-818"><span class="linenos"> 818</span></a>                    <span class="p">)</span>
</span><span id="League-819"><a href="#League-819"><span class="linenos"> 819</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">oldInjury</span><span class="p">,[</span><span class="s2">&quot;player_id_sr&quot;</span><span class="p">,</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="s2">&quot;position&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;OldInjuries.csv&quot;</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="League-820"><a href="#League-820"><span class="linenos"> 820</span></a>                    <span class="c1"># self.players.loc[oldInjury,&#39;until&#39;] = self.current_week</span>
</span><span id="League-821"><a href="#League-821"><span class="linenos"> 821</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[</span><span class="s2">&quot;until&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[[</span><span class="s2">&quot;until_orig&quot;</span><span class="p">,</span> <span class="s2">&quot;until&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="League-822"><a href="#League-822"><span class="linenos"> 822</span></a>            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[</span><span class="s2">&quot;until_orig&quot;</span><span class="p">]</span>
</span><span id="League-823"><a href="#League-823"><span class="linenos"> 823</span></a>
</span><span id="League-824"><a href="#League-824"><span class="linenos"> 824</span></a>    <span class="k">def</span> <span class="nf">add_bye_weeks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="League-825"><a href="#League-825"><span class="linenos"> 825</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="League-826"><a href="#League-826"><span class="linenos"> 826</span></a><span class="sd">        Derives bye weeks based on the current NFL schedule and merges them to the players dataframe.</span>
</span><span id="League-827"><a href="#League-827"><span class="linenos"> 827</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="League-828"><a href="#League-828"><span class="linenos"> 828</span></a>        <span class="n">byes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="League-829"><a href="#League-829"><span class="linenos"> 829</span></a>        <span class="k">for</span> <span class="n">team</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nfl_schedule</span><span class="o">.</span><span class="n">team</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
</span><span id="League-830"><a href="#League-830"><span class="linenos"> 830</span></a>            <span class="n">bye_week</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="League-831"><a href="#League-831"><span class="linenos"> 831</span></a>            <span class="k">while</span> <span class="p">(</span>
</span><span id="League-832"><a href="#League-832"><span class="linenos"> 832</span></a>                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nfl_schedule</span><span class="o">.</span><span class="n">team</span> <span class="o">==</span> <span class="n">team</span><span class="p">)</span>
</span><span id="League-833"><a href="#League-833"><span class="linenos"> 833</span></a>                <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nfl_schedule</span><span class="o">.</span><span class="n">season</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">season</span><span class="p">)</span>
</span><span id="League-834"><a href="#League-834"><span class="linenos"> 834</span></a>                <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nfl_schedule</span><span class="o">.</span><span class="n">week</span> <span class="o">==</span> <span class="n">bye_week</span><span class="p">)</span>
</span><span id="League-835"><a href="#League-835"><span class="linenos"> 835</span></a>            <span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="League-836"><a href="#League-836"><span class="linenos"> 836</span></a>                <span class="n">bye_week</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="League-837"><a href="#League-837"><span class="linenos"> 837</span></a>            <span class="n">byes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">byes</span><span class="p">,</span>
</span><span id="League-838"><a href="#League-838"><span class="linenos"> 838</span></a>                <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;current_team&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">team</span><span class="p">],</span> <span class="s2">&quot;bye_week&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">bye_week</span><span class="p">]})],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span>
</span><span id="League-839"><a href="#League-839"><span class="linenos"> 839</span></a>            <span class="p">)</span>
</span><span id="League-840"><a href="#League-840"><span class="linenos"> 840</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League-841"><a href="#League-841"><span class="linenos"> 841</span></a>            <span class="n">left</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">byes</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;current_team&quot;</span>
</span><span id="League-842"><a href="#League-842"><span class="linenos"> 842</span></a>        <span class="p">)</span>
</span><span id="League-843"><a href="#League-843"><span class="linenos"> 843</span></a>
</span><span id="League-844"><a href="#League-844"><span class="linenos"> 844</span></a>    <span class="k">def</span> <span class="nf">add_roster_pcts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span><span class="p">):</span>
</span><span id="League-845"><a href="#League-845"><span class="linenos"> 845</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="League-846"><a href="#League-846"><span class="linenos"> 846</span></a><span class="sd">        Pulls the percentage of leagues each player is rostered in and merges it into the players dataframe.</span>
</span><span id="League-847"><a href="#League-847"><span class="linenos"> 847</span></a>
</span><span id="League-848"><a href="#League-848"><span class="linenos"> 848</span></a><span class="sd">        Args:</span>
</span><span id="League-849"><a href="#League-849"><span class="linenos"> 849</span></a><span class="sd">            inc (int, optional): number of players to pull per API call, defaults to 25.</span>
</span><span id="League-850"><a href="#League-850"><span class="linenos"> 850</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="League-851"><a href="#League-851"><span class="linenos"> 851</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_oauth</span><span class="p">()</span>
</span><span id="League-852"><a href="#League-852"><span class="linenos"> 852</span></a>        <span class="n">roster_pcts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="League-853"><a href="#League-853"><span class="linenos"> 853</span></a>        <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="n">inc</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="League-854"><a href="#League-854"><span class="linenos"> 854</span></a>            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="League-855"><a href="#League-855"><span class="linenos"> 855</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="League-856"><a href="#League-856"><span class="linenos"> 856</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">refresh_oauth</span><span class="p">()</span>
</span><span id="League-857"><a href="#League-857"><span class="linenos"> 857</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">inc</span> <span class="o">*</span> <span class="n">ind</span> <span class="p">:</span> <span class="n">inc</span> <span class="o">*</span> <span class="p">(</span><span class="n">ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="League-858"><a href="#League-858"><span class="linenos"> 858</span></a>                        <span class="n">pcts</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;count&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">}</span>
</span><span id="League-859"><a href="#League-859"><span class="linenos"> 859</span></a>                        <span class="k">break</span>
</span><span id="League-860"><a href="#League-860"><span class="linenos"> 860</span></a>                    <span class="n">player_ids</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League-861"><a href="#League-861"><span class="linenos"> 861</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">inc</span> <span class="o">*</span> <span class="n">ind</span> <span class="p">:</span> <span class="n">inc</span> <span class="o">*</span> <span class="p">(</span><span class="n">ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
</span><span id="League-862"><a href="#League-862"><span class="linenos"> 862</span></a>                        <span class="o">.</span><span class="n">player_id</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
</span><span id="League-863"><a href="#League-863"><span class="linenos"> 863</span></a>                        <span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="League-864"><a href="#League-864"><span class="linenos"> 864</span></a>                    <span class="p">)</span>
</span><span id="League-865"><a href="#League-865"><span class="linenos"> 865</span></a>                    <span class="n">player_ids</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="League-866"><a href="#League-866"><span class="linenos"> 866</span></a>                        <span class="n">val</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">player_ids</span> <span class="k">if</span> <span class="n">val</span> <span class="o">!=</span> <span class="s2">&quot;nan&quot;</span>
</span><span id="League-867"><a href="#League-867"><span class="linenos"> 867</span></a>                    <span class="p">]</span>
</span><span id="League-868"><a href="#League-868"><span class="linenos"> 868</span></a>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">player_ids</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="League-869"><a href="#League-869"><span class="linenos"> 869</span></a>                        <span class="n">pcts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lg</span><span class="o">.</span><span class="n">yhandler</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="League-870"><a href="#League-870"><span class="linenos"> 870</span></a>                            <span class="s2">&quot;league/</span><span class="si">{}</span><span class="s2">/players;player_keys=</span><span class="si">{}</span><span class="s2">.p.</span><span class="si">{}</span><span class="s2">/percent_owned&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="League-871"><a href="#League-871"><span class="linenos"> 871</span></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">lg_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lg_id</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;,</span><span class="si">{}</span><span class="s2">.p.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lg_id</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">player_ids</span><span class="p">)</span>
</span><span id="League-872"><a href="#League-872"><span class="linenos"> 872</span></a>                            <span class="p">)</span>
</span><span id="League-873"><a href="#League-873"><span class="linenos"> 873</span></a>                        <span class="p">)[</span><span class="s2">&quot;fantasy_content&quot;</span><span class="p">][</span><span class="s2">&quot;league&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;players&quot;</span><span class="p">]</span>
</span><span id="League-874"><a href="#League-874"><span class="linenos"> 874</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="League-875"><a href="#League-875"><span class="linenos"> 875</span></a>                        <span class="n">pcts</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;count&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">}</span>
</span><span id="League-876"><a href="#League-876"><span class="linenos"> 876</span></a>                    <span class="k">break</span>
</span><span id="League-877"><a href="#League-877"><span class="linenos"> 877</span></a>                <span class="k">except</span><span class="p">:</span>
</span><span id="League-878"><a href="#League-878"><span class="linenos"> 878</span></a>                    <span class="n">err_message</span> <span class="o">=</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span>
</span><span id="League-879"><a href="#League-879"><span class="linenos"> 879</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="n">err_message</span><span class="p">)</span>
</span><span id="League-880"><a href="#League-880"><span class="linenos"> 880</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="League-881"><a href="#League-881"><span class="linenos"> 881</span></a>                        <span class="s2">&quot;Roster percentage query crapped out... Waiting 30 seconds and trying again...&quot;</span>
</span><span id="League-882"><a href="#League-882"><span class="linenos"> 882</span></a>                    <span class="p">)</span>
</span><span id="League-883"><a href="#League-883"><span class="linenos"> 883</span></a>                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
</span><span id="League-884"><a href="#League-884"><span class="linenos"> 884</span></a>            <span class="k">for</span> <span class="n">player_ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">pcts</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]):</span>
</span><span id="League-885"><a href="#League-885"><span class="linenos"> 885</span></a>                <span class="n">player</span> <span class="o">=</span> <span class="n">pcts</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">player_ind</span><span class="p">)][</span><span class="s2">&quot;player&quot;</span><span class="p">]</span>
</span><span id="League-886"><a href="#League-886"><span class="linenos"> 886</span></a>                <span class="n">player_id</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="League-887"><a href="#League-887"><span class="linenos"> 887</span></a>                    <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="s2">&quot;player_id&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">player</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;player_id&quot;</span> <span class="ow">in</span> <span class="n">val</span>
</span><span id="League-888"><a href="#League-888"><span class="linenos"> 888</span></a>                <span class="p">]</span>
</span><span id="League-889"><a href="#League-889"><span class="linenos"> 889</span></a>                <span class="c1"># full_name = [val[&quot;name&quot;][&quot;full&quot;] for val in player[0] if &quot;name&quot; in val]</span>
</span><span id="League-890"><a href="#League-890"><span class="linenos"> 890</span></a>                <span class="n">pct_owned</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="League-891"><a href="#League-891"><span class="linenos"> 891</span></a>                    <span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">])</span> <span class="o">/</span> <span class="mf">100.0</span>
</span><span id="League-892"><a href="#League-892"><span class="linenos"> 892</span></a>                    <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">player</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;percent_owned&quot;</span><span class="p">]</span>
</span><span id="League-893"><a href="#League-893"><span class="linenos"> 893</span></a>                    <span class="k">if</span> <span class="s2">&quot;value&quot;</span> <span class="ow">in</span> <span class="n">val</span>
</span><span id="League-894"><a href="#League-894"><span class="linenos"> 894</span></a>                <span class="p">]</span>
</span><span id="League-895"><a href="#League-895"><span class="linenos"> 895</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pct_owned</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="League-896"><a href="#League-896"><span class="linenos"> 896</span></a>                    <span class="c1"># print(&quot;Can&#39;t find roster percentage for {}...&quot;.format(full_name))</span>
</span><span id="League-897"><a href="#League-897"><span class="linenos"> 897</span></a>                    <span class="n">pct_owned</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span>
</span><span id="League-898"><a href="#League-898"><span class="linenos"> 898</span></a>                <span class="n">roster_pcts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">roster_pcts</span><span class="p">,</span>
</span><span id="League-899"><a href="#League-899"><span class="linenos"> 899</span></a>                    <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span><span id="League-900"><a href="#League-900"><span class="linenos"> 900</span></a>                        <span class="p">{</span>
</span><span id="League-901"><a href="#League-901"><span class="linenos"> 901</span></a>                            <span class="s2">&quot;player_id&quot;</span><span class="p">:</span> <span class="n">player_id</span><span class="p">,</span>
</span><span id="League-902"><a href="#League-902"><span class="linenos"> 902</span></a>                            <span class="c1"># &quot;name&quot;: full_name,</span>
</span><span id="League-903"><a href="#League-903"><span class="linenos"> 903</span></a>                            <span class="s2">&quot;pct_rostered&quot;</span><span class="p">:</span> <span class="n">pct_owned</span><span class="p">,</span>
</span><span id="League-904"><a href="#League-904"><span class="linenos"> 904</span></a>                        <span class="p">}</span>
</span><span id="League-905"><a href="#League-905"><span class="linenos"> 905</span></a>                    <span class="p">)],</span>
</span><span id="League-906"><a href="#League-906"><span class="linenos"> 906</span></a>                    <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="League-907"><a href="#League-907"><span class="linenos"> 907</span></a>                    <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="League-908"><a href="#League-908"><span class="linenos"> 908</span></a>                <span class="p">)</span>
</span><span id="League-909"><a href="#League-909"><span class="linenos"> 909</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League-910"><a href="#League-910"><span class="linenos"> 910</span></a>            <span class="n">left</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">roster_pcts</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;player_id&quot;</span><span class="p">]</span><span class="c1">#, &quot;name&quot;]</span>
</span><span id="League-911"><a href="#League-911"><span class="linenos"> 911</span></a>        <span class="p">)</span>
</span><span id="League-912"><a href="#League-912"><span class="linenos"> 912</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">pct_rostered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">pct_rostered</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="League-913"><a href="#League-913"><span class="linenos"> 913</span></a>        <span class="n">not_found</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">player_id</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">player_id_sr</span><span class="p">)</span> \
</span><span id="League-914"><a href="#League-914"><span class="linenos"> 914</span></a>        <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">fantasy_team</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span> <span class="o">|</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">pct_rostered</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">))</span>
</span><span id="League-915"><a href="#League-915"><span class="linenos"> 915</span></a>        <span class="k">if</span> <span class="n">not_found</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="League-916"><a href="#League-916"><span class="linenos"> 916</span></a>            <span class="c1"># What about unsigned draft picks??? Maybe look them up individually?</span>
</span><span id="League-917"><a href="#League-917"><span class="linenos"> 917</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="League-918"><a href="#League-918"><span class="linenos"> 918</span></a>                <span class="s2">&quot;Need to reconcile player names with Pro Football Reference... &quot;</span>
</span><span id="League-919"><a href="#League-919"><span class="linenos"> 919</span></a>                <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">not_found</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">])</span>
</span><span id="League-920"><a href="#League-920"><span class="linenos"> 920</span></a>            <span class="p">)</span>
</span><span id="League-921"><a href="#League-921"><span class="linenos"> 921</span></a>
</span><span id="League-922"><a href="#League-922"><span class="linenos"> 922</span></a>    <span class="k">def</span> <span class="nf">add_depth_charts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="League-923"><a href="#League-923"><span class="linenos"> 923</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="League-924"><a href="#League-924"><span class="linenos"> 924</span></a><span class="sd">        Pulls current team depth charts from ESPN and merges them into the players dataframe.</span>
</span><span id="League-925"><a href="#League-925"><span class="linenos"> 925</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="League-926"><a href="#League-926"><span class="linenos"> 926</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">season</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">latest_season</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">week</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_week</span><span class="p">:</span>
</span><span id="League-927"><a href="#League-927"><span class="linenos"> 927</span></a>            <span class="c1"># Include name corrections here???</span>
</span><span id="League-928"><a href="#League-928"><span class="linenos"> 928</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">players</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">,</span><span class="n">right</span><span class="o">=</span><span class="n">sr</span><span class="o">.</span><span class="n">get_all_depth_charts</span><span class="p">()</span>\
</span><span id="League-929"><a href="#League-929"><span class="linenos"> 929</span></a>            <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;player&#39;</span><span class="p">:</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;pos&#39;</span><span class="p">:</span><span class="s1">&#39;position&#39;</span><span class="p">,</span><span class="s1">&#39;team&#39;</span><span class="p">:</span><span class="s1">&#39;current_team&#39;</span><span class="p">}),</span>\
</span><span id="League-930"><a href="#League-930"><span class="linenos"> 930</span></a>            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;current_team&quot;</span><span class="p">,</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="s1">&#39;position&#39;</span><span class="p">])</span>
</span><span id="League-931"><a href="#League-931"><span class="linenos"> 931</span></a>            <span class="n">missing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">string</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span> <span class="o">&amp;</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;DEF&#39;</span><span class="p">])</span> \
</span><span id="League-932"><a href="#League-932"><span class="linenos"> 932</span></a>            <span class="o">&amp;</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">pct_rostered</span> <span class="o">&gt;</span> <span class="mf">0.05</span><span class="p">)</span> <span class="o">|</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">fantasy_team</span><span class="o">.</span><span class="n">isnull</span><span class="p">())</span> \
</span><span id="League-933"><a href="#League-933"><span class="linenos"> 933</span></a>            <span class="o">&amp;</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;NA&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">until</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span>
</span><span id="League-934"><a href="#League-934"><span class="linenos"> 934</span></a>            <span class="k">if</span> <span class="n">missing</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="League-935"><a href="#League-935"><span class="linenos"> 935</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="League-936"><a href="#League-936"><span class="linenos"> 936</span></a>                    <span class="s2">&quot;Need to reconcile player names with ESPN... &quot;</span>
</span><span id="League-937"><a href="#League-937"><span class="linenos"> 937</span></a>                    <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">missing</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">])</span>
</span><span id="League-938"><a href="#League-938"><span class="linenos"> 938</span></a>                <span class="p">)</span>
</span><span id="League-939"><a href="#League-939"><span class="linenos"> 939</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="League-940"><a href="#League-940"><span class="linenos"> 940</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">load_stats</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">season</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">season</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="mi">17</span><span class="p">)</span>
</span><span id="League-941"><a href="#League-941"><span class="linenos"> 941</span></a>            <span class="n">strings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">season</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">week</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">season</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">week</span><span class="p">]</span>\
</span><span id="League-942"><a href="#League-942"><span class="linenos"> 942</span></a>            <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;season&#39;</span><span class="p">,</span><span class="s1">&#39;week&#39;</span><span class="p">],</span><span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)[[</span><span class="s1">&#39;player_id_sr&#39;</span><span class="p">,</span><span class="s1">&#39;string&#39;</span><span class="p">]]</span>\
</span><span id="League-943"><a href="#League-943"><span class="linenos"> 943</span></a>            <span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;player_id_sr&#39;</span><span class="p">],</span><span class="n">keep</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">)</span>
</span><span id="League-944"><a href="#League-944"><span class="linenos"> 944</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">players</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">,</span><span class="n">right</span><span class="o">=</span><span class="n">strings</span><span class="p">,</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;player_id_sr&#39;</span><span class="p">])</span>
</span><span id="League-945"><a href="#League-945"><span class="linenos"> 945</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">position</span> <span class="o">==</span> <span class="s1">&#39;DEF&#39;</span><span class="p">,</span><span class="s1">&#39;string&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="League-946"><a href="#League-946"><span class="linenos"> 946</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">string</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span>
</span><span id="League-947"><a href="#League-947"><span class="linenos"> 947</span></a>
</span><span id="League-948"><a href="#League-948"><span class="linenos"> 948</span></a>    <span class="k">def</span> <span class="nf">get_rates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reload</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
</span><span id="League-949"><a href="#League-949"><span class="linenos"> 949</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="League-950"><a href="#League-950"><span class="linenos"> 950</span></a><span class="sd">        Calculates the average and standard deviation of fantasy points for each player </span>
</span><span id="League-951"><a href="#League-951"><span class="linenos"> 951</span></a><span class="sd">        based on the specified prior and normalizing with respect to the provided weighting factors.</span>
</span><span id="League-952"><a href="#League-952"><span class="linenos"> 952</span></a>
</span><span id="League-953"><a href="#League-953"><span class="linenos"> 953</span></a><span class="sd">        Args:</span>
</span><span id="League-954"><a href="#League-954"><span class="linenos"> 954</span></a><span class="sd">            reload (bool, optional): whether to reload the statistics dataframe, defaults to True.</span>
</span><span id="League-955"><a href="#League-955"><span class="linenos"> 955</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="League-956"><a href="#League-956"><span class="linenos"> 956</span></a>        <span class="n">as_of</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">season</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">week</span>
</span><span id="League-957"><a href="#League-957"><span class="linenos"> 957</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s2">&quot;stats&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">reload</span><span class="p">:</span>
</span><span id="League-958"><a href="#League-958"><span class="linenos"> 958</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">load_stats</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">earliest</span><span class="p">,</span> <span class="n">as_of</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="League-959"><a href="#League-959"><span class="linenos"> 959</span></a>            <span class="n">rel_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="League-960"><a href="#League-960"><span class="linenos"> 960</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="League-961"><a href="#League-961"><span class="linenos"> 961</span></a>            <span class="n">rel_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">season</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">week</span> <span class="o">&lt;=</span> <span class="n">as_of</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> \
</span><span id="League-962"><a href="#League-962"><span class="linenos"> 962</span></a>            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">season</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">week</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">earliest</span><span class="p">)]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="League-963"><a href="#League-963"><span class="linenos"> 963</span></a>        <span class="n">rel_stats</span><span class="p">[</span><span class="s2">&quot;game_factor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League-964"><a href="#League-964"><span class="linenos"> 964</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">basaloppstringtime</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League-965"><a href="#League-965"><span class="linenos"> 965</span></a>            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">basaloppstringtime</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">rel_stats</span><span class="p">[</span><span class="s2">&quot;elo_diff&quot;</span><span class="p">])</span>
</span><span id="League-966"><a href="#League-966"><span class="linenos"> 966</span></a>            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">basaloppstringtime</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">rel_stats</span><span class="p">[</span><span class="s2">&quot;string&quot;</span><span class="p">])</span>
</span><span id="League-967"><a href="#League-967"><span class="linenos"> 967</span></a>        <span class="p">)</span>
</span><span id="League-968"><a href="#League-968"><span class="linenos"> 968</span></a>        <span class="n">rel_stats</span><span class="p">[</span><span class="s1">&#39;rel_points&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rel_stats</span><span class="o">.</span><span class="n">points</span><span class="o">/</span><span class="n">rel_stats</span><span class="o">.</span><span class="n">game_factor</span>
</span><span id="League-969"><a href="#League-969"><span class="linenos"> 969</span></a>        <span class="n">by_pos</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League-970"><a href="#League-970"><span class="linenos"> 970</span></a>            <span class="n">left</span><span class="o">=</span><span class="n">rel_stats</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;position&quot;</span><span class="p">)</span>
</span><span id="League-971"><a href="#League-971"><span class="linenos"> 971</span></a>            <span class="o">.</span><span class="n">rel_points</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="League-972"><a href="#League-972"><span class="linenos"> 972</span></a>            <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="League-973"><a href="#League-973"><span class="linenos"> 973</span></a>            <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;rel_points&quot;</span><span class="p">:</span> <span class="s2">&quot;points_rate&quot;</span><span class="p">}),</span>
</span><span id="League-974"><a href="#League-974"><span class="linenos"> 974</span></a>            <span class="n">right</span><span class="o">=</span><span class="n">rel_stats</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;position&quot;</span><span class="p">)</span>
</span><span id="League-975"><a href="#League-975"><span class="linenos"> 975</span></a>            <span class="o">.</span><span class="n">rel_points</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
</span><span id="League-976"><a href="#League-976"><span class="linenos"> 976</span></a>            <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="League-977"><a href="#League-977"><span class="linenos"> 977</span></a>            <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;rel_points&quot;</span><span class="p">:</span> <span class="s2">&quot;points_stdev&quot;</span><span class="p">}),</span>
</span><span id="League-978"><a href="#League-978"><span class="linenos"> 978</span></a>            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">,</span>
</span><span id="League-979"><a href="#League-979"><span class="linenos"> 979</span></a>            <span class="n">on</span><span class="o">=</span><span class="s2">&quot;position&quot;</span><span class="p">,</span>
</span><span id="League-980"><a href="#League-980"><span class="linenos"> 980</span></a>        <span class="p">)</span>
</span><span id="League-981"><a href="#League-981"><span class="linenos"> 981</span></a>        <span class="n">by_pos</span><span class="p">[</span><span class="s2">&quot;player_id_sr&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;avg_&quot;</span> <span class="o">+</span> <span class="n">by_pos</span><span class="p">[</span><span class="s2">&quot;position&quot;</span><span class="p">]</span>
</span><span id="League-982"><a href="#League-982"><span class="linenos"> 982</span></a>        <span class="n">rel_stats</span> <span class="o">=</span> <span class="n">rel_stats</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;player_id_sr&quot;</span><span class="p">,</span><span class="s2">&quot;position&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reference_games</span><span class="p">)</span>
</span><span id="League-983"><a href="#League-983"><span class="linenos"> 983</span></a>        <span class="n">rel_stats</span><span class="p">[</span><span class="s2">&quot;weeks_ago&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League-984"><a href="#League-984"><span class="linenos"> 984</span></a>            <span class="mi">17</span> <span class="o">*</span> <span class="p">(</span><span class="n">as_of</span> <span class="o">//</span> <span class="mi">100</span> <span class="o">-</span> <span class="n">rel_stats</span><span class="o">.</span><span class="n">season</span><span class="p">)</span> <span class="o">+</span> <span class="n">as_of</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">-</span> <span class="n">rel_stats</span><span class="o">.</span><span class="n">week</span>
</span><span id="League-985"><a href="#League-985"><span class="linenos"> 985</span></a>        <span class="p">)</span>
</span><span id="League-986"><a href="#League-986"><span class="linenos"> 986</span></a>        <span class="n">rel_stats</span><span class="p">[</span><span class="s2">&quot;time_factor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">rel_stats</span><span class="o">.</span><span class="n">weeks_ago</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">basaloppstringtime</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="League-987"><a href="#League-987"><span class="linenos"> 987</span></a>        <span class="n">rel_stats</span> <span class="o">=</span> <span class="n">rel_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">rel_stats</span><span class="o">.</span><span class="n">time_factor</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="League-988"><a href="#League-988"><span class="linenos"> 988</span></a>        <span class="n">rel_stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League-989"><a href="#League-989"><span class="linenos"> 989</span></a>            <span class="n">left</span><span class="o">=</span><span class="n">rel_stats</span><span class="p">,</span>
</span><span id="League-990"><a href="#League-990"><span class="linenos"> 990</span></a>            <span class="n">right</span><span class="o">=</span><span class="n">rel_stats</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;player_id_sr&quot;</span><span class="p">,</span><span class="s2">&quot;position&quot;</span><span class="p">])</span>
</span><span id="League-991"><a href="#League-991"><span class="linenos"> 991</span></a>            <span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s2">&quot;time_factor&quot;</span><span class="p">:</span> <span class="nb">sum</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;count&quot;</span><span class="p">})</span>
</span><span id="League-992"><a href="#League-992"><span class="linenos"> 992</span></a>            <span class="o">.</span><span class="n">rename</span><span class="p">(</span>
</span><span id="League-993"><a href="#League-993"><span class="linenos"> 993</span></a>                <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;num_games&quot;</span><span class="p">,</span> <span class="s2">&quot;time_factor&quot;</span><span class="p">:</span> <span class="s2">&quot;time_factor_sum&quot;</span><span class="p">}</span>
</span><span id="League-994"><a href="#League-994"><span class="linenos"> 994</span></a>            <span class="p">)</span>
</span><span id="League-995"><a href="#League-995"><span class="linenos"> 995</span></a>            <span class="o">.</span><span class="n">reset_index</span><span class="p">(),</span>
</span><span id="League-996"><a href="#League-996"><span class="linenos"> 996</span></a>            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">,</span>
</span><span id="League-997"><a href="#League-997"><span class="linenos"> 997</span></a>            <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;player_id_sr&quot;</span><span class="p">,</span><span class="s2">&quot;position&quot;</span><span class="p">],</span>
</span><span id="League-998"><a href="#League-998"><span class="linenos"> 998</span></a>        <span class="p">)</span>
</span><span id="League-999"><a href="#League-999"><span class="linenos"> 999</span></a>        <span class="n">rel_stats</span><span class="o">.</span><span class="n">time_factor</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League-1000"><a href="#League-1000"><span class="linenos">1000</span></a>            <span class="n">rel_stats</span><span class="o">.</span><span class="n">time_factor</span> <span class="o">*</span> <span class="n">rel_stats</span><span class="o">.</span><span class="n">num_games</span> <span class="o">/</span> <span class="n">rel_stats</span><span class="o">.</span><span class="n">time_factor_sum</span>
</span><span id="League-1001"><a href="#League-1001"><span class="linenos">1001</span></a>        <span class="p">)</span>
</span><span id="League-1002"><a href="#League-1002"><span class="linenos">1002</span></a>        <span class="n">rel_stats</span><span class="p">[</span><span class="s2">&quot;weighted_points&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rel_stats</span><span class="o">.</span><span class="n">rel_points</span> <span class="o">*</span> <span class="n">rel_stats</span><span class="o">.</span><span class="n">time_factor</span>
</span><span id="League-1003"><a href="#League-1003"><span class="linenos">1003</span></a>        <span class="n">by_player</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League-1004"><a href="#League-1004"><span class="linenos">1004</span></a>            <span class="n">left</span><span class="o">=</span><span class="n">rel_stats</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;player_id_sr&quot;</span><span class="p">,</span><span class="s2">&quot;position&quot;</span><span class="p">])</span>
</span><span id="League-1005"><a href="#League-1005"><span class="linenos">1005</span></a>            <span class="o">.</span><span class="n">weighted_points</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="League-1006"><a href="#League-1006"><span class="linenos">1006</span></a>            <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="League-1007"><a href="#League-1007"><span class="linenos">1007</span></a>            <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;weighted_points&quot;</span><span class="p">:</span> <span class="s2">&quot;points_rate&quot;</span><span class="p">}),</span>
</span><span id="League-1008"><a href="#League-1008"><span class="linenos">1008</span></a>            <span class="n">right</span><span class="o">=</span><span class="n">rel_stats</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;player_id_sr&quot;</span><span class="p">,</span><span class="s2">&quot;position&quot;</span><span class="p">])</span>
</span><span id="League-1009"><a href="#League-1009"><span class="linenos">1009</span></a>            <span class="o">.</span><span class="n">weighted_points</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
</span><span id="League-1010"><a href="#League-1010"><span class="linenos">1010</span></a>            <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="League-1011"><a href="#League-1011"><span class="linenos">1011</span></a>            <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;weighted_points&quot;</span><span class="p">:</span> <span class="s2">&quot;points_stdev&quot;</span><span class="p">}),</span>
</span><span id="League-1012"><a href="#League-1012"><span class="linenos">1012</span></a>            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">,</span>
</span><span id="League-1013"><a href="#League-1013"><span class="linenos">1013</span></a>            <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;player_id_sr&quot;</span><span class="p">,</span><span class="s2">&quot;position&quot;</span><span class="p">],</span>
</span><span id="League-1014"><a href="#League-1014"><span class="linenos">1014</span></a>        <span class="p">)</span>
</span><span id="League-1015"><a href="#League-1015"><span class="linenos">1015</span></a>        <span class="n">by_player</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League-1016"><a href="#League-1016"><span class="linenos">1016</span></a>            <span class="n">left</span><span class="o">=</span><span class="n">by_player</span><span class="p">,</span>
</span><span id="League-1017"><a href="#League-1017"><span class="linenos">1017</span></a>            <span class="n">right</span><span class="o">=</span><span class="n">rel_stats</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;player_id_sr&quot;</span><span class="p">,</span><span class="s2">&quot;position&quot;</span><span class="p">])</span>
</span><span id="League-1018"><a href="#League-1018"><span class="linenos">1018</span></a>            <span class="o">.</span><span class="n">size</span><span class="p">()</span>
</span><span id="League-1019"><a href="#League-1019"><span class="linenos">1019</span></a>            <span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s2">&quot;num_games&quot;</span><span class="p">)</span>
</span><span id="League-1020"><a href="#League-1020"><span class="linenos">1020</span></a>            <span class="o">.</span><span class="n">reset_index</span><span class="p">(),</span>
</span><span id="League-1021"><a href="#League-1021"><span class="linenos">1021</span></a>            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">,</span>
</span><span id="League-1022"><a href="#League-1022"><span class="linenos">1022</span></a>            <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;player_id_sr&quot;</span><span class="p">,</span><span class="s2">&quot;position&quot;</span><span class="p">],</span>
</span><span id="League-1023"><a href="#League-1023"><span class="linenos">1023</span></a>        <span class="p">)</span>
</span><span id="League-1024"><a href="#League-1024"><span class="linenos">1024</span></a>        <span class="n">by_player</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">by_player</span><span class="p">,</span>
</span><span id="League-1025"><a href="#League-1025"><span class="linenos">1025</span></a>            <span class="n">by_pos</span><span class="p">[[</span><span class="s2">&quot;player_id_sr&quot;</span><span class="p">,</span><span class="s2">&quot;position&quot;</span><span class="p">,</span> <span class="s2">&quot;points_rate&quot;</span><span class="p">,</span> <span class="s2">&quot;points_stdev&quot;</span><span class="p">]]],</span>
</span><span id="League-1026"><a href="#League-1026"><span class="linenos">1026</span></a>            <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="League-1027"><a href="#League-1027"><span class="linenos">1027</span></a>            <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="League-1028"><a href="#League-1028"><span class="linenos">1028</span></a>        <span class="p">)</span>
</span><span id="League-1029"><a href="#League-1029"><span class="linenos">1029</span></a>        <span class="n">by_player</span><span class="o">.</span><span class="n">points_stdev</span> <span class="o">=</span> <span class="n">by_player</span><span class="o">.</span><span class="n">points_stdev</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="League-1030"><a href="#League-1030"><span class="linenos">1030</span></a>        <span class="n">by_player</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League-1031"><a href="#League-1031"><span class="linenos">1031</span></a>            <span class="n">left</span><span class="o">=</span><span class="n">by_player</span><span class="p">,</span>
</span><span id="League-1032"><a href="#League-1032"><span class="linenos">1032</span></a>            <span class="n">right</span><span class="o">=</span><span class="n">by_pos</span><span class="p">[[</span><span class="s2">&quot;position&quot;</span><span class="p">,</span> <span class="s2">&quot;points_rate&quot;</span><span class="p">,</span> <span class="s2">&quot;points_stdev&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
</span><span id="League-1033"><a href="#League-1033"><span class="linenos">1033</span></a>                <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;points_rate&quot;</span><span class="p">:</span> <span class="s2">&quot;pos_avg&quot;</span><span class="p">,</span> <span class="s2">&quot;points_stdev&quot;</span><span class="p">:</span> <span class="s2">&quot;pos_stdev&quot;</span><span class="p">}</span>
</span><span id="League-1034"><a href="#League-1034"><span class="linenos">1034</span></a>            <span class="p">),</span>
</span><span id="League-1035"><a href="#League-1035"><span class="linenos">1035</span></a>            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">,</span>
</span><span id="League-1036"><a href="#League-1036"><span class="linenos">1036</span></a>            <span class="n">on</span><span class="o">=</span><span class="s2">&quot;position&quot;</span><span class="p">,</span>
</span><span id="League-1037"><a href="#League-1037"><span class="linenos">1037</span></a>        <span class="p">)</span>
</span><span id="League-1038"><a href="#League-1038"><span class="linenos">1038</span></a>        <span class="n">inds</span> <span class="o">=</span> <span class="n">by_player</span><span class="o">.</span><span class="n">num_games</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">reference_games</span>
</span><span id="League-1039"><a href="#League-1039"><span class="linenos">1039</span></a>        <span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inds</span><span class="p">,</span> <span class="s2">&quot;points_squared&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League-1040"><a href="#League-1040"><span class="linenos">1040</span></a>            <span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inds</span><span class="p">,</span> <span class="s2">&quot;num_games&quot;</span><span class="p">]</span>
</span><span id="League-1041"><a href="#League-1041"><span class="linenos">1041</span></a>            <span class="o">*</span> <span class="p">(</span>
</span><span id="League-1042"><a href="#League-1042"><span class="linenos">1042</span></a>                <span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inds</span><span class="p">,</span> <span class="s2">&quot;points_stdev&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="League-1043"><a href="#League-1043"><span class="linenos">1043</span></a>                <span class="o">+</span> <span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inds</span><span class="p">,</span> <span class="s2">&quot;points_rate&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="League-1044"><a href="#League-1044"><span class="linenos">1044</span></a>            <span class="p">)</span>
</span><span id="League-1045"><a href="#League-1045"><span class="linenos">1045</span></a>            <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reference_games</span> <span class="o">-</span> <span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inds</span><span class="p">,</span> <span class="s2">&quot;num_games&quot;</span><span class="p">])</span>
</span><span id="League-1046"><a href="#League-1046"><span class="linenos">1046</span></a>            <span class="o">*</span> <span class="p">(</span>
</span><span id="League-1047"><a href="#League-1047"><span class="linenos">1047</span></a>                <span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inds</span><span class="p">,</span> <span class="s2">&quot;pos_stdev&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="League-1048"><a href="#League-1048"><span class="linenos">1048</span></a>                <span class="o">+</span> <span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inds</span><span class="p">,</span> <span class="s2">&quot;pos_avg&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="League-1049"><a href="#League-1049"><span class="linenos">1049</span></a>            <span class="p">)</span>
</span><span id="League-1050"><a href="#League-1050"><span class="linenos">1050</span></a>        <span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">reference_games</span>
</span><span id="League-1051"><a href="#League-1051"><span class="linenos">1051</span></a>        <span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inds</span><span class="p">,</span> <span class="s2">&quot;points_rate&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League-1052"><a href="#League-1052"><span class="linenos">1052</span></a>            <span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inds</span><span class="p">,</span> <span class="s2">&quot;num_games&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inds</span><span class="p">,</span> <span class="s2">&quot;points_rate&quot;</span><span class="p">]</span>
</span><span id="League-1053"><a href="#League-1053"><span class="linenos">1053</span></a>            <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reference_games</span> <span class="o">-</span> <span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inds</span><span class="p">,</span> <span class="s2">&quot;num_games&quot;</span><span class="p">])</span>
</span><span id="League-1054"><a href="#League-1054"><span class="linenos">1054</span></a>            <span class="o">*</span> <span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inds</span><span class="p">,</span> <span class="s2">&quot;pos_avg&quot;</span><span class="p">]</span>
</span><span id="League-1055"><a href="#League-1055"><span class="linenos">1055</span></a>        <span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">reference_games</span>
</span><span id="League-1056"><a href="#League-1056"><span class="linenos">1056</span></a>        <span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inds</span><span class="p">,</span> <span class="s2">&quot;points_stdev&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League-1057"><a href="#League-1057"><span class="linenos">1057</span></a>            <span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inds</span><span class="p">,</span> <span class="s2">&quot;points_squared&quot;</span><span class="p">]</span>
</span><span id="League-1058"><a href="#League-1058"><span class="linenos">1058</span></a>            <span class="o">-</span> <span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inds</span><span class="p">,</span> <span class="s2">&quot;points_rate&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="League-1059"><a href="#League-1059"><span class="linenos">1059</span></a>        <span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span>
</span><span id="League-1060"><a href="#League-1060"><span class="linenos">1060</span></a>        <span class="n">by_player</span><span class="o">.</span><span class="n">player_id_sr</span> <span class="o">=</span> <span class="n">by_player</span><span class="o">.</span><span class="n">player_id_sr</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="League-1061"><a href="#League-1061"><span class="linenos">1061</span></a>        <span class="n">league_avg</span> <span class="o">=</span> <span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">by_player</span><span class="o">.</span><span class="n">player_id_sr</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;avg_&quot;</span><span class="p">)]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="League-1062"><a href="#League-1062"><span class="linenos">1062</span></a>        <span class="n">league_avg</span><span class="p">[</span><span class="s1">&#39;string&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2.0</span>
</span><span id="League-1063"><a href="#League-1063"><span class="linenos">1063</span></a>        <span class="n">by_player</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League-1064"><a href="#League-1064"><span class="linenos">1064</span></a>            <span class="n">left</span><span class="o">=</span><span class="n">by_player</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;num_games&#39;</span><span class="p">,</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>\
</span><span id="League-1065"><a href="#League-1065"><span class="linenos">1065</span></a>            <span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;player_id_sr&#39;</span><span class="p">],</span><span class="n">keep</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">,</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
</span><span id="League-1066"><a href="#League-1066"><span class="linenos">1066</span></a>            <span class="n">right</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[</span>
</span><span id="League-1067"><a href="#League-1067"><span class="linenos">1067</span></a>                <span class="p">[</span>
</span><span id="League-1068"><a href="#League-1068"><span class="linenos">1068</span></a>                    <span class="s2">&quot;player_id_sr&quot;</span><span class="p">,</span>
</span><span id="League-1069"><a href="#League-1069"><span class="linenos">1069</span></a>                    <span class="s2">&quot;player_id&quot;</span><span class="p">,</span>
</span><span id="League-1070"><a href="#League-1070"><span class="linenos">1070</span></a>                    <span class="s2">&quot;status&quot;</span><span class="p">,</span>
</span><span id="League-1071"><a href="#League-1071"><span class="linenos">1071</span></a>                    <span class="s2">&quot;fantasy_team&quot;</span><span class="p">,</span>
</span><span id="League-1072"><a href="#League-1072"><span class="linenos">1072</span></a>                    <span class="s2">&quot;current_team&quot;</span><span class="p">,</span>
</span><span id="League-1073"><a href="#League-1073"><span class="linenos">1073</span></a>                    <span class="s2">&quot;position&quot;</span><span class="p">,</span>
</span><span id="League-1074"><a href="#League-1074"><span class="linenos">1074</span></a>                    <span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span id="League-1075"><a href="#League-1075"><span class="linenos">1075</span></a>                    <span class="s2">&quot;until&quot;</span><span class="p">,</span>
</span><span id="League-1076"><a href="#League-1076"><span class="linenos">1076</span></a>                    <span class="s2">&quot;bye_week&quot;</span><span class="p">,</span>
</span><span id="League-1077"><a href="#League-1077"><span class="linenos">1077</span></a>                    <span class="s2">&quot;pct_rostered&quot;</span><span class="p">,</span>
</span><span id="League-1078"><a href="#League-1078"><span class="linenos">1078</span></a>                    <span class="s2">&quot;selected_position&quot;</span><span class="p">,</span>
</span><span id="League-1079"><a href="#League-1079"><span class="linenos">1079</span></a>                <span class="p">]</span>
</span><span id="League-1080"><a href="#League-1080"><span class="linenos">1080</span></a>            <span class="p">]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(),</span>
</span><span id="League-1081"><a href="#League-1081"><span class="linenos">1081</span></a>            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span>
</span><span id="League-1082"><a href="#League-1082"><span class="linenos">1082</span></a>            <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;player_id_sr&quot;</span><span class="p">,</span><span class="s2">&quot;position&quot;</span><span class="p">],</span>
</span><span id="League-1083"><a href="#League-1083"><span class="linenos">1083</span></a>        <span class="p">)</span>
</span><span id="League-1084"><a href="#League-1084"><span class="linenos">1084</span></a>        <span class="n">rookies</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League-1085"><a href="#League-1085"><span class="linenos">1085</span></a>            <span class="n">left</span><span class="o">=</span><span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League-1086"><a href="#League-1086"><span class="linenos">1086</span></a>                <span class="n">by_player</span><span class="o">.</span><span class="n">num_games</span><span class="o">.</span><span class="n">isnull</span><span class="p">(),</span>
</span><span id="League-1087"><a href="#League-1087"><span class="linenos">1087</span></a>                <span class="p">[</span>
</span><span id="League-1088"><a href="#League-1088"><span class="linenos">1088</span></a>                    <span class="s2">&quot;player_id_sr&quot;</span><span class="p">,</span>
</span><span id="League-1089"><a href="#League-1089"><span class="linenos">1089</span></a>                    <span class="s2">&quot;player_id&quot;</span><span class="p">,</span>
</span><span id="League-1090"><a href="#League-1090"><span class="linenos">1090</span></a>                    <span class="s2">&quot;status&quot;</span><span class="p">,</span>
</span><span id="League-1091"><a href="#League-1091"><span class="linenos">1091</span></a>                    <span class="s2">&quot;fantasy_team&quot;</span><span class="p">,</span>
</span><span id="League-1092"><a href="#League-1092"><span class="linenos">1092</span></a>                    <span class="s2">&quot;current_team&quot;</span><span class="p">,</span>
</span><span id="League-1093"><a href="#League-1093"><span class="linenos">1093</span></a>                    <span class="s2">&quot;position&quot;</span><span class="p">,</span>
</span><span id="League-1094"><a href="#League-1094"><span class="linenos">1094</span></a>                    <span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span id="League-1095"><a href="#League-1095"><span class="linenos">1095</span></a>                    <span class="s2">&quot;until&quot;</span><span class="p">,</span>
</span><span id="League-1096"><a href="#League-1096"><span class="linenos">1096</span></a>                    <span class="s2">&quot;bye_week&quot;</span><span class="p">,</span>
</span><span id="League-1097"><a href="#League-1097"><span class="linenos">1097</span></a>                    <span class="s2">&quot;pct_rostered&quot;</span><span class="p">,</span>
</span><span id="League-1098"><a href="#League-1098"><span class="linenos">1098</span></a>                    <span class="s2">&quot;selected_position&quot;</span><span class="p">,</span>
</span><span id="League-1099"><a href="#League-1099"><span class="linenos">1099</span></a>                <span class="p">],</span>
</span><span id="League-1100"><a href="#League-1100"><span class="linenos">1100</span></a>            <span class="p">],</span>
</span><span id="League-1101"><a href="#League-1101"><span class="linenos">1101</span></a>            <span class="n">right</span><span class="o">=</span><span class="n">league_avg</span><span class="p">[[</span><span class="s2">&quot;position&quot;</span><span class="p">,</span> <span class="s2">&quot;points_rate&quot;</span><span class="p">,</span> <span class="s2">&quot;points_stdev&quot;</span><span class="p">]],</span>
</span><span id="League-1102"><a href="#League-1102"><span class="linenos">1102</span></a>            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">,</span>
</span><span id="League-1103"><a href="#League-1103"><span class="linenos">1103</span></a>            <span class="n">on</span><span class="o">=</span><span class="s2">&quot;position&quot;</span><span class="p">,</span>
</span><span id="League-1104"><a href="#League-1104"><span class="linenos">1104</span></a>        <span class="p">)</span>
</span><span id="League-1105"><a href="#League-1105"><span class="linenos">1105</span></a>        <span class="n">by_player</span> <span class="o">=</span> <span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">by_player</span><span class="o">.</span><span class="n">num_games</span><span class="o">.</span><span class="n">isnull</span><span class="p">()]</span>
</span><span id="League-1106"><a href="#League-1106"><span class="linenos">1106</span></a>        <span class="n">by_player</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">by_player</span><span class="p">,</span>
</span><span id="League-1107"><a href="#League-1107"><span class="linenos">1107</span></a>            <span class="n">rookies</span><span class="p">[</span>
</span><span id="League-1108"><a href="#League-1108"><span class="linenos">1108</span></a>                <span class="p">[</span>
</span><span id="League-1109"><a href="#League-1109"><span class="linenos">1109</span></a>                    <span class="s2">&quot;player_id_sr&quot;</span><span class="p">,</span>
</span><span id="League-1110"><a href="#League-1110"><span class="linenos">1110</span></a>                    <span class="s2">&quot;player_id&quot;</span><span class="p">,</span>
</span><span id="League-1111"><a href="#League-1111"><span class="linenos">1111</span></a>                    <span class="s2">&quot;status&quot;</span><span class="p">,</span>
</span><span id="League-1112"><a href="#League-1112"><span class="linenos">1112</span></a>                    <span class="s2">&quot;fantasy_team&quot;</span><span class="p">,</span>
</span><span id="League-1113"><a href="#League-1113"><span class="linenos">1113</span></a>                    <span class="s2">&quot;current_team&quot;</span><span class="p">,</span>
</span><span id="League-1114"><a href="#League-1114"><span class="linenos">1114</span></a>                    <span class="s2">&quot;position&quot;</span><span class="p">,</span>
</span><span id="League-1115"><a href="#League-1115"><span class="linenos">1115</span></a>                    <span class="s2">&quot;points_rate&quot;</span><span class="p">,</span>
</span><span id="League-1116"><a href="#League-1116"><span class="linenos">1116</span></a>                    <span class="s2">&quot;points_stdev&quot;</span><span class="p">,</span>
</span><span id="League-1117"><a href="#League-1117"><span class="linenos">1117</span></a>                    <span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span id="League-1118"><a href="#League-1118"><span class="linenos">1118</span></a>                    <span class="s2">&quot;until&quot;</span><span class="p">,</span>
</span><span id="League-1119"><a href="#League-1119"><span class="linenos">1119</span></a>                    <span class="s2">&quot;bye_week&quot;</span><span class="p">,</span>
</span><span id="League-1120"><a href="#League-1120"><span class="linenos">1120</span></a>                    <span class="s2">&quot;pct_rostered&quot;</span><span class="p">,</span>
</span><span id="League-1121"><a href="#League-1121"><span class="linenos">1121</span></a>                    <span class="s2">&quot;selected_position&quot;</span><span class="p">,</span>
</span><span id="League-1122"><a href="#League-1122"><span class="linenos">1122</span></a>                <span class="p">]</span>
</span><span id="League-1123"><a href="#League-1123"><span class="linenos">1123</span></a>            <span class="p">],</span>
</span><span id="League-1124"><a href="#League-1124"><span class="linenos">1124</span></a>            <span class="n">league_avg</span><span class="p">],</span>
</span><span id="League-1125"><a href="#League-1125"><span class="linenos">1125</span></a>            <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="League-1126"><a href="#League-1126"><span class="linenos">1126</span></a>            <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="League-1127"><a href="#League-1127"><span class="linenos">1127</span></a>        <span class="p">)</span>
</span><span id="League-1128"><a href="#League-1128"><span class="linenos">1128</span></a>        <span class="n">by_player</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">by_player</span><span class="p">,</span><span class="n">right</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nfl_rosters</span><span class="p">[[</span><span class="s1">&#39;player_id_sr&#39;</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">]]</span>\
</span><span id="League-1129"><a href="#League-1129"><span class="linenos">1129</span></a>        <span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;player_id_sr&#39;</span><span class="p">],</span><span class="n">keep</span><span class="o">=</span><span class="s1">&#39;last&#39;</span><span class="p">),</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="s1">&#39;player_id_sr&#39;</span><span class="p">)</span>
</span><span id="League-1130"><a href="#League-1130"><span class="linenos">1130</span></a>        <span class="n">by_player</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">by_player</span><span class="p">,</span><span class="n">right</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[[</span><span class="s1">&#39;player_id&#39;</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">]]</span>\
</span><span id="League-1131"><a href="#League-1131"><span class="linenos">1131</span></a>        <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s1">&#39;yahoo_name&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(),</span><span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="s1">&#39;player_id&#39;</span><span class="p">)</span>
</span><span id="League-1132"><a href="#League-1132"><span class="linenos">1132</span></a>        <span class="n">missing</span> <span class="o">=</span> <span class="n">by_player</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">by_player</span><span class="o">.</span><span class="n">yahoo_name</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span>
</span><span id="League-1133"><a href="#League-1133"><span class="linenos">1133</span></a>        <span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">missing</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">missing</span><span class="p">,</span><span class="s1">&#39;yahoo_name&#39;</span><span class="p">]</span>
</span><span id="League-1134"><a href="#League-1134"><span class="linenos">1134</span></a>        <span class="k">del</span> <span class="n">by_player</span><span class="p">[</span><span class="s1">&#39;yahoo_name&#39;</span><span class="p">]</span>
</span><span id="League-1135"><a href="#League-1135"><span class="linenos">1135</span></a>        <span class="n">defenses</span> <span class="o">=</span> <span class="n">by_player</span><span class="o">.</span><span class="n">player_id_sr</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nfl_teams</span><span class="o">.</span><span class="n">real_abbrev</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
</span><span id="League-1136"><a href="#League-1136"><span class="linenos">1136</span></a>        <span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">defenses</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">defenses</span><span class="p">,</span><span class="s1">&#39;player_id_sr&#39;</span><span class="p">]</span>
</span><span id="League-1137"><a href="#League-1137"><span class="linenos">1137</span></a>        <span class="n">avgs</span> <span class="o">=</span> <span class="n">by_player</span><span class="o">.</span><span class="n">player_id_sr</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;avg_&quot;</span><span class="p">)</span>
</span><span id="League-1138"><a href="#League-1138"><span class="linenos">1138</span></a>        <span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">avgs</span><span class="p">,</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Average_&quot;</span> <span class="o">+</span> <span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">avgs</span><span class="p">,</span><span class="s2">&quot;position&quot;</span><span class="p">]</span>
</span><span id="League-1139"><a href="#League-1139"><span class="linenos">1139</span></a>        <span class="n">teams_as_of</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League-1140"><a href="#League-1140"><span class="linenos">1140</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">season</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">week</span> <span class="o">&gt;=</span> <span class="n">as_of</span><span class="p">]</span>
</span><span id="League-1141"><a href="#League-1141"><span class="linenos">1141</span></a>            <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="s2">&quot;week&quot;</span><span class="p">],</span><span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="League-1142"><a href="#League-1142"><span class="linenos">1142</span></a>            <span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s2">&quot;player_id_sr&quot;</span><span class="p">,</span> <span class="n">keep</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)[</span>
</span><span id="League-1143"><a href="#League-1143"><span class="linenos">1143</span></a>                <span class="p">[</span><span class="s2">&quot;player_id_sr&quot;</span><span class="p">,</span> <span class="s2">&quot;team&quot;</span><span class="p">]</span>
</span><span id="League-1144"><a href="#League-1144"><span class="linenos">1144</span></a>            <span class="p">]</span>
</span><span id="League-1145"><a href="#League-1145"><span class="linenos">1145</span></a>            <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;team&quot;</span><span class="p">:</span> <span class="s2">&quot;actual_team&quot;</span><span class="p">})</span>
</span><span id="League-1146"><a href="#League-1146"><span class="linenos">1146</span></a>        <span class="p">)</span>
</span><span id="League-1147"><a href="#League-1147"><span class="linenos">1147</span></a>        <span class="n">by_player</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League-1148"><a href="#League-1148"><span class="linenos">1148</span></a>            <span class="n">left</span><span class="o">=</span><span class="n">by_player</span><span class="p">,</span>
</span><span id="League-1149"><a href="#League-1149"><span class="linenos">1149</span></a>            <span class="n">right</span><span class="o">=</span><span class="n">teams_as_of</span><span class="p">,</span>
</span><span id="League-1150"><a href="#League-1150"><span class="linenos">1150</span></a>            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
</span><span id="League-1151"><a href="#League-1151"><span class="linenos">1151</span></a>            <span class="n">on</span><span class="o">=</span><span class="s2">&quot;player_id_sr&quot;</span><span class="p">,</span>
</span><span id="League-1152"><a href="#League-1152"><span class="linenos">1152</span></a>        <span class="p">)</span>
</span><span id="League-1153"><a href="#League-1153"><span class="linenos">1153</span></a>        <span class="n">not_yet</span> <span class="o">=</span> <span class="o">~</span><span class="n">by_player</span><span class="o">.</span><span class="n">actual_team</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span>
</span><span id="League-1154"><a href="#League-1154"><span class="linenos">1154</span></a>        <span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">not_yet</span><span class="p">,</span><span class="s1">&#39;current_team&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">not_yet</span><span class="p">,</span><span class="s1">&#39;actual_team&#39;</span><span class="p">]</span>
</span><span id="League-1155"><a href="#League-1155"><span class="linenos">1155</span></a>        <span class="k">del</span> <span class="n">by_player</span><span class="p">[</span><span class="s1">&#39;actual_team&#39;</span><span class="p">]</span>
</span><span id="League-1156"><a href="#League-1156"><span class="linenos">1156</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span> <span class="o">=</span> <span class="n">by_player</span>
</span><span id="League-1157"><a href="#League-1157"><span class="linenos">1157</span></a>
</span><span id="League-1158"><a href="#League-1158"><span class="linenos">1158</span></a>    <span class="k">def</span> <span class="nf">get_schedule</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="League-1159"><a href="#League-1159"><span class="linenos">1159</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="League-1160"><a href="#League-1160"><span class="linenos">1160</span></a><span class="sd">        Pulls the fantasy schedule for the season in question as well as </span>
</span><span id="League-1161"><a href="#League-1161"><span class="linenos">1161</span></a><span class="sd">        scores for all matchups up to the week in question.</span>
</span><span id="League-1162"><a href="#League-1162"><span class="linenos">1162</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="League-1163"><a href="#League-1163"><span class="linenos">1163</span></a>        <span class="n">as_of</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">season</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">week</span>
</span><span id="League-1164"><a href="#League-1164"><span class="linenos">1164</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_oauth</span><span class="p">()</span>
</span><span id="League-1165"><a href="#League-1165"><span class="linenos">1165</span></a>        <span class="n">schedule</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="League-1166"><a href="#League-1166"><span class="linenos">1166</span></a>        <span class="k">for</span> <span class="n">team</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">teams</span><span class="p">:</span>
</span><span id="League-1167"><a href="#League-1167"><span class="linenos">1167</span></a>            <span class="n">tm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lg</span><span class="o">.</span><span class="n">to_team</span><span class="p">(</span><span class="n">team</span><span class="p">[</span><span class="s2">&quot;team_key&quot;</span><span class="p">])</span>
</span><span id="League-1168"><a href="#League-1168"><span class="linenos">1168</span></a>            <span class="n">limit</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League-1169"><a href="#League-1169"><span class="linenos">1169</span></a>                <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;playoff_start_week&quot;</span><span class="p">],</span> <span class="n">as_of</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="League-1170"><a href="#League-1170"><span class="linenos">1170</span></a>                <span class="k">if</span> <span class="n">as_of</span>
</span><span id="League-1171"><a href="#League-1171"><span class="linenos">1171</span></a>                <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;playoff_start_week&quot;</span><span class="p">]</span>
</span><span id="League-1172"><a href="#League-1172"><span class="linenos">1172</span></a>            <span class="p">)</span>
</span><span id="League-1173"><a href="#League-1173"><span class="linenos">1173</span></a>            <span class="k">for</span> <span class="n">week</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">limit</span><span class="p">):</span>
</span><span id="League-1174"><a href="#League-1174"><span class="linenos">1174</span></a>                <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="League-1175"><a href="#League-1175"><span class="linenos">1175</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="League-1176"><a href="#League-1176"><span class="linenos">1176</span></a>                        <span class="n">matchup</span> <span class="o">=</span> <span class="n">tm</span><span class="o">.</span><span class="n">yhandler</span><span class="o">.</span><span class="n">get_matchup_raw</span><span class="p">(</span><span class="n">tm</span><span class="o">.</span><span class="n">team_key</span><span class="p">,</span> <span class="n">week</span><span class="p">)</span>
</span><span id="League-1177"><a href="#League-1177"><span class="linenos">1177</span></a>                        <span class="n">matchup</span> <span class="o">=</span> <span class="n">matchup</span><span class="p">[</span><span class="s2">&quot;fantasy_content&quot;</span><span class="p">][</span><span class="s2">&quot;team&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;matchups&quot;</span><span class="p">]</span>
</span><span id="League-1178"><a href="#League-1178"><span class="linenos">1178</span></a>                        <span class="k">break</span>
</span><span id="League-1179"><a href="#League-1179"><span class="linenos">1179</span></a>                    <span class="k">except</span><span class="p">:</span>
</span><span id="League-1180"><a href="#League-1180"><span class="linenos">1180</span></a>                        <span class="nb">print</span><span class="p">(</span>
</span><span id="League-1181"><a href="#League-1181"><span class="linenos">1181</span></a>                            <span class="s2">&quot;Matchup query crapped out... Waiting 30 seconds and trying again...&quot;</span>
</span><span id="League-1182"><a href="#League-1182"><span class="linenos">1182</span></a>                        <span class="p">)</span>
</span><span id="League-1183"><a href="#League-1183"><span class="linenos">1183</span></a>                        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
</span><span id="League-1184"><a href="#League-1184"><span class="linenos">1184</span></a>                <span class="k">if</span> <span class="s2">&quot;0&quot;</span> <span class="ow">in</span> <span class="n">matchup</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="League-1185"><a href="#League-1185"><span class="linenos">1185</span></a>                    <span class="n">team_1</span> <span class="o">=</span> <span class="n">matchup</span><span class="p">[</span><span class="s2">&quot;0&quot;</span><span class="p">][</span><span class="s2">&quot;matchup&quot;</span><span class="p">][</span><span class="s2">&quot;0&quot;</span><span class="p">][</span><span class="s2">&quot;teams&quot;</span><span class="p">][</span><span class="s2">&quot;0&quot;</span><span class="p">][</span><span class="s2">&quot;team&quot;</span><span class="p">]</span>
</span><span id="League-1186"><a href="#League-1186"><span class="linenos">1186</span></a>                    <span class="n">team_2</span> <span class="o">=</span> <span class="n">matchup</span><span class="p">[</span><span class="s2">&quot;0&quot;</span><span class="p">][</span><span class="s2">&quot;matchup&quot;</span><span class="p">][</span><span class="s2">&quot;0&quot;</span><span class="p">][</span><span class="s2">&quot;teams&quot;</span><span class="p">][</span><span class="s2">&quot;1&quot;</span><span class="p">][</span><span class="s2">&quot;team&quot;</span><span class="p">]</span>
</span><span id="League-1187"><a href="#League-1187"><span class="linenos">1187</span></a>                    <span class="n">schedule</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">schedule</span><span class="p">,</span>
</span><span id="League-1188"><a href="#League-1188"><span class="linenos">1188</span></a>                        <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span><span id="League-1189"><a href="#League-1189"><span class="linenos">1189</span></a>                            <span class="p">{</span>
</span><span id="League-1190"><a href="#League-1190"><span class="linenos">1190</span></a>                                <span class="s2">&quot;week&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">week</span><span class="p">],</span>
</span><span id="League-1191"><a href="#League-1191"><span class="linenos">1191</span></a>                                <span class="s2">&quot;team_1&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">team_1</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]],</span>
</span><span id="League-1192"><a href="#League-1192"><span class="linenos">1192</span></a>                                <span class="s2">&quot;team_2&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">team_2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]],</span>
</span><span id="League-1193"><a href="#League-1193"><span class="linenos">1193</span></a>                                <span class="s2">&quot;score_1&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">team_1</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;team_points&quot;</span><span class="p">][</span><span class="s2">&quot;total&quot;</span><span class="p">]],</span>
</span><span id="League-1194"><a href="#League-1194"><span class="linenos">1194</span></a>                                <span class="s2">&quot;score_2&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">team_2</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;team_points&quot;</span><span class="p">][</span><span class="s2">&quot;total&quot;</span><span class="p">]],</span>
</span><span id="League-1195"><a href="#League-1195"><span class="linenos">1195</span></a>                            <span class="p">}</span>
</span><span id="League-1196"><a href="#League-1196"><span class="linenos">1196</span></a>                        <span class="p">)],</span>
</span><span id="League-1197"><a href="#League-1197"><span class="linenos">1197</span></a>                        <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="League-1198"><a href="#League-1198"><span class="linenos">1198</span></a>                    <span class="p">)</span>
</span><span id="League-1199"><a href="#League-1199"><span class="linenos">1199</span></a>        <span class="n">schedule</span><span class="o">.</span><span class="n">score_1</span> <span class="o">=</span> <span class="n">schedule</span><span class="o">.</span><span class="n">score_1</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="League-1200"><a href="#League-1200"><span class="linenos">1200</span></a>        <span class="n">schedule</span><span class="o">.</span><span class="n">score_2</span> <span class="o">=</span> <span class="n">schedule</span><span class="o">.</span><span class="n">score_2</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="League-1201"><a href="#League-1201"><span class="linenos">1201</span></a>
</span><span id="League-1202"><a href="#League-1202"><span class="linenos">1202</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; MANY MILE POSTSEASON &quot;&quot;&quot;</span>
</span><span id="League-1203"><a href="#League-1203"><span class="linenos">1203</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;res/football/many_mile.csv&quot;</span><span class="p">):</span>
</span><span id="League-1204"><a href="#League-1204"><span class="linenos">1204</span></a>            <span class="n">many_mile_sched</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;res/football/many_mile.csv&quot;</span><span class="p">)</span>
</span><span id="League-1205"><a href="#League-1205"><span class="linenos">1205</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="League-1206"><a href="#League-1206"><span class="linenos">1206</span></a>            <span class="n">many_mile_sched</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">,</span> <span class="s2">&quot;week&quot;</span><span class="p">])</span>
</span><span id="League-1207"><a href="#League-1207"><span class="linenos">1207</span></a>        <span class="n">algo</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League-1208"><a href="#League-1208"><span class="linenos">1208</span></a>            <span class="n">schedule</span><span class="o">.</span><span class="n">team_1</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;The Algorithm&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
</span><span id="League-1209"><a href="#League-1209"><span class="linenos">1209</span></a>            <span class="ow">or</span> <span class="n">schedule</span><span class="o">.</span><span class="n">team_2</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;The Algorithm&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
</span><span id="League-1210"><a href="#League-1210"><span class="linenos">1210</span></a>        <span class="p">)</span>
</span><span id="League-1211"><a href="#League-1211"><span class="linenos">1211</span></a>        <span class="k">if</span> <span class="n">as_of</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;playoff_start_week&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">algo</span><span class="p">:</span>
</span><span id="League-1212"><a href="#League-1212"><span class="linenos">1212</span></a>            <span class="n">many_mile_sched</span> <span class="o">=</span> <span class="n">many_mile_sched</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League-1213"><a href="#League-1213"><span class="linenos">1213</span></a>                <span class="p">(</span><span class="n">many_mile_sched</span><span class="o">.</span><span class="n">season</span> <span class="o">==</span> <span class="n">as_of</span> <span class="o">//</span> <span class="mi">100</span><span class="p">)</span>
</span><span id="League-1214"><a href="#League-1214"><span class="linenos">1214</span></a>                <span class="o">&amp;</span> <span class="p">(</span><span class="n">many_mile_sched</span><span class="o">.</span><span class="n">week</span> <span class="o">&lt;=</span> <span class="n">as_of</span> <span class="o">%</span> <span class="mi">100</span><span class="p">)</span>
</span><span id="League-1215"><a href="#League-1215"><span class="linenos">1215</span></a>            <span class="p">]</span>
</span><span id="League-1216"><a href="#League-1216"><span class="linenos">1216</span></a>            <span class="k">del</span> <span class="n">many_mile_sched</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">]</span>
</span><span id="League-1217"><a href="#League-1217"><span class="linenos">1217</span></a>            <span class="n">many_mile_sched</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">many_mile_sched</span><span class="o">.</span><span class="n">week</span> <span class="o">==</span> <span class="n">as_of</span> <span class="o">%</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;score_1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="League-1218"><a href="#League-1218"><span class="linenos">1218</span></a>            <span class="n">many_mile_sched</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">many_mile_sched</span><span class="o">.</span><span class="n">week</span> <span class="o">==</span> <span class="n">as_of</span> <span class="o">%</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;score_2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="League-1219"><a href="#League-1219"><span class="linenos">1219</span></a>            <span class="n">standings</span> <span class="o">=</span> <span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League-1220"><a href="#League-1220"><span class="linenos">1220</span></a>                <span class="n">schedule</span><span class="o">.</span><span class="n">week</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;playoff_start_week&quot;</span><span class="p">]</span>
</span><span id="League-1221"><a href="#League-1221"><span class="linenos">1221</span></a>            <span class="p">]</span>
</span><span id="League-1222"><a href="#League-1222"><span class="linenos">1222</span></a>            <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;win_1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">standings</span><span class="o">.</span><span class="n">score_1</span> <span class="o">&gt;</span> <span class="n">standings</span><span class="o">.</span><span class="n">score_2</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="League-1223"><a href="#League-1223"><span class="linenos">1223</span></a>            <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;win_2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">standings</span><span class="o">.</span><span class="n">win_1</span>
</span><span id="League-1224"><a href="#League-1224"><span class="linenos">1224</span></a>            <span class="n">standings</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">standings</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
</span><span id="League-1225"><a href="#League-1225"><span class="linenos">1225</span></a>                <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">col</span><span class="p">:</span> <span class="n">col</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_1&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">standings</span><span class="o">.</span><span class="n">columns</span><span class="p">}</span>
</span><span id="League-1226"><a href="#League-1226"><span class="linenos">1226</span></a>            <span class="p">),</span>
</span><span id="League-1227"><a href="#League-1227"><span class="linenos">1227</span></a>                <span class="n">standings</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
</span><span id="League-1228"><a href="#League-1228"><span class="linenos">1228</span></a>                    <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">col</span><span class="p">:</span> <span class="n">col</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_2&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">standings</span><span class="o">.</span><span class="n">columns</span><span class="p">}</span>
</span><span id="League-1229"><a href="#League-1229"><span class="linenos">1229</span></a>                <span class="p">)],</span>
</span><span id="League-1230"><a href="#League-1230"><span class="linenos">1230</span></a>                <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="League-1231"><a href="#League-1231"><span class="linenos">1231</span></a>                <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="League-1232"><a href="#League-1232"><span class="linenos">1232</span></a>            <span class="p">)</span>
</span><span id="League-1233"><a href="#League-1233"><span class="linenos">1233</span></a>            <span class="n">standings</span> <span class="o">=</span> <span class="n">standings</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;team&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="League-1234"><a href="#League-1234"><span class="linenos">1234</span></a>            <span class="n">standings</span> <span class="o">=</span> <span class="n">standings</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
</span><span id="League-1235"><a href="#League-1235"><span class="linenos">1235</span></a>                <span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;win&quot;</span><span class="p">,</span> <span class="s2">&quot;score&quot;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span>
</span><span id="League-1236"><a href="#League-1236"><span class="linenos">1236</span></a>            <span class="p">)</span>
</span><span id="League-1237"><a href="#League-1237"><span class="linenos">1237</span></a>            <span class="n">consolation</span> <span class="o">=</span> <span class="n">standings</span><span class="o">.</span><span class="n">team</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">6</span><span class="p">:]</span>
</span><span id="League-1238"><a href="#League-1238"><span class="linenos">1238</span></a>            <span class="n">schedule</span> <span class="o">=</span> <span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League-1239"><a href="#League-1239"><span class="linenos">1239</span></a>                <span class="p">(</span><span class="n">schedule</span><span class="o">.</span><span class="n">week</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;playoff_start_week&quot;</span><span class="p">])</span>
</span><span id="League-1240"><a href="#League-1240"><span class="linenos">1240</span></a>                <span class="o">|</span> <span class="o">~</span><span class="n">schedule</span><span class="o">.</span><span class="n">team_1</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">consolation</span><span class="p">)</span>
</span><span id="League-1241"><a href="#League-1241"><span class="linenos">1241</span></a>            <span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="League-1242"><a href="#League-1242"><span class="linenos">1242</span></a>            <span class="n">schedule</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">schedule</span><span class="p">,</span>
</span><span id="League-1243"><a href="#League-1243"><span class="linenos">1243</span></a>                <span class="n">many_mile_sched</span><span class="p">],</span>
</span><span id="League-1244"><a href="#League-1244"><span class="linenos">1244</span></a>                <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="League-1245"><a href="#League-1245"><span class="linenos">1245</span></a>                <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="League-1246"><a href="#League-1246"><span class="linenos">1246</span></a>            <span class="p">)</span>
</span><span id="League-1247"><a href="#League-1247"><span class="linenos">1247</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; MANY MILE POSTSEASON &quot;&quot;&quot;</span>
</span><span id="League-1248"><a href="#League-1248"><span class="linenos">1248</span></a>
</span><span id="League-1249"><a href="#League-1249"><span class="linenos">1249</span></a>        <span class="n">switch</span> <span class="o">=</span> <span class="n">schedule</span><span class="o">.</span><span class="n">team_1</span> <span class="o">&gt;</span> <span class="n">schedule</span><span class="o">.</span><span class="n">team_2</span>
</span><span id="League-1250"><a href="#League-1250"><span class="linenos">1250</span></a>        <span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">switch</span><span class="p">,</span> <span class="s2">&quot;temp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">switch</span><span class="p">,</span> <span class="s2">&quot;team_1&quot;</span><span class="p">]</span>
</span><span id="League-1251"><a href="#League-1251"><span class="linenos">1251</span></a>        <span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">switch</span><span class="p">,</span> <span class="s2">&quot;team_1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">switch</span><span class="p">,</span> <span class="s2">&quot;team_2&quot;</span><span class="p">]</span>
</span><span id="League-1252"><a href="#League-1252"><span class="linenos">1252</span></a>        <span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">switch</span><span class="p">,</span> <span class="s2">&quot;team_2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">switch</span><span class="p">,</span> <span class="s2">&quot;temp&quot;</span><span class="p">]</span>
</span><span id="League-1253"><a href="#League-1253"><span class="linenos">1253</span></a>        <span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">switch</span><span class="p">,</span> <span class="s2">&quot;temp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">switch</span><span class="p">,</span> <span class="s2">&quot;score_1&quot;</span><span class="p">]</span>
</span><span id="League-1254"><a href="#League-1254"><span class="linenos">1254</span></a>        <span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">switch</span><span class="p">,</span> <span class="s2">&quot;score_1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">switch</span><span class="p">,</span> <span class="s2">&quot;score_2&quot;</span><span class="p">]</span>
</span><span id="League-1255"><a href="#League-1255"><span class="linenos">1255</span></a>        <span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">switch</span><span class="p">,</span> <span class="s2">&quot;score_2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">switch</span><span class="p">,</span> <span class="s2">&quot;temp&quot;</span><span class="p">]</span>
</span><span id="League-1256"><a href="#League-1256"><span class="linenos">1256</span></a>        <span class="n">schedule</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League-1257"><a href="#League-1257"><span class="linenos">1257</span></a>            <span class="n">schedule</span><span class="p">[[</span><span class="s2">&quot;week&quot;</span><span class="p">,</span> <span class="s2">&quot;team_1&quot;</span><span class="p">,</span> <span class="s2">&quot;team_2&quot;</span><span class="p">,</span> <span class="s2">&quot;score_1&quot;</span><span class="p">,</span> <span class="s2">&quot;score_2&quot;</span><span class="p">]]</span>
</span><span id="League-1258"><a href="#League-1258"><span class="linenos">1258</span></a>            <span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
</span><span id="League-1259"><a href="#League-1259"><span class="linenos">1259</span></a>            <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;week&quot;</span><span class="p">,</span> <span class="s2">&quot;team_1&quot;</span><span class="p">,</span> <span class="s2">&quot;team_2&quot;</span><span class="p">])</span>
</span><span id="League-1260"><a href="#League-1260"><span class="linenos">1260</span></a>            <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="League-1261"><a href="#League-1261"><span class="linenos">1261</span></a>        <span class="p">)</span>
</span><span id="League-1262"><a href="#League-1262"><span class="linenos">1262</span></a>        <span class="n">team_name</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="League-1263"><a href="#League-1263"><span class="linenos">1263</span></a>            <span class="n">team</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
</span><span id="League-1264"><a href="#League-1264"><span class="linenos">1264</span></a>            <span class="k">for</span> <span class="n">team</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">teams</span>
</span><span id="League-1265"><a href="#League-1265"><span class="linenos">1265</span></a>            <span class="k">if</span> <span class="n">team</span><span class="p">[</span><span class="s2">&quot;team_key&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">lg</span><span class="o">.</span><span class="n">team_key</span><span class="p">()</span>
</span><span id="League-1266"><a href="#League-1266"><span class="linenos">1266</span></a>        <span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League-1267"><a href="#League-1267"><span class="linenos">1267</span></a>        <span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;me&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;team_1&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">team_name</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span>
</span><span id="League-1268"><a href="#League-1268"><span class="linenos">1268</span></a>            <span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;team_2&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">team_name</span>
</span><span id="League-1269"><a href="#League-1269"><span class="linenos">1269</span></a>        <span class="p">)</span>
</span><span id="League-1270"><a href="#League-1270"><span class="linenos">1270</span></a>        <span class="k">if</span> <span class="n">as_of</span><span class="p">:</span>
</span><span id="League-1271"><a href="#League-1271"><span class="linenos">1271</span></a>            <span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">schedule</span><span class="o">.</span><span class="n">week</span> <span class="o">&gt;</span> <span class="n">as_of</span> <span class="o">%</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;score_1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="League-1272"><a href="#League-1272"><span class="linenos">1272</span></a>            <span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">schedule</span><span class="o">.</span><span class="n">week</span> <span class="o">&gt;</span> <span class="n">as_of</span> <span class="o">%</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;score_2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="League-1273"><a href="#League-1273"><span class="linenos">1273</span></a>            <span class="k">if</span> <span class="p">(</span>
</span><span id="League-1274"><a href="#League-1274"><span class="linenos">1274</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">latest_season</span> <span class="o">&gt;</span> <span class="n">as_of</span> <span class="o">//</span> <span class="mi">100</span>
</span><span id="League-1275"><a href="#League-1275"><span class="linenos">1275</span></a>                <span class="ow">or</span> <span class="n">as_of</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_week</span>
</span><span id="League-1276"><a href="#League-1276"><span class="linenos">1276</span></a>            <span class="p">):</span>
</span><span id="League-1277"><a href="#League-1277"><span class="linenos">1277</span></a>                <span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">schedule</span><span class="o">.</span><span class="n">week</span> <span class="o">==</span> <span class="n">as_of</span> <span class="o">%</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;score_1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="League-1278"><a href="#League-1278"><span class="linenos">1278</span></a>                <span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">schedule</span><span class="o">.</span><span class="n">week</span> <span class="o">==</span> <span class="n">as_of</span> <span class="o">%</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;score_2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="League-1279"><a href="#League-1279"><span class="linenos">1279</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span> <span class="o">=</span> <span class="n">schedule</span>
</span><span id="League-1280"><a href="#League-1280"><span class="linenos">1280</span></a>
</span><span id="League-1281"><a href="#League-1281"><span class="linenos">1281</span></a>    <span class="k">def</span> <span class="nf">starters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">week</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="League-1282"><a href="#League-1282"><span class="linenos">1282</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="League-1283"><a href="#League-1283"><span class="linenos">1283</span></a><span class="sd">        Identifies which players should be started on each fantasy team </span>
</span><span id="League-1284"><a href="#League-1284"><span class="linenos">1284</span></a><span class="sd">        based on fantasy point projections and available roster spots.</span>
</span><span id="League-1285"><a href="#League-1285"><span class="linenos">1285</span></a>
</span><span id="League-1286"><a href="#League-1286"><span class="linenos">1286</span></a><span class="sd">        Args:</span>
</span><span id="League-1287"><a href="#League-1287"><span class="linenos">1287</span></a><span class="sd">            week (int, optional): week for which to identify starters.</span>
</span><span id="League-1288"><a href="#League-1288"><span class="linenos">1288</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="League-1289"><a href="#League-1289"><span class="linenos">1289</span></a>        <span class="n">as_of</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">season</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">week</span>
</span><span id="League-1290"><a href="#League-1290"><span class="linenos">1290</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_oauth</span><span class="p">()</span>
</span><span id="League-1291"><a href="#League-1291"><span class="linenos">1291</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League-1292"><a href="#League-1292"><span class="linenos">1292</span></a>            <span class="n">left</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">,</span>
</span><span id="League-1293"><a href="#League-1293"><span class="linenos">1293</span></a>            <span class="n">right</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nfl_schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League-1294"><a href="#League-1294"><span class="linenos">1294</span></a>                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nfl_schedule</span><span class="o">.</span><span class="n">season</span> <span class="o">==</span> <span class="n">as_of</span> <span class="o">//</span> <span class="mi">100</span><span class="p">)</span>
</span><span id="League-1295"><a href="#League-1295"><span class="linenos">1295</span></a>                <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nfl_schedule</span><span class="o">.</span><span class="n">week</span> <span class="o">==</span> <span class="n">week</span><span class="p">),</span>
</span><span id="League-1296"><a href="#League-1296"><span class="linenos">1296</span></a>                <span class="p">[</span><span class="s2">&quot;team&quot;</span><span class="p">,</span> <span class="s2">&quot;elo_diff&quot;</span><span class="p">],</span>
</span><span id="League-1297"><a href="#League-1297"><span class="linenos">1297</span></a>            <span class="p">],</span>
</span><span id="League-1298"><a href="#League-1298"><span class="linenos">1298</span></a>            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
</span><span id="League-1299"><a href="#League-1299"><span class="linenos">1299</span></a>            <span class="n">left_on</span><span class="o">=</span><span class="s2">&quot;current_team&quot;</span><span class="p">,</span>
</span><span id="League-1300"><a href="#League-1300"><span class="linenos">1300</span></a>            <span class="n">right_on</span><span class="o">=</span><span class="s2">&quot;team&quot;</span><span class="p">,</span>
</span><span id="League-1301"><a href="#League-1301"><span class="linenos">1301</span></a>        <span class="p">)</span>
</span><span id="League-1302"><a href="#League-1302"><span class="linenos">1302</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">elo_diff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">elo_diff</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="League-1303"><a href="#League-1303"><span class="linenos">1303</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[</span><span class="s2">&quot;opp_factor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">basaloppstringtime</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[</span><span class="s2">&quot;elo_diff&quot;</span><span class="p">])</span>
</span><span id="League-1304"><a href="#League-1304"><span class="linenos">1304</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[</span><span class="s2">&quot;string_factor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">basaloppstringtime</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[</span><span class="s2">&quot;string&quot;</span><span class="p">])</span>
</span><span id="League-1305"><a href="#League-1305"><span class="linenos">1305</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[</span><span class="s2">&quot;game_factor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League-1306"><a href="#League-1306"><span class="linenos">1306</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">basaloppstringtime</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League-1307"><a href="#League-1307"><span class="linenos">1307</span></a>            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[</span><span class="s2">&quot;opp_factor&quot;</span><span class="p">]</span>
</span><span id="League-1308"><a href="#League-1308"><span class="linenos">1308</span></a>            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[</span><span class="s2">&quot;string_factor&quot;</span><span class="p">]</span>
</span><span id="League-1309"><a href="#League-1309"><span class="linenos">1309</span></a>        <span class="p">)</span>
</span><span id="League-1310"><a href="#League-1310"><span class="linenos">1310</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[</span><span class="s2">&quot;points_avg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[</span><span class="s2">&quot;points_rate&quot;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[</span><span class="s2">&quot;game_factor&quot;</span><span class="p">]</span><span class="c1">#.fillna(1.0)</span>
</span><span id="League-1311"><a href="#League-1311"><span class="linenos">1311</span></a>        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[</span><span class="s2">&quot;team&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[</span><span class="s2">&quot;elo_diff&quot;</span><span class="p">]</span>
</span><span id="League-1312"><a href="#League-1312"><span class="linenos">1312</span></a>        <span class="c1"># WAR is linear with points_avg, but slope/intercept depends on position</span>
</span><span id="League-1313"><a href="#League-1313"><span class="linenos">1313</span></a>        <span class="c1"># Harder to characterize how WAR varies with points_stdev, ignoring for now...</span>
</span><span id="League-1314"><a href="#League-1314"><span class="linenos">1314</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;points_avg&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="League-1315"><a href="#League-1315"><span class="linenos">1315</span></a>        <span class="c1"># self.players = self.players.sort_values(by=&#39;WAR&#39;,ascending=False)</span>
</span><span id="League-1316"><a href="#League-1316"><span class="linenos">1316</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[</span><span class="s2">&quot;starter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="League-1317"><a href="#League-1317"><span class="linenos">1317</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[</span><span class="s2">&quot;injured&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">until</span> <span class="o">&gt;=</span> <span class="n">week</span>
</span><span id="League-1318"><a href="#League-1318"><span class="linenos">1318</span></a>        <span class="k">if</span> <span class="p">(</span>
</span><span id="League-1319"><a href="#League-1319"><span class="linenos">1319</span></a>            <span class="n">week</span> <span class="o">==</span> <span class="n">as_of</span> <span class="o">%</span> <span class="mi">100</span>
</span><span id="League-1320"><a href="#League-1320"><span class="linenos">1320</span></a>            <span class="ow">and</span> <span class="n">as_of</span> <span class="o">//</span> <span class="mi">100</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">latest_season</span>
</span><span id="League-1321"><a href="#League-1321"><span class="linenos">1321</span></a>            <span class="ow">and</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">month</span> <span class="o">&gt;</span> <span class="mi">8</span>
</span><span id="League-1322"><a href="#League-1322"><span class="linenos">1322</span></a>        <span class="p">):</span>  <span class="c1"># Careful when your draft is in September...</span>
</span><span id="League-1323"><a href="#League-1323"><span class="linenos">1323</span></a>            <span class="n">cutoff</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span id="League-1324"><a href="#League-1324"><span class="linenos">1324</span></a>            <span class="k">if</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">hour</span> <span class="o">&lt;</span> <span class="mi">20</span><span class="p">:</span>
</span><span id="League-1325"><a href="#League-1325"><span class="linenos">1325</span></a>                <span class="n">cutoff</span> <span class="o">-=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="League-1326"><a href="#League-1326"><span class="linenos">1326</span></a>            <span class="n">completed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nfl_schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League-1327"><a href="#League-1327"><span class="linenos">1327</span></a>                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nfl_schedule</span><span class="o">.</span><span class="n">season</span> <span class="o">==</span> <span class="n">as_of</span> <span class="o">//</span> <span class="mi">100</span><span class="p">)</span>
</span><span id="League-1328"><a href="#League-1328"><span class="linenos">1328</span></a>                <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nfl_schedule</span><span class="o">.</span><span class="n">week</span> <span class="o">==</span> <span class="n">week</span><span class="p">)</span>
</span><span id="League-1329"><a href="#League-1329"><span class="linenos">1329</span></a>                <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nfl_schedule</span><span class="o">.</span><span class="n">date</span> <span class="o">&lt;</span> <span class="n">cutoff</span><span class="p">),</span>
</span><span id="League-1330"><a href="#League-1330"><span class="linenos">1330</span></a>                <span class="s2">&quot;team&quot;</span><span class="p">,</span>
</span><span id="League-1331"><a href="#League-1331"><span class="linenos">1331</span></a>            <span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="League-1332"><a href="#League-1332"><span class="linenos">1332</span></a>            <span class="k">for</span> <span class="n">team</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">teams</span><span class="p">:</span>
</span><span id="League-1333"><a href="#League-1333"><span class="linenos">1333</span></a>                <span class="n">started</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League-1334"><a href="#League-1334"><span class="linenos">1334</span></a>                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">selected_position</span> <span class="o">!=</span> <span class="s2">&quot;BN&quot;</span><span class="p">)</span>
</span><span id="League-1335"><a href="#League-1335"><span class="linenos">1335</span></a>                    <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">fantasy_team</span> <span class="o">==</span> <span class="n">team</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>
</span><span id="League-1336"><a href="#League-1336"><span class="linenos">1336</span></a>                    <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">current_team</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">completed</span><span class="p">)</span>
</span><span id="League-1337"><a href="#League-1337"><span class="linenos">1337</span></a>                <span class="p">]</span>
</span><span id="League-1338"><a href="#League-1338"><span class="linenos">1338</span></a>                <span class="n">not_available</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League-1339"><a href="#League-1339"><span class="linenos">1339</span></a>                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">selected_position</span> <span class="o">==</span> <span class="s2">&quot;BN&quot;</span><span class="p">)</span>
</span><span id="League-1340"><a href="#League-1340"><span class="linenos">1340</span></a>                    <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">fantasy_team</span> <span class="o">==</span> <span class="n">team</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>
</span><span id="League-1341"><a href="#League-1341"><span class="linenos">1341</span></a>                    <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">current_team</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">completed</span><span class="p">)</span>
</span><span id="League-1342"><a href="#League-1342"><span class="linenos">1342</span></a>                <span class="p">]</span>
</span><span id="League-1343"><a href="#League-1343"><span class="linenos">1343</span></a>                <span class="n">lineup</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">roster_spots</span><span class="p">,</span><span class="n">right</span><span class="o">=</span><span class="n">started</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;selected_position&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>\
</span><span id="League-1344"><a href="#League-1344"><span class="linenos">1344</span></a>                <span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;num_started&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;selected_position&#39;</span><span class="p">:</span><span class="s1">&#39;position&#39;</span><span class="p">}),</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="s1">&#39;position&#39;</span><span class="p">)</span>
</span><span id="League-1345"><a href="#League-1345"><span class="linenos">1345</span></a>                <span class="n">lineup</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="o">-=</span> <span class="n">lineup</span><span class="o">.</span><span class="n">num_started</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="League-1346"><a href="#League-1346"><span class="linenos">1346</span></a>                <span class="n">num_pos</span> <span class="o">=</span> <span class="n">lineup</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">lineup</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;W/T&quot;</span><span class="p">,</span> <span class="s2">&quot;W/R/T&quot;</span><span class="p">,</span> <span class="s2">&quot;Q/W/R/T&quot;</span><span class="p">,</span> <span class="s2">&quot;BN&quot;</span><span class="p">,</span> <span class="s2">&quot;IR&quot;</span><span class="p">])]</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;position&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span>
</span><span id="League-1347"><a href="#League-1347"><span class="linenos">1347</span></a>                <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">num_pos</span><span class="p">:</span>
</span><span id="League-1348"><a href="#League-1348"><span class="linenos">1348</span></a>                    <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">num_pos</span><span class="p">[</span><span class="n">pos</span><span class="p">])):</span>
</span><span id="League-1349"><a href="#League-1349"><span class="linenos">1349</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League-1350"><a href="#League-1350"><span class="linenos">1350</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League-1351"><a href="#League-1351"><span class="linenos">1351</span></a>                                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">fantasy_team</span> <span class="o">==</span> <span class="n">team</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>
</span><span id="League-1352"><a href="#League-1352"><span class="linenos">1352</span></a>                                <span class="o">&amp;</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">starter</span>
</span><span id="League-1353"><a href="#League-1353"><span class="linenos">1353</span></a>                                <span class="o">&amp;</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">injured</span>
</span><span id="League-1354"><a href="#League-1354"><span class="linenos">1354</span></a>                                <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">bye_week</span> <span class="o">!=</span> <span class="n">week</span><span class="p">)</span>
</span><span id="League-1355"><a href="#League-1355"><span class="linenos">1355</span></a>                                <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">position</span> <span class="o">==</span> <span class="n">pos</span><span class="p">)</span>
</span><span id="League-1356"><a href="#League-1356"><span class="linenos">1356</span></a>                                <span class="o">&amp;</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">player_id</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">started</span><span class="o">.</span><span class="n">player_id</span><span class="p">)</span>
</span><span id="League-1357"><a href="#League-1357"><span class="linenos">1357</span></a>                                <span class="o">&amp;</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">player_id</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">not_available</span><span class="o">.</span><span class="n">player_id</span><span class="p">)</span>
</span><span id="League-1358"><a href="#League-1358"><span class="linenos">1358</span></a>                            <span class="p">]</span>
</span><span id="League-1359"><a href="#League-1359"><span class="linenos">1359</span></a>                            <span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span>
</span><span id="League-1360"><a href="#League-1360"><span class="linenos">1360</span></a>                            <span class="o">.</span><span class="n">index</span><span class="p">,</span>
</span><span id="League-1361"><a href="#League-1361"><span class="linenos">1361</span></a>                            <span class="s2">&quot;starter&quot;</span><span class="p">,</span>
</span><span id="League-1362"><a href="#League-1362"><span class="linenos">1362</span></a>                        <span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="League-1363"><a href="#League-1363"><span class="linenos">1363</span></a>                <span class="n">flex_pos</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;W/T&quot;</span><span class="p">:[</span><span class="s1">&#39;WR&#39;</span><span class="p">,</span><span class="s1">&#39;TE&#39;</span><span class="p">],</span><span class="s2">&quot;W/R/T&quot;</span><span class="p">:[</span><span class="s1">&#39;WR&#39;</span><span class="p">,</span><span class="s1">&#39;RB&#39;</span><span class="p">,</span><span class="s1">&#39;TE&#39;</span><span class="p">],</span><span class="s2">&quot;Q/W/R/T&quot;</span><span class="p">:[</span><span class="s1">&#39;WR&#39;</span><span class="p">,</span><span class="s1">&#39;RB&#39;</span><span class="p">,</span><span class="s1">&#39;TE&#39;</span><span class="p">,</span><span class="s1">&#39;QB&#39;</span><span class="p">]}</span>
</span><span id="League-1364"><a href="#League-1364"><span class="linenos">1364</span></a>                <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">flex_pos</span><span class="p">:</span>
</span><span id="League-1365"><a href="#League-1365"><span class="linenos">1365</span></a>                    <span class="n">num_flex</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lineup</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">lineup</span><span class="o">.</span><span class="n">position</span> <span class="o">==</span> <span class="n">pos</span><span class="p">,</span><span class="s1">&#39;count&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
</span><span id="League-1366"><a href="#League-1366"><span class="linenos">1366</span></a>                    <span class="k">for</span> <span class="n">flex</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_flex</span><span class="p">):</span>
</span><span id="League-1367"><a href="#League-1367"><span class="linenos">1367</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League-1368"><a href="#League-1368"><span class="linenos">1368</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League-1369"><a href="#League-1369"><span class="linenos">1369</span></a>                                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">fantasy_team</span> <span class="o">==</span> <span class="n">team</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>
</span><span id="League-1370"><a href="#League-1370"><span class="linenos">1370</span></a>                                <span class="o">&amp;</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">starter</span>
</span><span id="League-1371"><a href="#League-1371"><span class="linenos">1371</span></a>                                <span class="o">&amp;</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">injured</span>
</span><span id="League-1372"><a href="#League-1372"><span class="linenos">1372</span></a>                                <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">bye_week</span> <span class="o">!=</span> <span class="n">week</span><span class="p">)</span>
</span><span id="League-1373"><a href="#League-1373"><span class="linenos">1373</span></a>                                <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">flex_pos</span><span class="p">[</span><span class="n">pos</span><span class="p">])</span>
</span><span id="League-1374"><a href="#League-1374"><span class="linenos">1374</span></a>                                <span class="o">&amp;</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">player_id</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">started</span><span class="o">.</span><span class="n">player_id</span><span class="p">)</span>
</span><span id="League-1375"><a href="#League-1375"><span class="linenos">1375</span></a>                                <span class="o">&amp;</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">player_id</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">not_available</span><span class="o">.</span><span class="n">player_id</span><span class="p">)</span>
</span><span id="League-1376"><a href="#League-1376"><span class="linenos">1376</span></a>                            <span class="p">]</span>
</span><span id="League-1377"><a href="#League-1377"><span class="linenos">1377</span></a>                            <span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span>
</span><span id="League-1378"><a href="#League-1378"><span class="linenos">1378</span></a>                            <span class="o">.</span><span class="n">index</span><span class="p">,</span>
</span><span id="League-1379"><a href="#League-1379"><span class="linenos">1379</span></a>                            <span class="s2">&quot;starter&quot;</span><span class="p">,</span>
</span><span id="League-1380"><a href="#League-1380"><span class="linenos">1380</span></a>                        <span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="League-1381"><a href="#League-1381"><span class="linenos">1381</span></a>        <span class="k">elif</span> <span class="n">week</span> <span class="o">&gt;=</span> <span class="n">as_of</span> <span class="o">%</span> <span class="mi">100</span><span class="p">:</span>
</span><span id="League-1382"><a href="#League-1382"><span class="linenos">1382</span></a>            <span class="n">num_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">roster_spots</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">roster_spots</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;W/T&quot;</span><span class="p">,</span> <span class="s2">&quot;W/R/T&quot;</span><span class="p">,</span> <span class="s2">&quot;Q/W/R/T&quot;</span><span class="p">,</span> <span class="s2">&quot;BN&quot;</span><span class="p">,</span> <span class="s2">&quot;IR&quot;</span><span class="p">])]</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;position&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span>
</span><span id="League-1383"><a href="#League-1383"><span class="linenos">1383</span></a>            <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">num_pos</span><span class="p">:</span>
</span><span id="League-1384"><a href="#League-1384"><span class="linenos">1384</span></a>                <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_pos</span><span class="p">[</span><span class="n">pos</span><span class="p">]):</span>
</span><span id="League-1385"><a href="#League-1385"><span class="linenos">1385</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League-1386"><a href="#League-1386"><span class="linenos">1386</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League-1387"><a href="#League-1387"><span class="linenos">1387</span></a>                            <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">starter</span>
</span><span id="League-1388"><a href="#League-1388"><span class="linenos">1388</span></a>                            <span class="o">&amp;</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">injured</span>
</span><span id="League-1389"><a href="#League-1389"><span class="linenos">1389</span></a>                            <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">bye_week</span> <span class="o">!=</span> <span class="n">week</span><span class="p">)</span>
</span><span id="League-1390"><a href="#League-1390"><span class="linenos">1390</span></a>                            <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">position</span> <span class="o">==</span> <span class="n">pos</span><span class="p">)</span>
</span><span id="League-1391"><a href="#League-1391"><span class="linenos">1391</span></a>                        <span class="p">]</span>
</span><span id="League-1392"><a href="#League-1392"><span class="linenos">1392</span></a>                        <span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;fantasy_team&quot;</span><span class="p">],</span> <span class="n">keep</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)</span>
</span><span id="League-1393"><a href="#League-1393"><span class="linenos">1393</span></a>                        <span class="o">.</span><span class="n">index</span><span class="p">,</span>
</span><span id="League-1394"><a href="#League-1394"><span class="linenos">1394</span></a>                        <span class="s2">&quot;starter&quot;</span><span class="p">,</span>
</span><span id="League-1395"><a href="#League-1395"><span class="linenos">1395</span></a>                    <span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="League-1396"><a href="#League-1396"><span class="linenos">1396</span></a>            <span class="n">flex_pos</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;W/T&quot;</span><span class="p">:[</span><span class="s1">&#39;WR&#39;</span><span class="p">,</span><span class="s1">&#39;TE&#39;</span><span class="p">],</span><span class="s2">&quot;W/R/T&quot;</span><span class="p">:[</span><span class="s1">&#39;WR&#39;</span><span class="p">,</span><span class="s1">&#39;RB&#39;</span><span class="p">,</span><span class="s1">&#39;TE&#39;</span><span class="p">],</span><span class="s2">&quot;Q/W/R/T&quot;</span><span class="p">:[</span><span class="s1">&#39;WR&#39;</span><span class="p">,</span><span class="s1">&#39;RB&#39;</span><span class="p">,</span><span class="s1">&#39;TE&#39;</span><span class="p">,</span><span class="s1">&#39;QB&#39;</span><span class="p">]}</span>
</span><span id="League-1397"><a href="#League-1397"><span class="linenos">1397</span></a>            <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">flex_pos</span><span class="p">:</span>
</span><span id="League-1398"><a href="#League-1398"><span class="linenos">1398</span></a>                <span class="n">num_flex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">roster_spots</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">roster_spots</span><span class="o">.</span><span class="n">position</span> <span class="o">==</span> <span class="n">pos</span><span class="p">,</span><span class="s1">&#39;count&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</span><span id="League-1399"><a href="#League-1399"><span class="linenos">1399</span></a>                <span class="k">for</span> <span class="n">flex</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_flex</span><span class="p">):</span>
</span><span id="League-1400"><a href="#League-1400"><span class="linenos">1400</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League-1401"><a href="#League-1401"><span class="linenos">1401</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League-1402"><a href="#League-1402"><span class="linenos">1402</span></a>                            <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">starter</span>
</span><span id="League-1403"><a href="#League-1403"><span class="linenos">1403</span></a>                            <span class="o">&amp;</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">injured</span>
</span><span id="League-1404"><a href="#League-1404"><span class="linenos">1404</span></a>                            <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">bye_week</span> <span class="o">!=</span> <span class="n">week</span><span class="p">)</span>
</span><span id="League-1405"><a href="#League-1405"><span class="linenos">1405</span></a>                            <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">flex_pos</span><span class="p">[</span><span class="n">pos</span><span class="p">])</span>
</span><span id="League-1406"><a href="#League-1406"><span class="linenos">1406</span></a>                        <span class="p">]</span>
</span><span id="League-1407"><a href="#League-1407"><span class="linenos">1407</span></a>                        <span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;fantasy_team&quot;</span><span class="p">],</span> <span class="n">keep</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)</span>
</span><span id="League-1408"><a href="#League-1408"><span class="linenos">1408</span></a>                        <span class="o">.</span><span class="n">index</span><span class="p">,</span>
</span><span id="League-1409"><a href="#League-1409"><span class="linenos">1409</span></a>                        <span class="s2">&quot;starter&quot;</span><span class="p">,</span>
</span><span id="League-1410"><a href="#League-1410"><span class="linenos">1410</span></a>                    <span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="League-1411"><a href="#League-1411"><span class="linenos">1411</span></a>
</span><span id="League-1412"><a href="#League-1412"><span class="linenos">1412</span></a>    <span class="k">def</span> <span class="nf">bestball_sims</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">payouts</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">]):</span>
</span><span id="League-1413"><a href="#League-1413"><span class="linenos">1413</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="League-1414"><a href="#League-1414"><span class="linenos">1414</span></a><span class="sd">        Simulates the remainder of the fantasy season based on current rosters </span>
</span><span id="League-1415"><a href="#League-1415"><span class="linenos">1415</span></a><span class="sd">        and best ball settings using Monte Carlo simulations.</span>
</span><span id="League-1416"><a href="#League-1416"><span class="linenos">1416</span></a>
</span><span id="League-1417"><a href="#League-1417"><span class="linenos">1417</span></a><span class="sd">        Args:</span>
</span><span id="League-1418"><a href="#League-1418"><span class="linenos">1418</span></a><span class="sd">            payouts (list, optional): list of prize amounts for first, second, and third, defaults to [800, 300, 100].</span>
</span><span id="League-1419"><a href="#League-1419"><span class="linenos">1419</span></a>
</span><span id="League-1420"><a href="#League-1420"><span class="linenos">1420</span></a><span class="sd">        Returns:</span>
</span><span id="League-1421"><a href="#League-1421"><span class="linenos">1421</span></a><span class="sd">            standings (pd.DataFrame): simulated results for the final season standings and playoff projections.</span>
</span><span id="League-1422"><a href="#League-1422"><span class="linenos">1422</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="League-1423"><a href="#League-1423"><span class="linenos">1423</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_oauth</span><span class="p">()</span>
</span><span id="League-1424"><a href="#League-1424"><span class="linenos">1424</span></a>        <span class="n">projections</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;fantasy_team&quot;</span><span class="p">,</span> <span class="s2">&quot;week&quot;</span><span class="p">,</span> <span class="s2">&quot;points_avg&quot;</span><span class="p">,</span> <span class="s2">&quot;points_stdev&quot;</span><span class="p">])</span>
</span><span id="League-1425"><a href="#League-1425"><span class="linenos">1425</span></a>        <span class="k">for</span> <span class="n">week</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">week</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;playoff_start_week&#39;</span><span class="p">]):</span>
</span><span id="League-1426"><a href="#League-1426"><span class="linenos">1426</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">starters</span><span class="p">(</span><span class="n">week</span><span class="p">)</span>
</span><span id="League-1427"><a href="#League-1427"><span class="linenos">1427</span></a>            <span class="n">projections</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">projections</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">fantasy_team</span><span class="o">.</span><span class="n">isnull</span><span class="p">(),</span>\
</span><span id="League-1428"><a href="#League-1428"><span class="linenos">1428</span></a>            <span class="p">[</span><span class="s1">&#39;player_id_sr&#39;</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;position&#39;</span><span class="p">,</span><span class="s1">&#39;fantasy_team&#39;</span><span class="p">,</span><span class="s1">&#39;points_avg&#39;</span><span class="p">,</span><span class="s1">&#39;points_stdev&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)],</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="League-1429"><a href="#League-1429"><span class="linenos">1429</span></a>            <span class="n">projections</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">projections</span><span class="o">.</span><span class="n">week</span><span class="o">.</span><span class="n">isnull</span><span class="p">(),</span> <span class="s2">&quot;week&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">week</span>
</span><span id="League-1430"><a href="#League-1430"><span class="linenos">1430</span></a>        <span class="n">season_sims</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">projections</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_sims</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="League-1431"><a href="#League-1431"><span class="linenos">1431</span></a>        <span class="n">season_sims</span><span class="p">[</span><span class="s2">&quot;num_sim&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">season_sims</span><span class="o">.</span><span class="n">index</span> <span class="o">//</span> <span class="n">projections</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League-1432"><a href="#League-1432"><span class="linenos">1432</span></a>        <span class="n">season_sims</span><span class="p">[</span><span class="s2">&quot;points_sim&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League-1433"><a href="#League-1433"><span class="linenos">1433</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">season_sims</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="League-1434"><a href="#League-1434"><span class="linenos">1434</span></a>            <span class="o">*</span> <span class="n">season_sims</span><span class="p">[</span><span class="s2">&quot;points_stdev&quot;</span><span class="p">]</span>
</span><span id="League-1435"><a href="#League-1435"><span class="linenos">1435</span></a>            <span class="o">+</span> <span class="n">season_sims</span><span class="p">[</span><span class="s2">&quot;points_avg&quot;</span><span class="p">]</span>
</span><span id="League-1436"><a href="#League-1436"><span class="linenos">1436</span></a>        <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="League-1437"><a href="#League-1437"><span class="linenos">1437</span></a>        <span class="n">season_sims</span> <span class="o">=</span> <span class="n">season_sims</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;points_sim&#39;</span><span class="p">,</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="League-1438"><a href="#League-1438"><span class="linenos">1438</span></a>        <span class="n">season_sims</span><span class="p">[</span><span class="s1">&#39;injured&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">season_sims</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mf">0.1</span>
</span><span id="League-1439"><a href="#League-1439"><span class="linenos">1439</span></a>        <span class="n">season_sims</span><span class="p">[</span><span class="s1">&#39;starter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="League-1440"><a href="#League-1440"><span class="linenos">1440</span></a>        <span class="n">num_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">roster_spots</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">roster_spots</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;W/T&quot;</span><span class="p">,</span> <span class="s2">&quot;W/R/T&quot;</span><span class="p">,</span> <span class="s2">&quot;Q/W/R/T&quot;</span><span class="p">,</span> <span class="s2">&quot;BN&quot;</span><span class="p">,</span> <span class="s2">&quot;IR&quot;</span><span class="p">])]</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;position&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span>
</span><span id="League-1441"><a href="#League-1441"><span class="linenos">1441</span></a>        <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">num_pos</span><span class="p">:</span>
</span><span id="League-1442"><a href="#League-1442"><span class="linenos">1442</span></a>            <span class="n">inds</span> <span class="o">=</span> <span class="n">season_sims</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">season_sims</span><span class="o">.</span><span class="n">position</span> <span class="o">==</span> <span class="n">pos</span><span class="p">)</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">season_sims</span><span class="o">.</span><span class="n">injured</span><span class="p">]</span>\
</span><span id="League-1443"><a href="#League-1443"><span class="linenos">1443</span></a>            <span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;num_sim&#39;</span><span class="p">,</span><span class="s1">&#39;week&#39;</span><span class="p">,</span><span class="s1">&#39;fantasy_team&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">num_pos</span><span class="p">[</span><span class="n">pos</span><span class="p">])</span><span class="o">.</span><span class="n">index</span>
</span><span id="League-1444"><a href="#League-1444"><span class="linenos">1444</span></a>            <span class="n">season_sims</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inds</span><span class="p">,</span><span class="s1">&#39;starter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="League-1445"><a href="#League-1445"><span class="linenos">1445</span></a>        <span class="n">flex_pos</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;W/T&quot;</span><span class="p">:[</span><span class="s1">&#39;WR&#39;</span><span class="p">,</span><span class="s1">&#39;TE&#39;</span><span class="p">],</span><span class="s2">&quot;W/R/T&quot;</span><span class="p">:[</span><span class="s1">&#39;WR&#39;</span><span class="p">,</span><span class="s1">&#39;RB&#39;</span><span class="p">,</span><span class="s1">&#39;TE&#39;</span><span class="p">],</span><span class="s2">&quot;Q/W/R/T&quot;</span><span class="p">:[</span><span class="s1">&#39;WR&#39;</span><span class="p">,</span><span class="s1">&#39;RB&#39;</span><span class="p">,</span><span class="s1">&#39;TE&#39;</span><span class="p">,</span><span class="s1">&#39;QB&#39;</span><span class="p">]}</span>
</span><span id="League-1446"><a href="#League-1446"><span class="linenos">1446</span></a>        <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">flex_pos</span><span class="p">:</span>
</span><span id="League-1447"><a href="#League-1447"><span class="linenos">1447</span></a>            <span class="n">num_flex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">roster_spots</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">roster_spots</span><span class="o">.</span><span class="n">position</span> <span class="o">==</span> <span class="n">pos</span><span class="p">,</span><span class="s1">&#39;count&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</span><span id="League-1448"><a href="#League-1448"><span class="linenos">1448</span></a>            <span class="n">inds</span> <span class="o">=</span> <span class="n">season_sims</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">season_sims</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">flex_pos</span><span class="p">[</span><span class="n">pos</span><span class="p">])</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">season_sims</span><span class="o">.</span><span class="n">injured</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">season_sims</span><span class="o">.</span><span class="n">starter</span><span class="p">]</span>\
</span><span id="League-1449"><a href="#League-1449"><span class="linenos">1449</span></a>            <span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;num_sim&#39;</span><span class="p">,</span><span class="s1">&#39;week&#39;</span><span class="p">,</span><span class="s1">&#39;fantasy_team&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">num_flex</span><span class="p">)</span><span class="o">.</span><span class="n">index</span>
</span><span id="League-1450"><a href="#League-1450"><span class="linenos">1450</span></a>            <span class="n">season_sims</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inds</span><span class="p">,</span><span class="s1">&#39;starter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="League-1451"><a href="#League-1451"><span class="linenos">1451</span></a>        <span class="n">standings_sims</span> <span class="o">=</span> <span class="n">season_sims</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">season_sims</span><span class="o">.</span><span class="n">starter</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;num_sim&#39;</span><span class="p">,</span><span class="s1">&#39;fantasy_team&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">points_sim</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="League-1452"><a href="#League-1452"><span class="linenos">1452</span></a>        <span class="n">standings_sims</span> <span class="o">=</span> <span class="n">standings_sims</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;num_sim&#39;</span><span class="p">,</span><span class="s1">&#39;points_sim&#39;</span><span class="p">],</span><span class="n">ascending</span><span class="o">=</span><span class="p">[</span><span class="kc">True</span><span class="p">,</span><span class="kc">False</span><span class="p">],</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="League-1453"><a href="#League-1453"><span class="linenos">1453</span></a>        <span class="n">standings_sims</span><span class="p">[</span><span class="s1">&#39;place&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">standings_sims</span><span class="o">.</span><span class="n">index</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">teams</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="League-1454"><a href="#League-1454"><span class="linenos">1454</span></a>        <span class="n">standings_sims</span><span class="p">[</span><span class="s2">&quot;playoffs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">standings_sims</span><span class="p">[</span><span class="s1">&#39;place&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;num_playoff_teams&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="League-1455"><a href="#League-1455"><span class="linenos">1455</span></a>        <span class="n">standings_sims</span><span class="p">[</span><span class="s2">&quot;winner&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">standings_sims</span><span class="p">[</span><span class="s1">&#39;place&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="League-1456"><a href="#League-1456"><span class="linenos">1456</span></a>        <span class="n">standings_sims</span><span class="p">[</span><span class="s2">&quot;runner_up&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">standings_sims</span><span class="p">[</span><span class="s1">&#39;place&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="League-1457"><a href="#League-1457"><span class="linenos">1457</span></a>        <span class="n">standings_sims</span><span class="p">[</span><span class="s2">&quot;third&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">standings_sims</span><span class="p">[</span><span class="s1">&#39;place&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="League-1458"><a href="#League-1458"><span class="linenos">1458</span></a>        <span class="n">payouts</span> <span class="o">+=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">teams</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">payouts</span><span class="p">))</span>
</span><span id="League-1459"><a href="#League-1459"><span class="linenos">1459</span></a>        <span class="n">standings_sims</span><span class="p">[</span><span class="s1">&#39;earnings&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">payouts</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">num_sims</span>
</span><span id="League-1460"><a href="#League-1460"><span class="linenos">1460</span></a>        <span class="n">standings</span> <span class="o">=</span> <span class="n">standings_sims</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;fantasy_team&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="League-1461"><a href="#League-1461"><span class="linenos">1461</span></a>        <span class="n">standings</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">standings</span><span class="p">,</span><span class="n">right</span><span class="o">=</span><span class="n">standings_sims</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;fantasy_team&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">points_sim</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>\
</span><span id="League-1462"><a href="#League-1462"><span class="linenos">1462</span></a>        <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;points_sim&#39;</span><span class="p">:</span><span class="s1">&#39;points_stdev&#39;</span><span class="p">}),</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="s1">&#39;fantasy_team&#39;</span><span class="p">)</span>
</span><span id="League-1463"><a href="#League-1463"><span class="linenos">1463</span></a>        <span class="n">standings</span> <span class="o">=</span> <span class="n">standings</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fantasy_team&#39;</span><span class="p">:</span><span class="s1">&#39;team&#39;</span><span class="p">,</span><span class="s1">&#39;points_sim&#39;</span><span class="p">:</span><span class="s1">&#39;points_avg&#39;</span><span class="p">,</span><span class="s1">&#39;place&#39;</span><span class="p">:</span><span class="s1">&#39;avg_place&#39;</span><span class="p">})</span>
</span><span id="League-1464"><a href="#League-1464"><span class="linenos">1464</span></a>        <span class="n">standings</span> <span class="o">=</span> <span class="n">standings</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;playoffs&#39;</span><span class="p">,</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="League-1465"><a href="#League-1465"><span class="linenos">1465</span></a>        <span class="k">del</span> <span class="n">standings</span><span class="p">[</span><span class="s1">&#39;num_sim&#39;</span><span class="p">]</span>
</span><span id="League-1466"><a href="#League-1466"><span class="linenos">1466</span></a>        <span class="n">standings</span><span class="p">[[</span><span class="s2">&quot;wins_avg&quot;</span><span class="p">,</span><span class="s2">&quot;wins_stdev&quot;</span><span class="p">,</span><span class="s2">&quot;playoff_bye&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="League-1467"><a href="#League-1467"><span class="linenos">1467</span></a>        <span class="k">return</span> <span class="n">standings</span>
</span><span id="League-1468"><a href="#League-1468"><span class="linenos">1468</span></a>
</span><span id="League-1469"><a href="#League-1469"><span class="linenos">1469</span></a>    <span class="k">def</span> <span class="nf">season_sims</span><span class="p">(</span>
</span><span id="League-1470"><a href="#League-1470"><span class="linenos">1470</span></a>        <span class="bp">self</span><span class="p">,</span> 
</span><span id="League-1471"><a href="#League-1471"><span class="linenos">1471</span></a>        <span class="n">postseason</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> 
</span><span id="League-1472"><a href="#League-1472"><span class="linenos">1472</span></a>        <span class="n">payouts</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">800</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span> 
</span><span id="League-1473"><a href="#League-1473"><span class="linenos">1473</span></a>        <span class="n">fixed_winner</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="League-1474"><a href="#League-1474"><span class="linenos">1474</span></a>    <span class="p">):</span>
</span><span id="League-1475"><a href="#League-1475"><span class="linenos">1475</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="League-1476"><a href="#League-1476"><span class="linenos">1476</span></a><span class="sd">        Simulates the remainder of the fantasy season based on current rosters </span>
</span><span id="League-1477"><a href="#League-1477"><span class="linenos">1477</span></a><span class="sd">        and redraft settings using Monte Carlo simulations.</span>
</span><span id="League-1478"><a href="#League-1478"><span class="linenos">1478</span></a>
</span><span id="League-1479"><a href="#League-1479"><span class="linenos">1479</span></a><span class="sd">        Args:</span>
</span><span id="League-1480"><a href="#League-1480"><span class="linenos">1480</span></a><span class="sd">            postseason (bool, optional): whether to simulate the postseason in addition to the regular season, defaults to True.  </span>
</span><span id="League-1481"><a href="#League-1481"><span class="linenos">1481</span></a><span class="sd">            payouts (list, optional): list of prize amounts for first, second, and third, defaults to [800, 300, 100].  </span>
</span><span id="League-1482"><a href="#League-1482"><span class="linenos">1482</span></a><span class="sd">            fixed_winner (list, optional): list containing the week and team name of a fixed winner, defaults to None.</span>
</span><span id="League-1483"><a href="#League-1483"><span class="linenos">1483</span></a>
</span><span id="League-1484"><a href="#League-1484"><span class="linenos">1484</span></a><span class="sd">        Returns:</span>
</span><span id="League-1485"><a href="#League-1485"><span class="linenos">1485</span></a><span class="sd">            schedule (pd.DataFrame): simulated results for each matchup throughout the season in question  </span>
</span><span id="League-1486"><a href="#League-1486"><span class="linenos">1486</span></a><span class="sd">            standings (pd.DataFrame): simulated results for the final season standings and playoff projections</span>
</span><span id="League-1487"><a href="#League-1487"><span class="linenos">1487</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="League-1488"><a href="#League-1488"><span class="linenos">1488</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_oauth</span><span class="p">()</span>
</span><span id="League-1489"><a href="#League-1489"><span class="linenos">1489</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[</span><span class="s2">&quot;points_var&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">points_stdev</span><span class="o">**</span><span class="mi">2</span>
</span><span id="League-1490"><a href="#League-1490"><span class="linenos">1490</span></a>        <span class="n">projections</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span><span id="League-1491"><a href="#League-1491"><span class="linenos">1491</span></a>            <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;fantasy_team&quot;</span><span class="p">,</span> <span class="s2">&quot;week&quot;</span><span class="p">,</span> <span class="s2">&quot;points_avg&quot;</span><span class="p">,</span> <span class="s2">&quot;points_var&quot;</span><span class="p">]</span>
</span><span id="League-1492"><a href="#League-1492"><span class="linenos">1492</span></a>        <span class="p">)</span>
</span><span id="League-1493"><a href="#League-1493"><span class="linenos">1493</span></a>        <span class="k">for</span> <span class="n">week</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">17</span><span class="p">):</span>
</span><span id="League-1494"><a href="#League-1494"><span class="linenos">1494</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">starters</span><span class="p">(</span><span class="n">week</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="League-1495"><a href="#League-1495"><span class="linenos">1495</span></a>            <span class="n">projections</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">projections</span><span class="p">,</span>
</span><span id="League-1496"><a href="#League-1496"><span class="linenos">1496</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">starter</span><span class="p">]</span>
</span><span id="League-1497"><a href="#League-1497"><span class="linenos">1497</span></a>                <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;fantasy_team&quot;</span><span class="p">)[[</span><span class="s2">&quot;points_avg&quot;</span><span class="p">,</span> <span class="s2">&quot;points_var&quot;</span><span class="p">]]</span>
</span><span id="League-1498"><a href="#League-1498"><span class="linenos">1498</span></a>                <span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</span><span id="League-1499"><a href="#League-1499"><span class="linenos">1499</span></a>                <span class="o">.</span><span class="n">reset_index</span><span class="p">()],</span>
</span><span id="League-1500"><a href="#League-1500"><span class="linenos">1500</span></a>                <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="League-1501"><a href="#League-1501"><span class="linenos">1501</span></a>                <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="League-1502"><a href="#League-1502"><span class="linenos">1502</span></a>            <span class="p">)</span>
</span><span id="League-1503"><a href="#League-1503"><span class="linenos">1503</span></a>            <span class="n">projections</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">projections</span><span class="o">.</span><span class="n">week</span><span class="o">.</span><span class="n">isnull</span><span class="p">(),</span> <span class="s2">&quot;week&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">week</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="League-1504"><a href="#League-1504"><span class="linenos">1504</span></a>        <span class="n">projections</span><span class="p">[</span><span class="s2">&quot;points_stdev&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">projections</span><span class="p">[</span><span class="s2">&quot;points_var&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="mf">0.5</span>
</span><span id="League-1505"><a href="#League-1505"><span class="linenos">1505</span></a>        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[</span><span class="s2">&quot;points_var&quot;</span><span class="p">]</span>
</span><span id="League-1506"><a href="#League-1506"><span class="linenos">1506</span></a>        <span class="n">schedule</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League-1507"><a href="#League-1507"><span class="linenos">1507</span></a>            <span class="n">left</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
</span><span id="League-1508"><a href="#League-1508"><span class="linenos">1508</span></a>            <span class="n">right</span><span class="o">=</span><span class="n">projections</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
</span><span id="League-1509"><a href="#League-1509"><span class="linenos">1509</span></a>                <span class="n">index</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="League-1510"><a href="#League-1510"><span class="linenos">1510</span></a>                <span class="n">columns</span><span class="o">=</span><span class="p">{</span>
</span><span id="League-1511"><a href="#League-1511"><span class="linenos">1511</span></a>                    <span class="s2">&quot;fantasy_team&quot;</span><span class="p">:</span> <span class="s2">&quot;team_1&quot;</span><span class="p">,</span>
</span><span id="League-1512"><a href="#League-1512"><span class="linenos">1512</span></a>                    <span class="s2">&quot;points_avg&quot;</span><span class="p">:</span> <span class="s2">&quot;points_avg_1&quot;</span><span class="p">,</span>
</span><span id="League-1513"><a href="#League-1513"><span class="linenos">1513</span></a>                    <span class="s2">&quot;points_stdev&quot;</span><span class="p">:</span> <span class="s2">&quot;points_stdev_1&quot;</span><span class="p">,</span>
</span><span id="League-1514"><a href="#League-1514"><span class="linenos">1514</span></a>                <span class="p">},</span>
</span><span id="League-1515"><a href="#League-1515"><span class="linenos">1515</span></a>            <span class="p">),</span>
</span><span id="League-1516"><a href="#League-1516"><span class="linenos">1516</span></a>            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
</span><span id="League-1517"><a href="#League-1517"><span class="linenos">1517</span></a>            <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;week&quot;</span><span class="p">,</span> <span class="s2">&quot;team_1&quot;</span><span class="p">],</span>
</span><span id="League-1518"><a href="#League-1518"><span class="linenos">1518</span></a>        <span class="p">)</span>
</span><span id="League-1519"><a href="#League-1519"><span class="linenos">1519</span></a>        <span class="n">schedule</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League-1520"><a href="#League-1520"><span class="linenos">1520</span></a>            <span class="n">left</span><span class="o">=</span><span class="n">schedule</span><span class="p">,</span>
</span><span id="League-1521"><a href="#League-1521"><span class="linenos">1521</span></a>            <span class="n">right</span><span class="o">=</span><span class="n">projections</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
</span><span id="League-1522"><a href="#League-1522"><span class="linenos">1522</span></a>                <span class="n">index</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="League-1523"><a href="#League-1523"><span class="linenos">1523</span></a>                <span class="n">columns</span><span class="o">=</span><span class="p">{</span>
</span><span id="League-1524"><a href="#League-1524"><span class="linenos">1524</span></a>                    <span class="s2">&quot;fantasy_team&quot;</span><span class="p">:</span> <span class="s2">&quot;team_2&quot;</span><span class="p">,</span>
</span><span id="League-1525"><a href="#League-1525"><span class="linenos">1525</span></a>                    <span class="s2">&quot;points_avg&quot;</span><span class="p">:</span> <span class="s2">&quot;points_avg_2&quot;</span><span class="p">,</span>
</span><span id="League-1526"><a href="#League-1526"><span class="linenos">1526</span></a>                    <span class="s2">&quot;points_stdev&quot;</span><span class="p">:</span> <span class="s2">&quot;points_stdev_2&quot;</span><span class="p">,</span>
</span><span id="League-1527"><a href="#League-1527"><span class="linenos">1527</span></a>                <span class="p">},</span>
</span><span id="League-1528"><a href="#League-1528"><span class="linenos">1528</span></a>            <span class="p">),</span>
</span><span id="League-1529"><a href="#League-1529"><span class="linenos">1529</span></a>            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
</span><span id="League-1530"><a href="#League-1530"><span class="linenos">1530</span></a>            <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;week&quot;</span><span class="p">,</span> <span class="s2">&quot;team_2&quot;</span><span class="p">],</span>
</span><span id="League-1531"><a href="#League-1531"><span class="linenos">1531</span></a>        <span class="p">)</span>
</span><span id="League-1532"><a href="#League-1532"><span class="linenos">1532</span></a>        <span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;points_avg_1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;points_avg_1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="League-1533"><a href="#League-1533"><span class="linenos">1533</span></a>        <span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;points_avg_2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;points_avg_2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="League-1534"><a href="#League-1534"><span class="linenos">1534</span></a>        <span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;points_stdev_1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League-1535"><a href="#League-1535"><span class="linenos">1535</span></a>            <span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;points_stdev_1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="League-1536"><a href="#League-1536"><span class="linenos">1536</span></a>        <span class="p">)</span>
</span><span id="League-1537"><a href="#League-1537"><span class="linenos">1537</span></a>        <span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;points_stdev_2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League-1538"><a href="#League-1538"><span class="linenos">1538</span></a>            <span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;points_stdev_2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="League-1539"><a href="#League-1539"><span class="linenos">1539</span></a>        <span class="p">)</span>
</span><span id="League-1540"><a href="#League-1540"><span class="linenos">1540</span></a>        <span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;points_avg_1&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;score_1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="League-1541"><a href="#League-1541"><span class="linenos">1541</span></a>        <span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;points_avg_2&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;score_2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="League-1542"><a href="#League-1542"><span class="linenos">1542</span></a>        <span class="k">if</span> <span class="n">fixed_winner</span><span class="p">:</span>
</span><span id="League-1543"><a href="#League-1543"><span class="linenos">1543</span></a>            <span class="k">if</span> <span class="p">(</span>
</span><span id="League-1544"><a href="#League-1544"><span class="linenos">1544</span></a>                <span class="p">(</span><span class="n">schedule</span><span class="o">.</span><span class="n">week</span> <span class="o">==</span> <span class="n">fixed_winner</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="League-1545"><a href="#League-1545"><span class="linenos">1545</span></a>                <span class="o">&amp;</span> <span class="p">(</span><span class="n">schedule</span><span class="o">.</span><span class="n">team_1</span> <span class="o">==</span> <span class="n">fixed_winner</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="League-1546"><a href="#League-1546"><span class="linenos">1546</span></a>            <span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="League-1547"><a href="#League-1547"><span class="linenos">1547</span></a>                <span class="n">winner</span><span class="p">,</span> <span class="n">loser</span> <span class="o">=</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span>
</span><span id="League-1548"><a href="#League-1548"><span class="linenos">1548</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="League-1549"><a href="#League-1549"><span class="linenos">1549</span></a>                <span class="n">winner</span><span class="p">,</span> <span class="n">loser</span> <span class="o">=</span> <span class="s2">&quot;2&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span>
</span><span id="League-1550"><a href="#League-1550"><span class="linenos">1550</span></a>            <span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League-1551"><a href="#League-1551"><span class="linenos">1551</span></a>                <span class="p">(</span><span class="n">schedule</span><span class="o">.</span><span class="n">week</span> <span class="o">==</span> <span class="n">fixed_winner</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="League-1552"><a href="#League-1552"><span class="linenos">1552</span></a>                <span class="o">&amp;</span> <span class="p">(</span><span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;team_&quot;</span> <span class="o">+</span> <span class="n">winner</span><span class="p">]</span> <span class="o">==</span> <span class="n">fixed_winner</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
</span><span id="League-1553"><a href="#League-1553"><span class="linenos">1553</span></a>                <span class="s2">&quot;points_avg_&quot;</span> <span class="o">+</span> <span class="n">winner</span><span class="p">,</span>
</span><span id="League-1554"><a href="#League-1554"><span class="linenos">1554</span></a>            <span class="p">]</span> <span class="o">=</span> <span class="mf">100.1</span>
</span><span id="League-1555"><a href="#League-1555"><span class="linenos">1555</span></a>            <span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League-1556"><a href="#League-1556"><span class="linenos">1556</span></a>                <span class="p">(</span><span class="n">schedule</span><span class="o">.</span><span class="n">week</span> <span class="o">==</span> <span class="n">fixed_winner</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="League-1557"><a href="#League-1557"><span class="linenos">1557</span></a>                <span class="o">&amp;</span> <span class="p">(</span><span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;team_&quot;</span> <span class="o">+</span> <span class="n">winner</span><span class="p">]</span> <span class="o">==</span> <span class="n">fixed_winner</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
</span><span id="League-1558"><a href="#League-1558"><span class="linenos">1558</span></a>                <span class="s2">&quot;points_avg_&quot;</span> <span class="o">+</span> <span class="n">loser</span><span class="p">,</span>
</span><span id="League-1559"><a href="#League-1559"><span class="linenos">1559</span></a>            <span class="p">]</span> <span class="o">=</span> <span class="mf">100.0</span>
</span><span id="League-1560"><a href="#League-1560"><span class="linenos">1560</span></a>            <span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League-1561"><a href="#League-1561"><span class="linenos">1561</span></a>                <span class="p">(</span><span class="n">schedule</span><span class="o">.</span><span class="n">week</span> <span class="o">==</span> <span class="n">fixed_winner</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="League-1562"><a href="#League-1562"><span class="linenos">1562</span></a>                <span class="o">&amp;</span> <span class="p">(</span><span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;team_&quot;</span> <span class="o">+</span> <span class="n">winner</span><span class="p">]</span> <span class="o">==</span> <span class="n">fixed_winner</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
</span><span id="League-1563"><a href="#League-1563"><span class="linenos">1563</span></a>                <span class="s2">&quot;points_stdev_&quot;</span> <span class="o">+</span> <span class="n">winner</span><span class="p">,</span>
</span><span id="League-1564"><a href="#League-1564"><span class="linenos">1564</span></a>            <span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="League-1565"><a href="#League-1565"><span class="linenos">1565</span></a>            <span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League-1566"><a href="#League-1566"><span class="linenos">1566</span></a>                <span class="p">(</span><span class="n">schedule</span><span class="o">.</span><span class="n">week</span> <span class="o">==</span> <span class="n">fixed_winner</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="League-1567"><a href="#League-1567"><span class="linenos">1567</span></a>                <span class="o">&amp;</span> <span class="p">(</span><span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;team_&quot;</span> <span class="o">+</span> <span class="n">winner</span><span class="p">]</span> <span class="o">==</span> <span class="n">fixed_winner</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
</span><span id="League-1568"><a href="#League-1568"><span class="linenos">1568</span></a>                <span class="s2">&quot;points_stdev_&quot;</span> <span class="o">+</span> <span class="n">loser</span><span class="p">,</span>
</span><span id="League-1569"><a href="#League-1569"><span class="linenos">1569</span></a>            <span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="League-1570"><a href="#League-1570"><span class="linenos">1570</span></a>        <span class="n">schedule_sims</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
</span><span id="League-1571"><a href="#League-1571"><span class="linenos">1571</span></a>            <span class="p">[</span><span class="n">schedule</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_sims</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span>
</span><span id="League-1572"><a href="#League-1572"><span class="linenos">1572</span></a>        <span class="p">)</span>
</span><span id="League-1573"><a href="#League-1573"><span class="linenos">1573</span></a>        <span class="n">schedule_sims</span><span class="p">[</span><span class="s2">&quot;num_sim&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">schedule_sims</span><span class="o">.</span><span class="n">index</span> <span class="o">//</span> <span class="n">schedule</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League-1574"><a href="#League-1574"><span class="linenos">1574</span></a>        <span class="n">schedule_sims</span><span class="p">[</span><span class="s2">&quot;sim_1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League-1575"><a href="#League-1575"><span class="linenos">1575</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">schedule_sims</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="League-1576"><a href="#League-1576"><span class="linenos">1576</span></a>            <span class="o">*</span> <span class="n">schedule_sims</span><span class="p">[</span><span class="s2">&quot;points_stdev_1&quot;</span><span class="p">]</span>
</span><span id="League-1577"><a href="#League-1577"><span class="linenos">1577</span></a>            <span class="o">+</span> <span class="n">schedule_sims</span><span class="p">[</span><span class="s2">&quot;points_avg_1&quot;</span><span class="p">]</span>
</span><span id="League-1578"><a href="#League-1578"><span class="linenos">1578</span></a>        <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="League-1579"><a href="#League-1579"><span class="linenos">1579</span></a>        <span class="n">schedule_sims</span><span class="p">[</span><span class="s2">&quot;sim_2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League-1580"><a href="#League-1580"><span class="linenos">1580</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">schedule_sims</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="League-1581"><a href="#League-1581"><span class="linenos">1581</span></a>            <span class="o">*</span> <span class="n">schedule_sims</span><span class="p">[</span><span class="s2">&quot;points_stdev_2&quot;</span><span class="p">]</span>
</span><span id="League-1582"><a href="#League-1582"><span class="linenos">1582</span></a>            <span class="o">+</span> <span class="n">schedule_sims</span><span class="p">[</span><span class="s2">&quot;points_avg_2&quot;</span><span class="p">]</span>
</span><span id="League-1583"><a href="#League-1583"><span class="linenos">1583</span></a>        <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="League-1584"><a href="#League-1584"><span class="linenos">1584</span></a>        <span class="n">schedule_sims</span><span class="p">[</span><span class="s2">&quot;win_1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">schedule_sims</span><span class="o">.</span><span class="n">sim_1</span> <span class="o">&gt;</span> <span class="n">schedule_sims</span><span class="o">.</span><span class="n">sim_2</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="League-1585"><a href="#League-1585"><span class="linenos">1585</span></a>        <span class="n">schedule_sims</span><span class="p">[</span><span class="s2">&quot;win_2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">schedule_sims</span><span class="p">[</span><span class="s2">&quot;win_1&quot;</span><span class="p">]</span>
</span><span id="League-1586"><a href="#League-1586"><span class="linenos">1586</span></a>        <span class="n">standings</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span>
</span><span id="League-1587"><a href="#League-1587"><span class="linenos">1587</span></a>            <span class="n">schedule_sims</span><span class="p">[[</span><span class="s2">&quot;num_sim&quot;</span><span class="p">,</span> <span class="s2">&quot;week&quot;</span><span class="p">,</span> <span class="s2">&quot;team_1&quot;</span><span class="p">,</span> <span class="s2">&quot;sim_1&quot;</span><span class="p">,</span> <span class="s2">&quot;win_1&quot;</span><span class="p">]]</span>
</span><span id="League-1588"><a href="#League-1588"><span class="linenos">1588</span></a>            <span class="o">.</span><span class="n">rename</span><span class="p">(</span>
</span><span id="League-1589"><a href="#League-1589"><span class="linenos">1589</span></a>                <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;team_1&quot;</span><span class="p">:</span> <span class="s2">&quot;team&quot;</span><span class="p">,</span> <span class="s2">&quot;win_1&quot;</span><span class="p">:</span> <span class="s2">&quot;wins&quot;</span><span class="p">,</span> <span class="s2">&quot;sim_1&quot;</span><span class="p">:</span> <span class="s2">&quot;points&quot;</span><span class="p">},</span>
</span><span id="League-1590"><a href="#League-1590"><span class="linenos">1590</span></a>            <span class="p">),</span>
</span><span id="League-1591"><a href="#League-1591"><span class="linenos">1591</span></a>            <span class="n">schedule_sims</span><span class="p">[[</span><span class="s2">&quot;num_sim&quot;</span><span class="p">,</span> <span class="s2">&quot;week&quot;</span><span class="p">,</span> <span class="s2">&quot;team_2&quot;</span><span class="p">,</span> <span class="s2">&quot;sim_2&quot;</span><span class="p">,</span> <span class="s2">&quot;win_2&quot;</span><span class="p">]]</span>
</span><span id="League-1592"><a href="#League-1592"><span class="linenos">1592</span></a>            <span class="o">.</span><span class="n">rename</span><span class="p">(</span>
</span><span id="League-1593"><a href="#League-1593"><span class="linenos">1593</span></a>                <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;team_2&quot;</span><span class="p">:</span> <span class="s2">&quot;team&quot;</span><span class="p">,</span> <span class="s2">&quot;win_2&quot;</span><span class="p">:</span> <span class="s2">&quot;wins&quot;</span><span class="p">,</span> <span class="s2">&quot;sim_2&quot;</span><span class="p">:</span> <span class="s2">&quot;points&quot;</span><span class="p">},</span>
</span><span id="League-1594"><a href="#League-1594"><span class="linenos">1594</span></a>            <span class="p">)],</span>
</span><span id="League-1595"><a href="#League-1595"><span class="linenos">1595</span></a>            <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="League-1596"><a href="#League-1596"><span class="linenos">1596</span></a>        <span class="p">)</span>
</span><span id="League-1597"><a href="#League-1597"><span class="linenos">1597</span></a>        <span class="n">standings</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League-1598"><a href="#League-1598"><span class="linenos">1598</span></a>            <span class="n">standings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">standings</span><span class="o">.</span><span class="n">week</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;playoff_start_week&quot;</span><span class="p">]]</span>
</span><span id="League-1599"><a href="#League-1599"><span class="linenos">1599</span></a>            <span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;num_sim&quot;</span><span class="p">,</span> <span class="s2">&quot;team&quot;</span><span class="p">])</span>
</span><span id="League-1600"><a href="#League-1600"><span class="linenos">1600</span></a>            <span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">numeric_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="League-1601"><a href="#League-1601"><span class="linenos">1601</span></a>            <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;num_sim&quot;</span><span class="p">,</span> <span class="s2">&quot;wins&quot;</span><span class="p">,</span> <span class="s2">&quot;points&quot;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="League-1602"><a href="#League-1602"><span class="linenos">1602</span></a>            <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="League-1603"><a href="#League-1603"><span class="linenos">1603</span></a>        <span class="p">)</span>
</span><span id="League-1604"><a href="#League-1604"><span class="linenos">1604</span></a>        <span class="n">standings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League-1605"><a href="#League-1605"><span class="linenos">1605</span></a>            <span class="n">standings</span><span class="o">.</span><span class="n">index</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">teams</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;num_playoff_teams&quot;</span><span class="p">],</span>
</span><span id="League-1606"><a href="#League-1606"><span class="linenos">1606</span></a>            <span class="s2">&quot;playoffs&quot;</span><span class="p">,</span>
</span><span id="League-1607"><a href="#League-1607"><span class="linenos">1607</span></a>        <span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="League-1608"><a href="#League-1608"><span class="linenos">1608</span></a>        <span class="n">standings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League-1609"><a href="#League-1609"><span class="linenos">1609</span></a>            <span class="n">standings</span><span class="o">.</span><span class="n">index</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">teams</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;num_playoff_teams&quot;</span><span class="p">],</span>
</span><span id="League-1610"><a href="#League-1610"><span class="linenos">1610</span></a>            <span class="s2">&quot;playoffs&quot;</span><span class="p">,</span>
</span><span id="League-1611"><a href="#League-1611"><span class="linenos">1611</span></a>        <span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="League-1612"><a href="#League-1612"><span class="linenos">1612</span></a>        <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;playoff_bye&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="League-1613"><a href="#League-1613"><span class="linenos">1613</span></a>        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;num_playoff_teams&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
</span><span id="League-1614"><a href="#League-1614"><span class="linenos">1614</span></a>            <span class="n">standings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">standings</span><span class="o">.</span><span class="n">index</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">teams</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;playoff_bye&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="League-1615"><a href="#League-1615"><span class="linenos">1615</span></a>        <span class="n">algorithm</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League-1616"><a href="#League-1616"><span class="linenos">1616</span></a>            <span class="n">schedule</span><span class="o">.</span><span class="n">team_1</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;The Algorithm&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
</span><span id="League-1617"><a href="#League-1617"><span class="linenos">1617</span></a>            <span class="ow">or</span> <span class="n">schedule</span><span class="o">.</span><span class="n">team_2</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;The Algorithm&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
</span><span id="League-1618"><a href="#League-1618"><span class="linenos">1618</span></a>        <span class="p">)</span>
</span><span id="League-1619"><a href="#League-1619"><span class="linenos">1619</span></a>        <span class="k">if</span> <span class="n">postseason</span><span class="p">:</span>
</span><span id="League-1620"><a href="#League-1620"><span class="linenos">1620</span></a>            <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;seed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">standings</span><span class="o">.</span><span class="n">index</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">teams</span><span class="p">)</span>
</span><span id="League-1621"><a href="#League-1621"><span class="linenos">1621</span></a>            <span class="n">scores</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League-1622"><a href="#League-1622"><span class="linenos">1622</span></a>                    <span class="n">schedule</span><span class="o">.</span><span class="n">week</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;playoff_start_week&quot;</span><span class="p">],</span>
</span><span id="League-1623"><a href="#League-1623"><span class="linenos">1623</span></a>                    <span class="p">[</span><span class="s2">&quot;week&quot;</span><span class="p">,</span> <span class="s2">&quot;team_1&quot;</span><span class="p">,</span> <span class="s2">&quot;score_1&quot;</span><span class="p">],</span>
</span><span id="League-1624"><a href="#League-1624"><span class="linenos">1624</span></a>                <span class="p">]</span>
</span><span id="League-1625"><a href="#League-1625"><span class="linenos">1625</span></a>                <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;team_1&quot;</span><span class="p">:</span> <span class="s2">&quot;team&quot;</span><span class="p">,</span> <span class="s2">&quot;score_1&quot;</span><span class="p">:</span> <span class="s2">&quot;score&quot;</span><span class="p">}),</span>
</span><span id="League-1626"><a href="#League-1626"><span class="linenos">1626</span></a>                <span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League-1627"><a href="#League-1627"><span class="linenos">1627</span></a>                    <span class="n">schedule</span><span class="o">.</span><span class="n">week</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;playoff_start_week&quot;</span><span class="p">],</span>
</span><span id="League-1628"><a href="#League-1628"><span class="linenos">1628</span></a>                    <span class="p">[</span><span class="s2">&quot;week&quot;</span><span class="p">,</span> <span class="s2">&quot;team_2&quot;</span><span class="p">,</span> <span class="s2">&quot;score_2&quot;</span><span class="p">],</span>
</span><span id="League-1629"><a href="#League-1629"><span class="linenos">1629</span></a>                <span class="p">]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;team_2&quot;</span><span class="p">:</span> <span class="s2">&quot;team&quot;</span><span class="p">,</span> <span class="s2">&quot;score_2&quot;</span><span class="p">:</span> <span class="s2">&quot;score&quot;</span><span class="p">})],</span>
</span><span id="League-1630"><a href="#League-1630"><span class="linenos">1630</span></a>                <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="League-1631"><a href="#League-1631"><span class="linenos">1631</span></a>                <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="League-1632"><a href="#League-1632"><span class="linenos">1632</span></a>            <span class="p">)</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;week&quot;</span><span class="p">,</span> <span class="s2">&quot;team&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">score</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="League-1633"><a href="#League-1633"><span class="linenos">1633</span></a>            <span class="n">playoffs</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League-1634"><a href="#League-1634"><span class="linenos">1634</span></a>                <span class="n">standings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">standings</span><span class="o">.</span><span class="n">seed</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;num_playoff_teams&quot;</span><span class="p">]]</span>
</span><span id="League-1635"><a href="#League-1635"><span class="linenos">1635</span></a>                <span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="League-1636"><a href="#League-1636"><span class="linenos">1636</span></a>                <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="League-1637"><a href="#League-1637"><span class="linenos">1637</span></a>            <span class="p">)</span>
</span><span id="League-1638"><a href="#League-1638"><span class="linenos">1638</span></a>            <span class="k">if</span> <span class="n">algorithm</span><span class="p">:</span>
</span><span id="League-1639"><a href="#League-1639"><span class="linenos">1639</span></a>                <span class="n">many_mile</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League-1640"><a href="#League-1640"><span class="linenos">1640</span></a>                    <span class="n">standings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">standings</span><span class="o">.</span><span class="n">seed</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;num_playoff_teams&quot;</span><span class="p">]]</span>
</span><span id="League-1641"><a href="#League-1641"><span class="linenos">1641</span></a>                    <span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="League-1642"><a href="#League-1642"><span class="linenos">1642</span></a>                    <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="League-1643"><a href="#League-1643"><span class="linenos">1643</span></a>                <span class="p">)</span>
</span><span id="League-1644"><a href="#League-1644"><span class="linenos">1644</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;num_playoff_teams&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;6&quot;</span><span class="p">:</span>
</span><span id="League-1645"><a href="#League-1645"><span class="linenos">1645</span></a>                <span class="n">playoffs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League-1646"><a href="#League-1646"><span class="linenos">1646</span></a>                    <span class="n">left</span><span class="o">=</span><span class="n">playoffs</span><span class="p">,</span>
</span><span id="League-1647"><a href="#League-1647"><span class="linenos">1647</span></a>                    <span class="n">right</span><span class="o">=</span><span class="n">scores</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League-1648"><a href="#League-1648"><span class="linenos">1648</span></a>                        <span class="n">scores</span><span class="o">.</span><span class="n">week</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;playoff_start_week&quot;</span><span class="p">],</span>
</span><span id="League-1649"><a href="#League-1649"><span class="linenos">1649</span></a>                        <span class="p">[</span><span class="s2">&quot;team&quot;</span><span class="p">,</span> <span class="s2">&quot;score&quot;</span><span class="p">],</span>
</span><span id="League-1650"><a href="#League-1650"><span class="linenos">1650</span></a>                    <span class="p">],</span>
</span><span id="League-1651"><a href="#League-1651"><span class="linenos">1651</span></a>                    <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
</span><span id="League-1652"><a href="#League-1652"><span class="linenos">1652</span></a>                    <span class="n">on</span><span class="o">=</span><span class="s2">&quot;team&quot;</span><span class="p">,</span>
</span><span id="League-1653"><a href="#League-1653"><span class="linenos">1653</span></a>                <span class="p">)</span>
</span><span id="League-1654"><a href="#League-1654"><span class="linenos">1654</span></a>                <span class="n">playoffs</span><span class="o">.</span><span class="n">score</span> <span class="o">=</span> <span class="n">playoffs</span><span class="o">.</span><span class="n">score</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="League-1655"><a href="#League-1655"><span class="linenos">1655</span></a>                <span class="n">playoffs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League-1656"><a href="#League-1656"><span class="linenos">1656</span></a>                    <span class="n">left</span><span class="o">=</span><span class="n">playoffs</span><span class="p">,</span>
</span><span id="League-1657"><a href="#League-1657"><span class="linenos">1657</span></a>                    <span class="n">right</span><span class="o">=</span><span class="n">projections</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League-1658"><a href="#League-1658"><span class="linenos">1658</span></a>                        <span class="n">projections</span><span class="o">.</span><span class="n">week</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;playoff_start_week&quot;</span><span class="p">],</span>
</span><span id="League-1659"><a href="#League-1659"><span class="linenos">1659</span></a>                        <span class="p">[</span><span class="s2">&quot;fantasy_team&quot;</span><span class="p">,</span> <span class="s2">&quot;points_avg&quot;</span><span class="p">,</span> <span class="s2">&quot;points_stdev&quot;</span><span class="p">],</span>
</span><span id="League-1660"><a href="#League-1660"><span class="linenos">1660</span></a>                    <span class="p">]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;fantasy_team&quot;</span><span class="p">:</span> <span class="s2">&quot;team&quot;</span><span class="p">}),</span>
</span><span id="League-1661"><a href="#League-1661"><span class="linenos">1661</span></a>                    <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
</span><span id="League-1662"><a href="#League-1662"><span class="linenos">1662</span></a>                    <span class="n">on</span><span class="o">=</span><span class="s2">&quot;team&quot;</span><span class="p">,</span>
</span><span id="League-1663"><a href="#League-1663"><span class="linenos">1663</span></a>                <span class="p">)</span>
</span><span id="League-1664"><a href="#League-1664"><span class="linenos">1664</span></a>                <span class="n">playoffs</span><span class="o">.</span><span class="n">points_avg</span> <span class="o">=</span> <span class="n">playoffs</span><span class="o">.</span><span class="n">points_avg</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="League-1665"><a href="#League-1665"><span class="linenos">1665</span></a>                <span class="n">playoffs</span><span class="o">.</span><span class="n">points_stdev</span> <span class="o">=</span> <span class="n">playoffs</span><span class="o">.</span><span class="n">points_stdev</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="League-1666"><a href="#League-1666"><span class="linenos">1666</span></a>                <span class="n">playoffs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">playoffs</span><span class="o">.</span><span class="n">seed</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;matchup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="League-1667"><a href="#League-1667"><span class="linenos">1667</span></a>                <span class="n">playoffs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">playoffs</span><span class="o">.</span><span class="n">seed</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;matchup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="League-1668"><a href="#League-1668"><span class="linenos">1668</span></a>                <span class="n">playoffs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">playoffs</span><span class="o">.</span><span class="n">seed</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">]),</span> <span class="s2">&quot;matchup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="League-1669"><a href="#League-1669"><span class="linenos">1669</span></a>                <span class="n">playoffs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">playoffs</span><span class="o">.</span><span class="n">seed</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]),</span> <span class="s2">&quot;matchup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
</span><span id="League-1670"><a href="#League-1670"><span class="linenos">1670</span></a>                <span class="n">playoffs</span><span class="p">[</span><span class="s2">&quot;sim&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League-1671"><a href="#League-1671"><span class="linenos">1671</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">playoffs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="League-1672"><a href="#League-1672"><span class="linenos">1672</span></a>                    <span class="o">*</span> <span class="n">playoffs</span><span class="o">.</span><span class="n">points_stdev</span>
</span><span id="League-1673"><a href="#League-1673"><span class="linenos">1673</span></a>                    <span class="o">+</span> <span class="n">playoffs</span><span class="o">.</span><span class="n">points_avg</span>
</span><span id="League-1674"><a href="#League-1674"><span class="linenos">1674</span></a>                    <span class="o">+</span> <span class="n">playoffs</span><span class="o">.</span><span class="n">score</span>
</span><span id="League-1675"><a href="#League-1675"><span class="linenos">1675</span></a>                <span class="p">)</span>
</span><span id="League-1676"><a href="#League-1676"><span class="linenos">1676</span></a>                <span class="n">playoffs</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League-1677"><a href="#League-1677"><span class="linenos">1677</span></a>                    <span class="n">playoffs</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
</span><span id="League-1678"><a href="#League-1678"><span class="linenos">1678</span></a>                        <span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;num_sim&quot;</span><span class="p">,</span> <span class="s2">&quot;matchup&quot;</span><span class="p">,</span> <span class="s2">&quot;sim&quot;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]</span>
</span><span id="League-1679"><a href="#League-1679"><span class="linenos">1679</span></a>                    <span class="p">)</span>
</span><span id="League-1680"><a href="#League-1680"><span class="linenos">1680</span></a>                    <span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;num_sim&quot;</span><span class="p">,</span> <span class="s2">&quot;matchup&quot;</span><span class="p">],</span> <span class="n">keep</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)</span>
</span><span id="League-1681"><a href="#League-1681"><span class="linenos">1681</span></a>                    <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="League-1682"><a href="#League-1682"><span class="linenos">1682</span></a>                <span class="p">)</span>
</span><span id="League-1683"><a href="#League-1683"><span class="linenos">1683</span></a>                <span class="k">del</span> <span class="p">(</span>
</span><span id="League-1684"><a href="#League-1684"><span class="linenos">1684</span></a>                    <span class="n">playoffs</span><span class="p">[</span><span class="s2">&quot;matchup&quot;</span><span class="p">],</span>
</span><span id="League-1685"><a href="#League-1685"><span class="linenos">1685</span></a>                    <span class="n">playoffs</span><span class="p">[</span><span class="s2">&quot;sim&quot;</span><span class="p">],</span>
</span><span id="League-1686"><a href="#League-1686"><span class="linenos">1686</span></a>                    <span class="n">playoffs</span><span class="p">[</span><span class="s2">&quot;score&quot;</span><span class="p">],</span>
</span><span id="League-1687"><a href="#League-1687"><span class="linenos">1687</span></a>                    <span class="n">playoffs</span><span class="p">[</span><span class="s2">&quot;points_avg&quot;</span><span class="p">],</span>
</span><span id="League-1688"><a href="#League-1688"><span class="linenos">1688</span></a>                    <span class="n">playoffs</span><span class="p">[</span><span class="s2">&quot;points_stdev&quot;</span><span class="p">],</span>
</span><span id="League-1689"><a href="#League-1689"><span class="linenos">1689</span></a>                <span class="p">)</span>
</span><span id="League-1690"><a href="#League-1690"><span class="linenos">1690</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;uses_playoff_reseeding&quot;</span><span class="p">]:</span>
</span><span id="League-1691"><a href="#League-1691"><span class="linenos">1691</span></a>                    <span class="n">playoffs</span> <span class="o">=</span> <span class="n">playoffs</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
</span><span id="League-1692"><a href="#League-1692"><span class="linenos">1692</span></a>                        <span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;num_sim&quot;</span><span class="p">,</span> <span class="s2">&quot;seed&quot;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span>
</span><span id="League-1693"><a href="#League-1693"><span class="linenos">1693</span></a>                    <span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="League-1694"><a href="#League-1694"><span class="linenos">1694</span></a>                <span class="k">if</span> <span class="n">algorithm</span><span class="p">:</span>
</span><span id="League-1695"><a href="#League-1695"><span class="linenos">1695</span></a>                    <span class="n">many_mile</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League-1696"><a href="#League-1696"><span class="linenos">1696</span></a>                        <span class="n">left</span><span class="o">=</span><span class="n">many_mile</span><span class="p">,</span>
</span><span id="League-1697"><a href="#League-1697"><span class="linenos">1697</span></a>                        <span class="n">right</span><span class="o">=</span><span class="n">scores</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League-1698"><a href="#League-1698"><span class="linenos">1698</span></a>                            <span class="n">scores</span><span class="o">.</span><span class="n">week</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;playoff_start_week&quot;</span><span class="p">],</span>
</span><span id="League-1699"><a href="#League-1699"><span class="linenos">1699</span></a>                            <span class="p">[</span><span class="s2">&quot;team&quot;</span><span class="p">,</span> <span class="s2">&quot;score&quot;</span><span class="p">],</span>
</span><span id="League-1700"><a href="#League-1700"><span class="linenos">1700</span></a>                        <span class="p">],</span>
</span><span id="League-1701"><a href="#League-1701"><span class="linenos">1701</span></a>                        <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
</span><span id="League-1702"><a href="#League-1702"><span class="linenos">1702</span></a>                        <span class="n">on</span><span class="o">=</span><span class="s2">&quot;team&quot;</span><span class="p">,</span>
</span><span id="League-1703"><a href="#League-1703"><span class="linenos">1703</span></a>                    <span class="p">)</span>
</span><span id="League-1704"><a href="#League-1704"><span class="linenos">1704</span></a>                    <span class="n">many_mile</span><span class="o">.</span><span class="n">score</span> <span class="o">=</span> <span class="n">many_mile</span><span class="o">.</span><span class="n">score</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="League-1705"><a href="#League-1705"><span class="linenos">1705</span></a>                    <span class="n">many_mile</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League-1706"><a href="#League-1706"><span class="linenos">1706</span></a>                        <span class="n">left</span><span class="o">=</span><span class="n">many_mile</span><span class="p">,</span>
</span><span id="League-1707"><a href="#League-1707"><span class="linenos">1707</span></a>                        <span class="n">right</span><span class="o">=</span><span class="n">projections</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League-1708"><a href="#League-1708"><span class="linenos">1708</span></a>                            <span class="n">projections</span><span class="o">.</span><span class="n">week</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;playoff_start_week&quot;</span><span class="p">],</span>
</span><span id="League-1709"><a href="#League-1709"><span class="linenos">1709</span></a>                            <span class="p">[</span><span class="s2">&quot;fantasy_team&quot;</span><span class="p">,</span> <span class="s2">&quot;points_avg&quot;</span><span class="p">,</span> <span class="s2">&quot;points_stdev&quot;</span><span class="p">],</span>
</span><span id="League-1710"><a href="#League-1710"><span class="linenos">1710</span></a>                        <span class="p">]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;fantasy_team&quot;</span><span class="p">:</span> <span class="s2">&quot;team&quot;</span><span class="p">}),</span>
</span><span id="League-1711"><a href="#League-1711"><span class="linenos">1711</span></a>                        <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
</span><span id="League-1712"><a href="#League-1712"><span class="linenos">1712</span></a>                        <span class="n">on</span><span class="o">=</span><span class="s2">&quot;team&quot;</span><span class="p">,</span>
</span><span id="League-1713"><a href="#League-1713"><span class="linenos">1713</span></a>                    <span class="p">)</span>
</span><span id="League-1714"><a href="#League-1714"><span class="linenos">1714</span></a>                    <span class="n">many_mile</span><span class="o">.</span><span class="n">points_avg</span> <span class="o">=</span> <span class="n">many_mile</span><span class="o">.</span><span class="n">points_avg</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="League-1715"><a href="#League-1715"><span class="linenos">1715</span></a>                    <span class="n">many_mile</span><span class="o">.</span><span class="n">points_stdev</span> <span class="o">=</span> <span class="n">many_mile</span><span class="o">.</span><span class="n">points_stdev</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="League-1716"><a href="#League-1716"><span class="linenos">1716</span></a>                    <span class="n">many_mile</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">many_mile</span><span class="o">.</span><span class="n">seed</span> <span class="o">==</span> <span class="mi">11</span><span class="p">,</span> <span class="s2">&quot;matchup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="League-1717"><a href="#League-1717"><span class="linenos">1717</span></a>                    <span class="n">many_mile</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">many_mile</span><span class="o">.</span><span class="n">seed</span> <span class="o">==</span> <span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;matchup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="League-1718"><a href="#League-1718"><span class="linenos">1718</span></a>                    <span class="n">many_mile</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">many_mile</span><span class="o">.</span><span class="n">seed</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">6</span><span class="p">,</span> <span class="mi">9</span><span class="p">]),</span> <span class="s2">&quot;matchup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="League-1719"><a href="#League-1719"><span class="linenos">1719</span></a>                    <span class="n">many_mile</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">many_mile</span><span class="o">.</span><span class="n">seed</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">]),</span> <span class="s2">&quot;matchup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
</span><span id="League-1720"><a href="#League-1720"><span class="linenos">1720</span></a>                    <span class="n">many_mile</span><span class="p">[</span><span class="s2">&quot;sim&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League-1721"><a href="#League-1721"><span class="linenos">1721</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">many_mile</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="League-1722"><a href="#League-1722"><span class="linenos">1722</span></a>                        <span class="o">*</span> <span class="n">many_mile</span><span class="o">.</span><span class="n">points_stdev</span>
</span><span id="League-1723"><a href="#League-1723"><span class="linenos">1723</span></a>                        <span class="o">+</span> <span class="n">many_mile</span><span class="o">.</span><span class="n">points_avg</span>
</span><span id="League-1724"><a href="#League-1724"><span class="linenos">1724</span></a>                        <span class="o">+</span> <span class="n">many_mile</span><span class="o">.</span><span class="n">score</span>
</span><span id="League-1725"><a href="#League-1725"><span class="linenos">1725</span></a>                    <span class="p">)</span>
</span><span id="League-1726"><a href="#League-1726"><span class="linenos">1726</span></a>                    <span class="n">many_mile</span> <span class="o">=</span> <span class="n">many_mile</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
</span><span id="League-1727"><a href="#League-1727"><span class="linenos">1727</span></a>                        <span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;num_sim&quot;</span><span class="p">,</span> <span class="s2">&quot;matchup&quot;</span><span class="p">,</span> <span class="s2">&quot;sim&quot;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span>
</span><span id="League-1728"><a href="#League-1728"><span class="linenos">1728</span></a>                    <span class="p">)</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;num_sim&quot;</span><span class="p">,</span> <span class="s2">&quot;matchup&quot;</span><span class="p">],</span> <span class="n">keep</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)</span>
</span><span id="League-1729"><a href="#League-1729"><span class="linenos">1729</span></a>                    <span class="k">del</span> <span class="p">(</span>
</span><span id="League-1730"><a href="#League-1730"><span class="linenos">1730</span></a>                        <span class="n">many_mile</span><span class="p">[</span><span class="s2">&quot;matchup&quot;</span><span class="p">],</span>
</span><span id="League-1731"><a href="#League-1731"><span class="linenos">1731</span></a>                        <span class="n">many_mile</span><span class="p">[</span><span class="s2">&quot;sim&quot;</span><span class="p">],</span>
</span><span id="League-1732"><a href="#League-1732"><span class="linenos">1732</span></a>                        <span class="n">many_mile</span><span class="p">[</span><span class="s2">&quot;score&quot;</span><span class="p">],</span>
</span><span id="League-1733"><a href="#League-1733"><span class="linenos">1733</span></a>                        <span class="n">many_mile</span><span class="p">[</span><span class="s2">&quot;points_avg&quot;</span><span class="p">],</span>
</span><span id="League-1734"><a href="#League-1734"><span class="linenos">1734</span></a>                        <span class="n">many_mile</span><span class="p">[</span><span class="s2">&quot;points_stdev&quot;</span><span class="p">],</span>
</span><span id="League-1735"><a href="#League-1735"><span class="linenos">1735</span></a>                    <span class="p">)</span>
</span><span id="League-1736"><a href="#League-1736"><span class="linenos">1736</span></a>            <span class="n">playoffs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League-1737"><a href="#League-1737"><span class="linenos">1737</span></a>                <span class="n">left</span><span class="o">=</span><span class="n">playoffs</span><span class="p">,</span>
</span><span id="League-1738"><a href="#League-1738"><span class="linenos">1738</span></a>                <span class="n">right</span><span class="o">=</span><span class="n">scores</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League-1739"><a href="#League-1739"><span class="linenos">1739</span></a>                    <span class="n">scores</span><span class="o">.</span><span class="n">week</span>
</span><span id="League-1740"><a href="#League-1740"><span class="linenos">1740</span></a>                    <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;playoff_start_week&quot;</span><span class="p">]</span>
</span><span id="League-1741"><a href="#League-1741"><span class="linenos">1741</span></a>                    <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;num_playoff_teams&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">6</span><span class="p">),</span>
</span><span id="League-1742"><a href="#League-1742"><span class="linenos">1742</span></a>                    <span class="p">[</span><span class="s2">&quot;team&quot;</span><span class="p">,</span> <span class="s2">&quot;score&quot;</span><span class="p">],</span>
</span><span id="League-1743"><a href="#League-1743"><span class="linenos">1743</span></a>                <span class="p">],</span>
</span><span id="League-1744"><a href="#League-1744"><span class="linenos">1744</span></a>                <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
</span><span id="League-1745"><a href="#League-1745"><span class="linenos">1745</span></a>                <span class="n">on</span><span class="o">=</span><span class="s2">&quot;team&quot;</span><span class="p">,</span>
</span><span id="League-1746"><a href="#League-1746"><span class="linenos">1746</span></a>            <span class="p">)</span>
</span><span id="League-1747"><a href="#League-1747"><span class="linenos">1747</span></a>            <span class="n">playoffs</span><span class="o">.</span><span class="n">score</span> <span class="o">=</span> <span class="n">playoffs</span><span class="o">.</span><span class="n">score</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="League-1748"><a href="#League-1748"><span class="linenos">1748</span></a>            <span class="n">playoffs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League-1749"><a href="#League-1749"><span class="linenos">1749</span></a>                <span class="n">left</span><span class="o">=</span><span class="n">playoffs</span><span class="p">,</span>
</span><span id="League-1750"><a href="#League-1750"><span class="linenos">1750</span></a>                <span class="n">right</span><span class="o">=</span><span class="n">projections</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League-1751"><a href="#League-1751"><span class="linenos">1751</span></a>                    <span class="n">projections</span><span class="o">.</span><span class="n">week</span>
</span><span id="League-1752"><a href="#League-1752"><span class="linenos">1752</span></a>                    <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;playoff_start_week&quot;</span><span class="p">]</span>
</span><span id="League-1753"><a href="#League-1753"><span class="linenos">1753</span></a>                    <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;num_playoff_teams&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">6</span><span class="p">),</span>
</span><span id="League-1754"><a href="#League-1754"><span class="linenos">1754</span></a>                    <span class="p">[</span><span class="s2">&quot;fantasy_team&quot;</span><span class="p">,</span> <span class="s2">&quot;points_avg&quot;</span><span class="p">,</span> <span class="s2">&quot;points_stdev&quot;</span><span class="p">],</span>
</span><span id="League-1755"><a href="#League-1755"><span class="linenos">1755</span></a>                <span class="p">]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;fantasy_team&quot;</span><span class="p">:</span> <span class="s2">&quot;team&quot;</span><span class="p">}),</span>
</span><span id="League-1756"><a href="#League-1756"><span class="linenos">1756</span></a>                <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
</span><span id="League-1757"><a href="#League-1757"><span class="linenos">1757</span></a>                <span class="n">on</span><span class="o">=</span><span class="s2">&quot;team&quot;</span><span class="p">,</span>
</span><span id="League-1758"><a href="#League-1758"><span class="linenos">1758</span></a>            <span class="p">)</span>
</span><span id="League-1759"><a href="#League-1759"><span class="linenos">1759</span></a>            <span class="n">playoffs</span><span class="o">.</span><span class="n">points_avg</span> <span class="o">=</span> <span class="n">playoffs</span><span class="o">.</span><span class="n">points_avg</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="League-1760"><a href="#League-1760"><span class="linenos">1760</span></a>            <span class="n">playoffs</span><span class="o">.</span><span class="n">points_stdev</span> <span class="o">=</span> <span class="n">playoffs</span><span class="o">.</span><span class="n">points_stdev</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="League-1761"><a href="#League-1761"><span class="linenos">1761</span></a>            <span class="n">playoffs</span><span class="p">[</span><span class="s2">&quot;seed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">playoffs</span><span class="o">.</span><span class="n">index</span> <span class="o">%</span> <span class="mi">4</span>
</span><span id="League-1762"><a href="#League-1762"><span class="linenos">1762</span></a>            <span class="n">playoffs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">playoffs</span><span class="o">.</span><span class="n">seed</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">]),</span> <span class="s2">&quot;matchup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="League-1763"><a href="#League-1763"><span class="linenos">1763</span></a>            <span class="n">playoffs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">playoffs</span><span class="o">.</span><span class="n">seed</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]),</span> <span class="s2">&quot;matchup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="League-1764"><a href="#League-1764"><span class="linenos">1764</span></a>            <span class="n">playoffs</span><span class="p">[</span><span class="s2">&quot;sim&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League-1765"><a href="#League-1765"><span class="linenos">1765</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">playoffs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="League-1766"><a href="#League-1766"><span class="linenos">1766</span></a>                <span class="o">*</span> <span class="n">playoffs</span><span class="o">.</span><span class="n">points_stdev</span>
</span><span id="League-1767"><a href="#League-1767"><span class="linenos">1767</span></a>                <span class="o">+</span> <span class="n">playoffs</span><span class="o">.</span><span class="n">points_avg</span>
</span><span id="League-1768"><a href="#League-1768"><span class="linenos">1768</span></a>                <span class="o">+</span> <span class="n">playoffs</span><span class="o">.</span><span class="n">score</span>
</span><span id="League-1769"><a href="#League-1769"><span class="linenos">1769</span></a>            <span class="p">)</span>
</span><span id="League-1770"><a href="#League-1770"><span class="linenos">1770</span></a>            <span class="n">consolation</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League-1771"><a href="#League-1771"><span class="linenos">1771</span></a>                <span class="n">playoffs</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;num_sim&quot;</span><span class="p">,</span> <span class="s2">&quot;matchup&quot;</span><span class="p">,</span> <span class="s2">&quot;sim&quot;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="League-1772"><a href="#League-1772"><span class="linenos">1772</span></a>                <span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;num_sim&quot;</span><span class="p">,</span> <span class="s2">&quot;matchup&quot;</span><span class="p">],</span> <span class="n">keep</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)</span>
</span><span id="League-1773"><a href="#League-1773"><span class="linenos">1773</span></a>                <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="League-1774"><a href="#League-1774"><span class="linenos">1774</span></a>            <span class="p">)</span>
</span><span id="League-1775"><a href="#League-1775"><span class="linenos">1775</span></a>            <span class="n">playoffs</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League-1776"><a href="#League-1776"><span class="linenos">1776</span></a>                <span class="n">playoffs</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
</span><span id="League-1777"><a href="#League-1777"><span class="linenos">1777</span></a>                    <span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;num_sim&quot;</span><span class="p">,</span> <span class="s2">&quot;matchup&quot;</span><span class="p">,</span> <span class="s2">&quot;sim&quot;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]</span>
</span><span id="League-1778"><a href="#League-1778"><span class="linenos">1778</span></a>                <span class="p">)</span>
</span><span id="League-1779"><a href="#League-1779"><span class="linenos">1779</span></a>                <span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;num_sim&quot;</span><span class="p">,</span> <span class="s2">&quot;matchup&quot;</span><span class="p">],</span> <span class="n">keep</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)</span>
</span><span id="League-1780"><a href="#League-1780"><span class="linenos">1780</span></a>                <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="League-1781"><a href="#League-1781"><span class="linenos">1781</span></a>            <span class="p">)</span>
</span><span id="League-1782"><a href="#League-1782"><span class="linenos">1782</span></a>            <span class="k">del</span> <span class="p">(</span>
</span><span id="League-1783"><a href="#League-1783"><span class="linenos">1783</span></a>                <span class="n">playoffs</span><span class="p">[</span><span class="s2">&quot;matchup&quot;</span><span class="p">],</span>
</span><span id="League-1784"><a href="#League-1784"><span class="linenos">1784</span></a>                <span class="n">playoffs</span><span class="p">[</span><span class="s2">&quot;sim&quot;</span><span class="p">],</span>
</span><span id="League-1785"><a href="#League-1785"><span class="linenos">1785</span></a>                <span class="n">playoffs</span><span class="p">[</span><span class="s2">&quot;score&quot;</span><span class="p">],</span>
</span><span id="League-1786"><a href="#League-1786"><span class="linenos">1786</span></a>                <span class="n">playoffs</span><span class="p">[</span><span class="s2">&quot;points_avg&quot;</span><span class="p">],</span>
</span><span id="League-1787"><a href="#League-1787"><span class="linenos">1787</span></a>                <span class="n">playoffs</span><span class="p">[</span><span class="s2">&quot;points_stdev&quot;</span><span class="p">],</span>
</span><span id="League-1788"><a href="#League-1788"><span class="linenos">1788</span></a>                <span class="n">consolation</span><span class="p">[</span><span class="s2">&quot;matchup&quot;</span><span class="p">],</span>
</span><span id="League-1789"><a href="#League-1789"><span class="linenos">1789</span></a>                <span class="n">consolation</span><span class="p">[</span><span class="s2">&quot;sim&quot;</span><span class="p">],</span>
</span><span id="League-1790"><a href="#League-1790"><span class="linenos">1790</span></a>                <span class="n">consolation</span><span class="p">[</span><span class="s2">&quot;score&quot;</span><span class="p">],</span>
</span><span id="League-1791"><a href="#League-1791"><span class="linenos">1791</span></a>                <span class="n">consolation</span><span class="p">[</span><span class="s2">&quot;points_avg&quot;</span><span class="p">],</span>
</span><span id="League-1792"><a href="#League-1792"><span class="linenos">1792</span></a>                <span class="n">consolation</span><span class="p">[</span><span class="s2">&quot;points_stdev&quot;</span><span class="p">],</span>
</span><span id="League-1793"><a href="#League-1793"><span class="linenos">1793</span></a>            <span class="p">)</span>
</span><span id="League-1794"><a href="#League-1794"><span class="linenos">1794</span></a>            <span class="k">if</span> <span class="n">algorithm</span><span class="p">:</span>
</span><span id="League-1795"><a href="#League-1795"><span class="linenos">1795</span></a>                <span class="n">many_mile</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League-1796"><a href="#League-1796"><span class="linenos">1796</span></a>                    <span class="n">left</span><span class="o">=</span><span class="n">many_mile</span><span class="p">,</span>
</span><span id="League-1797"><a href="#League-1797"><span class="linenos">1797</span></a>                    <span class="n">right</span><span class="o">=</span><span class="n">scores</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League-1798"><a href="#League-1798"><span class="linenos">1798</span></a>                        <span class="n">scores</span><span class="o">.</span><span class="n">week</span>
</span><span id="League-1799"><a href="#League-1799"><span class="linenos">1799</span></a>                        <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;playoff_start_week&quot;</span><span class="p">]</span>
</span><span id="League-1800"><a href="#League-1800"><span class="linenos">1800</span></a>                        <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;num_playoff_teams&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">6</span><span class="p">),</span>
</span><span id="League-1801"><a href="#League-1801"><span class="linenos">1801</span></a>                        <span class="p">[</span><span class="s2">&quot;team&quot;</span><span class="p">,</span> <span class="s2">&quot;score&quot;</span><span class="p">],</span>
</span><span id="League-1802"><a href="#League-1802"><span class="linenos">1802</span></a>                    <span class="p">],</span>
</span><span id="League-1803"><a href="#League-1803"><span class="linenos">1803</span></a>                    <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
</span><span id="League-1804"><a href="#League-1804"><span class="linenos">1804</span></a>                    <span class="n">on</span><span class="o">=</span><span class="s2">&quot;team&quot;</span><span class="p">,</span>
</span><span id="League-1805"><a href="#League-1805"><span class="linenos">1805</span></a>                <span class="p">)</span>
</span><span id="League-1806"><a href="#League-1806"><span class="linenos">1806</span></a>                <span class="n">many_mile</span><span class="o">.</span><span class="n">score</span> <span class="o">=</span> <span class="n">many_mile</span><span class="o">.</span><span class="n">score</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="League-1807"><a href="#League-1807"><span class="linenos">1807</span></a>                <span class="n">many_mile</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League-1808"><a href="#League-1808"><span class="linenos">1808</span></a>                    <span class="n">left</span><span class="o">=</span><span class="n">many_mile</span><span class="p">,</span>
</span><span id="League-1809"><a href="#League-1809"><span class="linenos">1809</span></a>                    <span class="n">right</span><span class="o">=</span><span class="n">projections</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League-1810"><a href="#League-1810"><span class="linenos">1810</span></a>                        <span class="n">projections</span><span class="o">.</span><span class="n">week</span>
</span><span id="League-1811"><a href="#League-1811"><span class="linenos">1811</span></a>                        <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;playoff_start_week&quot;</span><span class="p">]</span>
</span><span id="League-1812"><a href="#League-1812"><span class="linenos">1812</span></a>                        <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;num_playoff_teams&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">6</span><span class="p">),</span>
</span><span id="League-1813"><a href="#League-1813"><span class="linenos">1813</span></a>                        <span class="p">[</span><span class="s2">&quot;fantasy_team&quot;</span><span class="p">,</span> <span class="s2">&quot;points_avg&quot;</span><span class="p">,</span> <span class="s2">&quot;points_stdev&quot;</span><span class="p">],</span>
</span><span id="League-1814"><a href="#League-1814"><span class="linenos">1814</span></a>                    <span class="p">]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;fantasy_team&quot;</span><span class="p">:</span> <span class="s2">&quot;team&quot;</span><span class="p">}),</span>
</span><span id="League-1815"><a href="#League-1815"><span class="linenos">1815</span></a>                    <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
</span><span id="League-1816"><a href="#League-1816"><span class="linenos">1816</span></a>                    <span class="n">on</span><span class="o">=</span><span class="s2">&quot;team&quot;</span><span class="p">,</span>
</span><span id="League-1817"><a href="#League-1817"><span class="linenos">1817</span></a>                <span class="p">)</span>
</span><span id="League-1818"><a href="#League-1818"><span class="linenos">1818</span></a>                <span class="n">many_mile</span><span class="o">.</span><span class="n">points_avg</span> <span class="o">=</span> <span class="n">many_mile</span><span class="o">.</span><span class="n">points_avg</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="League-1819"><a href="#League-1819"><span class="linenos">1819</span></a>                <span class="n">many_mile</span><span class="o">.</span><span class="n">points_stdev</span> <span class="o">=</span> <span class="n">many_mile</span><span class="o">.</span><span class="n">points_stdev</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="League-1820"><a href="#League-1820"><span class="linenos">1820</span></a>                <span class="n">many_mile</span><span class="p">[</span><span class="s2">&quot;seed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">many_mile</span><span class="o">.</span><span class="n">index</span> <span class="o">%</span> <span class="mi">4</span>
</span><span id="League-1821"><a href="#League-1821"><span class="linenos">1821</span></a>                <span class="n">many_mile</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">many_mile</span><span class="o">.</span><span class="n">seed</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">]),</span> <span class="s2">&quot;matchup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="League-1822"><a href="#League-1822"><span class="linenos">1822</span></a>                <span class="n">many_mile</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">many_mile</span><span class="o">.</span><span class="n">seed</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]),</span> <span class="s2">&quot;matchup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="League-1823"><a href="#League-1823"><span class="linenos">1823</span></a>                <span class="n">many_mile</span><span class="p">[</span><span class="s2">&quot;sim&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League-1824"><a href="#League-1824"><span class="linenos">1824</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">many_mile</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="League-1825"><a href="#League-1825"><span class="linenos">1825</span></a>                    <span class="o">*</span> <span class="n">many_mile</span><span class="o">.</span><span class="n">points_stdev</span>
</span><span id="League-1826"><a href="#League-1826"><span class="linenos">1826</span></a>                    <span class="o">+</span> <span class="n">many_mile</span><span class="o">.</span><span class="n">points_avg</span>
</span><span id="League-1827"><a href="#League-1827"><span class="linenos">1827</span></a>                    <span class="o">+</span> <span class="n">many_mile</span><span class="o">.</span><span class="n">score</span>
</span><span id="League-1828"><a href="#League-1828"><span class="linenos">1828</span></a>                <span class="p">)</span>
</span><span id="League-1829"><a href="#League-1829"><span class="linenos">1829</span></a>                <span class="n">many_mile</span> <span class="o">=</span> <span class="n">many_mile</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
</span><span id="League-1830"><a href="#League-1830"><span class="linenos">1830</span></a>                    <span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;num_sim&quot;</span><span class="p">,</span> <span class="s2">&quot;matchup&quot;</span><span class="p">,</span> <span class="s2">&quot;sim&quot;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span>
</span><span id="League-1831"><a href="#League-1831"><span class="linenos">1831</span></a>                <span class="p">)</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;num_sim&quot;</span><span class="p">,</span> <span class="s2">&quot;matchup&quot;</span><span class="p">],</span> <span class="n">keep</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)</span>
</span><span id="League-1832"><a href="#League-1832"><span class="linenos">1832</span></a>                <span class="k">del</span> <span class="p">(</span>
</span><span id="League-1833"><a href="#League-1833"><span class="linenos">1833</span></a>                    <span class="n">many_mile</span><span class="p">[</span><span class="s2">&quot;matchup&quot;</span><span class="p">],</span>
</span><span id="League-1834"><a href="#League-1834"><span class="linenos">1834</span></a>                    <span class="n">many_mile</span><span class="p">[</span><span class="s2">&quot;sim&quot;</span><span class="p">],</span>
</span><span id="League-1835"><a href="#League-1835"><span class="linenos">1835</span></a>                    <span class="n">many_mile</span><span class="p">[</span><span class="s2">&quot;score&quot;</span><span class="p">],</span>
</span><span id="League-1836"><a href="#League-1836"><span class="linenos">1836</span></a>                    <span class="n">many_mile</span><span class="p">[</span><span class="s2">&quot;points_avg&quot;</span><span class="p">],</span>
</span><span id="League-1837"><a href="#League-1837"><span class="linenos">1837</span></a>                    <span class="n">many_mile</span><span class="p">[</span><span class="s2">&quot;points_stdev&quot;</span><span class="p">],</span>
</span><span id="League-1838"><a href="#League-1838"><span class="linenos">1838</span></a>                <span class="p">)</span>
</span><span id="League-1839"><a href="#League-1839"><span class="linenos">1839</span></a>            <span class="n">playoffs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League-1840"><a href="#League-1840"><span class="linenos">1840</span></a>                <span class="n">left</span><span class="o">=</span><span class="n">playoffs</span><span class="p">,</span>
</span><span id="League-1841"><a href="#League-1841"><span class="linenos">1841</span></a>                <span class="n">right</span><span class="o">=</span><span class="n">scores</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League-1842"><a href="#League-1842"><span class="linenos">1842</span></a>                    <span class="n">scores</span><span class="o">.</span><span class="n">week</span>
</span><span id="League-1843"><a href="#League-1843"><span class="linenos">1843</span></a>                    <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;playoff_start_week&quot;</span><span class="p">]</span>
</span><span id="League-1844"><a href="#League-1844"><span class="linenos">1844</span></a>                    <span class="o">+</span> <span class="mi">1</span>
</span><span id="League-1845"><a href="#League-1845"><span class="linenos">1845</span></a>                    <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;num_playoff_teams&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">6</span><span class="p">),</span>
</span><span id="League-1846"><a href="#League-1846"><span class="linenos">1846</span></a>                    <span class="p">[</span><span class="s2">&quot;team&quot;</span><span class="p">,</span> <span class="s2">&quot;score&quot;</span><span class="p">],</span>
</span><span id="League-1847"><a href="#League-1847"><span class="linenos">1847</span></a>                <span class="p">],</span>
</span><span id="League-1848"><a href="#League-1848"><span class="linenos">1848</span></a>                <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
</span><span id="League-1849"><a href="#League-1849"><span class="linenos">1849</span></a>                <span class="n">on</span><span class="o">=</span><span class="s2">&quot;team&quot;</span><span class="p">,</span>
</span><span id="League-1850"><a href="#League-1850"><span class="linenos">1850</span></a>            <span class="p">)</span>
</span><span id="League-1851"><a href="#League-1851"><span class="linenos">1851</span></a>            <span class="n">playoffs</span><span class="o">.</span><span class="n">score</span> <span class="o">=</span> <span class="n">playoffs</span><span class="o">.</span><span class="n">score</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="League-1852"><a href="#League-1852"><span class="linenos">1852</span></a>            <span class="n">playoffs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League-1853"><a href="#League-1853"><span class="linenos">1853</span></a>                <span class="n">left</span><span class="o">=</span><span class="n">playoffs</span><span class="p">,</span>
</span><span id="League-1854"><a href="#League-1854"><span class="linenos">1854</span></a>                <span class="n">right</span><span class="o">=</span><span class="n">projections</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League-1855"><a href="#League-1855"><span class="linenos">1855</span></a>                    <span class="n">projections</span><span class="o">.</span><span class="n">week</span>
</span><span id="League-1856"><a href="#League-1856"><span class="linenos">1856</span></a>                    <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;playoff_start_week&quot;</span><span class="p">]</span>
</span><span id="League-1857"><a href="#League-1857"><span class="linenos">1857</span></a>                    <span class="o">+</span> <span class="mi">1</span>
</span><span id="League-1858"><a href="#League-1858"><span class="linenos">1858</span></a>                    <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;num_playoff_teams&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">6</span><span class="p">),</span>
</span><span id="League-1859"><a href="#League-1859"><span class="linenos">1859</span></a>                    <span class="p">[</span><span class="s2">&quot;fantasy_team&quot;</span><span class="p">,</span> <span class="s2">&quot;points_avg&quot;</span><span class="p">,</span> <span class="s2">&quot;points_stdev&quot;</span><span class="p">],</span>
</span><span id="League-1860"><a href="#League-1860"><span class="linenos">1860</span></a>                <span class="p">]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;fantasy_team&quot;</span><span class="p">:</span> <span class="s2">&quot;team&quot;</span><span class="p">}),</span>
</span><span id="League-1861"><a href="#League-1861"><span class="linenos">1861</span></a>                <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
</span><span id="League-1862"><a href="#League-1862"><span class="linenos">1862</span></a>                <span class="n">on</span><span class="o">=</span><span class="s2">&quot;team&quot;</span><span class="p">,</span>
</span><span id="League-1863"><a href="#League-1863"><span class="linenos">1863</span></a>            <span class="p">)</span>
</span><span id="League-1864"><a href="#League-1864"><span class="linenos">1864</span></a>            <span class="n">playoffs</span><span class="o">.</span><span class="n">points_avg</span> <span class="o">=</span> <span class="n">playoffs</span><span class="o">.</span><span class="n">points_avg</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="League-1865"><a href="#League-1865"><span class="linenos">1865</span></a>            <span class="n">playoffs</span><span class="o">.</span><span class="n">points_stdev</span> <span class="o">=</span> <span class="n">playoffs</span><span class="o">.</span><span class="n">points_stdev</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="League-1866"><a href="#League-1866"><span class="linenos">1866</span></a>            <span class="n">playoffs</span><span class="p">[</span><span class="s2">&quot;sim&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League-1867"><a href="#League-1867"><span class="linenos">1867</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">playoffs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="League-1868"><a href="#League-1868"><span class="linenos">1868</span></a>                <span class="o">*</span> <span class="n">playoffs</span><span class="o">.</span><span class="n">points_stdev</span>
</span><span id="League-1869"><a href="#League-1869"><span class="linenos">1869</span></a>                <span class="o">+</span> <span class="n">playoffs</span><span class="o">.</span><span class="n">points_avg</span>
</span><span id="League-1870"><a href="#League-1870"><span class="linenos">1870</span></a>                <span class="o">+</span> <span class="n">playoffs</span><span class="o">.</span><span class="n">score</span>
</span><span id="League-1871"><a href="#League-1871"><span class="linenos">1871</span></a>            <span class="p">)</span>
</span><span id="League-1872"><a href="#League-1872"><span class="linenos">1872</span></a>            <span class="n">runner_up</span> <span class="o">=</span> <span class="n">playoffs</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
</span><span id="League-1873"><a href="#League-1873"><span class="linenos">1873</span></a>                <span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;num_sim&quot;</span><span class="p">,</span> <span class="s2">&quot;sim&quot;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span>
</span><span id="League-1874"><a href="#League-1874"><span class="linenos">1874</span></a>            <span class="p">)</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;num_sim&quot;</span><span class="p">],</span> <span class="n">keep</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)</span>
</span><span id="League-1875"><a href="#League-1875"><span class="linenos">1875</span></a>            <span class="n">winner</span> <span class="o">=</span> <span class="n">playoffs</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
</span><span id="League-1876"><a href="#League-1876"><span class="linenos">1876</span></a>                <span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;num_sim&quot;</span><span class="p">,</span> <span class="s2">&quot;sim&quot;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]</span>
</span><span id="League-1877"><a href="#League-1877"><span class="linenos">1877</span></a>            <span class="p">)</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;num_sim&quot;</span><span class="p">],</span> <span class="n">keep</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)</span>
</span><span id="League-1878"><a href="#League-1878"><span class="linenos">1878</span></a>            <span class="n">consolation</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League-1879"><a href="#League-1879"><span class="linenos">1879</span></a>                <span class="n">left</span><span class="o">=</span><span class="n">consolation</span><span class="p">,</span>
</span><span id="League-1880"><a href="#League-1880"><span class="linenos">1880</span></a>                <span class="n">right</span><span class="o">=</span><span class="n">scores</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League-1881"><a href="#League-1881"><span class="linenos">1881</span></a>                    <span class="n">scores</span><span class="o">.</span><span class="n">week</span>
</span><span id="League-1882"><a href="#League-1882"><span class="linenos">1882</span></a>                    <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;playoff_start_week&quot;</span><span class="p">]</span>
</span><span id="League-1883"><a href="#League-1883"><span class="linenos">1883</span></a>                    <span class="o">+</span> <span class="mi">1</span>
</span><span id="League-1884"><a href="#League-1884"><span class="linenos">1884</span></a>                    <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;num_playoff_teams&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">6</span><span class="p">),</span>
</span><span id="League-1885"><a href="#League-1885"><span class="linenos">1885</span></a>                    <span class="p">[</span><span class="s2">&quot;team&quot;</span><span class="p">,</span> <span class="s2">&quot;score&quot;</span><span class="p">],</span>
</span><span id="League-1886"><a href="#League-1886"><span class="linenos">1886</span></a>                <span class="p">],</span>
</span><span id="League-1887"><a href="#League-1887"><span class="linenos">1887</span></a>                <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
</span><span id="League-1888"><a href="#League-1888"><span class="linenos">1888</span></a>                <span class="n">on</span><span class="o">=</span><span class="s2">&quot;team&quot;</span><span class="p">,</span>
</span><span id="League-1889"><a href="#League-1889"><span class="linenos">1889</span></a>            <span class="p">)</span>
</span><span id="League-1890"><a href="#League-1890"><span class="linenos">1890</span></a>            <span class="n">consolation</span><span class="o">.</span><span class="n">score</span> <span class="o">=</span> <span class="n">consolation</span><span class="o">.</span><span class="n">score</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="League-1891"><a href="#League-1891"><span class="linenos">1891</span></a>            <span class="n">consolation</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League-1892"><a href="#League-1892"><span class="linenos">1892</span></a>                <span class="n">left</span><span class="o">=</span><span class="n">consolation</span><span class="p">,</span>
</span><span id="League-1893"><a href="#League-1893"><span class="linenos">1893</span></a>                <span class="n">right</span><span class="o">=</span><span class="n">projections</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League-1894"><a href="#League-1894"><span class="linenos">1894</span></a>                    <span class="n">projections</span><span class="o">.</span><span class="n">week</span>
</span><span id="League-1895"><a href="#League-1895"><span class="linenos">1895</span></a>                    <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;playoff_start_week&quot;</span><span class="p">]</span>
</span><span id="League-1896"><a href="#League-1896"><span class="linenos">1896</span></a>                    <span class="o">+</span> <span class="mi">1</span>
</span><span id="League-1897"><a href="#League-1897"><span class="linenos">1897</span></a>                    <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;num_playoff_teams&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">6</span><span class="p">),</span>
</span><span id="League-1898"><a href="#League-1898"><span class="linenos">1898</span></a>                    <span class="p">[</span><span class="s2">&quot;fantasy_team&quot;</span><span class="p">,</span> <span class="s2">&quot;points_avg&quot;</span><span class="p">,</span> <span class="s2">&quot;points_stdev&quot;</span><span class="p">],</span>
</span><span id="League-1899"><a href="#League-1899"><span class="linenos">1899</span></a>                <span class="p">]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;fantasy_team&quot;</span><span class="p">:</span> <span class="s2">&quot;team&quot;</span><span class="p">}),</span>
</span><span id="League-1900"><a href="#League-1900"><span class="linenos">1900</span></a>                <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">,</span>
</span><span id="League-1901"><a href="#League-1901"><span class="linenos">1901</span></a>                <span class="n">on</span><span class="o">=</span><span class="s2">&quot;team&quot;</span><span class="p">,</span>
</span><span id="League-1902"><a href="#League-1902"><span class="linenos">1902</span></a>            <span class="p">)</span>
</span><span id="League-1903"><a href="#League-1903"><span class="linenos">1903</span></a>            <span class="n">consolation</span><span class="p">[</span><span class="s2">&quot;sim&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League-1904"><a href="#League-1904"><span class="linenos">1904</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">consolation</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="League-1905"><a href="#League-1905"><span class="linenos">1905</span></a>                <span class="o">*</span> <span class="n">consolation</span><span class="o">.</span><span class="n">points_stdev</span>
</span><span id="League-1906"><a href="#League-1906"><span class="linenos">1906</span></a>                <span class="o">+</span> <span class="n">consolation</span><span class="o">.</span><span class="n">points_avg</span>
</span><span id="League-1907"><a href="#League-1907"><span class="linenos">1907</span></a>                <span class="o">+</span> <span class="n">consolation</span><span class="o">.</span><span class="n">score</span>
</span><span id="League-1908"><a href="#League-1908"><span class="linenos">1908</span></a>            <span class="p">)</span>
</span><span id="League-1909"><a href="#League-1909"><span class="linenos">1909</span></a>            <span class="n">third</span> <span class="o">=</span> <span class="n">consolation</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
</span><span id="League-1910"><a href="#League-1910"><span class="linenos">1910</span></a>                <span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;num_sim&quot;</span><span class="p">,</span> <span class="s2">&quot;sim&quot;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]</span>
</span><span id="League-1911"><a href="#League-1911"><span class="linenos">1911</span></a>            <span class="p">)</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;num_sim&quot;</span><span class="p">],</span> <span class="n">keep</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)</span>
</span><span id="League-1912"><a href="#League-1912"><span class="linenos">1912</span></a>            <span class="k">if</span> <span class="n">algorithm</span><span class="p">:</span>
</span><span id="League-1913"><a href="#League-1913"><span class="linenos">1913</span></a>                <span class="n">many_mile</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League-1914"><a href="#League-1914"><span class="linenos">1914</span></a>                    <span class="n">left</span><span class="o">=</span><span class="n">many_mile</span><span class="p">,</span>
</span><span id="League-1915"><a href="#League-1915"><span class="linenos">1915</span></a>                    <span class="n">right</span><span class="o">=</span><span class="n">scores</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League-1916"><a href="#League-1916"><span class="linenos">1916</span></a>                        <span class="n">scores</span><span class="o">.</span><span class="n">week</span>
</span><span id="League-1917"><a href="#League-1917"><span class="linenos">1917</span></a>                        <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;playoff_start_week&quot;</span><span class="p">]</span>
</span><span id="League-1918"><a href="#League-1918"><span class="linenos">1918</span></a>                        <span class="o">+</span> <span class="mi">1</span>
</span><span id="League-1919"><a href="#League-1919"><span class="linenos">1919</span></a>                        <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;num_playoff_teams&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">6</span><span class="p">),</span>
</span><span id="League-1920"><a href="#League-1920"><span class="linenos">1920</span></a>                        <span class="p">[</span><span class="s2">&quot;team&quot;</span><span class="p">,</span> <span class="s2">&quot;score&quot;</span><span class="p">],</span>
</span><span id="League-1921"><a href="#League-1921"><span class="linenos">1921</span></a>                    <span class="p">],</span>
</span><span id="League-1922"><a href="#League-1922"><span class="linenos">1922</span></a>                    <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
</span><span id="League-1923"><a href="#League-1923"><span class="linenos">1923</span></a>                    <span class="n">on</span><span class="o">=</span><span class="s2">&quot;team&quot;</span><span class="p">,</span>
</span><span id="League-1924"><a href="#League-1924"><span class="linenos">1924</span></a>                <span class="p">)</span>
</span><span id="League-1925"><a href="#League-1925"><span class="linenos">1925</span></a>                <span class="n">many_mile</span><span class="o">.</span><span class="n">score</span> <span class="o">=</span> <span class="n">many_mile</span><span class="o">.</span><span class="n">score</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="League-1926"><a href="#League-1926"><span class="linenos">1926</span></a>                <span class="n">many_mile</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League-1927"><a href="#League-1927"><span class="linenos">1927</span></a>                    <span class="n">left</span><span class="o">=</span><span class="n">many_mile</span><span class="p">,</span>
</span><span id="League-1928"><a href="#League-1928"><span class="linenos">1928</span></a>                    <span class="n">right</span><span class="o">=</span><span class="n">projections</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League-1929"><a href="#League-1929"><span class="linenos">1929</span></a>                        <span class="n">projections</span><span class="o">.</span><span class="n">week</span>
</span><span id="League-1930"><a href="#League-1930"><span class="linenos">1930</span></a>                        <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;playoff_start_week&quot;</span><span class="p">]</span>
</span><span id="League-1931"><a href="#League-1931"><span class="linenos">1931</span></a>                        <span class="o">+</span> <span class="mi">1</span>
</span><span id="League-1932"><a href="#League-1932"><span class="linenos">1932</span></a>                        <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;num_playoff_teams&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">6</span><span class="p">),</span>
</span><span id="League-1933"><a href="#League-1933"><span class="linenos">1933</span></a>                        <span class="p">[</span><span class="s2">&quot;fantasy_team&quot;</span><span class="p">,</span> <span class="s2">&quot;points_avg&quot;</span><span class="p">,</span> <span class="s2">&quot;points_stdev&quot;</span><span class="p">],</span>
</span><span id="League-1934"><a href="#League-1934"><span class="linenos">1934</span></a>                    <span class="p">]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;fantasy_team&quot;</span><span class="p">:</span> <span class="s2">&quot;team&quot;</span><span class="p">}),</span>
</span><span id="League-1935"><a href="#League-1935"><span class="linenos">1935</span></a>                    <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
</span><span id="League-1936"><a href="#League-1936"><span class="linenos">1936</span></a>                    <span class="n">on</span><span class="o">=</span><span class="s2">&quot;team&quot;</span><span class="p">,</span>
</span><span id="League-1937"><a href="#League-1937"><span class="linenos">1937</span></a>                <span class="p">)</span>
</span><span id="League-1938"><a href="#League-1938"><span class="linenos">1938</span></a>                <span class="n">many_mile</span><span class="o">.</span><span class="n">points_avg</span> <span class="o">=</span> <span class="n">many_mile</span><span class="o">.</span><span class="n">points_avg</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="League-1939"><a href="#League-1939"><span class="linenos">1939</span></a>                <span class="n">many_mile</span><span class="o">.</span><span class="n">points_stdev</span> <span class="o">=</span> <span class="n">many_mile</span><span class="o">.</span><span class="n">points_stdev</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="League-1940"><a href="#League-1940"><span class="linenos">1940</span></a>                <span class="n">many_mile</span><span class="p">[</span><span class="s2">&quot;sim&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League-1941"><a href="#League-1941"><span class="linenos">1941</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">many_mile</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="League-1942"><a href="#League-1942"><span class="linenos">1942</span></a>                    <span class="o">*</span> <span class="n">many_mile</span><span class="o">.</span><span class="n">points_stdev</span>
</span><span id="League-1943"><a href="#League-1943"><span class="linenos">1943</span></a>                    <span class="o">+</span> <span class="n">many_mile</span><span class="o">.</span><span class="n">points_avg</span>
</span><span id="League-1944"><a href="#League-1944"><span class="linenos">1944</span></a>                    <span class="o">+</span> <span class="n">many_mile</span><span class="o">.</span><span class="n">score</span>
</span><span id="League-1945"><a href="#League-1945"><span class="linenos">1945</span></a>                <span class="p">)</span>
</span><span id="League-1946"><a href="#League-1946"><span class="linenos">1946</span></a>                <span class="n">many_mile</span> <span class="o">=</span> <span class="n">many_mile</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
</span><span id="League-1947"><a href="#League-1947"><span class="linenos">1947</span></a>                    <span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;num_sim&quot;</span><span class="p">,</span> <span class="s2">&quot;sim&quot;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span>
</span><span id="League-1948"><a href="#League-1948"><span class="linenos">1948</span></a>                <span class="p">)</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;num_sim&quot;</span><span class="p">],</span> <span class="n">keep</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)</span>
</span><span id="League-1949"><a href="#League-1949"><span class="linenos">1949</span></a>            <span class="n">final_probs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League-1950"><a href="#League-1950"><span class="linenos">1950</span></a>                <span class="n">left</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League-1951"><a href="#League-1951"><span class="linenos">1951</span></a>                    <span class="n">left</span><span class="o">=</span><span class="n">winner</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;team&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s2">&quot;winner&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(),</span>
</span><span id="League-1952"><a href="#League-1952"><span class="linenos">1952</span></a>                    <span class="n">right</span><span class="o">=</span><span class="n">runner_up</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;team&quot;</span><span class="p">)</span>
</span><span id="League-1953"><a href="#League-1953"><span class="linenos">1953</span></a>                    <span class="o">.</span><span class="n">size</span><span class="p">()</span>
</span><span id="League-1954"><a href="#League-1954"><span class="linenos">1954</span></a>                    <span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s2">&quot;runner_up&quot;</span><span class="p">)</span>
</span><span id="League-1955"><a href="#League-1955"><span class="linenos">1955</span></a>                    <span class="o">.</span><span class="n">reset_index</span><span class="p">(),</span>
</span><span id="League-1956"><a href="#League-1956"><span class="linenos">1956</span></a>                    <span class="n">how</span><span class="o">=</span><span class="s2">&quot;outer&quot;</span><span class="p">,</span>
</span><span id="League-1957"><a href="#League-1957"><span class="linenos">1957</span></a>                    <span class="n">on</span><span class="o">=</span><span class="s2">&quot;team&quot;</span><span class="p">,</span>
</span><span id="League-1958"><a href="#League-1958"><span class="linenos">1958</span></a>                <span class="p">),</span>
</span><span id="League-1959"><a href="#League-1959"><span class="linenos">1959</span></a>                <span class="n">right</span><span class="o">=</span><span class="n">third</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;team&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s2">&quot;third&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(),</span>
</span><span id="League-1960"><a href="#League-1960"><span class="linenos">1960</span></a>                <span class="n">how</span><span class="o">=</span><span class="s2">&quot;outer&quot;</span><span class="p">,</span>
</span><span id="League-1961"><a href="#League-1961"><span class="linenos">1961</span></a>                <span class="n">on</span><span class="o">=</span><span class="s2">&quot;team&quot;</span><span class="p">,</span>
</span><span id="League-1962"><a href="#League-1962"><span class="linenos">1962</span></a>            <span class="p">)</span>
</span><span id="League-1963"><a href="#League-1963"><span class="linenos">1963</span></a>            <span class="k">if</span> <span class="n">algorithm</span><span class="p">:</span>
</span><span id="League-1964"><a href="#League-1964"><span class="linenos">1964</span></a>                <span class="n">final_probs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League-1965"><a href="#League-1965"><span class="linenos">1965</span></a>                    <span class="n">left</span><span class="o">=</span><span class="n">final_probs</span><span class="p">,</span>
</span><span id="League-1966"><a href="#League-1966"><span class="linenos">1966</span></a>                    <span class="n">right</span><span class="o">=</span><span class="n">many_mile</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;team&quot;</span><span class="p">)</span>
</span><span id="League-1967"><a href="#League-1967"><span class="linenos">1967</span></a>                    <span class="o">.</span><span class="n">size</span><span class="p">()</span>
</span><span id="League-1968"><a href="#League-1968"><span class="linenos">1968</span></a>                    <span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s2">&quot;many_mile&quot;</span><span class="p">)</span>
</span><span id="League-1969"><a href="#League-1969"><span class="linenos">1969</span></a>                    <span class="o">.</span><span class="n">reset_index</span><span class="p">(),</span>
</span><span id="League-1970"><a href="#League-1970"><span class="linenos">1970</span></a>                    <span class="n">how</span><span class="o">=</span><span class="s2">&quot;outer&quot;</span><span class="p">,</span>
</span><span id="League-1971"><a href="#League-1971"><span class="linenos">1971</span></a>                    <span class="n">on</span><span class="o">=</span><span class="s2">&quot;team&quot;</span><span class="p">,</span>
</span><span id="League-1972"><a href="#League-1972"><span class="linenos">1972</span></a>                <span class="p">)</span>
</span><span id="League-1973"><a href="#League-1973"><span class="linenos">1973</span></a>                <span class="n">final_probs</span><span class="p">[</span><span class="s2">&quot;many_mile&quot;</span><span class="p">]</span> <span class="o">/=</span> <span class="n">many_mile</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League-1974"><a href="#League-1974"><span class="linenos">1974</span></a>                <span class="n">final_probs</span><span class="p">[</span><span class="s2">&quot;many_mile&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_probs</span><span class="p">[</span><span class="s2">&quot;many_mile&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="League-1975"><a href="#League-1975"><span class="linenos">1975</span></a>            <span class="n">final_probs</span><span class="p">[</span><span class="s2">&quot;winner&quot;</span><span class="p">]</span> <span class="o">/=</span> <span class="n">winner</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League-1976"><a href="#League-1976"><span class="linenos">1976</span></a>            <span class="n">final_probs</span><span class="p">[</span><span class="s2">&quot;runner_up&quot;</span><span class="p">]</span> <span class="o">/=</span> <span class="n">runner_up</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League-1977"><a href="#League-1977"><span class="linenos">1977</span></a>            <span class="n">final_probs</span><span class="p">[</span><span class="s2">&quot;third&quot;</span><span class="p">]</span> <span class="o">/=</span> <span class="n">third</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League-1978"><a href="#League-1978"><span class="linenos">1978</span></a>            <span class="n">final_probs</span><span class="p">[</span><span class="s2">&quot;winner&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_probs</span><span class="p">[</span><span class="s2">&quot;winner&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="League-1979"><a href="#League-1979"><span class="linenos">1979</span></a>            <span class="n">final_probs</span><span class="p">[</span><span class="s2">&quot;runner_up&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_probs</span><span class="p">[</span><span class="s2">&quot;runner_up&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="League-1980"><a href="#League-1980"><span class="linenos">1980</span></a>            <span class="n">final_probs</span><span class="p">[</span><span class="s2">&quot;third&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_probs</span><span class="p">[</span><span class="s2">&quot;third&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="League-1981"><a href="#League-1981"><span class="linenos">1981</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="League-1982"><a href="#League-1982"><span class="linenos">1982</span></a>            <span class="n">final_probs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span><span id="League-1983"><a href="#League-1983"><span class="linenos">1983</span></a>                <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;team&quot;</span><span class="p">,</span> <span class="s2">&quot;winner&quot;</span><span class="p">,</span> <span class="s2">&quot;runner_up&quot;</span><span class="p">,</span> <span class="s2">&quot;third&quot;</span><span class="p">,</span> <span class="s2">&quot;many_mile&quot;</span><span class="p">]</span>
</span><span id="League-1984"><a href="#League-1984"><span class="linenos">1984</span></a>            <span class="p">)</span>
</span><span id="League-1985"><a href="#League-1985"><span class="linenos">1985</span></a>        <span class="n">schedule</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League-1986"><a href="#League-1986"><span class="linenos">1986</span></a>            <span class="n">schedule_sims</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;week&quot;</span><span class="p">,</span> <span class="s2">&quot;team_1&quot;</span><span class="p">,</span> <span class="s2">&quot;team_2&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">numeric_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="League-1987"><a href="#League-1987"><span class="linenos">1987</span></a>        <span class="p">)</span>
</span><span id="League-1988"><a href="#League-1988"><span class="linenos">1988</span></a>        <span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;points_avg_1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;points_avg_1&quot;</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="League-1989"><a href="#League-1989"><span class="linenos">1989</span></a>        <span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;points_stdev_1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;points_stdev_1&quot;</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="League-1990"><a href="#League-1990"><span class="linenos">1990</span></a>        <span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;points_avg_2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;points_avg_2&quot;</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="League-1991"><a href="#League-1991"><span class="linenos">1991</span></a>        <span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;points_stdev_2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;points_stdev_2&quot;</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="League-1992"><a href="#League-1992"><span class="linenos">1992</span></a>        <span class="n">standings</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League-1993"><a href="#League-1993"><span class="linenos">1993</span></a>            <span class="n">left</span><span class="o">=</span><span class="n">standings</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;team&quot;</span><span class="p">)</span>
</span><span id="League-1994"><a href="#League-1994"><span class="linenos">1994</span></a>            <span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="League-1995"><a href="#League-1995"><span class="linenos">1995</span></a>            <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="League-1996"><a href="#League-1996"><span class="linenos">1996</span></a>            <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;wins&quot;</span><span class="p">:</span> <span class="s2">&quot;wins_avg&quot;</span><span class="p">,</span> <span class="s2">&quot;points&quot;</span><span class="p">:</span> <span class="s2">&quot;points_avg&quot;</span><span class="p">}),</span>
</span><span id="League-1997"><a href="#League-1997"><span class="linenos">1997</span></a>            <span class="n">right</span><span class="o">=</span><span class="n">standings</span><span class="p">[[</span><span class="s2">&quot;team&quot;</span><span class="p">,</span> <span class="s2">&quot;wins&quot;</span><span class="p">,</span> <span class="s2">&quot;points&quot;</span><span class="p">]]</span>
</span><span id="League-1998"><a href="#League-1998"><span class="linenos">1998</span></a>            <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;team&quot;</span><span class="p">)</span>
</span><span id="League-1999"><a href="#League-1999"><span class="linenos">1999</span></a>            <span class="o">.</span><span class="n">std</span><span class="p">()</span>
</span><span id="League-2000"><a href="#League-2000"><span class="linenos">2000</span></a>            <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="League-2001"><a href="#League-2001"><span class="linenos">2001</span></a>            <span class="o">.</span><span class="n">rename</span><span class="p">(</span>
</span><span id="League-2002"><a href="#League-2002"><span class="linenos">2002</span></a>                <span class="n">index</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;wins&quot;</span><span class="p">:</span> <span class="s2">&quot;wins_stdev&quot;</span><span class="p">,</span> <span class="s2">&quot;points&quot;</span><span class="p">:</span> <span class="s2">&quot;points_stdev&quot;</span><span class="p">}</span>
</span><span id="League-2003"><a href="#League-2003"><span class="linenos">2003</span></a>            <span class="p">),</span>
</span><span id="League-2004"><a href="#League-2004"><span class="linenos">2004</span></a>            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">,</span>
</span><span id="League-2005"><a href="#League-2005"><span class="linenos">2005</span></a>            <span class="n">on</span><span class="o">=</span><span class="s2">&quot;team&quot;</span><span class="p">,</span>
</span><span id="League-2006"><a href="#League-2006"><span class="linenos">2006</span></a>        <span class="p">)</span>
</span><span id="League-2007"><a href="#League-2007"><span class="linenos">2007</span></a>        <span class="n">standings</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">standings</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">final_probs</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;team&quot;</span><span class="p">)</span>
</span><span id="League-2008"><a href="#League-2008"><span class="linenos">2008</span></a>        <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;winner&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;winner&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="League-2009"><a href="#League-2009"><span class="linenos">2009</span></a>        <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;runner_up&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;runner_up&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="League-2010"><a href="#League-2010"><span class="linenos">2010</span></a>        <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;third&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;third&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="League-2011"><a href="#League-2011"><span class="linenos">2011</span></a>        <span class="k">if</span> <span class="n">algorithm</span><span class="p">:</span>
</span><span id="League-2012"><a href="#League-2012"><span class="linenos">2012</span></a>            <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;many_mile&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;many_mile&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="League-2013"><a href="#League-2013"><span class="linenos">2013</span></a>        <span class="n">scores</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">schedule_sims</span><span class="p">[[</span><span class="s2">&quot;team_1&quot;</span><span class="p">,</span> <span class="s2">&quot;sim_1&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;team_1&quot;</span><span class="p">:</span> <span class="s2">&quot;team&quot;</span><span class="p">,</span> <span class="s2">&quot;sim_1&quot;</span><span class="p">:</span> <span class="s2">&quot;sim&quot;</span><span class="p">}),</span>
</span><span id="League-2014"><a href="#League-2014"><span class="linenos">2014</span></a>        <span class="n">schedule_sims</span><span class="p">[[</span><span class="s2">&quot;team_2&quot;</span><span class="p">,</span> <span class="s2">&quot;sim_2&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;team_2&quot;</span><span class="p">:</span> <span class="s2">&quot;team&quot;</span><span class="p">,</span> <span class="s2">&quot;sim_2&quot;</span><span class="p">:</span> <span class="s2">&quot;sim&quot;</span><span class="p">})],</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;team&quot;</span><span class="p">)</span>
</span><span id="League-2015"><a href="#League-2015"><span class="linenos">2015</span></a>        <span class="n">standings</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League-2016"><a href="#League-2016"><span class="linenos">2016</span></a>            <span class="n">left</span><span class="o">=</span><span class="n">standings</span><span class="p">,</span>
</span><span id="League-2017"><a href="#League-2017"><span class="linenos">2017</span></a>            <span class="n">right</span><span class="o">=</span><span class="n">scores</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="League-2018"><a href="#League-2018"><span class="linenos">2018</span></a>            <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="League-2019"><a href="#League-2019"><span class="linenos">2019</span></a>            <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;sim&quot;</span><span class="p">:</span> <span class="s2">&quot;per_game_avg&quot;</span><span class="p">}),</span>
</span><span id="League-2020"><a href="#League-2020"><span class="linenos">2020</span></a>            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">,</span>
</span><span id="League-2021"><a href="#League-2021"><span class="linenos">2021</span></a>            <span class="n">on</span><span class="o">=</span><span class="s2">&quot;team&quot;</span><span class="p">,</span>
</span><span id="League-2022"><a href="#League-2022"><span class="linenos">2022</span></a>        <span class="p">)</span>
</span><span id="League-2023"><a href="#League-2023"><span class="linenos">2023</span></a>        <span class="n">standings</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League-2024"><a href="#League-2024"><span class="linenos">2024</span></a>            <span class="n">left</span><span class="o">=</span><span class="n">standings</span><span class="p">,</span>
</span><span id="League-2025"><a href="#League-2025"><span class="linenos">2025</span></a>            <span class="n">right</span><span class="o">=</span><span class="n">scores</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
</span><span id="League-2026"><a href="#League-2026"><span class="linenos">2026</span></a>            <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="League-2027"><a href="#League-2027"><span class="linenos">2027</span></a>            <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;sim&quot;</span><span class="p">:</span> <span class="s2">&quot;per_game_stdev&quot;</span><span class="p">}),</span>
</span><span id="League-2028"><a href="#League-2028"><span class="linenos">2028</span></a>            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">,</span>
</span><span id="League-2029"><a href="#League-2029"><span class="linenos">2029</span></a>            <span class="n">on</span><span class="o">=</span><span class="s2">&quot;team&quot;</span><span class="p">,</span>
</span><span id="League-2030"><a href="#League-2030"><span class="linenos">2030</span></a>        <span class="p">)</span>
</span><span id="League-2031"><a href="#League-2031"><span class="linenos">2031</span></a>        <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;per_game_fano&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League-2032"><a href="#League-2032"><span class="linenos">2032</span></a>            <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;per_game_stdev&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;per_game_avg&quot;</span><span class="p">]</span>
</span><span id="League-2033"><a href="#League-2033"><span class="linenos">2033</span></a>        <span class="p">)</span>
</span><span id="League-2034"><a href="#League-2034"><span class="linenos">2034</span></a>        <span class="n">standings</span> <span class="o">=</span> <span class="n">standings</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
</span><span id="League-2035"><a href="#League-2035"><span class="linenos">2035</span></a>            <span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;winner&quot;</span> <span class="k">if</span> <span class="n">postseason</span> <span class="k">else</span> <span class="s2">&quot;playoffs&quot;</span><span class="p">]</span>
</span><span id="League-2036"><a href="#League-2036"><span class="linenos">2036</span></a>            <span class="o">+</span> <span class="p">([</span><span class="s2">&quot;many_mile&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;many_mile&quot;</span> <span class="ow">in</span> <span class="n">standings</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="k">else</span> <span class="p">[]),</span>
</span><span id="League-2037"><a href="#League-2037"><span class="linenos">2037</span></a>            <span class="n">ascending</span><span class="o">=</span><span class="p">[</span><span class="kc">False</span><span class="p">]</span>
</span><span id="League-2038"><a href="#League-2038"><span class="linenos">2038</span></a>            <span class="o">+</span> <span class="p">([</span><span class="kc">True</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;many_mile&quot;</span> <span class="ow">in</span> <span class="n">standings</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="k">else</span> <span class="p">[]),</span>
</span><span id="League-2039"><a href="#League-2039"><span class="linenos">2039</span></a>        <span class="p">)</span>
</span><span id="League-2040"><a href="#League-2040"><span class="linenos">2040</span></a>        <span class="k">if</span> <span class="n">postseason</span><span class="p">:</span>
</span><span id="League-2041"><a href="#League-2041"><span class="linenos">2041</span></a>            <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;earnings&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span>
</span><span id="League-2042"><a href="#League-2042"><span class="linenos">2042</span></a>                <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;winner&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">payouts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League-2043"><a href="#League-2043"><span class="linenos">2043</span></a>                <span class="o">+</span> <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;runner_up&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">payouts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="League-2044"><a href="#League-2044"><span class="linenos">2044</span></a>                <span class="o">+</span> <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;third&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">payouts</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
</span><span id="League-2045"><a href="#League-2045"><span class="linenos">2045</span></a>                <span class="mi">2</span><span class="p">,</span>
</span><span id="League-2046"><a href="#League-2046"><span class="linenos">2046</span></a>            <span class="p">)</span>
</span><span id="League-2047"><a href="#League-2047"><span class="linenos">2047</span></a>        <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;wins_avg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">standings</span><span class="p">[</span><span class="s2">&quot;wins_avg&quot;</span><span class="p">],</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="League-2048"><a href="#League-2048"><span class="linenos">2048</span></a>        <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;wins_stdev&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">standings</span><span class="p">[</span><span class="s2">&quot;wins_stdev&quot;</span><span class="p">],</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="League-2049"><a href="#League-2049"><span class="linenos">2049</span></a>        <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;points_avg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">standings</span><span class="p">[</span><span class="s2">&quot;points_avg&quot;</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="League-2050"><a href="#League-2050"><span class="linenos">2050</span></a>        <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;points_stdev&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">standings</span><span class="p">[</span><span class="s2">&quot;points_stdev&quot;</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="League-2051"><a href="#League-2051"><span class="linenos">2051</span></a>        <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;per_game_avg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">standings</span><span class="p">[</span><span class="s2">&quot;per_game_avg&quot;</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="League-2052"><a href="#League-2052"><span class="linenos">2052</span></a>        <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;per_game_stdev&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">standings</span><span class="p">[</span><span class="s2">&quot;per_game_stdev&quot;</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="League-2053"><a href="#League-2053"><span class="linenos">2053</span></a>        <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;per_game_fano&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">standings</span><span class="p">[</span><span class="s2">&quot;per_game_fano&quot;</span><span class="p">],</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="League-2054"><a href="#League-2054"><span class="linenos">2054</span></a>        <span class="k">return</span> <span class="n">schedule</span><span class="p">,</span> <span class="n">standings</span>
</span><span id="League-2055"><a href="#League-2055"><span class="linenos">2055</span></a>
</span><span id="League-2056"><a href="#League-2056"><span class="linenos">2056</span></a>    <span class="k">def</span> <span class="nf">war_sim</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="League-2057"><a href="#League-2057"><span class="linenos">2057</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="League-2058"><a href="#League-2058"><span class="linenos">2058</span></a><span class="sd">        Simulates the wins-above-replacement (WAR) for each of the players eligible to roster, </span>
</span><span id="League-2059"><a href="#League-2059"><span class="linenos">2059</span></a><span class="sd">        i.e. how many more wins in a season you would have by rostering that player </span>
</span><span id="League-2060"><a href="#League-2060"><span class="linenos">2060</span></a><span class="sd">        compared to an average player at that position.</span>
</span><span id="League-2061"><a href="#League-2061"><span class="linenos">2061</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="League-2062"><a href="#League-2062"><span class="linenos">2062</span></a>        <span class="n">as_of</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">season</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">week</span>
</span><span id="League-2063"><a href="#League-2063"><span class="linenos">2063</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">load_stats</span><span class="p">(</span><span class="n">as_of</span> <span class="o">-</span> <span class="mi">100</span><span class="p">,</span> <span class="n">as_of</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="League-2064"><a href="#League-2064"><span class="linenos">2064</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Creating histograms across all players in each position &quot;&quot;&quot;</span>
</span><span id="League-2065"><a href="#League-2065"><span class="linenos">2065</span></a>        <span class="n">pos_hists</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;points&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mf">50.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)}</span>
</span><span id="League-2066"><a href="#League-2066"><span class="linenos">2066</span></a>        <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
</span><span id="League-2067"><a href="#League-2067"><span class="linenos">2067</span></a>            <span class="n">pos_hists</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span>
</span><span id="League-2068"><a href="#League-2068"><span class="linenos">2068</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">position</span> <span class="o">==</span> <span class="n">pos</span><span class="p">,</span> <span class="s2">&quot;points&quot;</span><span class="p">],</span>
</span><span id="League-2069"><a href="#League-2069"><span class="linenos">2069</span></a>                <span class="n">bins</span><span class="o">=</span><span class="n">pos_hists</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">],</span>
</span><span id="League-2070"><a href="#League-2070"><span class="linenos">2070</span></a>            <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League-2071"><a href="#League-2071"><span class="linenos">2071</span></a>            <span class="n">pos_hists</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos_hists</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span><span class="n">pos_hists</span><span class="p">[</span><span class="n">pos</span><span class="p">])</span>
</span><span id="League-2072"><a href="#League-2072"><span class="linenos">2072</span></a>        <span class="n">pos_hists</span><span class="p">[</span><span class="s2">&quot;FLEX&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span>
</span><span id="League-2073"><a href="#League-2073"><span class="linenos">2073</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;RB&quot;</span><span class="p">,</span> <span class="s2">&quot;WR&quot;</span><span class="p">,</span> <span class="s2">&quot;TE&quot;</span><span class="p">]),</span> <span class="s2">&quot;points&quot;</span><span class="p">],</span>
</span><span id="League-2074"><a href="#League-2074"><span class="linenos">2074</span></a>            <span class="n">bins</span><span class="o">=</span><span class="n">pos_hists</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">],</span>
</span><span id="League-2075"><a href="#League-2075"><span class="linenos">2075</span></a>        <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League-2076"><a href="#League-2076"><span class="linenos">2076</span></a>        <span class="n">pos_hists</span><span class="p">[</span><span class="s2">&quot;FLEX&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos_hists</span><span class="p">[</span><span class="s2">&quot;FLEX&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span><span class="n">pos_hists</span><span class="p">[</span><span class="s2">&quot;FLEX&quot;</span><span class="p">])</span>
</span><span id="League-2077"><a href="#League-2077"><span class="linenos">2077</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Simulating an entire team using average players &quot;&quot;&quot;</span>
</span><span id="League-2078"><a href="#League-2078"><span class="linenos">2078</span></a>        <span class="n">sim_scores</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span><span id="League-2079"><a href="#League-2079"><span class="linenos">2079</span></a>            <span class="p">{</span>
</span><span id="League-2080"><a href="#League-2080"><span class="linenos">2080</span></a>                <span class="s2">&quot;QB&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
</span><span id="League-2081"><a href="#League-2081"><span class="linenos">2081</span></a>                    <span class="n">pos_hists</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="o">=</span><span class="n">pos_hists</span><span class="p">[</span><span class="s2">&quot;QB&quot;</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_sims</span>
</span><span id="League-2082"><a href="#League-2082"><span class="linenos">2082</span></a>                <span class="p">),</span>
</span><span id="League-2083"><a href="#League-2083"><span class="linenos">2083</span></a>                <span class="s2">&quot;RB1&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
</span><span id="League-2084"><a href="#League-2084"><span class="linenos">2084</span></a>                    <span class="n">pos_hists</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="o">=</span><span class="n">pos_hists</span><span class="p">[</span><span class="s2">&quot;RB&quot;</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_sims</span>
</span><span id="League-2085"><a href="#League-2085"><span class="linenos">2085</span></a>                <span class="p">),</span>
</span><span id="League-2086"><a href="#League-2086"><span class="linenos">2086</span></a>                <span class="s2">&quot;RB2&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
</span><span id="League-2087"><a href="#League-2087"><span class="linenos">2087</span></a>                    <span class="n">pos_hists</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="o">=</span><span class="n">pos_hists</span><span class="p">[</span><span class="s2">&quot;RB&quot;</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_sims</span>
</span><span id="League-2088"><a href="#League-2088"><span class="linenos">2088</span></a>                <span class="p">),</span>
</span><span id="League-2089"><a href="#League-2089"><span class="linenos">2089</span></a>                <span class="s2">&quot;WR1&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
</span><span id="League-2090"><a href="#League-2090"><span class="linenos">2090</span></a>                    <span class="n">pos_hists</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="o">=</span><span class="n">pos_hists</span><span class="p">[</span><span class="s2">&quot;WR&quot;</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_sims</span>
</span><span id="League-2091"><a href="#League-2091"><span class="linenos">2091</span></a>                <span class="p">),</span>
</span><span id="League-2092"><a href="#League-2092"><span class="linenos">2092</span></a>                <span class="s2">&quot;WR2&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
</span><span id="League-2093"><a href="#League-2093"><span class="linenos">2093</span></a>                    <span class="n">pos_hists</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="o">=</span><span class="n">pos_hists</span><span class="p">[</span><span class="s2">&quot;WR&quot;</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_sims</span>
</span><span id="League-2094"><a href="#League-2094"><span class="linenos">2094</span></a>                <span class="p">),</span>
</span><span id="League-2095"><a href="#League-2095"><span class="linenos">2095</span></a>                <span class="s2">&quot;TE&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
</span><span id="League-2096"><a href="#League-2096"><span class="linenos">2096</span></a>                    <span class="n">pos_hists</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="o">=</span><span class="n">pos_hists</span><span class="p">[</span><span class="s2">&quot;TE&quot;</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_sims</span>
</span><span id="League-2097"><a href="#League-2097"><span class="linenos">2097</span></a>                <span class="p">),</span>
</span><span id="League-2098"><a href="#League-2098"><span class="linenos">2098</span></a>                <span class="s2">&quot;FLEX&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
</span><span id="League-2099"><a href="#League-2099"><span class="linenos">2099</span></a>                    <span class="n">pos_hists</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="o">=</span><span class="n">pos_hists</span><span class="p">[</span><span class="s2">&quot;FLEX&quot;</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_sims</span>
</span><span id="League-2100"><a href="#League-2100"><span class="linenos">2100</span></a>                <span class="p">),</span>
</span><span id="League-2101"><a href="#League-2101"><span class="linenos">2101</span></a>                <span class="s2">&quot;K&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
</span><span id="League-2102"><a href="#League-2102"><span class="linenos">2102</span></a>                    <span class="n">pos_hists</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="o">=</span><span class="n">pos_hists</span><span class="p">[</span><span class="s2">&quot;K&quot;</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_sims</span>
</span><span id="League-2103"><a href="#League-2103"><span class="linenos">2103</span></a>                <span class="p">),</span>
</span><span id="League-2104"><a href="#League-2104"><span class="linenos">2104</span></a>                <span class="s2">&quot;DEF&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
</span><span id="League-2105"><a href="#League-2105"><span class="linenos">2105</span></a>                    <span class="n">pos_hists</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="o">=</span><span class="n">pos_hists</span><span class="p">[</span><span class="s2">&quot;DEF&quot;</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_sims</span>
</span><span id="League-2106"><a href="#League-2106"><span class="linenos">2106</span></a>                <span class="p">),</span>
</span><span id="League-2107"><a href="#League-2107"><span class="linenos">2107</span></a>            <span class="p">}</span>
</span><span id="League-2108"><a href="#League-2108"><span class="linenos">2108</span></a>        <span class="p">)</span>
</span><span id="League-2109"><a href="#League-2109"><span class="linenos">2109</span></a>        <span class="n">sim_scores</span><span class="p">[</span><span class="s2">&quot;Total&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League-2110"><a href="#League-2110"><span class="linenos">2110</span></a>            <span class="n">sim_scores</span><span class="o">.</span><span class="n">QB</span>
</span><span id="League-2111"><a href="#League-2111"><span class="linenos">2111</span></a>            <span class="o">+</span> <span class="n">sim_scores</span><span class="o">.</span><span class="n">RB1</span>
</span><span id="League-2112"><a href="#League-2112"><span class="linenos">2112</span></a>            <span class="o">+</span> <span class="n">sim_scores</span><span class="o">.</span><span class="n">RB2</span>
</span><span id="League-2113"><a href="#League-2113"><span class="linenos">2113</span></a>            <span class="o">+</span> <span class="n">sim_scores</span><span class="o">.</span><span class="n">WR1</span>
</span><span id="League-2114"><a href="#League-2114"><span class="linenos">2114</span></a>            <span class="o">+</span> <span class="n">sim_scores</span><span class="o">.</span><span class="n">WR2</span>
</span><span id="League-2115"><a href="#League-2115"><span class="linenos">2115</span></a>            <span class="o">+</span> <span class="n">sim_scores</span><span class="o">.</span><span class="n">TE</span>
</span><span id="League-2116"><a href="#League-2116"><span class="linenos">2116</span></a>            <span class="o">+</span> <span class="n">sim_scores</span><span class="o">.</span><span class="n">FLEX</span>
</span><span id="League-2117"><a href="#League-2117"><span class="linenos">2117</span></a>            <span class="o">+</span> <span class="n">sim_scores</span><span class="o">.</span><span class="n">K</span>
</span><span id="League-2118"><a href="#League-2118"><span class="linenos">2118</span></a>            <span class="o">+</span> <span class="n">sim_scores</span><span class="o">.</span><span class="n">DEF</span>
</span><span id="League-2119"><a href="#League-2119"><span class="linenos">2119</span></a>        <span class="p">)</span>
</span><span id="League-2120"><a href="#League-2120"><span class="linenos">2120</span></a>        <span class="n">player_sims</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span><span id="League-2121"><a href="#League-2121"><span class="linenos">2121</span></a>            <span class="p">{</span>
</span><span id="League-2122"><a href="#League-2122"><span class="linenos">2122</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">]:</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span>
</span><span id="League-2123"><a href="#League-2123"><span class="linenos">2123</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span>
</span><span id="League-2124"><a href="#League-2124"><span class="linenos">2124</span></a>                        <span class="n">loc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span> <span class="s2">&quot;points_rate&quot;</span><span class="p">],</span>
</span><span id="League-2125"><a href="#League-2125"><span class="linenos">2125</span></a>                        <span class="n">scale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span> <span class="s2">&quot;points_stdev&quot;</span><span class="p">],</span>
</span><span id="League-2126"><a href="#League-2126"><span class="linenos">2126</span></a>                        <span class="n">size</span><span class="o">=</span><span class="n">sim_scores</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="League-2127"><a href="#League-2127"><span class="linenos">2127</span></a>                    <span class="p">)</span>
</span><span id="League-2128"><a href="#League-2128"><span class="linenos">2128</span></a>                <span class="p">)</span>
</span><span id="League-2129"><a href="#League-2129"><span class="linenos">2129</span></a>                <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="League-2130"><a href="#League-2130"><span class="linenos">2130</span></a>            <span class="p">}</span>
</span><span id="League-2131"><a href="#League-2131"><span class="linenos">2131</span></a>        <span class="p">)</span>
</span><span id="League-2132"><a href="#League-2132"><span class="linenos">2132</span></a>        <span class="n">sim_scores</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League-2133"><a href="#League-2133"><span class="linenos">2133</span></a>            <span class="n">left</span><span class="o">=</span><span class="n">sim_scores</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">player_sims</span><span class="p">,</span> <span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span>
</span><span id="League-2134"><a href="#League-2134"><span class="linenos">2134</span></a>        <span class="p">)</span>
</span><span id="League-2135"><a href="#League-2135"><span class="linenos">2135</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Calculating the number of wins above replacement for each player &quot;&quot;&quot;</span>
</span><span id="League-2136"><a href="#League-2136"><span class="linenos">2136</span></a>        <span class="k">for</span> <span class="n">player</span> <span class="ow">in</span> <span class="n">sim_scores</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">10</span><span class="p">:]:</span>
</span><span id="League-2137"><a href="#League-2137"><span class="linenos">2137</span></a>            <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">player</span><span class="p">):</span>
</span><span id="League-2138"><a href="#League-2138"><span class="linenos">2138</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Null player name for some reason... Skipping...&quot;</span><span class="p">)</span>
</span><span id="League-2139"><a href="#League-2139"><span class="linenos">2139</span></a>                <span class="k">continue</span>
</span><span id="League-2140"><a href="#League-2140"><span class="linenos">2140</span></a>            <span class="n">cols</span> <span class="o">=</span> <span class="n">sim_scores</span><span class="o">.</span><span class="n">columns</span><span class="p">[:</span><span class="mi">9</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="League-2141"><a href="#League-2141"><span class="linenos">2141</span></a>            <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">player</span><span class="p">,</span> <span class="s2">&quot;position&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League-2142"><a href="#League-2142"><span class="linenos">2142</span></a>            <span class="k">if</span> <span class="n">pos</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;RB&quot;</span><span class="p">,</span> <span class="s2">&quot;WR&quot;</span><span class="p">]:</span>
</span><span id="League-2143"><a href="#League-2143"><span class="linenos">2143</span></a>                <span class="n">pos</span> <span class="o">+=</span> <span class="s2">&quot;1&quot;</span>
</span><span id="League-2144"><a href="#League-2144"><span class="linenos">2144</span></a>            <span class="n">cols</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">cols</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">pos</span><span class="p">))</span>
</span><span id="League-2145"><a href="#League-2145"><span class="linenos">2145</span></a>            <span class="n">cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">player</span><span class="p">)</span>
</span><span id="League-2146"><a href="#League-2146"><span class="linenos">2146</span></a>            <span class="n">sim_scores</span><span class="p">[</span><span class="s2">&quot;Alt_Total&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sim_scores</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="League-2147"><a href="#League-2147"><span class="linenos">2147</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">player</span><span class="p">,</span> <span class="s2">&quot;WAR&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League-2148"><a href="#League-2148"><span class="linenos">2148</span></a>                <span class="nb">sum</span><span class="p">(</span>
</span><span id="League-2149"><a href="#League-2149"><span class="linenos">2149</span></a>                    <span class="n">sim_scores</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span> <span class="n">sim_scores</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Alt_Total&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="League-2150"><a href="#League-2150"><span class="linenos">2150</span></a>                    <span class="o">&gt;</span> <span class="n">sim_scores</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sim_scores</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span> <span class="p">:,</span> <span class="s2">&quot;Total&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="League-2151"><a href="#League-2151"><span class="linenos">2151</span></a>                <span class="p">)</span>
</span><span id="League-2152"><a href="#League-2152"><span class="linenos">2152</span></a>                <span class="o">/</span> <span class="p">(</span><span class="n">sim_scores</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="League-2153"><a href="#League-2153"><span class="linenos">2153</span></a>                <span class="o">-</span> <span class="mf">0.5</span>
</span><span id="League-2154"><a href="#League-2154"><span class="linenos">2154</span></a>            <span class="p">)</span> <span class="o">*</span> <span class="mi">14</span>
</span><span id="League-2155"><a href="#League-2155"><span class="linenos">2155</span></a>            <span class="k">del</span> <span class="n">sim_scores</span><span class="p">[</span><span class="s2">&quot;Alt_Total&quot;</span><span class="p">]</span>
</span><span id="League-2156"><a href="#League-2156"><span class="linenos">2156</span></a>
</span><span id="League-2157"><a href="#League-2157"><span class="linenos">2157</span></a>    <span class="k">def</span> <span class="nf">possible_pickups</span><span class="p">(</span>
</span><span id="League-2158"><a href="#League-2158"><span class="linenos">2158</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="League-2159"><a href="#League-2159"><span class="linenos">2159</span></a>        <span class="n">focus_on</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[],</span>
</span><span id="League-2160"><a href="#League-2160"><span class="linenos">2160</span></a>        <span class="n">exclude</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[],</span>
</span><span id="League-2161"><a href="#League-2161"><span class="linenos">2161</span></a>        <span class="n">limit_per</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="League-2162"><a href="#League-2162"><span class="linenos">2162</span></a>        <span class="n">team_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="League-2163"><a href="#League-2163"><span class="linenos">2163</span></a>        <span class="n">postseason</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="League-2164"><a href="#League-2164"><span class="linenos">2164</span></a>        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="League-2165"><a href="#League-2165"><span class="linenos">2165</span></a>        <span class="n">payouts</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">800</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
</span><span id="League-2166"><a href="#League-2166"><span class="linenos">2166</span></a>        <span class="n">bestball</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="League-2167"><a href="#League-2167"><span class="linenos">2167</span></a>        <span class="n">min_rostership</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span>
</span><span id="League-2168"><a href="#League-2168"><span class="linenos">2168</span></a>    <span class="p">):</span>
</span><span id="League-2169"><a href="#League-2169"><span class="linenos">2169</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="League-2170"><a href="#League-2170"><span class="linenos">2170</span></a><span class="sd">        Simulates the remainder of the season with the current roster and compares it to </span>
</span><span id="League-2171"><a href="#League-2171"><span class="linenos">2171</span></a><span class="sd">        a simulation of the roster after a series of potential add &amp; drop transactions.</span>
</span><span id="League-2172"><a href="#League-2172"><span class="linenos">2172</span></a>
</span><span id="League-2173"><a href="#League-2173"><span class="linenos">2173</span></a><span class="sd">        Args:</span>
</span><span id="League-2174"><a href="#League-2174"><span class="linenos">2174</span></a><span class="sd">            focus_on (list, optional): list of players to include in every potential trade, defaults to [].  </span>
</span><span id="League-2175"><a href="#League-2175"><span class="linenos">2175</span></a><span class="sd">            exclude (list, optional): list of players to exclude from every potential trade, defaults to [].  </span>
</span><span id="League-2176"><a href="#League-2176"><span class="linenos">2176</span></a><span class="sd">            limit_per (int, optional): number of players per position to analyze, defaults to 10.  </span>
</span><span id="League-2177"><a href="#League-2177"><span class="linenos">2177</span></a><span class="sd">            team_name (str, optional): name of team to analyze trades for, defaults to None (and therefore team of interest).  </span>
</span><span id="League-2178"><a href="#League-2178"><span class="linenos">2178</span></a><span class="sd">            postseason (bool, optional): whether to analyze postseason gains or just regular season, defaults to True.  </span>
</span><span id="League-2179"><a href="#League-2179"><span class="linenos">2179</span></a><span class="sd">            verbose (bool, optional): whether to print out a status report as the code runs, defaults to True.  </span>
</span><span id="League-2180"><a href="#League-2180"><span class="linenos">2180</span></a><span class="sd">            payouts (list, optional): list of payout amounts for top three finishers, defaults to [800, 300, 100].  </span>
</span><span id="League-2181"><a href="#League-2181"><span class="linenos">2181</span></a><span class="sd">            bestball (bool, optional): whether to use best ball settings during simulation, defaults to False.</span>
</span><span id="League-2182"><a href="#League-2182"><span class="linenos">2182</span></a>
</span><span id="League-2183"><a href="#League-2183"><span class="linenos">2183</span></a><span class="sd">        Returns:</span>
</span><span id="League-2184"><a href="#League-2184"><span class="linenos">2184</span></a><span class="sd">            pd.DataFrame: dataframe containing the impact and value of every add &amp; drop combination analyzed.</span>
</span><span id="League-2185"><a href="#League-2185"><span class="linenos">2185</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="League-2186"><a href="#League-2186"><span class="linenos">2186</span></a>        <span class="n">as_of</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">season</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">week</span>
</span><span id="League-2187"><a href="#League-2187"><span class="linenos">2187</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_oauth</span><span class="p">()</span>
</span><span id="League-2188"><a href="#League-2188"><span class="linenos">2188</span></a>        <span class="k">if</span> <span class="n">bestball</span><span class="p">:</span>
</span><span id="League-2189"><a href="#League-2189"><span class="linenos">2189</span></a>            <span class="n">orig_standings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bestball_sims</span><span class="p">(</span><span class="n">payouts</span><span class="p">)</span>
</span><span id="League-2190"><a href="#League-2190"><span class="linenos">2190</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="League-2191"><a href="#League-2191"><span class="linenos">2191</span></a>            <span class="n">orig_standings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">season_sims</span><span class="p">(</span><span class="n">postseason</span><span class="p">,</span> <span class="n">payouts</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="League-2192"><a href="#League-2192"><span class="linenos">2192</span></a>        <span class="n">added_value</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span><span id="League-2193"><a href="#League-2193"><span class="linenos">2193</span></a>            <span class="n">columns</span><span class="o">=</span><span class="p">[</span>
</span><span id="League-2194"><a href="#League-2194"><span class="linenos">2194</span></a>                <span class="s2">&quot;player_to_drop&quot;</span><span class="p">,</span>
</span><span id="League-2195"><a href="#League-2195"><span class="linenos">2195</span></a>                <span class="s2">&quot;player_to_add&quot;</span><span class="p">,</span>
</span><span id="League-2196"><a href="#League-2196"><span class="linenos">2196</span></a>                <span class="s2">&quot;wins_avg&quot;</span><span class="p">,</span>
</span><span id="League-2197"><a href="#League-2197"><span class="linenos">2197</span></a>                <span class="s2">&quot;wins_stdev&quot;</span><span class="p">,</span>
</span><span id="League-2198"><a href="#League-2198"><span class="linenos">2198</span></a>                <span class="s2">&quot;points_avg&quot;</span><span class="p">,</span>
</span><span id="League-2199"><a href="#League-2199"><span class="linenos">2199</span></a>                <span class="s2">&quot;points_stdev&quot;</span><span class="p">,</span>
</span><span id="League-2200"><a href="#League-2200"><span class="linenos">2200</span></a>                <span class="s2">&quot;per_game_avg&quot;</span><span class="p">,</span>
</span><span id="League-2201"><a href="#League-2201"><span class="linenos">2201</span></a>                <span class="s2">&quot;per_game_stdev&quot;</span><span class="p">,</span>
</span><span id="League-2202"><a href="#League-2202"><span class="linenos">2202</span></a>                <span class="s2">&quot;per_game_fano&quot;</span><span class="p">,</span>
</span><span id="League-2203"><a href="#League-2203"><span class="linenos">2203</span></a>                <span class="s2">&quot;playoffs&quot;</span><span class="p">,</span>
</span><span id="League-2204"><a href="#League-2204"><span class="linenos">2204</span></a>                <span class="s2">&quot;playoff_bye&quot;</span><span class="p">,</span>
</span><span id="League-2205"><a href="#League-2205"><span class="linenos">2205</span></a>            <span class="p">]</span>
</span><span id="League-2206"><a href="#League-2206"><span class="linenos">2206</span></a>            <span class="o">+</span> <span class="p">(</span>
</span><span id="League-2207"><a href="#League-2207"><span class="linenos">2207</span></a>                <span class="p">[</span><span class="s2">&quot;winner&quot;</span><span class="p">,</span> <span class="s2">&quot;runner_up&quot;</span><span class="p">,</span> <span class="s2">&quot;third&quot;</span><span class="p">,</span> <span class="s2">&quot;earnings&quot;</span><span class="p">]</span>
</span><span id="League-2208"><a href="#League-2208"><span class="linenos">2208</span></a>                <span class="o">+</span> <span class="p">(</span>
</span><span id="League-2209"><a href="#League-2209"><span class="linenos">2209</span></a>                    <span class="p">[</span><span class="s2">&quot;many_mile&quot;</span><span class="p">]</span>
</span><span id="League-2210"><a href="#League-2210"><span class="linenos">2210</span></a>                    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">team_1</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;The Algorithm&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
</span><span id="League-2211"><a href="#League-2211"><span class="linenos">2211</span></a>                    <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">team_2</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;The Algorithm&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">())</span> \
</span><span id="League-2212"><a href="#League-2212"><span class="linenos">2212</span></a>                    <span class="ow">and</span> <span class="ow">not</span> <span class="n">bestball</span> <span class="k">else</span> <span class="p">[]</span>
</span><span id="League-2213"><a href="#League-2213"><span class="linenos">2213</span></a>                <span class="p">)</span>
</span><span id="League-2214"><a href="#League-2214"><span class="linenos">2214</span></a>                <span class="k">if</span> <span class="n">postseason</span>
</span><span id="League-2215"><a href="#League-2215"><span class="linenos">2215</span></a>                <span class="k">else</span> <span class="p">[]</span>
</span><span id="League-2216"><a href="#League-2216"><span class="linenos">2216</span></a>            <span class="p">)</span>
</span><span id="League-2217"><a href="#League-2217"><span class="linenos">2217</span></a>        <span class="p">)</span>
</span><span id="League-2218"><a href="#League-2218"><span class="linenos">2218</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">team_name</span><span class="p">:</span>
</span><span id="League-2219"><a href="#League-2219"><span class="linenos">2219</span></a>            <span class="n">team_name</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="League-2220"><a href="#League-2220"><span class="linenos">2220</span></a>                <span class="n">team</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
</span><span id="League-2221"><a href="#League-2221"><span class="linenos">2221</span></a>                <span class="k">for</span> <span class="n">team</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">teams</span>
</span><span id="League-2222"><a href="#League-2222"><span class="linenos">2222</span></a>                <span class="k">if</span> <span class="n">team</span><span class="p">[</span><span class="s2">&quot;team_key&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">lg</span><span class="o">.</span><span class="n">team_key</span><span class="p">()</span>
</span><span id="League-2223"><a href="#League-2223"><span class="linenos">2223</span></a>            <span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League-2224"><a href="#League-2224"><span class="linenos">2224</span></a>        <span class="n">players_to_drop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">fantasy_team</span> <span class="o">==</span> <span class="n">team_name</span><span class="p">]</span>
</span><span id="League-2225"><a href="#League-2225"><span class="linenos">2225</span></a>        <span class="k">if</span> <span class="n">players_to_drop</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">focus_on</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="League-2226"><a href="#League-2226"><span class="linenos">2226</span></a>            <span class="n">players_to_drop</span> <span class="o">=</span> <span class="n">players_to_drop</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">players_to_drop</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">focus_on</span><span class="p">)]</span>
</span><span id="League-2227"><a href="#League-2227"><span class="linenos">2227</span></a>        <span class="k">if</span> <span class="n">players_to_drop</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">exclude</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="League-2228"><a href="#League-2228"><span class="linenos">2228</span></a>            <span class="n">players_to_drop</span> <span class="o">=</span> <span class="n">players_to_drop</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">players_to_drop</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">exclude</span><span class="p">)]</span>
</span><span id="League-2229"><a href="#League-2229"><span class="linenos">2229</span></a>        <span class="n">available</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">fantasy_team</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span> \
</span><span id="League-2230"><a href="#League-2230"><span class="linenos">2230</span></a>        <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">until</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span> <span class="o">|</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">until</span> <span class="o">&lt;</span> <span class="mi">17</span><span class="p">))</span> \
</span><span id="League-2231"><a href="#League-2231"><span class="linenos">2231</span></a>        <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">pct_rostered</span> <span class="o">&gt;=</span> <span class="n">min_rostership</span><span class="p">)]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="League-2232"><a href="#League-2232"><span class="linenos">2232</span></a>        <span class="k">for</span> <span class="n">my_player</span> <span class="ow">in</span> <span class="n">players_to_drop</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
</span><span id="League-2233"><a href="#League-2233"><span class="linenos">2233</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">refresh_oauth</span><span class="p">(</span><span class="mi">55</span><span class="p">)</span>
</span><span id="League-2234"><a href="#League-2234"><span class="linenos">2234</span></a>            <span class="k">if</span> <span class="p">(</span>
</span><span id="League-2235"><a href="#League-2235"><span class="linenos">2235</span></a>                <span class="n">players_to_drop</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">players_to_drop</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">my_player</span><span class="p">,</span> <span class="s2">&quot;until&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span>
</span><span id="League-2236"><a href="#League-2236"><span class="linenos">2236</span></a>                    <span class="mi">0</span>
</span><span id="League-2237"><a href="#League-2237"><span class="linenos">2237</span></a>                <span class="p">]</span>
</span><span id="League-2238"><a href="#League-2238"><span class="linenos">2238</span></a>                <span class="o">&gt;=</span> <span class="n">as_of</span> <span class="o">%</span> <span class="mi">100</span>
</span><span id="League-2239"><a href="#League-2239"><span class="linenos">2239</span></a>            <span class="p">):</span>
</span><span id="League-2240"><a href="#League-2240"><span class="linenos">2240</span></a>                <span class="n">possible</span> <span class="o">=</span> <span class="n">available</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">available</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;Average_&quot;</span><span class="p">)]</span>
</span><span id="League-2241"><a href="#League-2241"><span class="linenos">2241</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="League-2242"><a href="#League-2242"><span class="linenos">2242</span></a>                <span class="n">possible</span> <span class="o">=</span> <span class="n">available</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League-2243"><a href="#League-2243"><span class="linenos">2243</span></a>                    <span class="o">~</span><span class="n">available</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;Average_&quot;</span><span class="p">)</span>
</span><span id="League-2244"><a href="#League-2244"><span class="linenos">2244</span></a>                    <span class="o">&amp;</span> <span class="p">(</span>
</span><span id="League-2245"><a href="#League-2245"><span class="linenos">2245</span></a>                        <span class="n">available</span><span class="o">.</span><span class="n">WAR</span>
</span><span id="League-2246"><a href="#League-2246"><span class="linenos">2246</span></a>                        <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League-2247"><a href="#League-2247"><span class="linenos">2247</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">my_player</span><span class="p">,</span> <span class="s2">&quot;WAR&quot;</span>
</span><span id="League-2248"><a href="#League-2248"><span class="linenos">2248</span></a>                        <span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League-2249"><a href="#League-2249"><span class="linenos">2249</span></a>                        <span class="o">-</span> <span class="mf">0.5</span>
</span><span id="League-2250"><a href="#League-2250"><span class="linenos">2250</span></a>                    <span class="p">)</span>
</span><span id="League-2251"><a href="#League-2251"><span class="linenos">2251</span></a>                <span class="p">]</span>
</span><span id="League-2252"><a href="#League-2252"><span class="linenos">2252</span></a>            <span class="k">if</span> <span class="n">available</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">focus_on</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="League-2253"><a href="#League-2253"><span class="linenos">2253</span></a>                <span class="n">possible</span> <span class="o">=</span> <span class="n">possible</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">possible</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">focus_on</span><span class="p">)]</span>
</span><span id="League-2254"><a href="#League-2254"><span class="linenos">2254</span></a>            <span class="k">if</span> <span class="n">possible</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">exclude</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="League-2255"><a href="#League-2255"><span class="linenos">2255</span></a>                <span class="n">possible</span> <span class="o">=</span> <span class="n">possible</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">possible</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">exclude</span><span class="p">)]</span>
</span><span id="League-2256"><a href="#League-2256"><span class="linenos">2256</span></a>            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="League-2257"><a href="#League-2257"><span class="linenos">2257</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">my_player</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">possible</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; better players&quot;</span><span class="p">)</span>
</span><span id="League-2258"><a href="#League-2258"><span class="linenos">2258</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">())</span>
</span><span id="League-2259"><a href="#League-2259"><span class="linenos">2259</span></a>            <span class="n">possible</span> <span class="o">=</span> <span class="n">possible</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;position&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">limit_per</span><span class="p">)</span>
</span><span id="League-2260"><a href="#League-2260"><span class="linenos">2260</span></a>            <span class="k">for</span> <span class="n">free_agent</span> <span class="ow">in</span> <span class="n">possible</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
</span><span id="League-2261"><a href="#League-2261"><span class="linenos">2261</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">my_player</span><span class="p">,</span> <span class="s2">&quot;fantasy_team&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="League-2262"><a href="#League-2262"><span class="linenos">2262</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League-2263"><a href="#League-2263"><span class="linenos">2263</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">free_agent</span><span class="p">,</span> <span class="s2">&quot;fantasy_team&quot;</span>
</span><span id="League-2264"><a href="#League-2264"><span class="linenos">2264</span></a>                <span class="p">]</span> <span class="o">=</span> <span class="n">team_name</span>
</span><span id="League-2265"><a href="#League-2265"><span class="linenos">2265</span></a>                <span class="k">if</span> <span class="n">bestball</span><span class="p">:</span>
</span><span id="League-2266"><a href="#League-2266"><span class="linenos">2266</span></a>                    <span class="n">new_standings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bestball_sims</span><span class="p">(</span><span class="n">payouts</span><span class="p">)</span>
</span><span id="League-2267"><a href="#League-2267"><span class="linenos">2267</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="League-2268"><a href="#League-2268"><span class="linenos">2268</span></a>                    <span class="n">new_standings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">season_sims</span><span class="p">(</span><span class="n">postseason</span><span class="p">,</span> <span class="n">payouts</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="League-2269"><a href="#League-2269"><span class="linenos">2269</span></a>                <span class="n">added_value</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">added_value</span><span class="p">,</span>
</span><span id="League-2270"><a href="#League-2270"><span class="linenos">2270</span></a>                    <span class="n">new_standings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">new_standings</span><span class="o">.</span><span class="n">team</span> <span class="o">==</span> <span class="n">team_name</span><span class="p">]],</span>
</span><span id="League-2271"><a href="#League-2271"><span class="linenos">2271</span></a>                    <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="League-2272"><a href="#League-2272"><span class="linenos">2272</span></a>                    <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="League-2273"><a href="#League-2273"><span class="linenos">2273</span></a>                <span class="p">)</span>
</span><span id="League-2274"><a href="#League-2274"><span class="linenos">2274</span></a>                <span class="n">added_value</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">added_value</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;player_to_drop&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">my_player</span>
</span><span id="League-2275"><a href="#League-2275"><span class="linenos">2275</span></a>                <span class="n">added_value</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">added_value</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;player_to_add&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">free_agent</span>
</span><span id="League-2276"><a href="#League-2276"><span class="linenos">2276</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League-2277"><a href="#League-2277"><span class="linenos">2277</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">my_player</span><span class="p">,</span> <span class="s2">&quot;fantasy_team&quot;</span>
</span><span id="League-2278"><a href="#League-2278"><span class="linenos">2278</span></a>                <span class="p">]</span> <span class="o">=</span> <span class="n">team_name</span>
</span><span id="League-2279"><a href="#League-2279"><span class="linenos">2279</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">free_agent</span><span class="p">,</span> <span class="s2">&quot;fantasy_team&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="League-2280"><a href="#League-2280"><span class="linenos">2280</span></a>            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="League-2281"><a href="#League-2281"><span class="linenos">2281</span></a>                <span class="n">temp</span> <span class="o">=</span> <span class="n">added_value</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">possible</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">:][</span>
</span><span id="League-2282"><a href="#League-2282"><span class="linenos">2282</span></a>                    <span class="p">[</span><span class="s2">&quot;player_to_drop&quot;</span><span class="p">,</span> <span class="s2">&quot;player_to_add&quot;</span><span class="p">,</span> <span class="s2">&quot;earnings&quot;</span><span class="p">]</span>
</span><span id="League-2283"><a href="#League-2283"><span class="linenos">2283</span></a>                <span class="p">]</span>
</span><span id="League-2284"><a href="#League-2284"><span class="linenos">2284</span></a>                <span class="n">temp</span><span class="p">[</span><span class="s2">&quot;earnings&quot;</span><span class="p">]</span> <span class="o">-=</span> <span class="n">orig_standings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League-2285"><a href="#League-2285"><span class="linenos">2285</span></a>                    <span class="n">orig_standings</span><span class="o">.</span><span class="n">team</span> <span class="o">==</span> <span class="n">team_name</span><span class="p">,</span> <span class="s2">&quot;earnings&quot;</span>
</span><span id="League-2286"><a href="#League-2286"><span class="linenos">2286</span></a>                <span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League-2287"><a href="#League-2287"><span class="linenos">2287</span></a>                <span class="k">if</span> <span class="n">temp</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="League-2288"><a href="#League-2288"><span class="linenos">2288</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="League-2289"><a href="#League-2289"><span class="linenos">2289</span></a>                        <span class="n">temp</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;earnings&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span>
</span><span id="League-2290"><a href="#League-2290"><span class="linenos">2290</span></a>                            <span class="n">index</span><span class="o">=</span><span class="kc">False</span>
</span><span id="League-2291"><a href="#League-2291"><span class="linenos">2291</span></a>                        <span class="p">)</span>
</span><span id="League-2292"><a href="#League-2292"><span class="linenos">2292</span></a>                    <span class="p">)</span>
</span><span id="League-2293"><a href="#League-2293"><span class="linenos">2293</span></a>                <span class="k">del</span> <span class="n">temp</span>
</span><span id="League-2294"><a href="#League-2294"><span class="linenos">2294</span></a>        <span class="k">if</span> <span class="n">added_value</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="League-2295"><a href="#League-2295"><span class="linenos">2295</span></a>            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="League-2296"><a href="#League-2296"><span class="linenos">2296</span></a>                <span class="s2">&quot;wins_avg&quot;</span><span class="p">,</span>
</span><span id="League-2297"><a href="#League-2297"><span class="linenos">2297</span></a>                <span class="s2">&quot;wins_stdev&quot;</span><span class="p">,</span>
</span><span id="League-2298"><a href="#League-2298"><span class="linenos">2298</span></a>                <span class="s2">&quot;points_avg&quot;</span><span class="p">,</span>
</span><span id="League-2299"><a href="#League-2299"><span class="linenos">2299</span></a>                <span class="s2">&quot;points_stdev&quot;</span><span class="p">,</span>
</span><span id="League-2300"><a href="#League-2300"><span class="linenos">2300</span></a>                <span class="s2">&quot;playoffs&quot;</span><span class="p">,</span>
</span><span id="League-2301"><a href="#League-2301"><span class="linenos">2301</span></a>                <span class="s2">&quot;playoff_bye&quot;</span><span class="p">,</span>
</span><span id="League-2302"><a href="#League-2302"><span class="linenos">2302</span></a>            <span class="p">]</span> <span class="o">+</span> <span class="p">(</span>
</span><span id="League-2303"><a href="#League-2303"><span class="linenos">2303</span></a>                <span class="p">[</span><span class="s2">&quot;winner&quot;</span><span class="p">,</span> <span class="s2">&quot;runner_up&quot;</span><span class="p">,</span> <span class="s2">&quot;third&quot;</span><span class="p">,</span> <span class="s2">&quot;earnings&quot;</span><span class="p">]</span>
</span><span id="League-2304"><a href="#League-2304"><span class="linenos">2304</span></a>                <span class="o">+</span> <span class="p">(</span>
</span><span id="League-2305"><a href="#League-2305"><span class="linenos">2305</span></a>                    <span class="p">[</span><span class="s2">&quot;many_mile&quot;</span><span class="p">]</span>
</span><span id="League-2306"><a href="#League-2306"><span class="linenos">2306</span></a>                    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">team_1</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;The Algorithm&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
</span><span id="League-2307"><a href="#League-2307"><span class="linenos">2307</span></a>                    <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">team_2</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;The Algorithm&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">())</span> \
</span><span id="League-2308"><a href="#League-2308"><span class="linenos">2308</span></a>                    <span class="ow">and</span> <span class="ow">not</span> <span class="n">bestball</span> <span class="k">else</span> <span class="p">[]</span>
</span><span id="League-2309"><a href="#League-2309"><span class="linenos">2309</span></a>                <span class="p">)</span>
</span><span id="League-2310"><a href="#League-2310"><span class="linenos">2310</span></a>                <span class="k">if</span> <span class="n">postseason</span>
</span><span id="League-2311"><a href="#League-2311"><span class="linenos">2311</span></a>                <span class="k">else</span> <span class="p">[]</span>
</span><span id="League-2312"><a href="#League-2312"><span class="linenos">2312</span></a>            <span class="p">):</span>
</span><span id="League-2313"><a href="#League-2313"><span class="linenos">2313</span></a>                <span class="n">added_value</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">-=</span> <span class="n">orig_standings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League-2314"><a href="#League-2314"><span class="linenos">2314</span></a>                    <span class="n">orig_standings</span><span class="o">.</span><span class="n">team</span> <span class="o">==</span> <span class="n">team_name</span><span class="p">,</span> <span class="n">col</span>
</span><span id="League-2315"><a href="#League-2315"><span class="linenos">2315</span></a>                <span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League-2316"><a href="#League-2316"><span class="linenos">2316</span></a>                <span class="n">added_value</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">added_value</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="mi">4</span><span class="p">)</span>
</span><span id="League-2317"><a href="#League-2317"><span class="linenos">2317</span></a>            <span class="n">added_value</span> <span class="o">=</span> <span class="n">added_value</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
</span><span id="League-2318"><a href="#League-2318"><span class="linenos">2318</span></a>                <span class="n">by</span><span class="o">=</span><span class="s2">&quot;winner&quot;</span> <span class="k">if</span> <span class="n">postseason</span> <span class="k">else</span> <span class="s2">&quot;playoffs&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span>
</span><span id="League-2319"><a href="#League-2319"><span class="linenos">2319</span></a>            <span class="p">)</span>
</span><span id="League-2320"><a href="#League-2320"><span class="linenos">2320</span></a>        <span class="k">return</span> <span class="n">added_value</span>
</span><span id="League-2321"><a href="#League-2321"><span class="linenos">2321</span></a>
</span><span id="League-2322"><a href="#League-2322"><span class="linenos">2322</span></a>    <span class="k">def</span> <span class="nf">possible_adds</span><span class="p">(</span>
</span><span id="League-2323"><a href="#League-2323"><span class="linenos">2323</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="League-2324"><a href="#League-2324"><span class="linenos">2324</span></a>        <span class="n">focus_on</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[],</span>
</span><span id="League-2325"><a href="#League-2325"><span class="linenos">2325</span></a>        <span class="n">exclude</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[],</span>
</span><span id="League-2326"><a href="#League-2326"><span class="linenos">2326</span></a>        <span class="n">limit_per</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="League-2327"><a href="#League-2327"><span class="linenos">2327</span></a>        <span class="n">team_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="League-2328"><a href="#League-2328"><span class="linenos">2328</span></a>        <span class="n">postseason</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="League-2329"><a href="#League-2329"><span class="linenos">2329</span></a>        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="League-2330"><a href="#League-2330"><span class="linenos">2330</span></a>        <span class="n">payouts</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">800</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
</span><span id="League-2331"><a href="#League-2331"><span class="linenos">2331</span></a>        <span class="n">bestball</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="League-2332"><a href="#League-2332"><span class="linenos">2332</span></a>        <span class="n">min_rostership</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span>
</span><span id="League-2333"><a href="#League-2333"><span class="linenos">2333</span></a>    <span class="p">):</span>
</span><span id="League-2334"><a href="#League-2334"><span class="linenos">2334</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="League-2335"><a href="#League-2335"><span class="linenos">2335</span></a><span class="sd">        Simulates the remainder of the season with the current roster and compares it to </span>
</span><span id="League-2336"><a href="#League-2336"><span class="linenos">2336</span></a><span class="sd">        a simulation of the roster after a series of potential add transactions.</span>
</span><span id="League-2337"><a href="#League-2337"><span class="linenos">2337</span></a>
</span><span id="League-2338"><a href="#League-2338"><span class="linenos">2338</span></a><span class="sd">        Args:</span>
</span><span id="League-2339"><a href="#League-2339"><span class="linenos">2339</span></a><span class="sd">            focus_on (list, optional): list of players to include in every potential trade, defaults to [].  </span>
</span><span id="League-2340"><a href="#League-2340"><span class="linenos">2340</span></a><span class="sd">            exclude (list, optional): list of players to exclude from every potential trade, defaults to [].  </span>
</span><span id="League-2341"><a href="#League-2341"><span class="linenos">2341</span></a><span class="sd">            limit_per (int, optional): number of players per position to analyze, defaults to 10.  </span>
</span><span id="League-2342"><a href="#League-2342"><span class="linenos">2342</span></a><span class="sd">            team_name (str, optional): name of team to analyze trades for, defaults to None (and therefore team of interest).  </span>
</span><span id="League-2343"><a href="#League-2343"><span class="linenos">2343</span></a><span class="sd">            postseason (bool, optional): whether to analyze postseason gains or just regular season, defaults to True.  </span>
</span><span id="League-2344"><a href="#League-2344"><span class="linenos">2344</span></a><span class="sd">            verbose (bool, optional): whether to print out a status report as the code runs, defaults to True.  </span>
</span><span id="League-2345"><a href="#League-2345"><span class="linenos">2345</span></a><span class="sd">            payouts (list, optional): list of payout amounts for top three finishers, defaults to [800, 300, 100].  </span>
</span><span id="League-2346"><a href="#League-2346"><span class="linenos">2346</span></a><span class="sd">            bestball (bool, optional): whether to use best ball settings during simulation, defaults to False.</span>
</span><span id="League-2347"><a href="#League-2347"><span class="linenos">2347</span></a>
</span><span id="League-2348"><a href="#League-2348"><span class="linenos">2348</span></a><span class="sd">        Returns:</span>
</span><span id="League-2349"><a href="#League-2349"><span class="linenos">2349</span></a><span class="sd">            pd.DataFrame: dataframe containing the impact and value of every possible add analyzed.</span>
</span><span id="League-2350"><a href="#League-2350"><span class="linenos">2350</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="League-2351"><a href="#League-2351"><span class="linenos">2351</span></a>        <span class="n">as_of</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">season</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">week</span>
</span><span id="League-2352"><a href="#League-2352"><span class="linenos">2352</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_oauth</span><span class="p">()</span>
</span><span id="League-2353"><a href="#League-2353"><span class="linenos">2353</span></a>        <span class="k">if</span> <span class="n">bestball</span><span class="p">:</span>
</span><span id="League-2354"><a href="#League-2354"><span class="linenos">2354</span></a>            <span class="n">orig_standings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bestball_sims</span><span class="p">(</span><span class="n">payouts</span><span class="p">)</span>
</span><span id="League-2355"><a href="#League-2355"><span class="linenos">2355</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="League-2356"><a href="#League-2356"><span class="linenos">2356</span></a>            <span class="n">orig_standings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">season_sims</span><span class="p">(</span><span class="n">postseason</span><span class="p">,</span> <span class="n">payouts</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="League-2357"><a href="#League-2357"><span class="linenos">2357</span></a>        <span class="n">added_value</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span><span id="League-2358"><a href="#League-2358"><span class="linenos">2358</span></a>            <span class="n">columns</span><span class="o">=</span><span class="p">[</span>
</span><span id="League-2359"><a href="#League-2359"><span class="linenos">2359</span></a>                <span class="s2">&quot;player_to_add&quot;</span><span class="p">,</span>
</span><span id="League-2360"><a href="#League-2360"><span class="linenos">2360</span></a>                <span class="s2">&quot;wins_avg&quot;</span><span class="p">,</span>
</span><span id="League-2361"><a href="#League-2361"><span class="linenos">2361</span></a>                <span class="s2">&quot;wins_stdev&quot;</span><span class="p">,</span>
</span><span id="League-2362"><a href="#League-2362"><span class="linenos">2362</span></a>                <span class="s2">&quot;points_avg&quot;</span><span class="p">,</span>
</span><span id="League-2363"><a href="#League-2363"><span class="linenos">2363</span></a>                <span class="s2">&quot;points_stdev&quot;</span><span class="p">,</span>
</span><span id="League-2364"><a href="#League-2364"><span class="linenos">2364</span></a>                <span class="s2">&quot;per_game_avg&quot;</span><span class="p">,</span>
</span><span id="League-2365"><a href="#League-2365"><span class="linenos">2365</span></a>                <span class="s2">&quot;per_game_stdev&quot;</span><span class="p">,</span>
</span><span id="League-2366"><a href="#League-2366"><span class="linenos">2366</span></a>                <span class="s2">&quot;per_game_fano&quot;</span><span class="p">,</span>
</span><span id="League-2367"><a href="#League-2367"><span class="linenos">2367</span></a>                <span class="s2">&quot;playoffs&quot;</span><span class="p">,</span>
</span><span id="League-2368"><a href="#League-2368"><span class="linenos">2368</span></a>                <span class="s2">&quot;playoff_bye&quot;</span><span class="p">,</span>
</span><span id="League-2369"><a href="#League-2369"><span class="linenos">2369</span></a>            <span class="p">]</span>
</span><span id="League-2370"><a href="#League-2370"><span class="linenos">2370</span></a>            <span class="o">+</span> <span class="p">(</span>
</span><span id="League-2371"><a href="#League-2371"><span class="linenos">2371</span></a>                <span class="p">[</span><span class="s2">&quot;winner&quot;</span><span class="p">,</span> <span class="s2">&quot;runner_up&quot;</span><span class="p">,</span> <span class="s2">&quot;third&quot;</span><span class="p">,</span> <span class="s2">&quot;earnings&quot;</span><span class="p">]</span>
</span><span id="League-2372"><a href="#League-2372"><span class="linenos">2372</span></a>                <span class="o">+</span> <span class="p">(</span>
</span><span id="League-2373"><a href="#League-2373"><span class="linenos">2373</span></a>                    <span class="p">[</span><span class="s2">&quot;many_mile&quot;</span><span class="p">]</span>
</span><span id="League-2374"><a href="#League-2374"><span class="linenos">2374</span></a>                    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">team_1</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;The Algorithm&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
</span><span id="League-2375"><a href="#League-2375"><span class="linenos">2375</span></a>                    <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">team_2</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;The Algorithm&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">())</span> \
</span><span id="League-2376"><a href="#League-2376"><span class="linenos">2376</span></a>                    <span class="ow">and</span> <span class="ow">not</span> <span class="n">bestball</span> <span class="k">else</span> <span class="p">[]</span>
</span><span id="League-2377"><a href="#League-2377"><span class="linenos">2377</span></a>                <span class="p">)</span>
</span><span id="League-2378"><a href="#League-2378"><span class="linenos">2378</span></a>                <span class="k">if</span> <span class="n">postseason</span>
</span><span id="League-2379"><a href="#League-2379"><span class="linenos">2379</span></a>                <span class="k">else</span> <span class="p">[]</span>
</span><span id="League-2380"><a href="#League-2380"><span class="linenos">2380</span></a>            <span class="p">)</span>
</span><span id="League-2381"><a href="#League-2381"><span class="linenos">2381</span></a>        <span class="p">)</span>
</span><span id="League-2382"><a href="#League-2382"><span class="linenos">2382</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">team_name</span><span class="p">:</span>
</span><span id="League-2383"><a href="#League-2383"><span class="linenos">2383</span></a>            <span class="n">team_name</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="League-2384"><a href="#League-2384"><span class="linenos">2384</span></a>                <span class="n">team</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
</span><span id="League-2385"><a href="#League-2385"><span class="linenos">2385</span></a>                <span class="k">for</span> <span class="n">team</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">teams</span>
</span><span id="League-2386"><a href="#League-2386"><span class="linenos">2386</span></a>                <span class="k">if</span> <span class="n">team</span><span class="p">[</span><span class="s2">&quot;team_key&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">lg</span><span class="o">.</span><span class="n">team_key</span><span class="p">()</span>
</span><span id="League-2387"><a href="#League-2387"><span class="linenos">2387</span></a>            <span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League-2388"><a href="#League-2388"><span class="linenos">2388</span></a>        <span class="n">available</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">fantasy_team</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span> \
</span><span id="League-2389"><a href="#League-2389"><span class="linenos">2389</span></a>        <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">until</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span> <span class="o">|</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">until</span> <span class="o">&lt;</span> <span class="mi">17</span><span class="p">))</span> \
</span><span id="League-2390"><a href="#League-2390"><span class="linenos">2390</span></a>        <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">pct_rostered</span> <span class="o">&gt;=</span> <span class="n">min_rostership</span><span class="p">)]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="League-2391"><a href="#League-2391"><span class="linenos">2391</span></a>        <span class="n">possible</span> <span class="o">=</span> <span class="n">available</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">available</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;Average_&quot;</span><span class="p">)]</span>
</span><span id="League-2392"><a href="#League-2392"><span class="linenos">2392</span></a>        <span class="k">if</span> <span class="n">possible</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">focus_on</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="League-2393"><a href="#League-2393"><span class="linenos">2393</span></a>            <span class="n">possible</span> <span class="o">=</span> <span class="n">possible</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">possible</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">focus_on</span><span class="p">)]</span>
</span><span id="League-2394"><a href="#League-2394"><span class="linenos">2394</span></a>        <span class="k">if</span> <span class="n">possible</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">exclude</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="League-2395"><a href="#League-2395"><span class="linenos">2395</span></a>            <span class="n">possible</span> <span class="o">=</span> <span class="n">possible</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">possible</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">exclude</span><span class="p">)]</span>
</span><span id="League-2396"><a href="#League-2396"><span class="linenos">2396</span></a>        <span class="n">possible</span> <span class="o">=</span> <span class="n">possible</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;position&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">limit_per</span><span class="p">)</span>
</span><span id="League-2397"><a href="#League-2397"><span class="linenos">2397</span></a>        <span class="k">for</span> <span class="n">free_agent</span> <span class="ow">in</span> <span class="n">possible</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
</span><span id="League-2398"><a href="#League-2398"><span class="linenos">2398</span></a>            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="League-2399"><a href="#League-2399"><span class="linenos">2399</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">, </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">free_agent</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()))</span>
</span><span id="League-2400"><a href="#League-2400"><span class="linenos">2400</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League-2401"><a href="#League-2401"><span class="linenos">2401</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">free_agent</span><span class="p">,</span> <span class="s2">&quot;fantasy_team&quot;</span>
</span><span id="League-2402"><a href="#League-2402"><span class="linenos">2402</span></a>            <span class="p">]</span> <span class="o">=</span> <span class="n">team_name</span>
</span><span id="League-2403"><a href="#League-2403"><span class="linenos">2403</span></a>            <span class="k">if</span> <span class="n">bestball</span><span class="p">:</span>
</span><span id="League-2404"><a href="#League-2404"><span class="linenos">2404</span></a>                <span class="n">new_standings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bestball_sims</span><span class="p">(</span><span class="n">payouts</span><span class="p">)</span>
</span><span id="League-2405"><a href="#League-2405"><span class="linenos">2405</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="League-2406"><a href="#League-2406"><span class="linenos">2406</span></a>                <span class="n">new_standings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">season_sims</span><span class="p">(</span><span class="n">postseason</span><span class="p">,</span> <span class="n">payouts</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="League-2407"><a href="#League-2407"><span class="linenos">2407</span></a>            <span class="n">added_value</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">added_value</span><span class="p">,</span>
</span><span id="League-2408"><a href="#League-2408"><span class="linenos">2408</span></a>                <span class="n">new_standings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">new_standings</span><span class="o">.</span><span class="n">team</span> <span class="o">==</span> <span class="n">team_name</span><span class="p">]],</span>
</span><span id="League-2409"><a href="#League-2409"><span class="linenos">2409</span></a>                <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="League-2410"><a href="#League-2410"><span class="linenos">2410</span></a>                <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="League-2411"><a href="#League-2411"><span class="linenos">2411</span></a>            <span class="p">)</span>
</span><span id="League-2412"><a href="#League-2412"><span class="linenos">2412</span></a>            <span class="n">added_value</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">added_value</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;player_to_add&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">free_agent</span>
</span><span id="League-2413"><a href="#League-2413"><span class="linenos">2413</span></a>            <span class="n">added_value</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">added_value</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;position&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">possible</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League-2414"><a href="#League-2414"><span class="linenos">2414</span></a>                <span class="n">possible</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">free_agent</span><span class="p">,</span> <span class="s2">&quot;position&quot;</span>
</span><span id="League-2415"><a href="#League-2415"><span class="linenos">2415</span></a>            <span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League-2416"><a href="#League-2416"><span class="linenos">2416</span></a>            <span class="n">added_value</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">added_value</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;current_team&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">possible</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League-2417"><a href="#League-2417"><span class="linenos">2417</span></a>                <span class="n">possible</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">free_agent</span><span class="p">,</span> <span class="s2">&quot;current_team&quot;</span>
</span><span id="League-2418"><a href="#League-2418"><span class="linenos">2418</span></a>            <span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League-2419"><a href="#League-2419"><span class="linenos">2419</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">free_agent</span><span class="p">,</span> <span class="s2">&quot;fantasy_team&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="League-2420"><a href="#League-2420"><span class="linenos">2420</span></a>        <span class="k">if</span> <span class="n">added_value</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="League-2421"><a href="#League-2421"><span class="linenos">2421</span></a>            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="League-2422"><a href="#League-2422"><span class="linenos">2422</span></a>                <span class="s2">&quot;wins_avg&quot;</span><span class="p">,</span>
</span><span id="League-2423"><a href="#League-2423"><span class="linenos">2423</span></a>                <span class="s2">&quot;wins_stdev&quot;</span><span class="p">,</span>
</span><span id="League-2424"><a href="#League-2424"><span class="linenos">2424</span></a>                <span class="s2">&quot;points_avg&quot;</span><span class="p">,</span>
</span><span id="League-2425"><a href="#League-2425"><span class="linenos">2425</span></a>                <span class="s2">&quot;points_stdev&quot;</span><span class="p">,</span>
</span><span id="League-2426"><a href="#League-2426"><span class="linenos">2426</span></a>                <span class="s2">&quot;playoffs&quot;</span><span class="p">,</span>
</span><span id="League-2427"><a href="#League-2427"><span class="linenos">2427</span></a>                <span class="s2">&quot;playoff_bye&quot;</span><span class="p">,</span>
</span><span id="League-2428"><a href="#League-2428"><span class="linenos">2428</span></a>            <span class="p">]</span> <span class="o">+</span> <span class="p">(</span>
</span><span id="League-2429"><a href="#League-2429"><span class="linenos">2429</span></a>                <span class="p">[</span><span class="s2">&quot;winner&quot;</span><span class="p">,</span> <span class="s2">&quot;runner_up&quot;</span><span class="p">,</span> <span class="s2">&quot;third&quot;</span><span class="p">,</span> <span class="s2">&quot;earnings&quot;</span><span class="p">]</span>
</span><span id="League-2430"><a href="#League-2430"><span class="linenos">2430</span></a>                <span class="o">+</span> <span class="p">(</span>
</span><span id="League-2431"><a href="#League-2431"><span class="linenos">2431</span></a>                    <span class="p">[</span><span class="s2">&quot;many_mile&quot;</span><span class="p">]</span>
</span><span id="League-2432"><a href="#League-2432"><span class="linenos">2432</span></a>                    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">team_1</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;The Algorithm&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
</span><span id="League-2433"><a href="#League-2433"><span class="linenos">2433</span></a>                    <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">team_2</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;The Algorithm&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">())</span> \
</span><span id="League-2434"><a href="#League-2434"><span class="linenos">2434</span></a>                    <span class="ow">and</span> <span class="ow">not</span> <span class="n">bestball</span> <span class="k">else</span> <span class="p">[]</span>
</span><span id="League-2435"><a href="#League-2435"><span class="linenos">2435</span></a>                <span class="p">)</span>
</span><span id="League-2436"><a href="#League-2436"><span class="linenos">2436</span></a>                <span class="k">if</span> <span class="n">postseason</span>
</span><span id="League-2437"><a href="#League-2437"><span class="linenos">2437</span></a>                <span class="k">else</span> <span class="p">[]</span>
</span><span id="League-2438"><a href="#League-2438"><span class="linenos">2438</span></a>            <span class="p">):</span>
</span><span id="League-2439"><a href="#League-2439"><span class="linenos">2439</span></a>                <span class="n">added_value</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">-=</span> <span class="n">orig_standings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League-2440"><a href="#League-2440"><span class="linenos">2440</span></a>                    <span class="n">orig_standings</span><span class="o">.</span><span class="n">team</span> <span class="o">==</span> <span class="n">team_name</span><span class="p">,</span> <span class="n">col</span>
</span><span id="League-2441"><a href="#League-2441"><span class="linenos">2441</span></a>                <span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League-2442"><a href="#League-2442"><span class="linenos">2442</span></a>                <span class="n">added_value</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">added_value</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="mi">4</span><span class="p">)</span>
</span><span id="League-2443"><a href="#League-2443"><span class="linenos">2443</span></a>            <span class="n">added_value</span> <span class="o">=</span> <span class="n">added_value</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
</span><span id="League-2444"><a href="#League-2444"><span class="linenos">2444</span></a>                <span class="n">by</span><span class="o">=</span><span class="s2">&quot;winner&quot;</span> <span class="k">if</span> <span class="n">postseason</span> <span class="k">else</span> <span class="s2">&quot;playoffs&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span>
</span><span id="League-2445"><a href="#League-2445"><span class="linenos">2445</span></a>            <span class="p">)</span>
</span><span id="League-2446"><a href="#League-2446"><span class="linenos">2446</span></a>            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="League-2447"><a href="#League-2447"><span class="linenos">2447</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="League-2448"><a href="#League-2448"><span class="linenos">2448</span></a>                    <span class="n">added_value</span><span class="p">[[</span><span class="s2">&quot;player_to_add&quot;</span><span class="p">,</span> <span class="s2">&quot;earnings&quot;</span><span class="p">]]</span>
</span><span id="League-2449"><a href="#League-2449"><span class="linenos">2449</span></a>                    <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;earnings&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="League-2450"><a href="#League-2450"><span class="linenos">2450</span></a>                    <span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="League-2451"><a href="#League-2451"><span class="linenos">2451</span></a>                <span class="p">)</span>
</span><span id="League-2452"><a href="#League-2452"><span class="linenos">2452</span></a>        <span class="k">return</span> <span class="n">added_value</span>
</span><span id="League-2453"><a href="#League-2453"><span class="linenos">2453</span></a>
</span><span id="League-2454"><a href="#League-2454"><span class="linenos">2454</span></a>    <span class="k">def</span> <span class="nf">possible_drops</span><span class="p">(</span>
</span><span id="League-2455"><a href="#League-2455"><span class="linenos">2455</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="League-2456"><a href="#League-2456"><span class="linenos">2456</span></a>        <span class="n">focus_on</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[],</span>
</span><span id="League-2457"><a href="#League-2457"><span class="linenos">2457</span></a>        <span class="n">exclude</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[],</span>
</span><span id="League-2458"><a href="#League-2458"><span class="linenos">2458</span></a>        <span class="n">team_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="League-2459"><a href="#League-2459"><span class="linenos">2459</span></a>        <span class="n">postseason</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="League-2460"><a href="#League-2460"><span class="linenos">2460</span></a>        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="League-2461"><a href="#League-2461"><span class="linenos">2461</span></a>        <span class="n">payouts</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">800</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
</span><span id="League-2462"><a href="#League-2462"><span class="linenos">2462</span></a>        <span class="n">bestball</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="League-2463"><a href="#League-2463"><span class="linenos">2463</span></a>    <span class="p">):</span>
</span><span id="League-2464"><a href="#League-2464"><span class="linenos">2464</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="League-2465"><a href="#League-2465"><span class="linenos">2465</span></a><span class="sd">        Simulates the remainder of the season with the current roster and compares it to </span>
</span><span id="League-2466"><a href="#League-2466"><span class="linenos">2466</span></a><span class="sd">        a simulation of the roster after a series of potential drop transactions.</span>
</span><span id="League-2467"><a href="#League-2467"><span class="linenos">2467</span></a>
</span><span id="League-2468"><a href="#League-2468"><span class="linenos">2468</span></a><span class="sd">        Args:</span>
</span><span id="League-2469"><a href="#League-2469"><span class="linenos">2469</span></a><span class="sd">            focus_on (list, optional): list of players to include in every potential trade, defaults to [].  </span>
</span><span id="League-2470"><a href="#League-2470"><span class="linenos">2470</span></a><span class="sd">            exclude (list, optional): list of players to exclude from every potential trade, defaults to [].  </span>
</span><span id="League-2471"><a href="#League-2471"><span class="linenos">2471</span></a><span class="sd">            team_name (str, optional): name of team to analyze trades for, defaults to None (and therefore team of interest).  </span>
</span><span id="League-2472"><a href="#League-2472"><span class="linenos">2472</span></a><span class="sd">            postseason (bool, optional): whether to analyze postseason gains or just regular season, defaults to True.  </span>
</span><span id="League-2473"><a href="#League-2473"><span class="linenos">2473</span></a><span class="sd">            verbose (bool, optional): whether to print out a status report as the code runs, defaults to True.  </span>
</span><span id="League-2474"><a href="#League-2474"><span class="linenos">2474</span></a><span class="sd">            payouts (list, optional): list of payout amounts for top three finishers, defaults to [800, 300, 100].  </span>
</span><span id="League-2475"><a href="#League-2475"><span class="linenos">2475</span></a><span class="sd">            bestball (bool, optional): whether to use best ball settings during simulation, defaults to False.</span>
</span><span id="League-2476"><a href="#League-2476"><span class="linenos">2476</span></a>
</span><span id="League-2477"><a href="#League-2477"><span class="linenos">2477</span></a><span class="sd">        Returns:</span>
</span><span id="League-2478"><a href="#League-2478"><span class="linenos">2478</span></a><span class="sd">            pd.DataFrame: dataframe containing the impact and value of every possible drop analyzed.</span>
</span><span id="League-2479"><a href="#League-2479"><span class="linenos">2479</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="League-2480"><a href="#League-2480"><span class="linenos">2480</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_oauth</span><span class="p">()</span>
</span><span id="League-2481"><a href="#League-2481"><span class="linenos">2481</span></a>        <span class="k">if</span> <span class="n">bestball</span><span class="p">:</span>
</span><span id="League-2482"><a href="#League-2482"><span class="linenos">2482</span></a>            <span class="n">orig_standings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bestball_sims</span><span class="p">(</span><span class="n">payouts</span><span class="p">)</span>
</span><span id="League-2483"><a href="#League-2483"><span class="linenos">2483</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="League-2484"><a href="#League-2484"><span class="linenos">2484</span></a>            <span class="n">orig_standings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">season_sims</span><span class="p">(</span><span class="n">postseason</span><span class="p">,</span> <span class="n">payouts</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="League-2485"><a href="#League-2485"><span class="linenos">2485</span></a>        <span class="n">reduced_value</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span><span id="League-2486"><a href="#League-2486"><span class="linenos">2486</span></a>            <span class="n">columns</span><span class="o">=</span><span class="p">[</span>
</span><span id="League-2487"><a href="#League-2487"><span class="linenos">2487</span></a>                <span class="s2">&quot;player_to_drop&quot;</span><span class="p">,</span>
</span><span id="League-2488"><a href="#League-2488"><span class="linenos">2488</span></a>                <span class="s2">&quot;wins_avg&quot;</span><span class="p">,</span>
</span><span id="League-2489"><a href="#League-2489"><span class="linenos">2489</span></a>                <span class="s2">&quot;wins_stdev&quot;</span><span class="p">,</span>
</span><span id="League-2490"><a href="#League-2490"><span class="linenos">2490</span></a>                <span class="s2">&quot;points_avg&quot;</span><span class="p">,</span>
</span><span id="League-2491"><a href="#League-2491"><span class="linenos">2491</span></a>                <span class="s2">&quot;points_stdev&quot;</span><span class="p">,</span>
</span><span id="League-2492"><a href="#League-2492"><span class="linenos">2492</span></a>                <span class="s2">&quot;per_game_avg&quot;</span><span class="p">,</span>
</span><span id="League-2493"><a href="#League-2493"><span class="linenos">2493</span></a>                <span class="s2">&quot;per_game_stdev&quot;</span><span class="p">,</span>
</span><span id="League-2494"><a href="#League-2494"><span class="linenos">2494</span></a>                <span class="s2">&quot;per_game_fano&quot;</span><span class="p">,</span>
</span><span id="League-2495"><a href="#League-2495"><span class="linenos">2495</span></a>                <span class="s2">&quot;playoffs&quot;</span><span class="p">,</span>
</span><span id="League-2496"><a href="#League-2496"><span class="linenos">2496</span></a>                <span class="s2">&quot;playoff_bye&quot;</span><span class="p">,</span>
</span><span id="League-2497"><a href="#League-2497"><span class="linenos">2497</span></a>            <span class="p">]</span>
</span><span id="League-2498"><a href="#League-2498"><span class="linenos">2498</span></a>            <span class="o">+</span> <span class="p">(</span>
</span><span id="League-2499"><a href="#League-2499"><span class="linenos">2499</span></a>                <span class="p">[</span><span class="s2">&quot;winner&quot;</span><span class="p">,</span> <span class="s2">&quot;runner_up&quot;</span><span class="p">,</span> <span class="s2">&quot;third&quot;</span><span class="p">,</span> <span class="s2">&quot;earnings&quot;</span><span class="p">]</span>
</span><span id="League-2500"><a href="#League-2500"><span class="linenos">2500</span></a>                <span class="o">+</span> <span class="p">(</span>
</span><span id="League-2501"><a href="#League-2501"><span class="linenos">2501</span></a>                    <span class="p">[</span><span class="s2">&quot;many_mile&quot;</span><span class="p">]</span>
</span><span id="League-2502"><a href="#League-2502"><span class="linenos">2502</span></a>                    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">team_1</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;The Algorithm&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
</span><span id="League-2503"><a href="#League-2503"><span class="linenos">2503</span></a>                    <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">team_2</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;The Algorithm&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">())</span> \
</span><span id="League-2504"><a href="#League-2504"><span class="linenos">2504</span></a>                    <span class="ow">and</span> <span class="ow">not</span> <span class="n">bestball</span> <span class="k">else</span> <span class="p">[]</span>
</span><span id="League-2505"><a href="#League-2505"><span class="linenos">2505</span></a>                <span class="p">)</span>
</span><span id="League-2506"><a href="#League-2506"><span class="linenos">2506</span></a>                <span class="k">if</span> <span class="n">postseason</span>
</span><span id="League-2507"><a href="#League-2507"><span class="linenos">2507</span></a>                <span class="k">else</span> <span class="p">[]</span>
</span><span id="League-2508"><a href="#League-2508"><span class="linenos">2508</span></a>            <span class="p">)</span>
</span><span id="League-2509"><a href="#League-2509"><span class="linenos">2509</span></a>        <span class="p">)</span>
</span><span id="League-2510"><a href="#League-2510"><span class="linenos">2510</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">team_name</span><span class="p">:</span>
</span><span id="League-2511"><a href="#League-2511"><span class="linenos">2511</span></a>            <span class="n">team_name</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="League-2512"><a href="#League-2512"><span class="linenos">2512</span></a>                <span class="n">team</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
</span><span id="League-2513"><a href="#League-2513"><span class="linenos">2513</span></a>                <span class="k">for</span> <span class="n">team</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">teams</span>
</span><span id="League-2514"><a href="#League-2514"><span class="linenos">2514</span></a>                <span class="k">if</span> <span class="n">team</span><span class="p">[</span><span class="s2">&quot;team_key&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">lg</span><span class="o">.</span><span class="n">team_key</span><span class="p">()</span>
</span><span id="League-2515"><a href="#League-2515"><span class="linenos">2515</span></a>            <span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League-2516"><a href="#League-2516"><span class="linenos">2516</span></a>        <span class="n">players_to_drop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">fantasy_team</span> <span class="o">==</span> <span class="n">team_name</span><span class="p">]</span>
</span><span id="League-2517"><a href="#League-2517"><span class="linenos">2517</span></a>        <span class="k">if</span> <span class="n">players_to_drop</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">focus_on</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="League-2518"><a href="#League-2518"><span class="linenos">2518</span></a>            <span class="n">players_to_drop</span> <span class="o">=</span> <span class="n">players_to_drop</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">players_to_drop</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">focus_on</span><span class="p">)]</span>
</span><span id="League-2519"><a href="#League-2519"><span class="linenos">2519</span></a>        <span class="k">if</span> <span class="n">players_to_drop</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">exclude</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="League-2520"><a href="#League-2520"><span class="linenos">2520</span></a>            <span class="n">players_to_drop</span> <span class="o">=</span> <span class="n">players_to_drop</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">players_to_drop</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">exclude</span><span class="p">)]</span>
</span><span id="League-2521"><a href="#League-2521"><span class="linenos">2521</span></a>        <span class="k">for</span> <span class="n">my_player</span> <span class="ow">in</span> <span class="n">players_to_drop</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
</span><span id="League-2522"><a href="#League-2522"><span class="linenos">2522</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">my_player</span><span class="p">,</span> <span class="s2">&quot;fantasy_team&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="League-2523"><a href="#League-2523"><span class="linenos">2523</span></a>            <span class="k">if</span> <span class="n">bestball</span><span class="p">:</span>
</span><span id="League-2524"><a href="#League-2524"><span class="linenos">2524</span></a>                <span class="n">new_standings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bestball_sims</span><span class="p">(</span><span class="n">payouts</span><span class="p">)</span>
</span><span id="League-2525"><a href="#League-2525"><span class="linenos">2525</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="League-2526"><a href="#League-2526"><span class="linenos">2526</span></a>                <span class="n">new_standings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">season_sims</span><span class="p">(</span><span class="n">postseason</span><span class="p">,</span> <span class="n">payouts</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="League-2527"><a href="#League-2527"><span class="linenos">2527</span></a>            <span class="n">reduced_value</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">reduced_value</span><span class="p">,</span>
</span><span id="League-2528"><a href="#League-2528"><span class="linenos">2528</span></a>                <span class="n">new_standings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">new_standings</span><span class="o">.</span><span class="n">team</span> <span class="o">==</span> <span class="n">team_name</span><span class="p">]],</span>
</span><span id="League-2529"><a href="#League-2529"><span class="linenos">2529</span></a>                <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="League-2530"><a href="#League-2530"><span class="linenos">2530</span></a>                <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="League-2531"><a href="#League-2531"><span class="linenos">2531</span></a>            <span class="p">)</span>
</span><span id="League-2532"><a href="#League-2532"><span class="linenos">2532</span></a>            <span class="n">reduced_value</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">reduced_value</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;player_to_drop&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">my_player</span>
</span><span id="League-2533"><a href="#League-2533"><span class="linenos">2533</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">my_player</span><span class="p">,</span> <span class="s2">&quot;fantasy_team&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">team_name</span>
</span><span id="League-2534"><a href="#League-2534"><span class="linenos">2534</span></a>        <span class="k">if</span> <span class="n">reduced_value</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="League-2535"><a href="#League-2535"><span class="linenos">2535</span></a>            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="League-2536"><a href="#League-2536"><span class="linenos">2536</span></a>                <span class="s2">&quot;wins_avg&quot;</span><span class="p">,</span>
</span><span id="League-2537"><a href="#League-2537"><span class="linenos">2537</span></a>                <span class="s2">&quot;wins_stdev&quot;</span><span class="p">,</span>
</span><span id="League-2538"><a href="#League-2538"><span class="linenos">2538</span></a>                <span class="s2">&quot;points_avg&quot;</span><span class="p">,</span>
</span><span id="League-2539"><a href="#League-2539"><span class="linenos">2539</span></a>                <span class="s2">&quot;points_stdev&quot;</span><span class="p">,</span>
</span><span id="League-2540"><a href="#League-2540"><span class="linenos">2540</span></a>                <span class="s2">&quot;playoffs&quot;</span><span class="p">,</span>
</span><span id="League-2541"><a href="#League-2541"><span class="linenos">2541</span></a>                <span class="s2">&quot;playoff_bye&quot;</span><span class="p">,</span>
</span><span id="League-2542"><a href="#League-2542"><span class="linenos">2542</span></a>            <span class="p">]</span> <span class="o">+</span> <span class="p">(</span>
</span><span id="League-2543"><a href="#League-2543"><span class="linenos">2543</span></a>                <span class="p">[</span><span class="s2">&quot;winner&quot;</span><span class="p">,</span> <span class="s2">&quot;runner_up&quot;</span><span class="p">,</span> <span class="s2">&quot;third&quot;</span><span class="p">,</span> <span class="s2">&quot;earnings&quot;</span><span class="p">]</span>
</span><span id="League-2544"><a href="#League-2544"><span class="linenos">2544</span></a>                <span class="o">+</span> <span class="p">(</span>
</span><span id="League-2545"><a href="#League-2545"><span class="linenos">2545</span></a>                    <span class="p">[</span><span class="s2">&quot;many_mile&quot;</span><span class="p">]</span>
</span><span id="League-2546"><a href="#League-2546"><span class="linenos">2546</span></a>                    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">team_1</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;The Algorithm&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
</span><span id="League-2547"><a href="#League-2547"><span class="linenos">2547</span></a>                    <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">team_2</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;The Algorithm&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">())</span> \
</span><span id="League-2548"><a href="#League-2548"><span class="linenos">2548</span></a>                    <span class="ow">and</span> <span class="ow">not</span> <span class="n">bestball</span> <span class="k">else</span> <span class="p">[]</span>
</span><span id="League-2549"><a href="#League-2549"><span class="linenos">2549</span></a>                <span class="p">)</span>
</span><span id="League-2550"><a href="#League-2550"><span class="linenos">2550</span></a>                <span class="k">if</span> <span class="n">postseason</span>
</span><span id="League-2551"><a href="#League-2551"><span class="linenos">2551</span></a>                <span class="k">else</span> <span class="p">[]</span>
</span><span id="League-2552"><a href="#League-2552"><span class="linenos">2552</span></a>            <span class="p">):</span>
</span><span id="League-2553"><a href="#League-2553"><span class="linenos">2553</span></a>                <span class="n">reduced_value</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">-=</span> <span class="n">orig_standings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League-2554"><a href="#League-2554"><span class="linenos">2554</span></a>                    <span class="n">orig_standings</span><span class="o">.</span><span class="n">team</span> <span class="o">==</span> <span class="n">team_name</span><span class="p">,</span> <span class="n">col</span>
</span><span id="League-2555"><a href="#League-2555"><span class="linenos">2555</span></a>                <span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League-2556"><a href="#League-2556"><span class="linenos">2556</span></a>                <span class="n">reduced_value</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">reduced_value</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="mi">4</span><span class="p">)</span>
</span><span id="League-2557"><a href="#League-2557"><span class="linenos">2557</span></a>            <span class="n">reduced_value</span> <span class="o">=</span> <span class="n">reduced_value</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
</span><span id="League-2558"><a href="#League-2558"><span class="linenos">2558</span></a>                <span class="n">by</span><span class="o">=</span><span class="s2">&quot;winner&quot;</span> <span class="k">if</span> <span class="n">postseason</span> <span class="k">else</span> <span class="s2">&quot;playoffs&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span>
</span><span id="League-2559"><a href="#League-2559"><span class="linenos">2559</span></a>            <span class="p">)</span>
</span><span id="League-2560"><a href="#League-2560"><span class="linenos">2560</span></a>            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="League-2561"><a href="#League-2561"><span class="linenos">2561</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="League-2562"><a href="#League-2562"><span class="linenos">2562</span></a>                    <span class="n">reduced_value</span><span class="p">[[</span><span class="s2">&quot;player_to_drop&quot;</span><span class="p">,</span> <span class="s2">&quot;earnings&quot;</span><span class="p">]]</span>
</span><span id="League-2563"><a href="#League-2563"><span class="linenos">2563</span></a>                    <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;earnings&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="League-2564"><a href="#League-2564"><span class="linenos">2564</span></a>                    <span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="League-2565"><a href="#League-2565"><span class="linenos">2565</span></a>                <span class="p">)</span>
</span><span id="League-2566"><a href="#League-2566"><span class="linenos">2566</span></a>        <span class="k">return</span> <span class="n">reduced_value</span>
</span><span id="League-2567"><a href="#League-2567"><span class="linenos">2567</span></a>
</span><span id="League-2568"><a href="#League-2568"><span class="linenos">2568</span></a>    <span class="k">def</span> <span class="nf">possible_trades</span><span class="p">(</span>
</span><span id="League-2569"><a href="#League-2569"><span class="linenos">2569</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="League-2570"><a href="#League-2570"><span class="linenos">2570</span></a>        <span class="n">focus_on</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[],</span>
</span><span id="League-2571"><a href="#League-2571"><span class="linenos">2571</span></a>        <span class="n">exclude</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[],</span>
</span><span id="League-2572"><a href="#League-2572"><span class="linenos">2572</span></a>        <span class="n">given</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[],</span>
</span><span id="League-2573"><a href="#League-2573"><span class="linenos">2573</span></a>        <span class="n">limit_per</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="League-2574"><a href="#League-2574"><span class="linenos">2574</span></a>        <span class="n">team_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="League-2575"><a href="#League-2575"><span class="linenos">2575</span></a>        <span class="n">postseason</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="League-2576"><a href="#League-2576"><span class="linenos">2576</span></a>        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="League-2577"><a href="#League-2577"><span class="linenos">2577</span></a>        <span class="n">payouts</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">800</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
</span><span id="League-2578"><a href="#League-2578"><span class="linenos">2578</span></a>        <span class="n">bestball</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="League-2579"><a href="#League-2579"><span class="linenos">2579</span></a>    <span class="p">):</span>
</span><span id="League-2580"><a href="#League-2580"><span class="linenos">2580</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="League-2581"><a href="#League-2581"><span class="linenos">2581</span></a><span class="sd">        Simulates the remainder of the season with the current roster and compares it to </span>
</span><span id="League-2582"><a href="#League-2582"><span class="linenos">2582</span></a><span class="sd">        a simulation of the roster after a series of potential trade transactions.</span>
</span><span id="League-2583"><a href="#League-2583"><span class="linenos">2583</span></a>
</span><span id="League-2584"><a href="#League-2584"><span class="linenos">2584</span></a><span class="sd">        Args:</span>
</span><span id="League-2585"><a href="#League-2585"><span class="linenos">2585</span></a><span class="sd">            focus_on (list, optional): list of players to include in every potential trade, defaults to [].  </span>
</span><span id="League-2586"><a href="#League-2586"><span class="linenos">2586</span></a><span class="sd">            exclude (list, optional): list of players to exclude from every potential trade, defaults to [].  </span>
</span><span id="League-2587"><a href="#League-2587"><span class="linenos">2587</span></a><span class="sd">            given (list, optional): list of players to include in the trade in the background, defaults to [].  </span>
</span><span id="League-2588"><a href="#League-2588"><span class="linenos">2588</span></a><span class="sd">            limit_per (int, optional): number of players per position to analyze, defaults to 10.  </span>
</span><span id="League-2589"><a href="#League-2589"><span class="linenos">2589</span></a><span class="sd">            team_name (str, optional): name of team to analyze trades for, defaults to None (and therefore team of interest).  </span>
</span><span id="League-2590"><a href="#League-2590"><span class="linenos">2590</span></a><span class="sd">            postseason (bool, optional): whether to analyze postseason gains or just regular season, defaults to True.  </span>
</span><span id="League-2591"><a href="#League-2591"><span class="linenos">2591</span></a><span class="sd">            verbose (bool, optional): whether to print out a status report as the code runs, defaults to True.  </span>
</span><span id="League-2592"><a href="#League-2592"><span class="linenos">2592</span></a><span class="sd">            payouts (list, optional): list of payout amounts for top three finishers, defaults to [800, 300, 100].  </span>
</span><span id="League-2593"><a href="#League-2593"><span class="linenos">2593</span></a><span class="sd">            bestball (bool, optional): whether to use best ball settings during simulation, defaults to False.</span>
</span><span id="League-2594"><a href="#League-2594"><span class="linenos">2594</span></a>
</span><span id="League-2595"><a href="#League-2595"><span class="linenos">2595</span></a><span class="sd">        Returns:</span>
</span><span id="League-2596"><a href="#League-2596"><span class="linenos">2596</span></a><span class="sd">            pd.DataFrame: dataframe containing the impact and value of every possible trade analyzed.</span>
</span><span id="League-2597"><a href="#League-2597"><span class="linenos">2597</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="League-2598"><a href="#League-2598"><span class="linenos">2598</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_oauth</span><span class="p">()</span>
</span><span id="League-2599"><a href="#League-2599"><span class="linenos">2599</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">team_name</span><span class="p">:</span>
</span><span id="League-2600"><a href="#League-2600"><span class="linenos">2600</span></a>            <span class="n">team_name</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="League-2601"><a href="#League-2601"><span class="linenos">2601</span></a>                <span class="n">team</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
</span><span id="League-2602"><a href="#League-2602"><span class="linenos">2602</span></a>                <span class="k">for</span> <span class="n">team</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">teams</span>
</span><span id="League-2603"><a href="#League-2603"><span class="linenos">2603</span></a>                <span class="k">if</span> <span class="n">team</span><span class="p">[</span><span class="s2">&quot;team_key&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">lg</span><span class="o">.</span><span class="n">team_key</span><span class="p">()</span>
</span><span id="League-2604"><a href="#League-2604"><span class="linenos">2604</span></a>            <span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League-2605"><a href="#League-2605"><span class="linenos">2605</span></a>        <span class="n">my_players</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League-2606"><a href="#League-2606"><span class="linenos">2606</span></a>            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">fantasy_team</span> <span class="o">==</span> <span class="n">team_name</span><span class="p">)</span>
</span><span id="League-2607"><a href="#League-2607"><span class="linenos">2607</span></a>            <span class="o">&amp;</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;K&quot;</span><span class="p">,</span> <span class="s2">&quot;DEF&quot;</span><span class="p">])</span>
</span><span id="League-2608"><a href="#League-2608"><span class="linenos">2608</span></a>        <span class="p">]</span>
</span><span id="League-2609"><a href="#League-2609"><span class="linenos">2609</span></a>        <span class="k">if</span> <span class="n">my_players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">focus_on</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="League-2610"><a href="#League-2610"><span class="linenos">2610</span></a>            <span class="n">my_players</span> <span class="o">=</span> <span class="n">my_players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">my_players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">focus_on</span><span class="p">)]</span>
</span><span id="League-2611"><a href="#League-2611"><span class="linenos">2611</span></a>        <span class="k">if</span> <span class="n">my_players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">exclude</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="League-2612"><a href="#League-2612"><span class="linenos">2612</span></a>            <span class="n">my_players</span> <span class="o">=</span> <span class="n">my_players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">my_players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">exclude</span><span class="p">)]</span>
</span><span id="League-2613"><a href="#League-2613"><span class="linenos">2613</span></a>        <span class="n">their_players</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League-2614"><a href="#League-2614"><span class="linenos">2614</span></a>            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">fantasy_team</span> <span class="o">!=</span> <span class="n">team_name</span><span class="p">)</span>
</span><span id="League-2615"><a href="#League-2615"><span class="linenos">2615</span></a>            <span class="o">&amp;</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;K&quot;</span><span class="p">,</span> <span class="s2">&quot;DEF&quot;</span><span class="p">])</span>
</span><span id="League-2616"><a href="#League-2616"><span class="linenos">2616</span></a>        <span class="p">]</span>
</span><span id="League-2617"><a href="#League-2617"><span class="linenos">2617</span></a>        <span class="k">if</span> <span class="n">their_players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">focus_on</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="League-2618"><a href="#League-2618"><span class="linenos">2618</span></a>            <span class="n">their_players</span> <span class="o">=</span> <span class="n">their_players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">their_players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">focus_on</span><span class="p">)]</span>
</span><span id="League-2619"><a href="#League-2619"><span class="linenos">2619</span></a>        <span class="k">if</span> <span class="n">their_players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">exclude</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="League-2620"><a href="#League-2620"><span class="linenos">2620</span></a>            <span class="n">their_players</span> <span class="o">=</span> <span class="n">their_players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">their_players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">exclude</span><span class="p">)]</span>
</span><span id="League-2621"><a href="#League-2621"><span class="linenos">2621</span></a>        <span class="k">if</span> <span class="n">bestball</span><span class="p">:</span>
</span><span id="League-2622"><a href="#League-2622"><span class="linenos">2622</span></a>            <span class="n">orig_standings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bestball_sims</span><span class="p">(</span><span class="n">payouts</span><span class="p">)</span>
</span><span id="League-2623"><a href="#League-2623"><span class="linenos">2623</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="League-2624"><a href="#League-2624"><span class="linenos">2624</span></a>            <span class="n">orig_standings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">season_sims</span><span class="p">(</span><span class="n">postseason</span><span class="p">,</span> <span class="n">payouts</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="League-2625"><a href="#League-2625"><span class="linenos">2625</span></a>
</span><span id="League-2626"><a href="#League-2626"><span class="linenos">2626</span></a>        <span class="c1"># Make sure there are two teams and narrow down to that team!!!</span>
</span><span id="League-2627"><a href="#League-2627"><span class="linenos">2627</span></a>        <span class="n">given_check</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League-2628"><a href="#League-2628"><span class="linenos">2628</span></a>            <span class="nb">type</span><span class="p">(</span><span class="n">given</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span>
</span><span id="League-2629"><a href="#League-2629"><span class="linenos">2629</span></a>            <span class="ow">and</span> <span class="n">my_players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">given</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
</span><span id="League-2630"><a href="#League-2630"><span class="linenos">2630</span></a>            <span class="ow">and</span> <span class="n">their_players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">their_players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">given</span><span class="p">),</span> <span class="s2">&quot;fantasy_team&quot;</span><span class="p">]</span>
</span><span id="League-2631"><a href="#League-2631"><span class="linenos">2631</span></a>            <span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</span><span id="League-2632"><a href="#League-2632"><span class="linenos">2632</span></a>            <span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League-2633"><a href="#League-2633"><span class="linenos">2633</span></a>            <span class="o">==</span> <span class="mi">1</span>
</span><span id="League-2634"><a href="#League-2634"><span class="linenos">2634</span></a>        <span class="p">)</span>
</span><span id="League-2635"><a href="#League-2635"><span class="linenos">2635</span></a>        <span class="k">if</span> <span class="n">given_check</span><span class="p">:</span>
</span><span id="League-2636"><a href="#League-2636"><span class="linenos">2636</span></a>            <span class="n">mine</span> <span class="o">=</span> <span class="p">[</span><span class="n">player</span> <span class="k">for</span> <span class="n">player</span> <span class="ow">in</span> <span class="n">given</span> <span class="k">if</span> <span class="n">my_players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="n">player</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">()]</span>
</span><span id="League-2637"><a href="#League-2637"><span class="linenos">2637</span></a>            <span class="n">theirs</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="League-2638"><a href="#League-2638"><span class="linenos">2638</span></a>                <span class="n">player</span> <span class="k">for</span> <span class="n">player</span> <span class="ow">in</span> <span class="n">given</span> <span class="k">if</span> <span class="n">their_players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="n">player</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
</span><span id="League-2639"><a href="#League-2639"><span class="linenos">2639</span></a>            <span class="p">]</span>
</span><span id="League-2640"><a href="#League-2640"><span class="linenos">2640</span></a>            <span class="n">their_team</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League-2641"><a href="#League-2641"><span class="linenos">2641</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">theirs</span><span class="p">),</span> <span class="s2">&quot;fantasy_team&quot;</span>
</span><span id="League-2642"><a href="#League-2642"><span class="linenos">2642</span></a>            <span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League-2643"><a href="#League-2643"><span class="linenos">2643</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">mine</span><span class="p">),</span> <span class="s2">&quot;fantasy_team&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">their_team</span>
</span><span id="League-2644"><a href="#League-2644"><span class="linenos">2644</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">theirs</span><span class="p">),</span> <span class="s2">&quot;fantasy_team&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">team_name</span>
</span><span id="League-2645"><a href="#League-2645"><span class="linenos">2645</span></a>            <span class="n">my_players</span> <span class="o">=</span> <span class="n">my_players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">my_players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">given</span><span class="p">)]</span>
</span><span id="League-2646"><a href="#League-2646"><span class="linenos">2646</span></a>            <span class="n">their_players</span> <span class="o">=</span> <span class="n">their_players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League-2647"><a href="#League-2647"><span class="linenos">2647</span></a>                <span class="p">(</span><span class="n">their_players</span><span class="o">.</span><span class="n">fantasy_team</span> <span class="o">==</span> <span class="n">their_team</span><span class="p">)</span>
</span><span id="League-2648"><a href="#League-2648"><span class="linenos">2648</span></a>                <span class="o">&amp;</span> <span class="o">~</span><span class="n">their_players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">given</span><span class="p">)</span>
</span><span id="League-2649"><a href="#League-2649"><span class="linenos">2649</span></a>            <span class="p">]</span>
</span><span id="League-2650"><a href="#League-2650"><span class="linenos">2650</span></a>            <span class="n">my_players</span><span class="p">[</span><span class="s2">&quot;WAR&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="League-2651"><a href="#League-2651"><span class="linenos">2651</span></a>            <span class="n">their_players</span><span class="p">[</span><span class="s2">&quot;WAR&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="League-2652"><a href="#League-2652"><span class="linenos">2652</span></a>        <span class="c1"># Make sure there are two teams and narrow down to that teams!!!</span>
</span><span id="League-2653"><a href="#League-2653"><span class="linenos">2653</span></a>
</span><span id="League-2654"><a href="#League-2654"><span class="linenos">2654</span></a>        <span class="n">my_added_value</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="League-2655"><a href="#League-2655"><span class="linenos">2655</span></a>        <span class="n">their_added_value</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="League-2656"><a href="#League-2656"><span class="linenos">2656</span></a>        <span class="k">for</span> <span class="n">my_player</span> <span class="ow">in</span> <span class="n">my_players</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
</span><span id="League-2657"><a href="#League-2657"><span class="linenos">2657</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">refresh_oauth</span><span class="p">(</span><span class="mi">55</span><span class="p">)</span>
</span><span id="League-2658"><a href="#League-2658"><span class="linenos">2658</span></a>            <span class="k">if</span> <span class="n">their_players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">focus_on</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="League-2659"><a href="#League-2659"><span class="linenos">2659</span></a>                <span class="n">possible</span> <span class="o">=</span> <span class="n">their_players</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="League-2660"><a href="#League-2660"><span class="linenos">2660</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="League-2661"><a href="#League-2661"><span class="linenos">2661</span></a>                <span class="n">possible</span> <span class="o">=</span> <span class="n">their_players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League-2662"><a href="#League-2662"><span class="linenos">2662</span></a>                    <span class="nb">abs</span><span class="p">(</span>
</span><span id="League-2663"><a href="#League-2663"><span class="linenos">2663</span></a>                        <span class="n">their_players</span><span class="o">.</span><span class="n">WAR</span>
</span><span id="League-2664"><a href="#League-2664"><span class="linenos">2664</span></a>                        <span class="o">-</span> <span class="n">my_players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">my_players</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">my_player</span><span class="p">,</span> <span class="s2">&quot;WAR&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League-2665"><a href="#League-2665"><span class="linenos">2665</span></a>                    <span class="p">)</span>
</span><span id="League-2666"><a href="#League-2666"><span class="linenos">2666</span></a>                    <span class="o">&lt;=</span> <span class="mf">0.5</span>
</span><span id="League-2667"><a href="#League-2667"><span class="linenos">2667</span></a>                <span class="p">]</span>
</span><span id="League-2668"><a href="#League-2668"><span class="linenos">2668</span></a>            <span class="c1"># possible = their_players.loc[their_players.WAR - my_players.loc[my_players.name == my_player,&#39;WAR&#39;].values[0] &gt; -1.0]</span>
</span><span id="League-2669"><a href="#League-2669"><span class="linenos">2669</span></a>            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="League-2670"><a href="#League-2670"><span class="linenos">2670</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">my_player</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">possible</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; comparable players&quot;</span><span class="p">)</span>
</span><span id="League-2671"><a href="#League-2671"><span class="linenos">2671</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">())</span>
</span><span id="League-2672"><a href="#League-2672"><span class="linenos">2672</span></a>            <span class="n">possible</span> <span class="o">=</span> <span class="n">possible</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;position&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">limit_per</span><span class="p">)</span>
</span><span id="League-2673"><a href="#League-2673"><span class="linenos">2673</span></a>            <span class="k">for</span> <span class="n">their_player</span> <span class="ow">in</span> <span class="n">possible</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
</span><span id="League-2674"><a href="#League-2674"><span class="linenos">2674</span></a>                <span class="n">their_team</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League-2675"><a href="#League-2675"><span class="linenos">2675</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">their_player</span><span class="p">,</span> <span class="s2">&quot;fantasy_team&quot;</span>
</span><span id="League-2676"><a href="#League-2676"><span class="linenos">2676</span></a>                <span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League-2677"><a href="#League-2677"><span class="linenos">2677</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League-2678"><a href="#League-2678"><span class="linenos">2678</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">my_player</span><span class="p">,</span> <span class="s2">&quot;fantasy_team&quot;</span>
</span><span id="League-2679"><a href="#League-2679"><span class="linenos">2679</span></a>                <span class="p">]</span> <span class="o">=</span> <span class="n">their_team</span>
</span><span id="League-2680"><a href="#League-2680"><span class="linenos">2680</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League-2681"><a href="#League-2681"><span class="linenos">2681</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">their_player</span><span class="p">,</span> <span class="s2">&quot;fantasy_team&quot;</span>
</span><span id="League-2682"><a href="#League-2682"><span class="linenos">2682</span></a>                <span class="p">]</span> <span class="o">=</span> <span class="n">team_name</span>
</span><span id="League-2683"><a href="#League-2683"><span class="linenos">2683</span></a>                <span class="k">if</span> <span class="n">bestball</span><span class="p">:</span>
</span><span id="League-2684"><a href="#League-2684"><span class="linenos">2684</span></a>                    <span class="n">new_standings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bestball_sims</span><span class="p">(</span><span class="n">payouts</span><span class="p">)</span>
</span><span id="League-2685"><a href="#League-2685"><span class="linenos">2685</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="League-2686"><a href="#League-2686"><span class="linenos">2686</span></a>                    <span class="n">new_standings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">season_sims</span><span class="p">(</span><span class="n">postseason</span><span class="p">,</span> <span class="n">payouts</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="League-2687"><a href="#League-2687"><span class="linenos">2687</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League-2688"><a href="#League-2688"><span class="linenos">2688</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">my_player</span><span class="p">,</span> <span class="s2">&quot;fantasy_team&quot;</span>
</span><span id="League-2689"><a href="#League-2689"><span class="linenos">2689</span></a>                <span class="p">]</span> <span class="o">=</span> <span class="n">team_name</span>
</span><span id="League-2690"><a href="#League-2690"><span class="linenos">2690</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League-2691"><a href="#League-2691"><span class="linenos">2691</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">their_player</span><span class="p">,</span> <span class="s2">&quot;fantasy_team&quot;</span>
</span><span id="League-2692"><a href="#League-2692"><span class="linenos">2692</span></a>                <span class="p">]</span> <span class="o">=</span> <span class="n">their_team</span>
</span><span id="League-2693"><a href="#League-2693"><span class="linenos">2693</span></a>                <span class="n">new_standings</span><span class="p">[</span><span class="s2">&quot;player_to_trade_away&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">my_player</span>
</span><span id="League-2694"><a href="#League-2694"><span class="linenos">2694</span></a>                <span class="n">new_standings</span><span class="p">[</span><span class="s2">&quot;player_to_trade_for&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">their_player</span>
</span><span id="League-2695"><a href="#League-2695"><span class="linenos">2695</span></a>                <span class="n">my_added_value</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">my_added_value</span><span class="p">,</span>
</span><span id="League-2696"><a href="#League-2696"><span class="linenos">2696</span></a>                    <span class="n">new_standings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">new_standings</span><span class="o">.</span><span class="n">team</span> <span class="o">==</span> <span class="n">team_name</span><span class="p">]],</span>
</span><span id="League-2697"><a href="#League-2697"><span class="linenos">2697</span></a>                    <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="League-2698"><a href="#League-2698"><span class="linenos">2698</span></a>                <span class="p">)</span>
</span><span id="League-2699"><a href="#League-2699"><span class="linenos">2699</span></a>                <span class="n">their_added_value</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">their_added_value</span><span class="p">,</span>
</span><span id="League-2700"><a href="#League-2700"><span class="linenos">2700</span></a>                    <span class="n">new_standings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">new_standings</span><span class="o">.</span><span class="n">team</span> <span class="o">==</span> <span class="n">their_team</span><span class="p">]],</span>
</span><span id="League-2701"><a href="#League-2701"><span class="linenos">2701</span></a>                    <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="League-2702"><a href="#League-2702"><span class="linenos">2702</span></a>                <span class="p">)</span>
</span><span id="League-2703"><a href="#League-2703"><span class="linenos">2703</span></a>            <span class="k">if</span> <span class="n">verbose</span> <span class="ow">and</span> <span class="n">possible</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="League-2704"><a href="#League-2704"><span class="linenos">2704</span></a>                <span class="n">me</span> <span class="o">=</span> <span class="n">my_added_value</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">possible</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">:][</span>
</span><span id="League-2705"><a href="#League-2705"><span class="linenos">2705</span></a>                    <span class="p">[</span><span class="s2">&quot;player_to_trade_away&quot;</span><span class="p">,</span> <span class="s2">&quot;player_to_trade_for&quot;</span><span class="p">,</span> <span class="s2">&quot;earnings&quot;</span><span class="p">]</span>
</span><span id="League-2706"><a href="#League-2706"><span class="linenos">2706</span></a>                <span class="p">]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;earnings&quot;</span><span class="p">:</span> <span class="s2">&quot;my_earnings&quot;</span><span class="p">})</span>
</span><span id="League-2707"><a href="#League-2707"><span class="linenos">2707</span></a>                <span class="n">them</span> <span class="o">=</span> <span class="n">their_added_value</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">possible</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">:][</span>
</span><span id="League-2708"><a href="#League-2708"><span class="linenos">2708</span></a>                    <span class="p">[</span><span class="s2">&quot;player_to_trade_away&quot;</span><span class="p">,</span> <span class="s2">&quot;player_to_trade_for&quot;</span><span class="p">,</span> <span class="s2">&quot;team&quot;</span><span class="p">,</span> <span class="s2">&quot;earnings&quot;</span><span class="p">]</span>
</span><span id="League-2709"><a href="#League-2709"><span class="linenos">2709</span></a>                <span class="p">]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;earnings&quot;</span><span class="p">:</span> <span class="s2">&quot;their_earnings&quot;</span><span class="p">})</span>
</span><span id="League-2710"><a href="#League-2710"><span class="linenos">2710</span></a>                <span class="n">me</span><span class="p">[</span><span class="s2">&quot;my_earnings&quot;</span><span class="p">]</span> <span class="o">-=</span> <span class="n">orig_standings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League-2711"><a href="#League-2711"><span class="linenos">2711</span></a>                    <span class="n">orig_standings</span><span class="o">.</span><span class="n">team</span> <span class="o">==</span> <span class="n">team_name</span><span class="p">,</span> <span class="s2">&quot;earnings&quot;</span>
</span><span id="League-2712"><a href="#League-2712"><span class="linenos">2712</span></a>                <span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League-2713"><a href="#League-2713"><span class="linenos">2713</span></a>                <span class="k">for</span> <span class="n">their_team</span> <span class="ow">in</span> <span class="n">them</span><span class="o">.</span><span class="n">team</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
</span><span id="League-2714"><a href="#League-2714"><span class="linenos">2714</span></a>                    <span class="n">them</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League-2715"><a href="#League-2715"><span class="linenos">2715</span></a>                        <span class="n">them</span><span class="o">.</span><span class="n">team</span> <span class="o">==</span> <span class="n">their_team</span><span class="p">,</span> <span class="s2">&quot;their_earnings&quot;</span>
</span><span id="League-2716"><a href="#League-2716"><span class="linenos">2716</span></a>                    <span class="p">]</span> <span class="o">-=</span> <span class="n">orig_standings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League-2717"><a href="#League-2717"><span class="linenos">2717</span></a>                        <span class="n">orig_standings</span><span class="o">.</span><span class="n">team</span> <span class="o">==</span> <span class="n">their_team</span><span class="p">,</span> <span class="s2">&quot;earnings&quot;</span>
</span><span id="League-2718"><a href="#League-2718"><span class="linenos">2718</span></a>                    <span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span>
</span><span id="League-2719"><a href="#League-2719"><span class="linenos">2719</span></a>                        <span class="mi">0</span>
</span><span id="League-2720"><a href="#League-2720"><span class="linenos">2720</span></a>                    <span class="p">]</span>
</span><span id="League-2721"><a href="#League-2721"><span class="linenos">2721</span></a>                <span class="n">temp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League-2722"><a href="#League-2722"><span class="linenos">2722</span></a>                    <span class="n">left</span><span class="o">=</span><span class="n">me</span><span class="p">,</span>
</span><span id="League-2723"><a href="#League-2723"><span class="linenos">2723</span></a>                    <span class="n">right</span><span class="o">=</span><span class="n">them</span><span class="p">,</span>
</span><span id="League-2724"><a href="#League-2724"><span class="linenos">2724</span></a>                    <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">,</span>
</span><span id="League-2725"><a href="#League-2725"><span class="linenos">2725</span></a>                    <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;player_to_trade_away&quot;</span><span class="p">,</span> <span class="s2">&quot;player_to_trade_for&quot;</span><span class="p">],</span>
</span><span id="League-2726"><a href="#League-2726"><span class="linenos">2726</span></a>                <span class="p">)</span>
</span><span id="League-2727"><a href="#League-2727"><span class="linenos">2727</span></a>                <span class="k">if</span> <span class="n">temp</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="League-2728"><a href="#League-2728"><span class="linenos">2728</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="League-2729"><a href="#League-2729"><span class="linenos">2729</span></a>                        <span class="n">temp</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;my_earnings&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span>
</span><span id="League-2730"><a href="#League-2730"><span class="linenos">2730</span></a>                            <span class="n">index</span><span class="o">=</span><span class="kc">False</span>
</span><span id="League-2731"><a href="#League-2731"><span class="linenos">2731</span></a>                        <span class="p">)</span>
</span><span id="League-2732"><a href="#League-2732"><span class="linenos">2732</span></a>                    <span class="p">)</span>
</span><span id="League-2733"><a href="#League-2733"><span class="linenos">2733</span></a>                <span class="k">del</span> <span class="n">me</span><span class="p">,</span> <span class="n">them</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">their_team</span>
</span><span id="League-2734"><a href="#League-2734"><span class="linenos">2734</span></a>
</span><span id="League-2735"><a href="#League-2735"><span class="linenos">2735</span></a>        <span class="k">if</span> <span class="n">given_check</span><span class="p">:</span>
</span><span id="League-2736"><a href="#League-2736"><span class="linenos">2736</span></a>            <span class="n">mine</span> <span class="o">=</span> <span class="p">[</span><span class="n">player</span> <span class="k">for</span> <span class="n">player</span> <span class="ow">in</span> <span class="n">given</span> <span class="k">if</span> <span class="n">my_players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="n">player</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">()]</span>
</span><span id="League-2737"><a href="#League-2737"><span class="linenos">2737</span></a>            <span class="n">theirs</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="League-2738"><a href="#League-2738"><span class="linenos">2738</span></a>                <span class="n">player</span> <span class="k">for</span> <span class="n">player</span> <span class="ow">in</span> <span class="n">given</span> <span class="k">if</span> <span class="n">their_players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="n">player</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
</span><span id="League-2739"><a href="#League-2739"><span class="linenos">2739</span></a>            <span class="p">]</span>
</span><span id="League-2740"><a href="#League-2740"><span class="linenos">2740</span></a>            <span class="n">their_team</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League-2741"><a href="#League-2741"><span class="linenos">2741</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">theirs</span><span class="p">),</span> <span class="s2">&quot;fantasy_team&quot;</span>
</span><span id="League-2742"><a href="#League-2742"><span class="linenos">2742</span></a>            <span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League-2743"><a href="#League-2743"><span class="linenos">2743</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">mine</span><span class="p">),</span> <span class="s2">&quot;fantasy_team&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">their_team</span>
</span><span id="League-2744"><a href="#League-2744"><span class="linenos">2744</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">theirs</span><span class="p">),</span> <span class="s2">&quot;fantasy_team&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">team_name</span>
</span><span id="League-2745"><a href="#League-2745"><span class="linenos">2745</span></a>
</span><span id="League-2746"><a href="#League-2746"><span class="linenos">2746</span></a>        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="League-2747"><a href="#League-2747"><span class="linenos">2747</span></a>            <span class="s2">&quot;wins_avg&quot;</span><span class="p">,</span>
</span><span id="League-2748"><a href="#League-2748"><span class="linenos">2748</span></a>            <span class="s2">&quot;wins_stdev&quot;</span><span class="p">,</span>
</span><span id="League-2749"><a href="#League-2749"><span class="linenos">2749</span></a>            <span class="s2">&quot;points_avg&quot;</span><span class="p">,</span>
</span><span id="League-2750"><a href="#League-2750"><span class="linenos">2750</span></a>            <span class="s2">&quot;points_stdev&quot;</span><span class="p">,</span>
</span><span id="League-2751"><a href="#League-2751"><span class="linenos">2751</span></a>            <span class="s2">&quot;per_game_avg&quot;</span><span class="p">,</span>
</span><span id="League-2752"><a href="#League-2752"><span class="linenos">2752</span></a>            <span class="s2">&quot;per_game_stdev&quot;</span><span class="p">,</span>
</span><span id="League-2753"><a href="#League-2753"><span class="linenos">2753</span></a>            <span class="s2">&quot;per_game_fano&quot;</span><span class="p">,</span>
</span><span id="League-2754"><a href="#League-2754"><span class="linenos">2754</span></a>            <span class="s2">&quot;playoffs&quot;</span><span class="p">,</span>
</span><span id="League-2755"><a href="#League-2755"><span class="linenos">2755</span></a>            <span class="s2">&quot;playoff_bye&quot;</span><span class="p">,</span>
</span><span id="League-2756"><a href="#League-2756"><span class="linenos">2756</span></a>        <span class="p">]</span> <span class="o">+</span> <span class="p">([</span><span class="s2">&quot;winner&quot;</span><span class="p">,</span> <span class="s2">&quot;runner_up&quot;</span><span class="p">,</span> <span class="s2">&quot;third&quot;</span><span class="p">,</span> <span class="s2">&quot;earnings&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">postseason</span> <span class="k">else</span> <span class="p">[]):</span>
</span><span id="League-2757"><a href="#League-2757"><span class="linenos">2757</span></a>            <span class="n">my_added_value</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">-=</span> <span class="n">orig_standings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League-2758"><a href="#League-2758"><span class="linenos">2758</span></a>                <span class="n">orig_standings</span><span class="o">.</span><span class="n">team</span> <span class="o">==</span> <span class="n">team_name</span><span class="p">,</span> <span class="n">col</span>
</span><span id="League-2759"><a href="#League-2759"><span class="linenos">2759</span></a>            <span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League-2760"><a href="#League-2760"><span class="linenos">2760</span></a>            <span class="n">my_added_value</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">my_added_value</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="mi">4</span><span class="p">)</span>
</span><span id="League-2761"><a href="#League-2761"><span class="linenos">2761</span></a>        <span class="k">for</span> <span class="n">their_team</span> <span class="ow">in</span> <span class="n">their_added_value</span><span class="o">.</span><span class="n">team</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
</span><span id="League-2762"><a href="#League-2762"><span class="linenos">2762</span></a>            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="League-2763"><a href="#League-2763"><span class="linenos">2763</span></a>                <span class="s2">&quot;wins_avg&quot;</span><span class="p">,</span>
</span><span id="League-2764"><a href="#League-2764"><span class="linenos">2764</span></a>                <span class="s2">&quot;wins_stdev&quot;</span><span class="p">,</span>
</span><span id="League-2765"><a href="#League-2765"><span class="linenos">2765</span></a>                <span class="s2">&quot;points_avg&quot;</span><span class="p">,</span>
</span><span id="League-2766"><a href="#League-2766"><span class="linenos">2766</span></a>                <span class="s2">&quot;points_stdev&quot;</span><span class="p">,</span>
</span><span id="League-2767"><a href="#League-2767"><span class="linenos">2767</span></a>                <span class="s2">&quot;per_game_avg&quot;</span><span class="p">,</span>
</span><span id="League-2768"><a href="#League-2768"><span class="linenos">2768</span></a>                <span class="s2">&quot;per_game_stdev&quot;</span><span class="p">,</span>
</span><span id="League-2769"><a href="#League-2769"><span class="linenos">2769</span></a>                <span class="s2">&quot;per_game_fano&quot;</span><span class="p">,</span>
</span><span id="League-2770"><a href="#League-2770"><span class="linenos">2770</span></a>                <span class="s2">&quot;playoffs&quot;</span><span class="p">,</span>
</span><span id="League-2771"><a href="#League-2771"><span class="linenos">2771</span></a>                <span class="s2">&quot;playoff_bye&quot;</span><span class="p">,</span>
</span><span id="League-2772"><a href="#League-2772"><span class="linenos">2772</span></a>            <span class="p">]</span> <span class="o">+</span> <span class="p">([</span><span class="s2">&quot;winner&quot;</span><span class="p">,</span> <span class="s2">&quot;runner_up&quot;</span><span class="p">,</span> <span class="s2">&quot;third&quot;</span><span class="p">,</span> <span class="s2">&quot;earnings&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">postseason</span> <span class="k">else</span> <span class="p">[]):</span>
</span><span id="League-2773"><a href="#League-2773"><span class="linenos">2773</span></a>                <span class="n">their_added_value</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League-2774"><a href="#League-2774"><span class="linenos">2774</span></a>                    <span class="n">their_added_value</span><span class="o">.</span><span class="n">team</span> <span class="o">==</span> <span class="n">their_team</span><span class="p">,</span> <span class="n">col</span>
</span><span id="League-2775"><a href="#League-2775"><span class="linenos">2775</span></a>                <span class="p">]</span> <span class="o">-=</span> <span class="n">orig_standings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">orig_standings</span><span class="o">.</span><span class="n">team</span> <span class="o">==</span> <span class="n">their_team</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span>
</span><span id="League-2776"><a href="#League-2776"><span class="linenos">2776</span></a>                    <span class="mi">0</span>
</span><span id="League-2777"><a href="#League-2777"><span class="linenos">2777</span></a>                <span class="p">]</span>
</span><span id="League-2778"><a href="#League-2778"><span class="linenos">2778</span></a>                <span class="n">their_added_value</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">their_added_value</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="mi">4</span><span class="p">)</span>
</span><span id="League-2779"><a href="#League-2779"><span class="linenos">2779</span></a>        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="League-2780"><a href="#League-2780"><span class="linenos">2780</span></a>            <span class="s2">&quot;team&quot;</span><span class="p">,</span>
</span><span id="League-2781"><a href="#League-2781"><span class="linenos">2781</span></a>            <span class="s2">&quot;wins_avg&quot;</span><span class="p">,</span>
</span><span id="League-2782"><a href="#League-2782"><span class="linenos">2782</span></a>            <span class="s2">&quot;wins_stdev&quot;</span><span class="p">,</span>
</span><span id="League-2783"><a href="#League-2783"><span class="linenos">2783</span></a>            <span class="s2">&quot;points_avg&quot;</span><span class="p">,</span>
</span><span id="League-2784"><a href="#League-2784"><span class="linenos">2784</span></a>            <span class="s2">&quot;points_stdev&quot;</span><span class="p">,</span>
</span><span id="League-2785"><a href="#League-2785"><span class="linenos">2785</span></a>            <span class="s2">&quot;per_game_avg&quot;</span><span class="p">,</span>
</span><span id="League-2786"><a href="#League-2786"><span class="linenos">2786</span></a>            <span class="s2">&quot;per_game_stdev&quot;</span><span class="p">,</span>
</span><span id="League-2787"><a href="#League-2787"><span class="linenos">2787</span></a>            <span class="s2">&quot;per_game_fano&quot;</span><span class="p">,</span>
</span><span id="League-2788"><a href="#League-2788"><span class="linenos">2788</span></a>            <span class="s2">&quot;playoffs&quot;</span><span class="p">,</span>
</span><span id="League-2789"><a href="#League-2789"><span class="linenos">2789</span></a>            <span class="s2">&quot;playoff_bye&quot;</span><span class="p">,</span>
</span><span id="League-2790"><a href="#League-2790"><span class="linenos">2790</span></a>        <span class="p">]</span> <span class="o">+</span> <span class="p">([</span><span class="s2">&quot;winner&quot;</span><span class="p">,</span> <span class="s2">&quot;runner_up&quot;</span><span class="p">,</span> <span class="s2">&quot;third&quot;</span><span class="p">,</span> <span class="s2">&quot;earnings&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">postseason</span> <span class="k">else</span> <span class="p">[]):</span>
</span><span id="League-2791"><a href="#League-2791"><span class="linenos">2791</span></a>            <span class="n">my_added_value</span> <span class="o">=</span> <span class="n">my_added_value</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
</span><span id="League-2792"><a href="#League-2792"><span class="linenos">2792</span></a>                <span class="n">index</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">col</span><span class="p">:</span> <span class="s2">&quot;my_&quot;</span> <span class="o">+</span> <span class="n">col</span><span class="p">}</span>
</span><span id="League-2793"><a href="#League-2793"><span class="linenos">2793</span></a>            <span class="p">)</span>
</span><span id="League-2794"><a href="#League-2794"><span class="linenos">2794</span></a>            <span class="n">their_added_value</span> <span class="o">=</span> <span class="n">their_added_value</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
</span><span id="League-2795"><a href="#League-2795"><span class="linenos">2795</span></a>                <span class="n">index</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">col</span><span class="p">:</span> <span class="s2">&quot;their_&quot;</span> <span class="o">+</span> <span class="n">col</span><span class="p">}</span>
</span><span id="League-2796"><a href="#League-2796"><span class="linenos">2796</span></a>            <span class="p">)</span>
</span><span id="League-2797"><a href="#League-2797"><span class="linenos">2797</span></a>        <span class="n">added_value</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League-2798"><a href="#League-2798"><span class="linenos">2798</span></a>            <span class="n">left</span><span class="o">=</span><span class="n">my_added_value</span><span class="p">,</span>
</span><span id="League-2799"><a href="#League-2799"><span class="linenos">2799</span></a>            <span class="n">right</span><span class="o">=</span><span class="n">their_added_value</span><span class="p">,</span>
</span><span id="League-2800"><a href="#League-2800"><span class="linenos">2800</span></a>            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">,</span>
</span><span id="League-2801"><a href="#League-2801"><span class="linenos">2801</span></a>            <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;player_to_trade_away&quot;</span><span class="p">,</span> <span class="s2">&quot;player_to_trade_for&quot;</span><span class="p">],</span>
</span><span id="League-2802"><a href="#League-2802"><span class="linenos">2802</span></a>        <span class="p">)</span>
</span><span id="League-2803"><a href="#League-2803"><span class="linenos">2803</span></a>        <span class="n">added_value</span> <span class="o">=</span> <span class="n">added_value</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
</span><span id="League-2804"><a href="#League-2804"><span class="linenos">2804</span></a>            <span class="n">by</span><span class="o">=</span><span class="s2">&quot;my_winner&quot;</span> <span class="k">if</span> <span class="n">postseason</span> <span class="k">else</span> <span class="s2">&quot;playoffs&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span>
</span><span id="League-2805"><a href="#League-2805"><span class="linenos">2805</span></a>        <span class="p">)</span>
</span><span id="League-2806"><a href="#League-2806"><span class="linenos">2806</span></a>        <span class="k">return</span> <span class="n">added_value</span>
</span><span id="League-2807"><a href="#League-2807"><span class="linenos">2807</span></a>
</span><span id="League-2808"><a href="#League-2808"><span class="linenos">2808</span></a>    <span class="k">def</span> <span class="nf">perGameDelta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">team_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">postseason</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">payouts</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">800</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">100</span><span class="p">]):</span>
</span><span id="League-2809"><a href="#League-2809"><span class="linenos">2809</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="League-2810"><a href="#League-2810"><span class="linenos">2810</span></a><span class="sd">        Simulates the remainder of the season and compares it to a simulation </span>
</span><span id="League-2811"><a href="#League-2811"><span class="linenos">2811</span></a><span class="sd">        of the season given one team winning or losing each matchup.</span>
</span><span id="League-2812"><a href="#League-2812"><span class="linenos">2812</span></a>
</span><span id="League-2813"><a href="#League-2813"><span class="linenos">2813</span></a><span class="sd">        Args:</span>
</span><span id="League-2814"><a href="#League-2814"><span class="linenos">2814</span></a><span class="sd">            team_name (str, optional): name of team to analyze matchup values for, defaults to None (and therefore team of interest).  </span>
</span><span id="League-2815"><a href="#League-2815"><span class="linenos">2815</span></a><span class="sd">            postseason (bool, optional): whether to analyze postseason gains or just regular season, defaults to True.  </span>
</span><span id="League-2816"><a href="#League-2816"><span class="linenos">2816</span></a><span class="sd">            payouts (list, optional): list of payout amounts for top three finishers, defaults to [800, 300, 100].</span>
</span><span id="League-2817"><a href="#League-2817"><span class="linenos">2817</span></a>
</span><span id="League-2818"><a href="#League-2818"><span class="linenos">2818</span></a><span class="sd">        Returns:</span>
</span><span id="League-2819"><a href="#League-2819"><span class="linenos">2819</span></a><span class="sd">            pd.DataFrame: dataframe containing the impact and value of every matchup during the week of interest.</span>
</span><span id="League-2820"><a href="#League-2820"><span class="linenos">2820</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="League-2821"><a href="#League-2821"><span class="linenos">2821</span></a>        <span class="n">as_of</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">season</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">week</span>
</span><span id="League-2822"><a href="#League-2822"><span class="linenos">2822</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_oauth</span><span class="p">()</span>
</span><span id="League-2823"><a href="#League-2823"><span class="linenos">2823</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">team_name</span><span class="p">:</span>
</span><span id="League-2824"><a href="#League-2824"><span class="linenos">2824</span></a>            <span class="n">team_name</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="League-2825"><a href="#League-2825"><span class="linenos">2825</span></a>                <span class="n">team</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
</span><span id="League-2826"><a href="#League-2826"><span class="linenos">2826</span></a>                <span class="k">for</span> <span class="n">team</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">teams</span>
</span><span id="League-2827"><a href="#League-2827"><span class="linenos">2827</span></a>                <span class="k">if</span> <span class="n">team</span><span class="p">[</span><span class="s2">&quot;team_key&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">lg</span><span class="o">.</span><span class="n">team_key</span><span class="p">()</span>
</span><span id="League-2828"><a href="#League-2828"><span class="linenos">2828</span></a>            <span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League-2829"><a href="#League-2829"><span class="linenos">2829</span></a>        <span class="n">deltas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">season_sims</span><span class="p">(</span><span class="n">postseason</span><span class="p">,</span> <span class="n">payouts</span><span class="p">)[</span><span class="mi">1</span><span class="p">][[</span><span class="s2">&quot;team&quot;</span><span class="p">,</span> <span class="s2">&quot;earnings&quot;</span><span class="p">]]</span>
</span><span id="League-2830"><a href="#League-2830"><span class="linenos">2830</span></a>        <span class="k">for</span> <span class="n">team</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">fantasy_team</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
</span><span id="League-2831"><a href="#League-2831"><span class="linenos">2831</span></a>            <span class="n">new_standings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">season_sims</span><span class="p">(</span>
</span><span id="League-2832"><a href="#League-2832"><span class="linenos">2832</span></a>                <span class="n">postseason</span><span class="p">,</span> <span class="n">payouts</span><span class="p">,</span> <span class="n">fixed_winner</span><span class="o">=</span><span class="p">[</span><span class="n">as_of</span> <span class="o">%</span> <span class="mi">100</span><span class="p">,</span> <span class="n">team</span><span class="p">]</span>
</span><span id="League-2833"><a href="#League-2833"><span class="linenos">2833</span></a>            <span class="p">)[</span><span class="mi">1</span><span class="p">][[</span><span class="s2">&quot;team&quot;</span><span class="p">,</span> <span class="s2">&quot;earnings&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;earnings&quot;</span><span class="p">:</span> <span class="s2">&quot;earnings_new&quot;</span><span class="p">})</span>
</span><span id="League-2834"><a href="#League-2834"><span class="linenos">2834</span></a>            <span class="n">deltas</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">deltas</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">new_standings</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;team&quot;</span><span class="p">)</span>
</span><span id="League-2835"><a href="#League-2835"><span class="linenos">2835</span></a>            <span class="n">deltas</span><span class="p">[</span><span class="n">team</span><span class="p">]</span> <span class="o">=</span> <span class="n">deltas</span><span class="p">[</span><span class="s2">&quot;earnings_new&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">deltas</span><span class="p">[</span><span class="s2">&quot;earnings&quot;</span><span class="p">]</span>
</span><span id="League-2836"><a href="#League-2836"><span class="linenos">2836</span></a>            <span class="k">del</span> <span class="n">deltas</span><span class="p">[</span><span class="s2">&quot;earnings_new&quot;</span><span class="p">]</span>
</span><span id="League-2837"><a href="#League-2837"><span class="linenos">2837</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">deltas</span><span class="p">[[</span><span class="s2">&quot;team&quot;</span><span class="p">,</span> <span class="n">team</span><span class="p">]]</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
</span><span id="League-2838"><a href="#League-2838"><span class="linenos">2838</span></a>        <span class="k">del</span> <span class="n">deltas</span><span class="p">[</span><span class="s2">&quot;earnings&quot;</span><span class="p">]</span>
</span><span id="League-2839"><a href="#League-2839"><span class="linenos">2839</span></a>        <span class="k">return</span> <span class="p">(</span>
</span><span id="League-2840"><a href="#League-2840"><span class="linenos">2840</span></a>            <span class="n">deltas</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;team&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;index&quot;</span><span class="p">:</span> <span class="s2">&quot;winner&quot;</span><span class="p">})</span>
</span><span id="League-2841"><a href="#League-2841"><span class="linenos">2841</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>League class that gathers all relevant settings and statistics
to simulate and assess the fantasy league in question.</p>

<p>Attributes: <br />
    season: integer specifying the season of interest <br />
    week: integer specifiying the week of interest <br />
    oauth: yahoo_oauth object contain user credentials and auth tokens <br />
    lg: yahoo_fantasy_api league object used to connect to Yahoo's API <br />
    gm: yahoo_fantasy_api game object used to connect to Yahoo's API <br />
    name: string specifying the name of the fantasy to be analyzed <br />
    settings: dictionary containing the scheduling and roster settings for the league in question <br />
    scoring: dictionary containing the scoring categories and values for the league in question <br />
    teams: list of dictionaries containing identifiers for each fantasy team in the league <br />
    nfl_teams: dataframe containing different identifiers for each NFL team <br />
    nfl_schedule: dataframe containing NFL schedules throughout the years with elo statistics for both teams <br />
    players: dataframe containing demographics and rates for current NFL players <br />
    num_sims: integer specifying the number of Monte Carlo simulations to run <br />
    earliest: integer describing the earliest week to pull statistics from (YYYYWW) <br />
    reference_games: integer describing the number of games to use as a prior for rates <br />
    basaloppstringtime: list of the four weighting factors when calculating rates <br />
    schedule: dataframe containing the fantasy schedule for the league and season in question</p>
</div>


                            <div id="League.__init__" class="classattr">
                                        <input id="League.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">League</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">season</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">week</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">injurytries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span>,</span><span class="param">	<span class="n">num_sims</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10000</span>,</span><span class="param">	<span class="n">earliest</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">reference_games</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">basaloppstringtime</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span>,</span><span class="param">	<span class="n">sfb</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">bestball</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span></span>)</span>

                <label class="view-source-button" for="League.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#League.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="League.__init__-59"><a href="#League.__init__-59"><span class="linenos"> 59</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="League.__init__-60"><a href="#League.__init__-60"><span class="linenos"> 60</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="League.__init__-61"><a href="#League.__init__-61"><span class="linenos"> 61</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="League.__init__-62"><a href="#League.__init__-62"><span class="linenos"> 62</span></a>        <span class="n">season</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="League.__init__-63"><a href="#League.__init__-63"><span class="linenos"> 63</span></a>        <span class="n">week</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="League.__init__-64"><a href="#League.__init__-64"><span class="linenos"> 64</span></a>        <span class="n">injurytries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="League.__init__-65"><a href="#League.__init__-65"><span class="linenos"> 65</span></a>        <span class="n">num_sims</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">,</span>
</span><span id="League.__init__-66"><a href="#League.__init__-66"><span class="linenos"> 66</span></a>        <span class="n">earliest</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="League.__init__-67"><a href="#League.__init__-67"><span class="linenos"> 67</span></a>        <span class="n">reference_games</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="League.__init__-68"><a href="#League.__init__-68"><span class="linenos"> 68</span></a>        <span class="n">basaloppstringtime</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[],</span>
</span><span id="League.__init__-69"><a href="#League.__init__-69"><span class="linenos"> 69</span></a>        <span class="n">sfb</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="League.__init__-70"><a href="#League.__init__-70"><span class="linenos"> 70</span></a>        <span class="n">bestball</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="League.__init__-71"><a href="#League.__init__-71"><span class="linenos"> 71</span></a>    <span class="p">):</span>
</span><span id="League.__init__-72"><a href="#League.__init__-72"><span class="linenos"> 72</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="League.__init__-73"><a href="#League.__init__-73"><span class="linenos"> 73</span></a><span class="sd">        Initializes a League object using the parameters provided and class functions defined below.</span>
</span><span id="League.__init__-74"><a href="#League.__init__-74"><span class="linenos"> 74</span></a>
</span><span id="League.__init__-75"><a href="#League.__init__-75"><span class="linenos"> 75</span></a><span class="sd">        Args:</span>
</span><span id="League.__init__-76"><a href="#League.__init__-76"><span class="linenos"> 76</span></a><span class="sd">            name (str, optional): string describing the name of the fantasy team in question, defaults to None.  </span>
</span><span id="League.__init__-77"><a href="#League.__init__-77"><span class="linenos"> 77</span></a><span class="sd">            season (int, optional): integer specifying the season of interest, defaults to None.  </span>
</span><span id="League.__init__-78"><a href="#League.__init__-78"><span class="linenos"> 78</span></a><span class="sd">            week (int, optional): integer specifiying the week of interest, defaults to None.  </span>
</span><span id="League.__init__-79"><a href="#League.__init__-79"><span class="linenos"> 79</span></a><span class="sd">            injurytries (int, optional): integer specifying the number of attempts to pull injury statuses, defaults to 10.  </span>
</span><span id="League.__init__-80"><a href="#League.__init__-80"><span class="linenos"> 80</span></a><span class="sd">            num_sims (int, optional): integer specifying the number of Monte Carlo simulations to run, defaults to 10000.  </span>
</span><span id="League.__init__-81"><a href="#League.__init__-81"><span class="linenos"> 81</span></a><span class="sd">            earliest (int, optional): integer describing the earliest week to pull statistics from (YYYYWW), defaults to None.  </span>
</span><span id="League.__init__-82"><a href="#League.__init__-82"><span class="linenos"> 82</span></a><span class="sd">            reference_games (int, optional): integer describing the number of games to use as a prior for rates, defaults to None.  </span>
</span><span id="League.__init__-83"><a href="#League.__init__-83"><span class="linenos"> 83</span></a><span class="sd">            basaloppstringtime (list, optional): list of the four weighting factors when calculating rates, defaults to an empty list.  </span>
</span><span id="League.__init__-84"><a href="#League.__init__-84"><span class="linenos"> 84</span></a><span class="sd">            sfb (bool, optional): whether to implement SFB13 settings and scoring, defaults to False.  </span>
</span><span id="League.__init__-85"><a href="#League.__init__-85"><span class="linenos"> 85</span></a><span class="sd">            bestball (str, optional): which platform to use when implementing best ball settings/scoring, defaults to a blank string (no bestball).</span>
</span><span id="League.__init__-86"><a href="#League.__init__-86"><span class="linenos"> 86</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="League.__init__-87"><a href="#League.__init__-87"><span class="linenos"> 87</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">latest_season</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">year</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">month</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">)</span>
</span><span id="League.__init__-88"><a href="#League.__init__-88"><span class="linenos"> 88</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Year of the most recent season &quot;&quot;&quot;</span>
</span><span id="League.__init__-89"><a href="#League.__init__-89"><span class="linenos"> 89</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">season</span> <span class="o">=</span> <span class="n">season</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">season</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">latest_season</span>
</span><span id="League.__init__-90"><a href="#League.__init__-90"><span class="linenos"> 90</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Season of interest, defaults to most recent season when no value is provided &quot;&quot;&quot;</span>
</span><span id="League.__init__-91"><a href="#League.__init__-91"><span class="linenos"> 91</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">load_credentials</span><span class="p">()</span>
</span><span id="League.__init__-92"><a href="#League.__init__-92"><span class="linenos"> 92</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">load_oauth</span><span class="p">()</span>
</span><span id="League.__init__-93"><a href="#League.__init__-93"><span class="linenos"> 93</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">load_league</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</span><span id="League.__init__-94"><a href="#League.__init__-94"><span class="linenos"> 94</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">current_week</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lg</span><span class="o">.</span><span class="n">current_week</span><span class="p">()</span>
</span><span id="League.__init__-95"><a href="#League.__init__-95"><span class="linenos"> 95</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Most recent week of the season of interest &quot;&quot;&quot;</span>
</span><span id="League.__init__-96"><a href="#League.__init__-96"><span class="linenos"> 96</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">week</span> <span class="o">=</span> <span class="n">week</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">week</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_week</span>
</span><span id="League.__init__-97"><a href="#League.__init__-97"><span class="linenos"> 97</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Week of interest during the season of interest, defaults to most recent week &quot;&quot;&quot;</span>
</span><span id="League.__init__-98"><a href="#League.__init__-98"><span class="linenos"> 98</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">load_settings</span><span class="p">(</span><span class="n">sfb</span><span class="p">,</span> <span class="n">bestball</span><span class="p">)</span>
</span><span id="League.__init__-99"><a href="#League.__init__-99"><span class="linenos"> 99</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">load_fantasy_teams</span><span class="p">()</span>
</span><span id="League.__init__-100"><a href="#League.__init__-100"><span class="linenos">100</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">load_nfl_abbrevs</span><span class="p">()</span>
</span><span id="League.__init__-101"><a href="#League.__init__-101"><span class="linenos">101</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">load_nfl_schedule</span><span class="p">()</span>
</span><span id="League.__init__-102"><a href="#League.__init__-102"><span class="linenos">102</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">get_yahoo_players</span><span class="p">(</span><span class="n">injurytries</span><span class="p">)</span>
</span><span id="League.__init__-103"><a href="#League.__init__-103"><span class="linenos">103</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">get_fantasy_rosters</span><span class="p">()</span>
</span><span id="League.__init__-104"><a href="#League.__init__-104"><span class="linenos">104</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name_corrections</span><span class="p">()</span>
</span><span id="League.__init__-105"><a href="#League.__init__-105"><span class="linenos">105</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">get_player_ids</span><span class="p">()</span>
</span><span id="League.__init__-106"><a href="#League.__init__-106"><span class="linenos">106</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_injuries</span><span class="p">()</span>
</span><span id="League.__init__-107"><a href="#League.__init__-107"><span class="linenos">107</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_bye_weeks</span><span class="p">()</span>
</span><span id="League.__init__-108"><a href="#League.__init__-108"><span class="linenos">108</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_roster_pcts</span><span class="p">()</span>
</span><span id="League.__init__-109"><a href="#League.__init__-109"><span class="linenos">109</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_depth_charts</span><span class="p">()</span>
</span><span id="League.__init__-110"><a href="#League.__init__-110"><span class="linenos">110</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">load_parameters</span><span class="p">(</span><span class="n">earliest</span><span class="p">,</span> <span class="n">reference_games</span><span class="p">,</span> <span class="n">basaloppstringtime</span><span class="p">)</span>
</span><span id="League.__init__-111"><a href="#League.__init__-111"><span class="linenos">111</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">num_sims</span> <span class="o">=</span> <span class="n">num_sims</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">num_sims</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span> <span class="k">else</span> <span class="mi">10000</span>
</span><span id="League.__init__-112"><a href="#League.__init__-112"><span class="linenos">112</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Number of simulations to run when assessing the league of interest &quot;&quot;&quot;</span>
</span><span id="League.__init__-113"><a href="#League.__init__-113"><span class="linenos">113</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">get_rates</span><span class="p">()</span>
</span><span id="League.__init__-114"><a href="#League.__init__-114"><span class="linenos">114</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">war_sim</span><span class="p">()</span>
</span><span id="League.__init__-115"><a href="#League.__init__-115"><span class="linenos">115</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">get_schedule</span><span class="p">()</span>
</span><span id="League.__init__-116"><a href="#League.__init__-116"><span class="linenos">116</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">starters</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">week</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Initializes a League object using the parameters provided and class functions defined below.</p>

<p>Args:
    name (str, optional): string describing the name of the fantasy team in question, defaults to None. <br />
    season (int, optional): integer specifying the season of interest, defaults to None. <br />
    week (int, optional): integer specifiying the week of interest, defaults to None. <br />
    injurytries (int, optional): integer specifying the number of attempts to pull injury statuses, defaults to 10. <br />
    num_sims (int, optional): integer specifying the number of Monte Carlo simulations to run, defaults to 10000. <br />
    earliest (int, optional): integer describing the earliest week to pull statistics from (YYYYWW), defaults to None. <br />
    reference_games (int, optional): integer describing the number of games to use as a prior for rates, defaults to None. <br />
    basaloppstringtime (list, optional): list of the four weighting factors when calculating rates, defaults to an empty list. <br />
    sfb (bool, optional): whether to implement SFB13 settings and scoring, defaults to False. <br />
    bestball (str, optional): which platform to use when implementing best ball settings/scoring, defaults to a blank string (no bestball).</p>
</div>


                            </div>
                            <div id="League.latest_season" class="classattr">
                                <div class="attr variable">
            <span class="name">latest_season</span>

        
    </div>
    <a class="headerlink" href="#League.latest_season"></a>
    
            <div class="docstring"><p>Year of the most recent season</p>
</div>


                            </div>
                            <div id="League.season" class="classattr">
                                <div class="attr variable">
            <span class="name">season</span>

        
    </div>
    <a class="headerlink" href="#League.season"></a>
    
            <div class="docstring"><p>Season of interest, defaults to most recent season when no value is provided</p>
</div>


                            </div>
                            <div id="League.current_week" class="classattr">
                                <div class="attr variable">
            <span class="name">current_week</span>

        
    </div>
    <a class="headerlink" href="#League.current_week"></a>
    
            <div class="docstring"><p>Most recent week of the season of interest</p>
</div>


                            </div>
                            <div id="League.week" class="classattr">
                                <div class="attr variable">
            <span class="name">week</span>

        
    </div>
    <a class="headerlink" href="#League.week"></a>
    
            <div class="docstring"><p>Week of interest during the season of interest, defaults to most recent week</p>
</div>


                            </div>
                            <div id="League.num_sims" class="classattr">
                                <div class="attr variable">
            <span class="name">num_sims</span>

        
    </div>
    <a class="headerlink" href="#League.num_sims"></a>
    
            <div class="docstring"><p>Number of simulations to run when assessing the league of interest</p>
</div>


                            </div>
                            <div id="League.load_credentials" class="classattr">
                                        <input id="League.load_credentials-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">load_credentials</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="League.load_credentials-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#League.load_credentials"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="League.load_credentials-118"><a href="#League.load_credentials-118"><span class="linenos">118</span></a>    <span class="k">def</span> <span class="nf">load_credentials</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="League.load_credentials-119"><a href="#League.load_credentials-119"><span class="linenos">119</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="League.load_credentials-120"><a href="#League.load_credentials-120"><span class="linenos">120</span></a><span class="sd">        Loads user credentials from the .env file, specifically the Yahoo consumer key/secret</span>
</span><span id="League.load_credentials-121"><a href="#League.load_credentials-121"><span class="linenos">121</span></a><span class="sd">        and email credentials to use when emailing a copy of the results to the user.</span>
</span><span id="League.load_credentials-122"><a href="#League.load_credentials-122"><span class="linenos">122</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="League.load_credentials-123"><a href="#League.load_credentials-123"><span class="linenos">123</span></a>        <span class="c1"># Loading Yahoo OAuth credentials from environment variables</span>
</span><span id="League.load_credentials-124"><a href="#League.load_credentials-124"><span class="linenos">124</span></a>        <span class="n">load_dotenv</span><span class="p">()</span>
</span><span id="League.load_credentials-125"><a href="#League.load_credentials-125"><span class="linenos">125</span></a>        <span class="k">if</span> <span class="s2">&quot;CONSUMER_KEY&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span> <span class="ow">or</span> <span class="s2">&quot;CONSUMER_SECRET&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
</span><span id="League.load_credentials-126"><a href="#League.load_credentials-126"><span class="linenos">126</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No valid .env file present, copying from .env.example&quot;</span><span class="p">)</span>
</span><span id="League.load_credentials-127"><a href="#League.load_credentials-127"><span class="linenos">127</span></a>            <span class="n">shutil</span><span class="o">.</span><span class="n">copyfile</span><span class="p">(</span><span class="s2">&quot;.env.example&quot;</span><span class="p">,</span> <span class="s2">&quot;.env&quot;</span><span class="p">)</span>
</span><span id="League.load_credentials-128"><a href="#League.load_credentials-128"><span class="linenos">128</span></a>        <span class="c1"># Updating .env file if default values are still present</span>
</span><span id="League.load_credentials-129"><a href="#League.load_credentials-129"><span class="linenos">129</span></a>        <span class="k">if</span> <span class="p">(</span>
</span><span id="League.load_credentials-130"><a href="#League.load_credentials-130"><span class="linenos">130</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;CONSUMER_KEY&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;updatekey&quot;</span>
</span><span id="League.load_credentials-131"><a href="#League.load_credentials-131"><span class="linenos">131</span></a>            <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;CONSUMER_SECRET&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;updatesecret&quot;</span>
</span><span id="League.load_credentials-132"><a href="#League.load_credentials-132"><span class="linenos">132</span></a>        <span class="p">):</span>
</span><span id="League.load_credentials-133"><a href="#League.load_credentials-133"><span class="linenos">133</span></a>            <span class="c1"># Only have to do this once since we&#39;re storing them in environment variables</span>
</span><span id="League.load_credentials-134"><a href="#League.load_credentials-134"><span class="linenos">134</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;It appears you haven&#39;t updated your Yahoo OAuth credentials...&quot;</span><span class="p">)</span>
</span><span id="League.load_credentials-135"><a href="#League.load_credentials-135"><span class="linenos">135</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;To get credentials: https://developer.yahoo.com/apps/create/&quot;</span><span class="p">)</span>
</span><span id="League.load_credentials-136"><a href="#League.load_credentials-136"><span class="linenos">136</span></a>            <span class="n">consumer_key</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Yahoo OAuth Key: &quot;</span><span class="p">)</span>
</span><span id="League.load_credentials-137"><a href="#League.load_credentials-137"><span class="linenos">137</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;sed -i &#39;s/updatekey/</span><span class="si">{}</span><span class="s2">/g&#39; .env&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">consumer_key</span><span class="p">))</span>
</span><span id="League.load_credentials-138"><a href="#League.load_credentials-138"><span class="linenos">138</span></a>            <span class="n">consumer_secret</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Yahoo OAuth Secret: &quot;</span><span class="p">)</span>
</span><span id="League.load_credentials-139"><a href="#League.load_credentials-139"><span class="linenos">139</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;sed -i &#39;s/updatesecret/</span><span class="si">{}</span><span class="s2">/g&#39; .env&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">consumer_secret</span><span class="p">))</span>
</span><span id="League.load_credentials-140"><a href="#League.load_credentials-140"><span class="linenos">140</span></a>            <span class="n">load_dotenv</span><span class="p">()</span>
</span><span id="League.load_credentials-141"><a href="#League.load_credentials-141"><span class="linenos">141</span></a>            <span class="c1"># Previous oauth file is probably bad if it exists, deleting it just in case</span>
</span><span id="League.load_credentials-142"><a href="#League.load_credentials-142"><span class="linenos">142</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;oauth2.json&quot;</span><span class="p">):</span>
</span><span id="League.load_credentials-143"><a href="#League.load_credentials-143"><span class="linenos">143</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;oauth.json&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Loads user credentials from the .env file, specifically the Yahoo consumer key/secret
and email credentials to use when emailing a copy of the results to the user.</p>
</div>


                            </div>
                            <div id="League.load_oauth" class="classattr">
                                        <input id="League.load_oauth-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">load_oauth</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="League.load_oauth-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#League.load_oauth"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="League.load_oauth-145"><a href="#League.load_oauth-145"><span class="linenos">145</span></a>    <span class="k">def</span> <span class="nf">load_oauth</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="League.load_oauth-146"><a href="#League.load_oauth-146"><span class="linenos">146</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="League.load_oauth-147"><a href="#League.load_oauth-147"><span class="linenos">147</span></a><span class="sd">        Initializes an OAuth2 authentication object to connect with Yahoo&#39;s API</span>
</span><span id="League.load_oauth-148"><a href="#League.load_oauth-148"><span class="linenos">148</span></a><span class="sd">        using the credentials loaded above in the load_credentials function.</span>
</span><span id="League.load_oauth-149"><a href="#League.load_oauth-149"><span class="linenos">149</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="League.load_oauth-150"><a href="#League.load_oauth-150"><span class="linenos">150</span></a>        <span class="c1"># Creating oauth file from credentials provided</span>
</span><span id="League.load_oauth-151"><a href="#League.load_oauth-151"><span class="linenos">151</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;oauth2.json&quot;</span><span class="p">):</span>
</span><span id="League.load_oauth-152"><a href="#League.load_oauth-152"><span class="linenos">152</span></a>            <span class="n">creds</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="League.load_oauth-153"><a href="#League.load_oauth-153"><span class="linenos">153</span></a>                <span class="s2">&quot;consumer_key&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;CONSUMER_KEY&quot;</span><span class="p">],</span>
</span><span id="League.load_oauth-154"><a href="#League.load_oauth-154"><span class="linenos">154</span></a>                <span class="s2">&quot;consumer_secret&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;CONSUMER_SECRET&quot;</span><span class="p">],</span>
</span><span id="League.load_oauth-155"><a href="#League.load_oauth-155"><span class="linenos">155</span></a>            <span class="p">}</span>
</span><span id="League.load_oauth-156"><a href="#League.load_oauth-156"><span class="linenos">156</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;oauth2.json&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="League.load_oauth-157"><a href="#League.load_oauth-157"><span class="linenos">157</span></a>                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">creds</span><span class="p">))</span>
</span><span id="League.load_oauth-158"><a href="#League.load_oauth-158"><span class="linenos">158</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">oauth</span> <span class="o">=</span> <span class="n">OAuth2</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">from_file</span><span class="o">=</span><span class="s2">&quot;oauth2.json&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Initializes an OAuth2 authentication object to connect with Yahoo's API
using the credentials loaded above in the load_credentials function.</p>
</div>


                            </div>
                            <div id="League.load_league" class="classattr">
                                        <input id="League.load_league-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">load_league</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="League.load_league-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#League.load_league"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="League.load_league-160"><a href="#League.load_league-160"><span class="linenos">160</span></a>    <span class="k">def</span> <span class="nf">load_league</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="League.load_league-161"><a href="#League.load_league-161"><span class="linenos">161</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="League.load_league-162"><a href="#League.load_league-162"><span class="linenos">162</span></a><span class="sd">        Initializes yahoo_fantasy_api game and league objects used to query Yahoo&#39;s API</span>
</span><span id="League.load_league-163"><a href="#League.load_league-163"><span class="linenos">163</span></a><span class="sd">        for details about the league in question. Also identifies fantasy team name and </span>
</span><span id="League.load_league-164"><a href="#League.load_league-164"><span class="linenos">164</span></a><span class="sd">        fantasy league id for future reference throughout the script.</span>
</span><span id="League.load_league-165"><a href="#League.load_league-165"><span class="linenos">165</span></a>
</span><span id="League.load_league-166"><a href="#League.load_league-166"><span class="linenos">166</span></a><span class="sd">        Args:</span>
</span><span id="League.load_league-167"><a href="#League.load_league-167"><span class="linenos">167</span></a><span class="sd">            name (str, optional): string specifiying the name of the team of interest </span>
</span><span id="League.load_league-168"><a href="#League.load_league-168"><span class="linenos">168</span></a><span class="sd">            in case a user has multiple leagues, defaults to None.</span>
</span><span id="League.load_league-169"><a href="#League.load_league-169"><span class="linenos">169</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="League.load_league-170"><a href="#League.load_league-170"><span class="linenos">170</span></a>        <span class="c1"># Pulling user&#39;s Yahoo fantasy games</span>
</span><span id="League.load_league-171"><a href="#League.load_league-171"><span class="linenos">171</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gm</span> <span class="o">=</span> <span class="n">yfa</span><span class="o">.</span><span class="n">Game</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">oauth</span><span class="p">,</span> <span class="s2">&quot;nfl&quot;</span><span class="p">)</span>
</span><span id="League.load_league-172"><a href="#League.load_league-172"><span class="linenos">172</span></a>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="League.load_league-173"><a href="#League.load_league-173"><span class="linenos">173</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="League.load_league-174"><a href="#League.load_league-174"><span class="linenos">174</span></a>                <span class="n">profile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gm</span><span class="o">.</span><span class="n">yhandler</span><span class="o">.</span><span class="n">get_teams_raw</span><span class="p">()[</span><span class="s2">&quot;fantasy_content&quot;</span><span class="p">]</span>
</span><span id="League.load_league-175"><a href="#League.load_league-175"><span class="linenos">175</span></a>                <span class="n">leagues</span> <span class="o">=</span> <span class="n">profile</span><span class="p">[</span><span class="s2">&quot;users&quot;</span><span class="p">][</span><span class="s2">&quot;0&quot;</span><span class="p">][</span><span class="s2">&quot;user&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;games&quot;</span><span class="p">]</span>
</span><span id="League.load_league-176"><a href="#League.load_league-176"><span class="linenos">176</span></a>                <span class="k">break</span>
</span><span id="League.load_league-177"><a href="#League.load_league-177"><span class="linenos">177</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="League.load_league-178"><a href="#League.load_league-178"><span class="linenos">178</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="League.load_league-179"><a href="#League.load_league-179"><span class="linenos">179</span></a>                    <span class="s2">&quot;Teams query crapped out... Waiting 30 seconds and trying again...&quot;</span>
</span><span id="League.load_league-180"><a href="#League.load_league-180"><span class="linenos">180</span></a>                <span class="p">)</span>
</span><span id="League.load_league-181"><a href="#League.load_league-181"><span class="linenos">181</span></a>                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
</span><span id="League.load_league-182"><a href="#League.load_league-182"><span class="linenos">182</span></a>        <span class="c1"># Identifying user&#39;s NFL Yahoo fantasy games</span>
</span><span id="League.load_league-183"><a href="#League.load_league-183"><span class="linenos">183</span></a>        <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">leagues</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="League.load_league-184"><a href="#League.load_league-184"><span class="linenos">184</span></a>            <span class="n">game</span> <span class="o">=</span> <span class="n">leagues</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">ind</span><span class="p">)][</span><span class="s2">&quot;game&quot;</span><span class="p">]</span>
</span><span id="League.load_league-185"><a href="#League.load_league-185"><span class="linenos">185</span></a>            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">game</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="League.load_league-186"><a href="#League.load_league-186"><span class="linenos">186</span></a>                <span class="k">continue</span>
</span><span id="League.load_league-187"><a href="#League.load_league-187"><span class="linenos">187</span></a>            <span class="k">if</span> <span class="n">game</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;code&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;nfl&quot;</span> <span class="ow">and</span> <span class="n">game</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;season&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">season</span><span class="p">):</span>
</span><span id="League.load_league-188"><a href="#League.load_league-188"><span class="linenos">188</span></a>                <span class="n">teams</span> <span class="o">=</span> <span class="n">game</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;teams&quot;</span><span class="p">]</span>
</span><span id="League.load_league-189"><a href="#League.load_league-189"><span class="linenos">189</span></a>                <span class="n">details</span> <span class="o">=</span> <span class="p">[</span><span class="n">teams</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">ind</span><span class="p">)][</span><span class="s2">&quot;team&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">teams</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">])]</span>
</span><span id="League.load_league-190"><a href="#League.load_league-190"><span class="linenos">190</span></a>                <span class="n">names</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="League.load_league-191"><a href="#League.load_league-191"><span class="linenos">191</span></a>                    <span class="p">[</span><span class="n">val</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">team</span> <span class="k">if</span> <span class="s2">&quot;name&quot;</span> <span class="ow">in</span> <span class="n">val</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League.load_league-192"><a href="#League.load_league-192"><span class="linenos">192</span></a>                    <span class="k">for</span> <span class="n">team</span> <span class="ow">in</span> <span class="n">details</span>
</span><span id="League.load_league-193"><a href="#League.load_league-193"><span class="linenos">193</span></a>                <span class="p">]</span>
</span><span id="League.load_league-194"><a href="#League.load_league-194"><span class="linenos">194</span></a>                <span class="k">if</span> <span class="n">teams</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="League.load_league-195"><a href="#League.load_league-195"><span class="linenos">195</span></a>                    <span class="c1"># If user has more than one team, use the name input or prompt them to pick one</span>
</span><span id="League.load_league-196"><a href="#League.load_league-196"><span class="linenos">196</span></a>                    <span class="k">while</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
</span><span id="League.load_league-197"><a href="#League.load_league-197"><span class="linenos">197</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Found multiple fantasy teams: &quot;</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">names</span><span class="p">))</span>
</span><span id="League.load_league-198"><a href="#League.load_league-198"><span class="linenos">198</span></a>                        <span class="n">name</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Which team would you like to analyze? &quot;</span><span class="p">)</span>
</span><span id="League.load_league-199"><a href="#League.load_league-199"><span class="linenos">199</span></a>                    <span class="n">team</span> <span class="o">=</span> <span class="n">teams</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">name</span><span class="p">))][</span><span class="s2">&quot;team&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League.load_league-200"><a href="#League.load_league-200"><span class="linenos">200</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="League.load_league-201"><a href="#League.load_league-201"><span class="linenos">201</span></a>                    <span class="c1"># If user has only one team, use that one and override whatever name was given</span>
</span><span id="League.load_league-202"><a href="#League.load_league-202"><span class="linenos">202</span></a>                    <span class="n">team</span> <span class="o">=</span> <span class="n">teams</span><span class="p">[</span><span class="s2">&quot;0&quot;</span><span class="p">][</span><span class="s2">&quot;team&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League.load_league-203"><a href="#League.load_league-203"><span class="linenos">203</span></a>                    <span class="n">name</span> <span class="o">=</span> <span class="n">names</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League.load_league-204"><a href="#League.load_league-204"><span class="linenos">204</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="League.load_league-205"><a href="#League.load_league-205"><span class="linenos">205</span></a>                <span class="n">team_key</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span><span class="p">[</span><span class="s2">&quot;team_key&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">team</span> <span class="k">if</span> <span class="s2">&quot;team_key&quot;</span> <span class="ow">in</span> <span class="n">val</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League.load_league-206"><a href="#League.load_league-206"><span class="linenos">206</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">lg_id</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">team_key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[:</span><span class="mi">3</span><span class="p">])</span>
</span><span id="League.load_league-207"><a href="#League.load_league-207"><span class="linenos">207</span></a>                <span class="k">break</span>
</span><span id="League.load_league-208"><a href="#League.load_league-208"><span class="linenos">208</span></a>        <span class="c1"># Creating league object</span>
</span><span id="League.load_league-209"><a href="#League.load_league-209"><span class="linenos">209</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gm</span><span class="o">.</span><span class="n">to_league</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lg_id</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Initializes yahoo_fantasy_api game and league objects used to query Yahoo's API
for details about the league in question. Also identifies fantasy team name and 
fantasy league id for future reference throughout the script.</p>

<p>Args:
    name (str, optional): string specifiying the name of the team of interest 
    in case a user has multiple leagues, defaults to None.</p>
</div>


                            </div>
                            <div id="League.load_settings" class="classattr">
                                        <input id="League.load_settings-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">load_settings</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">sfb</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>, </span><span class="param"><span class="n">bestball</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="League.load_settings-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#League.load_settings"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="League.load_settings-211"><a href="#League.load_settings-211"><span class="linenos">211</span></a>    <span class="k">def</span> <span class="nf">load_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sfb</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">bestball</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
</span><span id="League.load_settings-212"><a href="#League.load_settings-212"><span class="linenos">212</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="League.load_settings-213"><a href="#League.load_settings-213"><span class="linenos">213</span></a><span class="sd">        Pulls league roster/schedule settings and scoring modifiers</span>
</span><span id="League.load_settings-214"><a href="#League.load_settings-214"><span class="linenos">214</span></a>
</span><span id="League.load_settings-215"><a href="#League.load_settings-215"><span class="linenos">215</span></a><span class="sd">        Args:</span>
</span><span id="League.load_settings-216"><a href="#League.load_settings-216"><span class="linenos">216</span></a><span class="sd">            sfb (bool, optional): whether to use Scott Fish Bowl 13 settings, defaults to False.  </span>
</span><span id="League.load_settings-217"><a href="#League.load_settings-217"><span class="linenos">217</span></a><span class="sd">            bestball (str, optional): which best ball settings to use if desired, defaults to &quot;&quot; (redraft).</span>
</span><span id="League.load_settings-218"><a href="#League.load_settings-218"><span class="linenos">218</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="League.load_settings-219"><a href="#League.load_settings-219"><span class="linenos">219</span></a>        <span class="c1"># Pulling league settings</span>
</span><span id="League.load_settings-220"><a href="#League.load_settings-220"><span class="linenos">220</span></a>        <span class="n">settings_json</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lg</span><span class="o">.</span><span class="n">yhandler</span><span class="o">.</span><span class="n">get_settings_raw</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lg_id</span><span class="p">)</span>
</span><span id="League.load_settings-221"><a href="#League.load_settings-221"><span class="linenos">221</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span> <span class="o">=</span> <span class="n">settings_json</span><span class="p">[</span><span class="s2">&quot;fantasy_content&quot;</span><span class="p">][</span><span class="s2">&quot;league&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;settings&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League.load_settings-222"><a href="#League.load_settings-222"><span class="linenos">222</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;playoff_start_week&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;playoff_start_week&quot;</span><span class="p">])</span>
</span><span id="League.load_settings-223"><a href="#League.load_settings-223"><span class="linenos">223</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;num_playoff_teams&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;num_playoff_teams&quot;</span><span class="p">])</span>
</span><span id="League.load_settings-224"><a href="#League.load_settings-224"><span class="linenos">224</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">roster_spots</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">pos</span><span class="p">[</span><span class="s2">&quot;roster_position&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;roster_positions&quot;</span><span class="p">]])</span>
</span><span id="League.load_settings-225"><a href="#League.load_settings-225"><span class="linenos">225</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">roster_spots</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">roster_spots</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="League.load_settings-226"><a href="#League.load_settings-226"><span class="linenos">226</span></a>        <span class="n">categories</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span><span id="League.load_settings-227"><a href="#League.load_settings-227"><span class="linenos">227</span></a>            <span class="p">[</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;stat&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">stat</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;stat_categories&quot;</span><span class="p">][</span><span class="s2">&quot;stats&quot;</span><span class="p">]]</span>
</span><span id="League.load_settings-228"><a href="#League.load_settings-228"><span class="linenos">228</span></a>        <span class="p">)</span>
</span><span id="League.load_settings-229"><a href="#League.load_settings-229"><span class="linenos">229</span></a>        <span class="n">modifiers</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span><span id="League.load_settings-230"><a href="#League.load_settings-230"><span class="linenos">230</span></a>            <span class="p">[</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;stat&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">stat</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;stat_modifiers&quot;</span><span class="p">][</span><span class="s2">&quot;stats&quot;</span><span class="p">]]</span>
</span><span id="League.load_settings-231"><a href="#League.load_settings-231"><span class="linenos">231</span></a>        <span class="p">)</span>
</span><span id="League.load_settings-232"><a href="#League.load_settings-232"><span class="linenos">232</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League.load_settings-233"><a href="#League.load_settings-233"><span class="linenos">233</span></a>            <span class="n">left</span><span class="o">=</span><span class="n">categories</span><span class="p">,</span>
</span><span id="League.load_settings-234"><a href="#League.load_settings-234"><span class="linenos">234</span></a>            <span class="n">right</span><span class="o">=</span><span class="n">modifiers</span><span class="p">,</span>
</span><span id="League.load_settings-235"><a href="#League.load_settings-235"><span class="linenos">235</span></a>            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">,</span>
</span><span id="League.load_settings-236"><a href="#League.load_settings-236"><span class="linenos">236</span></a>            <span class="n">on</span><span class="o">=</span><span class="s2">&quot;stat_id&quot;</span><span class="p">,</span>
</span><span id="League.load_settings-237"><a href="#League.load_settings-237"><span class="linenos">237</span></a>        <span class="p">)[[</span><span class="s2">&quot;display_name&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">({</span><span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">})</span>
</span><span id="League.load_settings-238"><a href="#League.load_settings-238"><span class="linenos">238</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="o">.</span><span class="n">display_name</span> <span class="o">==</span> <span class="s2">&quot;Int&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="o">.</span><span class="n">value</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">),</span><span class="s2">&quot;display_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Int Thrown&quot;</span>
</span><span id="League.load_settings-239"><a href="#League.load_settings-239"><span class="linenos">239</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;display_name&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;display_name&quot;</span><span class="p">)[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
</span><span id="League.load_settings-240"><a href="#League.load_settings-240"><span class="linenos">240</span></a>        <span class="k">if</span> <span class="n">sfb</span><span class="p">:</span>
</span><span id="League.load_settings-241"><a href="#League.load_settings-241"><span class="linenos">241</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;playoff_start_week&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12</span>
</span><span id="League.load_settings-242"><a href="#League.load_settings-242"><span class="linenos">242</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;num_playoff_teams&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6</span>
</span><span id="League.load_settings-243"><a href="#League.load_settings-243"><span class="linenos">243</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Pass Yds&#39;</span><span class="p">:</span><span class="mf">0.04</span><span class="p">,</span><span class="s1">&#39;Pass Comp&#39;</span><span class="p">:</span><span class="mf">0.1</span><span class="p">,</span><span class="s1">&#39;Pass TD&#39;</span><span class="p">:</span><span class="mf">6.0</span><span class="p">,</span><span class="s1">&#39;Pass 1D&#39;</span><span class="p">:</span><span class="mf">0.1</span><span class="p">,</span><span class="s1">&#39;Pass 300+&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span>\
</span><span id="League.load_settings-244"><a href="#League.load_settings-244"><span class="linenos">244</span></a>            <span class="s1">&#39;Int Thrown&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Rush Yds&#39;</span><span class="p">:</span><span class="mf">0.1</span><span class="p">,</span><span class="s1">&#39;Rush Att&#39;</span><span class="p">:</span><span class="mf">0.25</span><span class="p">,</span><span class="s1">&#39;Rush TD&#39;</span><span class="p">:</span><span class="mf">6.0</span><span class="p">,</span><span class="s1">&#39;Rush 1D&#39;</span><span class="p">:</span><span class="mf">1.0</span><span class="p">,</span><span class="s1">&#39;Rush 100+&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span>\
</span><span id="League.load_settings-245"><a href="#League.load_settings-245"><span class="linenos">245</span></a>            <span class="s1">&#39;Rec Yds&#39;</span><span class="p">:</span><span class="mf">0.1</span><span class="p">,</span><span class="s1">&#39;Rec&#39;</span><span class="p">:</span><span class="mf">1.0</span><span class="p">,</span><span class="s1">&#39;Rec TD&#39;</span><span class="p">:</span><span class="mf">6.0</span><span class="p">,</span><span class="s1">&#39;Rec 1D&#39;</span><span class="p">:</span><span class="mf">1.0</span><span class="p">,</span><span class="s1">&#39;Rec 100+&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Ret Yds&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Ret TD&#39;</span><span class="p">:</span><span class="mf">6.0</span><span class="p">,</span>\
</span><span id="League.load_settings-246"><a href="#League.load_settings-246"><span class="linenos">246</span></a>            <span class="s1">&#39;TE Rec Bonus&#39;</span><span class="p">:</span><span class="mf">1.0</span><span class="p">,</span><span class="s1">&#39;TE 1D Bonus&#39;</span><span class="p">:</span><span class="mf">1.0</span><span class="p">,</span><span class="s1">&#39;2-PT&#39;</span><span class="p">:</span><span class="mf">2.0</span><span class="p">,</span><span class="s1">&#39;Fum Lost&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Fum Ret TD&#39;</span><span class="p">:</span><span class="mf">6.0</span><span class="p">,</span>\
</span><span id="League.load_settings-247"><a href="#League.load_settings-247"><span class="linenos">247</span></a>            <span class="s1">&#39;FG 0-19&#39;</span><span class="p">:</span><span class="mf">2.0</span><span class="p">,</span><span class="s1">&#39;FG 20-29&#39;</span><span class="p">:</span><span class="mf">2.5</span><span class="p">,</span><span class="s1">&#39;FG 30-39&#39;</span><span class="p">:</span><span class="mf">3.5</span><span class="p">,</span><span class="s1">&#39;FG 40-49&#39;</span><span class="p">:</span><span class="mf">4.5</span><span class="p">,</span><span class="s1">&#39;FG 50+&#39;</span><span class="p">:</span><span class="mf">5.5</span><span class="p">,</span><span class="s1">&#39;PAT Made&#39;</span><span class="p">:</span><span class="mf">3.3</span><span class="p">,</span>\
</span><span id="League.load_settings-248"><a href="#League.load_settings-248"><span class="linenos">248</span></a>            <span class="s1">&#39;Sack&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Int&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Fum Rec&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;TD&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Safe&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Blk Kick&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span>\
</span><span id="League.load_settings-249"><a href="#League.load_settings-249"><span class="linenos">249</span></a>            <span class="s1">&#39;Pts Allow 0&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Pts Allow 1-6&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Pts Allow 7-13&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Pts Allow 14-20&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span>\
</span><span id="League.load_settings-250"><a href="#League.load_settings-250"><span class="linenos">250</span></a>            <span class="s1">&#39;Pts Allow 21-27&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Pts Allow 28-34&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Pts Allow 35+&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;XPR&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">}</span>
</span><span id="League.load_settings-251"><a href="#League.load_settings-251"><span class="linenos">251</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">roster_spots</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;position&#39;</span><span class="p">:[</span><span class="s1">&#39;QB&#39;</span><span class="p">,</span><span class="s1">&#39;RB&#39;</span><span class="p">,</span><span class="s1">&#39;WR&#39;</span><span class="p">,</span><span class="s1">&#39;TE&#39;</span><span class="p">,</span><span class="s1">&#39;W/R/T&#39;</span><span class="p">,</span><span class="s1">&#39;Q/W/R/T&#39;</span><span class="p">,</span><span class="s1">&#39;K&#39;</span><span class="p">,</span><span class="s1">&#39;BN&#39;</span><span class="p">],</span><span class="s1">&#39;count&#39;</span><span class="p">:[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">]})</span>
</span><span id="League.load_settings-252"><a href="#League.load_settings-252"><span class="linenos">252</span></a>        <span class="k">elif</span> <span class="nb">str</span><span class="p">(</span><span class="n">bestball</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;dk&quot;</span><span class="p">,</span> <span class="s2">&quot;draftkings&quot;</span><span class="p">]:</span>
</span><span id="League.load_settings-253"><a href="#League.load_settings-253"><span class="linenos">253</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;playoff_start_week&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">14</span>
</span><span id="League.load_settings-254"><a href="#League.load_settings-254"><span class="linenos">254</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;num_playoff_teams&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="League.load_settings-255"><a href="#League.load_settings-255"><span class="linenos">255</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Pass Yds&#39;</span><span class="p">:</span><span class="mf">0.04</span><span class="p">,</span><span class="s1">&#39;Pass Comp&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Pass TD&#39;</span><span class="p">:</span><span class="mf">4.0</span><span class="p">,</span><span class="s1">&#39;Pass 1D&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Pass 300+&#39;</span><span class="p">:</span><span class="mf">3.0</span><span class="p">,</span>\
</span><span id="League.load_settings-256"><a href="#League.load_settings-256"><span class="linenos">256</span></a>            <span class="s1">&#39;Int Thrown&#39;</span><span class="p">:</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span><span class="s1">&#39;Rush Yds&#39;</span><span class="p">:</span><span class="mf">0.1</span><span class="p">,</span><span class="s1">&#39;Rush Att&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Rush TD&#39;</span><span class="p">:</span><span class="mf">6.0</span><span class="p">,</span><span class="s1">&#39;Rush 1D&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Rush 100+&#39;</span><span class="p">:</span><span class="mf">3.0</span><span class="p">,</span>\
</span><span id="League.load_settings-257"><a href="#League.load_settings-257"><span class="linenos">257</span></a>            <span class="s1">&#39;Rec Yds&#39;</span><span class="p">:</span><span class="mf">0.1</span><span class="p">,</span><span class="s1">&#39;Rec&#39;</span><span class="p">:</span><span class="mf">1.0</span><span class="p">,</span><span class="s1">&#39;Rec TD&#39;</span><span class="p">:</span><span class="mf">6.0</span><span class="p">,</span><span class="s1">&#39;Rec 1D&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Rec 100+&#39;</span><span class="p">:</span><span class="mf">3.0</span><span class="p">,</span><span class="s1">&#39;Ret Yds&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Ret TD&#39;</span><span class="p">:</span><span class="mf">6.0</span><span class="p">,</span>\
</span><span id="League.load_settings-258"><a href="#League.load_settings-258"><span class="linenos">258</span></a>            <span class="s1">&#39;TE Rec Bonus&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;TE 1D Bonus&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;2-PT&#39;</span><span class="p">:</span><span class="mf">2.0</span><span class="p">,</span><span class="s1">&#39;Fum Lost&#39;</span><span class="p">:</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span><span class="s1">&#39;Fum Ret TD&#39;</span><span class="p">:</span><span class="mf">6.0</span><span class="p">,</span>\
</span><span id="League.load_settings-259"><a href="#League.load_settings-259"><span class="linenos">259</span></a>            <span class="s1">&#39;FG 0-19&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;FG 20-29&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;FG 30-39&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;FG 40-49&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;FG 50+&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;PAT Made&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span>\
</span><span id="League.load_settings-260"><a href="#League.load_settings-260"><span class="linenos">260</span></a>            <span class="s1">&#39;Sack&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Int&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Fum Rec&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;TD&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Safe&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Blk Kick&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span>\
</span><span id="League.load_settings-261"><a href="#League.load_settings-261"><span class="linenos">261</span></a>            <span class="s1">&#39;Pts Allow 0&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Pts Allow 1-6&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Pts Allow 7-13&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Pts Allow 14-20&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span>\
</span><span id="League.load_settings-262"><a href="#League.load_settings-262"><span class="linenos">262</span></a>            <span class="s1">&#39;Pts Allow 21-27&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Pts Allow 28-34&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Pts Allow 35+&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;XPR&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">}</span>
</span><span id="League.load_settings-263"><a href="#League.load_settings-263"><span class="linenos">263</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">roster_spots</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;position&#39;</span><span class="p">:[</span><span class="s1">&#39;QB&#39;</span><span class="p">,</span><span class="s1">&#39;RB&#39;</span><span class="p">,</span><span class="s1">&#39;WR&#39;</span><span class="p">,</span><span class="s1">&#39;TE&#39;</span><span class="p">,</span><span class="s1">&#39;W/R/T&#39;</span><span class="p">,</span><span class="s1">&#39;Q/W/R/T&#39;</span><span class="p">,</span><span class="s1">&#39;K&#39;</span><span class="p">,</span><span class="s1">&#39;BN&#39;</span><span class="p">],</span><span class="s1">&#39;count&#39;</span><span class="p">:[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">12</span><span class="p">]})</span>
</span><span id="League.load_settings-264"><a href="#League.load_settings-264"><span class="linenos">264</span></a>        <span class="k">elif</span> <span class="nb">str</span><span class="p">(</span><span class="n">bestball</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;underdog&quot;</span><span class="p">]:</span>
</span><span id="League.load_settings-265"><a href="#League.load_settings-265"><span class="linenos">265</span></a>            <span class="c1"># Slow Puppy</span>
</span><span id="League.load_settings-266"><a href="#League.load_settings-266"><span class="linenos">266</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;playoff_start_week&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">14</span>
</span><span id="League.load_settings-267"><a href="#League.load_settings-267"><span class="linenos">267</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;num_playoff_teams&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="League.load_settings-268"><a href="#League.load_settings-268"><span class="linenos">268</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Pass Yds&#39;</span><span class="p">:</span><span class="mf">0.04</span><span class="p">,</span><span class="s1">&#39;Pass Comp&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Pass TD&#39;</span><span class="p">:</span><span class="mf">4.0</span><span class="p">,</span><span class="s1">&#39;Pass 1D&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Pass 300+&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span>\
</span><span id="League.load_settings-269"><a href="#League.load_settings-269"><span class="linenos">269</span></a>            <span class="s1">&#39;Int Thrown&#39;</span><span class="p">:</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span><span class="s1">&#39;Rush Yds&#39;</span><span class="p">:</span><span class="mf">0.1</span><span class="p">,</span><span class="s1">&#39;Rush Att&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Rush TD&#39;</span><span class="p">:</span><span class="mf">6.0</span><span class="p">,</span><span class="s1">&#39;Rush 1D&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Rush 100+&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span>\
</span><span id="League.load_settings-270"><a href="#League.load_settings-270"><span class="linenos">270</span></a>            <span class="s1">&#39;Rec Yds&#39;</span><span class="p">:</span><span class="mf">0.1</span><span class="p">,</span><span class="s1">&#39;Rec&#39;</span><span class="p">:</span><span class="mf">0.5</span><span class="p">,</span><span class="s1">&#39;Rec TD&#39;</span><span class="p">:</span><span class="mf">6.0</span><span class="p">,</span><span class="s1">&#39;Rec 1D&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Rec 100+&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Ret Yds&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Ret TD&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span>\
</span><span id="League.load_settings-271"><a href="#League.load_settings-271"><span class="linenos">271</span></a>            <span class="s1">&#39;TE Rec Bonus&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;TE 1D Bonus&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;2-PT&#39;</span><span class="p">:</span><span class="mf">2.0</span><span class="p">,</span><span class="s1">&#39;Fum Lost&#39;</span><span class="p">:</span><span class="o">-</span><span class="mf">2.0</span><span class="p">,</span><span class="s1">&#39;Fum Ret TD&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span>\
</span><span id="League.load_settings-272"><a href="#League.load_settings-272"><span class="linenos">272</span></a>            <span class="s1">&#39;FG 0-19&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;FG 20-29&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;FG 30-39&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;FG 40-49&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;FG 50+&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;PAT Made&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span>\
</span><span id="League.load_settings-273"><a href="#League.load_settings-273"><span class="linenos">273</span></a>            <span class="s1">&#39;Sack&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Int&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Fum Rec&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;TD&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Safe&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Blk Kick&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span>\
</span><span id="League.load_settings-274"><a href="#League.load_settings-274"><span class="linenos">274</span></a>            <span class="s1">&#39;Pts Allow 0&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Pts Allow 1-6&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Pts Allow 7-13&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Pts Allow 14-20&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span>\
</span><span id="League.load_settings-275"><a href="#League.load_settings-275"><span class="linenos">275</span></a>            <span class="s1">&#39;Pts Allow 21-27&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Pts Allow 28-34&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Pts Allow 35+&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;XPR&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">}</span>
</span><span id="League.load_settings-276"><a href="#League.load_settings-276"><span class="linenos">276</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">roster_spots</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;position&#39;</span><span class="p">:[</span><span class="s1">&#39;QB&#39;</span><span class="p">,</span><span class="s1">&#39;RB&#39;</span><span class="p">,</span><span class="s1">&#39;WR&#39;</span><span class="p">,</span><span class="s1">&#39;TE&#39;</span><span class="p">,</span><span class="s1">&#39;W/R/T&#39;</span><span class="p">,</span><span class="s1">&#39;Q/W/R/T&#39;</span><span class="p">,</span><span class="s1">&#39;K&#39;</span><span class="p">,</span><span class="s1">&#39;BN&#39;</span><span class="p">],</span><span class="s1">&#39;count&#39;</span><span class="p">:[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">]})</span>
</span><span id="League.load_settings-277"><a href="#League.load_settings-277"><span class="linenos">277</span></a>            <span class="c1"># # Pomeranian Superflex</span>
</span><span id="League.load_settings-278"><a href="#League.load_settings-278"><span class="linenos">278</span></a>            <span class="c1"># self.settings[&#39;num_playoff_teams&#39;] = 3</span>
</span><span id="League.load_settings-279"><a href="#League.load_settings-279"><span class="linenos">279</span></a>            <span class="c1"># self.roster_spots = pd.DataFrame({&#39;position&#39;:[&#39;QB&#39;,&#39;RB&#39;,&#39;WR&#39;,&#39;TE&#39;,&#39;W/R/T&#39;,&#39;Q/W/R/T&#39;,&#39;K&#39;,&#39;BN&#39;],&#39;count&#39;:[1,2,2,1,1,1,0,12]})</span>
</span><span id="League.load_settings-280"><a href="#League.load_settings-280"><span class="linenos">280</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="League.load_settings-281"><a href="#League.load_settings-281"><span class="linenos">281</span></a>            <span class="k">if</span> <span class="s2">&quot;FG 0-19&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">:</span>
</span><span id="League.load_settings-282"><a href="#League.load_settings-282"><span class="linenos">282</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;FG 0-19&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
</span><span id="League.load_settings-283"><a href="#League.load_settings-283"><span class="linenos">283</span></a>            <span class="k">if</span> <span class="s2">&quot;Rec&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">:</span>
</span><span id="League.load_settings-284"><a href="#League.load_settings-284"><span class="linenos">284</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Rec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="League.load_settings-285"><a href="#League.load_settings-285"><span class="linenos">285</span></a>            <span class="k">if</span> <span class="s2">&quot;Ret Yds&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">:</span>
</span><span id="League.load_settings-286"><a href="#League.load_settings-286"><span class="linenos">286</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Ret Yds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="League.load_settings-287"><a href="#League.load_settings-287"><span class="linenos">287</span></a>            <span class="k">for</span> <span class="n">stat</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Pass Comp&#39;</span><span class="p">,</span><span class="s1">&#39;Pass 1D&#39;</span><span class="p">,</span><span class="s1">&#39;Rush Att&#39;</span><span class="p">,</span><span class="s1">&#39;Rush 1D&#39;</span><span class="p">,</span><span class="s1">&#39;Rec 1D&#39;</span><span class="p">,</span>\
</span><span id="League.load_settings-288"><a href="#League.load_settings-288"><span class="linenos">288</span></a>            <span class="s1">&#39;TE Rec Bonus&#39;</span><span class="p">,</span><span class="s1">&#39;TE 1D Bonus&#39;</span><span class="p">,</span><span class="s1">&#39;Pass 300+&#39;</span><span class="p">,</span><span class="s1">&#39;Rush 100+&#39;</span><span class="p">,</span><span class="s1">&#39;Rec 100+&#39;</span><span class="p">]:</span>
</span><span id="League.load_settings-289"><a href="#League.load_settings-289"><span class="linenos">289</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="n">stat</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span></pre></div>


            <div class="docstring"><p>Pulls league roster/schedule settings and scoring modifiers</p>

<p>Args:
    sfb (bool, optional): whether to use Scott Fish Bowl 13 settings, defaults to False. <br />
    bestball (str, optional): which best ball settings to use if desired, defaults to "" (redraft).</p>
</div>


                            </div>
                            <div id="League.load_fantasy_teams" class="classattr">
                                        <input id="League.load_fantasy_teams-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">load_fantasy_teams</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="League.load_fantasy_teams-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#League.load_fantasy_teams"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="League.load_fantasy_teams-291"><a href="#League.load_fantasy_teams-291"><span class="linenos">291</span></a>    <span class="k">def</span> <span class="nf">load_fantasy_teams</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="League.load_fantasy_teams-292"><a href="#League.load_fantasy_teams-292"><span class="linenos">292</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="League.load_fantasy_teams-293"><a href="#League.load_fantasy_teams-293"><span class="linenos">293</span></a><span class="sd">        Pulls a list of all fantasy team names and ids for the league in question.</span>
</span><span id="League.load_fantasy_teams-294"><a href="#League.load_fantasy_teams-294"><span class="linenos">294</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="League.load_fantasy_teams-295"><a href="#League.load_fantasy_teams-295"><span class="linenos">295</span></a>        <span class="c1"># Pulling list of teams in the fantasy league</span>
</span><span id="League.load_fantasy_teams-296"><a href="#League.load_fantasy_teams-296"><span class="linenos">296</span></a>        <span class="n">league_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lg</span><span class="o">.</span><span class="n">yhandler</span><span class="o">.</span><span class="n">get_standings_raw</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lg_id</span><span class="p">)[</span><span class="s2">&quot;fantasy_content&quot;</span><span class="p">]</span>
</span><span id="League.load_fantasy_teams-297"><a href="#League.load_fantasy_teams-297"><span class="linenos">297</span></a>        <span class="n">teams_info</span> <span class="o">=</span> <span class="n">league_info</span><span class="p">[</span><span class="s2">&quot;league&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;standings&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;teams&quot;</span><span class="p">]</span>
</span><span id="League.load_fantasy_teams-298"><a href="#League.load_fantasy_teams-298"><span class="linenos">298</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">teams</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="League.load_fantasy_teams-299"><a href="#League.load_fantasy_teams-299"><span class="linenos">299</span></a>            <span class="p">{</span>
</span><span id="League.load_fantasy_teams-300"><a href="#League.load_fantasy_teams-300"><span class="linenos">300</span></a>                <span class="s2">&quot;team_key&quot;</span><span class="p">:</span> <span class="n">teams_info</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">ind</span><span class="p">)][</span><span class="s2">&quot;team&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;team_key&quot;</span><span class="p">],</span>
</span><span id="League.load_fantasy_teams-301"><a href="#League.load_fantasy_teams-301"><span class="linenos">301</span></a>                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">teams_info</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">ind</span><span class="p">)][</span><span class="s2">&quot;team&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
</span><span id="League.load_fantasy_teams-302"><a href="#League.load_fantasy_teams-302"><span class="linenos">302</span></a>                <span class="s2">&quot;manager&quot;</span><span class="p">:</span> <span class="n">teams_info</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">ind</span><span class="p">)][</span><span class="s2">&quot;team&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;managers&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;manager&#39;</span><span class="p">][</span><span class="s1">&#39;nickname&#39;</span><span class="p">],</span>
</span><span id="League.load_fantasy_teams-303"><a href="#League.load_fantasy_teams-303"><span class="linenos">303</span></a>            <span class="p">}</span>
</span><span id="League.load_fantasy_teams-304"><a href="#League.load_fantasy_teams-304"><span class="linenos">304</span></a>            <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">teams_info</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">])</span>
</span><span id="League.load_fantasy_teams-305"><a href="#League.load_fantasy_teams-305"><span class="linenos">305</span></a>        <span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Pulls a list of all fantasy team names and ids for the league in question.</p>
</div>


                            </div>
                            <div id="League.load_nfl_abbrevs" class="classattr">
                                        <input id="League.load_nfl_abbrevs-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">load_nfl_abbrevs</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="League.load_nfl_abbrevs-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#League.load_nfl_abbrevs"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="League.load_nfl_abbrevs-307"><a href="#League.load_nfl_abbrevs-307"><span class="linenos">307</span></a>    <span class="k">def</span> <span class="nf">load_nfl_abbrevs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="League.load_nfl_abbrevs-308"><a href="#League.load_nfl_abbrevs-308"><span class="linenos">308</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="League.load_nfl_abbrevs-309"><a href="#League.load_nfl_abbrevs-309"><span class="linenos">309</span></a><span class="sd">        Loads a translation table for all NFL team abbreviations across platforms</span>
</span><span id="League.load_nfl_abbrevs-310"><a href="#League.load_nfl_abbrevs-310"><span class="linenos">310</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="League.load_nfl_abbrevs-311"><a href="#League.load_nfl_abbrevs-311"><span class="linenos">311</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">nfl_teams</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
</span><span id="League.load_nfl_abbrevs-312"><a href="#League.load_nfl_abbrevs-312"><span class="linenos">312</span></a>            <span class="s2">&quot;https://raw.githubusercontent.com/&quot;</span>
</span><span id="League.load_nfl_abbrevs-313"><a href="#League.load_nfl_abbrevs-313"><span class="linenos">313</span></a>            <span class="o">+</span> <span class="s2">&quot;tefirman/FantasySports/main/res/football/team_abbrevs.csv&quot;</span>
</span><span id="League.load_nfl_abbrevs-314"><a href="#League.load_nfl_abbrevs-314"><span class="linenos">314</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Loads a translation table for all NFL team abbreviations across platforms</p>
</div>


                            </div>
                            <div id="League.load_nfl_schedule" class="classattr">
                                        <input id="League.load_nfl_schedule-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">load_nfl_schedule</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;NFLSchedule.csv&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="League.load_nfl_schedule-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#League.load_nfl_schedule"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="League.load_nfl_schedule-316"><a href="#League.load_nfl_schedule-316"><span class="linenos">316</span></a>    <span class="k">def</span> <span class="nf">load_nfl_schedule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;NFLSchedule.csv&quot;</span><span class="p">):</span>
</span><span id="League.load_nfl_schedule-317"><a href="#League.load_nfl_schedule-317"><span class="linenos">317</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="League.load_nfl_schedule-318"><a href="#League.load_nfl_schedule-318"><span class="linenos">318</span></a><span class="sd">        Loads and processes the NFL schedule for use in future simulations</span>
</span><span id="League.load_nfl_schedule-319"><a href="#League.load_nfl_schedule-319"><span class="linenos">319</span></a>
</span><span id="League.load_nfl_schedule-320"><a href="#League.load_nfl_schedule-320"><span class="linenos">320</span></a><span class="sd">        Args:</span>
</span><span id="League.load_nfl_schedule-321"><a href="#League.load_nfl_schedule-321"><span class="linenos">321</span></a><span class="sd">            path (str, optional): location of saved NFL schedule, defaults to &quot;NFLSchedule.csv&quot;.</span>
</span><span id="League.load_nfl_schedule-322"><a href="#League.load_nfl_schedule-322"><span class="linenos">322</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="League.load_nfl_schedule-323"><a href="#League.load_nfl_schedule-323"><span class="linenos">323</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
</span><span id="League.load_nfl_schedule-324"><a href="#League.load_nfl_schedule-324"><span class="linenos">324</span></a>            <span class="n">nfl_schedule</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="League.load_nfl_schedule-325"><a href="#League.load_nfl_schedule-325"><span class="linenos">325</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="League.load_nfl_schedule-326"><a href="#League.load_nfl_schedule-326"><span class="linenos">326</span></a>            <span class="n">nfl_schedule</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;season&#39;</span><span class="p">,</span><span class="s1">&#39;week&#39;</span><span class="p">,</span><span class="s1">&#39;score1&#39;</span><span class="p">,</span><span class="s1">&#39;score2&#39;</span><span class="p">])</span>
</span><span id="League.load_nfl_schedule-327"><a href="#League.load_nfl_schedule-327"><span class="linenos">327</span></a>        <span class="n">before</span> <span class="o">=</span> <span class="n">nfl_schedule</span><span class="o">.</span><span class="n">season</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="n">nfl_schedule</span><span class="o">.</span><span class="n">week</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">season</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">week</span>
</span><span id="League.load_nfl_schedule-328"><a href="#League.load_nfl_schedule-328"><span class="linenos">328</span></a>        <span class="n">missing</span> <span class="o">=</span> <span class="n">before</span> <span class="o">&amp;</span> <span class="n">nfl_schedule</span><span class="o">.</span><span class="n">score1</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">nfl_schedule</span><span class="o">.</span><span class="n">score2</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span>
</span><span id="League.load_nfl_schedule-329"><a href="#League.load_nfl_schedule-329"><span class="linenos">329</span></a>        <span class="k">if</span> <span class="n">missing</span><span class="o">.</span><span class="n">any</span><span class="p">()</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">season</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">nfl_schedule</span><span class="o">.</span><span class="n">season</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
</span><span id="League.load_nfl_schedule-330"><a href="#League.load_nfl_schedule-330"><span class="linenos">330</span></a>            <span class="n">s</span> <span class="o">=</span> <span class="n">sr</span><span class="o">.</span><span class="n">Schedule</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">season</span> <span class="o">-</span> <span class="mi">8</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">season</span><span class="p">,</span><span class="kc">False</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="kc">False</span><span class="p">)</span>
</span><span id="League.load_nfl_schedule-331"><a href="#League.load_nfl_schedule-331"><span class="linenos">331</span></a>            <span class="n">s</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="League.load_nfl_schedule-332"><a href="#League.load_nfl_schedule-332"><span class="linenos">332</span></a>            <span class="n">nfl_schedule</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="League.load_nfl_schedule-333"><a href="#League.load_nfl_schedule-333"><span class="linenos">333</span></a>        
</span><span id="League.load_nfl_schedule-334"><a href="#League.load_nfl_schedule-334"><span class="linenos">334</span></a>        <span class="n">nfl_schedule</span> <span class="o">=</span> <span class="n">nfl_schedule</span><span class="p">[[</span>
</span><span id="League.load_nfl_schedule-335"><a href="#League.load_nfl_schedule-335"><span class="linenos">335</span></a>                <span class="s2">&quot;season&quot;</span><span class="p">,</span>
</span><span id="League.load_nfl_schedule-336"><a href="#League.load_nfl_schedule-336"><span class="linenos">336</span></a>                <span class="s2">&quot;game_date&quot;</span><span class="p">,</span>
</span><span id="League.load_nfl_schedule-337"><a href="#League.load_nfl_schedule-337"><span class="linenos">337</span></a>                <span class="s2">&quot;week&quot;</span><span class="p">,</span>
</span><span id="League.load_nfl_schedule-338"><a href="#League.load_nfl_schedule-338"><span class="linenos">338</span></a>                <span class="s2">&quot;team1_abbrev&quot;</span><span class="p">,</span>
</span><span id="League.load_nfl_schedule-339"><a href="#League.load_nfl_schedule-339"><span class="linenos">339</span></a>                <span class="s2">&quot;team2_abbrev&quot;</span><span class="p">,</span>
</span><span id="League.load_nfl_schedule-340"><a href="#League.load_nfl_schedule-340"><span class="linenos">340</span></a>                <span class="s2">&quot;elo1_pre&quot;</span><span class="p">,</span>
</span><span id="League.load_nfl_schedule-341"><a href="#League.load_nfl_schedule-341"><span class="linenos">341</span></a>                <span class="s2">&quot;elo2_pre&quot;</span><span class="p">,</span>
</span><span id="League.load_nfl_schedule-342"><a href="#League.load_nfl_schedule-342"><span class="linenos">342</span></a>                <span class="s2">&quot;elo_diff&quot;</span><span class="p">,</span>
</span><span id="League.load_nfl_schedule-343"><a href="#League.load_nfl_schedule-343"><span class="linenos">343</span></a>            <span class="p">]]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
</span><span id="League.load_nfl_schedule-344"><a href="#League.load_nfl_schedule-344"><span class="linenos">344</span></a>            <span class="n">columns</span><span class="o">=</span><span class="p">{</span>
</span><span id="League.load_nfl_schedule-345"><a href="#League.load_nfl_schedule-345"><span class="linenos">345</span></a>                <span class="s2">&quot;game_date&quot;</span><span class="p">:</span> <span class="s2">&quot;date&quot;</span><span class="p">,</span>
</span><span id="League.load_nfl_schedule-346"><a href="#League.load_nfl_schedule-346"><span class="linenos">346</span></a>                <span class="s2">&quot;team1_abbrev&quot;</span><span class="p">:</span> <span class="s2">&quot;home_team&quot;</span><span class="p">,</span>
</span><span id="League.load_nfl_schedule-347"><a href="#League.load_nfl_schedule-347"><span class="linenos">347</span></a>                <span class="s2">&quot;team2_abbrev&quot;</span><span class="p">:</span> <span class="s2">&quot;away_team&quot;</span><span class="p">,</span>
</span><span id="League.load_nfl_schedule-348"><a href="#League.load_nfl_schedule-348"><span class="linenos">348</span></a>                <span class="s2">&quot;elo1_pre&quot;</span><span class="p">:</span> <span class="s2">&quot;home_elo&quot;</span><span class="p">,</span>
</span><span id="League.load_nfl_schedule-349"><a href="#League.load_nfl_schedule-349"><span class="linenos">349</span></a>                <span class="s2">&quot;elo2_pre&quot;</span><span class="p">:</span> <span class="s2">&quot;away_elo&quot;</span><span class="p">,</span>
</span><span id="League.load_nfl_schedule-350"><a href="#League.load_nfl_schedule-350"><span class="linenos">350</span></a>                <span class="s2">&quot;elo_diff&quot;</span><span class="p">:</span> <span class="s2">&quot;home_elo_diff&quot;</span><span class="p">,</span>
</span><span id="League.load_nfl_schedule-351"><a href="#League.load_nfl_schedule-351"><span class="linenos">351</span></a>            <span class="p">},</span>
</span><span id="League.load_nfl_schedule-352"><a href="#League.load_nfl_schedule-352"><span class="linenos">352</span></a>        <span class="p">)</span>
</span><span id="League.load_nfl_schedule-353"><a href="#League.load_nfl_schedule-353"><span class="linenos">353</span></a>        <span class="n">nfl_schedule</span><span class="p">[</span><span class="s2">&quot;away_elo_diff&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">nfl_schedule</span><span class="p">[</span><span class="s2">&quot;home_elo_diff&quot;</span><span class="p">]</span>
</span><span id="League.load_nfl_schedule-354"><a href="#League.load_nfl_schedule-354"><span class="linenos">354</span></a>        <span class="n">home</span> <span class="o">=</span> <span class="n">nfl_schedule</span><span class="p">[[</span><span class="s2">&quot;season&quot;</span><span class="p">,</span> <span class="s2">&quot;week&quot;</span><span class="p">,</span> <span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="s2">&quot;home_team&quot;</span><span class="p">,</span> <span class="s2">&quot;home_elo_diff&quot;</span><span class="p">,</span> <span class="s2">&quot;away_elo&quot;</span><span class="p">]]</span>\
</span><span id="League.load_nfl_schedule-355"><a href="#League.load_nfl_schedule-355"><span class="linenos">355</span></a>        <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;home_team&quot;</span><span class="p">:</span> <span class="s2">&quot;team&quot;</span><span class="p">,</span> <span class="s2">&quot;home_elo_diff&quot;</span><span class="p">:</span> <span class="s2">&quot;elo_diff&quot;</span><span class="p">,</span> <span class="s2">&quot;away_elo&quot;</span><span class="p">:</span> <span class="s2">&quot;opp_elo&quot;</span><span class="p">})</span>
</span><span id="League.load_nfl_schedule-356"><a href="#League.load_nfl_schedule-356"><span class="linenos">356</span></a>        <span class="n">home</span><span class="p">[</span><span class="s2">&quot;home_away&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Home&quot;</span>
</span><span id="League.load_nfl_schedule-357"><a href="#League.load_nfl_schedule-357"><span class="linenos">357</span></a>        <span class="n">away</span> <span class="o">=</span> <span class="n">nfl_schedule</span><span class="p">[[</span><span class="s2">&quot;season&quot;</span><span class="p">,</span> <span class="s2">&quot;week&quot;</span><span class="p">,</span> <span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="s2">&quot;away_team&quot;</span><span class="p">,</span> <span class="s2">&quot;away_elo_diff&quot;</span><span class="p">,</span> <span class="s2">&quot;home_elo&quot;</span><span class="p">]]</span>\
</span><span id="League.load_nfl_schedule-358"><a href="#League.load_nfl_schedule-358"><span class="linenos">358</span></a>        <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;away_team&quot;</span><span class="p">:</span> <span class="s2">&quot;team&quot;</span><span class="p">,</span> <span class="s2">&quot;away_elo_diff&quot;</span><span class="p">:</span> <span class="s2">&quot;elo_diff&quot;</span><span class="p">,</span> <span class="s2">&quot;home_elo&quot;</span><span class="p">:</span> <span class="s2">&quot;opp_elo&quot;</span><span class="p">})</span>
</span><span id="League.load_nfl_schedule-359"><a href="#League.load_nfl_schedule-359"><span class="linenos">359</span></a>        <span class="n">away</span><span class="p">[</span><span class="s2">&quot;home_away&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Away&quot;</span>
</span><span id="League.load_nfl_schedule-360"><a href="#League.load_nfl_schedule-360"><span class="linenos">360</span></a>        <span class="n">nfl_schedule</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">home</span><span class="p">,</span> <span class="n">away</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="League.load_nfl_schedule-361"><a href="#League.load_nfl_schedule-361"><span class="linenos">361</span></a>        <span class="n">nfl_schedule</span><span class="o">.</span><span class="n">elo_diff</span> <span class="o">=</span> <span class="n">nfl_schedule</span><span class="o">.</span><span class="n">elo_diff</span> <span class="o">/</span> <span class="mi">1500</span>
</span><span id="League.load_nfl_schedule-362"><a href="#League.load_nfl_schedule-362"><span class="linenos">362</span></a>        <span class="n">nfl_schedule</span><span class="o">.</span><span class="n">opp_elo</span> <span class="o">=</span> <span class="mi">1500</span> <span class="o">/</span> <span class="n">nfl_schedule</span><span class="o">.</span><span class="n">opp_elo</span>
</span><span id="League.load_nfl_schedule-363"><a href="#League.load_nfl_schedule-363"><span class="linenos">363</span></a>        <span class="n">nfl_schedule</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">nfl_schedule</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;%m/</span><span class="si">%d</span><span class="s2">/%y&quot;</span><span class="p">)</span>
</span><span id="League.load_nfl_schedule-364"><a href="#League.load_nfl_schedule-364"><span class="linenos">364</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">nfl_schedule</span> <span class="o">=</span> <span class="n">nfl_schedule</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">,</span> <span class="s2">&quot;week&quot;</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Loads and processes the NFL schedule for use in future simulations</p>

<p>Args:
    path (str, optional): location of saved NFL schedule, defaults to "NFLSchedule.csv".</p>
</div>


                            </div>
                            <div id="League.refresh_oauth" class="classattr">
                                        <input id="League.refresh_oauth-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">refresh_oauth</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">threshold</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">59</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="League.refresh_oauth-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#League.refresh_oauth"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="League.refresh_oauth-366"><a href="#League.refresh_oauth-366"><span class="linenos">366</span></a>    <span class="k">def</span> <span class="nf">refresh_oauth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threshold</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">59</span><span class="p">):</span>
</span><span id="League.refresh_oauth-367"><a href="#League.refresh_oauth-367"><span class="linenos">367</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="League.refresh_oauth-368"><a href="#League.refresh_oauth-368"><span class="linenos">368</span></a><span class="sd">        Checks the status of the current authentication token and refreshes it if expired (1hr).</span>
</span><span id="League.refresh_oauth-369"><a href="#League.refresh_oauth-369"><span class="linenos">369</span></a>
</span><span id="League.refresh_oauth-370"><a href="#League.refresh_oauth-370"><span class="linenos">370</span></a><span class="sd">        Args:</span>
</span><span id="League.refresh_oauth-371"><a href="#League.refresh_oauth-371"><span class="linenos">371</span></a><span class="sd">            threshold (int, optional): integer specifying the number of minutes an auth token </span>
</span><span id="League.refresh_oauth-372"><a href="#League.refresh_oauth-372"><span class="linenos">372</span></a><span class="sd">            can exist for before the code waits for it to expire and refreshes it, defaults to 59.</span>
</span><span id="League.refresh_oauth-373"><a href="#League.refresh_oauth-373"><span class="linenos">373</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="League.refresh_oauth-374"><a href="#League.refresh_oauth-374"><span class="linenos">374</span></a>        <span class="n">diff</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League.refresh_oauth-375"><a href="#League.refresh_oauth-375"><span class="linenos">375</span></a>            <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="p">(</span><span class="s2">&quot;GMT&quot;</span><span class="p">))</span>
</span><span id="League.refresh_oauth-376"><a href="#League.refresh_oauth-376"><span class="linenos">376</span></a>            <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1970</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">timezone</span><span class="p">(</span><span class="s2">&quot;GMT&quot;</span><span class="p">))</span>
</span><span id="League.refresh_oauth-377"><a href="#League.refresh_oauth-377"><span class="linenos">377</span></a>        <span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">oauth</span><span class="o">.</span><span class="n">token_time</span>
</span><span id="League.refresh_oauth-378"><a href="#League.refresh_oauth-378"><span class="linenos">378</span></a>        <span class="k">if</span> <span class="n">diff</span> <span class="o">&gt;=</span> <span class="n">threshold</span> <span class="o">*</span> <span class="mi">60</span><span class="p">:</span>
</span><span id="League.refresh_oauth-379"><a href="#League.refresh_oauth-379"><span class="linenos">379</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">3600</span> <span class="o">-</span> <span class="n">diff</span> <span class="o">+</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="League.refresh_oauth-380"><a href="#League.refresh_oauth-380"><span class="linenos">380</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">oauth</span> <span class="o">=</span> <span class="n">OAuth2</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">from_file</span><span class="o">=</span><span class="s2">&quot;oauth2.json&quot;</span><span class="p">)</span>
</span><span id="League.refresh_oauth-381"><a href="#League.refresh_oauth-381"><span class="linenos">381</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">gm</span> <span class="o">=</span> <span class="n">yfa</span><span class="o">.</span><span class="n">Game</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">oauth</span><span class="p">,</span> <span class="s2">&quot;nfl&quot;</span><span class="p">)</span>
</span><span id="League.refresh_oauth-382"><a href="#League.refresh_oauth-382"><span class="linenos">382</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">lg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gm</span><span class="o">.</span><span class="n">to_league</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lg_id</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Checks the status of the current authentication token and refreshes it if expired (1hr).</p>

<p>Args:
    threshold (int, optional): integer specifying the number of minutes an auth token 
    can exist for before the code waits for it to expire and refreshes it, defaults to 59.</p>
</div>


                            </div>
                            <div id="League.get_yahoo_players" class="classattr">
                                        <input id="League.get_yahoo_players-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_yahoo_players</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">injurytries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="League.get_yahoo_players-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#League.get_yahoo_players"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="League.get_yahoo_players-384"><a href="#League.get_yahoo_players-384"><span class="linenos">384</span></a>    <span class="k">def</span> <span class="nf">get_yahoo_players</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">injurytries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">):</span>
</span><span id="League.get_yahoo_players-385"><a href="#League.get_yahoo_players-385"><span class="linenos">385</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="League.get_yahoo_players-386"><a href="#League.get_yahoo_players-386"><span class="linenos">386</span></a><span class="sd">        Pulls a dataframe containing details about all NFL players that are eligible </span>
</span><span id="League.get_yahoo_players-387"><a href="#League.get_yahoo_players-387"><span class="linenos">387</span></a><span class="sd">        to be rostered in the fantasy league in question. Injury statuses will occasionally </span>
</span><span id="League.get_yahoo_players-388"><a href="#League.get_yahoo_players-388"><span class="linenos">388</span></a><span class="sd">        be excluded by API; in that case, the function will repeat the pull until it sees </span>
</span><span id="League.get_yahoo_players-389"><a href="#League.get_yahoo_players-389"><span class="linenos">389</span></a><span class="sd">        the injury statuses or hits the upper limit provided in injurytries.</span>
</span><span id="League.get_yahoo_players-390"><a href="#League.get_yahoo_players-390"><span class="linenos">390</span></a>
</span><span id="League.get_yahoo_players-391"><a href="#League.get_yahoo_players-391"><span class="linenos">391</span></a><span class="sd">        Args:</span>
</span><span id="League.get_yahoo_players-392"><a href="#League.get_yahoo_players-392"><span class="linenos">392</span></a><span class="sd">            injurytries (int, optional): maximum number of times the code will try to pull the player list, defaults to 10.</span>
</span><span id="League.get_yahoo_players-393"><a href="#League.get_yahoo_players-393"><span class="linenos">393</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="League.get_yahoo_players-394"><a href="#League.get_yahoo_players-394"><span class="linenos">394</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_oauth</span><span class="p">()</span>
</span><span id="League.get_yahoo_players-395"><a href="#League.get_yahoo_players-395"><span class="linenos">395</span></a>        <span class="n">tries</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="League.get_yahoo_players-396"><a href="#League.get_yahoo_players-396"><span class="linenos">396</span></a>        <span class="k">while</span> <span class="n">tries</span> <span class="o">&lt;</span> <span class="n">injurytries</span><span class="p">:</span>
</span><span id="League.get_yahoo_players-397"><a href="#League.get_yahoo_players-397"><span class="linenos">397</span></a>            <span class="n">tries</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="League.get_yahoo_players-398"><a href="#League.get_yahoo_players-398"><span class="linenos">398</span></a>            <span class="n">players</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="League.get_yahoo_players-399"><a href="#League.get_yahoo_players-399"><span class="linenos">399</span></a>            <span class="c1"># Rostered Players</span>
</span><span id="League.get_yahoo_players-400"><a href="#League.get_yahoo_players-400"><span class="linenos">400</span></a>            <span class="k">for</span> <span class="n">page_ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
</span><span id="League.get_yahoo_players-401"><a href="#League.get_yahoo_players-401"><span class="linenos">401</span></a>                <span class="n">page</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lg</span><span class="o">.</span><span class="n">yhandler</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="League.get_yahoo_players-402"><a href="#League.get_yahoo_players-402"><span class="linenos">402</span></a>                    <span class="s2">&quot;league/</span><span class="si">{}</span><span class="s2">/players;start=</span><span class="si">{}</span><span class="s2">;count=25;status=T/&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="League.get_yahoo_players-403"><a href="#League.get_yahoo_players-403"><span class="linenos">403</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">lg_id</span><span class="p">,</span> <span class="n">page_ind</span> <span class="o">*</span> <span class="mi">25</span>
</span><span id="League.get_yahoo_players-404"><a href="#League.get_yahoo_players-404"><span class="linenos">404</span></a>                    <span class="p">)</span>
</span><span id="League.get_yahoo_players-405"><a href="#League.get_yahoo_players-405"><span class="linenos">405</span></a>                <span class="p">)[</span><span class="s2">&quot;fantasy_content&quot;</span><span class="p">][</span><span class="s2">&quot;league&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;players&quot;</span><span class="p">]</span>
</span><span id="League.get_yahoo_players-406"><a href="#League.get_yahoo_players-406"><span class="linenos">406</span></a>                <span class="k">if</span> <span class="n">page</span> <span class="o">==</span> <span class="p">[]:</span>
</span><span id="League.get_yahoo_players-407"><a href="#League.get_yahoo_players-407"><span class="linenos">407</span></a>                    <span class="k">break</span>
</span><span id="League.get_yahoo_players-408"><a href="#League.get_yahoo_players-408"><span class="linenos">408</span></a>                <span class="k">for</span> <span class="n">player_ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">page</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]):</span>
</span><span id="League.get_yahoo_players-409"><a href="#League.get_yahoo_players-409"><span class="linenos">409</span></a>                    <span class="n">player</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="League.get_yahoo_players-410"><a href="#League.get_yahoo_players-410"><span class="linenos">410</span></a>                        <span class="n">field</span>
</span><span id="League.get_yahoo_players-411"><a href="#League.get_yahoo_players-411"><span class="linenos">411</span></a>                        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">page</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">player_ind</span><span class="p">)][</span><span class="s2">&quot;player&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League.get_yahoo_players-412"><a href="#League.get_yahoo_players-412"><span class="linenos">412</span></a>                        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">field</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span>
</span><span id="League.get_yahoo_players-413"><a href="#League.get_yahoo_players-413"><span class="linenos">413</span></a>                    <span class="p">]</span>
</span><span id="League.get_yahoo_players-414"><a href="#League.get_yahoo_players-414"><span class="linenos">414</span></a>                    <span class="n">vals</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="League.get_yahoo_players-415"><a href="#League.get_yahoo_players-415"><span class="linenos">415</span></a>                    <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">player</span><span class="p">:</span>
</span><span id="League.get_yahoo_players-416"><a href="#League.get_yahoo_players-416"><span class="linenos">416</span></a>                        <span class="n">vals</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
</span><span id="League.get_yahoo_players-417"><a href="#League.get_yahoo_players-417"><span class="linenos">417</span></a>                    <span class="n">vals</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vals</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">][</span><span class="s2">&quot;full&quot;</span><span class="p">]</span>
</span><span id="League.get_yahoo_players-418"><a href="#League.get_yahoo_players-418"><span class="linenos">418</span></a>                    <span class="n">vals</span><span class="p">[</span><span class="s2">&quot;eligible_positions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="League.get_yahoo_players-419"><a href="#League.get_yahoo_players-419"><span class="linenos">419</span></a>                        <span class="n">pos</span><span class="p">[</span><span class="s2">&quot;position&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">[</span><span class="s2">&quot;eligible_positions&quot;</span><span class="p">]</span>
</span><span id="League.get_yahoo_players-420"><a href="#League.get_yahoo_players-420"><span class="linenos">420</span></a>                    <span class="p">]</span>
</span><span id="League.get_yahoo_players-421"><a href="#League.get_yahoo_players-421"><span class="linenos">421</span></a>                    <span class="n">vals</span><span class="p">[</span><span class="s2">&quot;bye_weeks&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vals</span><span class="p">[</span><span class="s2">&quot;bye_weeks&quot;</span><span class="p">][</span><span class="s2">&quot;week&quot;</span><span class="p">]</span>
</span><span id="League.get_yahoo_players-422"><a href="#League.get_yahoo_players-422"><span class="linenos">422</span></a>                    <span class="n">players</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>
</span><span id="League.get_yahoo_players-423"><a href="#League.get_yahoo_players-423"><span class="linenos">423</span></a>            <span class="c1"># Available Players</span>
</span><span id="League.get_yahoo_players-424"><a href="#League.get_yahoo_players-424"><span class="linenos">424</span></a>            <span class="k">for</span> <span class="n">page_ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
</span><span id="League.get_yahoo_players-425"><a href="#League.get_yahoo_players-425"><span class="linenos">425</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;Accounting for a weird player_id deletion in 2015...&quot;&quot;&quot;</span>
</span><span id="League.get_yahoo_players-426"><a href="#League.get_yahoo_players-426"><span class="linenos">426</span></a>                <span class="n">page</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lg</span><span class="o">.</span><span class="n">yhandler</span><span class="o">.</span><span class="n">get_players_raw</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lg_id</span><span class="p">,</span> <span class="n">page_ind</span> <span class="o">*</span> <span class="mi">25</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">)</span>
</span><span id="League.get_yahoo_players-427"><a href="#League.get_yahoo_players-427"><span class="linenos">427</span></a>                <span class="n">page</span> <span class="o">=</span> <span class="n">page</span><span class="p">[</span><span class="s2">&quot;fantasy_content&quot;</span><span class="p">][</span><span class="s2">&quot;league&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;players&quot;</span><span class="p">]</span>
</span><span id="League.get_yahoo_players-428"><a href="#League.get_yahoo_players-428"><span class="linenos">428</span></a>                <span class="k">if</span> <span class="n">page</span> <span class="o">==</span> <span class="p">[]:</span>
</span><span id="League.get_yahoo_players-429"><a href="#League.get_yahoo_players-429"><span class="linenos">429</span></a>                    <span class="k">break</span>
</span><span id="League.get_yahoo_players-430"><a href="#League.get_yahoo_players-430"><span class="linenos">430</span></a>                <span class="k">for</span> <span class="n">player_ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">page</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]):</span>
</span><span id="League.get_yahoo_players-431"><a href="#League.get_yahoo_players-431"><span class="linenos">431</span></a>                    <span class="n">player</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="League.get_yahoo_players-432"><a href="#League.get_yahoo_players-432"><span class="linenos">432</span></a>                        <span class="n">field</span>
</span><span id="League.get_yahoo_players-433"><a href="#League.get_yahoo_players-433"><span class="linenos">433</span></a>                        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">page</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">player_ind</span><span class="p">)][</span><span class="s2">&quot;player&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League.get_yahoo_players-434"><a href="#League.get_yahoo_players-434"><span class="linenos">434</span></a>                        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">field</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span>
</span><span id="League.get_yahoo_players-435"><a href="#League.get_yahoo_players-435"><span class="linenos">435</span></a>                    <span class="p">]</span>
</span><span id="League.get_yahoo_players-436"><a href="#League.get_yahoo_players-436"><span class="linenos">436</span></a>                    <span class="n">vals</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="League.get_yahoo_players-437"><a href="#League.get_yahoo_players-437"><span class="linenos">437</span></a>                    <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">player</span><span class="p">:</span>
</span><span id="League.get_yahoo_players-438"><a href="#League.get_yahoo_players-438"><span class="linenos">438</span></a>                        <span class="n">vals</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
</span><span id="League.get_yahoo_players-439"><a href="#League.get_yahoo_players-439"><span class="linenos">439</span></a>                    <span class="n">vals</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vals</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">][</span><span class="s2">&quot;full&quot;</span><span class="p">]</span>
</span><span id="League.get_yahoo_players-440"><a href="#League.get_yahoo_players-440"><span class="linenos">440</span></a>                    <span class="n">vals</span><span class="p">[</span><span class="s2">&quot;eligible_positions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="League.get_yahoo_players-441"><a href="#League.get_yahoo_players-441"><span class="linenos">441</span></a>                        <span class="n">pos</span><span class="p">[</span><span class="s2">&quot;position&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">[</span><span class="s2">&quot;eligible_positions&quot;</span><span class="p">]</span>
</span><span id="League.get_yahoo_players-442"><a href="#League.get_yahoo_players-442"><span class="linenos">442</span></a>                    <span class="p">]</span>
</span><span id="League.get_yahoo_players-443"><a href="#League.get_yahoo_players-443"><span class="linenos">443</span></a>                    <span class="n">vals</span><span class="p">[</span><span class="s2">&quot;bye_weeks&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vals</span><span class="p">[</span><span class="s2">&quot;bye_weeks&quot;</span><span class="p">][</span><span class="s2">&quot;week&quot;</span><span class="p">]</span>
</span><span id="League.get_yahoo_players-444"><a href="#League.get_yahoo_players-444"><span class="linenos">444</span></a>                    <span class="n">players</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>
</span><span id="League.get_yahoo_players-445"><a href="#League.get_yahoo_players-445"><span class="linenos">445</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">players</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">players</span><span class="p">)</span>
</span><span id="League.get_yahoo_players-446"><a href="#League.get_yahoo_players-446"><span class="linenos">446</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">player_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">player_id</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="League.get_yahoo_players-447"><a href="#League.get_yahoo_players-447"><span class="linenos">447</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
</span><span id="League.get_yahoo_players-448"><a href="#League.get_yahoo_players-448"><span class="linenos">448</span></a>                <span class="k">break</span>
</span></pre></div>


            <div class="docstring"><p>Pulls a dataframe containing details about all NFL players that are eligible 
to be rostered in the fantasy league in question. Injury statuses will occasionally 
be excluded by API; in that case, the function will repeat the pull until it sees 
the injury statuses or hits the upper limit provided in injurytries.</p>

<p>Args:
    injurytries (int, optional): maximum number of times the code will try to pull the player list, defaults to 10.</p>
</div>


                            </div>
                            <div id="League.get_fantasy_rosters" class="classattr">
                                        <input id="League.get_fantasy_rosters-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_fantasy_rosters</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="League.get_fantasy_rosters-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#League.get_fantasy_rosters"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="League.get_fantasy_rosters-450"><a href="#League.get_fantasy_rosters-450"><span class="linenos">450</span></a>    <span class="k">def</span> <span class="nf">get_fantasy_rosters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="League.get_fantasy_rosters-451"><a href="#League.get_fantasy_rosters-451"><span class="linenos">451</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="League.get_fantasy_rosters-452"><a href="#League.get_fantasy_rosters-452"><span class="linenos">452</span></a><span class="sd">        Pulls the current fantasy team of each eligible NFL player </span>
</span><span id="League.get_fantasy_rosters-453"><a href="#League.get_fantasy_rosters-453"><span class="linenos">453</span></a><span class="sd">        and merges it into the players dataframe.</span>
</span><span id="League.get_fantasy_rosters-454"><a href="#League.get_fantasy_rosters-454"><span class="linenos">454</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="League.get_fantasy_rosters-455"><a href="#League.get_fantasy_rosters-455"><span class="linenos">455</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_oauth</span><span class="p">()</span>
</span><span id="League.get_fantasy_rosters-456"><a href="#League.get_fantasy_rosters-456"><span class="linenos">456</span></a>        <span class="n">selected</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span><span id="League.get_fantasy_rosters-457"><a href="#League.get_fantasy_rosters-457"><span class="linenos">457</span></a>            <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;player_id&quot;</span><span class="p">,</span> <span class="s2">&quot;selected_position&quot;</span><span class="p">,</span> <span class="s2">&quot;fantasy_team&quot;</span><span class="p">]</span>
</span><span id="League.get_fantasy_rosters-458"><a href="#League.get_fantasy_rosters-458"><span class="linenos">458</span></a>        <span class="p">)</span>
</span><span id="League.get_fantasy_rosters-459"><a href="#League.get_fantasy_rosters-459"><span class="linenos">459</span></a>        <span class="k">for</span> <span class="n">team</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">teams</span><span class="p">:</span>
</span><span id="League.get_fantasy_rosters-460"><a href="#League.get_fantasy_rosters-460"><span class="linenos">460</span></a>            <span class="n">tm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lg</span><span class="o">.</span><span class="n">to_team</span><span class="p">(</span><span class="n">team</span><span class="p">[</span><span class="s2">&quot;team_key&quot;</span><span class="p">])</span>
</span><span id="League.get_fantasy_rosters-461"><a href="#League.get_fantasy_rosters-461"><span class="linenos">461</span></a>            <span class="n">players</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">tm</span><span class="o">.</span><span class="n">roster</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">week</span><span class="p">))</span>
</span><span id="League.get_fantasy_rosters-462"><a href="#League.get_fantasy_rosters-462"><span class="linenos">462</span></a>            <span class="k">if</span> <span class="n">players</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="League.get_fantasy_rosters-463"><a href="#League.get_fantasy_rosters-463"><span class="linenos">463</span></a>                <span class="k">continue</span>
</span><span id="League.get_fantasy_rosters-464"><a href="#League.get_fantasy_rosters-464"><span class="linenos">464</span></a>            <span class="k">if</span> <span class="p">(</span><span class="o">~</span><span class="n">players</span><span class="o">.</span><span class="n">player_id</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">player_id</span><span class="p">))</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="League.get_fantasy_rosters-465"><a href="#League.get_fantasy_rosters-465"><span class="linenos">465</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="League.get_fantasy_rosters-466"><a href="#League.get_fantasy_rosters-466"><span class="linenos">466</span></a>                    <span class="s2">&quot;Some players are missing... &quot;</span>
</span><span id="League.get_fantasy_rosters-467"><a href="#League.get_fantasy_rosters-467"><span class="linenos">467</span></a>                    <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="League.get_fantasy_rosters-468"><a href="#League.get_fantasy_rosters-468"><span class="linenos">468</span></a>                        <span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">players</span><span class="o">.</span><span class="n">player_id</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">rosters</span><span class="o">.</span><span class="n">player_id</span><span class="p">),</span> <span class="s2">&quot;name&quot;</span><span class="p">]</span>
</span><span id="League.get_fantasy_rosters-469"><a href="#League.get_fantasy_rosters-469"><span class="linenos">469</span></a>                    <span class="p">)</span>
</span><span id="League.get_fantasy_rosters-470"><a href="#League.get_fantasy_rosters-470"><span class="linenos">470</span></a>                <span class="p">)</span>
</span><span id="League.get_fantasy_rosters-471"><a href="#League.get_fantasy_rosters-471"><span class="linenos">471</span></a>            <span class="n">players</span><span class="p">[</span><span class="s2">&quot;fantasy_team&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">team</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
</span><span id="League.get_fantasy_rosters-472"><a href="#League.get_fantasy_rosters-472"><span class="linenos">472</span></a>            <span class="n">selected</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">selected</span><span class="p">,</span>
</span><span id="League.get_fantasy_rosters-473"><a href="#League.get_fantasy_rosters-473"><span class="linenos">473</span></a>                <span class="n">players</span><span class="p">[[</span><span class="s2">&quot;player_id&quot;</span><span class="p">,</span> <span class="s2">&quot;selected_position&quot;</span><span class="p">,</span> <span class="s2">&quot;fantasy_team&quot;</span><span class="p">]]],</span>
</span><span id="League.get_fantasy_rosters-474"><a href="#League.get_fantasy_rosters-474"><span class="linenos">474</span></a>                <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="League.get_fantasy_rosters-475"><a href="#League.get_fantasy_rosters-475"><span class="linenos">475</span></a>                <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="League.get_fantasy_rosters-476"><a href="#League.get_fantasy_rosters-476"><span class="linenos">476</span></a>            <span class="p">)</span>
</span><span id="League.get_fantasy_rosters-477"><a href="#League.get_fantasy_rosters-477"><span class="linenos">477</span></a>        <span class="n">rosters</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League.get_fantasy_rosters-478"><a href="#League.get_fantasy_rosters-478"><span class="linenos">478</span></a>            <span class="n">left</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">selected</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;player_id&quot;</span>
</span><span id="League.get_fantasy_rosters-479"><a href="#League.get_fantasy_rosters-479"><span class="linenos">479</span></a>        <span class="p">)</span>
</span><span id="League.get_fantasy_rosters-480"><a href="#League.get_fantasy_rosters-480"><span class="linenos">480</span></a>        <span class="k">if</span> <span class="s2">&quot;fantasy_team&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">rosters</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="League.get_fantasy_rosters-481"><a href="#League.get_fantasy_rosters-481"><span class="linenos">481</span></a>            <span class="n">rosters</span><span class="p">[</span><span class="s2">&quot;fantasy_team&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="League.get_fantasy_rosters-482"><a href="#League.get_fantasy_rosters-482"><span class="linenos">482</span></a>        <span class="n">rosters</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">rosters</span><span class="o">.</span><span class="n">player_id</span> <span class="o">==</span> <span class="mi">100014</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="s2">&quot; Rams&quot;</span>
</span><span id="League.get_fantasy_rosters-483"><a href="#League.get_fantasy_rosters-483"><span class="linenos">483</span></a>        <span class="n">rosters</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">rosters</span><span class="o">.</span><span class="n">player_id</span> <span class="o">==</span> <span class="mi">100024</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="s2">&quot; Chargers&quot;</span>
</span><span id="League.get_fantasy_rosters-484"><a href="#League.get_fantasy_rosters-484"><span class="linenos">484</span></a>        <span class="n">rosters</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">rosters</span><span class="o">.</span><span class="n">player_id</span> <span class="o">==</span> <span class="mi">100020</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="s2">&quot; Jets&quot;</span>
</span><span id="League.get_fantasy_rosters-485"><a href="#League.get_fantasy_rosters-485"><span class="linenos">485</span></a>        <span class="n">rosters</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">rosters</span><span class="o">.</span><span class="n">player_id</span> <span class="o">==</span> <span class="mi">100019</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="s2">&quot; Giants&quot;</span>
</span><span id="League.get_fantasy_rosters-486"><a href="#League.get_fantasy_rosters-486"><span class="linenos">486</span></a>        <span class="n">rosters</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League.get_fantasy_rosters-487"><a href="#League.get_fantasy_rosters-487"><span class="linenos">487</span></a>            <span class="n">left</span><span class="o">=</span><span class="n">rosters</span><span class="p">,</span>
</span><span id="League.get_fantasy_rosters-488"><a href="#League.get_fantasy_rosters-488"><span class="linenos">488</span></a>            <span class="n">right</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nfl_teams</span><span class="p">[[</span><span class="s2">&quot;real_abbrev&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">]],</span>
</span><span id="League.get_fantasy_rosters-489"><a href="#League.get_fantasy_rosters-489"><span class="linenos">489</span></a>            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
</span><span id="League.get_fantasy_rosters-490"><a href="#League.get_fantasy_rosters-490"><span class="linenos">490</span></a>            <span class="n">on</span><span class="o">=</span><span class="s2">&quot;name&quot;</span><span class="p">,</span>
</span><span id="League.get_fantasy_rosters-491"><a href="#League.get_fantasy_rosters-491"><span class="linenos">491</span></a>        <span class="p">)</span>
</span><span id="League.get_fantasy_rosters-492"><a href="#League.get_fantasy_rosters-492"><span class="linenos">492</span></a>        <span class="n">rosters</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">rosters</span><span class="o">.</span><span class="n">real_abbrev</span><span class="o">.</span><span class="n">isnull</span><span class="p">(),</span> <span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rosters</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League.get_fantasy_rosters-493"><a href="#League.get_fantasy_rosters-493"><span class="linenos">493</span></a>            <span class="o">~</span><span class="n">rosters</span><span class="o">.</span><span class="n">real_abbrev</span><span class="o">.</span><span class="n">isnull</span><span class="p">(),</span> <span class="s2">&quot;real_abbrev&quot;</span>
</span><span id="League.get_fantasy_rosters-494"><a href="#League.get_fantasy_rosters-494"><span class="linenos">494</span></a>        <span class="p">]</span>
</span><span id="League.get_fantasy_rosters-495"><a href="#League.get_fantasy_rosters-495"><span class="linenos">495</span></a>        <span class="n">rosters</span><span class="p">[</span><span class="s2">&quot;position&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rosters</span><span class="o">.</span><span class="n">display_position</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
</span><span id="League.get_fantasy_rosters-496"><a href="#League.get_fantasy_rosters-496"><span class="linenos">496</span></a>            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span><span class="n">pos</span> <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">pos</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;QB&#39;</span><span class="p">,</span><span class="s1">&#39;WR&#39;</span><span class="p">,</span><span class="s1">&#39;TE&#39;</span><span class="p">,</span><span class="s1">&#39;K&#39;</span><span class="p">,</span><span class="s1">&#39;RB&#39;</span><span class="p">,</span><span class="s1">&#39;DEF&#39;</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League.get_fantasy_rosters-497"><a href="#League.get_fantasy_rosters-497"><span class="linenos">497</span></a>        <span class="p">)</span>
</span><span id="League.get_fantasy_rosters-498"><a href="#League.get_fantasy_rosters-498"><span class="linenos">498</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span> <span class="o">=</span> <span class="n">rosters</span><span class="p">[</span>
</span><span id="League.get_fantasy_rosters-499"><a href="#League.get_fantasy_rosters-499"><span class="linenos">499</span></a>            <span class="p">[</span>
</span><span id="League.get_fantasy_rosters-500"><a href="#League.get_fantasy_rosters-500"><span class="linenos">500</span></a>                <span class="s2">&quot;name&quot;</span><span class="p">,</span>
</span><span id="League.get_fantasy_rosters-501"><a href="#League.get_fantasy_rosters-501"><span class="linenos">501</span></a>                <span class="s2">&quot;eligible_positions&quot;</span><span class="p">,</span>
</span><span id="League.get_fantasy_rosters-502"><a href="#League.get_fantasy_rosters-502"><span class="linenos">502</span></a>                <span class="s2">&quot;selected_position&quot;</span><span class="p">,</span>
</span><span id="League.get_fantasy_rosters-503"><a href="#League.get_fantasy_rosters-503"><span class="linenos">503</span></a>                <span class="s2">&quot;status&quot;</span><span class="p">,</span>
</span><span id="League.get_fantasy_rosters-504"><a href="#League.get_fantasy_rosters-504"><span class="linenos">504</span></a>                <span class="s2">&quot;player_id&quot;</span><span class="p">,</span>
</span><span id="League.get_fantasy_rosters-505"><a href="#League.get_fantasy_rosters-505"><span class="linenos">505</span></a>                <span class="s2">&quot;editorial_team_abbr&quot;</span><span class="p">,</span>
</span><span id="League.get_fantasy_rosters-506"><a href="#League.get_fantasy_rosters-506"><span class="linenos">506</span></a>                <span class="s2">&quot;fantasy_team&quot;</span><span class="p">,</span>
</span><span id="League.get_fantasy_rosters-507"><a href="#League.get_fantasy_rosters-507"><span class="linenos">507</span></a>                <span class="s2">&quot;position&quot;</span><span class="p">,</span>
</span><span id="League.get_fantasy_rosters-508"><a href="#League.get_fantasy_rosters-508"><span class="linenos">508</span></a>            <span class="p">]</span>
</span><span id="League.get_fantasy_rosters-509"><a href="#League.get_fantasy_rosters-509"><span class="linenos">509</span></a>        <span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Pulls the current fantasy team of each eligible NFL player 
and merges it into the players dataframe.</p>
</div>


                            </div>
                            <div id="League.pull_stats" class="classattr">
                                        <input id="League.pull_stats-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">pull_stats</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">start</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">finish</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;GameByGameFantasyFootballStats.csv&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="League.pull_stats-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#League.pull_stats"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="League.pull_stats-511"><a href="#League.pull_stats-511"><span class="linenos">511</span></a>    <span class="k">def</span> <span class="nf">pull_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">finish</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;GameByGameFantasyFootballStats.csv&quot;</span><span class="p">):</span>
</span><span id="League.pull_stats-512"><a href="#League.pull_stats-512"><span class="linenos">512</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="League.pull_stats-513"><a href="#League.pull_stats-513"><span class="linenos">513</span></a><span class="sd">        Pulls a dataframe containing event rates based on per-game statistics during the specified timeframe.</span>
</span><span id="League.pull_stats-514"><a href="#League.pull_stats-514"><span class="linenos">514</span></a>
</span><span id="League.pull_stats-515"><a href="#League.pull_stats-515"><span class="linenos">515</span></a><span class="sd">        Args:</span>
</span><span id="League.pull_stats-516"><a href="#League.pull_stats-516"><span class="linenos">516</span></a><span class="sd">            start (int): year and number of the first week of interest (YYYYWW, e.g. 202102 = week 2 of 2021).  </span>
</span><span id="League.pull_stats-517"><a href="#League.pull_stats-517"><span class="linenos">517</span></a><span class="sd">            finish (int): year and number of the last week of interest (YYYYWW, e.g. 202307 = week 7 of 2023).  </span>
</span><span id="League.pull_stats-518"><a href="#League.pull_stats-518"><span class="linenos">518</span></a><span class="sd">            path (str, optional): location of saved per-game statistics, defaults to &quot;GameByGameFantasyFootballStats.csv&quot;.</span>
</span><span id="League.pull_stats-519"><a href="#League.pull_stats-519"><span class="linenos">519</span></a>
</span><span id="League.pull_stats-520"><a href="#League.pull_stats-520"><span class="linenos">520</span></a><span class="sd">        Returns:</span>
</span><span id="League.pull_stats-521"><a href="#League.pull_stats-521"><span class="linenos">521</span></a><span class="sd">            pd.DataFrame: dataframe containing player rates based on games during the timespan of interest.</span>
</span><span id="League.pull_stats-522"><a href="#League.pull_stats-522"><span class="linenos">522</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="League.pull_stats-523"><a href="#League.pull_stats-523"><span class="linenos">523</span></a>        <span class="n">stats</span> <span class="o">=</span> <span class="n">sr</span><span class="o">.</span><span class="n">get_bulk_stats</span><span class="p">(</span><span class="n">start</span><span class="o">//</span><span class="mi">100</span><span class="p">,</span><span class="n">start</span><span class="o">%</span><span class="mi">100</span><span class="p">,</span><span class="n">finish</span><span class="o">//</span><span class="mi">100</span><span class="p">,</span><span class="n">finish</span><span class="o">%</span><span class="mi">100</span><span class="p">,</span><span class="kc">False</span><span class="p">,</span><span class="n">path</span><span class="p">)</span>
</span><span id="League.pull_stats-524"><a href="#League.pull_stats-524"><span class="linenos">524</span></a>        <span class="n">s</span> <span class="o">=</span> <span class="n">sr</span><span class="o">.</span><span class="n">Schedule</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">season</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="n">stats</span><span class="o">.</span><span class="n">season</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</span><span id="League.pull_stats-525"><a href="#League.pull_stats-525"><span class="linenos">525</span></a>        <span class="n">pts_allowed</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">s</span><span class="o">.</span><span class="n">schedule</span><span class="p">[[</span><span class="s1">&#39;boxscore_abbrev&#39;</span><span class="p">,</span><span class="s1">&#39;team1_abbrev&#39;</span><span class="p">,</span><span class="s1">&#39;score2&#39;</span><span class="p">]]</span>\
</span><span id="League.pull_stats-526"><a href="#League.pull_stats-526"><span class="linenos">526</span></a>        <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;boxscore_abbrev&#39;</span><span class="p">:</span><span class="s1">&#39;game_id&#39;</span><span class="p">,</span><span class="s1">&#39;team1_abbrev&#39;</span><span class="p">:</span><span class="s1">&#39;team&#39;</span><span class="p">,</span><span class="s1">&#39;score2&#39;</span><span class="p">:</span><span class="s1">&#39;points_allowed&#39;</span><span class="p">}),</span>\
</span><span id="League.pull_stats-527"><a href="#League.pull_stats-527"><span class="linenos">527</span></a>        <span class="n">s</span><span class="o">.</span><span class="n">schedule</span><span class="p">[[</span><span class="s1">&#39;boxscore_abbrev&#39;</span><span class="p">,</span><span class="s1">&#39;team2_abbrev&#39;</span><span class="p">,</span><span class="s1">&#39;score1&#39;</span><span class="p">]]</span>\
</span><span id="League.pull_stats-528"><a href="#League.pull_stats-528"><span class="linenos">528</span></a>        <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;boxscore_abbrev&#39;</span><span class="p">:</span><span class="s1">&#39;game_id&#39;</span><span class="p">,</span><span class="s1">&#39;team2_abbrev&#39;</span><span class="p">:</span><span class="s1">&#39;team&#39;</span><span class="p">,</span><span class="s1">&#39;score1&#39;</span><span class="p">:</span><span class="s1">&#39;points_allowed&#39;</span><span class="p">})],</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="League.pull_stats-529"><a href="#League.pull_stats-529"><span class="linenos">529</span></a>        <span class="n">stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">stats</span><span class="p">,</span><span class="n">right</span><span class="o">=</span><span class="n">pts_allowed</span><span class="p">,</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;game_id&#39;</span><span class="p">,</span><span class="s1">&#39;team&#39;</span><span class="p">])</span>
</span><span id="League.pull_stats-530"><a href="#League.pull_stats-530"><span class="linenos">530</span></a>        <span class="n">pos_corrections</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
</span><span id="League.pull_stats-531"><a href="#League.pull_stats-531"><span class="linenos">531</span></a>            <span class="s2">&quot;https://raw.githubusercontent.com/&quot;</span>
</span><span id="League.pull_stats-532"><a href="#League.pull_stats-532"><span class="linenos">532</span></a>            <span class="o">+</span> <span class="s2">&quot;tefirman/FantasySports/main/res/football/pos_corrections.csv&quot;</span>
</span><span id="League.pull_stats-533"><a href="#League.pull_stats-533"><span class="linenos">533</span></a>        <span class="p">)</span>
</span><span id="League.pull_stats-534"><a href="#League.pull_stats-534"><span class="linenos">534</span></a>        <span class="n">stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">stats</span><span class="p">,</span><span class="n">right</span><span class="o">=</span><span class="n">pos_corrections</span><span class="p">[[</span><span class="s1">&#39;player_id&#39;</span><span class="p">,</span><span class="s1">&#39;actual_pos&#39;</span><span class="p">]],</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;player_id&#39;</span><span class="p">])</span>
</span><span id="League.pull_stats-535"><a href="#League.pull_stats-535"><span class="linenos">535</span></a>        <span class="n">stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">stats</span><span class="o">.</span><span class="n">actual_pos</span><span class="o">.</span><span class="n">isnull</span><span class="p">(),</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">stats</span><span class="o">.</span><span class="n">actual_pos</span><span class="o">.</span><span class="n">isnull</span><span class="p">(),</span><span class="s1">&#39;actual_pos&#39;</span><span class="p">]</span>
</span><span id="League.pull_stats-536"><a href="#League.pull_stats-536"><span class="linenos">536</span></a>        <span class="k">del</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;actual_pos&#39;</span><span class="p">]</span>
</span><span id="League.pull_stats-537"><a href="#League.pull_stats-537"><span class="linenos">537</span></a>        <span class="n">to_fix</span> <span class="o">=</span> <span class="o">~</span><span class="n">stats</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;QB&quot;</span><span class="p">,</span> <span class="s2">&quot;RB&quot;</span><span class="p">,</span> <span class="s2">&quot;WR&quot;</span><span class="p">,</span> <span class="s2">&quot;TE&quot;</span><span class="p">,</span> <span class="s2">&quot;K&quot;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span>
</span><span id="League.pull_stats-538"><a href="#League.pull_stats-538"><span class="linenos">538</span></a>            <span class="n">stats</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;QB&quot;</span><span class="p">)</span>
</span><span id="League.pull_stats-539"><a href="#League.pull_stats-539"><span class="linenos">539</span></a>            <span class="o">|</span> <span class="n">stats</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;WR&quot;</span><span class="p">)</span>
</span><span id="League.pull_stats-540"><a href="#League.pull_stats-540"><span class="linenos">540</span></a>            <span class="o">|</span> <span class="n">stats</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;RB&quot;</span><span class="p">)</span>
</span><span id="League.pull_stats-541"><a href="#League.pull_stats-541"><span class="linenos">541</span></a>            <span class="o">|</span> <span class="n">stats</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;TE&quot;</span><span class="p">)</span>
</span><span id="League.pull_stats-542"><a href="#League.pull_stats-542"><span class="linenos">542</span></a>            <span class="o">|</span> <span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;K&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">stats</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;MIKE&quot;</span><span class="p">,</span><span class="s2">&quot;JACK&quot;</span><span class="p">]))</span>
</span><span id="League.pull_stats-543"><a href="#League.pull_stats-543"><span class="linenos">543</span></a>        <span class="p">)</span>
</span><span id="League.pull_stats-544"><a href="#League.pull_stats-544"><span class="linenos">544</span></a>        <span class="k">if</span> <span class="n">to_fix</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="League.pull_stats-545"><a href="#League.pull_stats-545"><span class="linenos">545</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Weird positions in game-by-game stats...&#39;</span><span class="p">)</span>
</span><span id="League.pull_stats-546"><a href="#League.pull_stats-546"><span class="linenos">546</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">to_fix</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;player_id&quot;</span><span class="p">,</span> <span class="s2">&quot;player&quot;</span><span class="p">,</span> <span class="s2">&quot;pos&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
</span><span id="League.pull_stats-547"><a href="#League.pull_stats-547"><span class="linenos">547</span></a>        <span class="n">defenses</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League.pull_stats-548"><a href="#League.pull_stats-548"><span class="linenos">548</span></a>            <span class="n">stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">stats</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;QB&quot;</span><span class="p">,</span> <span class="s2">&quot;RB&quot;</span><span class="p">,</span> <span class="s2">&quot;WR&quot;</span><span class="p">,</span> <span class="s2">&quot;TE&quot;</span><span class="p">,</span> <span class="s2">&quot;K&quot;</span><span class="p">])]</span>
</span><span id="League.pull_stats-549"><a href="#League.pull_stats-549"><span class="linenos">549</span></a>            <span class="o">.</span><span class="n">groupby</span><span class="p">(</span>
</span><span id="League.pull_stats-550"><a href="#League.pull_stats-550"><span class="linenos">550</span></a>                <span class="p">[</span><span class="s2">&quot;game_id&quot;</span><span class="p">,</span> <span class="s2">&quot;season&quot;</span><span class="p">,</span> <span class="s2">&quot;week&quot;</span><span class="p">,</span> <span class="s2">&quot;team&quot;</span><span class="p">,</span> <span class="s2">&quot;opponent&quot;</span><span class="p">,</span> <span class="s2">&quot;points_allowed&quot;</span><span class="p">]</span>
</span><span id="League.pull_stats-551"><a href="#League.pull_stats-551"><span class="linenos">551</span></a>            <span class="p">)</span>
</span><span id="League.pull_stats-552"><a href="#League.pull_stats-552"><span class="linenos">552</span></a>            <span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">numeric_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="League.pull_stats-553"><a href="#League.pull_stats-553"><span class="linenos">553</span></a>            <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="League.pull_stats-554"><a href="#League.pull_stats-554"><span class="linenos">554</span></a>        <span class="p">)</span>
</span><span id="League.pull_stats-555"><a href="#League.pull_stats-555"><span class="linenos">555</span></a>        <span class="n">defenses</span><span class="p">[</span><span class="s2">&quot;player&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">defenses</span><span class="p">[</span><span class="s2">&quot;team&quot;</span><span class="p">]</span>
</span><span id="League.pull_stats-556"><a href="#League.pull_stats-556"><span class="linenos">556</span></a>        <span class="n">defenses</span><span class="p">[</span><span class="s2">&quot;player_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">defenses</span><span class="p">[</span><span class="s2">&quot;player&quot;</span><span class="p">]</span>
</span><span id="League.pull_stats-557"><a href="#League.pull_stats-557"><span class="linenos">557</span></a>        <span class="n">defenses</span><span class="p">[</span><span class="s2">&quot;pos&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;DEF&quot;</span>
</span><span id="League.pull_stats-558"><a href="#League.pull_stats-558"><span class="linenos">558</span></a>        <span class="k">if</span> <span class="s2">&quot;string&quot;</span> <span class="ow">in</span> <span class="n">defenses</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="League.pull_stats-559"><a href="#League.pull_stats-559"><span class="linenos">559</span></a>            <span class="n">defenses</span><span class="p">[</span><span class="s2">&quot;string&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="League.pull_stats-560"><a href="#League.pull_stats-560"><span class="linenos">560</span></a>        <span class="n">defenses</span> <span class="o">=</span> <span class="n">defenses</span><span class="p">[[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">stats</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">defenses</span><span class="o">.</span><span class="n">columns</span><span class="p">]]</span>
</span><span id="League.pull_stats-561"><a href="#League.pull_stats-561"><span class="linenos">561</span></a>        <span class="n">stats</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">stats</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;QB&quot;</span><span class="p">,</span> <span class="s2">&quot;RB&quot;</span><span class="p">,</span> <span class="s2">&quot;WR&quot;</span><span class="p">,</span> <span class="s2">&quot;TE&quot;</span><span class="p">,</span> <span class="s2">&quot;K&quot;</span><span class="p">])]</span>
</span><span id="League.pull_stats-562"><a href="#League.pull_stats-562"><span class="linenos">562</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">stats</span><span class="p">,</span><span class="n">defenses</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>\
</span><span id="League.pull_stats-563"><a href="#League.pull_stats-563"><span class="linenos">563</span></a>        <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;pos&#39;</span><span class="p">:</span><span class="s1">&#39;position&#39;</span><span class="p">,</span><span class="s1">&#39;player&#39;</span><span class="p">:</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;player_id&#39;</span><span class="p">:</span><span class="s1">&#39;player_id_sr&#39;</span><span class="p">})</span>
</span><span id="League.pull_stats-564"><a href="#League.pull_stats-564"><span class="linenos">564</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;weeks_ago&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">game_id</span><span class="o">.</span><span class="n">str</span><span class="p">[:</span><span class="mi">8</span><span class="p">]))</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">days</span> <span class="o">/</span> <span class="mf">7.0</span>
</span></pre></div>


            <div class="docstring"><p>Pulls a dataframe containing event rates based on per-game statistics during the specified timeframe.</p>

<p>Args:
    start (int): year and number of the first week of interest (YYYYWW, e.g. 202102 = week 2 of 2021). <br />
    finish (int): year and number of the last week of interest (YYYYWW, e.g. 202307 = week 7 of 2023). <br />
    path (str, optional): location of saved per-game statistics, defaults to "GameByGameFantasyFootballStats.csv".</p>

<p>Returns:
    pd.DataFrame: dataframe containing player rates based on games during the timespan of interest.</p>
</div>


                            </div>
                            <div id="League.add_points" class="classattr">
                                        <input id="League.add_points-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_points</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="League.add_points-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#League.add_points"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="League.add_points-566"><a href="#League.add_points-566"><span class="linenos">566</span></a>    <span class="k">def</span> <span class="nf">add_points</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="League.add_points-567"><a href="#League.add_points-567"><span class="linenos">567</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="League.add_points-568"><a href="#League.add_points-568"><span class="linenos">568</span></a><span class="sd">        Calculates per-game fantasy points based on per-game statistics and provided scoring settings.</span>
</span><span id="League.add_points-569"><a href="#League.add_points-569"><span class="linenos">569</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="League.add_points-570"><a href="#League.add_points-570"><span class="linenos">570</span></a>        <span class="n">offense</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">position</span> <span class="o">!=</span> <span class="s2">&quot;DEF&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="League.add_points-571"><a href="#League.add_points-571"><span class="linenos">571</span></a>        <span class="n">offense</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League.add_points-572"><a href="#League.add_points-572"><span class="linenos">572</span></a>            <span class="n">offense</span><span class="p">[</span><span class="s2">&quot;rush_yds&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Rush Yds&quot;</span><span class="p">]</span>
</span><span id="League.add_points-573"><a href="#League.add_points-573"><span class="linenos">573</span></a>            <span class="o">+</span> <span class="n">offense</span><span class="p">[</span><span class="s2">&quot;rush_att&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Rush Att&quot;</span><span class="p">]</span>
</span><span id="League.add_points-574"><a href="#League.add_points-574"><span class="linenos">574</span></a>            <span class="o">+</span> <span class="n">offense</span><span class="p">[</span><span class="s2">&quot;rush_td&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Rush TD&quot;</span><span class="p">]</span>
</span><span id="League.add_points-575"><a href="#League.add_points-575"><span class="linenos">575</span></a>            <span class="o">+</span> <span class="n">offense</span><span class="p">[</span><span class="s2">&quot;rush_first_down&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Rush 1D&quot;</span><span class="p">]</span>
</span><span id="League.add_points-576"><a href="#League.add_points-576"><span class="linenos">576</span></a>            <span class="o">+</span> <span class="n">offense</span><span class="p">[</span><span class="s2">&quot;rec&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Rec&quot;</span><span class="p">]</span>
</span><span id="League.add_points-577"><a href="#League.add_points-577"><span class="linenos">577</span></a>            <span class="o">+</span> <span class="n">offense</span><span class="p">[</span><span class="s2">&quot;rec_yds&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Rec Yds&quot;</span><span class="p">]</span>
</span><span id="League.add_points-578"><a href="#League.add_points-578"><span class="linenos">578</span></a>            <span class="o">+</span> <span class="n">offense</span><span class="p">[</span><span class="s2">&quot;rec_td&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Rec TD&quot;</span><span class="p">]</span>
</span><span id="League.add_points-579"><a href="#League.add_points-579"><span class="linenos">579</span></a>            <span class="o">+</span> <span class="n">offense</span><span class="p">[</span><span class="s2">&quot;rec_first_down&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Rec 1D&quot;</span><span class="p">]</span>
</span><span id="League.add_points-580"><a href="#League.add_points-580"><span class="linenos">580</span></a>            <span class="o">+</span> <span class="n">offense</span><span class="p">[</span><span class="s2">&quot;pass_yds&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Pass Yds&quot;</span><span class="p">]</span>
</span><span id="League.add_points-581"><a href="#League.add_points-581"><span class="linenos">581</span></a>            <span class="o">+</span> <span class="n">offense</span><span class="p">[</span><span class="s2">&quot;pass_cmp&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Pass Comp&quot;</span><span class="p">]</span>
</span><span id="League.add_points-582"><a href="#League.add_points-582"><span class="linenos">582</span></a>            <span class="o">+</span> <span class="n">offense</span><span class="p">[</span><span class="s2">&quot;pass_td&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Pass TD&quot;</span><span class="p">]</span>
</span><span id="League.add_points-583"><a href="#League.add_points-583"><span class="linenos">583</span></a>            <span class="o">+</span> <span class="n">offense</span><span class="p">[</span><span class="s2">&quot;pass_first_down&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Pass 1D&quot;</span><span class="p">]</span>
</span><span id="League.add_points-584"><a href="#League.add_points-584"><span class="linenos">584</span></a>            <span class="o">+</span> <span class="n">offense</span><span class="p">[</span><span class="s2">&quot;pass_int&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Int Thrown&quot;</span><span class="p">]</span>
</span><span id="League.add_points-585"><a href="#League.add_points-585"><span class="linenos">585</span></a>            <span class="o">+</span> <span class="n">offense</span><span class="p">[</span><span class="s2">&quot;fumbles_lost&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Fum Lost&quot;</span><span class="p">]</span>
</span><span id="League.add_points-586"><a href="#League.add_points-586"><span class="linenos">586</span></a>            <span class="o">+</span> <span class="p">(</span><span class="n">offense</span><span class="p">[</span><span class="s2">&quot;kick_ret_yds&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">offense</span><span class="p">[</span><span class="s2">&quot;punt_ret_yds&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Ret Yds&quot;</span><span class="p">]</span>
</span><span id="League.add_points-587"><a href="#League.add_points-587"><span class="linenos">587</span></a>            <span class="o">+</span> <span class="p">(</span><span class="n">offense</span><span class="p">[</span><span class="s2">&quot;kick_ret_td&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">offense</span><span class="p">[</span><span class="s2">&quot;punt_ret_td&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Ret TD&quot;</span><span class="p">]</span>
</span><span id="League.add_points-588"><a href="#League.add_points-588"><span class="linenos">588</span></a>            <span class="o">+</span> <span class="n">offense</span><span class="p">[</span><span class="s2">&quot;xpm&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;PAT Made&quot;</span><span class="p">]</span>
</span><span id="League.add_points-589"><a href="#League.add_points-589"><span class="linenos">589</span></a>            <span class="o">+</span> <span class="n">offense</span><span class="p">[</span><span class="s2">&quot;fgm&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;FG 0-19&quot;</span><span class="p">]</span>
</span><span id="League.add_points-590"><a href="#League.add_points-590"><span class="linenos">590</span></a>        <span class="p">)</span>
</span><span id="League.add_points-591"><a href="#League.add_points-591"><span class="linenos">591</span></a>        <span class="n">tes</span> <span class="o">=</span> <span class="n">offense</span><span class="o">.</span><span class="n">position</span> <span class="o">==</span> <span class="s1">&#39;TE&#39;</span>
</span><span id="League.add_points-592"><a href="#League.add_points-592"><span class="linenos">592</span></a>        <span class="n">offense</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">tes</span><span class="p">,</span><span class="s1">&#39;points&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">offense</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">tes</span><span class="p">,</span><span class="s1">&#39;rec&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s1">&#39;TE Rec Bonus&#39;</span><span class="p">]</span> <span class="o">+</span> \
</span><span id="League.add_points-593"><a href="#League.add_points-593"><span class="linenos">593</span></a>        <span class="p">(</span><span class="n">offense</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">tes</span><span class="p">,</span><span class="s1">&#39;rush_first_down&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">offense</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">tes</span><span class="p">,</span><span class="s1">&#39;rec_first_down&#39;</span><span class="p">]</span> <span class="o">+</span> \
</span><span id="League.add_points-594"><a href="#League.add_points-594"><span class="linenos">594</span></a>        <span class="n">offense</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">tes</span><span class="p">,</span><span class="s1">&#39;pass_first_down&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s1">&#39;TE 1D Bonus&#39;</span><span class="p">]</span>
</span><span id="League.add_points-595"><a href="#League.add_points-595"><span class="linenos">595</span></a>        <span class="n">offense</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">offense</span><span class="o">.</span><span class="n">pass_yds</span> <span class="o">&gt;=</span> <span class="mi">300</span><span class="p">,</span><span class="s1">&#39;points&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s1">&#39;Pass 300+&#39;</span><span class="p">]</span>
</span><span id="League.add_points-596"><a href="#League.add_points-596"><span class="linenos">596</span></a>        <span class="n">offense</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">offense</span><span class="o">.</span><span class="n">rush_yds</span> <span class="o">&gt;=</span> <span class="mi">100</span><span class="p">,</span><span class="s1">&#39;points&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s1">&#39;Rush 100+&#39;</span><span class="p">]</span>
</span><span id="League.add_points-597"><a href="#League.add_points-597"><span class="linenos">597</span></a>        <span class="n">offense</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">offense</span><span class="o">.</span><span class="n">rec_yds</span> <span class="o">&gt;=</span> <span class="mi">100</span><span class="p">,</span><span class="s1">&#39;points&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s1">&#39;Rec 100+&#39;</span><span class="p">]</span>
</span><span id="League.add_points-598"><a href="#League.add_points-598"><span class="linenos">598</span></a>        <span class="n">defense</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">position</span> <span class="o">==</span> <span class="s2">&quot;DEF&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="League.add_points-599"><a href="#League.add_points-599"><span class="linenos">599</span></a>        <span class="n">defense</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League.add_points-600"><a href="#League.add_points-600"><span class="linenos">600</span></a>            <span class="n">defense</span><span class="p">[</span><span class="s2">&quot;sacks&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Sack&quot;</span><span class="p">]</span>
</span><span id="League.add_points-601"><a href="#League.add_points-601"><span class="linenos">601</span></a>            <span class="o">+</span> <span class="n">defense</span><span class="p">[</span><span class="s2">&quot;def_int&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Int&quot;</span><span class="p">]</span>
</span><span id="League.add_points-602"><a href="#League.add_points-602"><span class="linenos">602</span></a>            <span class="o">+</span> <span class="n">defense</span><span class="p">[</span><span class="s2">&quot;fumbles_rec&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Fum Rec&quot;</span><span class="p">]</span>
</span><span id="League.add_points-603"><a href="#League.add_points-603"><span class="linenos">603</span></a>            <span class="o">+</span> <span class="p">(</span><span class="n">defense</span><span class="p">[</span><span class="s2">&quot;def_int_td&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">defense</span><span class="p">[</span><span class="s1">&#39;fumbles_rec_td&#39;</span><span class="p">]</span> 
</span><span id="League.add_points-604"><a href="#League.add_points-604"><span class="linenos">604</span></a>            <span class="o">+</span> <span class="n">defense</span><span class="p">[</span><span class="s2">&quot;kick_ret_td&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">defense</span><span class="p">[</span><span class="s2">&quot;punt_ret_td&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Ret TD&quot;</span><span class="p">]</span>
</span><span id="League.add_points-605"><a href="#League.add_points-605"><span class="linenos">605</span></a>        <span class="p">)</span>
</span><span id="League.add_points-606"><a href="#League.add_points-606"><span class="linenos">606</span></a>        <span class="n">defense</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">defense</span><span class="o">.</span><span class="n">points_allowed</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;points&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Pts Allow 0&quot;</span><span class="p">]</span>
</span><span id="League.add_points-607"><a href="#League.add_points-607"><span class="linenos">607</span></a>        <span class="n">defense</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League.add_points-608"><a href="#League.add_points-608"><span class="linenos">608</span></a>            <span class="p">(</span><span class="n">defense</span><span class="o">.</span><span class="n">points_allowed</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">defense</span><span class="o">.</span><span class="n">points_allowed</span> <span class="o">&lt;=</span> <span class="mi">6</span><span class="p">),</span> <span class="s2">&quot;points&quot;</span>
</span><span id="League.add_points-609"><a href="#League.add_points-609"><span class="linenos">609</span></a>        <span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Pts Allow 1-6&quot;</span><span class="p">]</span>
</span><span id="League.add_points-610"><a href="#League.add_points-610"><span class="linenos">610</span></a>        <span class="n">defense</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League.add_points-611"><a href="#League.add_points-611"><span class="linenos">611</span></a>            <span class="p">(</span><span class="n">defense</span><span class="o">.</span><span class="n">points_allowed</span> <span class="o">&gt;=</span> <span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">defense</span><span class="o">.</span><span class="n">points_allowed</span> <span class="o">&lt;=</span> <span class="mi">13</span><span class="p">),</span> <span class="s2">&quot;points&quot;</span>
</span><span id="League.add_points-612"><a href="#League.add_points-612"><span class="linenos">612</span></a>        <span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Pts Allow 7-13&quot;</span><span class="p">]</span>
</span><span id="League.add_points-613"><a href="#League.add_points-613"><span class="linenos">613</span></a>        <span class="n">defense</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League.add_points-614"><a href="#League.add_points-614"><span class="linenos">614</span></a>            <span class="p">(</span><span class="n">defense</span><span class="o">.</span><span class="n">points_allowed</span> <span class="o">&gt;=</span> <span class="mi">14</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">defense</span><span class="o">.</span><span class="n">points_allowed</span> <span class="o">&lt;=</span> <span class="mi">20</span><span class="p">),</span> <span class="s2">&quot;points&quot;</span>
</span><span id="League.add_points-615"><a href="#League.add_points-615"><span class="linenos">615</span></a>        <span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Pts Allow 14-20&quot;</span><span class="p">]</span>
</span><span id="League.add_points-616"><a href="#League.add_points-616"><span class="linenos">616</span></a>        <span class="n">defense</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League.add_points-617"><a href="#League.add_points-617"><span class="linenos">617</span></a>            <span class="p">(</span><span class="n">defense</span><span class="o">.</span><span class="n">points_allowed</span> <span class="o">&gt;=</span> <span class="mi">21</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">defense</span><span class="o">.</span><span class="n">points_allowed</span> <span class="o">&lt;=</span> <span class="mi">27</span><span class="p">),</span> <span class="s2">&quot;points&quot;</span>
</span><span id="League.add_points-618"><a href="#League.add_points-618"><span class="linenos">618</span></a>        <span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Pts Allow 21-27&quot;</span><span class="p">]</span>
</span><span id="League.add_points-619"><a href="#League.add_points-619"><span class="linenos">619</span></a>        <span class="n">defense</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League.add_points-620"><a href="#League.add_points-620"><span class="linenos">620</span></a>            <span class="p">(</span><span class="n">defense</span><span class="o">.</span><span class="n">points_allowed</span> <span class="o">&gt;=</span> <span class="mi">28</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">defense</span><span class="o">.</span><span class="n">points_allowed</span> <span class="o">&lt;=</span> <span class="mi">34</span><span class="p">),</span> <span class="s2">&quot;points&quot;</span>
</span><span id="League.add_points-621"><a href="#League.add_points-621"><span class="linenos">621</span></a>        <span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Pts Allow 28-34&quot;</span><span class="p">]</span>
</span><span id="League.add_points-622"><a href="#League.add_points-622"><span class="linenos">622</span></a>        <span class="n">defense</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">defense</span><span class="o">.</span><span class="n">points_allowed</span> <span class="o">&gt;=</span> <span class="mi">35</span><span class="p">),</span> <span class="s2">&quot;points&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">[</span><span class="s2">&quot;Pts Allow 35+&quot;</span><span class="p">]</span>
</span><span id="League.add_points-623"><a href="#League.add_points-623"><span class="linenos">623</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">offense</span><span class="p">,</span><span class="n">defense</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Calculates per-game fantasy points based on per-game statistics and provided scoring settings.</p>
</div>


                            </div>
                            <div id="League.load_stats" class="classattr">
                                        <input id="League.load_stats-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">load_stats</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">start</span><span class="p">:</span> <span class="nb">int</span>, </span><span class="param"><span class="n">finish</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="League.load_stats-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#League.load_stats"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="League.load_stats-625"><a href="#League.load_stats-625"><span class="linenos">625</span></a>    <span class="k">def</span> <span class="nf">load_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">finish</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="League.load_stats-626"><a href="#League.load_stats-626"><span class="linenos">626</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="League.load_stats-627"><a href="#League.load_stats-627"><span class="linenos">627</span></a><span class="sd">        Loads individual player statistics for each game in the specified timeframe </span>
</span><span id="League.load_stats-628"><a href="#League.load_stats-628"><span class="linenos">628</span></a><span class="sd">        and calculates fantasy points based on league settings. Initially looks for </span>
</span><span id="League.load_stats-629"><a href="#League.load_stats-629"><span class="linenos">629</span></a><span class="sd">        pre-pulled statistics saved locally and pulls new stats when necessary.</span>
</span><span id="League.load_stats-630"><a href="#League.load_stats-630"><span class="linenos">630</span></a>
</span><span id="League.load_stats-631"><a href="#League.load_stats-631"><span class="linenos">631</span></a><span class="sd">        Args:</span>
</span><span id="League.load_stats-632"><a href="#League.load_stats-632"><span class="linenos">632</span></a><span class="sd">            start (int): year and number of the first week of interest (YYYYWW, e.g. 202102 = week 2 of 2021).  </span>
</span><span id="League.load_stats-633"><a href="#League.load_stats-633"><span class="linenos">633</span></a><span class="sd">            finish (int): year and number of the last week of interest (YYYYWW, e.g. 202307 = week 7 of 2023).</span>
</span><span id="League.load_stats-634"><a href="#League.load_stats-634"><span class="linenos">634</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="League.load_stats-635"><a href="#League.load_stats-635"><span class="linenos">635</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pull_stats</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">finish</span><span class="p">)</span>
</span><span id="League.load_stats-636"><a href="#League.load_stats-636"><span class="linenos">636</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_points</span><span class="p">()</span>
</span><span id="League.load_stats-637"><a href="#League.load_stats-637"><span class="linenos">637</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League.load_stats-638"><a href="#League.load_stats-638"><span class="linenos">638</span></a>            <span class="n">left</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">,</span>
</span><span id="League.load_stats-639"><a href="#League.load_stats-639"><span class="linenos">639</span></a>            <span class="n">right</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nfl_schedule</span><span class="p">,</span>
</span><span id="League.load_stats-640"><a href="#League.load_stats-640"><span class="linenos">640</span></a>            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
</span><span id="League.load_stats-641"><a href="#League.load_stats-641"><span class="linenos">641</span></a>            <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">,</span> <span class="s2">&quot;week&quot;</span><span class="p">,</span> <span class="s2">&quot;team&quot;</span><span class="p">],</span>
</span><span id="League.load_stats-642"><a href="#League.load_stats-642"><span class="linenos">642</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Loads individual player statistics for each game in the specified timeframe 
and calculates fantasy points based on league settings. Initially looks for 
pre-pulled statistics saved locally and pulls new stats when necessary.</p>

<p>Args:
    start (int): year and number of the first week of interest (YYYYWW, e.g. 202102 = week 2 of 2021). <br />
    finish (int): year and number of the last week of interest (YYYYWW, e.g. 202307 = week 7 of 2023).</p>
</div>


                            </div>
                            <div id="League.name_corrections" class="classattr">
                                        <input id="League.name_corrections-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">name_corrections</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="League.name_corrections-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#League.name_corrections"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="League.name_corrections-644"><a href="#League.name_corrections-644"><span class="linenos">644</span></a>    <span class="k">def</span> <span class="nf">name_corrections</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="League.name_corrections-645"><a href="#League.name_corrections-645"><span class="linenos">645</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="League.name_corrections-646"><a href="#League.name_corrections-646"><span class="linenos">646</span></a><span class="sd">        Applies name corrections between Pro Football Reference and Yahoo.</span>
</span><span id="League.name_corrections-647"><a href="#League.name_corrections-647"><span class="linenos">647</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="League.name_corrections-648"><a href="#League.name_corrections-648"><span class="linenos">648</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">load_stats</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">season</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">season</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">week</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="League.name_corrections-649"><a href="#League.name_corrections-649"><span class="linenos">649</span></a>        <span class="n">corrections</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
</span><span id="League.name_corrections-650"><a href="#League.name_corrections-650"><span class="linenos">650</span></a>            <span class="s2">&quot;https://raw.githubusercontent.com/&quot;</span>
</span><span id="League.name_corrections-651"><a href="#League.name_corrections-651"><span class="linenos">651</span></a>            <span class="o">+</span> <span class="s2">&quot;tefirman/FantasySports/main/res/football/name_corrections.csv&quot;</span>
</span><span id="League.name_corrections-652"><a href="#League.name_corrections-652"><span class="linenos">652</span></a>        <span class="p">)</span>
</span><span id="League.name_corrections-653"><a href="#League.name_corrections-653"><span class="linenos">653</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League.name_corrections-654"><a href="#League.name_corrections-654"><span class="linenos">654</span></a>            <span class="n">left</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">corrections</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;name&quot;</span>
</span><span id="League.name_corrections-655"><a href="#League.name_corrections-655"><span class="linenos">655</span></a>        <span class="p">)</span>
</span><span id="League.name_corrections-656"><a href="#League.name_corrections-656"><span class="linenos">656</span></a>        <span class="n">to_fix</span> <span class="o">=</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">new_name</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span>
</span><span id="League.name_corrections-657"><a href="#League.name_corrections-657"><span class="linenos">657</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">to_fix</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">to_fix</span><span class="p">,</span> <span class="s2">&quot;new_name&quot;</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Applies name corrections between Pro Football Reference and Yahoo.</p>
</div>


                            </div>
                            <div id="League.get_player_ids" class="classattr">
                                        <input id="League.get_player_ids-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_player_ids</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="League.get_player_ids-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#League.get_player_ids"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="League.get_player_ids-659"><a href="#League.get_player_ids-659"><span class="linenos">659</span></a>    <span class="k">def</span> <span class="nf">get_player_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="League.get_player_ids-660"><a href="#League.get_player_ids-660"><span class="linenos">660</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="League.get_player_ids-661"><a href="#League.get_player_ids-661"><span class="linenos">661</span></a><span class="sd">        Maps between Yahoo player ID&#39;s and SportsRef player ID&#39;s based on team rosters and draft results.</span>
</span><span id="League.get_player_ids-662"><a href="#League.get_player_ids-662"><span class="linenos">662</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="League.get_player_ids-663"><a href="#League.get_player_ids-663"><span class="linenos">663</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">nfl_rosters</span> <span class="o">=</span> <span class="n">sr</span><span class="o">.</span><span class="n">get_bulk_rosters</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">season</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">latest_season</span><span class="p">,</span><span class="s2">&quot;NFLRosters.csv&quot;</span><span class="p">)</span>
</span><span id="League.get_player_ids-664"><a href="#League.get_player_ids-664"><span class="linenos">664</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">nfl_rosters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nfl_rosters</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;player&#39;</span><span class="p">:</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;player_id&#39;</span><span class="p">:</span><span class="s1">&#39;player_id_sr&#39;</span><span class="p">,</span><span class="s1">&#39;team&#39;</span><span class="p">:</span><span class="s1">&#39;current_team&#39;</span><span class="p">})</span>
</span><span id="League.get_player_ids-665"><a href="#League.get_player_ids-665"><span class="linenos">665</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League.get_player_ids-666"><a href="#League.get_player_ids-666"><span class="linenos">666</span></a>            <span class="n">left</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">,</span><span class="n">right</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nfl_teams</span><span class="p">[[</span><span class="s2">&quot;real_abbrev&quot;</span><span class="p">,</span> <span class="s2">&quot;yahoo&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
</span><span id="League.get_player_ids-667"><a href="#League.get_player_ids-667"><span class="linenos">667</span></a>                <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;yahoo&quot;</span><span class="p">:</span> <span class="s2">&quot;editorial_team_abbr&quot;</span><span class="p">,</span> <span class="s2">&quot;real_abbrev&quot;</span><span class="p">:</span> <span class="s2">&quot;current_team&quot;</span><span class="p">}</span>
</span><span id="League.get_player_ids-668"><a href="#League.get_player_ids-668"><span class="linenos">668</span></a>            <span class="p">),</span>
</span><span id="League.get_player_ids-669"><a href="#League.get_player_ids-669"><span class="linenos">669</span></a>            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">,</span>
</span><span id="League.get_player_ids-670"><a href="#League.get_player_ids-670"><span class="linenos">670</span></a>            <span class="n">on</span><span class="o">=</span><span class="s2">&quot;editorial_team_abbr&quot;</span><span class="p">,</span>
</span><span id="League.get_player_ids-671"><a href="#League.get_player_ids-671"><span class="linenos">671</span></a>        <span class="p">)</span>
</span><span id="League.get_player_ids-672"><a href="#League.get_player_ids-672"><span class="linenos">672</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">,</span><span class="n">right</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nfl_rosters</span><span class="p">[[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;current_team&#39;</span><span class="p">,</span><span class="s1">&#39;player_id_sr&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>\
</span><span id="League.get_player_ids-673"><a href="#League.get_player_ids-673"><span class="linenos">673</span></a>        <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;player&#39;</span><span class="p">:</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;player_id&#39;</span><span class="p">:</span><span class="s1">&#39;player_id_sr&#39;</span><span class="p">,</span><span class="s1">&#39;team&#39;</span><span class="p">:</span><span class="s1">&#39;current_team&#39;</span><span class="p">}),</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;current_team&#39;</span><span class="p">])</span>
</span><span id="League.get_player_ids-674"><a href="#League.get_player_ids-674"><span class="linenos">674</span></a>        <span class="c1"># Two Michael Carter&#39;s on the same team. What are the odds...</span>
</span><span id="League.get_player_ids-675"><a href="#League.get_player_ids-675"><span class="linenos">675</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">player_id_sr</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;CartMi02&#39;</span><span class="p">])]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="League.get_player_ids-676"><a href="#League.get_player_ids-676"><span class="linenos">676</span></a>        <span class="n">id_check</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;player_id_sr&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;freq&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="League.get_player_ids-677"><a href="#League.get_player_ids-677"><span class="linenos">677</span></a>        <span class="k">if</span> <span class="n">id_check</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="League.get_player_ids-678"><a href="#League.get_player_ids-678"><span class="linenos">678</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Found the same player ID on multiple players: &#39;</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">id_check</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">id_check</span><span class="o">.</span><span class="n">freq</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">,</span><span class="s1">&#39;player_id_sr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()))</span>
</span><span id="League.get_player_ids-679"><a href="#League.get_player_ids-679"><span class="linenos">679</span></a>        <span class="n">defenses</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;DEF&#39;</span><span class="p">])</span>
</span><span id="League.get_player_ids-680"><a href="#League.get_player_ids-680"><span class="linenos">680</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">defenses</span><span class="p">,</span><span class="s1">&#39;player_id_sr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">defenses</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
</span><span id="League.get_player_ids-681"><a href="#League.get_player_ids-681"><span class="linenos">681</span></a>        <span class="n">latest_draft</span> <span class="o">=</span> <span class="n">sr</span><span class="o">.</span><span class="n">get_draft</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">latest_season</span><span class="p">)[[</span><span class="s1">&#39;player&#39;</span><span class="p">,</span><span class="s1">&#39;player_id&#39;</span><span class="p">,</span><span class="s1">&#39;team_abbrev&#39;</span><span class="p">]]</span>\
</span><span id="League.get_player_ids-682"><a href="#League.get_player_ids-682"><span class="linenos">682</span></a>        <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;player&#39;</span><span class="p">:</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;player_id&#39;</span><span class="p">:</span><span class="s1">&#39;player_id_sr&#39;</span><span class="p">,</span><span class="s1">&#39;team_abbrev&#39;</span><span class="p">:</span><span class="s1">&#39;current_team&#39;</span><span class="p">})</span>
</span><span id="League.get_player_ids-683"><a href="#League.get_player_ids-683"><span class="linenos">683</span></a>        <span class="n">missing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">player_id_sr</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">latest_draft</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
</span><span id="League.get_player_ids-684"><a href="#League.get_player_ids-684"><span class="linenos">684</span></a>        <span class="n">unsigned</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[</span><span class="n">missing</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="League.get_player_ids-685"><a href="#League.get_player_ids-685"><span class="linenos">685</span></a>        <span class="k">del</span> <span class="n">unsigned</span><span class="p">[</span><span class="s1">&#39;player_id_sr&#39;</span><span class="p">]</span>
</span><span id="League.get_player_ids-686"><a href="#League.get_player_ids-686"><span class="linenos">686</span></a>        <span class="n">unsigned</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">unsigned</span><span class="p">,</span><span class="n">right</span><span class="o">=</span><span class="n">latest_draft</span><span class="p">[[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;current_team&#39;</span><span class="p">,</span><span class="s1">&#39;player_id_sr&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span><span class="n">keep</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">),</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;current_team&#39;</span><span class="p">])</span>
</span><span id="League.get_player_ids-687"><a href="#League.get_player_ids-687"><span class="linenos">687</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[</span><span class="o">~</span><span class="n">missing</span><span class="p">],</span><span class="n">unsigned</span><span class="p">],</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="League.get_player_ids-688"><a href="#League.get_player_ids-688"><span class="linenos">688</span></a>        <span class="n">missing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">player_id_sr</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nfl_rosters</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
</span><span id="League.get_player_ids-689"><a href="#League.get_player_ids-689"><span class="linenos">689</span></a>        <span class="n">closest</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[</span><span class="n">missing</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="League.get_player_ids-690"><a href="#League.get_player_ids-690"><span class="linenos">690</span></a>        <span class="k">del</span> <span class="n">closest</span><span class="p">[</span><span class="s1">&#39;player_id_sr&#39;</span><span class="p">],</span> <span class="n">closest</span><span class="p">[</span><span class="s1">&#39;current_team&#39;</span><span class="p">]</span>
</span><span id="League.get_player_ids-691"><a href="#League.get_player_ids-691"><span class="linenos">691</span></a>        <span class="n">closest</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">closest</span><span class="p">,</span><span class="n">right</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nfl_rosters</span><span class="p">[[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;current_team&#39;</span><span class="p">,</span><span class="s1">&#39;player_id_sr&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span><span class="n">keep</span><span class="o">=</span><span class="s1">&#39;last&#39;</span><span class="p">),</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
</span><span id="League.get_player_ids-692"><a href="#League.get_player_ids-692"><span class="linenos">692</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[</span><span class="o">~</span><span class="n">missing</span><span class="p">],</span><span class="n">closest</span><span class="p">],</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="League.get_player_ids-693"><a href="#League.get_player_ids-693"><span class="linenos">693</span></a>        <span class="n">still_missing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">player_id_sr</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span>
</span><span id="League.get_player_ids-694"><a href="#League.get_player_ids-694"><span class="linenos">694</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">still_missing</span><span class="p">,</span><span class="s1">&#39;player_id_sr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">still_missing</span><span class="p">,</span><span class="s1">&#39;player_id&#39;</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Maps between Yahoo player ID's and SportsRef player ID's based on team rosters and draft results.</p>
</div>


                            </div>
                            <div id="League.load_parameters" class="classattr">
                                        <input id="League.load_parameters-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">load_parameters</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">earliest</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">reference_games</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">basaloppstringtime</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="League.load_parameters-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#League.load_parameters"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="League.load_parameters-696"><a href="#League.load_parameters-696"><span class="linenos">696</span></a>    <span class="k">def</span> <span class="nf">load_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">earliest</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">reference_games</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">basaloppstringtime</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]):</span>
</span><span id="League.load_parameters-697"><a href="#League.load_parameters-697"><span class="linenos">697</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="League.load_parameters-698"><a href="#League.load_parameters-698"><span class="linenos">698</span></a><span class="sd">        Initializes rate adjustment parameters for future season simulations. </span>
</span><span id="League.load_parameters-699"><a href="#League.load_parameters-699"><span class="linenos">699</span></a><span class="sd">        If parameters are not manually, optimal values are chosen based on </span>
</span><span id="League.load_parameters-700"><a href="#League.load_parameters-700"><span class="linenos">700</span></a><span class="sd">        maximum likelihood fitting over five years.</span>
</span><span id="League.load_parameters-701"><a href="#League.load_parameters-701"><span class="linenos">701</span></a>
</span><span id="League.load_parameters-702"><a href="#League.load_parameters-702"><span class="linenos">702</span></a><span class="sd">        Args:</span>
</span><span id="League.load_parameters-703"><a href="#League.load_parameters-703"><span class="linenos">703</span></a><span class="sd">            earliest (int, optional): year and number of the earliest week to be included in the prior for rate calculation, defaults to None.  </span>
</span><span id="League.load_parameters-704"><a href="#League.load_parameters-704"><span class="linenos">704</span></a><span class="sd">            reference_games (int, optional): number of games to include the prior for rate calculation, defaults to None.  </span>
</span><span id="League.load_parameters-705"><a href="#League.load_parameters-705"><span class="linenos">705</span></a><span class="sd">            basaloppstringtime (list, optional): list containing the basal factor, opponent elo factor, and depth chart factor, defaults to [].</span>
</span><span id="League.load_parameters-706"><a href="#League.load_parameters-706"><span class="linenos">706</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="League.load_parameters-707"><a href="#League.load_parameters-707"><span class="linenos">707</span></a>        <span class="n">params</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
</span><span id="League.load_parameters-708"><a href="#League.load_parameters-708"><span class="linenos">708</span></a>            <span class="s2">&quot;https://raw.githubusercontent.com/&quot;</span>
</span><span id="League.load_parameters-709"><a href="#League.load_parameters-709"><span class="linenos">709</span></a>            <span class="o">+</span> <span class="s2">&quot;tefirman/FantasySports/main/res/football/weighting_factors.csv&quot;</span>
</span><span id="League.load_parameters-710"><a href="#League.load_parameters-710"><span class="linenos">710</span></a>        <span class="p">)</span>
</span><span id="League.load_parameters-711"><a href="#League.load_parameters-711"><span class="linenos">711</span></a>        <span class="k">if</span> <span class="n">earliest</span><span class="p">:</span>
</span><span id="League.load_parameters-712"><a href="#League.load_parameters-712"><span class="linenos">712</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">earliest</span> <span class="o">=</span> <span class="n">earliest</span>
</span><span id="League.load_parameters-713"><a href="#League.load_parameters-713"><span class="linenos">713</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="League.load_parameters-714"><a href="#League.load_parameters-714"><span class="linenos">714</span></a>            <span class="n">prior</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">params</span><span class="o">.</span><span class="n">week</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">week</span><span class="p">,</span> <span class="s2">&quot;prior&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League.load_parameters-715"><a href="#League.load_parameters-715"><span class="linenos">715</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">earliest</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">season</span> <span class="o">-</span> <span class="n">prior</span> <span class="o">//</span> <span class="mi">17</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">week</span> <span class="o">-</span> <span class="n">prior</span> <span class="o">%</span> <span class="mi">17</span>
</span><span id="League.load_parameters-716"><a href="#League.load_parameters-716"><span class="linenos">716</span></a>            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">earliest</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">earliest</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">):</span>
</span><span id="League.load_parameters-717"><a href="#League.load_parameters-717"><span class="linenos">717</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">earliest</span> <span class="o">-=</span> <span class="mi">83</span>  <span class="c1"># Assuming 17 weeks... Need to change this soon...</span>
</span><span id="League.load_parameters-718"><a href="#League.load_parameters-718"><span class="linenos">718</span></a>        <span class="k">if</span> <span class="n">reference_games</span><span class="p">:</span>
</span><span id="League.load_parameters-719"><a href="#League.load_parameters-719"><span class="linenos">719</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">reference_games</span> <span class="o">=</span> <span class="n">reference_games</span>
</span><span id="League.load_parameters-720"><a href="#League.load_parameters-720"><span class="linenos">720</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="League.load_parameters-721"><a href="#League.load_parameters-721"><span class="linenos">721</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">reference_games</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">params</span><span class="o">.</span><span class="n">week</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">week</span><span class="p">,</span> <span class="s2">&quot;games&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League.load_parameters-722"><a href="#League.load_parameters-722"><span class="linenos">722</span></a>        <span class="k">if</span> <span class="n">basaloppstringtime</span><span class="p">:</span>
</span><span id="League.load_parameters-723"><a href="#League.load_parameters-723"><span class="linenos">723</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">basaloppstringtime</span> <span class="o">=</span> <span class="n">basaloppstringtime</span>
</span><span id="League.load_parameters-724"><a href="#League.load_parameters-724"><span class="linenos">724</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="League.load_parameters-725"><a href="#League.load_parameters-725"><span class="linenos">725</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">basaloppstringtime</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="League.load_parameters-726"><a href="#League.load_parameters-726"><span class="linenos">726</span></a>                <span class="n">params</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League.load_parameters-727"><a href="#League.load_parameters-727"><span class="linenos">727</span></a>                    <span class="n">params</span><span class="o">.</span><span class="n">week</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">week</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;basal&quot;</span><span class="p">,</span> <span class="s2">&quot;opp_elo&quot;</span><span class="p">,</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="s2">&quot;time_factor&quot;</span><span class="p">]</span>
</span><span id="League.load_parameters-728"><a href="#League.load_parameters-728"><span class="linenos">728</span></a>                <span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League.load_parameters-729"><a href="#League.load_parameters-729"><span class="linenos">729</span></a>            <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Initializes rate adjustment parameters for future season simulations. 
If parameters are not manually, optimal values are chosen based on 
maximum likelihood fitting over five years.</p>

<p>Args:
    earliest (int, optional): year and number of the earliest week to be included in the prior for rate calculation, defaults to None. <br />
    reference_games (int, optional): number of games to include the prior for rate calculation, defaults to None. <br />
    basaloppstringtime (list, optional): list containing the basal factor, opponent elo factor, and depth chart factor, defaults to [].</p>
</div>


                            </div>
                            <div id="League.add_injuries" class="classattr">
                                        <input id="League.add_injuries-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_injuries</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="League.add_injuries-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#League.add_injuries"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="League.add_injuries-731"><a href="#League.add_injuries-731"><span class="linenos">731</span></a>    <span class="k">def</span> <span class="nf">add_injuries</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="League.add_injuries-732"><a href="#League.add_injuries-732"><span class="linenos">732</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="League.add_injuries-733"><a href="#League.add_injuries-733"><span class="linenos">733</span></a><span class="sd">        Adds manual projections for injury timespans. If a new injury pops up </span>
</span><span id="League.add_injuries-734"><a href="#League.add_injuries-734"><span class="linenos">734</span></a><span class="sd">        and no projection has been provided yet, timespan defaults to one week.</span>
</span><span id="League.add_injuries-735"><a href="#League.add_injuries-735"><span class="linenos">735</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="League.add_injuries-736"><a href="#League.add_injuries-736"><span class="linenos">736</span></a>        <span class="n">as_of</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">season</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">week</span>
</span><span id="League.add_injuries-737"><a href="#League.add_injuries-737"><span class="linenos">737</span></a>        <span class="k">if</span> <span class="s2">&quot;until&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="League.add_injuries-738"><a href="#League.add_injuries-738"><span class="linenos">738</span></a>            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[</span><span class="s2">&quot;until&quot;</span><span class="p">]</span>
</span><span id="League.add_injuries-739"><a href="#League.add_injuries-739"><span class="linenos">739</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[</span><span class="s2">&quot;until&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;NaN&quot;</span><span class="p">)</span>
</span><span id="League.add_injuries-740"><a href="#League.add_injuries-740"><span class="linenos">740</span></a>        <span class="k">if</span> <span class="n">as_of</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">latest_season</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_week</span><span class="p">:</span>
</span><span id="League.add_injuries-741"><a href="#League.add_injuries-741"><span class="linenos">741</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">load_stats</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">season</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">season</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="mi">17</span><span class="p">)</span>
</span><span id="League.add_injuries-742"><a href="#League.add_injuries-742"><span class="linenos">742</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League.add_injuries-743"><a href="#League.add_injuries-743"><span class="linenos">743</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">season</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">week</span> <span class="o">&gt;=</span> <span class="n">as_of</span>
</span><span id="League.add_injuries-744"><a href="#League.add_injuries-744"><span class="linenos">744</span></a>            <span class="p">]</span>
</span><span id="League.add_injuries-745"><a href="#League.add_injuries-745"><span class="linenos">745</span></a>            <span class="n">healthy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League.add_injuries-746"><a href="#League.add_injuries-746"><span class="linenos">746</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">season</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">week</span> <span class="o">==</span> <span class="n">as_of</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span>
</span><span id="League.add_injuries-747"><a href="#League.add_injuries-747"><span class="linenos">747</span></a>            <span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="League.add_injuries-748"><a href="#League.add_injuries-748"><span class="linenos">748</span></a>            <span class="n">injured</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League.add_injuries-749"><a href="#League.add_injuries-749"><span class="linenos">749</span></a>                <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">healthy</span><span class="p">),</span> <span class="s2">&quot;name&quot;</span>
</span><span id="League.add_injuries-750"><a href="#League.add_injuries-750"><span class="linenos">750</span></a>            <span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="League.add_injuries-751"><a href="#League.add_injuries-751"><span class="linenos">751</span></a>            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">injured</span><span class="p">:</span>
</span><span id="League.add_injuries-752"><a href="#League.add_injuries-752"><span class="linenos">752</span></a>                <span class="n">until</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">name</span><span class="p">,</span> <span class="s2">&quot;week&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="League.add_injuries-753"><a href="#League.add_injuries-753"><span class="linenos">753</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">until</span><span class="p">):</span>
</span><span id="League.add_injuries-754"><a href="#League.add_injuries-754"><span class="linenos">754</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">name</span><span class="p">,</span> <span class="s2">&quot;until&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">until</span>
</span><span id="League.add_injuries-755"><a href="#League.add_injuries-755"><span class="linenos">755</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">season</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">latest_season</span><span class="p">:</span>
</span><span id="League.add_injuries-756"><a href="#League.add_injuries-756"><span class="linenos">756</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">name</span><span class="p">,</span> <span class="s2">&quot;until&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">17</span>
</span><span id="League.add_injuries-757"><a href="#League.add_injuries-757"><span class="linenos">757</span></a>        <span class="k">if</span> <span class="n">as_of</span> <span class="o">//</span> <span class="mi">100</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">latest_season</span><span class="p">:</span>
</span><span id="League.add_injuries-758"><a href="#League.add_injuries-758"><span class="linenos">758</span></a>            <span class="n">inj_proj</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
</span><span id="League.add_injuries-759"><a href="#League.add_injuries-759"><span class="linenos">759</span></a>                <span class="s2">&quot;https://raw.githubusercontent.com/&quot;</span>
</span><span id="League.add_injuries-760"><a href="#League.add_injuries-760"><span class="linenos">760</span></a>                <span class="o">+</span> <span class="s2">&quot;tefirman/FantasySports/main/res/football/injured_list.csv&quot;</span>
</span><span id="League.add_injuries-761"><a href="#League.add_injuries-761"><span class="linenos">761</span></a>            <span class="p">)</span>
</span><span id="League.add_injuries-762"><a href="#League.add_injuries-762"><span class="linenos">762</span></a>            <span class="n">inj_proj</span> <span class="o">=</span> <span class="n">inj_proj</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inj_proj</span><span class="o">.</span><span class="n">until</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_week</span><span class="p">]</span>
</span><span id="League.add_injuries-763"><a href="#League.add_injuries-763"><span class="linenos">763</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">players</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League.add_injuries-764"><a href="#League.add_injuries-764"><span class="linenos">764</span></a>                <span class="n">left</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;until&quot;</span><span class="p">:</span> <span class="s2">&quot;until_orig&quot;</span><span class="p">}),</span>
</span><span id="League.add_injuries-765"><a href="#League.add_injuries-765"><span class="linenos">765</span></a>                <span class="n">right</span><span class="o">=</span><span class="n">inj_proj</span><span class="p">,</span>
</span><span id="League.add_injuries-766"><a href="#League.add_injuries-766"><span class="linenos">766</span></a>                <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
</span><span id="League.add_injuries-767"><a href="#League.add_injuries-767"><span class="linenos">767</span></a>                <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;player_id_sr&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;position&quot;</span><span class="p">],</span>
</span><span id="League.add_injuries-768"><a href="#League.add_injuries-768"><span class="linenos">768</span></a>            <span class="p">)</span>
</span><span id="League.add_injuries-769"><a href="#League.add_injuries-769"><span class="linenos">769</span></a>            <span class="k">if</span> <span class="n">as_of</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_week</span><span class="p">:</span>
</span><span id="League.add_injuries-770"><a href="#League.add_injuries-770"><span class="linenos">770</span></a>                <span class="n">newInjury</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League.add_injuries-771"><a href="#League.add_injuries-771"><span class="linenos">771</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span>
</span><span id="League.add_injuries-772"><a href="#League.add_injuries-772"><span class="linenos">772</span></a>                        <span class="p">[</span>
</span><span id="League.add_injuries-773"><a href="#League.add_injuries-773"><span class="linenos">773</span></a>                            <span class="s2">&quot;O&quot;</span><span class="p">,</span>
</span><span id="League.add_injuries-774"><a href="#League.add_injuries-774"><span class="linenos">774</span></a>                            <span class="s2">&quot;D&quot;</span><span class="p">,</span>
</span><span id="League.add_injuries-775"><a href="#League.add_injuries-775"><span class="linenos">775</span></a>                            <span class="s2">&quot;SUSP&quot;</span><span class="p">,</span>
</span><span id="League.add_injuries-776"><a href="#League.add_injuries-776"><span class="linenos">776</span></a>                            <span class="s2">&quot;IR&quot;</span><span class="p">,</span>
</span><span id="League.add_injuries-777"><a href="#League.add_injuries-777"><span class="linenos">777</span></a>                            <span class="s2">&quot;PUP-R&quot;</span><span class="p">,</span>
</span><span id="League.add_injuries-778"><a href="#League.add_injuries-778"><span class="linenos">778</span></a>                            <span class="s2">&quot;PUP-P&quot;</span><span class="p">,</span>
</span><span id="League.add_injuries-779"><a href="#League.add_injuries-779"><span class="linenos">779</span></a>                            <span class="s2">&quot;NFI-R&quot;</span><span class="p">,</span>
</span><span id="League.add_injuries-780"><a href="#League.add_injuries-780"><span class="linenos">780</span></a>                            <span class="s2">&quot;NA&quot;</span><span class="p">,</span>
</span><span id="League.add_injuries-781"><a href="#League.add_injuries-781"><span class="linenos">781</span></a>                            <span class="s2">&quot;COVID-19&quot;</span><span class="p">,</span>
</span><span id="League.add_injuries-782"><a href="#League.add_injuries-782"><span class="linenos">782</span></a>                        <span class="p">]</span>
</span><span id="League.add_injuries-783"><a href="#League.add_injuries-783"><span class="linenos">783</span></a>                    <span class="p">)</span>
</span><span id="League.add_injuries-784"><a href="#League.add_injuries-784"><span class="linenos">784</span></a>                    <span class="o">&amp;</span> <span class="p">(</span>
</span><span id="League.add_injuries-785"><a href="#League.add_injuries-785"><span class="linenos">785</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">until</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span>
</span><span id="League.add_injuries-786"><a href="#League.add_injuries-786"><span class="linenos">786</span></a>                        <span class="o">|</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">until</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_week</span><span class="p">)</span>
</span><span id="League.add_injuries-787"><a href="#League.add_injuries-787"><span class="linenos">787</span></a>                    <span class="p">)</span>
</span><span id="League.add_injuries-788"><a href="#League.add_injuries-788"><span class="linenos">788</span></a>                    <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">fantasy_team</span><span class="o">.</span><span class="n">isnull</span><span class="p">())</span>
</span><span id="League.add_injuries-789"><a href="#League.add_injuries-789"><span class="linenos">789</span></a>                <span class="p">)</span>  <span class="c1"># | (self.players.WAR &gt;= 0))</span>
</span><span id="League.add_injuries-790"><a href="#League.add_injuries-790"><span class="linenos">790</span></a>                <span class="k">if</span> <span class="n">newInjury</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="League.add_injuries-791"><a href="#League.add_injuries-791"><span class="linenos">791</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="League.add_injuries-792"><a href="#League.add_injuries-792"><span class="linenos">792</span></a>                        <span class="s2">&quot;Need to look up new injuries... &quot;</span>
</span><span id="League.add_injuries-793"><a href="#League.add_injuries-793"><span class="linenos">793</span></a>                        <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">newInjury</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
</span><span id="League.add_injuries-794"><a href="#League.add_injuries-794"><span class="linenos">794</span></a>                    <span class="p">)</span>
</span><span id="League.add_injuries-795"><a href="#League.add_injuries-795"><span class="linenos">795</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">newInjury</span><span class="p">,</span> <span class="s2">&quot;until&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_week</span>
</span><span id="League.add_injuries-796"><a href="#League.add_injuries-796"><span class="linenos">796</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">newInjury</span><span class="p">,[</span><span class="s2">&quot;player_id_sr&quot;</span><span class="p">,</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="s2">&quot;position&quot;</span><span class="p">,</span><span class="s2">&quot;status&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;NewInjuries.csv&quot;</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="League.add_injuries-797"><a href="#League.add_injuries-797"><span class="linenos">797</span></a>                <span class="n">oldInjury</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League.add_injuries-798"><a href="#League.add_injuries-798"><span class="linenos">798</span></a>                    <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span>
</span><span id="League.add_injuries-799"><a href="#League.add_injuries-799"><span class="linenos">799</span></a>                        <span class="p">[</span>
</span><span id="League.add_injuries-800"><a href="#League.add_injuries-800"><span class="linenos">800</span></a>                            <span class="s2">&quot;O&quot;</span><span class="p">,</span>
</span><span id="League.add_injuries-801"><a href="#League.add_injuries-801"><span class="linenos">801</span></a>                            <span class="s2">&quot;D&quot;</span><span class="p">,</span>
</span><span id="League.add_injuries-802"><a href="#League.add_injuries-802"><span class="linenos">802</span></a>                            <span class="s2">&quot;SUSP&quot;</span><span class="p">,</span>
</span><span id="League.add_injuries-803"><a href="#League.add_injuries-803"><span class="linenos">803</span></a>                            <span class="s2">&quot;IR&quot;</span><span class="p">,</span>
</span><span id="League.add_injuries-804"><a href="#League.add_injuries-804"><span class="linenos">804</span></a>                            <span class="s2">&quot;PUP-R&quot;</span><span class="p">,</span>
</span><span id="League.add_injuries-805"><a href="#League.add_injuries-805"><span class="linenos">805</span></a>                            <span class="s2">&quot;PUP-P&quot;</span><span class="p">,</span>
</span><span id="League.add_injuries-806"><a href="#League.add_injuries-806"><span class="linenos">806</span></a>                            <span class="s2">&quot;NFI-R&quot;</span><span class="p">,</span>
</span><span id="League.add_injuries-807"><a href="#League.add_injuries-807"><span class="linenos">807</span></a>                            <span class="s2">&quot;NA&quot;</span><span class="p">,</span>
</span><span id="League.add_injuries-808"><a href="#League.add_injuries-808"><span class="linenos">808</span></a>                            <span class="s2">&quot;COVID-19&quot;</span><span class="p">,</span>
</span><span id="League.add_injuries-809"><a href="#League.add_injuries-809"><span class="linenos">809</span></a>                        <span class="p">]</span>
</span><span id="League.add_injuries-810"><a href="#League.add_injuries-810"><span class="linenos">810</span></a>                    <span class="p">)</span>
</span><span id="League.add_injuries-811"><a href="#League.add_injuries-811"><span class="linenos">811</span></a>                    <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">until</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_week</span><span class="p">)</span>
</span><span id="League.add_injuries-812"><a href="#League.add_injuries-812"><span class="linenos">812</span></a>                    <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">fantasy_team</span><span class="o">.</span><span class="n">isnull</span><span class="p">())</span>
</span><span id="League.add_injuries-813"><a href="#League.add_injuries-813"><span class="linenos">813</span></a>                <span class="p">)</span>  <span class="c1"># | (self.players.WAR &gt;= 0))</span>
</span><span id="League.add_injuries-814"><a href="#League.add_injuries-814"><span class="linenos">814</span></a>                <span class="k">if</span> <span class="n">oldInjury</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="League.add_injuries-815"><a href="#League.add_injuries-815"><span class="linenos">815</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="League.add_injuries-816"><a href="#League.add_injuries-816"><span class="linenos">816</span></a>                        <span class="s2">&quot;Need to update old injuries... &quot;</span>
</span><span id="League.add_injuries-817"><a href="#League.add_injuries-817"><span class="linenos">817</span></a>                        <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">oldInjury</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
</span><span id="League.add_injuries-818"><a href="#League.add_injuries-818"><span class="linenos">818</span></a>                    <span class="p">)</span>
</span><span id="League.add_injuries-819"><a href="#League.add_injuries-819"><span class="linenos">819</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">oldInjury</span><span class="p">,[</span><span class="s2">&quot;player_id_sr&quot;</span><span class="p">,</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="s2">&quot;position&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;OldInjuries.csv&quot;</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="League.add_injuries-820"><a href="#League.add_injuries-820"><span class="linenos">820</span></a>                    <span class="c1"># self.players.loc[oldInjury,&#39;until&#39;] = self.current_week</span>
</span><span id="League.add_injuries-821"><a href="#League.add_injuries-821"><span class="linenos">821</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[</span><span class="s2">&quot;until&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[[</span><span class="s2">&quot;until_orig&quot;</span><span class="p">,</span> <span class="s2">&quot;until&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="League.add_injuries-822"><a href="#League.add_injuries-822"><span class="linenos">822</span></a>            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[</span><span class="s2">&quot;until_orig&quot;</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Adds manual projections for injury timespans. If a new injury pops up 
and no projection has been provided yet, timespan defaults to one week.</p>
</div>


                            </div>
                            <div id="League.add_bye_weeks" class="classattr">
                                        <input id="League.add_bye_weeks-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_bye_weeks</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="League.add_bye_weeks-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#League.add_bye_weeks"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="League.add_bye_weeks-824"><a href="#League.add_bye_weeks-824"><span class="linenos">824</span></a>    <span class="k">def</span> <span class="nf">add_bye_weeks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="League.add_bye_weeks-825"><a href="#League.add_bye_weeks-825"><span class="linenos">825</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="League.add_bye_weeks-826"><a href="#League.add_bye_weeks-826"><span class="linenos">826</span></a><span class="sd">        Derives bye weeks based on the current NFL schedule and merges them to the players dataframe.</span>
</span><span id="League.add_bye_weeks-827"><a href="#League.add_bye_weeks-827"><span class="linenos">827</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="League.add_bye_weeks-828"><a href="#League.add_bye_weeks-828"><span class="linenos">828</span></a>        <span class="n">byes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="League.add_bye_weeks-829"><a href="#League.add_bye_weeks-829"><span class="linenos">829</span></a>        <span class="k">for</span> <span class="n">team</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nfl_schedule</span><span class="o">.</span><span class="n">team</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
</span><span id="League.add_bye_weeks-830"><a href="#League.add_bye_weeks-830"><span class="linenos">830</span></a>            <span class="n">bye_week</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="League.add_bye_weeks-831"><a href="#League.add_bye_weeks-831"><span class="linenos">831</span></a>            <span class="k">while</span> <span class="p">(</span>
</span><span id="League.add_bye_weeks-832"><a href="#League.add_bye_weeks-832"><span class="linenos">832</span></a>                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nfl_schedule</span><span class="o">.</span><span class="n">team</span> <span class="o">==</span> <span class="n">team</span><span class="p">)</span>
</span><span id="League.add_bye_weeks-833"><a href="#League.add_bye_weeks-833"><span class="linenos">833</span></a>                <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nfl_schedule</span><span class="o">.</span><span class="n">season</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">season</span><span class="p">)</span>
</span><span id="League.add_bye_weeks-834"><a href="#League.add_bye_weeks-834"><span class="linenos">834</span></a>                <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nfl_schedule</span><span class="o">.</span><span class="n">week</span> <span class="o">==</span> <span class="n">bye_week</span><span class="p">)</span>
</span><span id="League.add_bye_weeks-835"><a href="#League.add_bye_weeks-835"><span class="linenos">835</span></a>            <span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="League.add_bye_weeks-836"><a href="#League.add_bye_weeks-836"><span class="linenos">836</span></a>                <span class="n">bye_week</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="League.add_bye_weeks-837"><a href="#League.add_bye_weeks-837"><span class="linenos">837</span></a>            <span class="n">byes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">byes</span><span class="p">,</span>
</span><span id="League.add_bye_weeks-838"><a href="#League.add_bye_weeks-838"><span class="linenos">838</span></a>                <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;current_team&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">team</span><span class="p">],</span> <span class="s2">&quot;bye_week&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">bye_week</span><span class="p">]})],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span>
</span><span id="League.add_bye_weeks-839"><a href="#League.add_bye_weeks-839"><span class="linenos">839</span></a>            <span class="p">)</span>
</span><span id="League.add_bye_weeks-840"><a href="#League.add_bye_weeks-840"><span class="linenos">840</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League.add_bye_weeks-841"><a href="#League.add_bye_weeks-841"><span class="linenos">841</span></a>            <span class="n">left</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">byes</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;current_team&quot;</span>
</span><span id="League.add_bye_weeks-842"><a href="#League.add_bye_weeks-842"><span class="linenos">842</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Derives bye weeks based on the current NFL schedule and merges them to the players dataframe.</p>
</div>


                            </div>
                            <div id="League.add_roster_pcts" class="classattr">
                                        <input id="League.add_roster_pcts-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_roster_pcts</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">inc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="League.add_roster_pcts-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#League.add_roster_pcts"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="League.add_roster_pcts-844"><a href="#League.add_roster_pcts-844"><span class="linenos">844</span></a>    <span class="k">def</span> <span class="nf">add_roster_pcts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span><span class="p">):</span>
</span><span id="League.add_roster_pcts-845"><a href="#League.add_roster_pcts-845"><span class="linenos">845</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="League.add_roster_pcts-846"><a href="#League.add_roster_pcts-846"><span class="linenos">846</span></a><span class="sd">        Pulls the percentage of leagues each player is rostered in and merges it into the players dataframe.</span>
</span><span id="League.add_roster_pcts-847"><a href="#League.add_roster_pcts-847"><span class="linenos">847</span></a>
</span><span id="League.add_roster_pcts-848"><a href="#League.add_roster_pcts-848"><span class="linenos">848</span></a><span class="sd">        Args:</span>
</span><span id="League.add_roster_pcts-849"><a href="#League.add_roster_pcts-849"><span class="linenos">849</span></a><span class="sd">            inc (int, optional): number of players to pull per API call, defaults to 25.</span>
</span><span id="League.add_roster_pcts-850"><a href="#League.add_roster_pcts-850"><span class="linenos">850</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="League.add_roster_pcts-851"><a href="#League.add_roster_pcts-851"><span class="linenos">851</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_oauth</span><span class="p">()</span>
</span><span id="League.add_roster_pcts-852"><a href="#League.add_roster_pcts-852"><span class="linenos">852</span></a>        <span class="n">roster_pcts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="League.add_roster_pcts-853"><a href="#League.add_roster_pcts-853"><span class="linenos">853</span></a>        <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="n">inc</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="League.add_roster_pcts-854"><a href="#League.add_roster_pcts-854"><span class="linenos">854</span></a>            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="League.add_roster_pcts-855"><a href="#League.add_roster_pcts-855"><span class="linenos">855</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="League.add_roster_pcts-856"><a href="#League.add_roster_pcts-856"><span class="linenos">856</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">refresh_oauth</span><span class="p">()</span>
</span><span id="League.add_roster_pcts-857"><a href="#League.add_roster_pcts-857"><span class="linenos">857</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">inc</span> <span class="o">*</span> <span class="n">ind</span> <span class="p">:</span> <span class="n">inc</span> <span class="o">*</span> <span class="p">(</span><span class="n">ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="League.add_roster_pcts-858"><a href="#League.add_roster_pcts-858"><span class="linenos">858</span></a>                        <span class="n">pcts</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;count&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">}</span>
</span><span id="League.add_roster_pcts-859"><a href="#League.add_roster_pcts-859"><span class="linenos">859</span></a>                        <span class="k">break</span>
</span><span id="League.add_roster_pcts-860"><a href="#League.add_roster_pcts-860"><span class="linenos">860</span></a>                    <span class="n">player_ids</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League.add_roster_pcts-861"><a href="#League.add_roster_pcts-861"><span class="linenos">861</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">inc</span> <span class="o">*</span> <span class="n">ind</span> <span class="p">:</span> <span class="n">inc</span> <span class="o">*</span> <span class="p">(</span><span class="n">ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
</span><span id="League.add_roster_pcts-862"><a href="#League.add_roster_pcts-862"><span class="linenos">862</span></a>                        <span class="o">.</span><span class="n">player_id</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
</span><span id="League.add_roster_pcts-863"><a href="#League.add_roster_pcts-863"><span class="linenos">863</span></a>                        <span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="League.add_roster_pcts-864"><a href="#League.add_roster_pcts-864"><span class="linenos">864</span></a>                    <span class="p">)</span>
</span><span id="League.add_roster_pcts-865"><a href="#League.add_roster_pcts-865"><span class="linenos">865</span></a>                    <span class="n">player_ids</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="League.add_roster_pcts-866"><a href="#League.add_roster_pcts-866"><span class="linenos">866</span></a>                        <span class="n">val</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">player_ids</span> <span class="k">if</span> <span class="n">val</span> <span class="o">!=</span> <span class="s2">&quot;nan&quot;</span>
</span><span id="League.add_roster_pcts-867"><a href="#League.add_roster_pcts-867"><span class="linenos">867</span></a>                    <span class="p">]</span>
</span><span id="League.add_roster_pcts-868"><a href="#League.add_roster_pcts-868"><span class="linenos">868</span></a>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">player_ids</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="League.add_roster_pcts-869"><a href="#League.add_roster_pcts-869"><span class="linenos">869</span></a>                        <span class="n">pcts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lg</span><span class="o">.</span><span class="n">yhandler</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="League.add_roster_pcts-870"><a href="#League.add_roster_pcts-870"><span class="linenos">870</span></a>                            <span class="s2">&quot;league/</span><span class="si">{}</span><span class="s2">/players;player_keys=</span><span class="si">{}</span><span class="s2">.p.</span><span class="si">{}</span><span class="s2">/percent_owned&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="League.add_roster_pcts-871"><a href="#League.add_roster_pcts-871"><span class="linenos">871</span></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">lg_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lg_id</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;,</span><span class="si">{}</span><span class="s2">.p.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lg_id</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">player_ids</span><span class="p">)</span>
</span><span id="League.add_roster_pcts-872"><a href="#League.add_roster_pcts-872"><span class="linenos">872</span></a>                            <span class="p">)</span>
</span><span id="League.add_roster_pcts-873"><a href="#League.add_roster_pcts-873"><span class="linenos">873</span></a>                        <span class="p">)[</span><span class="s2">&quot;fantasy_content&quot;</span><span class="p">][</span><span class="s2">&quot;league&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;players&quot;</span><span class="p">]</span>
</span><span id="League.add_roster_pcts-874"><a href="#League.add_roster_pcts-874"><span class="linenos">874</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="League.add_roster_pcts-875"><a href="#League.add_roster_pcts-875"><span class="linenos">875</span></a>                        <span class="n">pcts</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;count&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">}</span>
</span><span id="League.add_roster_pcts-876"><a href="#League.add_roster_pcts-876"><span class="linenos">876</span></a>                    <span class="k">break</span>
</span><span id="League.add_roster_pcts-877"><a href="#League.add_roster_pcts-877"><span class="linenos">877</span></a>                <span class="k">except</span><span class="p">:</span>
</span><span id="League.add_roster_pcts-878"><a href="#League.add_roster_pcts-878"><span class="linenos">878</span></a>                    <span class="n">err_message</span> <span class="o">=</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span>
</span><span id="League.add_roster_pcts-879"><a href="#League.add_roster_pcts-879"><span class="linenos">879</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="n">err_message</span><span class="p">)</span>
</span><span id="League.add_roster_pcts-880"><a href="#League.add_roster_pcts-880"><span class="linenos">880</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="League.add_roster_pcts-881"><a href="#League.add_roster_pcts-881"><span class="linenos">881</span></a>                        <span class="s2">&quot;Roster percentage query crapped out... Waiting 30 seconds and trying again...&quot;</span>
</span><span id="League.add_roster_pcts-882"><a href="#League.add_roster_pcts-882"><span class="linenos">882</span></a>                    <span class="p">)</span>
</span><span id="League.add_roster_pcts-883"><a href="#League.add_roster_pcts-883"><span class="linenos">883</span></a>                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
</span><span id="League.add_roster_pcts-884"><a href="#League.add_roster_pcts-884"><span class="linenos">884</span></a>            <span class="k">for</span> <span class="n">player_ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">pcts</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]):</span>
</span><span id="League.add_roster_pcts-885"><a href="#League.add_roster_pcts-885"><span class="linenos">885</span></a>                <span class="n">player</span> <span class="o">=</span> <span class="n">pcts</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">player_ind</span><span class="p">)][</span><span class="s2">&quot;player&quot;</span><span class="p">]</span>
</span><span id="League.add_roster_pcts-886"><a href="#League.add_roster_pcts-886"><span class="linenos">886</span></a>                <span class="n">player_id</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="League.add_roster_pcts-887"><a href="#League.add_roster_pcts-887"><span class="linenos">887</span></a>                    <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="s2">&quot;player_id&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">player</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;player_id&quot;</span> <span class="ow">in</span> <span class="n">val</span>
</span><span id="League.add_roster_pcts-888"><a href="#League.add_roster_pcts-888"><span class="linenos">888</span></a>                <span class="p">]</span>
</span><span id="League.add_roster_pcts-889"><a href="#League.add_roster_pcts-889"><span class="linenos">889</span></a>                <span class="c1"># full_name = [val[&quot;name&quot;][&quot;full&quot;] for val in player[0] if &quot;name&quot; in val]</span>
</span><span id="League.add_roster_pcts-890"><a href="#League.add_roster_pcts-890"><span class="linenos">890</span></a>                <span class="n">pct_owned</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="League.add_roster_pcts-891"><a href="#League.add_roster_pcts-891"><span class="linenos">891</span></a>                    <span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">])</span> <span class="o">/</span> <span class="mf">100.0</span>
</span><span id="League.add_roster_pcts-892"><a href="#League.add_roster_pcts-892"><span class="linenos">892</span></a>                    <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">player</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;percent_owned&quot;</span><span class="p">]</span>
</span><span id="League.add_roster_pcts-893"><a href="#League.add_roster_pcts-893"><span class="linenos">893</span></a>                    <span class="k">if</span> <span class="s2">&quot;value&quot;</span> <span class="ow">in</span> <span class="n">val</span>
</span><span id="League.add_roster_pcts-894"><a href="#League.add_roster_pcts-894"><span class="linenos">894</span></a>                <span class="p">]</span>
</span><span id="League.add_roster_pcts-895"><a href="#League.add_roster_pcts-895"><span class="linenos">895</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pct_owned</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="League.add_roster_pcts-896"><a href="#League.add_roster_pcts-896"><span class="linenos">896</span></a>                    <span class="c1"># print(&quot;Can&#39;t find roster percentage for {}...&quot;.format(full_name))</span>
</span><span id="League.add_roster_pcts-897"><a href="#League.add_roster_pcts-897"><span class="linenos">897</span></a>                    <span class="n">pct_owned</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span>
</span><span id="League.add_roster_pcts-898"><a href="#League.add_roster_pcts-898"><span class="linenos">898</span></a>                <span class="n">roster_pcts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">roster_pcts</span><span class="p">,</span>
</span><span id="League.add_roster_pcts-899"><a href="#League.add_roster_pcts-899"><span class="linenos">899</span></a>                    <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span><span id="League.add_roster_pcts-900"><a href="#League.add_roster_pcts-900"><span class="linenos">900</span></a>                        <span class="p">{</span>
</span><span id="League.add_roster_pcts-901"><a href="#League.add_roster_pcts-901"><span class="linenos">901</span></a>                            <span class="s2">&quot;player_id&quot;</span><span class="p">:</span> <span class="n">player_id</span><span class="p">,</span>
</span><span id="League.add_roster_pcts-902"><a href="#League.add_roster_pcts-902"><span class="linenos">902</span></a>                            <span class="c1"># &quot;name&quot;: full_name,</span>
</span><span id="League.add_roster_pcts-903"><a href="#League.add_roster_pcts-903"><span class="linenos">903</span></a>                            <span class="s2">&quot;pct_rostered&quot;</span><span class="p">:</span> <span class="n">pct_owned</span><span class="p">,</span>
</span><span id="League.add_roster_pcts-904"><a href="#League.add_roster_pcts-904"><span class="linenos">904</span></a>                        <span class="p">}</span>
</span><span id="League.add_roster_pcts-905"><a href="#League.add_roster_pcts-905"><span class="linenos">905</span></a>                    <span class="p">)],</span>
</span><span id="League.add_roster_pcts-906"><a href="#League.add_roster_pcts-906"><span class="linenos">906</span></a>                    <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="League.add_roster_pcts-907"><a href="#League.add_roster_pcts-907"><span class="linenos">907</span></a>                    <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="League.add_roster_pcts-908"><a href="#League.add_roster_pcts-908"><span class="linenos">908</span></a>                <span class="p">)</span>
</span><span id="League.add_roster_pcts-909"><a href="#League.add_roster_pcts-909"><span class="linenos">909</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League.add_roster_pcts-910"><a href="#League.add_roster_pcts-910"><span class="linenos">910</span></a>            <span class="n">left</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">roster_pcts</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;player_id&quot;</span><span class="p">]</span><span class="c1">#, &quot;name&quot;]</span>
</span><span id="League.add_roster_pcts-911"><a href="#League.add_roster_pcts-911"><span class="linenos">911</span></a>        <span class="p">)</span>
</span><span id="League.add_roster_pcts-912"><a href="#League.add_roster_pcts-912"><span class="linenos">912</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">pct_rostered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">pct_rostered</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="League.add_roster_pcts-913"><a href="#League.add_roster_pcts-913"><span class="linenos">913</span></a>        <span class="n">not_found</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">player_id</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">player_id_sr</span><span class="p">)</span> \
</span><span id="League.add_roster_pcts-914"><a href="#League.add_roster_pcts-914"><span class="linenos">914</span></a>        <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">fantasy_team</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span> <span class="o">|</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">pct_rostered</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">))</span>
</span><span id="League.add_roster_pcts-915"><a href="#League.add_roster_pcts-915"><span class="linenos">915</span></a>        <span class="k">if</span> <span class="n">not_found</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="League.add_roster_pcts-916"><a href="#League.add_roster_pcts-916"><span class="linenos">916</span></a>            <span class="c1"># What about unsigned draft picks??? Maybe look them up individually?</span>
</span><span id="League.add_roster_pcts-917"><a href="#League.add_roster_pcts-917"><span class="linenos">917</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="League.add_roster_pcts-918"><a href="#League.add_roster_pcts-918"><span class="linenos">918</span></a>                <span class="s2">&quot;Need to reconcile player names with Pro Football Reference... &quot;</span>
</span><span id="League.add_roster_pcts-919"><a href="#League.add_roster_pcts-919"><span class="linenos">919</span></a>                <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">not_found</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">])</span>
</span><span id="League.add_roster_pcts-920"><a href="#League.add_roster_pcts-920"><span class="linenos">920</span></a>            <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Pulls the percentage of leagues each player is rostered in and merges it into the players dataframe.</p>

<p>Args:
    inc (int, optional): number of players to pull per API call, defaults to 25.</p>
</div>


                            </div>
                            <div id="League.add_depth_charts" class="classattr">
                                        <input id="League.add_depth_charts-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_depth_charts</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="League.add_depth_charts-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#League.add_depth_charts"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="League.add_depth_charts-922"><a href="#League.add_depth_charts-922"><span class="linenos">922</span></a>    <span class="k">def</span> <span class="nf">add_depth_charts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="League.add_depth_charts-923"><a href="#League.add_depth_charts-923"><span class="linenos">923</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="League.add_depth_charts-924"><a href="#League.add_depth_charts-924"><span class="linenos">924</span></a><span class="sd">        Pulls current team depth charts from ESPN and merges them into the players dataframe.</span>
</span><span id="League.add_depth_charts-925"><a href="#League.add_depth_charts-925"><span class="linenos">925</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="League.add_depth_charts-926"><a href="#League.add_depth_charts-926"><span class="linenos">926</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">season</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">latest_season</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">week</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_week</span><span class="p">:</span>
</span><span id="League.add_depth_charts-927"><a href="#League.add_depth_charts-927"><span class="linenos">927</span></a>            <span class="c1"># Include name corrections here???</span>
</span><span id="League.add_depth_charts-928"><a href="#League.add_depth_charts-928"><span class="linenos">928</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">players</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">,</span><span class="n">right</span><span class="o">=</span><span class="n">sr</span><span class="o">.</span><span class="n">get_all_depth_charts</span><span class="p">()</span>\
</span><span id="League.add_depth_charts-929"><a href="#League.add_depth_charts-929"><span class="linenos">929</span></a>            <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;player&#39;</span><span class="p">:</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;pos&#39;</span><span class="p">:</span><span class="s1">&#39;position&#39;</span><span class="p">,</span><span class="s1">&#39;team&#39;</span><span class="p">:</span><span class="s1">&#39;current_team&#39;</span><span class="p">}),</span>\
</span><span id="League.add_depth_charts-930"><a href="#League.add_depth_charts-930"><span class="linenos">930</span></a>            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;current_team&quot;</span><span class="p">,</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="s1">&#39;position&#39;</span><span class="p">])</span>
</span><span id="League.add_depth_charts-931"><a href="#League.add_depth_charts-931"><span class="linenos">931</span></a>            <span class="n">missing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">string</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span> <span class="o">&amp;</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;DEF&#39;</span><span class="p">])</span> \
</span><span id="League.add_depth_charts-932"><a href="#League.add_depth_charts-932"><span class="linenos">932</span></a>            <span class="o">&amp;</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">pct_rostered</span> <span class="o">&gt;</span> <span class="mf">0.05</span><span class="p">)</span> <span class="o">|</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">fantasy_team</span><span class="o">.</span><span class="n">isnull</span><span class="p">())</span> \
</span><span id="League.add_depth_charts-933"><a href="#League.add_depth_charts-933"><span class="linenos">933</span></a>            <span class="o">&amp;</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;NA&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">until</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span>
</span><span id="League.add_depth_charts-934"><a href="#League.add_depth_charts-934"><span class="linenos">934</span></a>            <span class="k">if</span> <span class="n">missing</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="League.add_depth_charts-935"><a href="#League.add_depth_charts-935"><span class="linenos">935</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="League.add_depth_charts-936"><a href="#League.add_depth_charts-936"><span class="linenos">936</span></a>                    <span class="s2">&quot;Need to reconcile player names with ESPN... &quot;</span>
</span><span id="League.add_depth_charts-937"><a href="#League.add_depth_charts-937"><span class="linenos">937</span></a>                    <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">missing</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">])</span>
</span><span id="League.add_depth_charts-938"><a href="#League.add_depth_charts-938"><span class="linenos">938</span></a>                <span class="p">)</span>
</span><span id="League.add_depth_charts-939"><a href="#League.add_depth_charts-939"><span class="linenos">939</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="League.add_depth_charts-940"><a href="#League.add_depth_charts-940"><span class="linenos">940</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">load_stats</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">season</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">season</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="mi">17</span><span class="p">)</span>
</span><span id="League.add_depth_charts-941"><a href="#League.add_depth_charts-941"><span class="linenos">941</span></a>            <span class="n">strings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">season</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">week</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">season</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">week</span><span class="p">]</span>\
</span><span id="League.add_depth_charts-942"><a href="#League.add_depth_charts-942"><span class="linenos">942</span></a>            <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;season&#39;</span><span class="p">,</span><span class="s1">&#39;week&#39;</span><span class="p">],</span><span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)[[</span><span class="s1">&#39;player_id_sr&#39;</span><span class="p">,</span><span class="s1">&#39;string&#39;</span><span class="p">]]</span>\
</span><span id="League.add_depth_charts-943"><a href="#League.add_depth_charts-943"><span class="linenos">943</span></a>            <span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;player_id_sr&#39;</span><span class="p">],</span><span class="n">keep</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">)</span>
</span><span id="League.add_depth_charts-944"><a href="#League.add_depth_charts-944"><span class="linenos">944</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">players</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">,</span><span class="n">right</span><span class="o">=</span><span class="n">strings</span><span class="p">,</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;player_id_sr&#39;</span><span class="p">])</span>
</span><span id="League.add_depth_charts-945"><a href="#League.add_depth_charts-945"><span class="linenos">945</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">position</span> <span class="o">==</span> <span class="s1">&#39;DEF&#39;</span><span class="p">,</span><span class="s1">&#39;string&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="League.add_depth_charts-946"><a href="#League.add_depth_charts-946"><span class="linenos">946</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">string</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Pulls current team depth charts from ESPN and merges them into the players dataframe.</p>
</div>


                            </div>
                            <div id="League.get_rates" class="classattr">
                                        <input id="League.get_rates-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_rates</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">reload</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="League.get_rates-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#League.get_rates"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="League.get_rates-948"><a href="#League.get_rates-948"><span class="linenos"> 948</span></a>    <span class="k">def</span> <span class="nf">get_rates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reload</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
</span><span id="League.get_rates-949"><a href="#League.get_rates-949"><span class="linenos"> 949</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="League.get_rates-950"><a href="#League.get_rates-950"><span class="linenos"> 950</span></a><span class="sd">        Calculates the average and standard deviation of fantasy points for each player </span>
</span><span id="League.get_rates-951"><a href="#League.get_rates-951"><span class="linenos"> 951</span></a><span class="sd">        based on the specified prior and normalizing with respect to the provided weighting factors.</span>
</span><span id="League.get_rates-952"><a href="#League.get_rates-952"><span class="linenos"> 952</span></a>
</span><span id="League.get_rates-953"><a href="#League.get_rates-953"><span class="linenos"> 953</span></a><span class="sd">        Args:</span>
</span><span id="League.get_rates-954"><a href="#League.get_rates-954"><span class="linenos"> 954</span></a><span class="sd">            reload (bool, optional): whether to reload the statistics dataframe, defaults to True.</span>
</span><span id="League.get_rates-955"><a href="#League.get_rates-955"><span class="linenos"> 955</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="League.get_rates-956"><a href="#League.get_rates-956"><span class="linenos"> 956</span></a>        <span class="n">as_of</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">season</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">week</span>
</span><span id="League.get_rates-957"><a href="#League.get_rates-957"><span class="linenos"> 957</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s2">&quot;stats&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">reload</span><span class="p">:</span>
</span><span id="League.get_rates-958"><a href="#League.get_rates-958"><span class="linenos"> 958</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">load_stats</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">earliest</span><span class="p">,</span> <span class="n">as_of</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="League.get_rates-959"><a href="#League.get_rates-959"><span class="linenos"> 959</span></a>            <span class="n">rel_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="League.get_rates-960"><a href="#League.get_rates-960"><span class="linenos"> 960</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="League.get_rates-961"><a href="#League.get_rates-961"><span class="linenos"> 961</span></a>            <span class="n">rel_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">season</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">week</span> <span class="o">&lt;=</span> <span class="n">as_of</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> \
</span><span id="League.get_rates-962"><a href="#League.get_rates-962"><span class="linenos"> 962</span></a>            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">season</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">week</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">earliest</span><span class="p">)]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="League.get_rates-963"><a href="#League.get_rates-963"><span class="linenos"> 963</span></a>        <span class="n">rel_stats</span><span class="p">[</span><span class="s2">&quot;game_factor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League.get_rates-964"><a href="#League.get_rates-964"><span class="linenos"> 964</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">basaloppstringtime</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League.get_rates-965"><a href="#League.get_rates-965"><span class="linenos"> 965</span></a>            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">basaloppstringtime</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">rel_stats</span><span class="p">[</span><span class="s2">&quot;elo_diff&quot;</span><span class="p">])</span>
</span><span id="League.get_rates-966"><a href="#League.get_rates-966"><span class="linenos"> 966</span></a>            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">basaloppstringtime</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">rel_stats</span><span class="p">[</span><span class="s2">&quot;string&quot;</span><span class="p">])</span>
</span><span id="League.get_rates-967"><a href="#League.get_rates-967"><span class="linenos"> 967</span></a>        <span class="p">)</span>
</span><span id="League.get_rates-968"><a href="#League.get_rates-968"><span class="linenos"> 968</span></a>        <span class="n">rel_stats</span><span class="p">[</span><span class="s1">&#39;rel_points&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rel_stats</span><span class="o">.</span><span class="n">points</span><span class="o">/</span><span class="n">rel_stats</span><span class="o">.</span><span class="n">game_factor</span>
</span><span id="League.get_rates-969"><a href="#League.get_rates-969"><span class="linenos"> 969</span></a>        <span class="n">by_pos</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League.get_rates-970"><a href="#League.get_rates-970"><span class="linenos"> 970</span></a>            <span class="n">left</span><span class="o">=</span><span class="n">rel_stats</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;position&quot;</span><span class="p">)</span>
</span><span id="League.get_rates-971"><a href="#League.get_rates-971"><span class="linenos"> 971</span></a>            <span class="o">.</span><span class="n">rel_points</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="League.get_rates-972"><a href="#League.get_rates-972"><span class="linenos"> 972</span></a>            <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="League.get_rates-973"><a href="#League.get_rates-973"><span class="linenos"> 973</span></a>            <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;rel_points&quot;</span><span class="p">:</span> <span class="s2">&quot;points_rate&quot;</span><span class="p">}),</span>
</span><span id="League.get_rates-974"><a href="#League.get_rates-974"><span class="linenos"> 974</span></a>            <span class="n">right</span><span class="o">=</span><span class="n">rel_stats</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;position&quot;</span><span class="p">)</span>
</span><span id="League.get_rates-975"><a href="#League.get_rates-975"><span class="linenos"> 975</span></a>            <span class="o">.</span><span class="n">rel_points</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
</span><span id="League.get_rates-976"><a href="#League.get_rates-976"><span class="linenos"> 976</span></a>            <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="League.get_rates-977"><a href="#League.get_rates-977"><span class="linenos"> 977</span></a>            <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;rel_points&quot;</span><span class="p">:</span> <span class="s2">&quot;points_stdev&quot;</span><span class="p">}),</span>
</span><span id="League.get_rates-978"><a href="#League.get_rates-978"><span class="linenos"> 978</span></a>            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">,</span>
</span><span id="League.get_rates-979"><a href="#League.get_rates-979"><span class="linenos"> 979</span></a>            <span class="n">on</span><span class="o">=</span><span class="s2">&quot;position&quot;</span><span class="p">,</span>
</span><span id="League.get_rates-980"><a href="#League.get_rates-980"><span class="linenos"> 980</span></a>        <span class="p">)</span>
</span><span id="League.get_rates-981"><a href="#League.get_rates-981"><span class="linenos"> 981</span></a>        <span class="n">by_pos</span><span class="p">[</span><span class="s2">&quot;player_id_sr&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;avg_&quot;</span> <span class="o">+</span> <span class="n">by_pos</span><span class="p">[</span><span class="s2">&quot;position&quot;</span><span class="p">]</span>
</span><span id="League.get_rates-982"><a href="#League.get_rates-982"><span class="linenos"> 982</span></a>        <span class="n">rel_stats</span> <span class="o">=</span> <span class="n">rel_stats</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;player_id_sr&quot;</span><span class="p">,</span><span class="s2">&quot;position&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reference_games</span><span class="p">)</span>
</span><span id="League.get_rates-983"><a href="#League.get_rates-983"><span class="linenos"> 983</span></a>        <span class="n">rel_stats</span><span class="p">[</span><span class="s2">&quot;weeks_ago&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League.get_rates-984"><a href="#League.get_rates-984"><span class="linenos"> 984</span></a>            <span class="mi">17</span> <span class="o">*</span> <span class="p">(</span><span class="n">as_of</span> <span class="o">//</span> <span class="mi">100</span> <span class="o">-</span> <span class="n">rel_stats</span><span class="o">.</span><span class="n">season</span><span class="p">)</span> <span class="o">+</span> <span class="n">as_of</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">-</span> <span class="n">rel_stats</span><span class="o">.</span><span class="n">week</span>
</span><span id="League.get_rates-985"><a href="#League.get_rates-985"><span class="linenos"> 985</span></a>        <span class="p">)</span>
</span><span id="League.get_rates-986"><a href="#League.get_rates-986"><span class="linenos"> 986</span></a>        <span class="n">rel_stats</span><span class="p">[</span><span class="s2">&quot;time_factor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">rel_stats</span><span class="o">.</span><span class="n">weeks_ago</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">basaloppstringtime</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="League.get_rates-987"><a href="#League.get_rates-987"><span class="linenos"> 987</span></a>        <span class="n">rel_stats</span> <span class="o">=</span> <span class="n">rel_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">rel_stats</span><span class="o">.</span><span class="n">time_factor</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="League.get_rates-988"><a href="#League.get_rates-988"><span class="linenos"> 988</span></a>        <span class="n">rel_stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League.get_rates-989"><a href="#League.get_rates-989"><span class="linenos"> 989</span></a>            <span class="n">left</span><span class="o">=</span><span class="n">rel_stats</span><span class="p">,</span>
</span><span id="League.get_rates-990"><a href="#League.get_rates-990"><span class="linenos"> 990</span></a>            <span class="n">right</span><span class="o">=</span><span class="n">rel_stats</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;player_id_sr&quot;</span><span class="p">,</span><span class="s2">&quot;position&quot;</span><span class="p">])</span>
</span><span id="League.get_rates-991"><a href="#League.get_rates-991"><span class="linenos"> 991</span></a>            <span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s2">&quot;time_factor&quot;</span><span class="p">:</span> <span class="nb">sum</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;count&quot;</span><span class="p">})</span>
</span><span id="League.get_rates-992"><a href="#League.get_rates-992"><span class="linenos"> 992</span></a>            <span class="o">.</span><span class="n">rename</span><span class="p">(</span>
</span><span id="League.get_rates-993"><a href="#League.get_rates-993"><span class="linenos"> 993</span></a>                <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;num_games&quot;</span><span class="p">,</span> <span class="s2">&quot;time_factor&quot;</span><span class="p">:</span> <span class="s2">&quot;time_factor_sum&quot;</span><span class="p">}</span>
</span><span id="League.get_rates-994"><a href="#League.get_rates-994"><span class="linenos"> 994</span></a>            <span class="p">)</span>
</span><span id="League.get_rates-995"><a href="#League.get_rates-995"><span class="linenos"> 995</span></a>            <span class="o">.</span><span class="n">reset_index</span><span class="p">(),</span>
</span><span id="League.get_rates-996"><a href="#League.get_rates-996"><span class="linenos"> 996</span></a>            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">,</span>
</span><span id="League.get_rates-997"><a href="#League.get_rates-997"><span class="linenos"> 997</span></a>            <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;player_id_sr&quot;</span><span class="p">,</span><span class="s2">&quot;position&quot;</span><span class="p">],</span>
</span><span id="League.get_rates-998"><a href="#League.get_rates-998"><span class="linenos"> 998</span></a>        <span class="p">)</span>
</span><span id="League.get_rates-999"><a href="#League.get_rates-999"><span class="linenos"> 999</span></a>        <span class="n">rel_stats</span><span class="o">.</span><span class="n">time_factor</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League.get_rates-1000"><a href="#League.get_rates-1000"><span class="linenos">1000</span></a>            <span class="n">rel_stats</span><span class="o">.</span><span class="n">time_factor</span> <span class="o">*</span> <span class="n">rel_stats</span><span class="o">.</span><span class="n">num_games</span> <span class="o">/</span> <span class="n">rel_stats</span><span class="o">.</span><span class="n">time_factor_sum</span>
</span><span id="League.get_rates-1001"><a href="#League.get_rates-1001"><span class="linenos">1001</span></a>        <span class="p">)</span>
</span><span id="League.get_rates-1002"><a href="#League.get_rates-1002"><span class="linenos">1002</span></a>        <span class="n">rel_stats</span><span class="p">[</span><span class="s2">&quot;weighted_points&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rel_stats</span><span class="o">.</span><span class="n">rel_points</span> <span class="o">*</span> <span class="n">rel_stats</span><span class="o">.</span><span class="n">time_factor</span>
</span><span id="League.get_rates-1003"><a href="#League.get_rates-1003"><span class="linenos">1003</span></a>        <span class="n">by_player</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League.get_rates-1004"><a href="#League.get_rates-1004"><span class="linenos">1004</span></a>            <span class="n">left</span><span class="o">=</span><span class="n">rel_stats</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;player_id_sr&quot;</span><span class="p">,</span><span class="s2">&quot;position&quot;</span><span class="p">])</span>
</span><span id="League.get_rates-1005"><a href="#League.get_rates-1005"><span class="linenos">1005</span></a>            <span class="o">.</span><span class="n">weighted_points</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="League.get_rates-1006"><a href="#League.get_rates-1006"><span class="linenos">1006</span></a>            <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="League.get_rates-1007"><a href="#League.get_rates-1007"><span class="linenos">1007</span></a>            <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;weighted_points&quot;</span><span class="p">:</span> <span class="s2">&quot;points_rate&quot;</span><span class="p">}),</span>
</span><span id="League.get_rates-1008"><a href="#League.get_rates-1008"><span class="linenos">1008</span></a>            <span class="n">right</span><span class="o">=</span><span class="n">rel_stats</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;player_id_sr&quot;</span><span class="p">,</span><span class="s2">&quot;position&quot;</span><span class="p">])</span>
</span><span id="League.get_rates-1009"><a href="#League.get_rates-1009"><span class="linenos">1009</span></a>            <span class="o">.</span><span class="n">weighted_points</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
</span><span id="League.get_rates-1010"><a href="#League.get_rates-1010"><span class="linenos">1010</span></a>            <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="League.get_rates-1011"><a href="#League.get_rates-1011"><span class="linenos">1011</span></a>            <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;weighted_points&quot;</span><span class="p">:</span> <span class="s2">&quot;points_stdev&quot;</span><span class="p">}),</span>
</span><span id="League.get_rates-1012"><a href="#League.get_rates-1012"><span class="linenos">1012</span></a>            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">,</span>
</span><span id="League.get_rates-1013"><a href="#League.get_rates-1013"><span class="linenos">1013</span></a>            <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;player_id_sr&quot;</span><span class="p">,</span><span class="s2">&quot;position&quot;</span><span class="p">],</span>
</span><span id="League.get_rates-1014"><a href="#League.get_rates-1014"><span class="linenos">1014</span></a>        <span class="p">)</span>
</span><span id="League.get_rates-1015"><a href="#League.get_rates-1015"><span class="linenos">1015</span></a>        <span class="n">by_player</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League.get_rates-1016"><a href="#League.get_rates-1016"><span class="linenos">1016</span></a>            <span class="n">left</span><span class="o">=</span><span class="n">by_player</span><span class="p">,</span>
</span><span id="League.get_rates-1017"><a href="#League.get_rates-1017"><span class="linenos">1017</span></a>            <span class="n">right</span><span class="o">=</span><span class="n">rel_stats</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;player_id_sr&quot;</span><span class="p">,</span><span class="s2">&quot;position&quot;</span><span class="p">])</span>
</span><span id="League.get_rates-1018"><a href="#League.get_rates-1018"><span class="linenos">1018</span></a>            <span class="o">.</span><span class="n">size</span><span class="p">()</span>
</span><span id="League.get_rates-1019"><a href="#League.get_rates-1019"><span class="linenos">1019</span></a>            <span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s2">&quot;num_games&quot;</span><span class="p">)</span>
</span><span id="League.get_rates-1020"><a href="#League.get_rates-1020"><span class="linenos">1020</span></a>            <span class="o">.</span><span class="n">reset_index</span><span class="p">(),</span>
</span><span id="League.get_rates-1021"><a href="#League.get_rates-1021"><span class="linenos">1021</span></a>            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">,</span>
</span><span id="League.get_rates-1022"><a href="#League.get_rates-1022"><span class="linenos">1022</span></a>            <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;player_id_sr&quot;</span><span class="p">,</span><span class="s2">&quot;position&quot;</span><span class="p">],</span>
</span><span id="League.get_rates-1023"><a href="#League.get_rates-1023"><span class="linenos">1023</span></a>        <span class="p">)</span>
</span><span id="League.get_rates-1024"><a href="#League.get_rates-1024"><span class="linenos">1024</span></a>        <span class="n">by_player</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">by_player</span><span class="p">,</span>
</span><span id="League.get_rates-1025"><a href="#League.get_rates-1025"><span class="linenos">1025</span></a>            <span class="n">by_pos</span><span class="p">[[</span><span class="s2">&quot;player_id_sr&quot;</span><span class="p">,</span><span class="s2">&quot;position&quot;</span><span class="p">,</span> <span class="s2">&quot;points_rate&quot;</span><span class="p">,</span> <span class="s2">&quot;points_stdev&quot;</span><span class="p">]]],</span>
</span><span id="League.get_rates-1026"><a href="#League.get_rates-1026"><span class="linenos">1026</span></a>            <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="League.get_rates-1027"><a href="#League.get_rates-1027"><span class="linenos">1027</span></a>            <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="League.get_rates-1028"><a href="#League.get_rates-1028"><span class="linenos">1028</span></a>        <span class="p">)</span>
</span><span id="League.get_rates-1029"><a href="#League.get_rates-1029"><span class="linenos">1029</span></a>        <span class="n">by_player</span><span class="o">.</span><span class="n">points_stdev</span> <span class="o">=</span> <span class="n">by_player</span><span class="o">.</span><span class="n">points_stdev</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="League.get_rates-1030"><a href="#League.get_rates-1030"><span class="linenos">1030</span></a>        <span class="n">by_player</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League.get_rates-1031"><a href="#League.get_rates-1031"><span class="linenos">1031</span></a>            <span class="n">left</span><span class="o">=</span><span class="n">by_player</span><span class="p">,</span>
</span><span id="League.get_rates-1032"><a href="#League.get_rates-1032"><span class="linenos">1032</span></a>            <span class="n">right</span><span class="o">=</span><span class="n">by_pos</span><span class="p">[[</span><span class="s2">&quot;position&quot;</span><span class="p">,</span> <span class="s2">&quot;points_rate&quot;</span><span class="p">,</span> <span class="s2">&quot;points_stdev&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
</span><span id="League.get_rates-1033"><a href="#League.get_rates-1033"><span class="linenos">1033</span></a>                <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;points_rate&quot;</span><span class="p">:</span> <span class="s2">&quot;pos_avg&quot;</span><span class="p">,</span> <span class="s2">&quot;points_stdev&quot;</span><span class="p">:</span> <span class="s2">&quot;pos_stdev&quot;</span><span class="p">}</span>
</span><span id="League.get_rates-1034"><a href="#League.get_rates-1034"><span class="linenos">1034</span></a>            <span class="p">),</span>
</span><span id="League.get_rates-1035"><a href="#League.get_rates-1035"><span class="linenos">1035</span></a>            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">,</span>
</span><span id="League.get_rates-1036"><a href="#League.get_rates-1036"><span class="linenos">1036</span></a>            <span class="n">on</span><span class="o">=</span><span class="s2">&quot;position&quot;</span><span class="p">,</span>
</span><span id="League.get_rates-1037"><a href="#League.get_rates-1037"><span class="linenos">1037</span></a>        <span class="p">)</span>
</span><span id="League.get_rates-1038"><a href="#League.get_rates-1038"><span class="linenos">1038</span></a>        <span class="n">inds</span> <span class="o">=</span> <span class="n">by_player</span><span class="o">.</span><span class="n">num_games</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">reference_games</span>
</span><span id="League.get_rates-1039"><a href="#League.get_rates-1039"><span class="linenos">1039</span></a>        <span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inds</span><span class="p">,</span> <span class="s2">&quot;points_squared&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League.get_rates-1040"><a href="#League.get_rates-1040"><span class="linenos">1040</span></a>            <span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inds</span><span class="p">,</span> <span class="s2">&quot;num_games&quot;</span><span class="p">]</span>
</span><span id="League.get_rates-1041"><a href="#League.get_rates-1041"><span class="linenos">1041</span></a>            <span class="o">*</span> <span class="p">(</span>
</span><span id="League.get_rates-1042"><a href="#League.get_rates-1042"><span class="linenos">1042</span></a>                <span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inds</span><span class="p">,</span> <span class="s2">&quot;points_stdev&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="League.get_rates-1043"><a href="#League.get_rates-1043"><span class="linenos">1043</span></a>                <span class="o">+</span> <span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inds</span><span class="p">,</span> <span class="s2">&quot;points_rate&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="League.get_rates-1044"><a href="#League.get_rates-1044"><span class="linenos">1044</span></a>            <span class="p">)</span>
</span><span id="League.get_rates-1045"><a href="#League.get_rates-1045"><span class="linenos">1045</span></a>            <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reference_games</span> <span class="o">-</span> <span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inds</span><span class="p">,</span> <span class="s2">&quot;num_games&quot;</span><span class="p">])</span>
</span><span id="League.get_rates-1046"><a href="#League.get_rates-1046"><span class="linenos">1046</span></a>            <span class="o">*</span> <span class="p">(</span>
</span><span id="League.get_rates-1047"><a href="#League.get_rates-1047"><span class="linenos">1047</span></a>                <span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inds</span><span class="p">,</span> <span class="s2">&quot;pos_stdev&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="League.get_rates-1048"><a href="#League.get_rates-1048"><span class="linenos">1048</span></a>                <span class="o">+</span> <span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inds</span><span class="p">,</span> <span class="s2">&quot;pos_avg&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="League.get_rates-1049"><a href="#League.get_rates-1049"><span class="linenos">1049</span></a>            <span class="p">)</span>
</span><span id="League.get_rates-1050"><a href="#League.get_rates-1050"><span class="linenos">1050</span></a>        <span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">reference_games</span>
</span><span id="League.get_rates-1051"><a href="#League.get_rates-1051"><span class="linenos">1051</span></a>        <span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inds</span><span class="p">,</span> <span class="s2">&quot;points_rate&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League.get_rates-1052"><a href="#League.get_rates-1052"><span class="linenos">1052</span></a>            <span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inds</span><span class="p">,</span> <span class="s2">&quot;num_games&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inds</span><span class="p">,</span> <span class="s2">&quot;points_rate&quot;</span><span class="p">]</span>
</span><span id="League.get_rates-1053"><a href="#League.get_rates-1053"><span class="linenos">1053</span></a>            <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reference_games</span> <span class="o">-</span> <span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inds</span><span class="p">,</span> <span class="s2">&quot;num_games&quot;</span><span class="p">])</span>
</span><span id="League.get_rates-1054"><a href="#League.get_rates-1054"><span class="linenos">1054</span></a>            <span class="o">*</span> <span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inds</span><span class="p">,</span> <span class="s2">&quot;pos_avg&quot;</span><span class="p">]</span>
</span><span id="League.get_rates-1055"><a href="#League.get_rates-1055"><span class="linenos">1055</span></a>        <span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">reference_games</span>
</span><span id="League.get_rates-1056"><a href="#League.get_rates-1056"><span class="linenos">1056</span></a>        <span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inds</span><span class="p">,</span> <span class="s2">&quot;points_stdev&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League.get_rates-1057"><a href="#League.get_rates-1057"><span class="linenos">1057</span></a>            <span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inds</span><span class="p">,</span> <span class="s2">&quot;points_squared&quot;</span><span class="p">]</span>
</span><span id="League.get_rates-1058"><a href="#League.get_rates-1058"><span class="linenos">1058</span></a>            <span class="o">-</span> <span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inds</span><span class="p">,</span> <span class="s2">&quot;points_rate&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="League.get_rates-1059"><a href="#League.get_rates-1059"><span class="linenos">1059</span></a>        <span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span>
</span><span id="League.get_rates-1060"><a href="#League.get_rates-1060"><span class="linenos">1060</span></a>        <span class="n">by_player</span><span class="o">.</span><span class="n">player_id_sr</span> <span class="o">=</span> <span class="n">by_player</span><span class="o">.</span><span class="n">player_id_sr</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="League.get_rates-1061"><a href="#League.get_rates-1061"><span class="linenos">1061</span></a>        <span class="n">league_avg</span> <span class="o">=</span> <span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">by_player</span><span class="o">.</span><span class="n">player_id_sr</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;avg_&quot;</span><span class="p">)]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="League.get_rates-1062"><a href="#League.get_rates-1062"><span class="linenos">1062</span></a>        <span class="n">league_avg</span><span class="p">[</span><span class="s1">&#39;string&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2.0</span>
</span><span id="League.get_rates-1063"><a href="#League.get_rates-1063"><span class="linenos">1063</span></a>        <span class="n">by_player</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League.get_rates-1064"><a href="#League.get_rates-1064"><span class="linenos">1064</span></a>            <span class="n">left</span><span class="o">=</span><span class="n">by_player</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;num_games&#39;</span><span class="p">,</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>\
</span><span id="League.get_rates-1065"><a href="#League.get_rates-1065"><span class="linenos">1065</span></a>            <span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;player_id_sr&#39;</span><span class="p">],</span><span class="n">keep</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">,</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
</span><span id="League.get_rates-1066"><a href="#League.get_rates-1066"><span class="linenos">1066</span></a>            <span class="n">right</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[</span>
</span><span id="League.get_rates-1067"><a href="#League.get_rates-1067"><span class="linenos">1067</span></a>                <span class="p">[</span>
</span><span id="League.get_rates-1068"><a href="#League.get_rates-1068"><span class="linenos">1068</span></a>                    <span class="s2">&quot;player_id_sr&quot;</span><span class="p">,</span>
</span><span id="League.get_rates-1069"><a href="#League.get_rates-1069"><span class="linenos">1069</span></a>                    <span class="s2">&quot;player_id&quot;</span><span class="p">,</span>
</span><span id="League.get_rates-1070"><a href="#League.get_rates-1070"><span class="linenos">1070</span></a>                    <span class="s2">&quot;status&quot;</span><span class="p">,</span>
</span><span id="League.get_rates-1071"><a href="#League.get_rates-1071"><span class="linenos">1071</span></a>                    <span class="s2">&quot;fantasy_team&quot;</span><span class="p">,</span>
</span><span id="League.get_rates-1072"><a href="#League.get_rates-1072"><span class="linenos">1072</span></a>                    <span class="s2">&quot;current_team&quot;</span><span class="p">,</span>
</span><span id="League.get_rates-1073"><a href="#League.get_rates-1073"><span class="linenos">1073</span></a>                    <span class="s2">&quot;position&quot;</span><span class="p">,</span>
</span><span id="League.get_rates-1074"><a href="#League.get_rates-1074"><span class="linenos">1074</span></a>                    <span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span id="League.get_rates-1075"><a href="#League.get_rates-1075"><span class="linenos">1075</span></a>                    <span class="s2">&quot;until&quot;</span><span class="p">,</span>
</span><span id="League.get_rates-1076"><a href="#League.get_rates-1076"><span class="linenos">1076</span></a>                    <span class="s2">&quot;bye_week&quot;</span><span class="p">,</span>
</span><span id="League.get_rates-1077"><a href="#League.get_rates-1077"><span class="linenos">1077</span></a>                    <span class="s2">&quot;pct_rostered&quot;</span><span class="p">,</span>
</span><span id="League.get_rates-1078"><a href="#League.get_rates-1078"><span class="linenos">1078</span></a>                    <span class="s2">&quot;selected_position&quot;</span><span class="p">,</span>
</span><span id="League.get_rates-1079"><a href="#League.get_rates-1079"><span class="linenos">1079</span></a>                <span class="p">]</span>
</span><span id="League.get_rates-1080"><a href="#League.get_rates-1080"><span class="linenos">1080</span></a>            <span class="p">]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(),</span>
</span><span id="League.get_rates-1081"><a href="#League.get_rates-1081"><span class="linenos">1081</span></a>            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span>
</span><span id="League.get_rates-1082"><a href="#League.get_rates-1082"><span class="linenos">1082</span></a>            <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;player_id_sr&quot;</span><span class="p">,</span><span class="s2">&quot;position&quot;</span><span class="p">],</span>
</span><span id="League.get_rates-1083"><a href="#League.get_rates-1083"><span class="linenos">1083</span></a>        <span class="p">)</span>
</span><span id="League.get_rates-1084"><a href="#League.get_rates-1084"><span class="linenos">1084</span></a>        <span class="n">rookies</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League.get_rates-1085"><a href="#League.get_rates-1085"><span class="linenos">1085</span></a>            <span class="n">left</span><span class="o">=</span><span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League.get_rates-1086"><a href="#League.get_rates-1086"><span class="linenos">1086</span></a>                <span class="n">by_player</span><span class="o">.</span><span class="n">num_games</span><span class="o">.</span><span class="n">isnull</span><span class="p">(),</span>
</span><span id="League.get_rates-1087"><a href="#League.get_rates-1087"><span class="linenos">1087</span></a>                <span class="p">[</span>
</span><span id="League.get_rates-1088"><a href="#League.get_rates-1088"><span class="linenos">1088</span></a>                    <span class="s2">&quot;player_id_sr&quot;</span><span class="p">,</span>
</span><span id="League.get_rates-1089"><a href="#League.get_rates-1089"><span class="linenos">1089</span></a>                    <span class="s2">&quot;player_id&quot;</span><span class="p">,</span>
</span><span id="League.get_rates-1090"><a href="#League.get_rates-1090"><span class="linenos">1090</span></a>                    <span class="s2">&quot;status&quot;</span><span class="p">,</span>
</span><span id="League.get_rates-1091"><a href="#League.get_rates-1091"><span class="linenos">1091</span></a>                    <span class="s2">&quot;fantasy_team&quot;</span><span class="p">,</span>
</span><span id="League.get_rates-1092"><a href="#League.get_rates-1092"><span class="linenos">1092</span></a>                    <span class="s2">&quot;current_team&quot;</span><span class="p">,</span>
</span><span id="League.get_rates-1093"><a href="#League.get_rates-1093"><span class="linenos">1093</span></a>                    <span class="s2">&quot;position&quot;</span><span class="p">,</span>
</span><span id="League.get_rates-1094"><a href="#League.get_rates-1094"><span class="linenos">1094</span></a>                    <span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span id="League.get_rates-1095"><a href="#League.get_rates-1095"><span class="linenos">1095</span></a>                    <span class="s2">&quot;until&quot;</span><span class="p">,</span>
</span><span id="League.get_rates-1096"><a href="#League.get_rates-1096"><span class="linenos">1096</span></a>                    <span class="s2">&quot;bye_week&quot;</span><span class="p">,</span>
</span><span id="League.get_rates-1097"><a href="#League.get_rates-1097"><span class="linenos">1097</span></a>                    <span class="s2">&quot;pct_rostered&quot;</span><span class="p">,</span>
</span><span id="League.get_rates-1098"><a href="#League.get_rates-1098"><span class="linenos">1098</span></a>                    <span class="s2">&quot;selected_position&quot;</span><span class="p">,</span>
</span><span id="League.get_rates-1099"><a href="#League.get_rates-1099"><span class="linenos">1099</span></a>                <span class="p">],</span>
</span><span id="League.get_rates-1100"><a href="#League.get_rates-1100"><span class="linenos">1100</span></a>            <span class="p">],</span>
</span><span id="League.get_rates-1101"><a href="#League.get_rates-1101"><span class="linenos">1101</span></a>            <span class="n">right</span><span class="o">=</span><span class="n">league_avg</span><span class="p">[[</span><span class="s2">&quot;position&quot;</span><span class="p">,</span> <span class="s2">&quot;points_rate&quot;</span><span class="p">,</span> <span class="s2">&quot;points_stdev&quot;</span><span class="p">]],</span>
</span><span id="League.get_rates-1102"><a href="#League.get_rates-1102"><span class="linenos">1102</span></a>            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">,</span>
</span><span id="League.get_rates-1103"><a href="#League.get_rates-1103"><span class="linenos">1103</span></a>            <span class="n">on</span><span class="o">=</span><span class="s2">&quot;position&quot;</span><span class="p">,</span>
</span><span id="League.get_rates-1104"><a href="#League.get_rates-1104"><span class="linenos">1104</span></a>        <span class="p">)</span>
</span><span id="League.get_rates-1105"><a href="#League.get_rates-1105"><span class="linenos">1105</span></a>        <span class="n">by_player</span> <span class="o">=</span> <span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">by_player</span><span class="o">.</span><span class="n">num_games</span><span class="o">.</span><span class="n">isnull</span><span class="p">()]</span>
</span><span id="League.get_rates-1106"><a href="#League.get_rates-1106"><span class="linenos">1106</span></a>        <span class="n">by_player</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">by_player</span><span class="p">,</span>
</span><span id="League.get_rates-1107"><a href="#League.get_rates-1107"><span class="linenos">1107</span></a>            <span class="n">rookies</span><span class="p">[</span>
</span><span id="League.get_rates-1108"><a href="#League.get_rates-1108"><span class="linenos">1108</span></a>                <span class="p">[</span>
</span><span id="League.get_rates-1109"><a href="#League.get_rates-1109"><span class="linenos">1109</span></a>                    <span class="s2">&quot;player_id_sr&quot;</span><span class="p">,</span>
</span><span id="League.get_rates-1110"><a href="#League.get_rates-1110"><span class="linenos">1110</span></a>                    <span class="s2">&quot;player_id&quot;</span><span class="p">,</span>
</span><span id="League.get_rates-1111"><a href="#League.get_rates-1111"><span class="linenos">1111</span></a>                    <span class="s2">&quot;status&quot;</span><span class="p">,</span>
</span><span id="League.get_rates-1112"><a href="#League.get_rates-1112"><span class="linenos">1112</span></a>                    <span class="s2">&quot;fantasy_team&quot;</span><span class="p">,</span>
</span><span id="League.get_rates-1113"><a href="#League.get_rates-1113"><span class="linenos">1113</span></a>                    <span class="s2">&quot;current_team&quot;</span><span class="p">,</span>
</span><span id="League.get_rates-1114"><a href="#League.get_rates-1114"><span class="linenos">1114</span></a>                    <span class="s2">&quot;position&quot;</span><span class="p">,</span>
</span><span id="League.get_rates-1115"><a href="#League.get_rates-1115"><span class="linenos">1115</span></a>                    <span class="s2">&quot;points_rate&quot;</span><span class="p">,</span>
</span><span id="League.get_rates-1116"><a href="#League.get_rates-1116"><span class="linenos">1116</span></a>                    <span class="s2">&quot;points_stdev&quot;</span><span class="p">,</span>
</span><span id="League.get_rates-1117"><a href="#League.get_rates-1117"><span class="linenos">1117</span></a>                    <span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span id="League.get_rates-1118"><a href="#League.get_rates-1118"><span class="linenos">1118</span></a>                    <span class="s2">&quot;until&quot;</span><span class="p">,</span>
</span><span id="League.get_rates-1119"><a href="#League.get_rates-1119"><span class="linenos">1119</span></a>                    <span class="s2">&quot;bye_week&quot;</span><span class="p">,</span>
</span><span id="League.get_rates-1120"><a href="#League.get_rates-1120"><span class="linenos">1120</span></a>                    <span class="s2">&quot;pct_rostered&quot;</span><span class="p">,</span>
</span><span id="League.get_rates-1121"><a href="#League.get_rates-1121"><span class="linenos">1121</span></a>                    <span class="s2">&quot;selected_position&quot;</span><span class="p">,</span>
</span><span id="League.get_rates-1122"><a href="#League.get_rates-1122"><span class="linenos">1122</span></a>                <span class="p">]</span>
</span><span id="League.get_rates-1123"><a href="#League.get_rates-1123"><span class="linenos">1123</span></a>            <span class="p">],</span>
</span><span id="League.get_rates-1124"><a href="#League.get_rates-1124"><span class="linenos">1124</span></a>            <span class="n">league_avg</span><span class="p">],</span>
</span><span id="League.get_rates-1125"><a href="#League.get_rates-1125"><span class="linenos">1125</span></a>            <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="League.get_rates-1126"><a href="#League.get_rates-1126"><span class="linenos">1126</span></a>            <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="League.get_rates-1127"><a href="#League.get_rates-1127"><span class="linenos">1127</span></a>        <span class="p">)</span>
</span><span id="League.get_rates-1128"><a href="#League.get_rates-1128"><span class="linenos">1128</span></a>        <span class="n">by_player</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">by_player</span><span class="p">,</span><span class="n">right</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nfl_rosters</span><span class="p">[[</span><span class="s1">&#39;player_id_sr&#39;</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">]]</span>\
</span><span id="League.get_rates-1129"><a href="#League.get_rates-1129"><span class="linenos">1129</span></a>        <span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;player_id_sr&#39;</span><span class="p">],</span><span class="n">keep</span><span class="o">=</span><span class="s1">&#39;last&#39;</span><span class="p">),</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="s1">&#39;player_id_sr&#39;</span><span class="p">)</span>
</span><span id="League.get_rates-1130"><a href="#League.get_rates-1130"><span class="linenos">1130</span></a>        <span class="n">by_player</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">by_player</span><span class="p">,</span><span class="n">right</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[[</span><span class="s1">&#39;player_id&#39;</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">]]</span>\
</span><span id="League.get_rates-1131"><a href="#League.get_rates-1131"><span class="linenos">1131</span></a>        <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s1">&#39;yahoo_name&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(),</span><span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="s1">&#39;player_id&#39;</span><span class="p">)</span>
</span><span id="League.get_rates-1132"><a href="#League.get_rates-1132"><span class="linenos">1132</span></a>        <span class="n">missing</span> <span class="o">=</span> <span class="n">by_player</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">by_player</span><span class="o">.</span><span class="n">yahoo_name</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span>
</span><span id="League.get_rates-1133"><a href="#League.get_rates-1133"><span class="linenos">1133</span></a>        <span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">missing</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">missing</span><span class="p">,</span><span class="s1">&#39;yahoo_name&#39;</span><span class="p">]</span>
</span><span id="League.get_rates-1134"><a href="#League.get_rates-1134"><span class="linenos">1134</span></a>        <span class="k">del</span> <span class="n">by_player</span><span class="p">[</span><span class="s1">&#39;yahoo_name&#39;</span><span class="p">]</span>
</span><span id="League.get_rates-1135"><a href="#League.get_rates-1135"><span class="linenos">1135</span></a>        <span class="n">defenses</span> <span class="o">=</span> <span class="n">by_player</span><span class="o">.</span><span class="n">player_id_sr</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nfl_teams</span><span class="o">.</span><span class="n">real_abbrev</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
</span><span id="League.get_rates-1136"><a href="#League.get_rates-1136"><span class="linenos">1136</span></a>        <span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">defenses</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">defenses</span><span class="p">,</span><span class="s1">&#39;player_id_sr&#39;</span><span class="p">]</span>
</span><span id="League.get_rates-1137"><a href="#League.get_rates-1137"><span class="linenos">1137</span></a>        <span class="n">avgs</span> <span class="o">=</span> <span class="n">by_player</span><span class="o">.</span><span class="n">player_id_sr</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;avg_&quot;</span><span class="p">)</span>
</span><span id="League.get_rates-1138"><a href="#League.get_rates-1138"><span class="linenos">1138</span></a>        <span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">avgs</span><span class="p">,</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Average_&quot;</span> <span class="o">+</span> <span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">avgs</span><span class="p">,</span><span class="s2">&quot;position&quot;</span><span class="p">]</span>
</span><span id="League.get_rates-1139"><a href="#League.get_rates-1139"><span class="linenos">1139</span></a>        <span class="n">teams_as_of</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League.get_rates-1140"><a href="#League.get_rates-1140"><span class="linenos">1140</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">season</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">week</span> <span class="o">&gt;=</span> <span class="n">as_of</span><span class="p">]</span>
</span><span id="League.get_rates-1141"><a href="#League.get_rates-1141"><span class="linenos">1141</span></a>            <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="s2">&quot;week&quot;</span><span class="p">],</span><span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="League.get_rates-1142"><a href="#League.get_rates-1142"><span class="linenos">1142</span></a>            <span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s2">&quot;player_id_sr&quot;</span><span class="p">,</span> <span class="n">keep</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)[</span>
</span><span id="League.get_rates-1143"><a href="#League.get_rates-1143"><span class="linenos">1143</span></a>                <span class="p">[</span><span class="s2">&quot;player_id_sr&quot;</span><span class="p">,</span> <span class="s2">&quot;team&quot;</span><span class="p">]</span>
</span><span id="League.get_rates-1144"><a href="#League.get_rates-1144"><span class="linenos">1144</span></a>            <span class="p">]</span>
</span><span id="League.get_rates-1145"><a href="#League.get_rates-1145"><span class="linenos">1145</span></a>            <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;team&quot;</span><span class="p">:</span> <span class="s2">&quot;actual_team&quot;</span><span class="p">})</span>
</span><span id="League.get_rates-1146"><a href="#League.get_rates-1146"><span class="linenos">1146</span></a>        <span class="p">)</span>
</span><span id="League.get_rates-1147"><a href="#League.get_rates-1147"><span class="linenos">1147</span></a>        <span class="n">by_player</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League.get_rates-1148"><a href="#League.get_rates-1148"><span class="linenos">1148</span></a>            <span class="n">left</span><span class="o">=</span><span class="n">by_player</span><span class="p">,</span>
</span><span id="League.get_rates-1149"><a href="#League.get_rates-1149"><span class="linenos">1149</span></a>            <span class="n">right</span><span class="o">=</span><span class="n">teams_as_of</span><span class="p">,</span>
</span><span id="League.get_rates-1150"><a href="#League.get_rates-1150"><span class="linenos">1150</span></a>            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
</span><span id="League.get_rates-1151"><a href="#League.get_rates-1151"><span class="linenos">1151</span></a>            <span class="n">on</span><span class="o">=</span><span class="s2">&quot;player_id_sr&quot;</span><span class="p">,</span>
</span><span id="League.get_rates-1152"><a href="#League.get_rates-1152"><span class="linenos">1152</span></a>        <span class="p">)</span>
</span><span id="League.get_rates-1153"><a href="#League.get_rates-1153"><span class="linenos">1153</span></a>        <span class="n">not_yet</span> <span class="o">=</span> <span class="o">~</span><span class="n">by_player</span><span class="o">.</span><span class="n">actual_team</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span>
</span><span id="League.get_rates-1154"><a href="#League.get_rates-1154"><span class="linenos">1154</span></a>        <span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">not_yet</span><span class="p">,</span><span class="s1">&#39;current_team&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">by_player</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">not_yet</span><span class="p">,</span><span class="s1">&#39;actual_team&#39;</span><span class="p">]</span>
</span><span id="League.get_rates-1155"><a href="#League.get_rates-1155"><span class="linenos">1155</span></a>        <span class="k">del</span> <span class="n">by_player</span><span class="p">[</span><span class="s1">&#39;actual_team&#39;</span><span class="p">]</span>
</span><span id="League.get_rates-1156"><a href="#League.get_rates-1156"><span class="linenos">1156</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span> <span class="o">=</span> <span class="n">by_player</span>
</span></pre></div>


            <div class="docstring"><p>Calculates the average and standard deviation of fantasy points for each player 
based on the specified prior and normalizing with respect to the provided weighting factors.</p>

<p>Args:
    reload (bool, optional): whether to reload the statistics dataframe, defaults to True.</p>
</div>


                            </div>
                            <div id="League.get_schedule" class="classattr">
                                        <input id="League.get_schedule-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_schedule</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="League.get_schedule-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#League.get_schedule"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="League.get_schedule-1158"><a href="#League.get_schedule-1158"><span class="linenos">1158</span></a>    <span class="k">def</span> <span class="nf">get_schedule</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="League.get_schedule-1159"><a href="#League.get_schedule-1159"><span class="linenos">1159</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="League.get_schedule-1160"><a href="#League.get_schedule-1160"><span class="linenos">1160</span></a><span class="sd">        Pulls the fantasy schedule for the season in question as well as </span>
</span><span id="League.get_schedule-1161"><a href="#League.get_schedule-1161"><span class="linenos">1161</span></a><span class="sd">        scores for all matchups up to the week in question.</span>
</span><span id="League.get_schedule-1162"><a href="#League.get_schedule-1162"><span class="linenos">1162</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="League.get_schedule-1163"><a href="#League.get_schedule-1163"><span class="linenos">1163</span></a>        <span class="n">as_of</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">season</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">week</span>
</span><span id="League.get_schedule-1164"><a href="#League.get_schedule-1164"><span class="linenos">1164</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_oauth</span><span class="p">()</span>
</span><span id="League.get_schedule-1165"><a href="#League.get_schedule-1165"><span class="linenos">1165</span></a>        <span class="n">schedule</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="League.get_schedule-1166"><a href="#League.get_schedule-1166"><span class="linenos">1166</span></a>        <span class="k">for</span> <span class="n">team</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">teams</span><span class="p">:</span>
</span><span id="League.get_schedule-1167"><a href="#League.get_schedule-1167"><span class="linenos">1167</span></a>            <span class="n">tm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lg</span><span class="o">.</span><span class="n">to_team</span><span class="p">(</span><span class="n">team</span><span class="p">[</span><span class="s2">&quot;team_key&quot;</span><span class="p">])</span>
</span><span id="League.get_schedule-1168"><a href="#League.get_schedule-1168"><span class="linenos">1168</span></a>            <span class="n">limit</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League.get_schedule-1169"><a href="#League.get_schedule-1169"><span class="linenos">1169</span></a>                <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;playoff_start_week&quot;</span><span class="p">],</span> <span class="n">as_of</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="League.get_schedule-1170"><a href="#League.get_schedule-1170"><span class="linenos">1170</span></a>                <span class="k">if</span> <span class="n">as_of</span>
</span><span id="League.get_schedule-1171"><a href="#League.get_schedule-1171"><span class="linenos">1171</span></a>                <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;playoff_start_week&quot;</span><span class="p">]</span>
</span><span id="League.get_schedule-1172"><a href="#League.get_schedule-1172"><span class="linenos">1172</span></a>            <span class="p">)</span>
</span><span id="League.get_schedule-1173"><a href="#League.get_schedule-1173"><span class="linenos">1173</span></a>            <span class="k">for</span> <span class="n">week</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">limit</span><span class="p">):</span>
</span><span id="League.get_schedule-1174"><a href="#League.get_schedule-1174"><span class="linenos">1174</span></a>                <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="League.get_schedule-1175"><a href="#League.get_schedule-1175"><span class="linenos">1175</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="League.get_schedule-1176"><a href="#League.get_schedule-1176"><span class="linenos">1176</span></a>                        <span class="n">matchup</span> <span class="o">=</span> <span class="n">tm</span><span class="o">.</span><span class="n">yhandler</span><span class="o">.</span><span class="n">get_matchup_raw</span><span class="p">(</span><span class="n">tm</span><span class="o">.</span><span class="n">team_key</span><span class="p">,</span> <span class="n">week</span><span class="p">)</span>
</span><span id="League.get_schedule-1177"><a href="#League.get_schedule-1177"><span class="linenos">1177</span></a>                        <span class="n">matchup</span> <span class="o">=</span> <span class="n">matchup</span><span class="p">[</span><span class="s2">&quot;fantasy_content&quot;</span><span class="p">][</span><span class="s2">&quot;team&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;matchups&quot;</span><span class="p">]</span>
</span><span id="League.get_schedule-1178"><a href="#League.get_schedule-1178"><span class="linenos">1178</span></a>                        <span class="k">break</span>
</span><span id="League.get_schedule-1179"><a href="#League.get_schedule-1179"><span class="linenos">1179</span></a>                    <span class="k">except</span><span class="p">:</span>
</span><span id="League.get_schedule-1180"><a href="#League.get_schedule-1180"><span class="linenos">1180</span></a>                        <span class="nb">print</span><span class="p">(</span>
</span><span id="League.get_schedule-1181"><a href="#League.get_schedule-1181"><span class="linenos">1181</span></a>                            <span class="s2">&quot;Matchup query crapped out... Waiting 30 seconds and trying again...&quot;</span>
</span><span id="League.get_schedule-1182"><a href="#League.get_schedule-1182"><span class="linenos">1182</span></a>                        <span class="p">)</span>
</span><span id="League.get_schedule-1183"><a href="#League.get_schedule-1183"><span class="linenos">1183</span></a>                        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
</span><span id="League.get_schedule-1184"><a href="#League.get_schedule-1184"><span class="linenos">1184</span></a>                <span class="k">if</span> <span class="s2">&quot;0&quot;</span> <span class="ow">in</span> <span class="n">matchup</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="League.get_schedule-1185"><a href="#League.get_schedule-1185"><span class="linenos">1185</span></a>                    <span class="n">team_1</span> <span class="o">=</span> <span class="n">matchup</span><span class="p">[</span><span class="s2">&quot;0&quot;</span><span class="p">][</span><span class="s2">&quot;matchup&quot;</span><span class="p">][</span><span class="s2">&quot;0&quot;</span><span class="p">][</span><span class="s2">&quot;teams&quot;</span><span class="p">][</span><span class="s2">&quot;0&quot;</span><span class="p">][</span><span class="s2">&quot;team&quot;</span><span class="p">]</span>
</span><span id="League.get_schedule-1186"><a href="#League.get_schedule-1186"><span class="linenos">1186</span></a>                    <span class="n">team_2</span> <span class="o">=</span> <span class="n">matchup</span><span class="p">[</span><span class="s2">&quot;0&quot;</span><span class="p">][</span><span class="s2">&quot;matchup&quot;</span><span class="p">][</span><span class="s2">&quot;0&quot;</span><span class="p">][</span><span class="s2">&quot;teams&quot;</span><span class="p">][</span><span class="s2">&quot;1&quot;</span><span class="p">][</span><span class="s2">&quot;team&quot;</span><span class="p">]</span>
</span><span id="League.get_schedule-1187"><a href="#League.get_schedule-1187"><span class="linenos">1187</span></a>                    <span class="n">schedule</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">schedule</span><span class="p">,</span>
</span><span id="League.get_schedule-1188"><a href="#League.get_schedule-1188"><span class="linenos">1188</span></a>                        <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span><span id="League.get_schedule-1189"><a href="#League.get_schedule-1189"><span class="linenos">1189</span></a>                            <span class="p">{</span>
</span><span id="League.get_schedule-1190"><a href="#League.get_schedule-1190"><span class="linenos">1190</span></a>                                <span class="s2">&quot;week&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">week</span><span class="p">],</span>
</span><span id="League.get_schedule-1191"><a href="#League.get_schedule-1191"><span class="linenos">1191</span></a>                                <span class="s2">&quot;team_1&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">team_1</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]],</span>
</span><span id="League.get_schedule-1192"><a href="#League.get_schedule-1192"><span class="linenos">1192</span></a>                                <span class="s2">&quot;team_2&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">team_2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]],</span>
</span><span id="League.get_schedule-1193"><a href="#League.get_schedule-1193"><span class="linenos">1193</span></a>                                <span class="s2">&quot;score_1&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">team_1</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;team_points&quot;</span><span class="p">][</span><span class="s2">&quot;total&quot;</span><span class="p">]],</span>
</span><span id="League.get_schedule-1194"><a href="#League.get_schedule-1194"><span class="linenos">1194</span></a>                                <span class="s2">&quot;score_2&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">team_2</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;team_points&quot;</span><span class="p">][</span><span class="s2">&quot;total&quot;</span><span class="p">]],</span>
</span><span id="League.get_schedule-1195"><a href="#League.get_schedule-1195"><span class="linenos">1195</span></a>                            <span class="p">}</span>
</span><span id="League.get_schedule-1196"><a href="#League.get_schedule-1196"><span class="linenos">1196</span></a>                        <span class="p">)],</span>
</span><span id="League.get_schedule-1197"><a href="#League.get_schedule-1197"><span class="linenos">1197</span></a>                        <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="League.get_schedule-1198"><a href="#League.get_schedule-1198"><span class="linenos">1198</span></a>                    <span class="p">)</span>
</span><span id="League.get_schedule-1199"><a href="#League.get_schedule-1199"><span class="linenos">1199</span></a>        <span class="n">schedule</span><span class="o">.</span><span class="n">score_1</span> <span class="o">=</span> <span class="n">schedule</span><span class="o">.</span><span class="n">score_1</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="League.get_schedule-1200"><a href="#League.get_schedule-1200"><span class="linenos">1200</span></a>        <span class="n">schedule</span><span class="o">.</span><span class="n">score_2</span> <span class="o">=</span> <span class="n">schedule</span><span class="o">.</span><span class="n">score_2</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="League.get_schedule-1201"><a href="#League.get_schedule-1201"><span class="linenos">1201</span></a>
</span><span id="League.get_schedule-1202"><a href="#League.get_schedule-1202"><span class="linenos">1202</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; MANY MILE POSTSEASON &quot;&quot;&quot;</span>
</span><span id="League.get_schedule-1203"><a href="#League.get_schedule-1203"><span class="linenos">1203</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;res/football/many_mile.csv&quot;</span><span class="p">):</span>
</span><span id="League.get_schedule-1204"><a href="#League.get_schedule-1204"><span class="linenos">1204</span></a>            <span class="n">many_mile_sched</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;res/football/many_mile.csv&quot;</span><span class="p">)</span>
</span><span id="League.get_schedule-1205"><a href="#League.get_schedule-1205"><span class="linenos">1205</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="League.get_schedule-1206"><a href="#League.get_schedule-1206"><span class="linenos">1206</span></a>            <span class="n">many_mile_sched</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">,</span> <span class="s2">&quot;week&quot;</span><span class="p">])</span>
</span><span id="League.get_schedule-1207"><a href="#League.get_schedule-1207"><span class="linenos">1207</span></a>        <span class="n">algo</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League.get_schedule-1208"><a href="#League.get_schedule-1208"><span class="linenos">1208</span></a>            <span class="n">schedule</span><span class="o">.</span><span class="n">team_1</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;The Algorithm&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
</span><span id="League.get_schedule-1209"><a href="#League.get_schedule-1209"><span class="linenos">1209</span></a>            <span class="ow">or</span> <span class="n">schedule</span><span class="o">.</span><span class="n">team_2</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;The Algorithm&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
</span><span id="League.get_schedule-1210"><a href="#League.get_schedule-1210"><span class="linenos">1210</span></a>        <span class="p">)</span>
</span><span id="League.get_schedule-1211"><a href="#League.get_schedule-1211"><span class="linenos">1211</span></a>        <span class="k">if</span> <span class="n">as_of</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;playoff_start_week&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">algo</span><span class="p">:</span>
</span><span id="League.get_schedule-1212"><a href="#League.get_schedule-1212"><span class="linenos">1212</span></a>            <span class="n">many_mile_sched</span> <span class="o">=</span> <span class="n">many_mile_sched</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League.get_schedule-1213"><a href="#League.get_schedule-1213"><span class="linenos">1213</span></a>                <span class="p">(</span><span class="n">many_mile_sched</span><span class="o">.</span><span class="n">season</span> <span class="o">==</span> <span class="n">as_of</span> <span class="o">//</span> <span class="mi">100</span><span class="p">)</span>
</span><span id="League.get_schedule-1214"><a href="#League.get_schedule-1214"><span class="linenos">1214</span></a>                <span class="o">&amp;</span> <span class="p">(</span><span class="n">many_mile_sched</span><span class="o">.</span><span class="n">week</span> <span class="o">&lt;=</span> <span class="n">as_of</span> <span class="o">%</span> <span class="mi">100</span><span class="p">)</span>
</span><span id="League.get_schedule-1215"><a href="#League.get_schedule-1215"><span class="linenos">1215</span></a>            <span class="p">]</span>
</span><span id="League.get_schedule-1216"><a href="#League.get_schedule-1216"><span class="linenos">1216</span></a>            <span class="k">del</span> <span class="n">many_mile_sched</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">]</span>
</span><span id="League.get_schedule-1217"><a href="#League.get_schedule-1217"><span class="linenos">1217</span></a>            <span class="n">many_mile_sched</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">many_mile_sched</span><span class="o">.</span><span class="n">week</span> <span class="o">==</span> <span class="n">as_of</span> <span class="o">%</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;score_1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="League.get_schedule-1218"><a href="#League.get_schedule-1218"><span class="linenos">1218</span></a>            <span class="n">many_mile_sched</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">many_mile_sched</span><span class="o">.</span><span class="n">week</span> <span class="o">==</span> <span class="n">as_of</span> <span class="o">%</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;score_2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="League.get_schedule-1219"><a href="#League.get_schedule-1219"><span class="linenos">1219</span></a>            <span class="n">standings</span> <span class="o">=</span> <span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League.get_schedule-1220"><a href="#League.get_schedule-1220"><span class="linenos">1220</span></a>                <span class="n">schedule</span><span class="o">.</span><span class="n">week</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;playoff_start_week&quot;</span><span class="p">]</span>
</span><span id="League.get_schedule-1221"><a href="#League.get_schedule-1221"><span class="linenos">1221</span></a>            <span class="p">]</span>
</span><span id="League.get_schedule-1222"><a href="#League.get_schedule-1222"><span class="linenos">1222</span></a>            <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;win_1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">standings</span><span class="o">.</span><span class="n">score_1</span> <span class="o">&gt;</span> <span class="n">standings</span><span class="o">.</span><span class="n">score_2</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="League.get_schedule-1223"><a href="#League.get_schedule-1223"><span class="linenos">1223</span></a>            <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;win_2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">standings</span><span class="o">.</span><span class="n">win_1</span>
</span><span id="League.get_schedule-1224"><a href="#League.get_schedule-1224"><span class="linenos">1224</span></a>            <span class="n">standings</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">standings</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
</span><span id="League.get_schedule-1225"><a href="#League.get_schedule-1225"><span class="linenos">1225</span></a>                <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">col</span><span class="p">:</span> <span class="n">col</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_1&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">standings</span><span class="o">.</span><span class="n">columns</span><span class="p">}</span>
</span><span id="League.get_schedule-1226"><a href="#League.get_schedule-1226"><span class="linenos">1226</span></a>            <span class="p">),</span>
</span><span id="League.get_schedule-1227"><a href="#League.get_schedule-1227"><span class="linenos">1227</span></a>                <span class="n">standings</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
</span><span id="League.get_schedule-1228"><a href="#League.get_schedule-1228"><span class="linenos">1228</span></a>                    <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">col</span><span class="p">:</span> <span class="n">col</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_2&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">standings</span><span class="o">.</span><span class="n">columns</span><span class="p">}</span>
</span><span id="League.get_schedule-1229"><a href="#League.get_schedule-1229"><span class="linenos">1229</span></a>                <span class="p">)],</span>
</span><span id="League.get_schedule-1230"><a href="#League.get_schedule-1230"><span class="linenos">1230</span></a>                <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="League.get_schedule-1231"><a href="#League.get_schedule-1231"><span class="linenos">1231</span></a>                <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="League.get_schedule-1232"><a href="#League.get_schedule-1232"><span class="linenos">1232</span></a>            <span class="p">)</span>
</span><span id="League.get_schedule-1233"><a href="#League.get_schedule-1233"><span class="linenos">1233</span></a>            <span class="n">standings</span> <span class="o">=</span> <span class="n">standings</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;team&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="League.get_schedule-1234"><a href="#League.get_schedule-1234"><span class="linenos">1234</span></a>            <span class="n">standings</span> <span class="o">=</span> <span class="n">standings</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
</span><span id="League.get_schedule-1235"><a href="#League.get_schedule-1235"><span class="linenos">1235</span></a>                <span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;win&quot;</span><span class="p">,</span> <span class="s2">&quot;score&quot;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span>
</span><span id="League.get_schedule-1236"><a href="#League.get_schedule-1236"><span class="linenos">1236</span></a>            <span class="p">)</span>
</span><span id="League.get_schedule-1237"><a href="#League.get_schedule-1237"><span class="linenos">1237</span></a>            <span class="n">consolation</span> <span class="o">=</span> <span class="n">standings</span><span class="o">.</span><span class="n">team</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">6</span><span class="p">:]</span>
</span><span id="League.get_schedule-1238"><a href="#League.get_schedule-1238"><span class="linenos">1238</span></a>            <span class="n">schedule</span> <span class="o">=</span> <span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League.get_schedule-1239"><a href="#League.get_schedule-1239"><span class="linenos">1239</span></a>                <span class="p">(</span><span class="n">schedule</span><span class="o">.</span><span class="n">week</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;playoff_start_week&quot;</span><span class="p">])</span>
</span><span id="League.get_schedule-1240"><a href="#League.get_schedule-1240"><span class="linenos">1240</span></a>                <span class="o">|</span> <span class="o">~</span><span class="n">schedule</span><span class="o">.</span><span class="n">team_1</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">consolation</span><span class="p">)</span>
</span><span id="League.get_schedule-1241"><a href="#League.get_schedule-1241"><span class="linenos">1241</span></a>            <span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="League.get_schedule-1242"><a href="#League.get_schedule-1242"><span class="linenos">1242</span></a>            <span class="n">schedule</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">schedule</span><span class="p">,</span>
</span><span id="League.get_schedule-1243"><a href="#League.get_schedule-1243"><span class="linenos">1243</span></a>                <span class="n">many_mile_sched</span><span class="p">],</span>
</span><span id="League.get_schedule-1244"><a href="#League.get_schedule-1244"><span class="linenos">1244</span></a>                <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="League.get_schedule-1245"><a href="#League.get_schedule-1245"><span class="linenos">1245</span></a>                <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="League.get_schedule-1246"><a href="#League.get_schedule-1246"><span class="linenos">1246</span></a>            <span class="p">)</span>
</span><span id="League.get_schedule-1247"><a href="#League.get_schedule-1247"><span class="linenos">1247</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; MANY MILE POSTSEASON &quot;&quot;&quot;</span>
</span><span id="League.get_schedule-1248"><a href="#League.get_schedule-1248"><span class="linenos">1248</span></a>
</span><span id="League.get_schedule-1249"><a href="#League.get_schedule-1249"><span class="linenos">1249</span></a>        <span class="n">switch</span> <span class="o">=</span> <span class="n">schedule</span><span class="o">.</span><span class="n">team_1</span> <span class="o">&gt;</span> <span class="n">schedule</span><span class="o">.</span><span class="n">team_2</span>
</span><span id="League.get_schedule-1250"><a href="#League.get_schedule-1250"><span class="linenos">1250</span></a>        <span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">switch</span><span class="p">,</span> <span class="s2">&quot;temp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">switch</span><span class="p">,</span> <span class="s2">&quot;team_1&quot;</span><span class="p">]</span>
</span><span id="League.get_schedule-1251"><a href="#League.get_schedule-1251"><span class="linenos">1251</span></a>        <span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">switch</span><span class="p">,</span> <span class="s2">&quot;team_1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">switch</span><span class="p">,</span> <span class="s2">&quot;team_2&quot;</span><span class="p">]</span>
</span><span id="League.get_schedule-1252"><a href="#League.get_schedule-1252"><span class="linenos">1252</span></a>        <span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">switch</span><span class="p">,</span> <span class="s2">&quot;team_2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">switch</span><span class="p">,</span> <span class="s2">&quot;temp&quot;</span><span class="p">]</span>
</span><span id="League.get_schedule-1253"><a href="#League.get_schedule-1253"><span class="linenos">1253</span></a>        <span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">switch</span><span class="p">,</span> <span class="s2">&quot;temp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">switch</span><span class="p">,</span> <span class="s2">&quot;score_1&quot;</span><span class="p">]</span>
</span><span id="League.get_schedule-1254"><a href="#League.get_schedule-1254"><span class="linenos">1254</span></a>        <span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">switch</span><span class="p">,</span> <span class="s2">&quot;score_1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">switch</span><span class="p">,</span> <span class="s2">&quot;score_2&quot;</span><span class="p">]</span>
</span><span id="League.get_schedule-1255"><a href="#League.get_schedule-1255"><span class="linenos">1255</span></a>        <span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">switch</span><span class="p">,</span> <span class="s2">&quot;score_2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">switch</span><span class="p">,</span> <span class="s2">&quot;temp&quot;</span><span class="p">]</span>
</span><span id="League.get_schedule-1256"><a href="#League.get_schedule-1256"><span class="linenos">1256</span></a>        <span class="n">schedule</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League.get_schedule-1257"><a href="#League.get_schedule-1257"><span class="linenos">1257</span></a>            <span class="n">schedule</span><span class="p">[[</span><span class="s2">&quot;week&quot;</span><span class="p">,</span> <span class="s2">&quot;team_1&quot;</span><span class="p">,</span> <span class="s2">&quot;team_2&quot;</span><span class="p">,</span> <span class="s2">&quot;score_1&quot;</span><span class="p">,</span> <span class="s2">&quot;score_2&quot;</span><span class="p">]]</span>
</span><span id="League.get_schedule-1258"><a href="#League.get_schedule-1258"><span class="linenos">1258</span></a>            <span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
</span><span id="League.get_schedule-1259"><a href="#League.get_schedule-1259"><span class="linenos">1259</span></a>            <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;week&quot;</span><span class="p">,</span> <span class="s2">&quot;team_1&quot;</span><span class="p">,</span> <span class="s2">&quot;team_2&quot;</span><span class="p">])</span>
</span><span id="League.get_schedule-1260"><a href="#League.get_schedule-1260"><span class="linenos">1260</span></a>            <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="League.get_schedule-1261"><a href="#League.get_schedule-1261"><span class="linenos">1261</span></a>        <span class="p">)</span>
</span><span id="League.get_schedule-1262"><a href="#League.get_schedule-1262"><span class="linenos">1262</span></a>        <span class="n">team_name</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="League.get_schedule-1263"><a href="#League.get_schedule-1263"><span class="linenos">1263</span></a>            <span class="n">team</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
</span><span id="League.get_schedule-1264"><a href="#League.get_schedule-1264"><span class="linenos">1264</span></a>            <span class="k">for</span> <span class="n">team</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">teams</span>
</span><span id="League.get_schedule-1265"><a href="#League.get_schedule-1265"><span class="linenos">1265</span></a>            <span class="k">if</span> <span class="n">team</span><span class="p">[</span><span class="s2">&quot;team_key&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">lg</span><span class="o">.</span><span class="n">team_key</span><span class="p">()</span>
</span><span id="League.get_schedule-1266"><a href="#League.get_schedule-1266"><span class="linenos">1266</span></a>        <span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League.get_schedule-1267"><a href="#League.get_schedule-1267"><span class="linenos">1267</span></a>        <span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;me&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;team_1&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">team_name</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span>
</span><span id="League.get_schedule-1268"><a href="#League.get_schedule-1268"><span class="linenos">1268</span></a>            <span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;team_2&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">team_name</span>
</span><span id="League.get_schedule-1269"><a href="#League.get_schedule-1269"><span class="linenos">1269</span></a>        <span class="p">)</span>
</span><span id="League.get_schedule-1270"><a href="#League.get_schedule-1270"><span class="linenos">1270</span></a>        <span class="k">if</span> <span class="n">as_of</span><span class="p">:</span>
</span><span id="League.get_schedule-1271"><a href="#League.get_schedule-1271"><span class="linenos">1271</span></a>            <span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">schedule</span><span class="o">.</span><span class="n">week</span> <span class="o">&gt;</span> <span class="n">as_of</span> <span class="o">%</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;score_1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="League.get_schedule-1272"><a href="#League.get_schedule-1272"><span class="linenos">1272</span></a>            <span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">schedule</span><span class="o">.</span><span class="n">week</span> <span class="o">&gt;</span> <span class="n">as_of</span> <span class="o">%</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;score_2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="League.get_schedule-1273"><a href="#League.get_schedule-1273"><span class="linenos">1273</span></a>            <span class="k">if</span> <span class="p">(</span>
</span><span id="League.get_schedule-1274"><a href="#League.get_schedule-1274"><span class="linenos">1274</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">latest_season</span> <span class="o">&gt;</span> <span class="n">as_of</span> <span class="o">//</span> <span class="mi">100</span>
</span><span id="League.get_schedule-1275"><a href="#League.get_schedule-1275"><span class="linenos">1275</span></a>                <span class="ow">or</span> <span class="n">as_of</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_week</span>
</span><span id="League.get_schedule-1276"><a href="#League.get_schedule-1276"><span class="linenos">1276</span></a>            <span class="p">):</span>
</span><span id="League.get_schedule-1277"><a href="#League.get_schedule-1277"><span class="linenos">1277</span></a>                <span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">schedule</span><span class="o">.</span><span class="n">week</span> <span class="o">==</span> <span class="n">as_of</span> <span class="o">%</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;score_1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="League.get_schedule-1278"><a href="#League.get_schedule-1278"><span class="linenos">1278</span></a>                <span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">schedule</span><span class="o">.</span><span class="n">week</span> <span class="o">==</span> <span class="n">as_of</span> <span class="o">%</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;score_2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="League.get_schedule-1279"><a href="#League.get_schedule-1279"><span class="linenos">1279</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span> <span class="o">=</span> <span class="n">schedule</span>
</span></pre></div>


            <div class="docstring"><p>Pulls the fantasy schedule for the season in question as well as 
scores for all matchups up to the week in question.</p>
</div>


                            </div>
                            <div id="League.starters" class="classattr">
                                        <input id="League.starters-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">starters</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">week</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="League.starters-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#League.starters"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="League.starters-1281"><a href="#League.starters-1281"><span class="linenos">1281</span></a>    <span class="k">def</span> <span class="nf">starters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">week</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="League.starters-1282"><a href="#League.starters-1282"><span class="linenos">1282</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="League.starters-1283"><a href="#League.starters-1283"><span class="linenos">1283</span></a><span class="sd">        Identifies which players should be started on each fantasy team </span>
</span><span id="League.starters-1284"><a href="#League.starters-1284"><span class="linenos">1284</span></a><span class="sd">        based on fantasy point projections and available roster spots.</span>
</span><span id="League.starters-1285"><a href="#League.starters-1285"><span class="linenos">1285</span></a>
</span><span id="League.starters-1286"><a href="#League.starters-1286"><span class="linenos">1286</span></a><span class="sd">        Args:</span>
</span><span id="League.starters-1287"><a href="#League.starters-1287"><span class="linenos">1287</span></a><span class="sd">            week (int, optional): week for which to identify starters.</span>
</span><span id="League.starters-1288"><a href="#League.starters-1288"><span class="linenos">1288</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="League.starters-1289"><a href="#League.starters-1289"><span class="linenos">1289</span></a>        <span class="n">as_of</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">season</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">week</span>
</span><span id="League.starters-1290"><a href="#League.starters-1290"><span class="linenos">1290</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_oauth</span><span class="p">()</span>
</span><span id="League.starters-1291"><a href="#League.starters-1291"><span class="linenos">1291</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League.starters-1292"><a href="#League.starters-1292"><span class="linenos">1292</span></a>            <span class="n">left</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">,</span>
</span><span id="League.starters-1293"><a href="#League.starters-1293"><span class="linenos">1293</span></a>            <span class="n">right</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nfl_schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League.starters-1294"><a href="#League.starters-1294"><span class="linenos">1294</span></a>                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nfl_schedule</span><span class="o">.</span><span class="n">season</span> <span class="o">==</span> <span class="n">as_of</span> <span class="o">//</span> <span class="mi">100</span><span class="p">)</span>
</span><span id="League.starters-1295"><a href="#League.starters-1295"><span class="linenos">1295</span></a>                <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nfl_schedule</span><span class="o">.</span><span class="n">week</span> <span class="o">==</span> <span class="n">week</span><span class="p">),</span>
</span><span id="League.starters-1296"><a href="#League.starters-1296"><span class="linenos">1296</span></a>                <span class="p">[</span><span class="s2">&quot;team&quot;</span><span class="p">,</span> <span class="s2">&quot;elo_diff&quot;</span><span class="p">],</span>
</span><span id="League.starters-1297"><a href="#League.starters-1297"><span class="linenos">1297</span></a>            <span class="p">],</span>
</span><span id="League.starters-1298"><a href="#League.starters-1298"><span class="linenos">1298</span></a>            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
</span><span id="League.starters-1299"><a href="#League.starters-1299"><span class="linenos">1299</span></a>            <span class="n">left_on</span><span class="o">=</span><span class="s2">&quot;current_team&quot;</span><span class="p">,</span>
</span><span id="League.starters-1300"><a href="#League.starters-1300"><span class="linenos">1300</span></a>            <span class="n">right_on</span><span class="o">=</span><span class="s2">&quot;team&quot;</span><span class="p">,</span>
</span><span id="League.starters-1301"><a href="#League.starters-1301"><span class="linenos">1301</span></a>        <span class="p">)</span>
</span><span id="League.starters-1302"><a href="#League.starters-1302"><span class="linenos">1302</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">elo_diff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">elo_diff</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="League.starters-1303"><a href="#League.starters-1303"><span class="linenos">1303</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[</span><span class="s2">&quot;opp_factor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">basaloppstringtime</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[</span><span class="s2">&quot;elo_diff&quot;</span><span class="p">])</span>
</span><span id="League.starters-1304"><a href="#League.starters-1304"><span class="linenos">1304</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[</span><span class="s2">&quot;string_factor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">basaloppstringtime</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[</span><span class="s2">&quot;string&quot;</span><span class="p">])</span>
</span><span id="League.starters-1305"><a href="#League.starters-1305"><span class="linenos">1305</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[</span><span class="s2">&quot;game_factor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League.starters-1306"><a href="#League.starters-1306"><span class="linenos">1306</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">basaloppstringtime</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League.starters-1307"><a href="#League.starters-1307"><span class="linenos">1307</span></a>            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[</span><span class="s2">&quot;opp_factor&quot;</span><span class="p">]</span>
</span><span id="League.starters-1308"><a href="#League.starters-1308"><span class="linenos">1308</span></a>            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[</span><span class="s2">&quot;string_factor&quot;</span><span class="p">]</span>
</span><span id="League.starters-1309"><a href="#League.starters-1309"><span class="linenos">1309</span></a>        <span class="p">)</span>
</span><span id="League.starters-1310"><a href="#League.starters-1310"><span class="linenos">1310</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[</span><span class="s2">&quot;points_avg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[</span><span class="s2">&quot;points_rate&quot;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[</span><span class="s2">&quot;game_factor&quot;</span><span class="p">]</span><span class="c1">#.fillna(1.0)</span>
</span><span id="League.starters-1311"><a href="#League.starters-1311"><span class="linenos">1311</span></a>        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[</span><span class="s2">&quot;team&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[</span><span class="s2">&quot;elo_diff&quot;</span><span class="p">]</span>
</span><span id="League.starters-1312"><a href="#League.starters-1312"><span class="linenos">1312</span></a>        <span class="c1"># WAR is linear with points_avg, but slope/intercept depends on position</span>
</span><span id="League.starters-1313"><a href="#League.starters-1313"><span class="linenos">1313</span></a>        <span class="c1"># Harder to characterize how WAR varies with points_stdev, ignoring for now...</span>
</span><span id="League.starters-1314"><a href="#League.starters-1314"><span class="linenos">1314</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;points_avg&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="League.starters-1315"><a href="#League.starters-1315"><span class="linenos">1315</span></a>        <span class="c1"># self.players = self.players.sort_values(by=&#39;WAR&#39;,ascending=False)</span>
</span><span id="League.starters-1316"><a href="#League.starters-1316"><span class="linenos">1316</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[</span><span class="s2">&quot;starter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="League.starters-1317"><a href="#League.starters-1317"><span class="linenos">1317</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[</span><span class="s2">&quot;injured&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">until</span> <span class="o">&gt;=</span> <span class="n">week</span>
</span><span id="League.starters-1318"><a href="#League.starters-1318"><span class="linenos">1318</span></a>        <span class="k">if</span> <span class="p">(</span>
</span><span id="League.starters-1319"><a href="#League.starters-1319"><span class="linenos">1319</span></a>            <span class="n">week</span> <span class="o">==</span> <span class="n">as_of</span> <span class="o">%</span> <span class="mi">100</span>
</span><span id="League.starters-1320"><a href="#League.starters-1320"><span class="linenos">1320</span></a>            <span class="ow">and</span> <span class="n">as_of</span> <span class="o">//</span> <span class="mi">100</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">latest_season</span>
</span><span id="League.starters-1321"><a href="#League.starters-1321"><span class="linenos">1321</span></a>            <span class="ow">and</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">month</span> <span class="o">&gt;</span> <span class="mi">8</span>
</span><span id="League.starters-1322"><a href="#League.starters-1322"><span class="linenos">1322</span></a>        <span class="p">):</span>  <span class="c1"># Careful when your draft is in September...</span>
</span><span id="League.starters-1323"><a href="#League.starters-1323"><span class="linenos">1323</span></a>            <span class="n">cutoff</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span id="League.starters-1324"><a href="#League.starters-1324"><span class="linenos">1324</span></a>            <span class="k">if</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">hour</span> <span class="o">&lt;</span> <span class="mi">20</span><span class="p">:</span>
</span><span id="League.starters-1325"><a href="#League.starters-1325"><span class="linenos">1325</span></a>                <span class="n">cutoff</span> <span class="o">-=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="League.starters-1326"><a href="#League.starters-1326"><span class="linenos">1326</span></a>            <span class="n">completed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nfl_schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League.starters-1327"><a href="#League.starters-1327"><span class="linenos">1327</span></a>                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nfl_schedule</span><span class="o">.</span><span class="n">season</span> <span class="o">==</span> <span class="n">as_of</span> <span class="o">//</span> <span class="mi">100</span><span class="p">)</span>
</span><span id="League.starters-1328"><a href="#League.starters-1328"><span class="linenos">1328</span></a>                <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nfl_schedule</span><span class="o">.</span><span class="n">week</span> <span class="o">==</span> <span class="n">week</span><span class="p">)</span>
</span><span id="League.starters-1329"><a href="#League.starters-1329"><span class="linenos">1329</span></a>                <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nfl_schedule</span><span class="o">.</span><span class="n">date</span> <span class="o">&lt;</span> <span class="n">cutoff</span><span class="p">),</span>
</span><span id="League.starters-1330"><a href="#League.starters-1330"><span class="linenos">1330</span></a>                <span class="s2">&quot;team&quot;</span><span class="p">,</span>
</span><span id="League.starters-1331"><a href="#League.starters-1331"><span class="linenos">1331</span></a>            <span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="League.starters-1332"><a href="#League.starters-1332"><span class="linenos">1332</span></a>            <span class="k">for</span> <span class="n">team</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">teams</span><span class="p">:</span>
</span><span id="League.starters-1333"><a href="#League.starters-1333"><span class="linenos">1333</span></a>                <span class="n">started</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League.starters-1334"><a href="#League.starters-1334"><span class="linenos">1334</span></a>                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">selected_position</span> <span class="o">!=</span> <span class="s2">&quot;BN&quot;</span><span class="p">)</span>
</span><span id="League.starters-1335"><a href="#League.starters-1335"><span class="linenos">1335</span></a>                    <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">fantasy_team</span> <span class="o">==</span> <span class="n">team</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>
</span><span id="League.starters-1336"><a href="#League.starters-1336"><span class="linenos">1336</span></a>                    <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">current_team</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">completed</span><span class="p">)</span>
</span><span id="League.starters-1337"><a href="#League.starters-1337"><span class="linenos">1337</span></a>                <span class="p">]</span>
</span><span id="League.starters-1338"><a href="#League.starters-1338"><span class="linenos">1338</span></a>                <span class="n">not_available</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League.starters-1339"><a href="#League.starters-1339"><span class="linenos">1339</span></a>                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">selected_position</span> <span class="o">==</span> <span class="s2">&quot;BN&quot;</span><span class="p">)</span>
</span><span id="League.starters-1340"><a href="#League.starters-1340"><span class="linenos">1340</span></a>                    <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">fantasy_team</span> <span class="o">==</span> <span class="n">team</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>
</span><span id="League.starters-1341"><a href="#League.starters-1341"><span class="linenos">1341</span></a>                    <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">current_team</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">completed</span><span class="p">)</span>
</span><span id="League.starters-1342"><a href="#League.starters-1342"><span class="linenos">1342</span></a>                <span class="p">]</span>
</span><span id="League.starters-1343"><a href="#League.starters-1343"><span class="linenos">1343</span></a>                <span class="n">lineup</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">roster_spots</span><span class="p">,</span><span class="n">right</span><span class="o">=</span><span class="n">started</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;selected_position&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>\
</span><span id="League.starters-1344"><a href="#League.starters-1344"><span class="linenos">1344</span></a>                <span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;num_started&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;selected_position&#39;</span><span class="p">:</span><span class="s1">&#39;position&#39;</span><span class="p">}),</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="s1">&#39;position&#39;</span><span class="p">)</span>
</span><span id="League.starters-1345"><a href="#League.starters-1345"><span class="linenos">1345</span></a>                <span class="n">lineup</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="o">-=</span> <span class="n">lineup</span><span class="o">.</span><span class="n">num_started</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="League.starters-1346"><a href="#League.starters-1346"><span class="linenos">1346</span></a>                <span class="n">num_pos</span> <span class="o">=</span> <span class="n">lineup</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">lineup</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;W/T&quot;</span><span class="p">,</span> <span class="s2">&quot;W/R/T&quot;</span><span class="p">,</span> <span class="s2">&quot;Q/W/R/T&quot;</span><span class="p">,</span> <span class="s2">&quot;BN&quot;</span><span class="p">,</span> <span class="s2">&quot;IR&quot;</span><span class="p">])]</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;position&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span>
</span><span id="League.starters-1347"><a href="#League.starters-1347"><span class="linenos">1347</span></a>                <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">num_pos</span><span class="p">:</span>
</span><span id="League.starters-1348"><a href="#League.starters-1348"><span class="linenos">1348</span></a>                    <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">num_pos</span><span class="p">[</span><span class="n">pos</span><span class="p">])):</span>
</span><span id="League.starters-1349"><a href="#League.starters-1349"><span class="linenos">1349</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League.starters-1350"><a href="#League.starters-1350"><span class="linenos">1350</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League.starters-1351"><a href="#League.starters-1351"><span class="linenos">1351</span></a>                                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">fantasy_team</span> <span class="o">==</span> <span class="n">team</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>
</span><span id="League.starters-1352"><a href="#League.starters-1352"><span class="linenos">1352</span></a>                                <span class="o">&amp;</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">starter</span>
</span><span id="League.starters-1353"><a href="#League.starters-1353"><span class="linenos">1353</span></a>                                <span class="o">&amp;</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">injured</span>
</span><span id="League.starters-1354"><a href="#League.starters-1354"><span class="linenos">1354</span></a>                                <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">bye_week</span> <span class="o">!=</span> <span class="n">week</span><span class="p">)</span>
</span><span id="League.starters-1355"><a href="#League.starters-1355"><span class="linenos">1355</span></a>                                <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">position</span> <span class="o">==</span> <span class="n">pos</span><span class="p">)</span>
</span><span id="League.starters-1356"><a href="#League.starters-1356"><span class="linenos">1356</span></a>                                <span class="o">&amp;</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">player_id</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">started</span><span class="o">.</span><span class="n">player_id</span><span class="p">)</span>
</span><span id="League.starters-1357"><a href="#League.starters-1357"><span class="linenos">1357</span></a>                                <span class="o">&amp;</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">player_id</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">not_available</span><span class="o">.</span><span class="n">player_id</span><span class="p">)</span>
</span><span id="League.starters-1358"><a href="#League.starters-1358"><span class="linenos">1358</span></a>                            <span class="p">]</span>
</span><span id="League.starters-1359"><a href="#League.starters-1359"><span class="linenos">1359</span></a>                            <span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span>
</span><span id="League.starters-1360"><a href="#League.starters-1360"><span class="linenos">1360</span></a>                            <span class="o">.</span><span class="n">index</span><span class="p">,</span>
</span><span id="League.starters-1361"><a href="#League.starters-1361"><span class="linenos">1361</span></a>                            <span class="s2">&quot;starter&quot;</span><span class="p">,</span>
</span><span id="League.starters-1362"><a href="#League.starters-1362"><span class="linenos">1362</span></a>                        <span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="League.starters-1363"><a href="#League.starters-1363"><span class="linenos">1363</span></a>                <span class="n">flex_pos</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;W/T&quot;</span><span class="p">:[</span><span class="s1">&#39;WR&#39;</span><span class="p">,</span><span class="s1">&#39;TE&#39;</span><span class="p">],</span><span class="s2">&quot;W/R/T&quot;</span><span class="p">:[</span><span class="s1">&#39;WR&#39;</span><span class="p">,</span><span class="s1">&#39;RB&#39;</span><span class="p">,</span><span class="s1">&#39;TE&#39;</span><span class="p">],</span><span class="s2">&quot;Q/W/R/T&quot;</span><span class="p">:[</span><span class="s1">&#39;WR&#39;</span><span class="p">,</span><span class="s1">&#39;RB&#39;</span><span class="p">,</span><span class="s1">&#39;TE&#39;</span><span class="p">,</span><span class="s1">&#39;QB&#39;</span><span class="p">]}</span>
</span><span id="League.starters-1364"><a href="#League.starters-1364"><span class="linenos">1364</span></a>                <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">flex_pos</span><span class="p">:</span>
</span><span id="League.starters-1365"><a href="#League.starters-1365"><span class="linenos">1365</span></a>                    <span class="n">num_flex</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lineup</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">lineup</span><span class="o">.</span><span class="n">position</span> <span class="o">==</span> <span class="n">pos</span><span class="p">,</span><span class="s1">&#39;count&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
</span><span id="League.starters-1366"><a href="#League.starters-1366"><span class="linenos">1366</span></a>                    <span class="k">for</span> <span class="n">flex</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_flex</span><span class="p">):</span>
</span><span id="League.starters-1367"><a href="#League.starters-1367"><span class="linenos">1367</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League.starters-1368"><a href="#League.starters-1368"><span class="linenos">1368</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League.starters-1369"><a href="#League.starters-1369"><span class="linenos">1369</span></a>                                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">fantasy_team</span> <span class="o">==</span> <span class="n">team</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>
</span><span id="League.starters-1370"><a href="#League.starters-1370"><span class="linenos">1370</span></a>                                <span class="o">&amp;</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">starter</span>
</span><span id="League.starters-1371"><a href="#League.starters-1371"><span class="linenos">1371</span></a>                                <span class="o">&amp;</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">injured</span>
</span><span id="League.starters-1372"><a href="#League.starters-1372"><span class="linenos">1372</span></a>                                <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">bye_week</span> <span class="o">!=</span> <span class="n">week</span><span class="p">)</span>
</span><span id="League.starters-1373"><a href="#League.starters-1373"><span class="linenos">1373</span></a>                                <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">flex_pos</span><span class="p">[</span><span class="n">pos</span><span class="p">])</span>
</span><span id="League.starters-1374"><a href="#League.starters-1374"><span class="linenos">1374</span></a>                                <span class="o">&amp;</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">player_id</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">started</span><span class="o">.</span><span class="n">player_id</span><span class="p">)</span>
</span><span id="League.starters-1375"><a href="#League.starters-1375"><span class="linenos">1375</span></a>                                <span class="o">&amp;</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">player_id</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">not_available</span><span class="o">.</span><span class="n">player_id</span><span class="p">)</span>
</span><span id="League.starters-1376"><a href="#League.starters-1376"><span class="linenos">1376</span></a>                            <span class="p">]</span>
</span><span id="League.starters-1377"><a href="#League.starters-1377"><span class="linenos">1377</span></a>                            <span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span>
</span><span id="League.starters-1378"><a href="#League.starters-1378"><span class="linenos">1378</span></a>                            <span class="o">.</span><span class="n">index</span><span class="p">,</span>
</span><span id="League.starters-1379"><a href="#League.starters-1379"><span class="linenos">1379</span></a>                            <span class="s2">&quot;starter&quot;</span><span class="p">,</span>
</span><span id="League.starters-1380"><a href="#League.starters-1380"><span class="linenos">1380</span></a>                        <span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="League.starters-1381"><a href="#League.starters-1381"><span class="linenos">1381</span></a>        <span class="k">elif</span> <span class="n">week</span> <span class="o">&gt;=</span> <span class="n">as_of</span> <span class="o">%</span> <span class="mi">100</span><span class="p">:</span>
</span><span id="League.starters-1382"><a href="#League.starters-1382"><span class="linenos">1382</span></a>            <span class="n">num_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">roster_spots</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">roster_spots</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;W/T&quot;</span><span class="p">,</span> <span class="s2">&quot;W/R/T&quot;</span><span class="p">,</span> <span class="s2">&quot;Q/W/R/T&quot;</span><span class="p">,</span> <span class="s2">&quot;BN&quot;</span><span class="p">,</span> <span class="s2">&quot;IR&quot;</span><span class="p">])]</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;position&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span>
</span><span id="League.starters-1383"><a href="#League.starters-1383"><span class="linenos">1383</span></a>            <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">num_pos</span><span class="p">:</span>
</span><span id="League.starters-1384"><a href="#League.starters-1384"><span class="linenos">1384</span></a>                <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_pos</span><span class="p">[</span><span class="n">pos</span><span class="p">]):</span>
</span><span id="League.starters-1385"><a href="#League.starters-1385"><span class="linenos">1385</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League.starters-1386"><a href="#League.starters-1386"><span class="linenos">1386</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League.starters-1387"><a href="#League.starters-1387"><span class="linenos">1387</span></a>                            <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">starter</span>
</span><span id="League.starters-1388"><a href="#League.starters-1388"><span class="linenos">1388</span></a>                            <span class="o">&amp;</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">injured</span>
</span><span id="League.starters-1389"><a href="#League.starters-1389"><span class="linenos">1389</span></a>                            <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">bye_week</span> <span class="o">!=</span> <span class="n">week</span><span class="p">)</span>
</span><span id="League.starters-1390"><a href="#League.starters-1390"><span class="linenos">1390</span></a>                            <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">position</span> <span class="o">==</span> <span class="n">pos</span><span class="p">)</span>
</span><span id="League.starters-1391"><a href="#League.starters-1391"><span class="linenos">1391</span></a>                        <span class="p">]</span>
</span><span id="League.starters-1392"><a href="#League.starters-1392"><span class="linenos">1392</span></a>                        <span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;fantasy_team&quot;</span><span class="p">],</span> <span class="n">keep</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)</span>
</span><span id="League.starters-1393"><a href="#League.starters-1393"><span class="linenos">1393</span></a>                        <span class="o">.</span><span class="n">index</span><span class="p">,</span>
</span><span id="League.starters-1394"><a href="#League.starters-1394"><span class="linenos">1394</span></a>                        <span class="s2">&quot;starter&quot;</span><span class="p">,</span>
</span><span id="League.starters-1395"><a href="#League.starters-1395"><span class="linenos">1395</span></a>                    <span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="League.starters-1396"><a href="#League.starters-1396"><span class="linenos">1396</span></a>            <span class="n">flex_pos</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;W/T&quot;</span><span class="p">:[</span><span class="s1">&#39;WR&#39;</span><span class="p">,</span><span class="s1">&#39;TE&#39;</span><span class="p">],</span><span class="s2">&quot;W/R/T&quot;</span><span class="p">:[</span><span class="s1">&#39;WR&#39;</span><span class="p">,</span><span class="s1">&#39;RB&#39;</span><span class="p">,</span><span class="s1">&#39;TE&#39;</span><span class="p">],</span><span class="s2">&quot;Q/W/R/T&quot;</span><span class="p">:[</span><span class="s1">&#39;WR&#39;</span><span class="p">,</span><span class="s1">&#39;RB&#39;</span><span class="p">,</span><span class="s1">&#39;TE&#39;</span><span class="p">,</span><span class="s1">&#39;QB&#39;</span><span class="p">]}</span>
</span><span id="League.starters-1397"><a href="#League.starters-1397"><span class="linenos">1397</span></a>            <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">flex_pos</span><span class="p">:</span>
</span><span id="League.starters-1398"><a href="#League.starters-1398"><span class="linenos">1398</span></a>                <span class="n">num_flex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">roster_spots</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">roster_spots</span><span class="o">.</span><span class="n">position</span> <span class="o">==</span> <span class="n">pos</span><span class="p">,</span><span class="s1">&#39;count&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</span><span id="League.starters-1399"><a href="#League.starters-1399"><span class="linenos">1399</span></a>                <span class="k">for</span> <span class="n">flex</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_flex</span><span class="p">):</span>
</span><span id="League.starters-1400"><a href="#League.starters-1400"><span class="linenos">1400</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League.starters-1401"><a href="#League.starters-1401"><span class="linenos">1401</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League.starters-1402"><a href="#League.starters-1402"><span class="linenos">1402</span></a>                            <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">starter</span>
</span><span id="League.starters-1403"><a href="#League.starters-1403"><span class="linenos">1403</span></a>                            <span class="o">&amp;</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">injured</span>
</span><span id="League.starters-1404"><a href="#League.starters-1404"><span class="linenos">1404</span></a>                            <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">bye_week</span> <span class="o">!=</span> <span class="n">week</span><span class="p">)</span>
</span><span id="League.starters-1405"><a href="#League.starters-1405"><span class="linenos">1405</span></a>                            <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">flex_pos</span><span class="p">[</span><span class="n">pos</span><span class="p">])</span>
</span><span id="League.starters-1406"><a href="#League.starters-1406"><span class="linenos">1406</span></a>                        <span class="p">]</span>
</span><span id="League.starters-1407"><a href="#League.starters-1407"><span class="linenos">1407</span></a>                        <span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;fantasy_team&quot;</span><span class="p">],</span> <span class="n">keep</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)</span>
</span><span id="League.starters-1408"><a href="#League.starters-1408"><span class="linenos">1408</span></a>                        <span class="o">.</span><span class="n">index</span><span class="p">,</span>
</span><span id="League.starters-1409"><a href="#League.starters-1409"><span class="linenos">1409</span></a>                        <span class="s2">&quot;starter&quot;</span><span class="p">,</span>
</span><span id="League.starters-1410"><a href="#League.starters-1410"><span class="linenos">1410</span></a>                    <span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span></pre></div>


            <div class="docstring"><p>Identifies which players should be started on each fantasy team 
based on fantasy point projections and available roster spots.</p>

<p>Args:
    week (int, optional): week for which to identify starters.</p>
</div>


                            </div>
                            <div id="League.bestball_sims" class="classattr">
                                        <input id="League.bestball_sims-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">bestball_sims</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">payouts</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">]</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="League.bestball_sims-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#League.bestball_sims"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="League.bestball_sims-1412"><a href="#League.bestball_sims-1412"><span class="linenos">1412</span></a>    <span class="k">def</span> <span class="nf">bestball_sims</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">payouts</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">]):</span>
</span><span id="League.bestball_sims-1413"><a href="#League.bestball_sims-1413"><span class="linenos">1413</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="League.bestball_sims-1414"><a href="#League.bestball_sims-1414"><span class="linenos">1414</span></a><span class="sd">        Simulates the remainder of the fantasy season based on current rosters </span>
</span><span id="League.bestball_sims-1415"><a href="#League.bestball_sims-1415"><span class="linenos">1415</span></a><span class="sd">        and best ball settings using Monte Carlo simulations.</span>
</span><span id="League.bestball_sims-1416"><a href="#League.bestball_sims-1416"><span class="linenos">1416</span></a>
</span><span id="League.bestball_sims-1417"><a href="#League.bestball_sims-1417"><span class="linenos">1417</span></a><span class="sd">        Args:</span>
</span><span id="League.bestball_sims-1418"><a href="#League.bestball_sims-1418"><span class="linenos">1418</span></a><span class="sd">            payouts (list, optional): list of prize amounts for first, second, and third, defaults to [800, 300, 100].</span>
</span><span id="League.bestball_sims-1419"><a href="#League.bestball_sims-1419"><span class="linenos">1419</span></a>
</span><span id="League.bestball_sims-1420"><a href="#League.bestball_sims-1420"><span class="linenos">1420</span></a><span class="sd">        Returns:</span>
</span><span id="League.bestball_sims-1421"><a href="#League.bestball_sims-1421"><span class="linenos">1421</span></a><span class="sd">            standings (pd.DataFrame): simulated results for the final season standings and playoff projections.</span>
</span><span id="League.bestball_sims-1422"><a href="#League.bestball_sims-1422"><span class="linenos">1422</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="League.bestball_sims-1423"><a href="#League.bestball_sims-1423"><span class="linenos">1423</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_oauth</span><span class="p">()</span>
</span><span id="League.bestball_sims-1424"><a href="#League.bestball_sims-1424"><span class="linenos">1424</span></a>        <span class="n">projections</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;fantasy_team&quot;</span><span class="p">,</span> <span class="s2">&quot;week&quot;</span><span class="p">,</span> <span class="s2">&quot;points_avg&quot;</span><span class="p">,</span> <span class="s2">&quot;points_stdev&quot;</span><span class="p">])</span>
</span><span id="League.bestball_sims-1425"><a href="#League.bestball_sims-1425"><span class="linenos">1425</span></a>        <span class="k">for</span> <span class="n">week</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">week</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;playoff_start_week&#39;</span><span class="p">]):</span>
</span><span id="League.bestball_sims-1426"><a href="#League.bestball_sims-1426"><span class="linenos">1426</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">starters</span><span class="p">(</span><span class="n">week</span><span class="p">)</span>
</span><span id="League.bestball_sims-1427"><a href="#League.bestball_sims-1427"><span class="linenos">1427</span></a>            <span class="n">projections</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">projections</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">fantasy_team</span><span class="o">.</span><span class="n">isnull</span><span class="p">(),</span>\
</span><span id="League.bestball_sims-1428"><a href="#League.bestball_sims-1428"><span class="linenos">1428</span></a>            <span class="p">[</span><span class="s1">&#39;player_id_sr&#39;</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;position&#39;</span><span class="p">,</span><span class="s1">&#39;fantasy_team&#39;</span><span class="p">,</span><span class="s1">&#39;points_avg&#39;</span><span class="p">,</span><span class="s1">&#39;points_stdev&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)],</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="League.bestball_sims-1429"><a href="#League.bestball_sims-1429"><span class="linenos">1429</span></a>            <span class="n">projections</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">projections</span><span class="o">.</span><span class="n">week</span><span class="o">.</span><span class="n">isnull</span><span class="p">(),</span> <span class="s2">&quot;week&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">week</span>
</span><span id="League.bestball_sims-1430"><a href="#League.bestball_sims-1430"><span class="linenos">1430</span></a>        <span class="n">season_sims</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">projections</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_sims</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="League.bestball_sims-1431"><a href="#League.bestball_sims-1431"><span class="linenos">1431</span></a>        <span class="n">season_sims</span><span class="p">[</span><span class="s2">&quot;num_sim&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">season_sims</span><span class="o">.</span><span class="n">index</span> <span class="o">//</span> <span class="n">projections</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League.bestball_sims-1432"><a href="#League.bestball_sims-1432"><span class="linenos">1432</span></a>        <span class="n">season_sims</span><span class="p">[</span><span class="s2">&quot;points_sim&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League.bestball_sims-1433"><a href="#League.bestball_sims-1433"><span class="linenos">1433</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">season_sims</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="League.bestball_sims-1434"><a href="#League.bestball_sims-1434"><span class="linenos">1434</span></a>            <span class="o">*</span> <span class="n">season_sims</span><span class="p">[</span><span class="s2">&quot;points_stdev&quot;</span><span class="p">]</span>
</span><span id="League.bestball_sims-1435"><a href="#League.bestball_sims-1435"><span class="linenos">1435</span></a>            <span class="o">+</span> <span class="n">season_sims</span><span class="p">[</span><span class="s2">&quot;points_avg&quot;</span><span class="p">]</span>
</span><span id="League.bestball_sims-1436"><a href="#League.bestball_sims-1436"><span class="linenos">1436</span></a>        <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="League.bestball_sims-1437"><a href="#League.bestball_sims-1437"><span class="linenos">1437</span></a>        <span class="n">season_sims</span> <span class="o">=</span> <span class="n">season_sims</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;points_sim&#39;</span><span class="p">,</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="League.bestball_sims-1438"><a href="#League.bestball_sims-1438"><span class="linenos">1438</span></a>        <span class="n">season_sims</span><span class="p">[</span><span class="s1">&#39;injured&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">season_sims</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mf">0.1</span>
</span><span id="League.bestball_sims-1439"><a href="#League.bestball_sims-1439"><span class="linenos">1439</span></a>        <span class="n">season_sims</span><span class="p">[</span><span class="s1">&#39;starter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="League.bestball_sims-1440"><a href="#League.bestball_sims-1440"><span class="linenos">1440</span></a>        <span class="n">num_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">roster_spots</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">roster_spots</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;W/T&quot;</span><span class="p">,</span> <span class="s2">&quot;W/R/T&quot;</span><span class="p">,</span> <span class="s2">&quot;Q/W/R/T&quot;</span><span class="p">,</span> <span class="s2">&quot;BN&quot;</span><span class="p">,</span> <span class="s2">&quot;IR&quot;</span><span class="p">])]</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;position&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span>
</span><span id="League.bestball_sims-1441"><a href="#League.bestball_sims-1441"><span class="linenos">1441</span></a>        <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">num_pos</span><span class="p">:</span>
</span><span id="League.bestball_sims-1442"><a href="#League.bestball_sims-1442"><span class="linenos">1442</span></a>            <span class="n">inds</span> <span class="o">=</span> <span class="n">season_sims</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">season_sims</span><span class="o">.</span><span class="n">position</span> <span class="o">==</span> <span class="n">pos</span><span class="p">)</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">season_sims</span><span class="o">.</span><span class="n">injured</span><span class="p">]</span>\
</span><span id="League.bestball_sims-1443"><a href="#League.bestball_sims-1443"><span class="linenos">1443</span></a>            <span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;num_sim&#39;</span><span class="p">,</span><span class="s1">&#39;week&#39;</span><span class="p">,</span><span class="s1">&#39;fantasy_team&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">num_pos</span><span class="p">[</span><span class="n">pos</span><span class="p">])</span><span class="o">.</span><span class="n">index</span>
</span><span id="League.bestball_sims-1444"><a href="#League.bestball_sims-1444"><span class="linenos">1444</span></a>            <span class="n">season_sims</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inds</span><span class="p">,</span><span class="s1">&#39;starter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="League.bestball_sims-1445"><a href="#League.bestball_sims-1445"><span class="linenos">1445</span></a>        <span class="n">flex_pos</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;W/T&quot;</span><span class="p">:[</span><span class="s1">&#39;WR&#39;</span><span class="p">,</span><span class="s1">&#39;TE&#39;</span><span class="p">],</span><span class="s2">&quot;W/R/T&quot;</span><span class="p">:[</span><span class="s1">&#39;WR&#39;</span><span class="p">,</span><span class="s1">&#39;RB&#39;</span><span class="p">,</span><span class="s1">&#39;TE&#39;</span><span class="p">],</span><span class="s2">&quot;Q/W/R/T&quot;</span><span class="p">:[</span><span class="s1">&#39;WR&#39;</span><span class="p">,</span><span class="s1">&#39;RB&#39;</span><span class="p">,</span><span class="s1">&#39;TE&#39;</span><span class="p">,</span><span class="s1">&#39;QB&#39;</span><span class="p">]}</span>
</span><span id="League.bestball_sims-1446"><a href="#League.bestball_sims-1446"><span class="linenos">1446</span></a>        <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">flex_pos</span><span class="p">:</span>
</span><span id="League.bestball_sims-1447"><a href="#League.bestball_sims-1447"><span class="linenos">1447</span></a>            <span class="n">num_flex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">roster_spots</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">roster_spots</span><span class="o">.</span><span class="n">position</span> <span class="o">==</span> <span class="n">pos</span><span class="p">,</span><span class="s1">&#39;count&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</span><span id="League.bestball_sims-1448"><a href="#League.bestball_sims-1448"><span class="linenos">1448</span></a>            <span class="n">inds</span> <span class="o">=</span> <span class="n">season_sims</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">season_sims</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">flex_pos</span><span class="p">[</span><span class="n">pos</span><span class="p">])</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">season_sims</span><span class="o">.</span><span class="n">injured</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">season_sims</span><span class="o">.</span><span class="n">starter</span><span class="p">]</span>\
</span><span id="League.bestball_sims-1449"><a href="#League.bestball_sims-1449"><span class="linenos">1449</span></a>            <span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;num_sim&#39;</span><span class="p">,</span><span class="s1">&#39;week&#39;</span><span class="p">,</span><span class="s1">&#39;fantasy_team&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">num_flex</span><span class="p">)</span><span class="o">.</span><span class="n">index</span>
</span><span id="League.bestball_sims-1450"><a href="#League.bestball_sims-1450"><span class="linenos">1450</span></a>            <span class="n">season_sims</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inds</span><span class="p">,</span><span class="s1">&#39;starter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="League.bestball_sims-1451"><a href="#League.bestball_sims-1451"><span class="linenos">1451</span></a>        <span class="n">standings_sims</span> <span class="o">=</span> <span class="n">season_sims</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">season_sims</span><span class="o">.</span><span class="n">starter</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;num_sim&#39;</span><span class="p">,</span><span class="s1">&#39;fantasy_team&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">points_sim</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="League.bestball_sims-1452"><a href="#League.bestball_sims-1452"><span class="linenos">1452</span></a>        <span class="n">standings_sims</span> <span class="o">=</span> <span class="n">standings_sims</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;num_sim&#39;</span><span class="p">,</span><span class="s1">&#39;points_sim&#39;</span><span class="p">],</span><span class="n">ascending</span><span class="o">=</span><span class="p">[</span><span class="kc">True</span><span class="p">,</span><span class="kc">False</span><span class="p">],</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="League.bestball_sims-1453"><a href="#League.bestball_sims-1453"><span class="linenos">1453</span></a>        <span class="n">standings_sims</span><span class="p">[</span><span class="s1">&#39;place&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">standings_sims</span><span class="o">.</span><span class="n">index</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">teams</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="League.bestball_sims-1454"><a href="#League.bestball_sims-1454"><span class="linenos">1454</span></a>        <span class="n">standings_sims</span><span class="p">[</span><span class="s2">&quot;playoffs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">standings_sims</span><span class="p">[</span><span class="s1">&#39;place&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;num_playoff_teams&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="League.bestball_sims-1455"><a href="#League.bestball_sims-1455"><span class="linenos">1455</span></a>        <span class="n">standings_sims</span><span class="p">[</span><span class="s2">&quot;winner&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">standings_sims</span><span class="p">[</span><span class="s1">&#39;place&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="League.bestball_sims-1456"><a href="#League.bestball_sims-1456"><span class="linenos">1456</span></a>        <span class="n">standings_sims</span><span class="p">[</span><span class="s2">&quot;runner_up&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">standings_sims</span><span class="p">[</span><span class="s1">&#39;place&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="League.bestball_sims-1457"><a href="#League.bestball_sims-1457"><span class="linenos">1457</span></a>        <span class="n">standings_sims</span><span class="p">[</span><span class="s2">&quot;third&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">standings_sims</span><span class="p">[</span><span class="s1">&#39;place&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="League.bestball_sims-1458"><a href="#League.bestball_sims-1458"><span class="linenos">1458</span></a>        <span class="n">payouts</span> <span class="o">+=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">teams</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">payouts</span><span class="p">))</span>
</span><span id="League.bestball_sims-1459"><a href="#League.bestball_sims-1459"><span class="linenos">1459</span></a>        <span class="n">standings_sims</span><span class="p">[</span><span class="s1">&#39;earnings&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">payouts</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">num_sims</span>
</span><span id="League.bestball_sims-1460"><a href="#League.bestball_sims-1460"><span class="linenos">1460</span></a>        <span class="n">standings</span> <span class="o">=</span> <span class="n">standings_sims</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;fantasy_team&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="League.bestball_sims-1461"><a href="#League.bestball_sims-1461"><span class="linenos">1461</span></a>        <span class="n">standings</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">standings</span><span class="p">,</span><span class="n">right</span><span class="o">=</span><span class="n">standings_sims</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;fantasy_team&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">points_sim</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>\
</span><span id="League.bestball_sims-1462"><a href="#League.bestball_sims-1462"><span class="linenos">1462</span></a>        <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;points_sim&#39;</span><span class="p">:</span><span class="s1">&#39;points_stdev&#39;</span><span class="p">}),</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="s1">&#39;fantasy_team&#39;</span><span class="p">)</span>
</span><span id="League.bestball_sims-1463"><a href="#League.bestball_sims-1463"><span class="linenos">1463</span></a>        <span class="n">standings</span> <span class="o">=</span> <span class="n">standings</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fantasy_team&#39;</span><span class="p">:</span><span class="s1">&#39;team&#39;</span><span class="p">,</span><span class="s1">&#39;points_sim&#39;</span><span class="p">:</span><span class="s1">&#39;points_avg&#39;</span><span class="p">,</span><span class="s1">&#39;place&#39;</span><span class="p">:</span><span class="s1">&#39;avg_place&#39;</span><span class="p">})</span>
</span><span id="League.bestball_sims-1464"><a href="#League.bestball_sims-1464"><span class="linenos">1464</span></a>        <span class="n">standings</span> <span class="o">=</span> <span class="n">standings</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;playoffs&#39;</span><span class="p">,</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="League.bestball_sims-1465"><a href="#League.bestball_sims-1465"><span class="linenos">1465</span></a>        <span class="k">del</span> <span class="n">standings</span><span class="p">[</span><span class="s1">&#39;num_sim&#39;</span><span class="p">]</span>
</span><span id="League.bestball_sims-1466"><a href="#League.bestball_sims-1466"><span class="linenos">1466</span></a>        <span class="n">standings</span><span class="p">[[</span><span class="s2">&quot;wins_avg&quot;</span><span class="p">,</span><span class="s2">&quot;wins_stdev&quot;</span><span class="p">,</span><span class="s2">&quot;playoff_bye&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="League.bestball_sims-1467"><a href="#League.bestball_sims-1467"><span class="linenos">1467</span></a>        <span class="k">return</span> <span class="n">standings</span>
</span></pre></div>


            <div class="docstring"><p>Simulates the remainder of the fantasy season based on current rosters 
and best ball settings using Monte Carlo simulations.</p>

<p>Args:
    payouts (list, optional): list of prize amounts for first, second, and third, defaults to [800, 300, 100].</p>

<p>Returns:
    standings (pd.DataFrame): simulated results for the final season standings and playoff projections.</p>
</div>


                            </div>
                            <div id="League.season_sims" class="classattr">
                                        <input id="League.season_sims-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">season_sims</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">postseason</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">payouts</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">800</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">100</span><span class="p">]</span>,</span><span class="param">	<span class="n">fixed_winner</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="League.season_sims-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#League.season_sims"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="League.season_sims-1469"><a href="#League.season_sims-1469"><span class="linenos">1469</span></a>    <span class="k">def</span> <span class="nf">season_sims</span><span class="p">(</span>
</span><span id="League.season_sims-1470"><a href="#League.season_sims-1470"><span class="linenos">1470</span></a>        <span class="bp">self</span><span class="p">,</span> 
</span><span id="League.season_sims-1471"><a href="#League.season_sims-1471"><span class="linenos">1471</span></a>        <span class="n">postseason</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> 
</span><span id="League.season_sims-1472"><a href="#League.season_sims-1472"><span class="linenos">1472</span></a>        <span class="n">payouts</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">800</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span> 
</span><span id="League.season_sims-1473"><a href="#League.season_sims-1473"><span class="linenos">1473</span></a>        <span class="n">fixed_winner</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="League.season_sims-1474"><a href="#League.season_sims-1474"><span class="linenos">1474</span></a>    <span class="p">):</span>
</span><span id="League.season_sims-1475"><a href="#League.season_sims-1475"><span class="linenos">1475</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="League.season_sims-1476"><a href="#League.season_sims-1476"><span class="linenos">1476</span></a><span class="sd">        Simulates the remainder of the fantasy season based on current rosters </span>
</span><span id="League.season_sims-1477"><a href="#League.season_sims-1477"><span class="linenos">1477</span></a><span class="sd">        and redraft settings using Monte Carlo simulations.</span>
</span><span id="League.season_sims-1478"><a href="#League.season_sims-1478"><span class="linenos">1478</span></a>
</span><span id="League.season_sims-1479"><a href="#League.season_sims-1479"><span class="linenos">1479</span></a><span class="sd">        Args:</span>
</span><span id="League.season_sims-1480"><a href="#League.season_sims-1480"><span class="linenos">1480</span></a><span class="sd">            postseason (bool, optional): whether to simulate the postseason in addition to the regular season, defaults to True.  </span>
</span><span id="League.season_sims-1481"><a href="#League.season_sims-1481"><span class="linenos">1481</span></a><span class="sd">            payouts (list, optional): list of prize amounts for first, second, and third, defaults to [800, 300, 100].  </span>
</span><span id="League.season_sims-1482"><a href="#League.season_sims-1482"><span class="linenos">1482</span></a><span class="sd">            fixed_winner (list, optional): list containing the week and team name of a fixed winner, defaults to None.</span>
</span><span id="League.season_sims-1483"><a href="#League.season_sims-1483"><span class="linenos">1483</span></a>
</span><span id="League.season_sims-1484"><a href="#League.season_sims-1484"><span class="linenos">1484</span></a><span class="sd">        Returns:</span>
</span><span id="League.season_sims-1485"><a href="#League.season_sims-1485"><span class="linenos">1485</span></a><span class="sd">            schedule (pd.DataFrame): simulated results for each matchup throughout the season in question  </span>
</span><span id="League.season_sims-1486"><a href="#League.season_sims-1486"><span class="linenos">1486</span></a><span class="sd">            standings (pd.DataFrame): simulated results for the final season standings and playoff projections</span>
</span><span id="League.season_sims-1487"><a href="#League.season_sims-1487"><span class="linenos">1487</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="League.season_sims-1488"><a href="#League.season_sims-1488"><span class="linenos">1488</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_oauth</span><span class="p">()</span>
</span><span id="League.season_sims-1489"><a href="#League.season_sims-1489"><span class="linenos">1489</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[</span><span class="s2">&quot;points_var&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">points_stdev</span><span class="o">**</span><span class="mi">2</span>
</span><span id="League.season_sims-1490"><a href="#League.season_sims-1490"><span class="linenos">1490</span></a>        <span class="n">projections</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span><span id="League.season_sims-1491"><a href="#League.season_sims-1491"><span class="linenos">1491</span></a>            <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;fantasy_team&quot;</span><span class="p">,</span> <span class="s2">&quot;week&quot;</span><span class="p">,</span> <span class="s2">&quot;points_avg&quot;</span><span class="p">,</span> <span class="s2">&quot;points_var&quot;</span><span class="p">]</span>
</span><span id="League.season_sims-1492"><a href="#League.season_sims-1492"><span class="linenos">1492</span></a>        <span class="p">)</span>
</span><span id="League.season_sims-1493"><a href="#League.season_sims-1493"><span class="linenos">1493</span></a>        <span class="k">for</span> <span class="n">week</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">17</span><span class="p">):</span>
</span><span id="League.season_sims-1494"><a href="#League.season_sims-1494"><span class="linenos">1494</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">starters</span><span class="p">(</span><span class="n">week</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="League.season_sims-1495"><a href="#League.season_sims-1495"><span class="linenos">1495</span></a>            <span class="n">projections</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">projections</span><span class="p">,</span>
</span><span id="League.season_sims-1496"><a href="#League.season_sims-1496"><span class="linenos">1496</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">starter</span><span class="p">]</span>
</span><span id="League.season_sims-1497"><a href="#League.season_sims-1497"><span class="linenos">1497</span></a>                <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;fantasy_team&quot;</span><span class="p">)[[</span><span class="s2">&quot;points_avg&quot;</span><span class="p">,</span> <span class="s2">&quot;points_var&quot;</span><span class="p">]]</span>
</span><span id="League.season_sims-1498"><a href="#League.season_sims-1498"><span class="linenos">1498</span></a>                <span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</span><span id="League.season_sims-1499"><a href="#League.season_sims-1499"><span class="linenos">1499</span></a>                <span class="o">.</span><span class="n">reset_index</span><span class="p">()],</span>
</span><span id="League.season_sims-1500"><a href="#League.season_sims-1500"><span class="linenos">1500</span></a>                <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="League.season_sims-1501"><a href="#League.season_sims-1501"><span class="linenos">1501</span></a>                <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="League.season_sims-1502"><a href="#League.season_sims-1502"><span class="linenos">1502</span></a>            <span class="p">)</span>
</span><span id="League.season_sims-1503"><a href="#League.season_sims-1503"><span class="linenos">1503</span></a>            <span class="n">projections</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">projections</span><span class="o">.</span><span class="n">week</span><span class="o">.</span><span class="n">isnull</span><span class="p">(),</span> <span class="s2">&quot;week&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">week</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="League.season_sims-1504"><a href="#League.season_sims-1504"><span class="linenos">1504</span></a>        <span class="n">projections</span><span class="p">[</span><span class="s2">&quot;points_stdev&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">projections</span><span class="p">[</span><span class="s2">&quot;points_var&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="mf">0.5</span>
</span><span id="League.season_sims-1505"><a href="#League.season_sims-1505"><span class="linenos">1505</span></a>        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">[</span><span class="s2">&quot;points_var&quot;</span><span class="p">]</span>
</span><span id="League.season_sims-1506"><a href="#League.season_sims-1506"><span class="linenos">1506</span></a>        <span class="n">schedule</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League.season_sims-1507"><a href="#League.season_sims-1507"><span class="linenos">1507</span></a>            <span class="n">left</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
</span><span id="League.season_sims-1508"><a href="#League.season_sims-1508"><span class="linenos">1508</span></a>            <span class="n">right</span><span class="o">=</span><span class="n">projections</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
</span><span id="League.season_sims-1509"><a href="#League.season_sims-1509"><span class="linenos">1509</span></a>                <span class="n">index</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="League.season_sims-1510"><a href="#League.season_sims-1510"><span class="linenos">1510</span></a>                <span class="n">columns</span><span class="o">=</span><span class="p">{</span>
</span><span id="League.season_sims-1511"><a href="#League.season_sims-1511"><span class="linenos">1511</span></a>                    <span class="s2">&quot;fantasy_team&quot;</span><span class="p">:</span> <span class="s2">&quot;team_1&quot;</span><span class="p">,</span>
</span><span id="League.season_sims-1512"><a href="#League.season_sims-1512"><span class="linenos">1512</span></a>                    <span class="s2">&quot;points_avg&quot;</span><span class="p">:</span> <span class="s2">&quot;points_avg_1&quot;</span><span class="p">,</span>
</span><span id="League.season_sims-1513"><a href="#League.season_sims-1513"><span class="linenos">1513</span></a>                    <span class="s2">&quot;points_stdev&quot;</span><span class="p">:</span> <span class="s2">&quot;points_stdev_1&quot;</span><span class="p">,</span>
</span><span id="League.season_sims-1514"><a href="#League.season_sims-1514"><span class="linenos">1514</span></a>                <span class="p">},</span>
</span><span id="League.season_sims-1515"><a href="#League.season_sims-1515"><span class="linenos">1515</span></a>            <span class="p">),</span>
</span><span id="League.season_sims-1516"><a href="#League.season_sims-1516"><span class="linenos">1516</span></a>            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
</span><span id="League.season_sims-1517"><a href="#League.season_sims-1517"><span class="linenos">1517</span></a>            <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;week&quot;</span><span class="p">,</span> <span class="s2">&quot;team_1&quot;</span><span class="p">],</span>
</span><span id="League.season_sims-1518"><a href="#League.season_sims-1518"><span class="linenos">1518</span></a>        <span class="p">)</span>
</span><span id="League.season_sims-1519"><a href="#League.season_sims-1519"><span class="linenos">1519</span></a>        <span class="n">schedule</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League.season_sims-1520"><a href="#League.season_sims-1520"><span class="linenos">1520</span></a>            <span class="n">left</span><span class="o">=</span><span class="n">schedule</span><span class="p">,</span>
</span><span id="League.season_sims-1521"><a href="#League.season_sims-1521"><span class="linenos">1521</span></a>            <span class="n">right</span><span class="o">=</span><span class="n">projections</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
</span><span id="League.season_sims-1522"><a href="#League.season_sims-1522"><span class="linenos">1522</span></a>                <span class="n">index</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="League.season_sims-1523"><a href="#League.season_sims-1523"><span class="linenos">1523</span></a>                <span class="n">columns</span><span class="o">=</span><span class="p">{</span>
</span><span id="League.season_sims-1524"><a href="#League.season_sims-1524"><span class="linenos">1524</span></a>                    <span class="s2">&quot;fantasy_team&quot;</span><span class="p">:</span> <span class="s2">&quot;team_2&quot;</span><span class="p">,</span>
</span><span id="League.season_sims-1525"><a href="#League.season_sims-1525"><span class="linenos">1525</span></a>                    <span class="s2">&quot;points_avg&quot;</span><span class="p">:</span> <span class="s2">&quot;points_avg_2&quot;</span><span class="p">,</span>
</span><span id="League.season_sims-1526"><a href="#League.season_sims-1526"><span class="linenos">1526</span></a>                    <span class="s2">&quot;points_stdev&quot;</span><span class="p">:</span> <span class="s2">&quot;points_stdev_2&quot;</span><span class="p">,</span>
</span><span id="League.season_sims-1527"><a href="#League.season_sims-1527"><span class="linenos">1527</span></a>                <span class="p">},</span>
</span><span id="League.season_sims-1528"><a href="#League.season_sims-1528"><span class="linenos">1528</span></a>            <span class="p">),</span>
</span><span id="League.season_sims-1529"><a href="#League.season_sims-1529"><span class="linenos">1529</span></a>            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
</span><span id="League.season_sims-1530"><a href="#League.season_sims-1530"><span class="linenos">1530</span></a>            <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;week&quot;</span><span class="p">,</span> <span class="s2">&quot;team_2&quot;</span><span class="p">],</span>
</span><span id="League.season_sims-1531"><a href="#League.season_sims-1531"><span class="linenos">1531</span></a>        <span class="p">)</span>
</span><span id="League.season_sims-1532"><a href="#League.season_sims-1532"><span class="linenos">1532</span></a>        <span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;points_avg_1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;points_avg_1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="League.season_sims-1533"><a href="#League.season_sims-1533"><span class="linenos">1533</span></a>        <span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;points_avg_2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;points_avg_2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="League.season_sims-1534"><a href="#League.season_sims-1534"><span class="linenos">1534</span></a>        <span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;points_stdev_1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League.season_sims-1535"><a href="#League.season_sims-1535"><span class="linenos">1535</span></a>            <span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;points_stdev_1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="League.season_sims-1536"><a href="#League.season_sims-1536"><span class="linenos">1536</span></a>        <span class="p">)</span>
</span><span id="League.season_sims-1537"><a href="#League.season_sims-1537"><span class="linenos">1537</span></a>        <span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;points_stdev_2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League.season_sims-1538"><a href="#League.season_sims-1538"><span class="linenos">1538</span></a>            <span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;points_stdev_2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="League.season_sims-1539"><a href="#League.season_sims-1539"><span class="linenos">1539</span></a>        <span class="p">)</span>
</span><span id="League.season_sims-1540"><a href="#League.season_sims-1540"><span class="linenos">1540</span></a>        <span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;points_avg_1&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;score_1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="League.season_sims-1541"><a href="#League.season_sims-1541"><span class="linenos">1541</span></a>        <span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;points_avg_2&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;score_2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="League.season_sims-1542"><a href="#League.season_sims-1542"><span class="linenos">1542</span></a>        <span class="k">if</span> <span class="n">fixed_winner</span><span class="p">:</span>
</span><span id="League.season_sims-1543"><a href="#League.season_sims-1543"><span class="linenos">1543</span></a>            <span class="k">if</span> <span class="p">(</span>
</span><span id="League.season_sims-1544"><a href="#League.season_sims-1544"><span class="linenos">1544</span></a>                <span class="p">(</span><span class="n">schedule</span><span class="o">.</span><span class="n">week</span> <span class="o">==</span> <span class="n">fixed_winner</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="League.season_sims-1545"><a href="#League.season_sims-1545"><span class="linenos">1545</span></a>                <span class="o">&amp;</span> <span class="p">(</span><span class="n">schedule</span><span class="o">.</span><span class="n">team_1</span> <span class="o">==</span> <span class="n">fixed_winner</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="League.season_sims-1546"><a href="#League.season_sims-1546"><span class="linenos">1546</span></a>            <span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="League.season_sims-1547"><a href="#League.season_sims-1547"><span class="linenos">1547</span></a>                <span class="n">winner</span><span class="p">,</span> <span class="n">loser</span> <span class="o">=</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span>
</span><span id="League.season_sims-1548"><a href="#League.season_sims-1548"><span class="linenos">1548</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="League.season_sims-1549"><a href="#League.season_sims-1549"><span class="linenos">1549</span></a>                <span class="n">winner</span><span class="p">,</span> <span class="n">loser</span> <span class="o">=</span> <span class="s2">&quot;2&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span>
</span><span id="League.season_sims-1550"><a href="#League.season_sims-1550"><span class="linenos">1550</span></a>            <span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League.season_sims-1551"><a href="#League.season_sims-1551"><span class="linenos">1551</span></a>                <span class="p">(</span><span class="n">schedule</span><span class="o">.</span><span class="n">week</span> <span class="o">==</span> <span class="n">fixed_winner</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="League.season_sims-1552"><a href="#League.season_sims-1552"><span class="linenos">1552</span></a>                <span class="o">&amp;</span> <span class="p">(</span><span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;team_&quot;</span> <span class="o">+</span> <span class="n">winner</span><span class="p">]</span> <span class="o">==</span> <span class="n">fixed_winner</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
</span><span id="League.season_sims-1553"><a href="#League.season_sims-1553"><span class="linenos">1553</span></a>                <span class="s2">&quot;points_avg_&quot;</span> <span class="o">+</span> <span class="n">winner</span><span class="p">,</span>
</span><span id="League.season_sims-1554"><a href="#League.season_sims-1554"><span class="linenos">1554</span></a>            <span class="p">]</span> <span class="o">=</span> <span class="mf">100.1</span>
</span><span id="League.season_sims-1555"><a href="#League.season_sims-1555"><span class="linenos">1555</span></a>            <span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League.season_sims-1556"><a href="#League.season_sims-1556"><span class="linenos">1556</span></a>                <span class="p">(</span><span class="n">schedule</span><span class="o">.</span><span class="n">week</span> <span class="o">==</span> <span class="n">fixed_winner</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="League.season_sims-1557"><a href="#League.season_sims-1557"><span class="linenos">1557</span></a>                <span class="o">&amp;</span> <span class="p">(</span><span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;team_&quot;</span> <span class="o">+</span> <span class="n">winner</span><span class="p">]</span> <span class="o">==</span> <span class="n">fixed_winner</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
</span><span id="League.season_sims-1558"><a href="#League.season_sims-1558"><span class="linenos">1558</span></a>                <span class="s2">&quot;points_avg_&quot;</span> <span class="o">+</span> <span class="n">loser</span><span class="p">,</span>
</span><span id="League.season_sims-1559"><a href="#League.season_sims-1559"><span class="linenos">1559</span></a>            <span class="p">]</span> <span class="o">=</span> <span class="mf">100.0</span>
</span><span id="League.season_sims-1560"><a href="#League.season_sims-1560"><span class="linenos">1560</span></a>            <span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League.season_sims-1561"><a href="#League.season_sims-1561"><span class="linenos">1561</span></a>                <span class="p">(</span><span class="n">schedule</span><span class="o">.</span><span class="n">week</span> <span class="o">==</span> <span class="n">fixed_winner</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="League.season_sims-1562"><a href="#League.season_sims-1562"><span class="linenos">1562</span></a>                <span class="o">&amp;</span> <span class="p">(</span><span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;team_&quot;</span> <span class="o">+</span> <span class="n">winner</span><span class="p">]</span> <span class="o">==</span> <span class="n">fixed_winner</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
</span><span id="League.season_sims-1563"><a href="#League.season_sims-1563"><span class="linenos">1563</span></a>                <span class="s2">&quot;points_stdev_&quot;</span> <span class="o">+</span> <span class="n">winner</span><span class="p">,</span>
</span><span id="League.season_sims-1564"><a href="#League.season_sims-1564"><span class="linenos">1564</span></a>            <span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="League.season_sims-1565"><a href="#League.season_sims-1565"><span class="linenos">1565</span></a>            <span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League.season_sims-1566"><a href="#League.season_sims-1566"><span class="linenos">1566</span></a>                <span class="p">(</span><span class="n">schedule</span><span class="o">.</span><span class="n">week</span> <span class="o">==</span> <span class="n">fixed_winner</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="League.season_sims-1567"><a href="#League.season_sims-1567"><span class="linenos">1567</span></a>                <span class="o">&amp;</span> <span class="p">(</span><span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;team_&quot;</span> <span class="o">+</span> <span class="n">winner</span><span class="p">]</span> <span class="o">==</span> <span class="n">fixed_winner</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
</span><span id="League.season_sims-1568"><a href="#League.season_sims-1568"><span class="linenos">1568</span></a>                <span class="s2">&quot;points_stdev_&quot;</span> <span class="o">+</span> <span class="n">loser</span><span class="p">,</span>
</span><span id="League.season_sims-1569"><a href="#League.season_sims-1569"><span class="linenos">1569</span></a>            <span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="League.season_sims-1570"><a href="#League.season_sims-1570"><span class="linenos">1570</span></a>        <span class="n">schedule_sims</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
</span><span id="League.season_sims-1571"><a href="#League.season_sims-1571"><span class="linenos">1571</span></a>            <span class="p">[</span><span class="n">schedule</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_sims</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span>
</span><span id="League.season_sims-1572"><a href="#League.season_sims-1572"><span class="linenos">1572</span></a>        <span class="p">)</span>
</span><span id="League.season_sims-1573"><a href="#League.season_sims-1573"><span class="linenos">1573</span></a>        <span class="n">schedule_sims</span><span class="p">[</span><span class="s2">&quot;num_sim&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">schedule_sims</span><span class="o">.</span><span class="n">index</span> <span class="o">//</span> <span class="n">schedule</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League.season_sims-1574"><a href="#League.season_sims-1574"><span class="linenos">1574</span></a>        <span class="n">schedule_sims</span><span class="p">[</span><span class="s2">&quot;sim_1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League.season_sims-1575"><a href="#League.season_sims-1575"><span class="linenos">1575</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">schedule_sims</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="League.season_sims-1576"><a href="#League.season_sims-1576"><span class="linenos">1576</span></a>            <span class="o">*</span> <span class="n">schedule_sims</span><span class="p">[</span><span class="s2">&quot;points_stdev_1&quot;</span><span class="p">]</span>
</span><span id="League.season_sims-1577"><a href="#League.season_sims-1577"><span class="linenos">1577</span></a>            <span class="o">+</span> <span class="n">schedule_sims</span><span class="p">[</span><span class="s2">&quot;points_avg_1&quot;</span><span class="p">]</span>
</span><span id="League.season_sims-1578"><a href="#League.season_sims-1578"><span class="linenos">1578</span></a>        <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="League.season_sims-1579"><a href="#League.season_sims-1579"><span class="linenos">1579</span></a>        <span class="n">schedule_sims</span><span class="p">[</span><span class="s2">&quot;sim_2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League.season_sims-1580"><a href="#League.season_sims-1580"><span class="linenos">1580</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">schedule_sims</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="League.season_sims-1581"><a href="#League.season_sims-1581"><span class="linenos">1581</span></a>            <span class="o">*</span> <span class="n">schedule_sims</span><span class="p">[</span><span class="s2">&quot;points_stdev_2&quot;</span><span class="p">]</span>
</span><span id="League.season_sims-1582"><a href="#League.season_sims-1582"><span class="linenos">1582</span></a>            <span class="o">+</span> <span class="n">schedule_sims</span><span class="p">[</span><span class="s2">&quot;points_avg_2&quot;</span><span class="p">]</span>
</span><span id="League.season_sims-1583"><a href="#League.season_sims-1583"><span class="linenos">1583</span></a>        <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="League.season_sims-1584"><a href="#League.season_sims-1584"><span class="linenos">1584</span></a>        <span class="n">schedule_sims</span><span class="p">[</span><span class="s2">&quot;win_1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">schedule_sims</span><span class="o">.</span><span class="n">sim_1</span> <span class="o">&gt;</span> <span class="n">schedule_sims</span><span class="o">.</span><span class="n">sim_2</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="League.season_sims-1585"><a href="#League.season_sims-1585"><span class="linenos">1585</span></a>        <span class="n">schedule_sims</span><span class="p">[</span><span class="s2">&quot;win_2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">schedule_sims</span><span class="p">[</span><span class="s2">&quot;win_1&quot;</span><span class="p">]</span>
</span><span id="League.season_sims-1586"><a href="#League.season_sims-1586"><span class="linenos">1586</span></a>        <span class="n">standings</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span>
</span><span id="League.season_sims-1587"><a href="#League.season_sims-1587"><span class="linenos">1587</span></a>            <span class="n">schedule_sims</span><span class="p">[[</span><span class="s2">&quot;num_sim&quot;</span><span class="p">,</span> <span class="s2">&quot;week&quot;</span><span class="p">,</span> <span class="s2">&quot;team_1&quot;</span><span class="p">,</span> <span class="s2">&quot;sim_1&quot;</span><span class="p">,</span> <span class="s2">&quot;win_1&quot;</span><span class="p">]]</span>
</span><span id="League.season_sims-1588"><a href="#League.season_sims-1588"><span class="linenos">1588</span></a>            <span class="o">.</span><span class="n">rename</span><span class="p">(</span>
</span><span id="League.season_sims-1589"><a href="#League.season_sims-1589"><span class="linenos">1589</span></a>                <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;team_1&quot;</span><span class="p">:</span> <span class="s2">&quot;team&quot;</span><span class="p">,</span> <span class="s2">&quot;win_1&quot;</span><span class="p">:</span> <span class="s2">&quot;wins&quot;</span><span class="p">,</span> <span class="s2">&quot;sim_1&quot;</span><span class="p">:</span> <span class="s2">&quot;points&quot;</span><span class="p">},</span>
</span><span id="League.season_sims-1590"><a href="#League.season_sims-1590"><span class="linenos">1590</span></a>            <span class="p">),</span>
</span><span id="League.season_sims-1591"><a href="#League.season_sims-1591"><span class="linenos">1591</span></a>            <span class="n">schedule_sims</span><span class="p">[[</span><span class="s2">&quot;num_sim&quot;</span><span class="p">,</span> <span class="s2">&quot;week&quot;</span><span class="p">,</span> <span class="s2">&quot;team_2&quot;</span><span class="p">,</span> <span class="s2">&quot;sim_2&quot;</span><span class="p">,</span> <span class="s2">&quot;win_2&quot;</span><span class="p">]]</span>
</span><span id="League.season_sims-1592"><a href="#League.season_sims-1592"><span class="linenos">1592</span></a>            <span class="o">.</span><span class="n">rename</span><span class="p">(</span>
</span><span id="League.season_sims-1593"><a href="#League.season_sims-1593"><span class="linenos">1593</span></a>                <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;team_2&quot;</span><span class="p">:</span> <span class="s2">&quot;team&quot;</span><span class="p">,</span> <span class="s2">&quot;win_2&quot;</span><span class="p">:</span> <span class="s2">&quot;wins&quot;</span><span class="p">,</span> <span class="s2">&quot;sim_2&quot;</span><span class="p">:</span> <span class="s2">&quot;points&quot;</span><span class="p">},</span>
</span><span id="League.season_sims-1594"><a href="#League.season_sims-1594"><span class="linenos">1594</span></a>            <span class="p">)],</span>
</span><span id="League.season_sims-1595"><a href="#League.season_sims-1595"><span class="linenos">1595</span></a>            <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="League.season_sims-1596"><a href="#League.season_sims-1596"><span class="linenos">1596</span></a>        <span class="p">)</span>
</span><span id="League.season_sims-1597"><a href="#League.season_sims-1597"><span class="linenos">1597</span></a>        <span class="n">standings</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League.season_sims-1598"><a href="#League.season_sims-1598"><span class="linenos">1598</span></a>            <span class="n">standings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">standings</span><span class="o">.</span><span class="n">week</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;playoff_start_week&quot;</span><span class="p">]]</span>
</span><span id="League.season_sims-1599"><a href="#League.season_sims-1599"><span class="linenos">1599</span></a>            <span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;num_sim&quot;</span><span class="p">,</span> <span class="s2">&quot;team&quot;</span><span class="p">])</span>
</span><span id="League.season_sims-1600"><a href="#League.season_sims-1600"><span class="linenos">1600</span></a>            <span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">numeric_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="League.season_sims-1601"><a href="#League.season_sims-1601"><span class="linenos">1601</span></a>            <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;num_sim&quot;</span><span class="p">,</span> <span class="s2">&quot;wins&quot;</span><span class="p">,</span> <span class="s2">&quot;points&quot;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="League.season_sims-1602"><a href="#League.season_sims-1602"><span class="linenos">1602</span></a>            <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="League.season_sims-1603"><a href="#League.season_sims-1603"><span class="linenos">1603</span></a>        <span class="p">)</span>
</span><span id="League.season_sims-1604"><a href="#League.season_sims-1604"><span class="linenos">1604</span></a>        <span class="n">standings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League.season_sims-1605"><a href="#League.season_sims-1605"><span class="linenos">1605</span></a>            <span class="n">standings</span><span class="o">.</span><span class="n">index</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">teams</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;num_playoff_teams&quot;</span><span class="p">],</span>
</span><span id="League.season_sims-1606"><a href="#League.season_sims-1606"><span class="linenos">1606</span></a>            <span class="s2">&quot;playoffs&quot;</span><span class="p">,</span>
</span><span id="League.season_sims-1607"><a href="#League.season_sims-1607"><span class="linenos">1607</span></a>        <span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="League.season_sims-1608"><a href="#League.season_sims-1608"><span class="linenos">1608</span></a>        <span class="n">standings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League.season_sims-1609"><a href="#League.season_sims-1609"><span class="linenos">1609</span></a>            <span class="n">standings</span><span class="o">.</span><span class="n">index</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">teams</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;num_playoff_teams&quot;</span><span class="p">],</span>
</span><span id="League.season_sims-1610"><a href="#League.season_sims-1610"><span class="linenos">1610</span></a>            <span class="s2">&quot;playoffs&quot;</span><span class="p">,</span>
</span><span id="League.season_sims-1611"><a href="#League.season_sims-1611"><span class="linenos">1611</span></a>        <span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="League.season_sims-1612"><a href="#League.season_sims-1612"><span class="linenos">1612</span></a>        <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;playoff_bye&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="League.season_sims-1613"><a href="#League.season_sims-1613"><span class="linenos">1613</span></a>        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;num_playoff_teams&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
</span><span id="League.season_sims-1614"><a href="#League.season_sims-1614"><span class="linenos">1614</span></a>            <span class="n">standings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">standings</span><span class="o">.</span><span class="n">index</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">teams</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;playoff_bye&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="League.season_sims-1615"><a href="#League.season_sims-1615"><span class="linenos">1615</span></a>        <span class="n">algorithm</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League.season_sims-1616"><a href="#League.season_sims-1616"><span class="linenos">1616</span></a>            <span class="n">schedule</span><span class="o">.</span><span class="n">team_1</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;The Algorithm&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
</span><span id="League.season_sims-1617"><a href="#League.season_sims-1617"><span class="linenos">1617</span></a>            <span class="ow">or</span> <span class="n">schedule</span><span class="o">.</span><span class="n">team_2</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;The Algorithm&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
</span><span id="League.season_sims-1618"><a href="#League.season_sims-1618"><span class="linenos">1618</span></a>        <span class="p">)</span>
</span><span id="League.season_sims-1619"><a href="#League.season_sims-1619"><span class="linenos">1619</span></a>        <span class="k">if</span> <span class="n">postseason</span><span class="p">:</span>
</span><span id="League.season_sims-1620"><a href="#League.season_sims-1620"><span class="linenos">1620</span></a>            <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;seed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">standings</span><span class="o">.</span><span class="n">index</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">teams</span><span class="p">)</span>
</span><span id="League.season_sims-1621"><a href="#League.season_sims-1621"><span class="linenos">1621</span></a>            <span class="n">scores</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League.season_sims-1622"><a href="#League.season_sims-1622"><span class="linenos">1622</span></a>                    <span class="n">schedule</span><span class="o">.</span><span class="n">week</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;playoff_start_week&quot;</span><span class="p">],</span>
</span><span id="League.season_sims-1623"><a href="#League.season_sims-1623"><span class="linenos">1623</span></a>                    <span class="p">[</span><span class="s2">&quot;week&quot;</span><span class="p">,</span> <span class="s2">&quot;team_1&quot;</span><span class="p">,</span> <span class="s2">&quot;score_1&quot;</span><span class="p">],</span>
</span><span id="League.season_sims-1624"><a href="#League.season_sims-1624"><span class="linenos">1624</span></a>                <span class="p">]</span>
</span><span id="League.season_sims-1625"><a href="#League.season_sims-1625"><span class="linenos">1625</span></a>                <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;team_1&quot;</span><span class="p">:</span> <span class="s2">&quot;team&quot;</span><span class="p">,</span> <span class="s2">&quot;score_1&quot;</span><span class="p">:</span> <span class="s2">&quot;score&quot;</span><span class="p">}),</span>
</span><span id="League.season_sims-1626"><a href="#League.season_sims-1626"><span class="linenos">1626</span></a>                <span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League.season_sims-1627"><a href="#League.season_sims-1627"><span class="linenos">1627</span></a>                    <span class="n">schedule</span><span class="o">.</span><span class="n">week</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;playoff_start_week&quot;</span><span class="p">],</span>
</span><span id="League.season_sims-1628"><a href="#League.season_sims-1628"><span class="linenos">1628</span></a>                    <span class="p">[</span><span class="s2">&quot;week&quot;</span><span class="p">,</span> <span class="s2">&quot;team_2&quot;</span><span class="p">,</span> <span class="s2">&quot;score_2&quot;</span><span class="p">],</span>
</span><span id="League.season_sims-1629"><a href="#League.season_sims-1629"><span class="linenos">1629</span></a>                <span class="p">]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;team_2&quot;</span><span class="p">:</span> <span class="s2">&quot;team&quot;</span><span class="p">,</span> <span class="s2">&quot;score_2&quot;</span><span class="p">:</span> <span class="s2">&quot;score&quot;</span><span class="p">})],</span>
</span><span id="League.season_sims-1630"><a href="#League.season_sims-1630"><span class="linenos">1630</span></a>                <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="League.season_sims-1631"><a href="#League.season_sims-1631"><span class="linenos">1631</span></a>                <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="League.season_sims-1632"><a href="#League.season_sims-1632"><span class="linenos">1632</span></a>            <span class="p">)</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;week&quot;</span><span class="p">,</span> <span class="s2">&quot;team&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">score</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="League.season_sims-1633"><a href="#League.season_sims-1633"><span class="linenos">1633</span></a>            <span class="n">playoffs</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League.season_sims-1634"><a href="#League.season_sims-1634"><span class="linenos">1634</span></a>                <span class="n">standings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">standings</span><span class="o">.</span><span class="n">seed</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;num_playoff_teams&quot;</span><span class="p">]]</span>
</span><span id="League.season_sims-1635"><a href="#League.season_sims-1635"><span class="linenos">1635</span></a>                <span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="League.season_sims-1636"><a href="#League.season_sims-1636"><span class="linenos">1636</span></a>                <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="League.season_sims-1637"><a href="#League.season_sims-1637"><span class="linenos">1637</span></a>            <span class="p">)</span>
</span><span id="League.season_sims-1638"><a href="#League.season_sims-1638"><span class="linenos">1638</span></a>            <span class="k">if</span> <span class="n">algorithm</span><span class="p">:</span>
</span><span id="League.season_sims-1639"><a href="#League.season_sims-1639"><span class="linenos">1639</span></a>                <span class="n">many_mile</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League.season_sims-1640"><a href="#League.season_sims-1640"><span class="linenos">1640</span></a>                    <span class="n">standings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">standings</span><span class="o">.</span><span class="n">seed</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;num_playoff_teams&quot;</span><span class="p">]]</span>
</span><span id="League.season_sims-1641"><a href="#League.season_sims-1641"><span class="linenos">1641</span></a>                    <span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="League.season_sims-1642"><a href="#League.season_sims-1642"><span class="linenos">1642</span></a>                    <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="League.season_sims-1643"><a href="#League.season_sims-1643"><span class="linenos">1643</span></a>                <span class="p">)</span>
</span><span id="League.season_sims-1644"><a href="#League.season_sims-1644"><span class="linenos">1644</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;num_playoff_teams&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;6&quot;</span><span class="p">:</span>
</span><span id="League.season_sims-1645"><a href="#League.season_sims-1645"><span class="linenos">1645</span></a>                <span class="n">playoffs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League.season_sims-1646"><a href="#League.season_sims-1646"><span class="linenos">1646</span></a>                    <span class="n">left</span><span class="o">=</span><span class="n">playoffs</span><span class="p">,</span>
</span><span id="League.season_sims-1647"><a href="#League.season_sims-1647"><span class="linenos">1647</span></a>                    <span class="n">right</span><span class="o">=</span><span class="n">scores</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League.season_sims-1648"><a href="#League.season_sims-1648"><span class="linenos">1648</span></a>                        <span class="n">scores</span><span class="o">.</span><span class="n">week</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;playoff_start_week&quot;</span><span class="p">],</span>
</span><span id="League.season_sims-1649"><a href="#League.season_sims-1649"><span class="linenos">1649</span></a>                        <span class="p">[</span><span class="s2">&quot;team&quot;</span><span class="p">,</span> <span class="s2">&quot;score&quot;</span><span class="p">],</span>
</span><span id="League.season_sims-1650"><a href="#League.season_sims-1650"><span class="linenos">1650</span></a>                    <span class="p">],</span>
</span><span id="League.season_sims-1651"><a href="#League.season_sims-1651"><span class="linenos">1651</span></a>                    <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
</span><span id="League.season_sims-1652"><a href="#League.season_sims-1652"><span class="linenos">1652</span></a>                    <span class="n">on</span><span class="o">=</span><span class="s2">&quot;team&quot;</span><span class="p">,</span>
</span><span id="League.season_sims-1653"><a href="#League.season_sims-1653"><span class="linenos">1653</span></a>                <span class="p">)</span>
</span><span id="League.season_sims-1654"><a href="#League.season_sims-1654"><span class="linenos">1654</span></a>                <span class="n">playoffs</span><span class="o">.</span><span class="n">score</span> <span class="o">=</span> <span class="n">playoffs</span><span class="o">.</span><span class="n">score</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="League.season_sims-1655"><a href="#League.season_sims-1655"><span class="linenos">1655</span></a>                <span class="n">playoffs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League.season_sims-1656"><a href="#League.season_sims-1656"><span class="linenos">1656</span></a>                    <span class="n">left</span><span class="o">=</span><span class="n">playoffs</span><span class="p">,</span>
</span><span id="League.season_sims-1657"><a href="#League.season_sims-1657"><span class="linenos">1657</span></a>                    <span class="n">right</span><span class="o">=</span><span class="n">projections</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League.season_sims-1658"><a href="#League.season_sims-1658"><span class="linenos">1658</span></a>                        <span class="n">projections</span><span class="o">.</span><span class="n">week</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;playoff_start_week&quot;</span><span class="p">],</span>
</span><span id="League.season_sims-1659"><a href="#League.season_sims-1659"><span class="linenos">1659</span></a>                        <span class="p">[</span><span class="s2">&quot;fantasy_team&quot;</span><span class="p">,</span> <span class="s2">&quot;points_avg&quot;</span><span class="p">,</span> <span class="s2">&quot;points_stdev&quot;</span><span class="p">],</span>
</span><span id="League.season_sims-1660"><a href="#League.season_sims-1660"><span class="linenos">1660</span></a>                    <span class="p">]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;fantasy_team&quot;</span><span class="p">:</span> <span class="s2">&quot;team&quot;</span><span class="p">}),</span>
</span><span id="League.season_sims-1661"><a href="#League.season_sims-1661"><span class="linenos">1661</span></a>                    <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
</span><span id="League.season_sims-1662"><a href="#League.season_sims-1662"><span class="linenos">1662</span></a>                    <span class="n">on</span><span class="o">=</span><span class="s2">&quot;team&quot;</span><span class="p">,</span>
</span><span id="League.season_sims-1663"><a href="#League.season_sims-1663"><span class="linenos">1663</span></a>                <span class="p">)</span>
</span><span id="League.season_sims-1664"><a href="#League.season_sims-1664"><span class="linenos">1664</span></a>                <span class="n">playoffs</span><span class="o">.</span><span class="n">points_avg</span> <span class="o">=</span> <span class="n">playoffs</span><span class="o">.</span><span class="n">points_avg</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="League.season_sims-1665"><a href="#League.season_sims-1665"><span class="linenos">1665</span></a>                <span class="n">playoffs</span><span class="o">.</span><span class="n">points_stdev</span> <span class="o">=</span> <span class="n">playoffs</span><span class="o">.</span><span class="n">points_stdev</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="League.season_sims-1666"><a href="#League.season_sims-1666"><span class="linenos">1666</span></a>                <span class="n">playoffs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">playoffs</span><span class="o">.</span><span class="n">seed</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;matchup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="League.season_sims-1667"><a href="#League.season_sims-1667"><span class="linenos">1667</span></a>                <span class="n">playoffs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">playoffs</span><span class="o">.</span><span class="n">seed</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;matchup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="League.season_sims-1668"><a href="#League.season_sims-1668"><span class="linenos">1668</span></a>                <span class="n">playoffs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">playoffs</span><span class="o">.</span><span class="n">seed</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">]),</span> <span class="s2">&quot;matchup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="League.season_sims-1669"><a href="#League.season_sims-1669"><span class="linenos">1669</span></a>                <span class="n">playoffs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">playoffs</span><span class="o">.</span><span class="n">seed</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]),</span> <span class="s2">&quot;matchup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
</span><span id="League.season_sims-1670"><a href="#League.season_sims-1670"><span class="linenos">1670</span></a>                <span class="n">playoffs</span><span class="p">[</span><span class="s2">&quot;sim&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League.season_sims-1671"><a href="#League.season_sims-1671"><span class="linenos">1671</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">playoffs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="League.season_sims-1672"><a href="#League.season_sims-1672"><span class="linenos">1672</span></a>                    <span class="o">*</span> <span class="n">playoffs</span><span class="o">.</span><span class="n">points_stdev</span>
</span><span id="League.season_sims-1673"><a href="#League.season_sims-1673"><span class="linenos">1673</span></a>                    <span class="o">+</span> <span class="n">playoffs</span><span class="o">.</span><span class="n">points_avg</span>
</span><span id="League.season_sims-1674"><a href="#League.season_sims-1674"><span class="linenos">1674</span></a>                    <span class="o">+</span> <span class="n">playoffs</span><span class="o">.</span><span class="n">score</span>
</span><span id="League.season_sims-1675"><a href="#League.season_sims-1675"><span class="linenos">1675</span></a>                <span class="p">)</span>
</span><span id="League.season_sims-1676"><a href="#League.season_sims-1676"><span class="linenos">1676</span></a>                <span class="n">playoffs</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League.season_sims-1677"><a href="#League.season_sims-1677"><span class="linenos">1677</span></a>                    <span class="n">playoffs</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
</span><span id="League.season_sims-1678"><a href="#League.season_sims-1678"><span class="linenos">1678</span></a>                        <span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;num_sim&quot;</span><span class="p">,</span> <span class="s2">&quot;matchup&quot;</span><span class="p">,</span> <span class="s2">&quot;sim&quot;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]</span>
</span><span id="League.season_sims-1679"><a href="#League.season_sims-1679"><span class="linenos">1679</span></a>                    <span class="p">)</span>
</span><span id="League.season_sims-1680"><a href="#League.season_sims-1680"><span class="linenos">1680</span></a>                    <span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;num_sim&quot;</span><span class="p">,</span> <span class="s2">&quot;matchup&quot;</span><span class="p">],</span> <span class="n">keep</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)</span>
</span><span id="League.season_sims-1681"><a href="#League.season_sims-1681"><span class="linenos">1681</span></a>                    <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="League.season_sims-1682"><a href="#League.season_sims-1682"><span class="linenos">1682</span></a>                <span class="p">)</span>
</span><span id="League.season_sims-1683"><a href="#League.season_sims-1683"><span class="linenos">1683</span></a>                <span class="k">del</span> <span class="p">(</span>
</span><span id="League.season_sims-1684"><a href="#League.season_sims-1684"><span class="linenos">1684</span></a>                    <span class="n">playoffs</span><span class="p">[</span><span class="s2">&quot;matchup&quot;</span><span class="p">],</span>
</span><span id="League.season_sims-1685"><a href="#League.season_sims-1685"><span class="linenos">1685</span></a>                    <span class="n">playoffs</span><span class="p">[</span><span class="s2">&quot;sim&quot;</span><span class="p">],</span>
</span><span id="League.season_sims-1686"><a href="#League.season_sims-1686"><span class="linenos">1686</span></a>                    <span class="n">playoffs</span><span class="p">[</span><span class="s2">&quot;score&quot;</span><span class="p">],</span>
</span><span id="League.season_sims-1687"><a href="#League.season_sims-1687"><span class="linenos">1687</span></a>                    <span class="n">playoffs</span><span class="p">[</span><span class="s2">&quot;points_avg&quot;</span><span class="p">],</span>
</span><span id="League.season_sims-1688"><a href="#League.season_sims-1688"><span class="linenos">1688</span></a>                    <span class="n">playoffs</span><span class="p">[</span><span class="s2">&quot;points_stdev&quot;</span><span class="p">],</span>
</span><span id="League.season_sims-1689"><a href="#League.season_sims-1689"><span class="linenos">1689</span></a>                <span class="p">)</span>
</span><span id="League.season_sims-1690"><a href="#League.season_sims-1690"><span class="linenos">1690</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;uses_playoff_reseeding&quot;</span><span class="p">]:</span>
</span><span id="League.season_sims-1691"><a href="#League.season_sims-1691"><span class="linenos">1691</span></a>                    <span class="n">playoffs</span> <span class="o">=</span> <span class="n">playoffs</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
</span><span id="League.season_sims-1692"><a href="#League.season_sims-1692"><span class="linenos">1692</span></a>                        <span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;num_sim&quot;</span><span class="p">,</span> <span class="s2">&quot;seed&quot;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span>
</span><span id="League.season_sims-1693"><a href="#League.season_sims-1693"><span class="linenos">1693</span></a>                    <span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="League.season_sims-1694"><a href="#League.season_sims-1694"><span class="linenos">1694</span></a>                <span class="k">if</span> <span class="n">algorithm</span><span class="p">:</span>
</span><span id="League.season_sims-1695"><a href="#League.season_sims-1695"><span class="linenos">1695</span></a>                    <span class="n">many_mile</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League.season_sims-1696"><a href="#League.season_sims-1696"><span class="linenos">1696</span></a>                        <span class="n">left</span><span class="o">=</span><span class="n">many_mile</span><span class="p">,</span>
</span><span id="League.season_sims-1697"><a href="#League.season_sims-1697"><span class="linenos">1697</span></a>                        <span class="n">right</span><span class="o">=</span><span class="n">scores</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League.season_sims-1698"><a href="#League.season_sims-1698"><span class="linenos">1698</span></a>                            <span class="n">scores</span><span class="o">.</span><span class="n">week</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;playoff_start_week&quot;</span><span class="p">],</span>
</span><span id="League.season_sims-1699"><a href="#League.season_sims-1699"><span class="linenos">1699</span></a>                            <span class="p">[</span><span class="s2">&quot;team&quot;</span><span class="p">,</span> <span class="s2">&quot;score&quot;</span><span class="p">],</span>
</span><span id="League.season_sims-1700"><a href="#League.season_sims-1700"><span class="linenos">1700</span></a>                        <span class="p">],</span>
</span><span id="League.season_sims-1701"><a href="#League.season_sims-1701"><span class="linenos">1701</span></a>                        <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
</span><span id="League.season_sims-1702"><a href="#League.season_sims-1702"><span class="linenos">1702</span></a>                        <span class="n">on</span><span class="o">=</span><span class="s2">&quot;team&quot;</span><span class="p">,</span>
</span><span id="League.season_sims-1703"><a href="#League.season_sims-1703"><span class="linenos">1703</span></a>                    <span class="p">)</span>
</span><span id="League.season_sims-1704"><a href="#League.season_sims-1704"><span class="linenos">1704</span></a>                    <span class="n">many_mile</span><span class="o">.</span><span class="n">score</span> <span class="o">=</span> <span class="n">many_mile</span><span class="o">.</span><span class="n">score</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="League.season_sims-1705"><a href="#League.season_sims-1705"><span class="linenos">1705</span></a>                    <span class="n">many_mile</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League.season_sims-1706"><a href="#League.season_sims-1706"><span class="linenos">1706</span></a>                        <span class="n">left</span><span class="o">=</span><span class="n">many_mile</span><span class="p">,</span>
</span><span id="League.season_sims-1707"><a href="#League.season_sims-1707"><span class="linenos">1707</span></a>                        <span class="n">right</span><span class="o">=</span><span class="n">projections</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League.season_sims-1708"><a href="#League.season_sims-1708"><span class="linenos">1708</span></a>                            <span class="n">projections</span><span class="o">.</span><span class="n">week</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;playoff_start_week&quot;</span><span class="p">],</span>
</span><span id="League.season_sims-1709"><a href="#League.season_sims-1709"><span class="linenos">1709</span></a>                            <span class="p">[</span><span class="s2">&quot;fantasy_team&quot;</span><span class="p">,</span> <span class="s2">&quot;points_avg&quot;</span><span class="p">,</span> <span class="s2">&quot;points_stdev&quot;</span><span class="p">],</span>
</span><span id="League.season_sims-1710"><a href="#League.season_sims-1710"><span class="linenos">1710</span></a>                        <span class="p">]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;fantasy_team&quot;</span><span class="p">:</span> <span class="s2">&quot;team&quot;</span><span class="p">}),</span>
</span><span id="League.season_sims-1711"><a href="#League.season_sims-1711"><span class="linenos">1711</span></a>                        <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
</span><span id="League.season_sims-1712"><a href="#League.season_sims-1712"><span class="linenos">1712</span></a>                        <span class="n">on</span><span class="o">=</span><span class="s2">&quot;team&quot;</span><span class="p">,</span>
</span><span id="League.season_sims-1713"><a href="#League.season_sims-1713"><span class="linenos">1713</span></a>                    <span class="p">)</span>
</span><span id="League.season_sims-1714"><a href="#League.season_sims-1714"><span class="linenos">1714</span></a>                    <span class="n">many_mile</span><span class="o">.</span><span class="n">points_avg</span> <span class="o">=</span> <span class="n">many_mile</span><span class="o">.</span><span class="n">points_avg</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="League.season_sims-1715"><a href="#League.season_sims-1715"><span class="linenos">1715</span></a>                    <span class="n">many_mile</span><span class="o">.</span><span class="n">points_stdev</span> <span class="o">=</span> <span class="n">many_mile</span><span class="o">.</span><span class="n">points_stdev</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="League.season_sims-1716"><a href="#League.season_sims-1716"><span class="linenos">1716</span></a>                    <span class="n">many_mile</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">many_mile</span><span class="o">.</span><span class="n">seed</span> <span class="o">==</span> <span class="mi">11</span><span class="p">,</span> <span class="s2">&quot;matchup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="League.season_sims-1717"><a href="#League.season_sims-1717"><span class="linenos">1717</span></a>                    <span class="n">many_mile</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">many_mile</span><span class="o">.</span><span class="n">seed</span> <span class="o">==</span> <span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;matchup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="League.season_sims-1718"><a href="#League.season_sims-1718"><span class="linenos">1718</span></a>                    <span class="n">many_mile</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">many_mile</span><span class="o">.</span><span class="n">seed</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">6</span><span class="p">,</span> <span class="mi">9</span><span class="p">]),</span> <span class="s2">&quot;matchup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="League.season_sims-1719"><a href="#League.season_sims-1719"><span class="linenos">1719</span></a>                    <span class="n">many_mile</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">many_mile</span><span class="o">.</span><span class="n">seed</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">]),</span> <span class="s2">&quot;matchup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
</span><span id="League.season_sims-1720"><a href="#League.season_sims-1720"><span class="linenos">1720</span></a>                    <span class="n">many_mile</span><span class="p">[</span><span class="s2">&quot;sim&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League.season_sims-1721"><a href="#League.season_sims-1721"><span class="linenos">1721</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">many_mile</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="League.season_sims-1722"><a href="#League.season_sims-1722"><span class="linenos">1722</span></a>                        <span class="o">*</span> <span class="n">many_mile</span><span class="o">.</span><span class="n">points_stdev</span>
</span><span id="League.season_sims-1723"><a href="#League.season_sims-1723"><span class="linenos">1723</span></a>                        <span class="o">+</span> <span class="n">many_mile</span><span class="o">.</span><span class="n">points_avg</span>
</span><span id="League.season_sims-1724"><a href="#League.season_sims-1724"><span class="linenos">1724</span></a>                        <span class="o">+</span> <span class="n">many_mile</span><span class="o">.</span><span class="n">score</span>
</span><span id="League.season_sims-1725"><a href="#League.season_sims-1725"><span class="linenos">1725</span></a>                    <span class="p">)</span>
</span><span id="League.season_sims-1726"><a href="#League.season_sims-1726"><span class="linenos">1726</span></a>                    <span class="n">many_mile</span> <span class="o">=</span> <span class="n">many_mile</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
</span><span id="League.season_sims-1727"><a href="#League.season_sims-1727"><span class="linenos">1727</span></a>                        <span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;num_sim&quot;</span><span class="p">,</span> <span class="s2">&quot;matchup&quot;</span><span class="p">,</span> <span class="s2">&quot;sim&quot;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span>
</span><span id="League.season_sims-1728"><a href="#League.season_sims-1728"><span class="linenos">1728</span></a>                    <span class="p">)</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;num_sim&quot;</span><span class="p">,</span> <span class="s2">&quot;matchup&quot;</span><span class="p">],</span> <span class="n">keep</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)</span>
</span><span id="League.season_sims-1729"><a href="#League.season_sims-1729"><span class="linenos">1729</span></a>                    <span class="k">del</span> <span class="p">(</span>
</span><span id="League.season_sims-1730"><a href="#League.season_sims-1730"><span class="linenos">1730</span></a>                        <span class="n">many_mile</span><span class="p">[</span><span class="s2">&quot;matchup&quot;</span><span class="p">],</span>
</span><span id="League.season_sims-1731"><a href="#League.season_sims-1731"><span class="linenos">1731</span></a>                        <span class="n">many_mile</span><span class="p">[</span><span class="s2">&quot;sim&quot;</span><span class="p">],</span>
</span><span id="League.season_sims-1732"><a href="#League.season_sims-1732"><span class="linenos">1732</span></a>                        <span class="n">many_mile</span><span class="p">[</span><span class="s2">&quot;score&quot;</span><span class="p">],</span>
</span><span id="League.season_sims-1733"><a href="#League.season_sims-1733"><span class="linenos">1733</span></a>                        <span class="n">many_mile</span><span class="p">[</span><span class="s2">&quot;points_avg&quot;</span><span class="p">],</span>
</span><span id="League.season_sims-1734"><a href="#League.season_sims-1734"><span class="linenos">1734</span></a>                        <span class="n">many_mile</span><span class="p">[</span><span class="s2">&quot;points_stdev&quot;</span><span class="p">],</span>
</span><span id="League.season_sims-1735"><a href="#League.season_sims-1735"><span class="linenos">1735</span></a>                    <span class="p">)</span>
</span><span id="League.season_sims-1736"><a href="#League.season_sims-1736"><span class="linenos">1736</span></a>            <span class="n">playoffs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League.season_sims-1737"><a href="#League.season_sims-1737"><span class="linenos">1737</span></a>                <span class="n">left</span><span class="o">=</span><span class="n">playoffs</span><span class="p">,</span>
</span><span id="League.season_sims-1738"><a href="#League.season_sims-1738"><span class="linenos">1738</span></a>                <span class="n">right</span><span class="o">=</span><span class="n">scores</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League.season_sims-1739"><a href="#League.season_sims-1739"><span class="linenos">1739</span></a>                    <span class="n">scores</span><span class="o">.</span><span class="n">week</span>
</span><span id="League.season_sims-1740"><a href="#League.season_sims-1740"><span class="linenos">1740</span></a>                    <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;playoff_start_week&quot;</span><span class="p">]</span>
</span><span id="League.season_sims-1741"><a href="#League.season_sims-1741"><span class="linenos">1741</span></a>                    <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;num_playoff_teams&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">6</span><span class="p">),</span>
</span><span id="League.season_sims-1742"><a href="#League.season_sims-1742"><span class="linenos">1742</span></a>                    <span class="p">[</span><span class="s2">&quot;team&quot;</span><span class="p">,</span> <span class="s2">&quot;score&quot;</span><span class="p">],</span>
</span><span id="League.season_sims-1743"><a href="#League.season_sims-1743"><span class="linenos">1743</span></a>                <span class="p">],</span>
</span><span id="League.season_sims-1744"><a href="#League.season_sims-1744"><span class="linenos">1744</span></a>                <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
</span><span id="League.season_sims-1745"><a href="#League.season_sims-1745"><span class="linenos">1745</span></a>                <span class="n">on</span><span class="o">=</span><span class="s2">&quot;team&quot;</span><span class="p">,</span>
</span><span id="League.season_sims-1746"><a href="#League.season_sims-1746"><span class="linenos">1746</span></a>            <span class="p">)</span>
</span><span id="League.season_sims-1747"><a href="#League.season_sims-1747"><span class="linenos">1747</span></a>            <span class="n">playoffs</span><span class="o">.</span><span class="n">score</span> <span class="o">=</span> <span class="n">playoffs</span><span class="o">.</span><span class="n">score</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="League.season_sims-1748"><a href="#League.season_sims-1748"><span class="linenos">1748</span></a>            <span class="n">playoffs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League.season_sims-1749"><a href="#League.season_sims-1749"><span class="linenos">1749</span></a>                <span class="n">left</span><span class="o">=</span><span class="n">playoffs</span><span class="p">,</span>
</span><span id="League.season_sims-1750"><a href="#League.season_sims-1750"><span class="linenos">1750</span></a>                <span class="n">right</span><span class="o">=</span><span class="n">projections</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League.season_sims-1751"><a href="#League.season_sims-1751"><span class="linenos">1751</span></a>                    <span class="n">projections</span><span class="o">.</span><span class="n">week</span>
</span><span id="League.season_sims-1752"><a href="#League.season_sims-1752"><span class="linenos">1752</span></a>                    <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;playoff_start_week&quot;</span><span class="p">]</span>
</span><span id="League.season_sims-1753"><a href="#League.season_sims-1753"><span class="linenos">1753</span></a>                    <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;num_playoff_teams&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">6</span><span class="p">),</span>
</span><span id="League.season_sims-1754"><a href="#League.season_sims-1754"><span class="linenos">1754</span></a>                    <span class="p">[</span><span class="s2">&quot;fantasy_team&quot;</span><span class="p">,</span> <span class="s2">&quot;points_avg&quot;</span><span class="p">,</span> <span class="s2">&quot;points_stdev&quot;</span><span class="p">],</span>
</span><span id="League.season_sims-1755"><a href="#League.season_sims-1755"><span class="linenos">1755</span></a>                <span class="p">]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;fantasy_team&quot;</span><span class="p">:</span> <span class="s2">&quot;team&quot;</span><span class="p">}),</span>
</span><span id="League.season_sims-1756"><a href="#League.season_sims-1756"><span class="linenos">1756</span></a>                <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
</span><span id="League.season_sims-1757"><a href="#League.season_sims-1757"><span class="linenos">1757</span></a>                <span class="n">on</span><span class="o">=</span><span class="s2">&quot;team&quot;</span><span class="p">,</span>
</span><span id="League.season_sims-1758"><a href="#League.season_sims-1758"><span class="linenos">1758</span></a>            <span class="p">)</span>
</span><span id="League.season_sims-1759"><a href="#League.season_sims-1759"><span class="linenos">1759</span></a>            <span class="n">playoffs</span><span class="o">.</span><span class="n">points_avg</span> <span class="o">=</span> <span class="n">playoffs</span><span class="o">.</span><span class="n">points_avg</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="League.season_sims-1760"><a href="#League.season_sims-1760"><span class="linenos">1760</span></a>            <span class="n">playoffs</span><span class="o">.</span><span class="n">points_stdev</span> <span class="o">=</span> <span class="n">playoffs</span><span class="o">.</span><span class="n">points_stdev</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="League.season_sims-1761"><a href="#League.season_sims-1761"><span class="linenos">1761</span></a>            <span class="n">playoffs</span><span class="p">[</span><span class="s2">&quot;seed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">playoffs</span><span class="o">.</span><span class="n">index</span> <span class="o">%</span> <span class="mi">4</span>
</span><span id="League.season_sims-1762"><a href="#League.season_sims-1762"><span class="linenos">1762</span></a>            <span class="n">playoffs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">playoffs</span><span class="o">.</span><span class="n">seed</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">]),</span> <span class="s2">&quot;matchup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="League.season_sims-1763"><a href="#League.season_sims-1763"><span class="linenos">1763</span></a>            <span class="n">playoffs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">playoffs</span><span class="o">.</span><span class="n">seed</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]),</span> <span class="s2">&quot;matchup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="League.season_sims-1764"><a href="#League.season_sims-1764"><span class="linenos">1764</span></a>            <span class="n">playoffs</span><span class="p">[</span><span class="s2">&quot;sim&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League.season_sims-1765"><a href="#League.season_sims-1765"><span class="linenos">1765</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">playoffs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="League.season_sims-1766"><a href="#League.season_sims-1766"><span class="linenos">1766</span></a>                <span class="o">*</span> <span class="n">playoffs</span><span class="o">.</span><span class="n">points_stdev</span>
</span><span id="League.season_sims-1767"><a href="#League.season_sims-1767"><span class="linenos">1767</span></a>                <span class="o">+</span> <span class="n">playoffs</span><span class="o">.</span><span class="n">points_avg</span>
</span><span id="League.season_sims-1768"><a href="#League.season_sims-1768"><span class="linenos">1768</span></a>                <span class="o">+</span> <span class="n">playoffs</span><span class="o">.</span><span class="n">score</span>
</span><span id="League.season_sims-1769"><a href="#League.season_sims-1769"><span class="linenos">1769</span></a>            <span class="p">)</span>
</span><span id="League.season_sims-1770"><a href="#League.season_sims-1770"><span class="linenos">1770</span></a>            <span class="n">consolation</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League.season_sims-1771"><a href="#League.season_sims-1771"><span class="linenos">1771</span></a>                <span class="n">playoffs</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;num_sim&quot;</span><span class="p">,</span> <span class="s2">&quot;matchup&quot;</span><span class="p">,</span> <span class="s2">&quot;sim&quot;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="League.season_sims-1772"><a href="#League.season_sims-1772"><span class="linenos">1772</span></a>                <span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;num_sim&quot;</span><span class="p">,</span> <span class="s2">&quot;matchup&quot;</span><span class="p">],</span> <span class="n">keep</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)</span>
</span><span id="League.season_sims-1773"><a href="#League.season_sims-1773"><span class="linenos">1773</span></a>                <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="League.season_sims-1774"><a href="#League.season_sims-1774"><span class="linenos">1774</span></a>            <span class="p">)</span>
</span><span id="League.season_sims-1775"><a href="#League.season_sims-1775"><span class="linenos">1775</span></a>            <span class="n">playoffs</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League.season_sims-1776"><a href="#League.season_sims-1776"><span class="linenos">1776</span></a>                <span class="n">playoffs</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
</span><span id="League.season_sims-1777"><a href="#League.season_sims-1777"><span class="linenos">1777</span></a>                    <span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;num_sim&quot;</span><span class="p">,</span> <span class="s2">&quot;matchup&quot;</span><span class="p">,</span> <span class="s2">&quot;sim&quot;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]</span>
</span><span id="League.season_sims-1778"><a href="#League.season_sims-1778"><span class="linenos">1778</span></a>                <span class="p">)</span>
</span><span id="League.season_sims-1779"><a href="#League.season_sims-1779"><span class="linenos">1779</span></a>                <span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;num_sim&quot;</span><span class="p">,</span> <span class="s2">&quot;matchup&quot;</span><span class="p">],</span> <span class="n">keep</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)</span>
</span><span id="League.season_sims-1780"><a href="#League.season_sims-1780"><span class="linenos">1780</span></a>                <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="League.season_sims-1781"><a href="#League.season_sims-1781"><span class="linenos">1781</span></a>            <span class="p">)</span>
</span><span id="League.season_sims-1782"><a href="#League.season_sims-1782"><span class="linenos">1782</span></a>            <span class="k">del</span> <span class="p">(</span>
</span><span id="League.season_sims-1783"><a href="#League.season_sims-1783"><span class="linenos">1783</span></a>                <span class="n">playoffs</span><span class="p">[</span><span class="s2">&quot;matchup&quot;</span><span class="p">],</span>
</span><span id="League.season_sims-1784"><a href="#League.season_sims-1784"><span class="linenos">1784</span></a>                <span class="n">playoffs</span><span class="p">[</span><span class="s2">&quot;sim&quot;</span><span class="p">],</span>
</span><span id="League.season_sims-1785"><a href="#League.season_sims-1785"><span class="linenos">1785</span></a>                <span class="n">playoffs</span><span class="p">[</span><span class="s2">&quot;score&quot;</span><span class="p">],</span>
</span><span id="League.season_sims-1786"><a href="#League.season_sims-1786"><span class="linenos">1786</span></a>                <span class="n">playoffs</span><span class="p">[</span><span class="s2">&quot;points_avg&quot;</span><span class="p">],</span>
</span><span id="League.season_sims-1787"><a href="#League.season_sims-1787"><span class="linenos">1787</span></a>                <span class="n">playoffs</span><span class="p">[</span><span class="s2">&quot;points_stdev&quot;</span><span class="p">],</span>
</span><span id="League.season_sims-1788"><a href="#League.season_sims-1788"><span class="linenos">1788</span></a>                <span class="n">consolation</span><span class="p">[</span><span class="s2">&quot;matchup&quot;</span><span class="p">],</span>
</span><span id="League.season_sims-1789"><a href="#League.season_sims-1789"><span class="linenos">1789</span></a>                <span class="n">consolation</span><span class="p">[</span><span class="s2">&quot;sim&quot;</span><span class="p">],</span>
</span><span id="League.season_sims-1790"><a href="#League.season_sims-1790"><span class="linenos">1790</span></a>                <span class="n">consolation</span><span class="p">[</span><span class="s2">&quot;score&quot;</span><span class="p">],</span>
</span><span id="League.season_sims-1791"><a href="#League.season_sims-1791"><span class="linenos">1791</span></a>                <span class="n">consolation</span><span class="p">[</span><span class="s2">&quot;points_avg&quot;</span><span class="p">],</span>
</span><span id="League.season_sims-1792"><a href="#League.season_sims-1792"><span class="linenos">1792</span></a>                <span class="n">consolation</span><span class="p">[</span><span class="s2">&quot;points_stdev&quot;</span><span class="p">],</span>
</span><span id="League.season_sims-1793"><a href="#League.season_sims-1793"><span class="linenos">1793</span></a>            <span class="p">)</span>
</span><span id="League.season_sims-1794"><a href="#League.season_sims-1794"><span class="linenos">1794</span></a>            <span class="k">if</span> <span class="n">algorithm</span><span class="p">:</span>
</span><span id="League.season_sims-1795"><a href="#League.season_sims-1795"><span class="linenos">1795</span></a>                <span class="n">many_mile</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League.season_sims-1796"><a href="#League.season_sims-1796"><span class="linenos">1796</span></a>                    <span class="n">left</span><span class="o">=</span><span class="n">many_mile</span><span class="p">,</span>
</span><span id="League.season_sims-1797"><a href="#League.season_sims-1797"><span class="linenos">1797</span></a>                    <span class="n">right</span><span class="o">=</span><span class="n">scores</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League.season_sims-1798"><a href="#League.season_sims-1798"><span class="linenos">1798</span></a>                        <span class="n">scores</span><span class="o">.</span><span class="n">week</span>
</span><span id="League.season_sims-1799"><a href="#League.season_sims-1799"><span class="linenos">1799</span></a>                        <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;playoff_start_week&quot;</span><span class="p">]</span>
</span><span id="League.season_sims-1800"><a href="#League.season_sims-1800"><span class="linenos">1800</span></a>                        <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;num_playoff_teams&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">6</span><span class="p">),</span>
</span><span id="League.season_sims-1801"><a href="#League.season_sims-1801"><span class="linenos">1801</span></a>                        <span class="p">[</span><span class="s2">&quot;team&quot;</span><span class="p">,</span> <span class="s2">&quot;score&quot;</span><span class="p">],</span>
</span><span id="League.season_sims-1802"><a href="#League.season_sims-1802"><span class="linenos">1802</span></a>                    <span class="p">],</span>
</span><span id="League.season_sims-1803"><a href="#League.season_sims-1803"><span class="linenos">1803</span></a>                    <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
</span><span id="League.season_sims-1804"><a href="#League.season_sims-1804"><span class="linenos">1804</span></a>                    <span class="n">on</span><span class="o">=</span><span class="s2">&quot;team&quot;</span><span class="p">,</span>
</span><span id="League.season_sims-1805"><a href="#League.season_sims-1805"><span class="linenos">1805</span></a>                <span class="p">)</span>
</span><span id="League.season_sims-1806"><a href="#League.season_sims-1806"><span class="linenos">1806</span></a>                <span class="n">many_mile</span><span class="o">.</span><span class="n">score</span> <span class="o">=</span> <span class="n">many_mile</span><span class="o">.</span><span class="n">score</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="League.season_sims-1807"><a href="#League.season_sims-1807"><span class="linenos">1807</span></a>                <span class="n">many_mile</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League.season_sims-1808"><a href="#League.season_sims-1808"><span class="linenos">1808</span></a>                    <span class="n">left</span><span class="o">=</span><span class="n">many_mile</span><span class="p">,</span>
</span><span id="League.season_sims-1809"><a href="#League.season_sims-1809"><span class="linenos">1809</span></a>                    <span class="n">right</span><span class="o">=</span><span class="n">projections</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League.season_sims-1810"><a href="#League.season_sims-1810"><span class="linenos">1810</span></a>                        <span class="n">projections</span><span class="o">.</span><span class="n">week</span>
</span><span id="League.season_sims-1811"><a href="#League.season_sims-1811"><span class="linenos">1811</span></a>                        <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;playoff_start_week&quot;</span><span class="p">]</span>
</span><span id="League.season_sims-1812"><a href="#League.season_sims-1812"><span class="linenos">1812</span></a>                        <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;num_playoff_teams&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">6</span><span class="p">),</span>
</span><span id="League.season_sims-1813"><a href="#League.season_sims-1813"><span class="linenos">1813</span></a>                        <span class="p">[</span><span class="s2">&quot;fantasy_team&quot;</span><span class="p">,</span> <span class="s2">&quot;points_avg&quot;</span><span class="p">,</span> <span class="s2">&quot;points_stdev&quot;</span><span class="p">],</span>
</span><span id="League.season_sims-1814"><a href="#League.season_sims-1814"><span class="linenos">1814</span></a>                    <span class="p">]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;fantasy_team&quot;</span><span class="p">:</span> <span class="s2">&quot;team&quot;</span><span class="p">}),</span>
</span><span id="League.season_sims-1815"><a href="#League.season_sims-1815"><span class="linenos">1815</span></a>                    <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
</span><span id="League.season_sims-1816"><a href="#League.season_sims-1816"><span class="linenos">1816</span></a>                    <span class="n">on</span><span class="o">=</span><span class="s2">&quot;team&quot;</span><span class="p">,</span>
</span><span id="League.season_sims-1817"><a href="#League.season_sims-1817"><span class="linenos">1817</span></a>                <span class="p">)</span>
</span><span id="League.season_sims-1818"><a href="#League.season_sims-1818"><span class="linenos">1818</span></a>                <span class="n">many_mile</span><span class="o">.</span><span class="n">points_avg</span> <span class="o">=</span> <span class="n">many_mile</span><span class="o">.</span><span class="n">points_avg</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="League.season_sims-1819"><a href="#League.season_sims-1819"><span class="linenos">1819</span></a>                <span class="n">many_mile</span><span class="o">.</span><span class="n">points_stdev</span> <span class="o">=</span> <span class="n">many_mile</span><span class="o">.</span><span class="n">points_stdev</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="League.season_sims-1820"><a href="#League.season_sims-1820"><span class="linenos">1820</span></a>                <span class="n">many_mile</span><span class="p">[</span><span class="s2">&quot;seed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">many_mile</span><span class="o">.</span><span class="n">index</span> <span class="o">%</span> <span class="mi">4</span>
</span><span id="League.season_sims-1821"><a href="#League.season_sims-1821"><span class="linenos">1821</span></a>                <span class="n">many_mile</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">many_mile</span><span class="o">.</span><span class="n">seed</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">]),</span> <span class="s2">&quot;matchup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="League.season_sims-1822"><a href="#League.season_sims-1822"><span class="linenos">1822</span></a>                <span class="n">many_mile</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">many_mile</span><span class="o">.</span><span class="n">seed</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]),</span> <span class="s2">&quot;matchup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="League.season_sims-1823"><a href="#League.season_sims-1823"><span class="linenos">1823</span></a>                <span class="n">many_mile</span><span class="p">[</span><span class="s2">&quot;sim&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League.season_sims-1824"><a href="#League.season_sims-1824"><span class="linenos">1824</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">many_mile</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="League.season_sims-1825"><a href="#League.season_sims-1825"><span class="linenos">1825</span></a>                    <span class="o">*</span> <span class="n">many_mile</span><span class="o">.</span><span class="n">points_stdev</span>
</span><span id="League.season_sims-1826"><a href="#League.season_sims-1826"><span class="linenos">1826</span></a>                    <span class="o">+</span> <span class="n">many_mile</span><span class="o">.</span><span class="n">points_avg</span>
</span><span id="League.season_sims-1827"><a href="#League.season_sims-1827"><span class="linenos">1827</span></a>                    <span class="o">+</span> <span class="n">many_mile</span><span class="o">.</span><span class="n">score</span>
</span><span id="League.season_sims-1828"><a href="#League.season_sims-1828"><span class="linenos">1828</span></a>                <span class="p">)</span>
</span><span id="League.season_sims-1829"><a href="#League.season_sims-1829"><span class="linenos">1829</span></a>                <span class="n">many_mile</span> <span class="o">=</span> <span class="n">many_mile</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
</span><span id="League.season_sims-1830"><a href="#League.season_sims-1830"><span class="linenos">1830</span></a>                    <span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;num_sim&quot;</span><span class="p">,</span> <span class="s2">&quot;matchup&quot;</span><span class="p">,</span> <span class="s2">&quot;sim&quot;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span>
</span><span id="League.season_sims-1831"><a href="#League.season_sims-1831"><span class="linenos">1831</span></a>                <span class="p">)</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;num_sim&quot;</span><span class="p">,</span> <span class="s2">&quot;matchup&quot;</span><span class="p">],</span> <span class="n">keep</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)</span>
</span><span id="League.season_sims-1832"><a href="#League.season_sims-1832"><span class="linenos">1832</span></a>                <span class="k">del</span> <span class="p">(</span>
</span><span id="League.season_sims-1833"><a href="#League.season_sims-1833"><span class="linenos">1833</span></a>                    <span class="n">many_mile</span><span class="p">[</span><span class="s2">&quot;matchup&quot;</span><span class="p">],</span>
</span><span id="League.season_sims-1834"><a href="#League.season_sims-1834"><span class="linenos">1834</span></a>                    <span class="n">many_mile</span><span class="p">[</span><span class="s2">&quot;sim&quot;</span><span class="p">],</span>
</span><span id="League.season_sims-1835"><a href="#League.season_sims-1835"><span class="linenos">1835</span></a>                    <span class="n">many_mile</span><span class="p">[</span><span class="s2">&quot;score&quot;</span><span class="p">],</span>
</span><span id="League.season_sims-1836"><a href="#League.season_sims-1836"><span class="linenos">1836</span></a>                    <span class="n">many_mile</span><span class="p">[</span><span class="s2">&quot;points_avg&quot;</span><span class="p">],</span>
</span><span id="League.season_sims-1837"><a href="#League.season_sims-1837"><span class="linenos">1837</span></a>                    <span class="n">many_mile</span><span class="p">[</span><span class="s2">&quot;points_stdev&quot;</span><span class="p">],</span>
</span><span id="League.season_sims-1838"><a href="#League.season_sims-1838"><span class="linenos">1838</span></a>                <span class="p">)</span>
</span><span id="League.season_sims-1839"><a href="#League.season_sims-1839"><span class="linenos">1839</span></a>            <span class="n">playoffs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League.season_sims-1840"><a href="#League.season_sims-1840"><span class="linenos">1840</span></a>                <span class="n">left</span><span class="o">=</span><span class="n">playoffs</span><span class="p">,</span>
</span><span id="League.season_sims-1841"><a href="#League.season_sims-1841"><span class="linenos">1841</span></a>                <span class="n">right</span><span class="o">=</span><span class="n">scores</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League.season_sims-1842"><a href="#League.season_sims-1842"><span class="linenos">1842</span></a>                    <span class="n">scores</span><span class="o">.</span><span class="n">week</span>
</span><span id="League.season_sims-1843"><a href="#League.season_sims-1843"><span class="linenos">1843</span></a>                    <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;playoff_start_week&quot;</span><span class="p">]</span>
</span><span id="League.season_sims-1844"><a href="#League.season_sims-1844"><span class="linenos">1844</span></a>                    <span class="o">+</span> <span class="mi">1</span>
</span><span id="League.season_sims-1845"><a href="#League.season_sims-1845"><span class="linenos">1845</span></a>                    <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;num_playoff_teams&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">6</span><span class="p">),</span>
</span><span id="League.season_sims-1846"><a href="#League.season_sims-1846"><span class="linenos">1846</span></a>                    <span class="p">[</span><span class="s2">&quot;team&quot;</span><span class="p">,</span> <span class="s2">&quot;score&quot;</span><span class="p">],</span>
</span><span id="League.season_sims-1847"><a href="#League.season_sims-1847"><span class="linenos">1847</span></a>                <span class="p">],</span>
</span><span id="League.season_sims-1848"><a href="#League.season_sims-1848"><span class="linenos">1848</span></a>                <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
</span><span id="League.season_sims-1849"><a href="#League.season_sims-1849"><span class="linenos">1849</span></a>                <span class="n">on</span><span class="o">=</span><span class="s2">&quot;team&quot;</span><span class="p">,</span>
</span><span id="League.season_sims-1850"><a href="#League.season_sims-1850"><span class="linenos">1850</span></a>            <span class="p">)</span>
</span><span id="League.season_sims-1851"><a href="#League.season_sims-1851"><span class="linenos">1851</span></a>            <span class="n">playoffs</span><span class="o">.</span><span class="n">score</span> <span class="o">=</span> <span class="n">playoffs</span><span class="o">.</span><span class="n">score</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="League.season_sims-1852"><a href="#League.season_sims-1852"><span class="linenos">1852</span></a>            <span class="n">playoffs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League.season_sims-1853"><a href="#League.season_sims-1853"><span class="linenos">1853</span></a>                <span class="n">left</span><span class="o">=</span><span class="n">playoffs</span><span class="p">,</span>
</span><span id="League.season_sims-1854"><a href="#League.season_sims-1854"><span class="linenos">1854</span></a>                <span class="n">right</span><span class="o">=</span><span class="n">projections</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League.season_sims-1855"><a href="#League.season_sims-1855"><span class="linenos">1855</span></a>                    <span class="n">projections</span><span class="o">.</span><span class="n">week</span>
</span><span id="League.season_sims-1856"><a href="#League.season_sims-1856"><span class="linenos">1856</span></a>                    <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;playoff_start_week&quot;</span><span class="p">]</span>
</span><span id="League.season_sims-1857"><a href="#League.season_sims-1857"><span class="linenos">1857</span></a>                    <span class="o">+</span> <span class="mi">1</span>
</span><span id="League.season_sims-1858"><a href="#League.season_sims-1858"><span class="linenos">1858</span></a>                    <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;num_playoff_teams&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">6</span><span class="p">),</span>
</span><span id="League.season_sims-1859"><a href="#League.season_sims-1859"><span class="linenos">1859</span></a>                    <span class="p">[</span><span class="s2">&quot;fantasy_team&quot;</span><span class="p">,</span> <span class="s2">&quot;points_avg&quot;</span><span class="p">,</span> <span class="s2">&quot;points_stdev&quot;</span><span class="p">],</span>
</span><span id="League.season_sims-1860"><a href="#League.season_sims-1860"><span class="linenos">1860</span></a>                <span class="p">]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;fantasy_team&quot;</span><span class="p">:</span> <span class="s2">&quot;team&quot;</span><span class="p">}),</span>
</span><span id="League.season_sims-1861"><a href="#League.season_sims-1861"><span class="linenos">1861</span></a>                <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
</span><span id="League.season_sims-1862"><a href="#League.season_sims-1862"><span class="linenos">1862</span></a>                <span class="n">on</span><span class="o">=</span><span class="s2">&quot;team&quot;</span><span class="p">,</span>
</span><span id="League.season_sims-1863"><a href="#League.season_sims-1863"><span class="linenos">1863</span></a>            <span class="p">)</span>
</span><span id="League.season_sims-1864"><a href="#League.season_sims-1864"><span class="linenos">1864</span></a>            <span class="n">playoffs</span><span class="o">.</span><span class="n">points_avg</span> <span class="o">=</span> <span class="n">playoffs</span><span class="o">.</span><span class="n">points_avg</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="League.season_sims-1865"><a href="#League.season_sims-1865"><span class="linenos">1865</span></a>            <span class="n">playoffs</span><span class="o">.</span><span class="n">points_stdev</span> <span class="o">=</span> <span class="n">playoffs</span><span class="o">.</span><span class="n">points_stdev</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="League.season_sims-1866"><a href="#League.season_sims-1866"><span class="linenos">1866</span></a>            <span class="n">playoffs</span><span class="p">[</span><span class="s2">&quot;sim&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League.season_sims-1867"><a href="#League.season_sims-1867"><span class="linenos">1867</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">playoffs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="League.season_sims-1868"><a href="#League.season_sims-1868"><span class="linenos">1868</span></a>                <span class="o">*</span> <span class="n">playoffs</span><span class="o">.</span><span class="n">points_stdev</span>
</span><span id="League.season_sims-1869"><a href="#League.season_sims-1869"><span class="linenos">1869</span></a>                <span class="o">+</span> <span class="n">playoffs</span><span class="o">.</span><span class="n">points_avg</span>
</span><span id="League.season_sims-1870"><a href="#League.season_sims-1870"><span class="linenos">1870</span></a>                <span class="o">+</span> <span class="n">playoffs</span><span class="o">.</span><span class="n">score</span>
</span><span id="League.season_sims-1871"><a href="#League.season_sims-1871"><span class="linenos">1871</span></a>            <span class="p">)</span>
</span><span id="League.season_sims-1872"><a href="#League.season_sims-1872"><span class="linenos">1872</span></a>            <span class="n">runner_up</span> <span class="o">=</span> <span class="n">playoffs</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
</span><span id="League.season_sims-1873"><a href="#League.season_sims-1873"><span class="linenos">1873</span></a>                <span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;num_sim&quot;</span><span class="p">,</span> <span class="s2">&quot;sim&quot;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span>
</span><span id="League.season_sims-1874"><a href="#League.season_sims-1874"><span class="linenos">1874</span></a>            <span class="p">)</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;num_sim&quot;</span><span class="p">],</span> <span class="n">keep</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)</span>
</span><span id="League.season_sims-1875"><a href="#League.season_sims-1875"><span class="linenos">1875</span></a>            <span class="n">winner</span> <span class="o">=</span> <span class="n">playoffs</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
</span><span id="League.season_sims-1876"><a href="#League.season_sims-1876"><span class="linenos">1876</span></a>                <span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;num_sim&quot;</span><span class="p">,</span> <span class="s2">&quot;sim&quot;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]</span>
</span><span id="League.season_sims-1877"><a href="#League.season_sims-1877"><span class="linenos">1877</span></a>            <span class="p">)</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;num_sim&quot;</span><span class="p">],</span> <span class="n">keep</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)</span>
</span><span id="League.season_sims-1878"><a href="#League.season_sims-1878"><span class="linenos">1878</span></a>            <span class="n">consolation</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League.season_sims-1879"><a href="#League.season_sims-1879"><span class="linenos">1879</span></a>                <span class="n">left</span><span class="o">=</span><span class="n">consolation</span><span class="p">,</span>
</span><span id="League.season_sims-1880"><a href="#League.season_sims-1880"><span class="linenos">1880</span></a>                <span class="n">right</span><span class="o">=</span><span class="n">scores</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League.season_sims-1881"><a href="#League.season_sims-1881"><span class="linenos">1881</span></a>                    <span class="n">scores</span><span class="o">.</span><span class="n">week</span>
</span><span id="League.season_sims-1882"><a href="#League.season_sims-1882"><span class="linenos">1882</span></a>                    <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;playoff_start_week&quot;</span><span class="p">]</span>
</span><span id="League.season_sims-1883"><a href="#League.season_sims-1883"><span class="linenos">1883</span></a>                    <span class="o">+</span> <span class="mi">1</span>
</span><span id="League.season_sims-1884"><a href="#League.season_sims-1884"><span class="linenos">1884</span></a>                    <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;num_playoff_teams&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">6</span><span class="p">),</span>
</span><span id="League.season_sims-1885"><a href="#League.season_sims-1885"><span class="linenos">1885</span></a>                    <span class="p">[</span><span class="s2">&quot;team&quot;</span><span class="p">,</span> <span class="s2">&quot;score&quot;</span><span class="p">],</span>
</span><span id="League.season_sims-1886"><a href="#League.season_sims-1886"><span class="linenos">1886</span></a>                <span class="p">],</span>
</span><span id="League.season_sims-1887"><a href="#League.season_sims-1887"><span class="linenos">1887</span></a>                <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
</span><span id="League.season_sims-1888"><a href="#League.season_sims-1888"><span class="linenos">1888</span></a>                <span class="n">on</span><span class="o">=</span><span class="s2">&quot;team&quot;</span><span class="p">,</span>
</span><span id="League.season_sims-1889"><a href="#League.season_sims-1889"><span class="linenos">1889</span></a>            <span class="p">)</span>
</span><span id="League.season_sims-1890"><a href="#League.season_sims-1890"><span class="linenos">1890</span></a>            <span class="n">consolation</span><span class="o">.</span><span class="n">score</span> <span class="o">=</span> <span class="n">consolation</span><span class="o">.</span><span class="n">score</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="League.season_sims-1891"><a href="#League.season_sims-1891"><span class="linenos">1891</span></a>            <span class="n">consolation</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League.season_sims-1892"><a href="#League.season_sims-1892"><span class="linenos">1892</span></a>                <span class="n">left</span><span class="o">=</span><span class="n">consolation</span><span class="p">,</span>
</span><span id="League.season_sims-1893"><a href="#League.season_sims-1893"><span class="linenos">1893</span></a>                <span class="n">right</span><span class="o">=</span><span class="n">projections</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League.season_sims-1894"><a href="#League.season_sims-1894"><span class="linenos">1894</span></a>                    <span class="n">projections</span><span class="o">.</span><span class="n">week</span>
</span><span id="League.season_sims-1895"><a href="#League.season_sims-1895"><span class="linenos">1895</span></a>                    <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;playoff_start_week&quot;</span><span class="p">]</span>
</span><span id="League.season_sims-1896"><a href="#League.season_sims-1896"><span class="linenos">1896</span></a>                    <span class="o">+</span> <span class="mi">1</span>
</span><span id="League.season_sims-1897"><a href="#League.season_sims-1897"><span class="linenos">1897</span></a>                    <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;num_playoff_teams&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">6</span><span class="p">),</span>
</span><span id="League.season_sims-1898"><a href="#League.season_sims-1898"><span class="linenos">1898</span></a>                    <span class="p">[</span><span class="s2">&quot;fantasy_team&quot;</span><span class="p">,</span> <span class="s2">&quot;points_avg&quot;</span><span class="p">,</span> <span class="s2">&quot;points_stdev&quot;</span><span class="p">],</span>
</span><span id="League.season_sims-1899"><a href="#League.season_sims-1899"><span class="linenos">1899</span></a>                <span class="p">]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;fantasy_team&quot;</span><span class="p">:</span> <span class="s2">&quot;team&quot;</span><span class="p">}),</span>
</span><span id="League.season_sims-1900"><a href="#League.season_sims-1900"><span class="linenos">1900</span></a>                <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">,</span>
</span><span id="League.season_sims-1901"><a href="#League.season_sims-1901"><span class="linenos">1901</span></a>                <span class="n">on</span><span class="o">=</span><span class="s2">&quot;team&quot;</span><span class="p">,</span>
</span><span id="League.season_sims-1902"><a href="#League.season_sims-1902"><span class="linenos">1902</span></a>            <span class="p">)</span>
</span><span id="League.season_sims-1903"><a href="#League.season_sims-1903"><span class="linenos">1903</span></a>            <span class="n">consolation</span><span class="p">[</span><span class="s2">&quot;sim&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League.season_sims-1904"><a href="#League.season_sims-1904"><span class="linenos">1904</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">consolation</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="League.season_sims-1905"><a href="#League.season_sims-1905"><span class="linenos">1905</span></a>                <span class="o">*</span> <span class="n">consolation</span><span class="o">.</span><span class="n">points_stdev</span>
</span><span id="League.season_sims-1906"><a href="#League.season_sims-1906"><span class="linenos">1906</span></a>                <span class="o">+</span> <span class="n">consolation</span><span class="o">.</span><span class="n">points_avg</span>
</span><span id="League.season_sims-1907"><a href="#League.season_sims-1907"><span class="linenos">1907</span></a>                <span class="o">+</span> <span class="n">consolation</span><span class="o">.</span><span class="n">score</span>
</span><span id="League.season_sims-1908"><a href="#League.season_sims-1908"><span class="linenos">1908</span></a>            <span class="p">)</span>
</span><span id="League.season_sims-1909"><a href="#League.season_sims-1909"><span class="linenos">1909</span></a>            <span class="n">third</span> <span class="o">=</span> <span class="n">consolation</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
</span><span id="League.season_sims-1910"><a href="#League.season_sims-1910"><span class="linenos">1910</span></a>                <span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;num_sim&quot;</span><span class="p">,</span> <span class="s2">&quot;sim&quot;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]</span>
</span><span id="League.season_sims-1911"><a href="#League.season_sims-1911"><span class="linenos">1911</span></a>            <span class="p">)</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;num_sim&quot;</span><span class="p">],</span> <span class="n">keep</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)</span>
</span><span id="League.season_sims-1912"><a href="#League.season_sims-1912"><span class="linenos">1912</span></a>            <span class="k">if</span> <span class="n">algorithm</span><span class="p">:</span>
</span><span id="League.season_sims-1913"><a href="#League.season_sims-1913"><span class="linenos">1913</span></a>                <span class="n">many_mile</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League.season_sims-1914"><a href="#League.season_sims-1914"><span class="linenos">1914</span></a>                    <span class="n">left</span><span class="o">=</span><span class="n">many_mile</span><span class="p">,</span>
</span><span id="League.season_sims-1915"><a href="#League.season_sims-1915"><span class="linenos">1915</span></a>                    <span class="n">right</span><span class="o">=</span><span class="n">scores</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League.season_sims-1916"><a href="#League.season_sims-1916"><span class="linenos">1916</span></a>                        <span class="n">scores</span><span class="o">.</span><span class="n">week</span>
</span><span id="League.season_sims-1917"><a href="#League.season_sims-1917"><span class="linenos">1917</span></a>                        <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;playoff_start_week&quot;</span><span class="p">]</span>
</span><span id="League.season_sims-1918"><a href="#League.season_sims-1918"><span class="linenos">1918</span></a>                        <span class="o">+</span> <span class="mi">1</span>
</span><span id="League.season_sims-1919"><a href="#League.season_sims-1919"><span class="linenos">1919</span></a>                        <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;num_playoff_teams&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">6</span><span class="p">),</span>
</span><span id="League.season_sims-1920"><a href="#League.season_sims-1920"><span class="linenos">1920</span></a>                        <span class="p">[</span><span class="s2">&quot;team&quot;</span><span class="p">,</span> <span class="s2">&quot;score&quot;</span><span class="p">],</span>
</span><span id="League.season_sims-1921"><a href="#League.season_sims-1921"><span class="linenos">1921</span></a>                    <span class="p">],</span>
</span><span id="League.season_sims-1922"><a href="#League.season_sims-1922"><span class="linenos">1922</span></a>                    <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
</span><span id="League.season_sims-1923"><a href="#League.season_sims-1923"><span class="linenos">1923</span></a>                    <span class="n">on</span><span class="o">=</span><span class="s2">&quot;team&quot;</span><span class="p">,</span>
</span><span id="League.season_sims-1924"><a href="#League.season_sims-1924"><span class="linenos">1924</span></a>                <span class="p">)</span>
</span><span id="League.season_sims-1925"><a href="#League.season_sims-1925"><span class="linenos">1925</span></a>                <span class="n">many_mile</span><span class="o">.</span><span class="n">score</span> <span class="o">=</span> <span class="n">many_mile</span><span class="o">.</span><span class="n">score</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="League.season_sims-1926"><a href="#League.season_sims-1926"><span class="linenos">1926</span></a>                <span class="n">many_mile</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League.season_sims-1927"><a href="#League.season_sims-1927"><span class="linenos">1927</span></a>                    <span class="n">left</span><span class="o">=</span><span class="n">many_mile</span><span class="p">,</span>
</span><span id="League.season_sims-1928"><a href="#League.season_sims-1928"><span class="linenos">1928</span></a>                    <span class="n">right</span><span class="o">=</span><span class="n">projections</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League.season_sims-1929"><a href="#League.season_sims-1929"><span class="linenos">1929</span></a>                        <span class="n">projections</span><span class="o">.</span><span class="n">week</span>
</span><span id="League.season_sims-1930"><a href="#League.season_sims-1930"><span class="linenos">1930</span></a>                        <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;playoff_start_week&quot;</span><span class="p">]</span>
</span><span id="League.season_sims-1931"><a href="#League.season_sims-1931"><span class="linenos">1931</span></a>                        <span class="o">+</span> <span class="mi">1</span>
</span><span id="League.season_sims-1932"><a href="#League.season_sims-1932"><span class="linenos">1932</span></a>                        <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;num_playoff_teams&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">6</span><span class="p">),</span>
</span><span id="League.season_sims-1933"><a href="#League.season_sims-1933"><span class="linenos">1933</span></a>                        <span class="p">[</span><span class="s2">&quot;fantasy_team&quot;</span><span class="p">,</span> <span class="s2">&quot;points_avg&quot;</span><span class="p">,</span> <span class="s2">&quot;points_stdev&quot;</span><span class="p">],</span>
</span><span id="League.season_sims-1934"><a href="#League.season_sims-1934"><span class="linenos">1934</span></a>                    <span class="p">]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;fantasy_team&quot;</span><span class="p">:</span> <span class="s2">&quot;team&quot;</span><span class="p">}),</span>
</span><span id="League.season_sims-1935"><a href="#League.season_sims-1935"><span class="linenos">1935</span></a>                    <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
</span><span id="League.season_sims-1936"><a href="#League.season_sims-1936"><span class="linenos">1936</span></a>                    <span class="n">on</span><span class="o">=</span><span class="s2">&quot;team&quot;</span><span class="p">,</span>
</span><span id="League.season_sims-1937"><a href="#League.season_sims-1937"><span class="linenos">1937</span></a>                <span class="p">)</span>
</span><span id="League.season_sims-1938"><a href="#League.season_sims-1938"><span class="linenos">1938</span></a>                <span class="n">many_mile</span><span class="o">.</span><span class="n">points_avg</span> <span class="o">=</span> <span class="n">many_mile</span><span class="o">.</span><span class="n">points_avg</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="League.season_sims-1939"><a href="#League.season_sims-1939"><span class="linenos">1939</span></a>                <span class="n">many_mile</span><span class="o">.</span><span class="n">points_stdev</span> <span class="o">=</span> <span class="n">many_mile</span><span class="o">.</span><span class="n">points_stdev</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="League.season_sims-1940"><a href="#League.season_sims-1940"><span class="linenos">1940</span></a>                <span class="n">many_mile</span><span class="p">[</span><span class="s2">&quot;sim&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League.season_sims-1941"><a href="#League.season_sims-1941"><span class="linenos">1941</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">many_mile</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="League.season_sims-1942"><a href="#League.season_sims-1942"><span class="linenos">1942</span></a>                    <span class="o">*</span> <span class="n">many_mile</span><span class="o">.</span><span class="n">points_stdev</span>
</span><span id="League.season_sims-1943"><a href="#League.season_sims-1943"><span class="linenos">1943</span></a>                    <span class="o">+</span> <span class="n">many_mile</span><span class="o">.</span><span class="n">points_avg</span>
</span><span id="League.season_sims-1944"><a href="#League.season_sims-1944"><span class="linenos">1944</span></a>                    <span class="o">+</span> <span class="n">many_mile</span><span class="o">.</span><span class="n">score</span>
</span><span id="League.season_sims-1945"><a href="#League.season_sims-1945"><span class="linenos">1945</span></a>                <span class="p">)</span>
</span><span id="League.season_sims-1946"><a href="#League.season_sims-1946"><span class="linenos">1946</span></a>                <span class="n">many_mile</span> <span class="o">=</span> <span class="n">many_mile</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
</span><span id="League.season_sims-1947"><a href="#League.season_sims-1947"><span class="linenos">1947</span></a>                    <span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;num_sim&quot;</span><span class="p">,</span> <span class="s2">&quot;sim&quot;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span>
</span><span id="League.season_sims-1948"><a href="#League.season_sims-1948"><span class="linenos">1948</span></a>                <span class="p">)</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;num_sim&quot;</span><span class="p">],</span> <span class="n">keep</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)</span>
</span><span id="League.season_sims-1949"><a href="#League.season_sims-1949"><span class="linenos">1949</span></a>            <span class="n">final_probs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League.season_sims-1950"><a href="#League.season_sims-1950"><span class="linenos">1950</span></a>                <span class="n">left</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League.season_sims-1951"><a href="#League.season_sims-1951"><span class="linenos">1951</span></a>                    <span class="n">left</span><span class="o">=</span><span class="n">winner</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;team&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s2">&quot;winner&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(),</span>
</span><span id="League.season_sims-1952"><a href="#League.season_sims-1952"><span class="linenos">1952</span></a>                    <span class="n">right</span><span class="o">=</span><span class="n">runner_up</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;team&quot;</span><span class="p">)</span>
</span><span id="League.season_sims-1953"><a href="#League.season_sims-1953"><span class="linenos">1953</span></a>                    <span class="o">.</span><span class="n">size</span><span class="p">()</span>
</span><span id="League.season_sims-1954"><a href="#League.season_sims-1954"><span class="linenos">1954</span></a>                    <span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s2">&quot;runner_up&quot;</span><span class="p">)</span>
</span><span id="League.season_sims-1955"><a href="#League.season_sims-1955"><span class="linenos">1955</span></a>                    <span class="o">.</span><span class="n">reset_index</span><span class="p">(),</span>
</span><span id="League.season_sims-1956"><a href="#League.season_sims-1956"><span class="linenos">1956</span></a>                    <span class="n">how</span><span class="o">=</span><span class="s2">&quot;outer&quot;</span><span class="p">,</span>
</span><span id="League.season_sims-1957"><a href="#League.season_sims-1957"><span class="linenos">1957</span></a>                    <span class="n">on</span><span class="o">=</span><span class="s2">&quot;team&quot;</span><span class="p">,</span>
</span><span id="League.season_sims-1958"><a href="#League.season_sims-1958"><span class="linenos">1958</span></a>                <span class="p">),</span>
</span><span id="League.season_sims-1959"><a href="#League.season_sims-1959"><span class="linenos">1959</span></a>                <span class="n">right</span><span class="o">=</span><span class="n">third</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;team&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s2">&quot;third&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(),</span>
</span><span id="League.season_sims-1960"><a href="#League.season_sims-1960"><span class="linenos">1960</span></a>                <span class="n">how</span><span class="o">=</span><span class="s2">&quot;outer&quot;</span><span class="p">,</span>
</span><span id="League.season_sims-1961"><a href="#League.season_sims-1961"><span class="linenos">1961</span></a>                <span class="n">on</span><span class="o">=</span><span class="s2">&quot;team&quot;</span><span class="p">,</span>
</span><span id="League.season_sims-1962"><a href="#League.season_sims-1962"><span class="linenos">1962</span></a>            <span class="p">)</span>
</span><span id="League.season_sims-1963"><a href="#League.season_sims-1963"><span class="linenos">1963</span></a>            <span class="k">if</span> <span class="n">algorithm</span><span class="p">:</span>
</span><span id="League.season_sims-1964"><a href="#League.season_sims-1964"><span class="linenos">1964</span></a>                <span class="n">final_probs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League.season_sims-1965"><a href="#League.season_sims-1965"><span class="linenos">1965</span></a>                    <span class="n">left</span><span class="o">=</span><span class="n">final_probs</span><span class="p">,</span>
</span><span id="League.season_sims-1966"><a href="#League.season_sims-1966"><span class="linenos">1966</span></a>                    <span class="n">right</span><span class="o">=</span><span class="n">many_mile</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;team&quot;</span><span class="p">)</span>
</span><span id="League.season_sims-1967"><a href="#League.season_sims-1967"><span class="linenos">1967</span></a>                    <span class="o">.</span><span class="n">size</span><span class="p">()</span>
</span><span id="League.season_sims-1968"><a href="#League.season_sims-1968"><span class="linenos">1968</span></a>                    <span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s2">&quot;many_mile&quot;</span><span class="p">)</span>
</span><span id="League.season_sims-1969"><a href="#League.season_sims-1969"><span class="linenos">1969</span></a>                    <span class="o">.</span><span class="n">reset_index</span><span class="p">(),</span>
</span><span id="League.season_sims-1970"><a href="#League.season_sims-1970"><span class="linenos">1970</span></a>                    <span class="n">how</span><span class="o">=</span><span class="s2">&quot;outer&quot;</span><span class="p">,</span>
</span><span id="League.season_sims-1971"><a href="#League.season_sims-1971"><span class="linenos">1971</span></a>                    <span class="n">on</span><span class="o">=</span><span class="s2">&quot;team&quot;</span><span class="p">,</span>
</span><span id="League.season_sims-1972"><a href="#League.season_sims-1972"><span class="linenos">1972</span></a>                <span class="p">)</span>
</span><span id="League.season_sims-1973"><a href="#League.season_sims-1973"><span class="linenos">1973</span></a>                <span class="n">final_probs</span><span class="p">[</span><span class="s2">&quot;many_mile&quot;</span><span class="p">]</span> <span class="o">/=</span> <span class="n">many_mile</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League.season_sims-1974"><a href="#League.season_sims-1974"><span class="linenos">1974</span></a>                <span class="n">final_probs</span><span class="p">[</span><span class="s2">&quot;many_mile&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_probs</span><span class="p">[</span><span class="s2">&quot;many_mile&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="League.season_sims-1975"><a href="#League.season_sims-1975"><span class="linenos">1975</span></a>            <span class="n">final_probs</span><span class="p">[</span><span class="s2">&quot;winner&quot;</span><span class="p">]</span> <span class="o">/=</span> <span class="n">winner</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League.season_sims-1976"><a href="#League.season_sims-1976"><span class="linenos">1976</span></a>            <span class="n">final_probs</span><span class="p">[</span><span class="s2">&quot;runner_up&quot;</span><span class="p">]</span> <span class="o">/=</span> <span class="n">runner_up</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League.season_sims-1977"><a href="#League.season_sims-1977"><span class="linenos">1977</span></a>            <span class="n">final_probs</span><span class="p">[</span><span class="s2">&quot;third&quot;</span><span class="p">]</span> <span class="o">/=</span> <span class="n">third</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League.season_sims-1978"><a href="#League.season_sims-1978"><span class="linenos">1978</span></a>            <span class="n">final_probs</span><span class="p">[</span><span class="s2">&quot;winner&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_probs</span><span class="p">[</span><span class="s2">&quot;winner&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="League.season_sims-1979"><a href="#League.season_sims-1979"><span class="linenos">1979</span></a>            <span class="n">final_probs</span><span class="p">[</span><span class="s2">&quot;runner_up&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_probs</span><span class="p">[</span><span class="s2">&quot;runner_up&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="League.season_sims-1980"><a href="#League.season_sims-1980"><span class="linenos">1980</span></a>            <span class="n">final_probs</span><span class="p">[</span><span class="s2">&quot;third&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_probs</span><span class="p">[</span><span class="s2">&quot;third&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="League.season_sims-1981"><a href="#League.season_sims-1981"><span class="linenos">1981</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="League.season_sims-1982"><a href="#League.season_sims-1982"><span class="linenos">1982</span></a>            <span class="n">final_probs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span><span id="League.season_sims-1983"><a href="#League.season_sims-1983"><span class="linenos">1983</span></a>                <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;team&quot;</span><span class="p">,</span> <span class="s2">&quot;winner&quot;</span><span class="p">,</span> <span class="s2">&quot;runner_up&quot;</span><span class="p">,</span> <span class="s2">&quot;third&quot;</span><span class="p">,</span> <span class="s2">&quot;many_mile&quot;</span><span class="p">]</span>
</span><span id="League.season_sims-1984"><a href="#League.season_sims-1984"><span class="linenos">1984</span></a>            <span class="p">)</span>
</span><span id="League.season_sims-1985"><a href="#League.season_sims-1985"><span class="linenos">1985</span></a>        <span class="n">schedule</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League.season_sims-1986"><a href="#League.season_sims-1986"><span class="linenos">1986</span></a>            <span class="n">schedule_sims</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;week&quot;</span><span class="p">,</span> <span class="s2">&quot;team_1&quot;</span><span class="p">,</span> <span class="s2">&quot;team_2&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">numeric_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="League.season_sims-1987"><a href="#League.season_sims-1987"><span class="linenos">1987</span></a>        <span class="p">)</span>
</span><span id="League.season_sims-1988"><a href="#League.season_sims-1988"><span class="linenos">1988</span></a>        <span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;points_avg_1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;points_avg_1&quot;</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="League.season_sims-1989"><a href="#League.season_sims-1989"><span class="linenos">1989</span></a>        <span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;points_stdev_1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;points_stdev_1&quot;</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="League.season_sims-1990"><a href="#League.season_sims-1990"><span class="linenos">1990</span></a>        <span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;points_avg_2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;points_avg_2&quot;</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="League.season_sims-1991"><a href="#League.season_sims-1991"><span class="linenos">1991</span></a>        <span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;points_stdev_2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;points_stdev_2&quot;</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="League.season_sims-1992"><a href="#League.season_sims-1992"><span class="linenos">1992</span></a>        <span class="n">standings</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League.season_sims-1993"><a href="#League.season_sims-1993"><span class="linenos">1993</span></a>            <span class="n">left</span><span class="o">=</span><span class="n">standings</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;team&quot;</span><span class="p">)</span>
</span><span id="League.season_sims-1994"><a href="#League.season_sims-1994"><span class="linenos">1994</span></a>            <span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="League.season_sims-1995"><a href="#League.season_sims-1995"><span class="linenos">1995</span></a>            <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="League.season_sims-1996"><a href="#League.season_sims-1996"><span class="linenos">1996</span></a>            <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;wins&quot;</span><span class="p">:</span> <span class="s2">&quot;wins_avg&quot;</span><span class="p">,</span> <span class="s2">&quot;points&quot;</span><span class="p">:</span> <span class="s2">&quot;points_avg&quot;</span><span class="p">}),</span>
</span><span id="League.season_sims-1997"><a href="#League.season_sims-1997"><span class="linenos">1997</span></a>            <span class="n">right</span><span class="o">=</span><span class="n">standings</span><span class="p">[[</span><span class="s2">&quot;team&quot;</span><span class="p">,</span> <span class="s2">&quot;wins&quot;</span><span class="p">,</span> <span class="s2">&quot;points&quot;</span><span class="p">]]</span>
</span><span id="League.season_sims-1998"><a href="#League.season_sims-1998"><span class="linenos">1998</span></a>            <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;team&quot;</span><span class="p">)</span>
</span><span id="League.season_sims-1999"><a href="#League.season_sims-1999"><span class="linenos">1999</span></a>            <span class="o">.</span><span class="n">std</span><span class="p">()</span>
</span><span id="League.season_sims-2000"><a href="#League.season_sims-2000"><span class="linenos">2000</span></a>            <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="League.season_sims-2001"><a href="#League.season_sims-2001"><span class="linenos">2001</span></a>            <span class="o">.</span><span class="n">rename</span><span class="p">(</span>
</span><span id="League.season_sims-2002"><a href="#League.season_sims-2002"><span class="linenos">2002</span></a>                <span class="n">index</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;wins&quot;</span><span class="p">:</span> <span class="s2">&quot;wins_stdev&quot;</span><span class="p">,</span> <span class="s2">&quot;points&quot;</span><span class="p">:</span> <span class="s2">&quot;points_stdev&quot;</span><span class="p">}</span>
</span><span id="League.season_sims-2003"><a href="#League.season_sims-2003"><span class="linenos">2003</span></a>            <span class="p">),</span>
</span><span id="League.season_sims-2004"><a href="#League.season_sims-2004"><span class="linenos">2004</span></a>            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">,</span>
</span><span id="League.season_sims-2005"><a href="#League.season_sims-2005"><span class="linenos">2005</span></a>            <span class="n">on</span><span class="o">=</span><span class="s2">&quot;team&quot;</span><span class="p">,</span>
</span><span id="League.season_sims-2006"><a href="#League.season_sims-2006"><span class="linenos">2006</span></a>        <span class="p">)</span>
</span><span id="League.season_sims-2007"><a href="#League.season_sims-2007"><span class="linenos">2007</span></a>        <span class="n">standings</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">standings</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">final_probs</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;team&quot;</span><span class="p">)</span>
</span><span id="League.season_sims-2008"><a href="#League.season_sims-2008"><span class="linenos">2008</span></a>        <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;winner&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;winner&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="League.season_sims-2009"><a href="#League.season_sims-2009"><span class="linenos">2009</span></a>        <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;runner_up&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;runner_up&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="League.season_sims-2010"><a href="#League.season_sims-2010"><span class="linenos">2010</span></a>        <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;third&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;third&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="League.season_sims-2011"><a href="#League.season_sims-2011"><span class="linenos">2011</span></a>        <span class="k">if</span> <span class="n">algorithm</span><span class="p">:</span>
</span><span id="League.season_sims-2012"><a href="#League.season_sims-2012"><span class="linenos">2012</span></a>            <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;many_mile&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;many_mile&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="League.season_sims-2013"><a href="#League.season_sims-2013"><span class="linenos">2013</span></a>        <span class="n">scores</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">schedule_sims</span><span class="p">[[</span><span class="s2">&quot;team_1&quot;</span><span class="p">,</span> <span class="s2">&quot;sim_1&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;team_1&quot;</span><span class="p">:</span> <span class="s2">&quot;team&quot;</span><span class="p">,</span> <span class="s2">&quot;sim_1&quot;</span><span class="p">:</span> <span class="s2">&quot;sim&quot;</span><span class="p">}),</span>
</span><span id="League.season_sims-2014"><a href="#League.season_sims-2014"><span class="linenos">2014</span></a>        <span class="n">schedule_sims</span><span class="p">[[</span><span class="s2">&quot;team_2&quot;</span><span class="p">,</span> <span class="s2">&quot;sim_2&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;team_2&quot;</span><span class="p">:</span> <span class="s2">&quot;team&quot;</span><span class="p">,</span> <span class="s2">&quot;sim_2&quot;</span><span class="p">:</span> <span class="s2">&quot;sim&quot;</span><span class="p">})],</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;team&quot;</span><span class="p">)</span>
</span><span id="League.season_sims-2015"><a href="#League.season_sims-2015"><span class="linenos">2015</span></a>        <span class="n">standings</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League.season_sims-2016"><a href="#League.season_sims-2016"><span class="linenos">2016</span></a>            <span class="n">left</span><span class="o">=</span><span class="n">standings</span><span class="p">,</span>
</span><span id="League.season_sims-2017"><a href="#League.season_sims-2017"><span class="linenos">2017</span></a>            <span class="n">right</span><span class="o">=</span><span class="n">scores</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="League.season_sims-2018"><a href="#League.season_sims-2018"><span class="linenos">2018</span></a>            <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="League.season_sims-2019"><a href="#League.season_sims-2019"><span class="linenos">2019</span></a>            <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;sim&quot;</span><span class="p">:</span> <span class="s2">&quot;per_game_avg&quot;</span><span class="p">}),</span>
</span><span id="League.season_sims-2020"><a href="#League.season_sims-2020"><span class="linenos">2020</span></a>            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">,</span>
</span><span id="League.season_sims-2021"><a href="#League.season_sims-2021"><span class="linenos">2021</span></a>            <span class="n">on</span><span class="o">=</span><span class="s2">&quot;team&quot;</span><span class="p">,</span>
</span><span id="League.season_sims-2022"><a href="#League.season_sims-2022"><span class="linenos">2022</span></a>        <span class="p">)</span>
</span><span id="League.season_sims-2023"><a href="#League.season_sims-2023"><span class="linenos">2023</span></a>        <span class="n">standings</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League.season_sims-2024"><a href="#League.season_sims-2024"><span class="linenos">2024</span></a>            <span class="n">left</span><span class="o">=</span><span class="n">standings</span><span class="p">,</span>
</span><span id="League.season_sims-2025"><a href="#League.season_sims-2025"><span class="linenos">2025</span></a>            <span class="n">right</span><span class="o">=</span><span class="n">scores</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
</span><span id="League.season_sims-2026"><a href="#League.season_sims-2026"><span class="linenos">2026</span></a>            <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="League.season_sims-2027"><a href="#League.season_sims-2027"><span class="linenos">2027</span></a>            <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;sim&quot;</span><span class="p">:</span> <span class="s2">&quot;per_game_stdev&quot;</span><span class="p">}),</span>
</span><span id="League.season_sims-2028"><a href="#League.season_sims-2028"><span class="linenos">2028</span></a>            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">,</span>
</span><span id="League.season_sims-2029"><a href="#League.season_sims-2029"><span class="linenos">2029</span></a>            <span class="n">on</span><span class="o">=</span><span class="s2">&quot;team&quot;</span><span class="p">,</span>
</span><span id="League.season_sims-2030"><a href="#League.season_sims-2030"><span class="linenos">2030</span></a>        <span class="p">)</span>
</span><span id="League.season_sims-2031"><a href="#League.season_sims-2031"><span class="linenos">2031</span></a>        <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;per_game_fano&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League.season_sims-2032"><a href="#League.season_sims-2032"><span class="linenos">2032</span></a>            <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;per_game_stdev&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;per_game_avg&quot;</span><span class="p">]</span>
</span><span id="League.season_sims-2033"><a href="#League.season_sims-2033"><span class="linenos">2033</span></a>        <span class="p">)</span>
</span><span id="League.season_sims-2034"><a href="#League.season_sims-2034"><span class="linenos">2034</span></a>        <span class="n">standings</span> <span class="o">=</span> <span class="n">standings</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
</span><span id="League.season_sims-2035"><a href="#League.season_sims-2035"><span class="linenos">2035</span></a>            <span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;winner&quot;</span> <span class="k">if</span> <span class="n">postseason</span> <span class="k">else</span> <span class="s2">&quot;playoffs&quot;</span><span class="p">]</span>
</span><span id="League.season_sims-2036"><a href="#League.season_sims-2036"><span class="linenos">2036</span></a>            <span class="o">+</span> <span class="p">([</span><span class="s2">&quot;many_mile&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;many_mile&quot;</span> <span class="ow">in</span> <span class="n">standings</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="k">else</span> <span class="p">[]),</span>
</span><span id="League.season_sims-2037"><a href="#League.season_sims-2037"><span class="linenos">2037</span></a>            <span class="n">ascending</span><span class="o">=</span><span class="p">[</span><span class="kc">False</span><span class="p">]</span>
</span><span id="League.season_sims-2038"><a href="#League.season_sims-2038"><span class="linenos">2038</span></a>            <span class="o">+</span> <span class="p">([</span><span class="kc">True</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;many_mile&quot;</span> <span class="ow">in</span> <span class="n">standings</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="k">else</span> <span class="p">[]),</span>
</span><span id="League.season_sims-2039"><a href="#League.season_sims-2039"><span class="linenos">2039</span></a>        <span class="p">)</span>
</span><span id="League.season_sims-2040"><a href="#League.season_sims-2040"><span class="linenos">2040</span></a>        <span class="k">if</span> <span class="n">postseason</span><span class="p">:</span>
</span><span id="League.season_sims-2041"><a href="#League.season_sims-2041"><span class="linenos">2041</span></a>            <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;earnings&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span>
</span><span id="League.season_sims-2042"><a href="#League.season_sims-2042"><span class="linenos">2042</span></a>                <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;winner&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">payouts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League.season_sims-2043"><a href="#League.season_sims-2043"><span class="linenos">2043</span></a>                <span class="o">+</span> <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;runner_up&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">payouts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="League.season_sims-2044"><a href="#League.season_sims-2044"><span class="linenos">2044</span></a>                <span class="o">+</span> <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;third&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">payouts</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
</span><span id="League.season_sims-2045"><a href="#League.season_sims-2045"><span class="linenos">2045</span></a>                <span class="mi">2</span><span class="p">,</span>
</span><span id="League.season_sims-2046"><a href="#League.season_sims-2046"><span class="linenos">2046</span></a>            <span class="p">)</span>
</span><span id="League.season_sims-2047"><a href="#League.season_sims-2047"><span class="linenos">2047</span></a>        <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;wins_avg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">standings</span><span class="p">[</span><span class="s2">&quot;wins_avg&quot;</span><span class="p">],</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="League.season_sims-2048"><a href="#League.season_sims-2048"><span class="linenos">2048</span></a>        <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;wins_stdev&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">standings</span><span class="p">[</span><span class="s2">&quot;wins_stdev&quot;</span><span class="p">],</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="League.season_sims-2049"><a href="#League.season_sims-2049"><span class="linenos">2049</span></a>        <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;points_avg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">standings</span><span class="p">[</span><span class="s2">&quot;points_avg&quot;</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="League.season_sims-2050"><a href="#League.season_sims-2050"><span class="linenos">2050</span></a>        <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;points_stdev&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">standings</span><span class="p">[</span><span class="s2">&quot;points_stdev&quot;</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="League.season_sims-2051"><a href="#League.season_sims-2051"><span class="linenos">2051</span></a>        <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;per_game_avg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">standings</span><span class="p">[</span><span class="s2">&quot;per_game_avg&quot;</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="League.season_sims-2052"><a href="#League.season_sims-2052"><span class="linenos">2052</span></a>        <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;per_game_stdev&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">standings</span><span class="p">[</span><span class="s2">&quot;per_game_stdev&quot;</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="League.season_sims-2053"><a href="#League.season_sims-2053"><span class="linenos">2053</span></a>        <span class="n">standings</span><span class="p">[</span><span class="s2">&quot;per_game_fano&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">standings</span><span class="p">[</span><span class="s2">&quot;per_game_fano&quot;</span><span class="p">],</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="League.season_sims-2054"><a href="#League.season_sims-2054"><span class="linenos">2054</span></a>        <span class="k">return</span> <span class="n">schedule</span><span class="p">,</span> <span class="n">standings</span>
</span></pre></div>


            <div class="docstring"><p>Simulates the remainder of the fantasy season based on current rosters 
and redraft settings using Monte Carlo simulations.</p>

<p>Args:
    postseason (bool, optional): whether to simulate the postseason in addition to the regular season, defaults to True. <br />
    payouts (list, optional): list of prize amounts for first, second, and third, defaults to [800, 300, 100]. <br />
    fixed_winner (list, optional): list containing the week and team name of a fixed winner, defaults to None.</p>

<p>Returns:
    schedule (pd.DataFrame): simulated results for each matchup throughout the season in question <br />
    standings (pd.DataFrame): simulated results for the final season standings and playoff projections</p>
</div>


                            </div>
                            <div id="League.war_sim" class="classattr">
                                        <input id="League.war_sim-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">war_sim</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="League.war_sim-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#League.war_sim"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="League.war_sim-2056"><a href="#League.war_sim-2056"><span class="linenos">2056</span></a>    <span class="k">def</span> <span class="nf">war_sim</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="League.war_sim-2057"><a href="#League.war_sim-2057"><span class="linenos">2057</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="League.war_sim-2058"><a href="#League.war_sim-2058"><span class="linenos">2058</span></a><span class="sd">        Simulates the wins-above-replacement (WAR) for each of the players eligible to roster, </span>
</span><span id="League.war_sim-2059"><a href="#League.war_sim-2059"><span class="linenos">2059</span></a><span class="sd">        i.e. how many more wins in a season you would have by rostering that player </span>
</span><span id="League.war_sim-2060"><a href="#League.war_sim-2060"><span class="linenos">2060</span></a><span class="sd">        compared to an average player at that position.</span>
</span><span id="League.war_sim-2061"><a href="#League.war_sim-2061"><span class="linenos">2061</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="League.war_sim-2062"><a href="#League.war_sim-2062"><span class="linenos">2062</span></a>        <span class="n">as_of</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">season</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">week</span>
</span><span id="League.war_sim-2063"><a href="#League.war_sim-2063"><span class="linenos">2063</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">load_stats</span><span class="p">(</span><span class="n">as_of</span> <span class="o">-</span> <span class="mi">100</span><span class="p">,</span> <span class="n">as_of</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="League.war_sim-2064"><a href="#League.war_sim-2064"><span class="linenos">2064</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Creating histograms across all players in each position &quot;&quot;&quot;</span>
</span><span id="League.war_sim-2065"><a href="#League.war_sim-2065"><span class="linenos">2065</span></a>        <span class="n">pos_hists</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;points&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mf">50.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)}</span>
</span><span id="League.war_sim-2066"><a href="#League.war_sim-2066"><span class="linenos">2066</span></a>        <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
</span><span id="League.war_sim-2067"><a href="#League.war_sim-2067"><span class="linenos">2067</span></a>            <span class="n">pos_hists</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span>
</span><span id="League.war_sim-2068"><a href="#League.war_sim-2068"><span class="linenos">2068</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">position</span> <span class="o">==</span> <span class="n">pos</span><span class="p">,</span> <span class="s2">&quot;points&quot;</span><span class="p">],</span>
</span><span id="League.war_sim-2069"><a href="#League.war_sim-2069"><span class="linenos">2069</span></a>                <span class="n">bins</span><span class="o">=</span><span class="n">pos_hists</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">],</span>
</span><span id="League.war_sim-2070"><a href="#League.war_sim-2070"><span class="linenos">2070</span></a>            <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League.war_sim-2071"><a href="#League.war_sim-2071"><span class="linenos">2071</span></a>            <span class="n">pos_hists</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos_hists</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span><span class="n">pos_hists</span><span class="p">[</span><span class="n">pos</span><span class="p">])</span>
</span><span id="League.war_sim-2072"><a href="#League.war_sim-2072"><span class="linenos">2072</span></a>        <span class="n">pos_hists</span><span class="p">[</span><span class="s2">&quot;FLEX&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span>
</span><span id="League.war_sim-2073"><a href="#League.war_sim-2073"><span class="linenos">2073</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;RB&quot;</span><span class="p">,</span> <span class="s2">&quot;WR&quot;</span><span class="p">,</span> <span class="s2">&quot;TE&quot;</span><span class="p">]),</span> <span class="s2">&quot;points&quot;</span><span class="p">],</span>
</span><span id="League.war_sim-2074"><a href="#League.war_sim-2074"><span class="linenos">2074</span></a>            <span class="n">bins</span><span class="o">=</span><span class="n">pos_hists</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">],</span>
</span><span id="League.war_sim-2075"><a href="#League.war_sim-2075"><span class="linenos">2075</span></a>        <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League.war_sim-2076"><a href="#League.war_sim-2076"><span class="linenos">2076</span></a>        <span class="n">pos_hists</span><span class="p">[</span><span class="s2">&quot;FLEX&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos_hists</span><span class="p">[</span><span class="s2">&quot;FLEX&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span><span class="n">pos_hists</span><span class="p">[</span><span class="s2">&quot;FLEX&quot;</span><span class="p">])</span>
</span><span id="League.war_sim-2077"><a href="#League.war_sim-2077"><span class="linenos">2077</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Simulating an entire team using average players &quot;&quot;&quot;</span>
</span><span id="League.war_sim-2078"><a href="#League.war_sim-2078"><span class="linenos">2078</span></a>        <span class="n">sim_scores</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span><span id="League.war_sim-2079"><a href="#League.war_sim-2079"><span class="linenos">2079</span></a>            <span class="p">{</span>
</span><span id="League.war_sim-2080"><a href="#League.war_sim-2080"><span class="linenos">2080</span></a>                <span class="s2">&quot;QB&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
</span><span id="League.war_sim-2081"><a href="#League.war_sim-2081"><span class="linenos">2081</span></a>                    <span class="n">pos_hists</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="o">=</span><span class="n">pos_hists</span><span class="p">[</span><span class="s2">&quot;QB&quot;</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_sims</span>
</span><span id="League.war_sim-2082"><a href="#League.war_sim-2082"><span class="linenos">2082</span></a>                <span class="p">),</span>
</span><span id="League.war_sim-2083"><a href="#League.war_sim-2083"><span class="linenos">2083</span></a>                <span class="s2">&quot;RB1&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
</span><span id="League.war_sim-2084"><a href="#League.war_sim-2084"><span class="linenos">2084</span></a>                    <span class="n">pos_hists</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="o">=</span><span class="n">pos_hists</span><span class="p">[</span><span class="s2">&quot;RB&quot;</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_sims</span>
</span><span id="League.war_sim-2085"><a href="#League.war_sim-2085"><span class="linenos">2085</span></a>                <span class="p">),</span>
</span><span id="League.war_sim-2086"><a href="#League.war_sim-2086"><span class="linenos">2086</span></a>                <span class="s2">&quot;RB2&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
</span><span id="League.war_sim-2087"><a href="#League.war_sim-2087"><span class="linenos">2087</span></a>                    <span class="n">pos_hists</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="o">=</span><span class="n">pos_hists</span><span class="p">[</span><span class="s2">&quot;RB&quot;</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_sims</span>
</span><span id="League.war_sim-2088"><a href="#League.war_sim-2088"><span class="linenos">2088</span></a>                <span class="p">),</span>
</span><span id="League.war_sim-2089"><a href="#League.war_sim-2089"><span class="linenos">2089</span></a>                <span class="s2">&quot;WR1&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
</span><span id="League.war_sim-2090"><a href="#League.war_sim-2090"><span class="linenos">2090</span></a>                    <span class="n">pos_hists</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="o">=</span><span class="n">pos_hists</span><span class="p">[</span><span class="s2">&quot;WR&quot;</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_sims</span>
</span><span id="League.war_sim-2091"><a href="#League.war_sim-2091"><span class="linenos">2091</span></a>                <span class="p">),</span>
</span><span id="League.war_sim-2092"><a href="#League.war_sim-2092"><span class="linenos">2092</span></a>                <span class="s2">&quot;WR2&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
</span><span id="League.war_sim-2093"><a href="#League.war_sim-2093"><span class="linenos">2093</span></a>                    <span class="n">pos_hists</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="o">=</span><span class="n">pos_hists</span><span class="p">[</span><span class="s2">&quot;WR&quot;</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_sims</span>
</span><span id="League.war_sim-2094"><a href="#League.war_sim-2094"><span class="linenos">2094</span></a>                <span class="p">),</span>
</span><span id="League.war_sim-2095"><a href="#League.war_sim-2095"><span class="linenos">2095</span></a>                <span class="s2">&quot;TE&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
</span><span id="League.war_sim-2096"><a href="#League.war_sim-2096"><span class="linenos">2096</span></a>                    <span class="n">pos_hists</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="o">=</span><span class="n">pos_hists</span><span class="p">[</span><span class="s2">&quot;TE&quot;</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_sims</span>
</span><span id="League.war_sim-2097"><a href="#League.war_sim-2097"><span class="linenos">2097</span></a>                <span class="p">),</span>
</span><span id="League.war_sim-2098"><a href="#League.war_sim-2098"><span class="linenos">2098</span></a>                <span class="s2">&quot;FLEX&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
</span><span id="League.war_sim-2099"><a href="#League.war_sim-2099"><span class="linenos">2099</span></a>                    <span class="n">pos_hists</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="o">=</span><span class="n">pos_hists</span><span class="p">[</span><span class="s2">&quot;FLEX&quot;</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_sims</span>
</span><span id="League.war_sim-2100"><a href="#League.war_sim-2100"><span class="linenos">2100</span></a>                <span class="p">),</span>
</span><span id="League.war_sim-2101"><a href="#League.war_sim-2101"><span class="linenos">2101</span></a>                <span class="s2">&quot;K&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
</span><span id="League.war_sim-2102"><a href="#League.war_sim-2102"><span class="linenos">2102</span></a>                    <span class="n">pos_hists</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="o">=</span><span class="n">pos_hists</span><span class="p">[</span><span class="s2">&quot;K&quot;</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_sims</span>
</span><span id="League.war_sim-2103"><a href="#League.war_sim-2103"><span class="linenos">2103</span></a>                <span class="p">),</span>
</span><span id="League.war_sim-2104"><a href="#League.war_sim-2104"><span class="linenos">2104</span></a>                <span class="s2">&quot;DEF&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
</span><span id="League.war_sim-2105"><a href="#League.war_sim-2105"><span class="linenos">2105</span></a>                    <span class="n">pos_hists</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="o">=</span><span class="n">pos_hists</span><span class="p">[</span><span class="s2">&quot;DEF&quot;</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_sims</span>
</span><span id="League.war_sim-2106"><a href="#League.war_sim-2106"><span class="linenos">2106</span></a>                <span class="p">),</span>
</span><span id="League.war_sim-2107"><a href="#League.war_sim-2107"><span class="linenos">2107</span></a>            <span class="p">}</span>
</span><span id="League.war_sim-2108"><a href="#League.war_sim-2108"><span class="linenos">2108</span></a>        <span class="p">)</span>
</span><span id="League.war_sim-2109"><a href="#League.war_sim-2109"><span class="linenos">2109</span></a>        <span class="n">sim_scores</span><span class="p">[</span><span class="s2">&quot;Total&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League.war_sim-2110"><a href="#League.war_sim-2110"><span class="linenos">2110</span></a>            <span class="n">sim_scores</span><span class="o">.</span><span class="n">QB</span>
</span><span id="League.war_sim-2111"><a href="#League.war_sim-2111"><span class="linenos">2111</span></a>            <span class="o">+</span> <span class="n">sim_scores</span><span class="o">.</span><span class="n">RB1</span>
</span><span id="League.war_sim-2112"><a href="#League.war_sim-2112"><span class="linenos">2112</span></a>            <span class="o">+</span> <span class="n">sim_scores</span><span class="o">.</span><span class="n">RB2</span>
</span><span id="League.war_sim-2113"><a href="#League.war_sim-2113"><span class="linenos">2113</span></a>            <span class="o">+</span> <span class="n">sim_scores</span><span class="o">.</span><span class="n">WR1</span>
</span><span id="League.war_sim-2114"><a href="#League.war_sim-2114"><span class="linenos">2114</span></a>            <span class="o">+</span> <span class="n">sim_scores</span><span class="o">.</span><span class="n">WR2</span>
</span><span id="League.war_sim-2115"><a href="#League.war_sim-2115"><span class="linenos">2115</span></a>            <span class="o">+</span> <span class="n">sim_scores</span><span class="o">.</span><span class="n">TE</span>
</span><span id="League.war_sim-2116"><a href="#League.war_sim-2116"><span class="linenos">2116</span></a>            <span class="o">+</span> <span class="n">sim_scores</span><span class="o">.</span><span class="n">FLEX</span>
</span><span id="League.war_sim-2117"><a href="#League.war_sim-2117"><span class="linenos">2117</span></a>            <span class="o">+</span> <span class="n">sim_scores</span><span class="o">.</span><span class="n">K</span>
</span><span id="League.war_sim-2118"><a href="#League.war_sim-2118"><span class="linenos">2118</span></a>            <span class="o">+</span> <span class="n">sim_scores</span><span class="o">.</span><span class="n">DEF</span>
</span><span id="League.war_sim-2119"><a href="#League.war_sim-2119"><span class="linenos">2119</span></a>        <span class="p">)</span>
</span><span id="League.war_sim-2120"><a href="#League.war_sim-2120"><span class="linenos">2120</span></a>        <span class="n">player_sims</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span><span id="League.war_sim-2121"><a href="#League.war_sim-2121"><span class="linenos">2121</span></a>            <span class="p">{</span>
</span><span id="League.war_sim-2122"><a href="#League.war_sim-2122"><span class="linenos">2122</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">]:</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span>
</span><span id="League.war_sim-2123"><a href="#League.war_sim-2123"><span class="linenos">2123</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span>
</span><span id="League.war_sim-2124"><a href="#League.war_sim-2124"><span class="linenos">2124</span></a>                        <span class="n">loc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span> <span class="s2">&quot;points_rate&quot;</span><span class="p">],</span>
</span><span id="League.war_sim-2125"><a href="#League.war_sim-2125"><span class="linenos">2125</span></a>                        <span class="n">scale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span> <span class="s2">&quot;points_stdev&quot;</span><span class="p">],</span>
</span><span id="League.war_sim-2126"><a href="#League.war_sim-2126"><span class="linenos">2126</span></a>                        <span class="n">size</span><span class="o">=</span><span class="n">sim_scores</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="League.war_sim-2127"><a href="#League.war_sim-2127"><span class="linenos">2127</span></a>                    <span class="p">)</span>
</span><span id="League.war_sim-2128"><a href="#League.war_sim-2128"><span class="linenos">2128</span></a>                <span class="p">)</span>
</span><span id="League.war_sim-2129"><a href="#League.war_sim-2129"><span class="linenos">2129</span></a>                <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="League.war_sim-2130"><a href="#League.war_sim-2130"><span class="linenos">2130</span></a>            <span class="p">}</span>
</span><span id="League.war_sim-2131"><a href="#League.war_sim-2131"><span class="linenos">2131</span></a>        <span class="p">)</span>
</span><span id="League.war_sim-2132"><a href="#League.war_sim-2132"><span class="linenos">2132</span></a>        <span class="n">sim_scores</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League.war_sim-2133"><a href="#League.war_sim-2133"><span class="linenos">2133</span></a>            <span class="n">left</span><span class="o">=</span><span class="n">sim_scores</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">player_sims</span><span class="p">,</span> <span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span>
</span><span id="League.war_sim-2134"><a href="#League.war_sim-2134"><span class="linenos">2134</span></a>        <span class="p">)</span>
</span><span id="League.war_sim-2135"><a href="#League.war_sim-2135"><span class="linenos">2135</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Calculating the number of wins above replacement for each player &quot;&quot;&quot;</span>
</span><span id="League.war_sim-2136"><a href="#League.war_sim-2136"><span class="linenos">2136</span></a>        <span class="k">for</span> <span class="n">player</span> <span class="ow">in</span> <span class="n">sim_scores</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">10</span><span class="p">:]:</span>
</span><span id="League.war_sim-2137"><a href="#League.war_sim-2137"><span class="linenos">2137</span></a>            <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">player</span><span class="p">):</span>
</span><span id="League.war_sim-2138"><a href="#League.war_sim-2138"><span class="linenos">2138</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Null player name for some reason... Skipping...&quot;</span><span class="p">)</span>
</span><span id="League.war_sim-2139"><a href="#League.war_sim-2139"><span class="linenos">2139</span></a>                <span class="k">continue</span>
</span><span id="League.war_sim-2140"><a href="#League.war_sim-2140"><span class="linenos">2140</span></a>            <span class="n">cols</span> <span class="o">=</span> <span class="n">sim_scores</span><span class="o">.</span><span class="n">columns</span><span class="p">[:</span><span class="mi">9</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="League.war_sim-2141"><a href="#League.war_sim-2141"><span class="linenos">2141</span></a>            <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">player</span><span class="p">,</span> <span class="s2">&quot;position&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League.war_sim-2142"><a href="#League.war_sim-2142"><span class="linenos">2142</span></a>            <span class="k">if</span> <span class="n">pos</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;RB&quot;</span><span class="p">,</span> <span class="s2">&quot;WR&quot;</span><span class="p">]:</span>
</span><span id="League.war_sim-2143"><a href="#League.war_sim-2143"><span class="linenos">2143</span></a>                <span class="n">pos</span> <span class="o">+=</span> <span class="s2">&quot;1&quot;</span>
</span><span id="League.war_sim-2144"><a href="#League.war_sim-2144"><span class="linenos">2144</span></a>            <span class="n">cols</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">cols</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">pos</span><span class="p">))</span>
</span><span id="League.war_sim-2145"><a href="#League.war_sim-2145"><span class="linenos">2145</span></a>            <span class="n">cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">player</span><span class="p">)</span>
</span><span id="League.war_sim-2146"><a href="#League.war_sim-2146"><span class="linenos">2146</span></a>            <span class="n">sim_scores</span><span class="p">[</span><span class="s2">&quot;Alt_Total&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sim_scores</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="League.war_sim-2147"><a href="#League.war_sim-2147"><span class="linenos">2147</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">player</span><span class="p">,</span> <span class="s2">&quot;WAR&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League.war_sim-2148"><a href="#League.war_sim-2148"><span class="linenos">2148</span></a>                <span class="nb">sum</span><span class="p">(</span>
</span><span id="League.war_sim-2149"><a href="#League.war_sim-2149"><span class="linenos">2149</span></a>                    <span class="n">sim_scores</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span> <span class="n">sim_scores</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Alt_Total&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="League.war_sim-2150"><a href="#League.war_sim-2150"><span class="linenos">2150</span></a>                    <span class="o">&gt;</span> <span class="n">sim_scores</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sim_scores</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span> <span class="p">:,</span> <span class="s2">&quot;Total&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="League.war_sim-2151"><a href="#League.war_sim-2151"><span class="linenos">2151</span></a>                <span class="p">)</span>
</span><span id="League.war_sim-2152"><a href="#League.war_sim-2152"><span class="linenos">2152</span></a>                <span class="o">/</span> <span class="p">(</span><span class="n">sim_scores</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="League.war_sim-2153"><a href="#League.war_sim-2153"><span class="linenos">2153</span></a>                <span class="o">-</span> <span class="mf">0.5</span>
</span><span id="League.war_sim-2154"><a href="#League.war_sim-2154"><span class="linenos">2154</span></a>            <span class="p">)</span> <span class="o">*</span> <span class="mi">14</span>
</span><span id="League.war_sim-2155"><a href="#League.war_sim-2155"><span class="linenos">2155</span></a>            <span class="k">del</span> <span class="n">sim_scores</span><span class="p">[</span><span class="s2">&quot;Alt_Total&quot;</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Simulates the wins-above-replacement (WAR) for each of the players eligible to roster, 
i.e. how many more wins in a season you would have by rostering that player 
compared to an average player at that position.</p>
</div>


                            </div>
                            <div id="League.possible_pickups" class="classattr">
                                        <input id="League.possible_pickups-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">possible_pickups</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">focus_on</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span>,</span><span class="param">	<span class="n">exclude</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span>,</span><span class="param">	<span class="n">limit_per</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span>,</span><span class="param">	<span class="n">team_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">postseason</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">payouts</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">800</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">100</span><span class="p">]</span>,</span><span class="param">	<span class="n">bestball</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">min_rostership</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.05</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="League.possible_pickups-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#League.possible_pickups"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="League.possible_pickups-2157"><a href="#League.possible_pickups-2157"><span class="linenos">2157</span></a>    <span class="k">def</span> <span class="nf">possible_pickups</span><span class="p">(</span>
</span><span id="League.possible_pickups-2158"><a href="#League.possible_pickups-2158"><span class="linenos">2158</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="League.possible_pickups-2159"><a href="#League.possible_pickups-2159"><span class="linenos">2159</span></a>        <span class="n">focus_on</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[],</span>
</span><span id="League.possible_pickups-2160"><a href="#League.possible_pickups-2160"><span class="linenos">2160</span></a>        <span class="n">exclude</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[],</span>
</span><span id="League.possible_pickups-2161"><a href="#League.possible_pickups-2161"><span class="linenos">2161</span></a>        <span class="n">limit_per</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="League.possible_pickups-2162"><a href="#League.possible_pickups-2162"><span class="linenos">2162</span></a>        <span class="n">team_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="League.possible_pickups-2163"><a href="#League.possible_pickups-2163"><span class="linenos">2163</span></a>        <span class="n">postseason</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="League.possible_pickups-2164"><a href="#League.possible_pickups-2164"><span class="linenos">2164</span></a>        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="League.possible_pickups-2165"><a href="#League.possible_pickups-2165"><span class="linenos">2165</span></a>        <span class="n">payouts</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">800</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
</span><span id="League.possible_pickups-2166"><a href="#League.possible_pickups-2166"><span class="linenos">2166</span></a>        <span class="n">bestball</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="League.possible_pickups-2167"><a href="#League.possible_pickups-2167"><span class="linenos">2167</span></a>        <span class="n">min_rostership</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span>
</span><span id="League.possible_pickups-2168"><a href="#League.possible_pickups-2168"><span class="linenos">2168</span></a>    <span class="p">):</span>
</span><span id="League.possible_pickups-2169"><a href="#League.possible_pickups-2169"><span class="linenos">2169</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="League.possible_pickups-2170"><a href="#League.possible_pickups-2170"><span class="linenos">2170</span></a><span class="sd">        Simulates the remainder of the season with the current roster and compares it to </span>
</span><span id="League.possible_pickups-2171"><a href="#League.possible_pickups-2171"><span class="linenos">2171</span></a><span class="sd">        a simulation of the roster after a series of potential add &amp; drop transactions.</span>
</span><span id="League.possible_pickups-2172"><a href="#League.possible_pickups-2172"><span class="linenos">2172</span></a>
</span><span id="League.possible_pickups-2173"><a href="#League.possible_pickups-2173"><span class="linenos">2173</span></a><span class="sd">        Args:</span>
</span><span id="League.possible_pickups-2174"><a href="#League.possible_pickups-2174"><span class="linenos">2174</span></a><span class="sd">            focus_on (list, optional): list of players to include in every potential trade, defaults to [].  </span>
</span><span id="League.possible_pickups-2175"><a href="#League.possible_pickups-2175"><span class="linenos">2175</span></a><span class="sd">            exclude (list, optional): list of players to exclude from every potential trade, defaults to [].  </span>
</span><span id="League.possible_pickups-2176"><a href="#League.possible_pickups-2176"><span class="linenos">2176</span></a><span class="sd">            limit_per (int, optional): number of players per position to analyze, defaults to 10.  </span>
</span><span id="League.possible_pickups-2177"><a href="#League.possible_pickups-2177"><span class="linenos">2177</span></a><span class="sd">            team_name (str, optional): name of team to analyze trades for, defaults to None (and therefore team of interest).  </span>
</span><span id="League.possible_pickups-2178"><a href="#League.possible_pickups-2178"><span class="linenos">2178</span></a><span class="sd">            postseason (bool, optional): whether to analyze postseason gains or just regular season, defaults to True.  </span>
</span><span id="League.possible_pickups-2179"><a href="#League.possible_pickups-2179"><span class="linenos">2179</span></a><span class="sd">            verbose (bool, optional): whether to print out a status report as the code runs, defaults to True.  </span>
</span><span id="League.possible_pickups-2180"><a href="#League.possible_pickups-2180"><span class="linenos">2180</span></a><span class="sd">            payouts (list, optional): list of payout amounts for top three finishers, defaults to [800, 300, 100].  </span>
</span><span id="League.possible_pickups-2181"><a href="#League.possible_pickups-2181"><span class="linenos">2181</span></a><span class="sd">            bestball (bool, optional): whether to use best ball settings during simulation, defaults to False.</span>
</span><span id="League.possible_pickups-2182"><a href="#League.possible_pickups-2182"><span class="linenos">2182</span></a>
</span><span id="League.possible_pickups-2183"><a href="#League.possible_pickups-2183"><span class="linenos">2183</span></a><span class="sd">        Returns:</span>
</span><span id="League.possible_pickups-2184"><a href="#League.possible_pickups-2184"><span class="linenos">2184</span></a><span class="sd">            pd.DataFrame: dataframe containing the impact and value of every add &amp; drop combination analyzed.</span>
</span><span id="League.possible_pickups-2185"><a href="#League.possible_pickups-2185"><span class="linenos">2185</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="League.possible_pickups-2186"><a href="#League.possible_pickups-2186"><span class="linenos">2186</span></a>        <span class="n">as_of</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">season</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">week</span>
</span><span id="League.possible_pickups-2187"><a href="#League.possible_pickups-2187"><span class="linenos">2187</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_oauth</span><span class="p">()</span>
</span><span id="League.possible_pickups-2188"><a href="#League.possible_pickups-2188"><span class="linenos">2188</span></a>        <span class="k">if</span> <span class="n">bestball</span><span class="p">:</span>
</span><span id="League.possible_pickups-2189"><a href="#League.possible_pickups-2189"><span class="linenos">2189</span></a>            <span class="n">orig_standings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bestball_sims</span><span class="p">(</span><span class="n">payouts</span><span class="p">)</span>
</span><span id="League.possible_pickups-2190"><a href="#League.possible_pickups-2190"><span class="linenos">2190</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="League.possible_pickups-2191"><a href="#League.possible_pickups-2191"><span class="linenos">2191</span></a>            <span class="n">orig_standings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">season_sims</span><span class="p">(</span><span class="n">postseason</span><span class="p">,</span> <span class="n">payouts</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="League.possible_pickups-2192"><a href="#League.possible_pickups-2192"><span class="linenos">2192</span></a>        <span class="n">added_value</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span><span id="League.possible_pickups-2193"><a href="#League.possible_pickups-2193"><span class="linenos">2193</span></a>            <span class="n">columns</span><span class="o">=</span><span class="p">[</span>
</span><span id="League.possible_pickups-2194"><a href="#League.possible_pickups-2194"><span class="linenos">2194</span></a>                <span class="s2">&quot;player_to_drop&quot;</span><span class="p">,</span>
</span><span id="League.possible_pickups-2195"><a href="#League.possible_pickups-2195"><span class="linenos">2195</span></a>                <span class="s2">&quot;player_to_add&quot;</span><span class="p">,</span>
</span><span id="League.possible_pickups-2196"><a href="#League.possible_pickups-2196"><span class="linenos">2196</span></a>                <span class="s2">&quot;wins_avg&quot;</span><span class="p">,</span>
</span><span id="League.possible_pickups-2197"><a href="#League.possible_pickups-2197"><span class="linenos">2197</span></a>                <span class="s2">&quot;wins_stdev&quot;</span><span class="p">,</span>
</span><span id="League.possible_pickups-2198"><a href="#League.possible_pickups-2198"><span class="linenos">2198</span></a>                <span class="s2">&quot;points_avg&quot;</span><span class="p">,</span>
</span><span id="League.possible_pickups-2199"><a href="#League.possible_pickups-2199"><span class="linenos">2199</span></a>                <span class="s2">&quot;points_stdev&quot;</span><span class="p">,</span>
</span><span id="League.possible_pickups-2200"><a href="#League.possible_pickups-2200"><span class="linenos">2200</span></a>                <span class="s2">&quot;per_game_avg&quot;</span><span class="p">,</span>
</span><span id="League.possible_pickups-2201"><a href="#League.possible_pickups-2201"><span class="linenos">2201</span></a>                <span class="s2">&quot;per_game_stdev&quot;</span><span class="p">,</span>
</span><span id="League.possible_pickups-2202"><a href="#League.possible_pickups-2202"><span class="linenos">2202</span></a>                <span class="s2">&quot;per_game_fano&quot;</span><span class="p">,</span>
</span><span id="League.possible_pickups-2203"><a href="#League.possible_pickups-2203"><span class="linenos">2203</span></a>                <span class="s2">&quot;playoffs&quot;</span><span class="p">,</span>
</span><span id="League.possible_pickups-2204"><a href="#League.possible_pickups-2204"><span class="linenos">2204</span></a>                <span class="s2">&quot;playoff_bye&quot;</span><span class="p">,</span>
</span><span id="League.possible_pickups-2205"><a href="#League.possible_pickups-2205"><span class="linenos">2205</span></a>            <span class="p">]</span>
</span><span id="League.possible_pickups-2206"><a href="#League.possible_pickups-2206"><span class="linenos">2206</span></a>            <span class="o">+</span> <span class="p">(</span>
</span><span id="League.possible_pickups-2207"><a href="#League.possible_pickups-2207"><span class="linenos">2207</span></a>                <span class="p">[</span><span class="s2">&quot;winner&quot;</span><span class="p">,</span> <span class="s2">&quot;runner_up&quot;</span><span class="p">,</span> <span class="s2">&quot;third&quot;</span><span class="p">,</span> <span class="s2">&quot;earnings&quot;</span><span class="p">]</span>
</span><span id="League.possible_pickups-2208"><a href="#League.possible_pickups-2208"><span class="linenos">2208</span></a>                <span class="o">+</span> <span class="p">(</span>
</span><span id="League.possible_pickups-2209"><a href="#League.possible_pickups-2209"><span class="linenos">2209</span></a>                    <span class="p">[</span><span class="s2">&quot;many_mile&quot;</span><span class="p">]</span>
</span><span id="League.possible_pickups-2210"><a href="#League.possible_pickups-2210"><span class="linenos">2210</span></a>                    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">team_1</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;The Algorithm&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
</span><span id="League.possible_pickups-2211"><a href="#League.possible_pickups-2211"><span class="linenos">2211</span></a>                    <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">team_2</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;The Algorithm&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">())</span> \
</span><span id="League.possible_pickups-2212"><a href="#League.possible_pickups-2212"><span class="linenos">2212</span></a>                    <span class="ow">and</span> <span class="ow">not</span> <span class="n">bestball</span> <span class="k">else</span> <span class="p">[]</span>
</span><span id="League.possible_pickups-2213"><a href="#League.possible_pickups-2213"><span class="linenos">2213</span></a>                <span class="p">)</span>
</span><span id="League.possible_pickups-2214"><a href="#League.possible_pickups-2214"><span class="linenos">2214</span></a>                <span class="k">if</span> <span class="n">postseason</span>
</span><span id="League.possible_pickups-2215"><a href="#League.possible_pickups-2215"><span class="linenos">2215</span></a>                <span class="k">else</span> <span class="p">[]</span>
</span><span id="League.possible_pickups-2216"><a href="#League.possible_pickups-2216"><span class="linenos">2216</span></a>            <span class="p">)</span>
</span><span id="League.possible_pickups-2217"><a href="#League.possible_pickups-2217"><span class="linenos">2217</span></a>        <span class="p">)</span>
</span><span id="League.possible_pickups-2218"><a href="#League.possible_pickups-2218"><span class="linenos">2218</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">team_name</span><span class="p">:</span>
</span><span id="League.possible_pickups-2219"><a href="#League.possible_pickups-2219"><span class="linenos">2219</span></a>            <span class="n">team_name</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="League.possible_pickups-2220"><a href="#League.possible_pickups-2220"><span class="linenos">2220</span></a>                <span class="n">team</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
</span><span id="League.possible_pickups-2221"><a href="#League.possible_pickups-2221"><span class="linenos">2221</span></a>                <span class="k">for</span> <span class="n">team</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">teams</span>
</span><span id="League.possible_pickups-2222"><a href="#League.possible_pickups-2222"><span class="linenos">2222</span></a>                <span class="k">if</span> <span class="n">team</span><span class="p">[</span><span class="s2">&quot;team_key&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">lg</span><span class="o">.</span><span class="n">team_key</span><span class="p">()</span>
</span><span id="League.possible_pickups-2223"><a href="#League.possible_pickups-2223"><span class="linenos">2223</span></a>            <span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League.possible_pickups-2224"><a href="#League.possible_pickups-2224"><span class="linenos">2224</span></a>        <span class="n">players_to_drop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">fantasy_team</span> <span class="o">==</span> <span class="n">team_name</span><span class="p">]</span>
</span><span id="League.possible_pickups-2225"><a href="#League.possible_pickups-2225"><span class="linenos">2225</span></a>        <span class="k">if</span> <span class="n">players_to_drop</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">focus_on</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="League.possible_pickups-2226"><a href="#League.possible_pickups-2226"><span class="linenos">2226</span></a>            <span class="n">players_to_drop</span> <span class="o">=</span> <span class="n">players_to_drop</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">players_to_drop</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">focus_on</span><span class="p">)]</span>
</span><span id="League.possible_pickups-2227"><a href="#League.possible_pickups-2227"><span class="linenos">2227</span></a>        <span class="k">if</span> <span class="n">players_to_drop</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">exclude</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="League.possible_pickups-2228"><a href="#League.possible_pickups-2228"><span class="linenos">2228</span></a>            <span class="n">players_to_drop</span> <span class="o">=</span> <span class="n">players_to_drop</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">players_to_drop</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">exclude</span><span class="p">)]</span>
</span><span id="League.possible_pickups-2229"><a href="#League.possible_pickups-2229"><span class="linenos">2229</span></a>        <span class="n">available</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">fantasy_team</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span> \
</span><span id="League.possible_pickups-2230"><a href="#League.possible_pickups-2230"><span class="linenos">2230</span></a>        <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">until</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span> <span class="o">|</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">until</span> <span class="o">&lt;</span> <span class="mi">17</span><span class="p">))</span> \
</span><span id="League.possible_pickups-2231"><a href="#League.possible_pickups-2231"><span class="linenos">2231</span></a>        <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">pct_rostered</span> <span class="o">&gt;=</span> <span class="n">min_rostership</span><span class="p">)]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="League.possible_pickups-2232"><a href="#League.possible_pickups-2232"><span class="linenos">2232</span></a>        <span class="k">for</span> <span class="n">my_player</span> <span class="ow">in</span> <span class="n">players_to_drop</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
</span><span id="League.possible_pickups-2233"><a href="#League.possible_pickups-2233"><span class="linenos">2233</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">refresh_oauth</span><span class="p">(</span><span class="mi">55</span><span class="p">)</span>
</span><span id="League.possible_pickups-2234"><a href="#League.possible_pickups-2234"><span class="linenos">2234</span></a>            <span class="k">if</span> <span class="p">(</span>
</span><span id="League.possible_pickups-2235"><a href="#League.possible_pickups-2235"><span class="linenos">2235</span></a>                <span class="n">players_to_drop</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">players_to_drop</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">my_player</span><span class="p">,</span> <span class="s2">&quot;until&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span>
</span><span id="League.possible_pickups-2236"><a href="#League.possible_pickups-2236"><span class="linenos">2236</span></a>                    <span class="mi">0</span>
</span><span id="League.possible_pickups-2237"><a href="#League.possible_pickups-2237"><span class="linenos">2237</span></a>                <span class="p">]</span>
</span><span id="League.possible_pickups-2238"><a href="#League.possible_pickups-2238"><span class="linenos">2238</span></a>                <span class="o">&gt;=</span> <span class="n">as_of</span> <span class="o">%</span> <span class="mi">100</span>
</span><span id="League.possible_pickups-2239"><a href="#League.possible_pickups-2239"><span class="linenos">2239</span></a>            <span class="p">):</span>
</span><span id="League.possible_pickups-2240"><a href="#League.possible_pickups-2240"><span class="linenos">2240</span></a>                <span class="n">possible</span> <span class="o">=</span> <span class="n">available</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">available</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;Average_&quot;</span><span class="p">)]</span>
</span><span id="League.possible_pickups-2241"><a href="#League.possible_pickups-2241"><span class="linenos">2241</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="League.possible_pickups-2242"><a href="#League.possible_pickups-2242"><span class="linenos">2242</span></a>                <span class="n">possible</span> <span class="o">=</span> <span class="n">available</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League.possible_pickups-2243"><a href="#League.possible_pickups-2243"><span class="linenos">2243</span></a>                    <span class="o">~</span><span class="n">available</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;Average_&quot;</span><span class="p">)</span>
</span><span id="League.possible_pickups-2244"><a href="#League.possible_pickups-2244"><span class="linenos">2244</span></a>                    <span class="o">&amp;</span> <span class="p">(</span>
</span><span id="League.possible_pickups-2245"><a href="#League.possible_pickups-2245"><span class="linenos">2245</span></a>                        <span class="n">available</span><span class="o">.</span><span class="n">WAR</span>
</span><span id="League.possible_pickups-2246"><a href="#League.possible_pickups-2246"><span class="linenos">2246</span></a>                        <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League.possible_pickups-2247"><a href="#League.possible_pickups-2247"><span class="linenos">2247</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">my_player</span><span class="p">,</span> <span class="s2">&quot;WAR&quot;</span>
</span><span id="League.possible_pickups-2248"><a href="#League.possible_pickups-2248"><span class="linenos">2248</span></a>                        <span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League.possible_pickups-2249"><a href="#League.possible_pickups-2249"><span class="linenos">2249</span></a>                        <span class="o">-</span> <span class="mf">0.5</span>
</span><span id="League.possible_pickups-2250"><a href="#League.possible_pickups-2250"><span class="linenos">2250</span></a>                    <span class="p">)</span>
</span><span id="League.possible_pickups-2251"><a href="#League.possible_pickups-2251"><span class="linenos">2251</span></a>                <span class="p">]</span>
</span><span id="League.possible_pickups-2252"><a href="#League.possible_pickups-2252"><span class="linenos">2252</span></a>            <span class="k">if</span> <span class="n">available</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">focus_on</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="League.possible_pickups-2253"><a href="#League.possible_pickups-2253"><span class="linenos">2253</span></a>                <span class="n">possible</span> <span class="o">=</span> <span class="n">possible</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">possible</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">focus_on</span><span class="p">)]</span>
</span><span id="League.possible_pickups-2254"><a href="#League.possible_pickups-2254"><span class="linenos">2254</span></a>            <span class="k">if</span> <span class="n">possible</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">exclude</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="League.possible_pickups-2255"><a href="#League.possible_pickups-2255"><span class="linenos">2255</span></a>                <span class="n">possible</span> <span class="o">=</span> <span class="n">possible</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">possible</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">exclude</span><span class="p">)]</span>
</span><span id="League.possible_pickups-2256"><a href="#League.possible_pickups-2256"><span class="linenos">2256</span></a>            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="League.possible_pickups-2257"><a href="#League.possible_pickups-2257"><span class="linenos">2257</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">my_player</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">possible</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; better players&quot;</span><span class="p">)</span>
</span><span id="League.possible_pickups-2258"><a href="#League.possible_pickups-2258"><span class="linenos">2258</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">())</span>
</span><span id="League.possible_pickups-2259"><a href="#League.possible_pickups-2259"><span class="linenos">2259</span></a>            <span class="n">possible</span> <span class="o">=</span> <span class="n">possible</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;position&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">limit_per</span><span class="p">)</span>
</span><span id="League.possible_pickups-2260"><a href="#League.possible_pickups-2260"><span class="linenos">2260</span></a>            <span class="k">for</span> <span class="n">free_agent</span> <span class="ow">in</span> <span class="n">possible</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
</span><span id="League.possible_pickups-2261"><a href="#League.possible_pickups-2261"><span class="linenos">2261</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">my_player</span><span class="p">,</span> <span class="s2">&quot;fantasy_team&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="League.possible_pickups-2262"><a href="#League.possible_pickups-2262"><span class="linenos">2262</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League.possible_pickups-2263"><a href="#League.possible_pickups-2263"><span class="linenos">2263</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">free_agent</span><span class="p">,</span> <span class="s2">&quot;fantasy_team&quot;</span>
</span><span id="League.possible_pickups-2264"><a href="#League.possible_pickups-2264"><span class="linenos">2264</span></a>                <span class="p">]</span> <span class="o">=</span> <span class="n">team_name</span>
</span><span id="League.possible_pickups-2265"><a href="#League.possible_pickups-2265"><span class="linenos">2265</span></a>                <span class="k">if</span> <span class="n">bestball</span><span class="p">:</span>
</span><span id="League.possible_pickups-2266"><a href="#League.possible_pickups-2266"><span class="linenos">2266</span></a>                    <span class="n">new_standings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bestball_sims</span><span class="p">(</span><span class="n">payouts</span><span class="p">)</span>
</span><span id="League.possible_pickups-2267"><a href="#League.possible_pickups-2267"><span class="linenos">2267</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="League.possible_pickups-2268"><a href="#League.possible_pickups-2268"><span class="linenos">2268</span></a>                    <span class="n">new_standings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">season_sims</span><span class="p">(</span><span class="n">postseason</span><span class="p">,</span> <span class="n">payouts</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="League.possible_pickups-2269"><a href="#League.possible_pickups-2269"><span class="linenos">2269</span></a>                <span class="n">added_value</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">added_value</span><span class="p">,</span>
</span><span id="League.possible_pickups-2270"><a href="#League.possible_pickups-2270"><span class="linenos">2270</span></a>                    <span class="n">new_standings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">new_standings</span><span class="o">.</span><span class="n">team</span> <span class="o">==</span> <span class="n">team_name</span><span class="p">]],</span>
</span><span id="League.possible_pickups-2271"><a href="#League.possible_pickups-2271"><span class="linenos">2271</span></a>                    <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="League.possible_pickups-2272"><a href="#League.possible_pickups-2272"><span class="linenos">2272</span></a>                    <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="League.possible_pickups-2273"><a href="#League.possible_pickups-2273"><span class="linenos">2273</span></a>                <span class="p">)</span>
</span><span id="League.possible_pickups-2274"><a href="#League.possible_pickups-2274"><span class="linenos">2274</span></a>                <span class="n">added_value</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">added_value</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;player_to_drop&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">my_player</span>
</span><span id="League.possible_pickups-2275"><a href="#League.possible_pickups-2275"><span class="linenos">2275</span></a>                <span class="n">added_value</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">added_value</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;player_to_add&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">free_agent</span>
</span><span id="League.possible_pickups-2276"><a href="#League.possible_pickups-2276"><span class="linenos">2276</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League.possible_pickups-2277"><a href="#League.possible_pickups-2277"><span class="linenos">2277</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">my_player</span><span class="p">,</span> <span class="s2">&quot;fantasy_team&quot;</span>
</span><span id="League.possible_pickups-2278"><a href="#League.possible_pickups-2278"><span class="linenos">2278</span></a>                <span class="p">]</span> <span class="o">=</span> <span class="n">team_name</span>
</span><span id="League.possible_pickups-2279"><a href="#League.possible_pickups-2279"><span class="linenos">2279</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">free_agent</span><span class="p">,</span> <span class="s2">&quot;fantasy_team&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="League.possible_pickups-2280"><a href="#League.possible_pickups-2280"><span class="linenos">2280</span></a>            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="League.possible_pickups-2281"><a href="#League.possible_pickups-2281"><span class="linenos">2281</span></a>                <span class="n">temp</span> <span class="o">=</span> <span class="n">added_value</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">possible</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">:][</span>
</span><span id="League.possible_pickups-2282"><a href="#League.possible_pickups-2282"><span class="linenos">2282</span></a>                    <span class="p">[</span><span class="s2">&quot;player_to_drop&quot;</span><span class="p">,</span> <span class="s2">&quot;player_to_add&quot;</span><span class="p">,</span> <span class="s2">&quot;earnings&quot;</span><span class="p">]</span>
</span><span id="League.possible_pickups-2283"><a href="#League.possible_pickups-2283"><span class="linenos">2283</span></a>                <span class="p">]</span>
</span><span id="League.possible_pickups-2284"><a href="#League.possible_pickups-2284"><span class="linenos">2284</span></a>                <span class="n">temp</span><span class="p">[</span><span class="s2">&quot;earnings&quot;</span><span class="p">]</span> <span class="o">-=</span> <span class="n">orig_standings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League.possible_pickups-2285"><a href="#League.possible_pickups-2285"><span class="linenos">2285</span></a>                    <span class="n">orig_standings</span><span class="o">.</span><span class="n">team</span> <span class="o">==</span> <span class="n">team_name</span><span class="p">,</span> <span class="s2">&quot;earnings&quot;</span>
</span><span id="League.possible_pickups-2286"><a href="#League.possible_pickups-2286"><span class="linenos">2286</span></a>                <span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League.possible_pickups-2287"><a href="#League.possible_pickups-2287"><span class="linenos">2287</span></a>                <span class="k">if</span> <span class="n">temp</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="League.possible_pickups-2288"><a href="#League.possible_pickups-2288"><span class="linenos">2288</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="League.possible_pickups-2289"><a href="#League.possible_pickups-2289"><span class="linenos">2289</span></a>                        <span class="n">temp</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;earnings&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span>
</span><span id="League.possible_pickups-2290"><a href="#League.possible_pickups-2290"><span class="linenos">2290</span></a>                            <span class="n">index</span><span class="o">=</span><span class="kc">False</span>
</span><span id="League.possible_pickups-2291"><a href="#League.possible_pickups-2291"><span class="linenos">2291</span></a>                        <span class="p">)</span>
</span><span id="League.possible_pickups-2292"><a href="#League.possible_pickups-2292"><span class="linenos">2292</span></a>                    <span class="p">)</span>
</span><span id="League.possible_pickups-2293"><a href="#League.possible_pickups-2293"><span class="linenos">2293</span></a>                <span class="k">del</span> <span class="n">temp</span>
</span><span id="League.possible_pickups-2294"><a href="#League.possible_pickups-2294"><span class="linenos">2294</span></a>        <span class="k">if</span> <span class="n">added_value</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="League.possible_pickups-2295"><a href="#League.possible_pickups-2295"><span class="linenos">2295</span></a>            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="League.possible_pickups-2296"><a href="#League.possible_pickups-2296"><span class="linenos">2296</span></a>                <span class="s2">&quot;wins_avg&quot;</span><span class="p">,</span>
</span><span id="League.possible_pickups-2297"><a href="#League.possible_pickups-2297"><span class="linenos">2297</span></a>                <span class="s2">&quot;wins_stdev&quot;</span><span class="p">,</span>
</span><span id="League.possible_pickups-2298"><a href="#League.possible_pickups-2298"><span class="linenos">2298</span></a>                <span class="s2">&quot;points_avg&quot;</span><span class="p">,</span>
</span><span id="League.possible_pickups-2299"><a href="#League.possible_pickups-2299"><span class="linenos">2299</span></a>                <span class="s2">&quot;points_stdev&quot;</span><span class="p">,</span>
</span><span id="League.possible_pickups-2300"><a href="#League.possible_pickups-2300"><span class="linenos">2300</span></a>                <span class="s2">&quot;playoffs&quot;</span><span class="p">,</span>
</span><span id="League.possible_pickups-2301"><a href="#League.possible_pickups-2301"><span class="linenos">2301</span></a>                <span class="s2">&quot;playoff_bye&quot;</span><span class="p">,</span>
</span><span id="League.possible_pickups-2302"><a href="#League.possible_pickups-2302"><span class="linenos">2302</span></a>            <span class="p">]</span> <span class="o">+</span> <span class="p">(</span>
</span><span id="League.possible_pickups-2303"><a href="#League.possible_pickups-2303"><span class="linenos">2303</span></a>                <span class="p">[</span><span class="s2">&quot;winner&quot;</span><span class="p">,</span> <span class="s2">&quot;runner_up&quot;</span><span class="p">,</span> <span class="s2">&quot;third&quot;</span><span class="p">,</span> <span class="s2">&quot;earnings&quot;</span><span class="p">]</span>
</span><span id="League.possible_pickups-2304"><a href="#League.possible_pickups-2304"><span class="linenos">2304</span></a>                <span class="o">+</span> <span class="p">(</span>
</span><span id="League.possible_pickups-2305"><a href="#League.possible_pickups-2305"><span class="linenos">2305</span></a>                    <span class="p">[</span><span class="s2">&quot;many_mile&quot;</span><span class="p">]</span>
</span><span id="League.possible_pickups-2306"><a href="#League.possible_pickups-2306"><span class="linenos">2306</span></a>                    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">team_1</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;The Algorithm&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
</span><span id="League.possible_pickups-2307"><a href="#League.possible_pickups-2307"><span class="linenos">2307</span></a>                    <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">team_2</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;The Algorithm&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">())</span> \
</span><span id="League.possible_pickups-2308"><a href="#League.possible_pickups-2308"><span class="linenos">2308</span></a>                    <span class="ow">and</span> <span class="ow">not</span> <span class="n">bestball</span> <span class="k">else</span> <span class="p">[]</span>
</span><span id="League.possible_pickups-2309"><a href="#League.possible_pickups-2309"><span class="linenos">2309</span></a>                <span class="p">)</span>
</span><span id="League.possible_pickups-2310"><a href="#League.possible_pickups-2310"><span class="linenos">2310</span></a>                <span class="k">if</span> <span class="n">postseason</span>
</span><span id="League.possible_pickups-2311"><a href="#League.possible_pickups-2311"><span class="linenos">2311</span></a>                <span class="k">else</span> <span class="p">[]</span>
</span><span id="League.possible_pickups-2312"><a href="#League.possible_pickups-2312"><span class="linenos">2312</span></a>            <span class="p">):</span>
</span><span id="League.possible_pickups-2313"><a href="#League.possible_pickups-2313"><span class="linenos">2313</span></a>                <span class="n">added_value</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">-=</span> <span class="n">orig_standings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League.possible_pickups-2314"><a href="#League.possible_pickups-2314"><span class="linenos">2314</span></a>                    <span class="n">orig_standings</span><span class="o">.</span><span class="n">team</span> <span class="o">==</span> <span class="n">team_name</span><span class="p">,</span> <span class="n">col</span>
</span><span id="League.possible_pickups-2315"><a href="#League.possible_pickups-2315"><span class="linenos">2315</span></a>                <span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League.possible_pickups-2316"><a href="#League.possible_pickups-2316"><span class="linenos">2316</span></a>                <span class="n">added_value</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">added_value</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="mi">4</span><span class="p">)</span>
</span><span id="League.possible_pickups-2317"><a href="#League.possible_pickups-2317"><span class="linenos">2317</span></a>            <span class="n">added_value</span> <span class="o">=</span> <span class="n">added_value</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
</span><span id="League.possible_pickups-2318"><a href="#League.possible_pickups-2318"><span class="linenos">2318</span></a>                <span class="n">by</span><span class="o">=</span><span class="s2">&quot;winner&quot;</span> <span class="k">if</span> <span class="n">postseason</span> <span class="k">else</span> <span class="s2">&quot;playoffs&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span>
</span><span id="League.possible_pickups-2319"><a href="#League.possible_pickups-2319"><span class="linenos">2319</span></a>            <span class="p">)</span>
</span><span id="League.possible_pickups-2320"><a href="#League.possible_pickups-2320"><span class="linenos">2320</span></a>        <span class="k">return</span> <span class="n">added_value</span>
</span></pre></div>


            <div class="docstring"><p>Simulates the remainder of the season with the current roster and compares it to 
a simulation of the roster after a series of potential add &amp; drop transactions.</p>

<p>Args:
    focus_on (list, optional): list of players to include in every potential trade, defaults to []. <br />
    exclude (list, optional): list of players to exclude from every potential trade, defaults to []. <br />
    limit_per (int, optional): number of players per position to analyze, defaults to 10. <br />
    team_name (str, optional): name of team to analyze trades for, defaults to None (and therefore team of interest). <br />
    postseason (bool, optional): whether to analyze postseason gains or just regular season, defaults to True. <br />
    verbose (bool, optional): whether to print out a status report as the code runs, defaults to True. <br />
    payouts (list, optional): list of payout amounts for top three finishers, defaults to [800, 300, 100]. <br />
    bestball (bool, optional): whether to use best ball settings during simulation, defaults to False.</p>

<p>Returns:
    pd.DataFrame: dataframe containing the impact and value of every add &amp; drop combination analyzed.</p>
</div>


                            </div>
                            <div id="League.possible_adds" class="classattr">
                                        <input id="League.possible_adds-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">possible_adds</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">focus_on</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span>,</span><span class="param">	<span class="n">exclude</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span>,</span><span class="param">	<span class="n">limit_per</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span>,</span><span class="param">	<span class="n">team_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">postseason</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">payouts</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">800</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">100</span><span class="p">]</span>,</span><span class="param">	<span class="n">bestball</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">min_rostership</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.05</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="League.possible_adds-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#League.possible_adds"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="League.possible_adds-2322"><a href="#League.possible_adds-2322"><span class="linenos">2322</span></a>    <span class="k">def</span> <span class="nf">possible_adds</span><span class="p">(</span>
</span><span id="League.possible_adds-2323"><a href="#League.possible_adds-2323"><span class="linenos">2323</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="League.possible_adds-2324"><a href="#League.possible_adds-2324"><span class="linenos">2324</span></a>        <span class="n">focus_on</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[],</span>
</span><span id="League.possible_adds-2325"><a href="#League.possible_adds-2325"><span class="linenos">2325</span></a>        <span class="n">exclude</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[],</span>
</span><span id="League.possible_adds-2326"><a href="#League.possible_adds-2326"><span class="linenos">2326</span></a>        <span class="n">limit_per</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="League.possible_adds-2327"><a href="#League.possible_adds-2327"><span class="linenos">2327</span></a>        <span class="n">team_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="League.possible_adds-2328"><a href="#League.possible_adds-2328"><span class="linenos">2328</span></a>        <span class="n">postseason</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="League.possible_adds-2329"><a href="#League.possible_adds-2329"><span class="linenos">2329</span></a>        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="League.possible_adds-2330"><a href="#League.possible_adds-2330"><span class="linenos">2330</span></a>        <span class="n">payouts</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">800</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
</span><span id="League.possible_adds-2331"><a href="#League.possible_adds-2331"><span class="linenos">2331</span></a>        <span class="n">bestball</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="League.possible_adds-2332"><a href="#League.possible_adds-2332"><span class="linenos">2332</span></a>        <span class="n">min_rostership</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span>
</span><span id="League.possible_adds-2333"><a href="#League.possible_adds-2333"><span class="linenos">2333</span></a>    <span class="p">):</span>
</span><span id="League.possible_adds-2334"><a href="#League.possible_adds-2334"><span class="linenos">2334</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="League.possible_adds-2335"><a href="#League.possible_adds-2335"><span class="linenos">2335</span></a><span class="sd">        Simulates the remainder of the season with the current roster and compares it to </span>
</span><span id="League.possible_adds-2336"><a href="#League.possible_adds-2336"><span class="linenos">2336</span></a><span class="sd">        a simulation of the roster after a series of potential add transactions.</span>
</span><span id="League.possible_adds-2337"><a href="#League.possible_adds-2337"><span class="linenos">2337</span></a>
</span><span id="League.possible_adds-2338"><a href="#League.possible_adds-2338"><span class="linenos">2338</span></a><span class="sd">        Args:</span>
</span><span id="League.possible_adds-2339"><a href="#League.possible_adds-2339"><span class="linenos">2339</span></a><span class="sd">            focus_on (list, optional): list of players to include in every potential trade, defaults to [].  </span>
</span><span id="League.possible_adds-2340"><a href="#League.possible_adds-2340"><span class="linenos">2340</span></a><span class="sd">            exclude (list, optional): list of players to exclude from every potential trade, defaults to [].  </span>
</span><span id="League.possible_adds-2341"><a href="#League.possible_adds-2341"><span class="linenos">2341</span></a><span class="sd">            limit_per (int, optional): number of players per position to analyze, defaults to 10.  </span>
</span><span id="League.possible_adds-2342"><a href="#League.possible_adds-2342"><span class="linenos">2342</span></a><span class="sd">            team_name (str, optional): name of team to analyze trades for, defaults to None (and therefore team of interest).  </span>
</span><span id="League.possible_adds-2343"><a href="#League.possible_adds-2343"><span class="linenos">2343</span></a><span class="sd">            postseason (bool, optional): whether to analyze postseason gains or just regular season, defaults to True.  </span>
</span><span id="League.possible_adds-2344"><a href="#League.possible_adds-2344"><span class="linenos">2344</span></a><span class="sd">            verbose (bool, optional): whether to print out a status report as the code runs, defaults to True.  </span>
</span><span id="League.possible_adds-2345"><a href="#League.possible_adds-2345"><span class="linenos">2345</span></a><span class="sd">            payouts (list, optional): list of payout amounts for top three finishers, defaults to [800, 300, 100].  </span>
</span><span id="League.possible_adds-2346"><a href="#League.possible_adds-2346"><span class="linenos">2346</span></a><span class="sd">            bestball (bool, optional): whether to use best ball settings during simulation, defaults to False.</span>
</span><span id="League.possible_adds-2347"><a href="#League.possible_adds-2347"><span class="linenos">2347</span></a>
</span><span id="League.possible_adds-2348"><a href="#League.possible_adds-2348"><span class="linenos">2348</span></a><span class="sd">        Returns:</span>
</span><span id="League.possible_adds-2349"><a href="#League.possible_adds-2349"><span class="linenos">2349</span></a><span class="sd">            pd.DataFrame: dataframe containing the impact and value of every possible add analyzed.</span>
</span><span id="League.possible_adds-2350"><a href="#League.possible_adds-2350"><span class="linenos">2350</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="League.possible_adds-2351"><a href="#League.possible_adds-2351"><span class="linenos">2351</span></a>        <span class="n">as_of</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">season</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">week</span>
</span><span id="League.possible_adds-2352"><a href="#League.possible_adds-2352"><span class="linenos">2352</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_oauth</span><span class="p">()</span>
</span><span id="League.possible_adds-2353"><a href="#League.possible_adds-2353"><span class="linenos">2353</span></a>        <span class="k">if</span> <span class="n">bestball</span><span class="p">:</span>
</span><span id="League.possible_adds-2354"><a href="#League.possible_adds-2354"><span class="linenos">2354</span></a>            <span class="n">orig_standings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bestball_sims</span><span class="p">(</span><span class="n">payouts</span><span class="p">)</span>
</span><span id="League.possible_adds-2355"><a href="#League.possible_adds-2355"><span class="linenos">2355</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="League.possible_adds-2356"><a href="#League.possible_adds-2356"><span class="linenos">2356</span></a>            <span class="n">orig_standings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">season_sims</span><span class="p">(</span><span class="n">postseason</span><span class="p">,</span> <span class="n">payouts</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="League.possible_adds-2357"><a href="#League.possible_adds-2357"><span class="linenos">2357</span></a>        <span class="n">added_value</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span><span id="League.possible_adds-2358"><a href="#League.possible_adds-2358"><span class="linenos">2358</span></a>            <span class="n">columns</span><span class="o">=</span><span class="p">[</span>
</span><span id="League.possible_adds-2359"><a href="#League.possible_adds-2359"><span class="linenos">2359</span></a>                <span class="s2">&quot;player_to_add&quot;</span><span class="p">,</span>
</span><span id="League.possible_adds-2360"><a href="#League.possible_adds-2360"><span class="linenos">2360</span></a>                <span class="s2">&quot;wins_avg&quot;</span><span class="p">,</span>
</span><span id="League.possible_adds-2361"><a href="#League.possible_adds-2361"><span class="linenos">2361</span></a>                <span class="s2">&quot;wins_stdev&quot;</span><span class="p">,</span>
</span><span id="League.possible_adds-2362"><a href="#League.possible_adds-2362"><span class="linenos">2362</span></a>                <span class="s2">&quot;points_avg&quot;</span><span class="p">,</span>
</span><span id="League.possible_adds-2363"><a href="#League.possible_adds-2363"><span class="linenos">2363</span></a>                <span class="s2">&quot;points_stdev&quot;</span><span class="p">,</span>
</span><span id="League.possible_adds-2364"><a href="#League.possible_adds-2364"><span class="linenos">2364</span></a>                <span class="s2">&quot;per_game_avg&quot;</span><span class="p">,</span>
</span><span id="League.possible_adds-2365"><a href="#League.possible_adds-2365"><span class="linenos">2365</span></a>                <span class="s2">&quot;per_game_stdev&quot;</span><span class="p">,</span>
</span><span id="League.possible_adds-2366"><a href="#League.possible_adds-2366"><span class="linenos">2366</span></a>                <span class="s2">&quot;per_game_fano&quot;</span><span class="p">,</span>
</span><span id="League.possible_adds-2367"><a href="#League.possible_adds-2367"><span class="linenos">2367</span></a>                <span class="s2">&quot;playoffs&quot;</span><span class="p">,</span>
</span><span id="League.possible_adds-2368"><a href="#League.possible_adds-2368"><span class="linenos">2368</span></a>                <span class="s2">&quot;playoff_bye&quot;</span><span class="p">,</span>
</span><span id="League.possible_adds-2369"><a href="#League.possible_adds-2369"><span class="linenos">2369</span></a>            <span class="p">]</span>
</span><span id="League.possible_adds-2370"><a href="#League.possible_adds-2370"><span class="linenos">2370</span></a>            <span class="o">+</span> <span class="p">(</span>
</span><span id="League.possible_adds-2371"><a href="#League.possible_adds-2371"><span class="linenos">2371</span></a>                <span class="p">[</span><span class="s2">&quot;winner&quot;</span><span class="p">,</span> <span class="s2">&quot;runner_up&quot;</span><span class="p">,</span> <span class="s2">&quot;third&quot;</span><span class="p">,</span> <span class="s2">&quot;earnings&quot;</span><span class="p">]</span>
</span><span id="League.possible_adds-2372"><a href="#League.possible_adds-2372"><span class="linenos">2372</span></a>                <span class="o">+</span> <span class="p">(</span>
</span><span id="League.possible_adds-2373"><a href="#League.possible_adds-2373"><span class="linenos">2373</span></a>                    <span class="p">[</span><span class="s2">&quot;many_mile&quot;</span><span class="p">]</span>
</span><span id="League.possible_adds-2374"><a href="#League.possible_adds-2374"><span class="linenos">2374</span></a>                    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">team_1</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;The Algorithm&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
</span><span id="League.possible_adds-2375"><a href="#League.possible_adds-2375"><span class="linenos">2375</span></a>                    <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">team_2</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;The Algorithm&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">())</span> \
</span><span id="League.possible_adds-2376"><a href="#League.possible_adds-2376"><span class="linenos">2376</span></a>                    <span class="ow">and</span> <span class="ow">not</span> <span class="n">bestball</span> <span class="k">else</span> <span class="p">[]</span>
</span><span id="League.possible_adds-2377"><a href="#League.possible_adds-2377"><span class="linenos">2377</span></a>                <span class="p">)</span>
</span><span id="League.possible_adds-2378"><a href="#League.possible_adds-2378"><span class="linenos">2378</span></a>                <span class="k">if</span> <span class="n">postseason</span>
</span><span id="League.possible_adds-2379"><a href="#League.possible_adds-2379"><span class="linenos">2379</span></a>                <span class="k">else</span> <span class="p">[]</span>
</span><span id="League.possible_adds-2380"><a href="#League.possible_adds-2380"><span class="linenos">2380</span></a>            <span class="p">)</span>
</span><span id="League.possible_adds-2381"><a href="#League.possible_adds-2381"><span class="linenos">2381</span></a>        <span class="p">)</span>
</span><span id="League.possible_adds-2382"><a href="#League.possible_adds-2382"><span class="linenos">2382</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">team_name</span><span class="p">:</span>
</span><span id="League.possible_adds-2383"><a href="#League.possible_adds-2383"><span class="linenos">2383</span></a>            <span class="n">team_name</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="League.possible_adds-2384"><a href="#League.possible_adds-2384"><span class="linenos">2384</span></a>                <span class="n">team</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
</span><span id="League.possible_adds-2385"><a href="#League.possible_adds-2385"><span class="linenos">2385</span></a>                <span class="k">for</span> <span class="n">team</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">teams</span>
</span><span id="League.possible_adds-2386"><a href="#League.possible_adds-2386"><span class="linenos">2386</span></a>                <span class="k">if</span> <span class="n">team</span><span class="p">[</span><span class="s2">&quot;team_key&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">lg</span><span class="o">.</span><span class="n">team_key</span><span class="p">()</span>
</span><span id="League.possible_adds-2387"><a href="#League.possible_adds-2387"><span class="linenos">2387</span></a>            <span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League.possible_adds-2388"><a href="#League.possible_adds-2388"><span class="linenos">2388</span></a>        <span class="n">available</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">fantasy_team</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span> \
</span><span id="League.possible_adds-2389"><a href="#League.possible_adds-2389"><span class="linenos">2389</span></a>        <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">until</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span> <span class="o">|</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">until</span> <span class="o">&lt;</span> <span class="mi">17</span><span class="p">))</span> \
</span><span id="League.possible_adds-2390"><a href="#League.possible_adds-2390"><span class="linenos">2390</span></a>        <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">pct_rostered</span> <span class="o">&gt;=</span> <span class="n">min_rostership</span><span class="p">)]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="League.possible_adds-2391"><a href="#League.possible_adds-2391"><span class="linenos">2391</span></a>        <span class="n">possible</span> <span class="o">=</span> <span class="n">available</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">available</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;Average_&quot;</span><span class="p">)]</span>
</span><span id="League.possible_adds-2392"><a href="#League.possible_adds-2392"><span class="linenos">2392</span></a>        <span class="k">if</span> <span class="n">possible</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">focus_on</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="League.possible_adds-2393"><a href="#League.possible_adds-2393"><span class="linenos">2393</span></a>            <span class="n">possible</span> <span class="o">=</span> <span class="n">possible</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">possible</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">focus_on</span><span class="p">)]</span>
</span><span id="League.possible_adds-2394"><a href="#League.possible_adds-2394"><span class="linenos">2394</span></a>        <span class="k">if</span> <span class="n">possible</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">exclude</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="League.possible_adds-2395"><a href="#League.possible_adds-2395"><span class="linenos">2395</span></a>            <span class="n">possible</span> <span class="o">=</span> <span class="n">possible</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">possible</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">exclude</span><span class="p">)]</span>
</span><span id="League.possible_adds-2396"><a href="#League.possible_adds-2396"><span class="linenos">2396</span></a>        <span class="n">possible</span> <span class="o">=</span> <span class="n">possible</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;position&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">limit_per</span><span class="p">)</span>
</span><span id="League.possible_adds-2397"><a href="#League.possible_adds-2397"><span class="linenos">2397</span></a>        <span class="k">for</span> <span class="n">free_agent</span> <span class="ow">in</span> <span class="n">possible</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
</span><span id="League.possible_adds-2398"><a href="#League.possible_adds-2398"><span class="linenos">2398</span></a>            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="League.possible_adds-2399"><a href="#League.possible_adds-2399"><span class="linenos">2399</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">, </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">free_agent</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()))</span>
</span><span id="League.possible_adds-2400"><a href="#League.possible_adds-2400"><span class="linenos">2400</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League.possible_adds-2401"><a href="#League.possible_adds-2401"><span class="linenos">2401</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">free_agent</span><span class="p">,</span> <span class="s2">&quot;fantasy_team&quot;</span>
</span><span id="League.possible_adds-2402"><a href="#League.possible_adds-2402"><span class="linenos">2402</span></a>            <span class="p">]</span> <span class="o">=</span> <span class="n">team_name</span>
</span><span id="League.possible_adds-2403"><a href="#League.possible_adds-2403"><span class="linenos">2403</span></a>            <span class="k">if</span> <span class="n">bestball</span><span class="p">:</span>
</span><span id="League.possible_adds-2404"><a href="#League.possible_adds-2404"><span class="linenos">2404</span></a>                <span class="n">new_standings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bestball_sims</span><span class="p">(</span><span class="n">payouts</span><span class="p">)</span>
</span><span id="League.possible_adds-2405"><a href="#League.possible_adds-2405"><span class="linenos">2405</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="League.possible_adds-2406"><a href="#League.possible_adds-2406"><span class="linenos">2406</span></a>                <span class="n">new_standings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">season_sims</span><span class="p">(</span><span class="n">postseason</span><span class="p">,</span> <span class="n">payouts</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="League.possible_adds-2407"><a href="#League.possible_adds-2407"><span class="linenos">2407</span></a>            <span class="n">added_value</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">added_value</span><span class="p">,</span>
</span><span id="League.possible_adds-2408"><a href="#League.possible_adds-2408"><span class="linenos">2408</span></a>                <span class="n">new_standings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">new_standings</span><span class="o">.</span><span class="n">team</span> <span class="o">==</span> <span class="n">team_name</span><span class="p">]],</span>
</span><span id="League.possible_adds-2409"><a href="#League.possible_adds-2409"><span class="linenos">2409</span></a>                <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="League.possible_adds-2410"><a href="#League.possible_adds-2410"><span class="linenos">2410</span></a>                <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="League.possible_adds-2411"><a href="#League.possible_adds-2411"><span class="linenos">2411</span></a>            <span class="p">)</span>
</span><span id="League.possible_adds-2412"><a href="#League.possible_adds-2412"><span class="linenos">2412</span></a>            <span class="n">added_value</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">added_value</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;player_to_add&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">free_agent</span>
</span><span id="League.possible_adds-2413"><a href="#League.possible_adds-2413"><span class="linenos">2413</span></a>            <span class="n">added_value</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">added_value</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;position&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">possible</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League.possible_adds-2414"><a href="#League.possible_adds-2414"><span class="linenos">2414</span></a>                <span class="n">possible</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">free_agent</span><span class="p">,</span> <span class="s2">&quot;position&quot;</span>
</span><span id="League.possible_adds-2415"><a href="#League.possible_adds-2415"><span class="linenos">2415</span></a>            <span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League.possible_adds-2416"><a href="#League.possible_adds-2416"><span class="linenos">2416</span></a>            <span class="n">added_value</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">added_value</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;current_team&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">possible</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League.possible_adds-2417"><a href="#League.possible_adds-2417"><span class="linenos">2417</span></a>                <span class="n">possible</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">free_agent</span><span class="p">,</span> <span class="s2">&quot;current_team&quot;</span>
</span><span id="League.possible_adds-2418"><a href="#League.possible_adds-2418"><span class="linenos">2418</span></a>            <span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League.possible_adds-2419"><a href="#League.possible_adds-2419"><span class="linenos">2419</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">free_agent</span><span class="p">,</span> <span class="s2">&quot;fantasy_team&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="League.possible_adds-2420"><a href="#League.possible_adds-2420"><span class="linenos">2420</span></a>        <span class="k">if</span> <span class="n">added_value</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="League.possible_adds-2421"><a href="#League.possible_adds-2421"><span class="linenos">2421</span></a>            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="League.possible_adds-2422"><a href="#League.possible_adds-2422"><span class="linenos">2422</span></a>                <span class="s2">&quot;wins_avg&quot;</span><span class="p">,</span>
</span><span id="League.possible_adds-2423"><a href="#League.possible_adds-2423"><span class="linenos">2423</span></a>                <span class="s2">&quot;wins_stdev&quot;</span><span class="p">,</span>
</span><span id="League.possible_adds-2424"><a href="#League.possible_adds-2424"><span class="linenos">2424</span></a>                <span class="s2">&quot;points_avg&quot;</span><span class="p">,</span>
</span><span id="League.possible_adds-2425"><a href="#League.possible_adds-2425"><span class="linenos">2425</span></a>                <span class="s2">&quot;points_stdev&quot;</span><span class="p">,</span>
</span><span id="League.possible_adds-2426"><a href="#League.possible_adds-2426"><span class="linenos">2426</span></a>                <span class="s2">&quot;playoffs&quot;</span><span class="p">,</span>
</span><span id="League.possible_adds-2427"><a href="#League.possible_adds-2427"><span class="linenos">2427</span></a>                <span class="s2">&quot;playoff_bye&quot;</span><span class="p">,</span>
</span><span id="League.possible_adds-2428"><a href="#League.possible_adds-2428"><span class="linenos">2428</span></a>            <span class="p">]</span> <span class="o">+</span> <span class="p">(</span>
</span><span id="League.possible_adds-2429"><a href="#League.possible_adds-2429"><span class="linenos">2429</span></a>                <span class="p">[</span><span class="s2">&quot;winner&quot;</span><span class="p">,</span> <span class="s2">&quot;runner_up&quot;</span><span class="p">,</span> <span class="s2">&quot;third&quot;</span><span class="p">,</span> <span class="s2">&quot;earnings&quot;</span><span class="p">]</span>
</span><span id="League.possible_adds-2430"><a href="#League.possible_adds-2430"><span class="linenos">2430</span></a>                <span class="o">+</span> <span class="p">(</span>
</span><span id="League.possible_adds-2431"><a href="#League.possible_adds-2431"><span class="linenos">2431</span></a>                    <span class="p">[</span><span class="s2">&quot;many_mile&quot;</span><span class="p">]</span>
</span><span id="League.possible_adds-2432"><a href="#League.possible_adds-2432"><span class="linenos">2432</span></a>                    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">team_1</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;The Algorithm&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
</span><span id="League.possible_adds-2433"><a href="#League.possible_adds-2433"><span class="linenos">2433</span></a>                    <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">team_2</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;The Algorithm&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">())</span> \
</span><span id="League.possible_adds-2434"><a href="#League.possible_adds-2434"><span class="linenos">2434</span></a>                    <span class="ow">and</span> <span class="ow">not</span> <span class="n">bestball</span> <span class="k">else</span> <span class="p">[]</span>
</span><span id="League.possible_adds-2435"><a href="#League.possible_adds-2435"><span class="linenos">2435</span></a>                <span class="p">)</span>
</span><span id="League.possible_adds-2436"><a href="#League.possible_adds-2436"><span class="linenos">2436</span></a>                <span class="k">if</span> <span class="n">postseason</span>
</span><span id="League.possible_adds-2437"><a href="#League.possible_adds-2437"><span class="linenos">2437</span></a>                <span class="k">else</span> <span class="p">[]</span>
</span><span id="League.possible_adds-2438"><a href="#League.possible_adds-2438"><span class="linenos">2438</span></a>            <span class="p">):</span>
</span><span id="League.possible_adds-2439"><a href="#League.possible_adds-2439"><span class="linenos">2439</span></a>                <span class="n">added_value</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">-=</span> <span class="n">orig_standings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League.possible_adds-2440"><a href="#League.possible_adds-2440"><span class="linenos">2440</span></a>                    <span class="n">orig_standings</span><span class="o">.</span><span class="n">team</span> <span class="o">==</span> <span class="n">team_name</span><span class="p">,</span> <span class="n">col</span>
</span><span id="League.possible_adds-2441"><a href="#League.possible_adds-2441"><span class="linenos">2441</span></a>                <span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League.possible_adds-2442"><a href="#League.possible_adds-2442"><span class="linenos">2442</span></a>                <span class="n">added_value</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">added_value</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="mi">4</span><span class="p">)</span>
</span><span id="League.possible_adds-2443"><a href="#League.possible_adds-2443"><span class="linenos">2443</span></a>            <span class="n">added_value</span> <span class="o">=</span> <span class="n">added_value</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
</span><span id="League.possible_adds-2444"><a href="#League.possible_adds-2444"><span class="linenos">2444</span></a>                <span class="n">by</span><span class="o">=</span><span class="s2">&quot;winner&quot;</span> <span class="k">if</span> <span class="n">postseason</span> <span class="k">else</span> <span class="s2">&quot;playoffs&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span>
</span><span id="League.possible_adds-2445"><a href="#League.possible_adds-2445"><span class="linenos">2445</span></a>            <span class="p">)</span>
</span><span id="League.possible_adds-2446"><a href="#League.possible_adds-2446"><span class="linenos">2446</span></a>            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="League.possible_adds-2447"><a href="#League.possible_adds-2447"><span class="linenos">2447</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="League.possible_adds-2448"><a href="#League.possible_adds-2448"><span class="linenos">2448</span></a>                    <span class="n">added_value</span><span class="p">[[</span><span class="s2">&quot;player_to_add&quot;</span><span class="p">,</span> <span class="s2">&quot;earnings&quot;</span><span class="p">]]</span>
</span><span id="League.possible_adds-2449"><a href="#League.possible_adds-2449"><span class="linenos">2449</span></a>                    <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;earnings&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="League.possible_adds-2450"><a href="#League.possible_adds-2450"><span class="linenos">2450</span></a>                    <span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="League.possible_adds-2451"><a href="#League.possible_adds-2451"><span class="linenos">2451</span></a>                <span class="p">)</span>
</span><span id="League.possible_adds-2452"><a href="#League.possible_adds-2452"><span class="linenos">2452</span></a>        <span class="k">return</span> <span class="n">added_value</span>
</span></pre></div>


            <div class="docstring"><p>Simulates the remainder of the season with the current roster and compares it to 
a simulation of the roster after a series of potential add transactions.</p>

<p>Args:
    focus_on (list, optional): list of players to include in every potential trade, defaults to []. <br />
    exclude (list, optional): list of players to exclude from every potential trade, defaults to []. <br />
    limit_per (int, optional): number of players per position to analyze, defaults to 10. <br />
    team_name (str, optional): name of team to analyze trades for, defaults to None (and therefore team of interest). <br />
    postseason (bool, optional): whether to analyze postseason gains or just regular season, defaults to True. <br />
    verbose (bool, optional): whether to print out a status report as the code runs, defaults to True. <br />
    payouts (list, optional): list of payout amounts for top three finishers, defaults to [800, 300, 100]. <br />
    bestball (bool, optional): whether to use best ball settings during simulation, defaults to False.</p>

<p>Returns:
    pd.DataFrame: dataframe containing the impact and value of every possible add analyzed.</p>
</div>


                            </div>
                            <div id="League.possible_drops" class="classattr">
                                        <input id="League.possible_drops-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">possible_drops</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">focus_on</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span>,</span><span class="param">	<span class="n">exclude</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span>,</span><span class="param">	<span class="n">team_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">postseason</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">payouts</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">800</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">100</span><span class="p">]</span>,</span><span class="param">	<span class="n">bestball</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="League.possible_drops-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#League.possible_drops"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="League.possible_drops-2454"><a href="#League.possible_drops-2454"><span class="linenos">2454</span></a>    <span class="k">def</span> <span class="nf">possible_drops</span><span class="p">(</span>
</span><span id="League.possible_drops-2455"><a href="#League.possible_drops-2455"><span class="linenos">2455</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="League.possible_drops-2456"><a href="#League.possible_drops-2456"><span class="linenos">2456</span></a>        <span class="n">focus_on</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[],</span>
</span><span id="League.possible_drops-2457"><a href="#League.possible_drops-2457"><span class="linenos">2457</span></a>        <span class="n">exclude</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[],</span>
</span><span id="League.possible_drops-2458"><a href="#League.possible_drops-2458"><span class="linenos">2458</span></a>        <span class="n">team_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="League.possible_drops-2459"><a href="#League.possible_drops-2459"><span class="linenos">2459</span></a>        <span class="n">postseason</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="League.possible_drops-2460"><a href="#League.possible_drops-2460"><span class="linenos">2460</span></a>        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="League.possible_drops-2461"><a href="#League.possible_drops-2461"><span class="linenos">2461</span></a>        <span class="n">payouts</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">800</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
</span><span id="League.possible_drops-2462"><a href="#League.possible_drops-2462"><span class="linenos">2462</span></a>        <span class="n">bestball</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="League.possible_drops-2463"><a href="#League.possible_drops-2463"><span class="linenos">2463</span></a>    <span class="p">):</span>
</span><span id="League.possible_drops-2464"><a href="#League.possible_drops-2464"><span class="linenos">2464</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="League.possible_drops-2465"><a href="#League.possible_drops-2465"><span class="linenos">2465</span></a><span class="sd">        Simulates the remainder of the season with the current roster and compares it to </span>
</span><span id="League.possible_drops-2466"><a href="#League.possible_drops-2466"><span class="linenos">2466</span></a><span class="sd">        a simulation of the roster after a series of potential drop transactions.</span>
</span><span id="League.possible_drops-2467"><a href="#League.possible_drops-2467"><span class="linenos">2467</span></a>
</span><span id="League.possible_drops-2468"><a href="#League.possible_drops-2468"><span class="linenos">2468</span></a><span class="sd">        Args:</span>
</span><span id="League.possible_drops-2469"><a href="#League.possible_drops-2469"><span class="linenos">2469</span></a><span class="sd">            focus_on (list, optional): list of players to include in every potential trade, defaults to [].  </span>
</span><span id="League.possible_drops-2470"><a href="#League.possible_drops-2470"><span class="linenos">2470</span></a><span class="sd">            exclude (list, optional): list of players to exclude from every potential trade, defaults to [].  </span>
</span><span id="League.possible_drops-2471"><a href="#League.possible_drops-2471"><span class="linenos">2471</span></a><span class="sd">            team_name (str, optional): name of team to analyze trades for, defaults to None (and therefore team of interest).  </span>
</span><span id="League.possible_drops-2472"><a href="#League.possible_drops-2472"><span class="linenos">2472</span></a><span class="sd">            postseason (bool, optional): whether to analyze postseason gains or just regular season, defaults to True.  </span>
</span><span id="League.possible_drops-2473"><a href="#League.possible_drops-2473"><span class="linenos">2473</span></a><span class="sd">            verbose (bool, optional): whether to print out a status report as the code runs, defaults to True.  </span>
</span><span id="League.possible_drops-2474"><a href="#League.possible_drops-2474"><span class="linenos">2474</span></a><span class="sd">            payouts (list, optional): list of payout amounts for top three finishers, defaults to [800, 300, 100].  </span>
</span><span id="League.possible_drops-2475"><a href="#League.possible_drops-2475"><span class="linenos">2475</span></a><span class="sd">            bestball (bool, optional): whether to use best ball settings during simulation, defaults to False.</span>
</span><span id="League.possible_drops-2476"><a href="#League.possible_drops-2476"><span class="linenos">2476</span></a>
</span><span id="League.possible_drops-2477"><a href="#League.possible_drops-2477"><span class="linenos">2477</span></a><span class="sd">        Returns:</span>
</span><span id="League.possible_drops-2478"><a href="#League.possible_drops-2478"><span class="linenos">2478</span></a><span class="sd">            pd.DataFrame: dataframe containing the impact and value of every possible drop analyzed.</span>
</span><span id="League.possible_drops-2479"><a href="#League.possible_drops-2479"><span class="linenos">2479</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="League.possible_drops-2480"><a href="#League.possible_drops-2480"><span class="linenos">2480</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_oauth</span><span class="p">()</span>
</span><span id="League.possible_drops-2481"><a href="#League.possible_drops-2481"><span class="linenos">2481</span></a>        <span class="k">if</span> <span class="n">bestball</span><span class="p">:</span>
</span><span id="League.possible_drops-2482"><a href="#League.possible_drops-2482"><span class="linenos">2482</span></a>            <span class="n">orig_standings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bestball_sims</span><span class="p">(</span><span class="n">payouts</span><span class="p">)</span>
</span><span id="League.possible_drops-2483"><a href="#League.possible_drops-2483"><span class="linenos">2483</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="League.possible_drops-2484"><a href="#League.possible_drops-2484"><span class="linenos">2484</span></a>            <span class="n">orig_standings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">season_sims</span><span class="p">(</span><span class="n">postseason</span><span class="p">,</span> <span class="n">payouts</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="League.possible_drops-2485"><a href="#League.possible_drops-2485"><span class="linenos">2485</span></a>        <span class="n">reduced_value</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span><span id="League.possible_drops-2486"><a href="#League.possible_drops-2486"><span class="linenos">2486</span></a>            <span class="n">columns</span><span class="o">=</span><span class="p">[</span>
</span><span id="League.possible_drops-2487"><a href="#League.possible_drops-2487"><span class="linenos">2487</span></a>                <span class="s2">&quot;player_to_drop&quot;</span><span class="p">,</span>
</span><span id="League.possible_drops-2488"><a href="#League.possible_drops-2488"><span class="linenos">2488</span></a>                <span class="s2">&quot;wins_avg&quot;</span><span class="p">,</span>
</span><span id="League.possible_drops-2489"><a href="#League.possible_drops-2489"><span class="linenos">2489</span></a>                <span class="s2">&quot;wins_stdev&quot;</span><span class="p">,</span>
</span><span id="League.possible_drops-2490"><a href="#League.possible_drops-2490"><span class="linenos">2490</span></a>                <span class="s2">&quot;points_avg&quot;</span><span class="p">,</span>
</span><span id="League.possible_drops-2491"><a href="#League.possible_drops-2491"><span class="linenos">2491</span></a>                <span class="s2">&quot;points_stdev&quot;</span><span class="p">,</span>
</span><span id="League.possible_drops-2492"><a href="#League.possible_drops-2492"><span class="linenos">2492</span></a>                <span class="s2">&quot;per_game_avg&quot;</span><span class="p">,</span>
</span><span id="League.possible_drops-2493"><a href="#League.possible_drops-2493"><span class="linenos">2493</span></a>                <span class="s2">&quot;per_game_stdev&quot;</span><span class="p">,</span>
</span><span id="League.possible_drops-2494"><a href="#League.possible_drops-2494"><span class="linenos">2494</span></a>                <span class="s2">&quot;per_game_fano&quot;</span><span class="p">,</span>
</span><span id="League.possible_drops-2495"><a href="#League.possible_drops-2495"><span class="linenos">2495</span></a>                <span class="s2">&quot;playoffs&quot;</span><span class="p">,</span>
</span><span id="League.possible_drops-2496"><a href="#League.possible_drops-2496"><span class="linenos">2496</span></a>                <span class="s2">&quot;playoff_bye&quot;</span><span class="p">,</span>
</span><span id="League.possible_drops-2497"><a href="#League.possible_drops-2497"><span class="linenos">2497</span></a>            <span class="p">]</span>
</span><span id="League.possible_drops-2498"><a href="#League.possible_drops-2498"><span class="linenos">2498</span></a>            <span class="o">+</span> <span class="p">(</span>
</span><span id="League.possible_drops-2499"><a href="#League.possible_drops-2499"><span class="linenos">2499</span></a>                <span class="p">[</span><span class="s2">&quot;winner&quot;</span><span class="p">,</span> <span class="s2">&quot;runner_up&quot;</span><span class="p">,</span> <span class="s2">&quot;third&quot;</span><span class="p">,</span> <span class="s2">&quot;earnings&quot;</span><span class="p">]</span>
</span><span id="League.possible_drops-2500"><a href="#League.possible_drops-2500"><span class="linenos">2500</span></a>                <span class="o">+</span> <span class="p">(</span>
</span><span id="League.possible_drops-2501"><a href="#League.possible_drops-2501"><span class="linenos">2501</span></a>                    <span class="p">[</span><span class="s2">&quot;many_mile&quot;</span><span class="p">]</span>
</span><span id="League.possible_drops-2502"><a href="#League.possible_drops-2502"><span class="linenos">2502</span></a>                    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">team_1</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;The Algorithm&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
</span><span id="League.possible_drops-2503"><a href="#League.possible_drops-2503"><span class="linenos">2503</span></a>                    <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">team_2</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;The Algorithm&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">())</span> \
</span><span id="League.possible_drops-2504"><a href="#League.possible_drops-2504"><span class="linenos">2504</span></a>                    <span class="ow">and</span> <span class="ow">not</span> <span class="n">bestball</span> <span class="k">else</span> <span class="p">[]</span>
</span><span id="League.possible_drops-2505"><a href="#League.possible_drops-2505"><span class="linenos">2505</span></a>                <span class="p">)</span>
</span><span id="League.possible_drops-2506"><a href="#League.possible_drops-2506"><span class="linenos">2506</span></a>                <span class="k">if</span> <span class="n">postseason</span>
</span><span id="League.possible_drops-2507"><a href="#League.possible_drops-2507"><span class="linenos">2507</span></a>                <span class="k">else</span> <span class="p">[]</span>
</span><span id="League.possible_drops-2508"><a href="#League.possible_drops-2508"><span class="linenos">2508</span></a>            <span class="p">)</span>
</span><span id="League.possible_drops-2509"><a href="#League.possible_drops-2509"><span class="linenos">2509</span></a>        <span class="p">)</span>
</span><span id="League.possible_drops-2510"><a href="#League.possible_drops-2510"><span class="linenos">2510</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">team_name</span><span class="p">:</span>
</span><span id="League.possible_drops-2511"><a href="#League.possible_drops-2511"><span class="linenos">2511</span></a>            <span class="n">team_name</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="League.possible_drops-2512"><a href="#League.possible_drops-2512"><span class="linenos">2512</span></a>                <span class="n">team</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
</span><span id="League.possible_drops-2513"><a href="#League.possible_drops-2513"><span class="linenos">2513</span></a>                <span class="k">for</span> <span class="n">team</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">teams</span>
</span><span id="League.possible_drops-2514"><a href="#League.possible_drops-2514"><span class="linenos">2514</span></a>                <span class="k">if</span> <span class="n">team</span><span class="p">[</span><span class="s2">&quot;team_key&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">lg</span><span class="o">.</span><span class="n">team_key</span><span class="p">()</span>
</span><span id="League.possible_drops-2515"><a href="#League.possible_drops-2515"><span class="linenos">2515</span></a>            <span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League.possible_drops-2516"><a href="#League.possible_drops-2516"><span class="linenos">2516</span></a>        <span class="n">players_to_drop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">fantasy_team</span> <span class="o">==</span> <span class="n">team_name</span><span class="p">]</span>
</span><span id="League.possible_drops-2517"><a href="#League.possible_drops-2517"><span class="linenos">2517</span></a>        <span class="k">if</span> <span class="n">players_to_drop</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">focus_on</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="League.possible_drops-2518"><a href="#League.possible_drops-2518"><span class="linenos">2518</span></a>            <span class="n">players_to_drop</span> <span class="o">=</span> <span class="n">players_to_drop</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">players_to_drop</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">focus_on</span><span class="p">)]</span>
</span><span id="League.possible_drops-2519"><a href="#League.possible_drops-2519"><span class="linenos">2519</span></a>        <span class="k">if</span> <span class="n">players_to_drop</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">exclude</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="League.possible_drops-2520"><a href="#League.possible_drops-2520"><span class="linenos">2520</span></a>            <span class="n">players_to_drop</span> <span class="o">=</span> <span class="n">players_to_drop</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">players_to_drop</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">exclude</span><span class="p">)]</span>
</span><span id="League.possible_drops-2521"><a href="#League.possible_drops-2521"><span class="linenos">2521</span></a>        <span class="k">for</span> <span class="n">my_player</span> <span class="ow">in</span> <span class="n">players_to_drop</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
</span><span id="League.possible_drops-2522"><a href="#League.possible_drops-2522"><span class="linenos">2522</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">my_player</span><span class="p">,</span> <span class="s2">&quot;fantasy_team&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="League.possible_drops-2523"><a href="#League.possible_drops-2523"><span class="linenos">2523</span></a>            <span class="k">if</span> <span class="n">bestball</span><span class="p">:</span>
</span><span id="League.possible_drops-2524"><a href="#League.possible_drops-2524"><span class="linenos">2524</span></a>                <span class="n">new_standings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bestball_sims</span><span class="p">(</span><span class="n">payouts</span><span class="p">)</span>
</span><span id="League.possible_drops-2525"><a href="#League.possible_drops-2525"><span class="linenos">2525</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="League.possible_drops-2526"><a href="#League.possible_drops-2526"><span class="linenos">2526</span></a>                <span class="n">new_standings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">season_sims</span><span class="p">(</span><span class="n">postseason</span><span class="p">,</span> <span class="n">payouts</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="League.possible_drops-2527"><a href="#League.possible_drops-2527"><span class="linenos">2527</span></a>            <span class="n">reduced_value</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">reduced_value</span><span class="p">,</span>
</span><span id="League.possible_drops-2528"><a href="#League.possible_drops-2528"><span class="linenos">2528</span></a>                <span class="n">new_standings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">new_standings</span><span class="o">.</span><span class="n">team</span> <span class="o">==</span> <span class="n">team_name</span><span class="p">]],</span>
</span><span id="League.possible_drops-2529"><a href="#League.possible_drops-2529"><span class="linenos">2529</span></a>                <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="League.possible_drops-2530"><a href="#League.possible_drops-2530"><span class="linenos">2530</span></a>                <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="League.possible_drops-2531"><a href="#League.possible_drops-2531"><span class="linenos">2531</span></a>            <span class="p">)</span>
</span><span id="League.possible_drops-2532"><a href="#League.possible_drops-2532"><span class="linenos">2532</span></a>            <span class="n">reduced_value</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">reduced_value</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;player_to_drop&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">my_player</span>
</span><span id="League.possible_drops-2533"><a href="#League.possible_drops-2533"><span class="linenos">2533</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">my_player</span><span class="p">,</span> <span class="s2">&quot;fantasy_team&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">team_name</span>
</span><span id="League.possible_drops-2534"><a href="#League.possible_drops-2534"><span class="linenos">2534</span></a>        <span class="k">if</span> <span class="n">reduced_value</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="League.possible_drops-2535"><a href="#League.possible_drops-2535"><span class="linenos">2535</span></a>            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="League.possible_drops-2536"><a href="#League.possible_drops-2536"><span class="linenos">2536</span></a>                <span class="s2">&quot;wins_avg&quot;</span><span class="p">,</span>
</span><span id="League.possible_drops-2537"><a href="#League.possible_drops-2537"><span class="linenos">2537</span></a>                <span class="s2">&quot;wins_stdev&quot;</span><span class="p">,</span>
</span><span id="League.possible_drops-2538"><a href="#League.possible_drops-2538"><span class="linenos">2538</span></a>                <span class="s2">&quot;points_avg&quot;</span><span class="p">,</span>
</span><span id="League.possible_drops-2539"><a href="#League.possible_drops-2539"><span class="linenos">2539</span></a>                <span class="s2">&quot;points_stdev&quot;</span><span class="p">,</span>
</span><span id="League.possible_drops-2540"><a href="#League.possible_drops-2540"><span class="linenos">2540</span></a>                <span class="s2">&quot;playoffs&quot;</span><span class="p">,</span>
</span><span id="League.possible_drops-2541"><a href="#League.possible_drops-2541"><span class="linenos">2541</span></a>                <span class="s2">&quot;playoff_bye&quot;</span><span class="p">,</span>
</span><span id="League.possible_drops-2542"><a href="#League.possible_drops-2542"><span class="linenos">2542</span></a>            <span class="p">]</span> <span class="o">+</span> <span class="p">(</span>
</span><span id="League.possible_drops-2543"><a href="#League.possible_drops-2543"><span class="linenos">2543</span></a>                <span class="p">[</span><span class="s2">&quot;winner&quot;</span><span class="p">,</span> <span class="s2">&quot;runner_up&quot;</span><span class="p">,</span> <span class="s2">&quot;third&quot;</span><span class="p">,</span> <span class="s2">&quot;earnings&quot;</span><span class="p">]</span>
</span><span id="League.possible_drops-2544"><a href="#League.possible_drops-2544"><span class="linenos">2544</span></a>                <span class="o">+</span> <span class="p">(</span>
</span><span id="League.possible_drops-2545"><a href="#League.possible_drops-2545"><span class="linenos">2545</span></a>                    <span class="p">[</span><span class="s2">&quot;many_mile&quot;</span><span class="p">]</span>
</span><span id="League.possible_drops-2546"><a href="#League.possible_drops-2546"><span class="linenos">2546</span></a>                    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">team_1</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;The Algorithm&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
</span><span id="League.possible_drops-2547"><a href="#League.possible_drops-2547"><span class="linenos">2547</span></a>                    <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">team_2</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;The Algorithm&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">())</span> \
</span><span id="League.possible_drops-2548"><a href="#League.possible_drops-2548"><span class="linenos">2548</span></a>                    <span class="ow">and</span> <span class="ow">not</span> <span class="n">bestball</span> <span class="k">else</span> <span class="p">[]</span>
</span><span id="League.possible_drops-2549"><a href="#League.possible_drops-2549"><span class="linenos">2549</span></a>                <span class="p">)</span>
</span><span id="League.possible_drops-2550"><a href="#League.possible_drops-2550"><span class="linenos">2550</span></a>                <span class="k">if</span> <span class="n">postseason</span>
</span><span id="League.possible_drops-2551"><a href="#League.possible_drops-2551"><span class="linenos">2551</span></a>                <span class="k">else</span> <span class="p">[]</span>
</span><span id="League.possible_drops-2552"><a href="#League.possible_drops-2552"><span class="linenos">2552</span></a>            <span class="p">):</span>
</span><span id="League.possible_drops-2553"><a href="#League.possible_drops-2553"><span class="linenos">2553</span></a>                <span class="n">reduced_value</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">-=</span> <span class="n">orig_standings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League.possible_drops-2554"><a href="#League.possible_drops-2554"><span class="linenos">2554</span></a>                    <span class="n">orig_standings</span><span class="o">.</span><span class="n">team</span> <span class="o">==</span> <span class="n">team_name</span><span class="p">,</span> <span class="n">col</span>
</span><span id="League.possible_drops-2555"><a href="#League.possible_drops-2555"><span class="linenos">2555</span></a>                <span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League.possible_drops-2556"><a href="#League.possible_drops-2556"><span class="linenos">2556</span></a>                <span class="n">reduced_value</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">reduced_value</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="mi">4</span><span class="p">)</span>
</span><span id="League.possible_drops-2557"><a href="#League.possible_drops-2557"><span class="linenos">2557</span></a>            <span class="n">reduced_value</span> <span class="o">=</span> <span class="n">reduced_value</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
</span><span id="League.possible_drops-2558"><a href="#League.possible_drops-2558"><span class="linenos">2558</span></a>                <span class="n">by</span><span class="o">=</span><span class="s2">&quot;winner&quot;</span> <span class="k">if</span> <span class="n">postseason</span> <span class="k">else</span> <span class="s2">&quot;playoffs&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span>
</span><span id="League.possible_drops-2559"><a href="#League.possible_drops-2559"><span class="linenos">2559</span></a>            <span class="p">)</span>
</span><span id="League.possible_drops-2560"><a href="#League.possible_drops-2560"><span class="linenos">2560</span></a>            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="League.possible_drops-2561"><a href="#League.possible_drops-2561"><span class="linenos">2561</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="League.possible_drops-2562"><a href="#League.possible_drops-2562"><span class="linenos">2562</span></a>                    <span class="n">reduced_value</span><span class="p">[[</span><span class="s2">&quot;player_to_drop&quot;</span><span class="p">,</span> <span class="s2">&quot;earnings&quot;</span><span class="p">]]</span>
</span><span id="League.possible_drops-2563"><a href="#League.possible_drops-2563"><span class="linenos">2563</span></a>                    <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;earnings&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="League.possible_drops-2564"><a href="#League.possible_drops-2564"><span class="linenos">2564</span></a>                    <span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="League.possible_drops-2565"><a href="#League.possible_drops-2565"><span class="linenos">2565</span></a>                <span class="p">)</span>
</span><span id="League.possible_drops-2566"><a href="#League.possible_drops-2566"><span class="linenos">2566</span></a>        <span class="k">return</span> <span class="n">reduced_value</span>
</span></pre></div>


            <div class="docstring"><p>Simulates the remainder of the season with the current roster and compares it to 
a simulation of the roster after a series of potential drop transactions.</p>

<p>Args:
    focus_on (list, optional): list of players to include in every potential trade, defaults to []. <br />
    exclude (list, optional): list of players to exclude from every potential trade, defaults to []. <br />
    team_name (str, optional): name of team to analyze trades for, defaults to None (and therefore team of interest). <br />
    postseason (bool, optional): whether to analyze postseason gains or just regular season, defaults to True. <br />
    verbose (bool, optional): whether to print out a status report as the code runs, defaults to True. <br />
    payouts (list, optional): list of payout amounts for top three finishers, defaults to [800, 300, 100]. <br />
    bestball (bool, optional): whether to use best ball settings during simulation, defaults to False.</p>

<p>Returns:
    pd.DataFrame: dataframe containing the impact and value of every possible drop analyzed.</p>
</div>


                            </div>
                            <div id="League.possible_trades" class="classattr">
                                        <input id="League.possible_trades-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">possible_trades</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">focus_on</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span>,</span><span class="param">	<span class="n">exclude</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span>,</span><span class="param">	<span class="n">given</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span>,</span><span class="param">	<span class="n">limit_per</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span>,</span><span class="param">	<span class="n">team_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">postseason</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">payouts</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">800</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">100</span><span class="p">]</span>,</span><span class="param">	<span class="n">bestball</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="League.possible_trades-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#League.possible_trades"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="League.possible_trades-2568"><a href="#League.possible_trades-2568"><span class="linenos">2568</span></a>    <span class="k">def</span> <span class="nf">possible_trades</span><span class="p">(</span>
</span><span id="League.possible_trades-2569"><a href="#League.possible_trades-2569"><span class="linenos">2569</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="League.possible_trades-2570"><a href="#League.possible_trades-2570"><span class="linenos">2570</span></a>        <span class="n">focus_on</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[],</span>
</span><span id="League.possible_trades-2571"><a href="#League.possible_trades-2571"><span class="linenos">2571</span></a>        <span class="n">exclude</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[],</span>
</span><span id="League.possible_trades-2572"><a href="#League.possible_trades-2572"><span class="linenos">2572</span></a>        <span class="n">given</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[],</span>
</span><span id="League.possible_trades-2573"><a href="#League.possible_trades-2573"><span class="linenos">2573</span></a>        <span class="n">limit_per</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="League.possible_trades-2574"><a href="#League.possible_trades-2574"><span class="linenos">2574</span></a>        <span class="n">team_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="League.possible_trades-2575"><a href="#League.possible_trades-2575"><span class="linenos">2575</span></a>        <span class="n">postseason</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="League.possible_trades-2576"><a href="#League.possible_trades-2576"><span class="linenos">2576</span></a>        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="League.possible_trades-2577"><a href="#League.possible_trades-2577"><span class="linenos">2577</span></a>        <span class="n">payouts</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">800</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
</span><span id="League.possible_trades-2578"><a href="#League.possible_trades-2578"><span class="linenos">2578</span></a>        <span class="n">bestball</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="League.possible_trades-2579"><a href="#League.possible_trades-2579"><span class="linenos">2579</span></a>    <span class="p">):</span>
</span><span id="League.possible_trades-2580"><a href="#League.possible_trades-2580"><span class="linenos">2580</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="League.possible_trades-2581"><a href="#League.possible_trades-2581"><span class="linenos">2581</span></a><span class="sd">        Simulates the remainder of the season with the current roster and compares it to </span>
</span><span id="League.possible_trades-2582"><a href="#League.possible_trades-2582"><span class="linenos">2582</span></a><span class="sd">        a simulation of the roster after a series of potential trade transactions.</span>
</span><span id="League.possible_trades-2583"><a href="#League.possible_trades-2583"><span class="linenos">2583</span></a>
</span><span id="League.possible_trades-2584"><a href="#League.possible_trades-2584"><span class="linenos">2584</span></a><span class="sd">        Args:</span>
</span><span id="League.possible_trades-2585"><a href="#League.possible_trades-2585"><span class="linenos">2585</span></a><span class="sd">            focus_on (list, optional): list of players to include in every potential trade, defaults to [].  </span>
</span><span id="League.possible_trades-2586"><a href="#League.possible_trades-2586"><span class="linenos">2586</span></a><span class="sd">            exclude (list, optional): list of players to exclude from every potential trade, defaults to [].  </span>
</span><span id="League.possible_trades-2587"><a href="#League.possible_trades-2587"><span class="linenos">2587</span></a><span class="sd">            given (list, optional): list of players to include in the trade in the background, defaults to [].  </span>
</span><span id="League.possible_trades-2588"><a href="#League.possible_trades-2588"><span class="linenos">2588</span></a><span class="sd">            limit_per (int, optional): number of players per position to analyze, defaults to 10.  </span>
</span><span id="League.possible_trades-2589"><a href="#League.possible_trades-2589"><span class="linenos">2589</span></a><span class="sd">            team_name (str, optional): name of team to analyze trades for, defaults to None (and therefore team of interest).  </span>
</span><span id="League.possible_trades-2590"><a href="#League.possible_trades-2590"><span class="linenos">2590</span></a><span class="sd">            postseason (bool, optional): whether to analyze postseason gains or just regular season, defaults to True.  </span>
</span><span id="League.possible_trades-2591"><a href="#League.possible_trades-2591"><span class="linenos">2591</span></a><span class="sd">            verbose (bool, optional): whether to print out a status report as the code runs, defaults to True.  </span>
</span><span id="League.possible_trades-2592"><a href="#League.possible_trades-2592"><span class="linenos">2592</span></a><span class="sd">            payouts (list, optional): list of payout amounts for top three finishers, defaults to [800, 300, 100].  </span>
</span><span id="League.possible_trades-2593"><a href="#League.possible_trades-2593"><span class="linenos">2593</span></a><span class="sd">            bestball (bool, optional): whether to use best ball settings during simulation, defaults to False.</span>
</span><span id="League.possible_trades-2594"><a href="#League.possible_trades-2594"><span class="linenos">2594</span></a>
</span><span id="League.possible_trades-2595"><a href="#League.possible_trades-2595"><span class="linenos">2595</span></a><span class="sd">        Returns:</span>
</span><span id="League.possible_trades-2596"><a href="#League.possible_trades-2596"><span class="linenos">2596</span></a><span class="sd">            pd.DataFrame: dataframe containing the impact and value of every possible trade analyzed.</span>
</span><span id="League.possible_trades-2597"><a href="#League.possible_trades-2597"><span class="linenos">2597</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="League.possible_trades-2598"><a href="#League.possible_trades-2598"><span class="linenos">2598</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_oauth</span><span class="p">()</span>
</span><span id="League.possible_trades-2599"><a href="#League.possible_trades-2599"><span class="linenos">2599</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">team_name</span><span class="p">:</span>
</span><span id="League.possible_trades-2600"><a href="#League.possible_trades-2600"><span class="linenos">2600</span></a>            <span class="n">team_name</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="League.possible_trades-2601"><a href="#League.possible_trades-2601"><span class="linenos">2601</span></a>                <span class="n">team</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
</span><span id="League.possible_trades-2602"><a href="#League.possible_trades-2602"><span class="linenos">2602</span></a>                <span class="k">for</span> <span class="n">team</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">teams</span>
</span><span id="League.possible_trades-2603"><a href="#League.possible_trades-2603"><span class="linenos">2603</span></a>                <span class="k">if</span> <span class="n">team</span><span class="p">[</span><span class="s2">&quot;team_key&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">lg</span><span class="o">.</span><span class="n">team_key</span><span class="p">()</span>
</span><span id="League.possible_trades-2604"><a href="#League.possible_trades-2604"><span class="linenos">2604</span></a>            <span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League.possible_trades-2605"><a href="#League.possible_trades-2605"><span class="linenos">2605</span></a>        <span class="n">my_players</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League.possible_trades-2606"><a href="#League.possible_trades-2606"><span class="linenos">2606</span></a>            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">fantasy_team</span> <span class="o">==</span> <span class="n">team_name</span><span class="p">)</span>
</span><span id="League.possible_trades-2607"><a href="#League.possible_trades-2607"><span class="linenos">2607</span></a>            <span class="o">&amp;</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;K&quot;</span><span class="p">,</span> <span class="s2">&quot;DEF&quot;</span><span class="p">])</span>
</span><span id="League.possible_trades-2608"><a href="#League.possible_trades-2608"><span class="linenos">2608</span></a>        <span class="p">]</span>
</span><span id="League.possible_trades-2609"><a href="#League.possible_trades-2609"><span class="linenos">2609</span></a>        <span class="k">if</span> <span class="n">my_players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">focus_on</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="League.possible_trades-2610"><a href="#League.possible_trades-2610"><span class="linenos">2610</span></a>            <span class="n">my_players</span> <span class="o">=</span> <span class="n">my_players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">my_players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">focus_on</span><span class="p">)]</span>
</span><span id="League.possible_trades-2611"><a href="#League.possible_trades-2611"><span class="linenos">2611</span></a>        <span class="k">if</span> <span class="n">my_players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">exclude</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="League.possible_trades-2612"><a href="#League.possible_trades-2612"><span class="linenos">2612</span></a>            <span class="n">my_players</span> <span class="o">=</span> <span class="n">my_players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">my_players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">exclude</span><span class="p">)]</span>
</span><span id="League.possible_trades-2613"><a href="#League.possible_trades-2613"><span class="linenos">2613</span></a>        <span class="n">their_players</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League.possible_trades-2614"><a href="#League.possible_trades-2614"><span class="linenos">2614</span></a>            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">fantasy_team</span> <span class="o">!=</span> <span class="n">team_name</span><span class="p">)</span>
</span><span id="League.possible_trades-2615"><a href="#League.possible_trades-2615"><span class="linenos">2615</span></a>            <span class="o">&amp;</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;K&quot;</span><span class="p">,</span> <span class="s2">&quot;DEF&quot;</span><span class="p">])</span>
</span><span id="League.possible_trades-2616"><a href="#League.possible_trades-2616"><span class="linenos">2616</span></a>        <span class="p">]</span>
</span><span id="League.possible_trades-2617"><a href="#League.possible_trades-2617"><span class="linenos">2617</span></a>        <span class="k">if</span> <span class="n">their_players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">focus_on</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="League.possible_trades-2618"><a href="#League.possible_trades-2618"><span class="linenos">2618</span></a>            <span class="n">their_players</span> <span class="o">=</span> <span class="n">their_players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">their_players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">focus_on</span><span class="p">)]</span>
</span><span id="League.possible_trades-2619"><a href="#League.possible_trades-2619"><span class="linenos">2619</span></a>        <span class="k">if</span> <span class="n">their_players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">exclude</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="League.possible_trades-2620"><a href="#League.possible_trades-2620"><span class="linenos">2620</span></a>            <span class="n">their_players</span> <span class="o">=</span> <span class="n">their_players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">their_players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">exclude</span><span class="p">)]</span>
</span><span id="League.possible_trades-2621"><a href="#League.possible_trades-2621"><span class="linenos">2621</span></a>        <span class="k">if</span> <span class="n">bestball</span><span class="p">:</span>
</span><span id="League.possible_trades-2622"><a href="#League.possible_trades-2622"><span class="linenos">2622</span></a>            <span class="n">orig_standings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bestball_sims</span><span class="p">(</span><span class="n">payouts</span><span class="p">)</span>
</span><span id="League.possible_trades-2623"><a href="#League.possible_trades-2623"><span class="linenos">2623</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="League.possible_trades-2624"><a href="#League.possible_trades-2624"><span class="linenos">2624</span></a>            <span class="n">orig_standings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">season_sims</span><span class="p">(</span><span class="n">postseason</span><span class="p">,</span> <span class="n">payouts</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="League.possible_trades-2625"><a href="#League.possible_trades-2625"><span class="linenos">2625</span></a>
</span><span id="League.possible_trades-2626"><a href="#League.possible_trades-2626"><span class="linenos">2626</span></a>        <span class="c1"># Make sure there are two teams and narrow down to that team!!!</span>
</span><span id="League.possible_trades-2627"><a href="#League.possible_trades-2627"><span class="linenos">2627</span></a>        <span class="n">given_check</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="League.possible_trades-2628"><a href="#League.possible_trades-2628"><span class="linenos">2628</span></a>            <span class="nb">type</span><span class="p">(</span><span class="n">given</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span>
</span><span id="League.possible_trades-2629"><a href="#League.possible_trades-2629"><span class="linenos">2629</span></a>            <span class="ow">and</span> <span class="n">my_players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">given</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
</span><span id="League.possible_trades-2630"><a href="#League.possible_trades-2630"><span class="linenos">2630</span></a>            <span class="ow">and</span> <span class="n">their_players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">their_players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">given</span><span class="p">),</span> <span class="s2">&quot;fantasy_team&quot;</span><span class="p">]</span>
</span><span id="League.possible_trades-2631"><a href="#League.possible_trades-2631"><span class="linenos">2631</span></a>            <span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</span><span id="League.possible_trades-2632"><a href="#League.possible_trades-2632"><span class="linenos">2632</span></a>            <span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League.possible_trades-2633"><a href="#League.possible_trades-2633"><span class="linenos">2633</span></a>            <span class="o">==</span> <span class="mi">1</span>
</span><span id="League.possible_trades-2634"><a href="#League.possible_trades-2634"><span class="linenos">2634</span></a>        <span class="p">)</span>
</span><span id="League.possible_trades-2635"><a href="#League.possible_trades-2635"><span class="linenos">2635</span></a>        <span class="k">if</span> <span class="n">given_check</span><span class="p">:</span>
</span><span id="League.possible_trades-2636"><a href="#League.possible_trades-2636"><span class="linenos">2636</span></a>            <span class="n">mine</span> <span class="o">=</span> <span class="p">[</span><span class="n">player</span> <span class="k">for</span> <span class="n">player</span> <span class="ow">in</span> <span class="n">given</span> <span class="k">if</span> <span class="n">my_players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="n">player</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">()]</span>
</span><span id="League.possible_trades-2637"><a href="#League.possible_trades-2637"><span class="linenos">2637</span></a>            <span class="n">theirs</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="League.possible_trades-2638"><a href="#League.possible_trades-2638"><span class="linenos">2638</span></a>                <span class="n">player</span> <span class="k">for</span> <span class="n">player</span> <span class="ow">in</span> <span class="n">given</span> <span class="k">if</span> <span class="n">their_players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="n">player</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
</span><span id="League.possible_trades-2639"><a href="#League.possible_trades-2639"><span class="linenos">2639</span></a>            <span class="p">]</span>
</span><span id="League.possible_trades-2640"><a href="#League.possible_trades-2640"><span class="linenos">2640</span></a>            <span class="n">their_team</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League.possible_trades-2641"><a href="#League.possible_trades-2641"><span class="linenos">2641</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">theirs</span><span class="p">),</span> <span class="s2">&quot;fantasy_team&quot;</span>
</span><span id="League.possible_trades-2642"><a href="#League.possible_trades-2642"><span class="linenos">2642</span></a>            <span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League.possible_trades-2643"><a href="#League.possible_trades-2643"><span class="linenos">2643</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">mine</span><span class="p">),</span> <span class="s2">&quot;fantasy_team&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">their_team</span>
</span><span id="League.possible_trades-2644"><a href="#League.possible_trades-2644"><span class="linenos">2644</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">theirs</span><span class="p">),</span> <span class="s2">&quot;fantasy_team&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">team_name</span>
</span><span id="League.possible_trades-2645"><a href="#League.possible_trades-2645"><span class="linenos">2645</span></a>            <span class="n">my_players</span> <span class="o">=</span> <span class="n">my_players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">my_players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">given</span><span class="p">)]</span>
</span><span id="League.possible_trades-2646"><a href="#League.possible_trades-2646"><span class="linenos">2646</span></a>            <span class="n">their_players</span> <span class="o">=</span> <span class="n">their_players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League.possible_trades-2647"><a href="#League.possible_trades-2647"><span class="linenos">2647</span></a>                <span class="p">(</span><span class="n">their_players</span><span class="o">.</span><span class="n">fantasy_team</span> <span class="o">==</span> <span class="n">their_team</span><span class="p">)</span>
</span><span id="League.possible_trades-2648"><a href="#League.possible_trades-2648"><span class="linenos">2648</span></a>                <span class="o">&amp;</span> <span class="o">~</span><span class="n">their_players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">given</span><span class="p">)</span>
</span><span id="League.possible_trades-2649"><a href="#League.possible_trades-2649"><span class="linenos">2649</span></a>            <span class="p">]</span>
</span><span id="League.possible_trades-2650"><a href="#League.possible_trades-2650"><span class="linenos">2650</span></a>            <span class="n">my_players</span><span class="p">[</span><span class="s2">&quot;WAR&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="League.possible_trades-2651"><a href="#League.possible_trades-2651"><span class="linenos">2651</span></a>            <span class="n">their_players</span><span class="p">[</span><span class="s2">&quot;WAR&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="League.possible_trades-2652"><a href="#League.possible_trades-2652"><span class="linenos">2652</span></a>        <span class="c1"># Make sure there are two teams and narrow down to that teams!!!</span>
</span><span id="League.possible_trades-2653"><a href="#League.possible_trades-2653"><span class="linenos">2653</span></a>
</span><span id="League.possible_trades-2654"><a href="#League.possible_trades-2654"><span class="linenos">2654</span></a>        <span class="n">my_added_value</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="League.possible_trades-2655"><a href="#League.possible_trades-2655"><span class="linenos">2655</span></a>        <span class="n">their_added_value</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="League.possible_trades-2656"><a href="#League.possible_trades-2656"><span class="linenos">2656</span></a>        <span class="k">for</span> <span class="n">my_player</span> <span class="ow">in</span> <span class="n">my_players</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
</span><span id="League.possible_trades-2657"><a href="#League.possible_trades-2657"><span class="linenos">2657</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">refresh_oauth</span><span class="p">(</span><span class="mi">55</span><span class="p">)</span>
</span><span id="League.possible_trades-2658"><a href="#League.possible_trades-2658"><span class="linenos">2658</span></a>            <span class="k">if</span> <span class="n">their_players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">focus_on</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="League.possible_trades-2659"><a href="#League.possible_trades-2659"><span class="linenos">2659</span></a>                <span class="n">possible</span> <span class="o">=</span> <span class="n">their_players</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="League.possible_trades-2660"><a href="#League.possible_trades-2660"><span class="linenos">2660</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="League.possible_trades-2661"><a href="#League.possible_trades-2661"><span class="linenos">2661</span></a>                <span class="n">possible</span> <span class="o">=</span> <span class="n">their_players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League.possible_trades-2662"><a href="#League.possible_trades-2662"><span class="linenos">2662</span></a>                    <span class="nb">abs</span><span class="p">(</span>
</span><span id="League.possible_trades-2663"><a href="#League.possible_trades-2663"><span class="linenos">2663</span></a>                        <span class="n">their_players</span><span class="o">.</span><span class="n">WAR</span>
</span><span id="League.possible_trades-2664"><a href="#League.possible_trades-2664"><span class="linenos">2664</span></a>                        <span class="o">-</span> <span class="n">my_players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">my_players</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">my_player</span><span class="p">,</span> <span class="s2">&quot;WAR&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League.possible_trades-2665"><a href="#League.possible_trades-2665"><span class="linenos">2665</span></a>                    <span class="p">)</span>
</span><span id="League.possible_trades-2666"><a href="#League.possible_trades-2666"><span class="linenos">2666</span></a>                    <span class="o">&lt;=</span> <span class="mf">0.5</span>
</span><span id="League.possible_trades-2667"><a href="#League.possible_trades-2667"><span class="linenos">2667</span></a>                <span class="p">]</span>
</span><span id="League.possible_trades-2668"><a href="#League.possible_trades-2668"><span class="linenos">2668</span></a>            <span class="c1"># possible = their_players.loc[their_players.WAR - my_players.loc[my_players.name == my_player,&#39;WAR&#39;].values[0] &gt; -1.0]</span>
</span><span id="League.possible_trades-2669"><a href="#League.possible_trades-2669"><span class="linenos">2669</span></a>            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="League.possible_trades-2670"><a href="#League.possible_trades-2670"><span class="linenos">2670</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">my_player</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">possible</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; comparable players&quot;</span><span class="p">)</span>
</span><span id="League.possible_trades-2671"><a href="#League.possible_trades-2671"><span class="linenos">2671</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">())</span>
</span><span id="League.possible_trades-2672"><a href="#League.possible_trades-2672"><span class="linenos">2672</span></a>            <span class="n">possible</span> <span class="o">=</span> <span class="n">possible</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;position&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">limit_per</span><span class="p">)</span>
</span><span id="League.possible_trades-2673"><a href="#League.possible_trades-2673"><span class="linenos">2673</span></a>            <span class="k">for</span> <span class="n">their_player</span> <span class="ow">in</span> <span class="n">possible</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
</span><span id="League.possible_trades-2674"><a href="#League.possible_trades-2674"><span class="linenos">2674</span></a>                <span class="n">their_team</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League.possible_trades-2675"><a href="#League.possible_trades-2675"><span class="linenos">2675</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">their_player</span><span class="p">,</span> <span class="s2">&quot;fantasy_team&quot;</span>
</span><span id="League.possible_trades-2676"><a href="#League.possible_trades-2676"><span class="linenos">2676</span></a>                <span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League.possible_trades-2677"><a href="#League.possible_trades-2677"><span class="linenos">2677</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League.possible_trades-2678"><a href="#League.possible_trades-2678"><span class="linenos">2678</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">my_player</span><span class="p">,</span> <span class="s2">&quot;fantasy_team&quot;</span>
</span><span id="League.possible_trades-2679"><a href="#League.possible_trades-2679"><span class="linenos">2679</span></a>                <span class="p">]</span> <span class="o">=</span> <span class="n">their_team</span>
</span><span id="League.possible_trades-2680"><a href="#League.possible_trades-2680"><span class="linenos">2680</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League.possible_trades-2681"><a href="#League.possible_trades-2681"><span class="linenos">2681</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">their_player</span><span class="p">,</span> <span class="s2">&quot;fantasy_team&quot;</span>
</span><span id="League.possible_trades-2682"><a href="#League.possible_trades-2682"><span class="linenos">2682</span></a>                <span class="p">]</span> <span class="o">=</span> <span class="n">team_name</span>
</span><span id="League.possible_trades-2683"><a href="#League.possible_trades-2683"><span class="linenos">2683</span></a>                <span class="k">if</span> <span class="n">bestball</span><span class="p">:</span>
</span><span id="League.possible_trades-2684"><a href="#League.possible_trades-2684"><span class="linenos">2684</span></a>                    <span class="n">new_standings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bestball_sims</span><span class="p">(</span><span class="n">payouts</span><span class="p">)</span>
</span><span id="League.possible_trades-2685"><a href="#League.possible_trades-2685"><span class="linenos">2685</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="League.possible_trades-2686"><a href="#League.possible_trades-2686"><span class="linenos">2686</span></a>                    <span class="n">new_standings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">season_sims</span><span class="p">(</span><span class="n">postseason</span><span class="p">,</span> <span class="n">payouts</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="League.possible_trades-2687"><a href="#League.possible_trades-2687"><span class="linenos">2687</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League.possible_trades-2688"><a href="#League.possible_trades-2688"><span class="linenos">2688</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">my_player</span><span class="p">,</span> <span class="s2">&quot;fantasy_team&quot;</span>
</span><span id="League.possible_trades-2689"><a href="#League.possible_trades-2689"><span class="linenos">2689</span></a>                <span class="p">]</span> <span class="o">=</span> <span class="n">team_name</span>
</span><span id="League.possible_trades-2690"><a href="#League.possible_trades-2690"><span class="linenos">2690</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League.possible_trades-2691"><a href="#League.possible_trades-2691"><span class="linenos">2691</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">their_player</span><span class="p">,</span> <span class="s2">&quot;fantasy_team&quot;</span>
</span><span id="League.possible_trades-2692"><a href="#League.possible_trades-2692"><span class="linenos">2692</span></a>                <span class="p">]</span> <span class="o">=</span> <span class="n">their_team</span>
</span><span id="League.possible_trades-2693"><a href="#League.possible_trades-2693"><span class="linenos">2693</span></a>                <span class="n">new_standings</span><span class="p">[</span><span class="s2">&quot;player_to_trade_away&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">my_player</span>
</span><span id="League.possible_trades-2694"><a href="#League.possible_trades-2694"><span class="linenos">2694</span></a>                <span class="n">new_standings</span><span class="p">[</span><span class="s2">&quot;player_to_trade_for&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">their_player</span>
</span><span id="League.possible_trades-2695"><a href="#League.possible_trades-2695"><span class="linenos">2695</span></a>                <span class="n">my_added_value</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">my_added_value</span><span class="p">,</span>
</span><span id="League.possible_trades-2696"><a href="#League.possible_trades-2696"><span class="linenos">2696</span></a>                    <span class="n">new_standings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">new_standings</span><span class="o">.</span><span class="n">team</span> <span class="o">==</span> <span class="n">team_name</span><span class="p">]],</span>
</span><span id="League.possible_trades-2697"><a href="#League.possible_trades-2697"><span class="linenos">2697</span></a>                    <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="League.possible_trades-2698"><a href="#League.possible_trades-2698"><span class="linenos">2698</span></a>                <span class="p">)</span>
</span><span id="League.possible_trades-2699"><a href="#League.possible_trades-2699"><span class="linenos">2699</span></a>                <span class="n">their_added_value</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">their_added_value</span><span class="p">,</span>
</span><span id="League.possible_trades-2700"><a href="#League.possible_trades-2700"><span class="linenos">2700</span></a>                    <span class="n">new_standings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">new_standings</span><span class="o">.</span><span class="n">team</span> <span class="o">==</span> <span class="n">their_team</span><span class="p">]],</span>
</span><span id="League.possible_trades-2701"><a href="#League.possible_trades-2701"><span class="linenos">2701</span></a>                    <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="League.possible_trades-2702"><a href="#League.possible_trades-2702"><span class="linenos">2702</span></a>                <span class="p">)</span>
</span><span id="League.possible_trades-2703"><a href="#League.possible_trades-2703"><span class="linenos">2703</span></a>            <span class="k">if</span> <span class="n">verbose</span> <span class="ow">and</span> <span class="n">possible</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="League.possible_trades-2704"><a href="#League.possible_trades-2704"><span class="linenos">2704</span></a>                <span class="n">me</span> <span class="o">=</span> <span class="n">my_added_value</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">possible</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">:][</span>
</span><span id="League.possible_trades-2705"><a href="#League.possible_trades-2705"><span class="linenos">2705</span></a>                    <span class="p">[</span><span class="s2">&quot;player_to_trade_away&quot;</span><span class="p">,</span> <span class="s2">&quot;player_to_trade_for&quot;</span><span class="p">,</span> <span class="s2">&quot;earnings&quot;</span><span class="p">]</span>
</span><span id="League.possible_trades-2706"><a href="#League.possible_trades-2706"><span class="linenos">2706</span></a>                <span class="p">]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;earnings&quot;</span><span class="p">:</span> <span class="s2">&quot;my_earnings&quot;</span><span class="p">})</span>
</span><span id="League.possible_trades-2707"><a href="#League.possible_trades-2707"><span class="linenos">2707</span></a>                <span class="n">them</span> <span class="o">=</span> <span class="n">their_added_value</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">possible</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">:][</span>
</span><span id="League.possible_trades-2708"><a href="#League.possible_trades-2708"><span class="linenos">2708</span></a>                    <span class="p">[</span><span class="s2">&quot;player_to_trade_away&quot;</span><span class="p">,</span> <span class="s2">&quot;player_to_trade_for&quot;</span><span class="p">,</span> <span class="s2">&quot;team&quot;</span><span class="p">,</span> <span class="s2">&quot;earnings&quot;</span><span class="p">]</span>
</span><span id="League.possible_trades-2709"><a href="#League.possible_trades-2709"><span class="linenos">2709</span></a>                <span class="p">]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;earnings&quot;</span><span class="p">:</span> <span class="s2">&quot;their_earnings&quot;</span><span class="p">})</span>
</span><span id="League.possible_trades-2710"><a href="#League.possible_trades-2710"><span class="linenos">2710</span></a>                <span class="n">me</span><span class="p">[</span><span class="s2">&quot;my_earnings&quot;</span><span class="p">]</span> <span class="o">-=</span> <span class="n">orig_standings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League.possible_trades-2711"><a href="#League.possible_trades-2711"><span class="linenos">2711</span></a>                    <span class="n">orig_standings</span><span class="o">.</span><span class="n">team</span> <span class="o">==</span> <span class="n">team_name</span><span class="p">,</span> <span class="s2">&quot;earnings&quot;</span>
</span><span id="League.possible_trades-2712"><a href="#League.possible_trades-2712"><span class="linenos">2712</span></a>                <span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League.possible_trades-2713"><a href="#League.possible_trades-2713"><span class="linenos">2713</span></a>                <span class="k">for</span> <span class="n">their_team</span> <span class="ow">in</span> <span class="n">them</span><span class="o">.</span><span class="n">team</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
</span><span id="League.possible_trades-2714"><a href="#League.possible_trades-2714"><span class="linenos">2714</span></a>                    <span class="n">them</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League.possible_trades-2715"><a href="#League.possible_trades-2715"><span class="linenos">2715</span></a>                        <span class="n">them</span><span class="o">.</span><span class="n">team</span> <span class="o">==</span> <span class="n">their_team</span><span class="p">,</span> <span class="s2">&quot;their_earnings&quot;</span>
</span><span id="League.possible_trades-2716"><a href="#League.possible_trades-2716"><span class="linenos">2716</span></a>                    <span class="p">]</span> <span class="o">-=</span> <span class="n">orig_standings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League.possible_trades-2717"><a href="#League.possible_trades-2717"><span class="linenos">2717</span></a>                        <span class="n">orig_standings</span><span class="o">.</span><span class="n">team</span> <span class="o">==</span> <span class="n">their_team</span><span class="p">,</span> <span class="s2">&quot;earnings&quot;</span>
</span><span id="League.possible_trades-2718"><a href="#League.possible_trades-2718"><span class="linenos">2718</span></a>                    <span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span>
</span><span id="League.possible_trades-2719"><a href="#League.possible_trades-2719"><span class="linenos">2719</span></a>                        <span class="mi">0</span>
</span><span id="League.possible_trades-2720"><a href="#League.possible_trades-2720"><span class="linenos">2720</span></a>                    <span class="p">]</span>
</span><span id="League.possible_trades-2721"><a href="#League.possible_trades-2721"><span class="linenos">2721</span></a>                <span class="n">temp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League.possible_trades-2722"><a href="#League.possible_trades-2722"><span class="linenos">2722</span></a>                    <span class="n">left</span><span class="o">=</span><span class="n">me</span><span class="p">,</span>
</span><span id="League.possible_trades-2723"><a href="#League.possible_trades-2723"><span class="linenos">2723</span></a>                    <span class="n">right</span><span class="o">=</span><span class="n">them</span><span class="p">,</span>
</span><span id="League.possible_trades-2724"><a href="#League.possible_trades-2724"><span class="linenos">2724</span></a>                    <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">,</span>
</span><span id="League.possible_trades-2725"><a href="#League.possible_trades-2725"><span class="linenos">2725</span></a>                    <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;player_to_trade_away&quot;</span><span class="p">,</span> <span class="s2">&quot;player_to_trade_for&quot;</span><span class="p">],</span>
</span><span id="League.possible_trades-2726"><a href="#League.possible_trades-2726"><span class="linenos">2726</span></a>                <span class="p">)</span>
</span><span id="League.possible_trades-2727"><a href="#League.possible_trades-2727"><span class="linenos">2727</span></a>                <span class="k">if</span> <span class="n">temp</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="League.possible_trades-2728"><a href="#League.possible_trades-2728"><span class="linenos">2728</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="League.possible_trades-2729"><a href="#League.possible_trades-2729"><span class="linenos">2729</span></a>                        <span class="n">temp</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;my_earnings&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span>
</span><span id="League.possible_trades-2730"><a href="#League.possible_trades-2730"><span class="linenos">2730</span></a>                            <span class="n">index</span><span class="o">=</span><span class="kc">False</span>
</span><span id="League.possible_trades-2731"><a href="#League.possible_trades-2731"><span class="linenos">2731</span></a>                        <span class="p">)</span>
</span><span id="League.possible_trades-2732"><a href="#League.possible_trades-2732"><span class="linenos">2732</span></a>                    <span class="p">)</span>
</span><span id="League.possible_trades-2733"><a href="#League.possible_trades-2733"><span class="linenos">2733</span></a>                <span class="k">del</span> <span class="n">me</span><span class="p">,</span> <span class="n">them</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">their_team</span>
</span><span id="League.possible_trades-2734"><a href="#League.possible_trades-2734"><span class="linenos">2734</span></a>
</span><span id="League.possible_trades-2735"><a href="#League.possible_trades-2735"><span class="linenos">2735</span></a>        <span class="k">if</span> <span class="n">given_check</span><span class="p">:</span>
</span><span id="League.possible_trades-2736"><a href="#League.possible_trades-2736"><span class="linenos">2736</span></a>            <span class="n">mine</span> <span class="o">=</span> <span class="p">[</span><span class="n">player</span> <span class="k">for</span> <span class="n">player</span> <span class="ow">in</span> <span class="n">given</span> <span class="k">if</span> <span class="n">my_players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="n">player</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">()]</span>
</span><span id="League.possible_trades-2737"><a href="#League.possible_trades-2737"><span class="linenos">2737</span></a>            <span class="n">theirs</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="League.possible_trades-2738"><a href="#League.possible_trades-2738"><span class="linenos">2738</span></a>                <span class="n">player</span> <span class="k">for</span> <span class="n">player</span> <span class="ow">in</span> <span class="n">given</span> <span class="k">if</span> <span class="n">their_players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="n">player</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
</span><span id="League.possible_trades-2739"><a href="#League.possible_trades-2739"><span class="linenos">2739</span></a>            <span class="p">]</span>
</span><span id="League.possible_trades-2740"><a href="#League.possible_trades-2740"><span class="linenos">2740</span></a>            <span class="n">their_team</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League.possible_trades-2741"><a href="#League.possible_trades-2741"><span class="linenos">2741</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">theirs</span><span class="p">),</span> <span class="s2">&quot;fantasy_team&quot;</span>
</span><span id="League.possible_trades-2742"><a href="#League.possible_trades-2742"><span class="linenos">2742</span></a>            <span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League.possible_trades-2743"><a href="#League.possible_trades-2743"><span class="linenos">2743</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">mine</span><span class="p">),</span> <span class="s2">&quot;fantasy_team&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">their_team</span>
</span><span id="League.possible_trades-2744"><a href="#League.possible_trades-2744"><span class="linenos">2744</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">theirs</span><span class="p">),</span> <span class="s2">&quot;fantasy_team&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">team_name</span>
</span><span id="League.possible_trades-2745"><a href="#League.possible_trades-2745"><span class="linenos">2745</span></a>
</span><span id="League.possible_trades-2746"><a href="#League.possible_trades-2746"><span class="linenos">2746</span></a>        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="League.possible_trades-2747"><a href="#League.possible_trades-2747"><span class="linenos">2747</span></a>            <span class="s2">&quot;wins_avg&quot;</span><span class="p">,</span>
</span><span id="League.possible_trades-2748"><a href="#League.possible_trades-2748"><span class="linenos">2748</span></a>            <span class="s2">&quot;wins_stdev&quot;</span><span class="p">,</span>
</span><span id="League.possible_trades-2749"><a href="#League.possible_trades-2749"><span class="linenos">2749</span></a>            <span class="s2">&quot;points_avg&quot;</span><span class="p">,</span>
</span><span id="League.possible_trades-2750"><a href="#League.possible_trades-2750"><span class="linenos">2750</span></a>            <span class="s2">&quot;points_stdev&quot;</span><span class="p">,</span>
</span><span id="League.possible_trades-2751"><a href="#League.possible_trades-2751"><span class="linenos">2751</span></a>            <span class="s2">&quot;per_game_avg&quot;</span><span class="p">,</span>
</span><span id="League.possible_trades-2752"><a href="#League.possible_trades-2752"><span class="linenos">2752</span></a>            <span class="s2">&quot;per_game_stdev&quot;</span><span class="p">,</span>
</span><span id="League.possible_trades-2753"><a href="#League.possible_trades-2753"><span class="linenos">2753</span></a>            <span class="s2">&quot;per_game_fano&quot;</span><span class="p">,</span>
</span><span id="League.possible_trades-2754"><a href="#League.possible_trades-2754"><span class="linenos">2754</span></a>            <span class="s2">&quot;playoffs&quot;</span><span class="p">,</span>
</span><span id="League.possible_trades-2755"><a href="#League.possible_trades-2755"><span class="linenos">2755</span></a>            <span class="s2">&quot;playoff_bye&quot;</span><span class="p">,</span>
</span><span id="League.possible_trades-2756"><a href="#League.possible_trades-2756"><span class="linenos">2756</span></a>        <span class="p">]</span> <span class="o">+</span> <span class="p">([</span><span class="s2">&quot;winner&quot;</span><span class="p">,</span> <span class="s2">&quot;runner_up&quot;</span><span class="p">,</span> <span class="s2">&quot;third&quot;</span><span class="p">,</span> <span class="s2">&quot;earnings&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">postseason</span> <span class="k">else</span> <span class="p">[]):</span>
</span><span id="League.possible_trades-2757"><a href="#League.possible_trades-2757"><span class="linenos">2757</span></a>            <span class="n">my_added_value</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">-=</span> <span class="n">orig_standings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League.possible_trades-2758"><a href="#League.possible_trades-2758"><span class="linenos">2758</span></a>                <span class="n">orig_standings</span><span class="o">.</span><span class="n">team</span> <span class="o">==</span> <span class="n">team_name</span><span class="p">,</span> <span class="n">col</span>
</span><span id="League.possible_trades-2759"><a href="#League.possible_trades-2759"><span class="linenos">2759</span></a>            <span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League.possible_trades-2760"><a href="#League.possible_trades-2760"><span class="linenos">2760</span></a>            <span class="n">my_added_value</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">my_added_value</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="mi">4</span><span class="p">)</span>
</span><span id="League.possible_trades-2761"><a href="#League.possible_trades-2761"><span class="linenos">2761</span></a>        <span class="k">for</span> <span class="n">their_team</span> <span class="ow">in</span> <span class="n">their_added_value</span><span class="o">.</span><span class="n">team</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
</span><span id="League.possible_trades-2762"><a href="#League.possible_trades-2762"><span class="linenos">2762</span></a>            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="League.possible_trades-2763"><a href="#League.possible_trades-2763"><span class="linenos">2763</span></a>                <span class="s2">&quot;wins_avg&quot;</span><span class="p">,</span>
</span><span id="League.possible_trades-2764"><a href="#League.possible_trades-2764"><span class="linenos">2764</span></a>                <span class="s2">&quot;wins_stdev&quot;</span><span class="p">,</span>
</span><span id="League.possible_trades-2765"><a href="#League.possible_trades-2765"><span class="linenos">2765</span></a>                <span class="s2">&quot;points_avg&quot;</span><span class="p">,</span>
</span><span id="League.possible_trades-2766"><a href="#League.possible_trades-2766"><span class="linenos">2766</span></a>                <span class="s2">&quot;points_stdev&quot;</span><span class="p">,</span>
</span><span id="League.possible_trades-2767"><a href="#League.possible_trades-2767"><span class="linenos">2767</span></a>                <span class="s2">&quot;per_game_avg&quot;</span><span class="p">,</span>
</span><span id="League.possible_trades-2768"><a href="#League.possible_trades-2768"><span class="linenos">2768</span></a>                <span class="s2">&quot;per_game_stdev&quot;</span><span class="p">,</span>
</span><span id="League.possible_trades-2769"><a href="#League.possible_trades-2769"><span class="linenos">2769</span></a>                <span class="s2">&quot;per_game_fano&quot;</span><span class="p">,</span>
</span><span id="League.possible_trades-2770"><a href="#League.possible_trades-2770"><span class="linenos">2770</span></a>                <span class="s2">&quot;playoffs&quot;</span><span class="p">,</span>
</span><span id="League.possible_trades-2771"><a href="#League.possible_trades-2771"><span class="linenos">2771</span></a>                <span class="s2">&quot;playoff_bye&quot;</span><span class="p">,</span>
</span><span id="League.possible_trades-2772"><a href="#League.possible_trades-2772"><span class="linenos">2772</span></a>            <span class="p">]</span> <span class="o">+</span> <span class="p">([</span><span class="s2">&quot;winner&quot;</span><span class="p">,</span> <span class="s2">&quot;runner_up&quot;</span><span class="p">,</span> <span class="s2">&quot;third&quot;</span><span class="p">,</span> <span class="s2">&quot;earnings&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">postseason</span> <span class="k">else</span> <span class="p">[]):</span>
</span><span id="League.possible_trades-2773"><a href="#League.possible_trades-2773"><span class="linenos">2773</span></a>                <span class="n">their_added_value</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="League.possible_trades-2774"><a href="#League.possible_trades-2774"><span class="linenos">2774</span></a>                    <span class="n">their_added_value</span><span class="o">.</span><span class="n">team</span> <span class="o">==</span> <span class="n">their_team</span><span class="p">,</span> <span class="n">col</span>
</span><span id="League.possible_trades-2775"><a href="#League.possible_trades-2775"><span class="linenos">2775</span></a>                <span class="p">]</span> <span class="o">-=</span> <span class="n">orig_standings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">orig_standings</span><span class="o">.</span><span class="n">team</span> <span class="o">==</span> <span class="n">their_team</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span>
</span><span id="League.possible_trades-2776"><a href="#League.possible_trades-2776"><span class="linenos">2776</span></a>                    <span class="mi">0</span>
</span><span id="League.possible_trades-2777"><a href="#League.possible_trades-2777"><span class="linenos">2777</span></a>                <span class="p">]</span>
</span><span id="League.possible_trades-2778"><a href="#League.possible_trades-2778"><span class="linenos">2778</span></a>                <span class="n">their_added_value</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">their_added_value</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="mi">4</span><span class="p">)</span>
</span><span id="League.possible_trades-2779"><a href="#League.possible_trades-2779"><span class="linenos">2779</span></a>        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="League.possible_trades-2780"><a href="#League.possible_trades-2780"><span class="linenos">2780</span></a>            <span class="s2">&quot;team&quot;</span><span class="p">,</span>
</span><span id="League.possible_trades-2781"><a href="#League.possible_trades-2781"><span class="linenos">2781</span></a>            <span class="s2">&quot;wins_avg&quot;</span><span class="p">,</span>
</span><span id="League.possible_trades-2782"><a href="#League.possible_trades-2782"><span class="linenos">2782</span></a>            <span class="s2">&quot;wins_stdev&quot;</span><span class="p">,</span>
</span><span id="League.possible_trades-2783"><a href="#League.possible_trades-2783"><span class="linenos">2783</span></a>            <span class="s2">&quot;points_avg&quot;</span><span class="p">,</span>
</span><span id="League.possible_trades-2784"><a href="#League.possible_trades-2784"><span class="linenos">2784</span></a>            <span class="s2">&quot;points_stdev&quot;</span><span class="p">,</span>
</span><span id="League.possible_trades-2785"><a href="#League.possible_trades-2785"><span class="linenos">2785</span></a>            <span class="s2">&quot;per_game_avg&quot;</span><span class="p">,</span>
</span><span id="League.possible_trades-2786"><a href="#League.possible_trades-2786"><span class="linenos">2786</span></a>            <span class="s2">&quot;per_game_stdev&quot;</span><span class="p">,</span>
</span><span id="League.possible_trades-2787"><a href="#League.possible_trades-2787"><span class="linenos">2787</span></a>            <span class="s2">&quot;per_game_fano&quot;</span><span class="p">,</span>
</span><span id="League.possible_trades-2788"><a href="#League.possible_trades-2788"><span class="linenos">2788</span></a>            <span class="s2">&quot;playoffs&quot;</span><span class="p">,</span>
</span><span id="League.possible_trades-2789"><a href="#League.possible_trades-2789"><span class="linenos">2789</span></a>            <span class="s2">&quot;playoff_bye&quot;</span><span class="p">,</span>
</span><span id="League.possible_trades-2790"><a href="#League.possible_trades-2790"><span class="linenos">2790</span></a>        <span class="p">]</span> <span class="o">+</span> <span class="p">([</span><span class="s2">&quot;winner&quot;</span><span class="p">,</span> <span class="s2">&quot;runner_up&quot;</span><span class="p">,</span> <span class="s2">&quot;third&quot;</span><span class="p">,</span> <span class="s2">&quot;earnings&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">postseason</span> <span class="k">else</span> <span class="p">[]):</span>
</span><span id="League.possible_trades-2791"><a href="#League.possible_trades-2791"><span class="linenos">2791</span></a>            <span class="n">my_added_value</span> <span class="o">=</span> <span class="n">my_added_value</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
</span><span id="League.possible_trades-2792"><a href="#League.possible_trades-2792"><span class="linenos">2792</span></a>                <span class="n">index</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">col</span><span class="p">:</span> <span class="s2">&quot;my_&quot;</span> <span class="o">+</span> <span class="n">col</span><span class="p">}</span>
</span><span id="League.possible_trades-2793"><a href="#League.possible_trades-2793"><span class="linenos">2793</span></a>            <span class="p">)</span>
</span><span id="League.possible_trades-2794"><a href="#League.possible_trades-2794"><span class="linenos">2794</span></a>            <span class="n">their_added_value</span> <span class="o">=</span> <span class="n">their_added_value</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
</span><span id="League.possible_trades-2795"><a href="#League.possible_trades-2795"><span class="linenos">2795</span></a>                <span class="n">index</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">col</span><span class="p">:</span> <span class="s2">&quot;their_&quot;</span> <span class="o">+</span> <span class="n">col</span><span class="p">}</span>
</span><span id="League.possible_trades-2796"><a href="#League.possible_trades-2796"><span class="linenos">2796</span></a>            <span class="p">)</span>
</span><span id="League.possible_trades-2797"><a href="#League.possible_trades-2797"><span class="linenos">2797</span></a>        <span class="n">added_value</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="League.possible_trades-2798"><a href="#League.possible_trades-2798"><span class="linenos">2798</span></a>            <span class="n">left</span><span class="o">=</span><span class="n">my_added_value</span><span class="p">,</span>
</span><span id="League.possible_trades-2799"><a href="#League.possible_trades-2799"><span class="linenos">2799</span></a>            <span class="n">right</span><span class="o">=</span><span class="n">their_added_value</span><span class="p">,</span>
</span><span id="League.possible_trades-2800"><a href="#League.possible_trades-2800"><span class="linenos">2800</span></a>            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">,</span>
</span><span id="League.possible_trades-2801"><a href="#League.possible_trades-2801"><span class="linenos">2801</span></a>            <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;player_to_trade_away&quot;</span><span class="p">,</span> <span class="s2">&quot;player_to_trade_for&quot;</span><span class="p">],</span>
</span><span id="League.possible_trades-2802"><a href="#League.possible_trades-2802"><span class="linenos">2802</span></a>        <span class="p">)</span>
</span><span id="League.possible_trades-2803"><a href="#League.possible_trades-2803"><span class="linenos">2803</span></a>        <span class="n">added_value</span> <span class="o">=</span> <span class="n">added_value</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
</span><span id="League.possible_trades-2804"><a href="#League.possible_trades-2804"><span class="linenos">2804</span></a>            <span class="n">by</span><span class="o">=</span><span class="s2">&quot;my_winner&quot;</span> <span class="k">if</span> <span class="n">postseason</span> <span class="k">else</span> <span class="s2">&quot;playoffs&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span>
</span><span id="League.possible_trades-2805"><a href="#League.possible_trades-2805"><span class="linenos">2805</span></a>        <span class="p">)</span>
</span><span id="League.possible_trades-2806"><a href="#League.possible_trades-2806"><span class="linenos">2806</span></a>        <span class="k">return</span> <span class="n">added_value</span>
</span></pre></div>


            <div class="docstring"><p>Simulates the remainder of the season with the current roster and compares it to 
a simulation of the roster after a series of potential trade transactions.</p>

<p>Args:
    focus_on (list, optional): list of players to include in every potential trade, defaults to []. <br />
    exclude (list, optional): list of players to exclude from every potential trade, defaults to []. <br />
    given (list, optional): list of players to include in the trade in the background, defaults to []. <br />
    limit_per (int, optional): number of players per position to analyze, defaults to 10. <br />
    team_name (str, optional): name of team to analyze trades for, defaults to None (and therefore team of interest). <br />
    postseason (bool, optional): whether to analyze postseason gains or just regular season, defaults to True. <br />
    verbose (bool, optional): whether to print out a status report as the code runs, defaults to True. <br />
    payouts (list, optional): list of payout amounts for top three finishers, defaults to [800, 300, 100]. <br />
    bestball (bool, optional): whether to use best ball settings during simulation, defaults to False.</p>

<p>Returns:
    pd.DataFrame: dataframe containing the impact and value of every possible trade analyzed.</p>
</div>


                            </div>
                            <div id="League.perGameDelta" class="classattr">
                                        <input id="League.perGameDelta-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">perGameDelta</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">team_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">postseason</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">payouts</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">800</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">100</span><span class="p">]</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="League.perGameDelta-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#League.perGameDelta"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="League.perGameDelta-2808"><a href="#League.perGameDelta-2808"><span class="linenos">2808</span></a>    <span class="k">def</span> <span class="nf">perGameDelta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">team_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">postseason</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">payouts</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">800</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">100</span><span class="p">]):</span>
</span><span id="League.perGameDelta-2809"><a href="#League.perGameDelta-2809"><span class="linenos">2809</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="League.perGameDelta-2810"><a href="#League.perGameDelta-2810"><span class="linenos">2810</span></a><span class="sd">        Simulates the remainder of the season and compares it to a simulation </span>
</span><span id="League.perGameDelta-2811"><a href="#League.perGameDelta-2811"><span class="linenos">2811</span></a><span class="sd">        of the season given one team winning or losing each matchup.</span>
</span><span id="League.perGameDelta-2812"><a href="#League.perGameDelta-2812"><span class="linenos">2812</span></a>
</span><span id="League.perGameDelta-2813"><a href="#League.perGameDelta-2813"><span class="linenos">2813</span></a><span class="sd">        Args:</span>
</span><span id="League.perGameDelta-2814"><a href="#League.perGameDelta-2814"><span class="linenos">2814</span></a><span class="sd">            team_name (str, optional): name of team to analyze matchup values for, defaults to None (and therefore team of interest).  </span>
</span><span id="League.perGameDelta-2815"><a href="#League.perGameDelta-2815"><span class="linenos">2815</span></a><span class="sd">            postseason (bool, optional): whether to analyze postseason gains or just regular season, defaults to True.  </span>
</span><span id="League.perGameDelta-2816"><a href="#League.perGameDelta-2816"><span class="linenos">2816</span></a><span class="sd">            payouts (list, optional): list of payout amounts for top three finishers, defaults to [800, 300, 100].</span>
</span><span id="League.perGameDelta-2817"><a href="#League.perGameDelta-2817"><span class="linenos">2817</span></a>
</span><span id="League.perGameDelta-2818"><a href="#League.perGameDelta-2818"><span class="linenos">2818</span></a><span class="sd">        Returns:</span>
</span><span id="League.perGameDelta-2819"><a href="#League.perGameDelta-2819"><span class="linenos">2819</span></a><span class="sd">            pd.DataFrame: dataframe containing the impact and value of every matchup during the week of interest.</span>
</span><span id="League.perGameDelta-2820"><a href="#League.perGameDelta-2820"><span class="linenos">2820</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="League.perGameDelta-2821"><a href="#League.perGameDelta-2821"><span class="linenos">2821</span></a>        <span class="n">as_of</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">season</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">week</span>
</span><span id="League.perGameDelta-2822"><a href="#League.perGameDelta-2822"><span class="linenos">2822</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_oauth</span><span class="p">()</span>
</span><span id="League.perGameDelta-2823"><a href="#League.perGameDelta-2823"><span class="linenos">2823</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">team_name</span><span class="p">:</span>
</span><span id="League.perGameDelta-2824"><a href="#League.perGameDelta-2824"><span class="linenos">2824</span></a>            <span class="n">team_name</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="League.perGameDelta-2825"><a href="#League.perGameDelta-2825"><span class="linenos">2825</span></a>                <span class="n">team</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
</span><span id="League.perGameDelta-2826"><a href="#League.perGameDelta-2826"><span class="linenos">2826</span></a>                <span class="k">for</span> <span class="n">team</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">teams</span>
</span><span id="League.perGameDelta-2827"><a href="#League.perGameDelta-2827"><span class="linenos">2827</span></a>                <span class="k">if</span> <span class="n">team</span><span class="p">[</span><span class="s2">&quot;team_key&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">lg</span><span class="o">.</span><span class="n">team_key</span><span class="p">()</span>
</span><span id="League.perGameDelta-2828"><a href="#League.perGameDelta-2828"><span class="linenos">2828</span></a>            <span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="League.perGameDelta-2829"><a href="#League.perGameDelta-2829"><span class="linenos">2829</span></a>        <span class="n">deltas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">season_sims</span><span class="p">(</span><span class="n">postseason</span><span class="p">,</span> <span class="n">payouts</span><span class="p">)[</span><span class="mi">1</span><span class="p">][[</span><span class="s2">&quot;team&quot;</span><span class="p">,</span> <span class="s2">&quot;earnings&quot;</span><span class="p">]]</span>
</span><span id="League.perGameDelta-2830"><a href="#League.perGameDelta-2830"><span class="linenos">2830</span></a>        <span class="k">for</span> <span class="n">team</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">fantasy_team</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
</span><span id="League.perGameDelta-2831"><a href="#League.perGameDelta-2831"><span class="linenos">2831</span></a>            <span class="n">new_standings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">season_sims</span><span class="p">(</span>
</span><span id="League.perGameDelta-2832"><a href="#League.perGameDelta-2832"><span class="linenos">2832</span></a>                <span class="n">postseason</span><span class="p">,</span> <span class="n">payouts</span><span class="p">,</span> <span class="n">fixed_winner</span><span class="o">=</span><span class="p">[</span><span class="n">as_of</span> <span class="o">%</span> <span class="mi">100</span><span class="p">,</span> <span class="n">team</span><span class="p">]</span>
</span><span id="League.perGameDelta-2833"><a href="#League.perGameDelta-2833"><span class="linenos">2833</span></a>            <span class="p">)[</span><span class="mi">1</span><span class="p">][[</span><span class="s2">&quot;team&quot;</span><span class="p">,</span> <span class="s2">&quot;earnings&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;earnings&quot;</span><span class="p">:</span> <span class="s2">&quot;earnings_new&quot;</span><span class="p">})</span>
</span><span id="League.perGameDelta-2834"><a href="#League.perGameDelta-2834"><span class="linenos">2834</span></a>            <span class="n">deltas</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">deltas</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">new_standings</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;team&quot;</span><span class="p">)</span>
</span><span id="League.perGameDelta-2835"><a href="#League.perGameDelta-2835"><span class="linenos">2835</span></a>            <span class="n">deltas</span><span class="p">[</span><span class="n">team</span><span class="p">]</span> <span class="o">=</span> <span class="n">deltas</span><span class="p">[</span><span class="s2">&quot;earnings_new&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">deltas</span><span class="p">[</span><span class="s2">&quot;earnings&quot;</span><span class="p">]</span>
</span><span id="League.perGameDelta-2836"><a href="#League.perGameDelta-2836"><span class="linenos">2836</span></a>            <span class="k">del</span> <span class="n">deltas</span><span class="p">[</span><span class="s2">&quot;earnings_new&quot;</span><span class="p">]</span>
</span><span id="League.perGameDelta-2837"><a href="#League.perGameDelta-2837"><span class="linenos">2837</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">deltas</span><span class="p">[[</span><span class="s2">&quot;team&quot;</span><span class="p">,</span> <span class="n">team</span><span class="p">]]</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
</span><span id="League.perGameDelta-2838"><a href="#League.perGameDelta-2838"><span class="linenos">2838</span></a>        <span class="k">del</span> <span class="n">deltas</span><span class="p">[</span><span class="s2">&quot;earnings&quot;</span><span class="p">]</span>
</span><span id="League.perGameDelta-2839"><a href="#League.perGameDelta-2839"><span class="linenos">2839</span></a>        <span class="k">return</span> <span class="p">(</span>
</span><span id="League.perGameDelta-2840"><a href="#League.perGameDelta-2840"><span class="linenos">2840</span></a>            <span class="n">deltas</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;team&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;index&quot;</span><span class="p">:</span> <span class="s2">&quot;winner&quot;</span><span class="p">})</span>
</span><span id="League.perGameDelta-2841"><a href="#League.perGameDelta-2841"><span class="linenos">2841</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Simulates the remainder of the season and compares it to a simulation 
of the season given one team winning or losing each matchup.</p>

<p>Args:
    team_name (str, optional): name of team to analyze matchup values for, defaults to None (and therefore team of interest). <br />
    postseason (bool, optional): whether to analyze postseason gains or just regular season, defaults to True. <br />
    payouts (list, optional): list of payout amounts for top three finishers, defaults to [800, 300, 100].</p>

<p>Returns:
    pd.DataFrame: dataframe containing the impact and value of every matchup during the week of interest.</p>
</div>


                            </div>
                </section>
                <section id="excelAutofit">
                            <input id="excelAutofit-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">excelAutofit</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">df</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span>,</span><span class="param">	<span class="n">name</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">writer</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">excel</span><span class="o">.</span><span class="n">_base</span><span class="o">.</span><span class="n">ExcelWriter</span>,</span><span class="param">	<span class="n">freeze_cols</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="excelAutofit-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#excelAutofit"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="excelAutofit-2844"><a href="#excelAutofit-2844"><span class="linenos">2844</span></a><span class="k">def</span> <span class="nf">excelAutofit</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">writer</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelWriter</span><span class="p">,</span> <span class="n">freeze_cols</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="excelAutofit-2845"><a href="#excelAutofit-2845"><span class="linenos">2845</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="excelAutofit-2846"><a href="#excelAutofit-2846"><span class="linenos">2846</span></a><span class="sd">    Writes the provided dataframe to a new tab in an excel spreadsheet </span>
</span><span id="excelAutofit-2847"><a href="#excelAutofit-2847"><span class="linenos">2847</span></a><span class="sd">    with the columns autofitted and autoformatted.</span>
</span><span id="excelAutofit-2848"><a href="#excelAutofit-2848"><span class="linenos">2848</span></a>
</span><span id="excelAutofit-2849"><a href="#excelAutofit-2849"><span class="linenos">2849</span></a><span class="sd">    Args:</span>
</span><span id="excelAutofit-2850"><a href="#excelAutofit-2850"><span class="linenos">2850</span></a><span class="sd">        df (pd.DataFrame): dataframe to print to the excel spreadsheet.  </span>
</span><span id="excelAutofit-2851"><a href="#excelAutofit-2851"><span class="linenos">2851</span></a><span class="sd">        name (str): name of the new tab to be added.  </span>
</span><span id="excelAutofit-2852"><a href="#excelAutofit-2852"><span class="linenos">2852</span></a><span class="sd">        writer (pd.ExcelWriter): ExcelWriter object representing the excel spreadsheet.</span>
</span><span id="excelAutofit-2853"><a href="#excelAutofit-2853"><span class="linenos">2853</span></a>
</span><span id="excelAutofit-2854"><a href="#excelAutofit-2854"><span class="linenos">2854</span></a><span class="sd">    Returns:</span>
</span><span id="excelAutofit-2855"><a href="#excelAutofit-2855"><span class="linenos">2855</span></a><span class="sd">        pd.ExcelWriter: same excel spreadsheet provided originally with the new tab added.</span>
</span><span id="excelAutofit-2856"><a href="#excelAutofit-2856"><span class="linenos">2856</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="excelAutofit-2857"><a href="#excelAutofit-2857"><span class="linenos">2857</span></a>    <span class="n">f</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">book</span><span class="o">.</span><span class="n">add_format</span><span class="p">()</span>
</span><span id="excelAutofit-2858"><a href="#excelAutofit-2858"><span class="linenos">2858</span></a>    <span class="n">f</span><span class="o">.</span><span class="n">set_align</span><span class="p">(</span><span class="s2">&quot;center&quot;</span><span class="p">)</span>
</span><span id="excelAutofit-2859"><a href="#excelAutofit-2859"><span class="linenos">2859</span></a>    <span class="n">f</span><span class="o">.</span><span class="n">set_align</span><span class="p">(</span><span class="s2">&quot;vcenter&quot;</span><span class="p">)</span>
</span><span id="excelAutofit-2860"><a href="#excelAutofit-2860"><span class="linenos">2860</span></a>    <span class="n">m</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">book</span><span class="o">.</span><span class="n">add_format</span><span class="p">({</span><span class="s2">&quot;num_format&quot;</span><span class="p">:</span> <span class="s2">&quot;$0.00&quot;</span><span class="p">})</span>
</span><span id="excelAutofit-2861"><a href="#excelAutofit-2861"><span class="linenos">2861</span></a>    <span class="n">m</span><span class="o">.</span><span class="n">set_align</span><span class="p">(</span><span class="s2">&quot;center&quot;</span><span class="p">)</span>
</span><span id="excelAutofit-2862"><a href="#excelAutofit-2862"><span class="linenos">2862</span></a>    <span class="n">m</span><span class="o">.</span><span class="n">set_align</span><span class="p">(</span><span class="s2">&quot;vcenter&quot;</span><span class="p">)</span>
</span><span id="excelAutofit-2863"><a href="#excelAutofit-2863"><span class="linenos">2863</span></a>    <span class="n">p</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">book</span><span class="o">.</span><span class="n">add_format</span><span class="p">({</span><span class="s2">&quot;num_format&quot;</span><span class="p">:</span> <span class="s2">&quot;0.0%&quot;</span><span class="p">})</span>
</span><span id="excelAutofit-2864"><a href="#excelAutofit-2864"><span class="linenos">2864</span></a>    <span class="n">p</span><span class="o">.</span><span class="n">set_align</span><span class="p">(</span><span class="s2">&quot;center&quot;</span><span class="p">)</span>
</span><span id="excelAutofit-2865"><a href="#excelAutofit-2865"><span class="linenos">2865</span></a>    <span class="n">p</span><span class="o">.</span><span class="n">set_align</span><span class="p">(</span><span class="s2">&quot;vcenter&quot;</span><span class="p">)</span>
</span><span id="excelAutofit-2866"><a href="#excelAutofit-2866"><span class="linenos">2866</span></a>    <span class="n">df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="excelAutofit-2867"><a href="#excelAutofit-2867"><span class="linenos">2867</span></a>    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
</span><span id="excelAutofit-2868"><a href="#excelAutofit-2868"><span class="linenos">2868</span></a>        <span class="n">series</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span>
</span><span id="excelAutofit-2869"><a href="#excelAutofit-2869"><span class="linenos">2869</span></a>        <span class="n">max_len</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span>
</span><span id="excelAutofit-2870"><a href="#excelAutofit-2870"><span class="linenos">2870</span></a>            <span class="nb">max</span><span class="p">((</span><span class="n">series</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="nb">len</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">series</span><span class="o">.</span><span class="n">name</span><span class="p">))))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">50</span>
</span><span id="excelAutofit-2871"><a href="#excelAutofit-2871"><span class="linenos">2871</span></a>        <span class="p">)</span>
</span><span id="excelAutofit-2872"><a href="#excelAutofit-2872"><span class="linenos">2872</span></a>        <span class="k">if</span> <span class="s2">&quot;earnings&quot;</span> <span class="ow">in</span> <span class="n">col</span> <span class="ow">or</span> <span class="p">(</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;Deltas&quot;</span> <span class="ow">and</span> <span class="n">col</span> <span class="o">!=</span> <span class="s2">&quot;team&quot;</span><span class="p">):</span>
</span><span id="excelAutofit-2873"><a href="#excelAutofit-2873"><span class="linenos">2873</span></a>            <span class="n">writer</span><span class="o">.</span><span class="n">sheets</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">set_column</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">max_len</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
</span><span id="excelAutofit-2874"><a href="#excelAutofit-2874"><span class="linenos">2874</span></a>        <span class="k">elif</span> <span class="s2">&quot;per_game_&quot;</span> <span class="ow">in</span> <span class="n">col</span> <span class="ow">or</span> <span class="n">col</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_factor&quot;</span><span class="p">):</span>
</span><span id="excelAutofit-2875"><a href="#excelAutofit-2875"><span class="linenos">2875</span></a>            <span class="n">writer</span><span class="o">.</span><span class="n">sheets</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">set_column</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">max_len</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;hidden&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>
</span><span id="excelAutofit-2876"><a href="#excelAutofit-2876"><span class="linenos">2876</span></a>        <span class="k">elif</span> <span class="n">col</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;my_&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;their_&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_delta&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
</span><span id="excelAutofit-2877"><a href="#excelAutofit-2877"><span class="linenos">2877</span></a>            <span class="s2">&quot;_1&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>
</span><span id="excelAutofit-2878"><a href="#excelAutofit-2878"><span class="linenos">2878</span></a>        <span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_2&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="excelAutofit-2879"><a href="#excelAutofit-2879"><span class="linenos">2879</span></a>            <span class="s2">&quot;playoffs&quot;</span><span class="p">,</span>
</span><span id="excelAutofit-2880"><a href="#excelAutofit-2880"><span class="linenos">2880</span></a>            <span class="s2">&quot;playoff_bye&quot;</span><span class="p">,</span>
</span><span id="excelAutofit-2881"><a href="#excelAutofit-2881"><span class="linenos">2881</span></a>            <span class="s2">&quot;winner&quot;</span><span class="p">,</span>
</span><span id="excelAutofit-2882"><a href="#excelAutofit-2882"><span class="linenos">2882</span></a>            <span class="s2">&quot;runner_up&quot;</span><span class="p">,</span>
</span><span id="excelAutofit-2883"><a href="#excelAutofit-2883"><span class="linenos">2883</span></a>            <span class="s2">&quot;third&quot;</span><span class="p">,</span>
</span><span id="excelAutofit-2884"><a href="#excelAutofit-2884"><span class="linenos">2884</span></a>            <span class="s2">&quot;many_mile&quot;</span><span class="p">,</span>
</span><span id="excelAutofit-2885"><a href="#excelAutofit-2885"><span class="linenos">2885</span></a>            <span class="s2">&quot;pct_rostered&quot;</span><span class="p">,</span>
</span><span id="excelAutofit-2886"><a href="#excelAutofit-2886"><span class="linenos">2886</span></a>        <span class="p">]:</span>
</span><span id="excelAutofit-2887"><a href="#excelAutofit-2887"><span class="linenos">2887</span></a>            <span class="n">writer</span><span class="o">.</span><span class="n">sheets</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">set_column</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">max_len</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
</span><span id="excelAutofit-2888"><a href="#excelAutofit-2888"><span class="linenos">2888</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="excelAutofit-2889"><a href="#excelAutofit-2889"><span class="linenos">2889</span></a>            <span class="n">writer</span><span class="o">.</span><span class="n">sheets</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">set_column</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">max_len</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</span><span id="excelAutofit-2890"><a href="#excelAutofit-2890"><span class="linenos">2890</span></a>    <span class="n">writer</span><span class="o">.</span><span class="n">sheets</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">autofilter</span><span class="p">(</span>
</span><span id="excelAutofit-2891"><a href="#excelAutofit-2891"><span class="linenos">2891</span></a>        <span class="s2">&quot;A1:&quot;</span>
</span><span id="excelAutofit-2892"><a href="#excelAutofit-2892"><span class="linenos">2892</span></a>        <span class="o">+</span> <span class="p">(</span>
</span><span id="excelAutofit-2893"><a href="#excelAutofit-2893"><span class="linenos">2893</span></a>            <span class="nb">chr</span><span class="p">(</span><span class="mi">64</span> <span class="o">+</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">26</span><span class="p">)</span> <span class="o">+</span> <span class="nb">chr</span><span class="p">(</span><span class="mi">65</span> <span class="o">+</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">26</span><span class="p">)</span>
</span><span id="excelAutofit-2894"><a href="#excelAutofit-2894"><span class="linenos">2894</span></a>        <span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;@&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="excelAutofit-2895"><a href="#excelAutofit-2895"><span class="linenos">2895</span></a>        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="excelAutofit-2896"><a href="#excelAutofit-2896"><span class="linenos">2896</span></a>    <span class="p">)</span>
</span><span id="excelAutofit-2897"><a href="#excelAutofit-2897"><span class="linenos">2897</span></a>    <span class="n">writer</span><span class="o">.</span><span class="n">sheets</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">freeze_panes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">freeze_cols</span><span class="p">)</span>
</span><span id="excelAutofit-2898"><a href="#excelAutofit-2898"><span class="linenos">2898</span></a>    <span class="k">return</span> <span class="n">writer</span>
</span></pre></div>


            <div class="docstring"><p>Writes the provided dataframe to a new tab in an excel spreadsheet 
with the columns autofitted and autoformatted.</p>

<p>Args:
    df (pd.DataFrame): dataframe to print to the excel spreadsheet. <br />
    name (str): name of the new tab to be added. <br />
    writer (pd.ExcelWriter): ExcelWriter object representing the excel spreadsheet.</p>

<p>Returns:
    pd.ExcelWriter: same excel spreadsheet provided originally with the new tab added.</p>
</div>


                </section>
                <section id="sendEmail">
                            <input id="sendEmail-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">sendEmail</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">subject</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">body</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">address</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="sendEmail-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#sendEmail"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="sendEmail-2901"><a href="#sendEmail-2901"><span class="linenos">2901</span></a><span class="k">def</span> <span class="nf">sendEmail</span><span class="p">(</span><span class="n">subject</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">body</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="sendEmail-2902"><a href="#sendEmail-2902"><span class="linenos">2902</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="sendEmail-2903"><a href="#sendEmail-2903"><span class="linenos">2903</span></a><span class="sd">    Sends an email to the address provided with whichever subject, body, and attachements desired.</span>
</span><span id="sendEmail-2904"><a href="#sendEmail-2904"><span class="linenos">2904</span></a>
</span><span id="sendEmail-2905"><a href="#sendEmail-2905"><span class="linenos">2905</span></a><span class="sd">    Args:</span>
</span><span id="sendEmail-2906"><a href="#sendEmail-2906"><span class="linenos">2906</span></a><span class="sd">        subject (str): subject line of the email to be sent.  </span>
</span><span id="sendEmail-2907"><a href="#sendEmail-2907"><span class="linenos">2907</span></a><span class="sd">        body (str): body text of the email to be sent.  </span>
</span><span id="sendEmail-2908"><a href="#sendEmail-2908"><span class="linenos">2908</span></a><span class="sd">        address (str): email address to send the message to.  </span>
</span><span id="sendEmail-2909"><a href="#sendEmail-2909"><span class="linenos">2909</span></a><span class="sd">        filename (str, optional): location of a file to be attached to the email, defaults to None.</span>
</span><span id="sendEmail-2910"><a href="#sendEmail-2910"><span class="linenos">2910</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="sendEmail-2911"><a href="#sendEmail-2911"><span class="linenos">2911</span></a>    <span class="n">message</span> <span class="o">=</span> <span class="n">MIMEMultipart</span><span class="p">()</span>
</span><span id="sendEmail-2912"><a href="#sendEmail-2912"><span class="linenos">2912</span></a>    <span class="n">message</span><span class="p">[</span><span class="s2">&quot;From&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;EMAIL_SENDER&quot;</span><span class="p">]</span>
</span><span id="sendEmail-2913"><a href="#sendEmail-2913"><span class="linenos">2913</span></a>    <span class="n">message</span><span class="p">[</span><span class="s2">&quot;To&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">address</span>
</span><span id="sendEmail-2914"><a href="#sendEmail-2914"><span class="linenos">2914</span></a>    <span class="n">message</span><span class="p">[</span><span class="s2">&quot;Subject&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">subject</span>
</span><span id="sendEmail-2915"><a href="#sendEmail-2915"><span class="linenos">2915</span></a>    <span class="n">message</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">MIMEText</span><span class="p">(</span><span class="n">body</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;plain&quot;</span><span class="p">))</span>
</span><span id="sendEmail-2916"><a href="#sendEmail-2916"><span class="linenos">2916</span></a>    <span class="k">if</span> <span class="n">filename</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">filename</span><span class="p">)):</span>
</span><span id="sendEmail-2917"><a href="#sendEmail-2917"><span class="linenos">2917</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">attachment</span><span class="p">:</span>
</span><span id="sendEmail-2918"><a href="#sendEmail-2918"><span class="linenos">2918</span></a>            <span class="n">part</span> <span class="o">=</span> <span class="n">MIMEBase</span><span class="p">(</span><span class="s2">&quot;application&quot;</span><span class="p">,</span> <span class="s2">&quot;octet-stream&quot;</span><span class="p">)</span>
</span><span id="sendEmail-2919"><a href="#sendEmail-2919"><span class="linenos">2919</span></a>            <span class="n">part</span><span class="o">.</span><span class="n">set_payload</span><span class="p">(</span><span class="n">attachment</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</span><span id="sendEmail-2920"><a href="#sendEmail-2920"><span class="linenos">2920</span></a>        <span class="n">encoders</span><span class="o">.</span><span class="n">encode_base64</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>
</span><span id="sendEmail-2921"><a href="#sendEmail-2921"><span class="linenos">2921</span></a>        <span class="n">part</span><span class="o">.</span><span class="n">add_header</span><span class="p">(</span>
</span><span id="sendEmail-2922"><a href="#sendEmail-2922"><span class="linenos">2922</span></a>            <span class="s2">&quot;Content-Disposition&quot;</span><span class="p">,</span> <span class="s2">&quot;attachment; filename= &quot;</span> <span class="o">+</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="sendEmail-2923"><a href="#sendEmail-2923"><span class="linenos">2923</span></a>        <span class="p">)</span>
</span><span id="sendEmail-2924"><a href="#sendEmail-2924"><span class="linenos">2924</span></a>        <span class="n">message</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>
</span><span id="sendEmail-2925"><a href="#sendEmail-2925"><span class="linenos">2925</span></a>    <span class="n">text</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">as_string</span><span class="p">()</span>
</span><span id="sendEmail-2926"><a href="#sendEmail-2926"><span class="linenos">2926</span></a>    <span class="n">context</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">create_default_context</span><span class="p">()</span>
</span><span id="sendEmail-2927"><a href="#sendEmail-2927"><span class="linenos">2927</span></a>    <span class="k">with</span> <span class="n">smtplib</span><span class="o">.</span><span class="n">SMTP_SSL</span><span class="p">(</span><span class="s2">&quot;smtp.gmail.com&quot;</span><span class="p">,</span> <span class="mi">465</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span> <span class="k">as</span> <span class="n">server</span><span class="p">:</span>
</span><span id="sendEmail-2928"><a href="#sendEmail-2928"><span class="linenos">2928</span></a>        <span class="n">server</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;EMAIL_SENDER&quot;</span><span class="p">],</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;EMAIL_PW&quot;</span><span class="p">])</span>
</span><span id="sendEmail-2929"><a href="#sendEmail-2929"><span class="linenos">2929</span></a>        <span class="n">server</span><span class="o">.</span><span class="n">sendmail</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;EMAIL_SENDER&quot;</span><span class="p">],</span> <span class="n">address</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Sends an email to the address provided with whichever subject, body, and attachements desired.</p>

<p>Args:
    subject (str): subject line of the email to be sent. <br />
    body (str): body text of the email to be sent. <br />
    address (str): email address to send the message to. <br />
    filename (str, optional): location of a file to be attached to the email, defaults to None.</p>
</div>


                </section>
                <section id="initialize_inputs">
                            <input id="initialize_inputs-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">initialize_inputs</span><span class="signature pdoc-code condensed">(<span class="return-annotation">):</span></span>

                <label class="view-source-button" for="initialize_inputs-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#initialize_inputs"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="initialize_inputs-2932"><a href="#initialize_inputs-2932"><span class="linenos">2932</span></a><span class="k">def</span> <span class="nf">initialize_inputs</span><span class="p">():</span>
</span><span id="initialize_inputs-2933"><a href="#initialize_inputs-2933"><span class="linenos">2933</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="initialize_inputs-2934"><a href="#initialize_inputs-2934"><span class="linenos">2934</span></a><span class="sd">    Initializing arguments based on command line inputs provided by the user.</span>
</span><span id="initialize_inputs-2935"><a href="#initialize_inputs-2935"><span class="linenos">2935</span></a>
</span><span id="initialize_inputs-2936"><a href="#initialize_inputs-2936"><span class="linenos">2936</span></a><span class="sd">    Returns:</span>
</span><span id="initialize_inputs-2937"><a href="#initialize_inputs-2937"><span class="linenos">2937</span></a><span class="sd">        optparse.Values: collection of cleaned input values based on inputs and basic logic.</span>
</span><span id="initialize_inputs-2938"><a href="#initialize_inputs-2938"><span class="linenos">2938</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="initialize_inputs-2939"><a href="#initialize_inputs-2939"><span class="linenos">2939</span></a>    <span class="n">parser</span> <span class="o">=</span> <span class="n">optparse</span><span class="o">.</span><span class="n">OptionParser</span><span class="p">()</span>
</span><span id="initialize_inputs-2940"><a href="#initialize_inputs-2940"><span class="linenos">2940</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
</span><span id="initialize_inputs-2941"><a href="#initialize_inputs-2941"><span class="linenos">2941</span></a>        <span class="s2">&quot;--season&quot;</span><span class="p">,</span>
</span><span id="initialize_inputs-2942"><a href="#initialize_inputs-2942"><span class="linenos">2942</span></a>        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span>
</span><span id="initialize_inputs-2943"><a href="#initialize_inputs-2943"><span class="linenos">2943</span></a>        <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;int&quot;</span><span class="p">,</span>
</span><span id="initialize_inputs-2944"><a href="#initialize_inputs-2944"><span class="linenos">2944</span></a>        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;season&quot;</span><span class="p">,</span>
</span><span id="initialize_inputs-2945"><a href="#initialize_inputs-2945"><span class="linenos">2945</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;season of interest&quot;</span>
</span><span id="initialize_inputs-2946"><a href="#initialize_inputs-2946"><span class="linenos">2946</span></a>    <span class="p">)</span>
</span><span id="initialize_inputs-2947"><a href="#initialize_inputs-2947"><span class="linenos">2947</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
</span><span id="initialize_inputs-2948"><a href="#initialize_inputs-2948"><span class="linenos">2948</span></a>        <span class="s2">&quot;--week&quot;</span><span class="p">,</span>
</span><span id="initialize_inputs-2949"><a href="#initialize_inputs-2949"><span class="linenos">2949</span></a>        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span>
</span><span id="initialize_inputs-2950"><a href="#initialize_inputs-2950"><span class="linenos">2950</span></a>        <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;int&quot;</span><span class="p">,</span>
</span><span id="initialize_inputs-2951"><a href="#initialize_inputs-2951"><span class="linenos">2951</span></a>        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;week&quot;</span><span class="p">,</span>
</span><span id="initialize_inputs-2952"><a href="#initialize_inputs-2952"><span class="linenos">2952</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;week to project the season from&quot;</span>
</span><span id="initialize_inputs-2953"><a href="#initialize_inputs-2953"><span class="linenos">2953</span></a>    <span class="p">)</span>
</span><span id="initialize_inputs-2954"><a href="#initialize_inputs-2954"><span class="linenos">2954</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
</span><span id="initialize_inputs-2955"><a href="#initialize_inputs-2955"><span class="linenos">2955</span></a>        <span class="s2">&quot;--name&quot;</span><span class="p">,</span>
</span><span id="initialize_inputs-2956"><a href="#initialize_inputs-2956"><span class="linenos">2956</span></a>        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span>
</span><span id="initialize_inputs-2957"><a href="#initialize_inputs-2957"><span class="linenos">2957</span></a>        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;name&quot;</span><span class="p">,</span>
</span><span id="initialize_inputs-2958"><a href="#initialize_inputs-2958"><span class="linenos">2958</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;name of team to analyze in the case of multiple teams in a single season&quot;</span><span class="p">,</span>
</span><span id="initialize_inputs-2959"><a href="#initialize_inputs-2959"><span class="linenos">2959</span></a>    <span class="p">)</span>
</span><span id="initialize_inputs-2960"><a href="#initialize_inputs-2960"><span class="linenos">2960</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
</span><span id="initialize_inputs-2961"><a href="#initialize_inputs-2961"><span class="linenos">2961</span></a>        <span class="s2">&quot;--earliest&quot;</span><span class="p">,</span>
</span><span id="initialize_inputs-2962"><a href="#initialize_inputs-2962"><span class="linenos">2962</span></a>        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span>
</span><span id="initialize_inputs-2963"><a href="#initialize_inputs-2963"><span class="linenos">2963</span></a>        <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;int&quot;</span><span class="p">,</span>
</span><span id="initialize_inputs-2964"><a href="#initialize_inputs-2964"><span class="linenos">2964</span></a>        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;earliest&quot;</span><span class="p">,</span>
</span><span id="initialize_inputs-2965"><a href="#initialize_inputs-2965"><span class="linenos">2965</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;earliest week of stats being considered, e.g. 201807 corresponds to week 7 of the 2018 season&quot;</span><span class="p">,</span>
</span><span id="initialize_inputs-2966"><a href="#initialize_inputs-2966"><span class="linenos">2966</span></a>    <span class="p">)</span>
</span><span id="initialize_inputs-2967"><a href="#initialize_inputs-2967"><span class="linenos">2967</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
</span><span id="initialize_inputs-2968"><a href="#initialize_inputs-2968"><span class="linenos">2968</span></a>        <span class="s2">&quot;--games&quot;</span><span class="p">,</span>
</span><span id="initialize_inputs-2969"><a href="#initialize_inputs-2969"><span class="linenos">2969</span></a>        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span>
</span><span id="initialize_inputs-2970"><a href="#initialize_inputs-2970"><span class="linenos">2970</span></a>        <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;int&quot;</span><span class="p">,</span>
</span><span id="initialize_inputs-2971"><a href="#initialize_inputs-2971"><span class="linenos">2971</span></a>        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;games&quot;</span><span class="p">,</span>
</span><span id="initialize_inputs-2972"><a href="#initialize_inputs-2972"><span class="linenos">2972</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;number of games to build each player&#39;s prior off of&quot;</span><span class="p">,</span>
</span><span id="initialize_inputs-2973"><a href="#initialize_inputs-2973"><span class="linenos">2973</span></a>    <span class="p">)</span>
</span><span id="initialize_inputs-2974"><a href="#initialize_inputs-2974"><span class="linenos">2974</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
</span><span id="initialize_inputs-2975"><a href="#initialize_inputs-2975"><span class="linenos">2975</span></a>        <span class="s2">&quot;--basaloppstringtime&quot;</span><span class="p">,</span>
</span><span id="initialize_inputs-2976"><a href="#initialize_inputs-2976"><span class="linenos">2976</span></a>        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span>
</span><span id="initialize_inputs-2977"><a href="#initialize_inputs-2977"><span class="linenos">2977</span></a>        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;basaloppstringtime&quot;</span><span class="p">,</span>
</span><span id="initialize_inputs-2978"><a href="#initialize_inputs-2978"><span class="linenos">2978</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;scaling factors for basal/opponent/depthchart/time factors, comma-separated string of values&quot;</span><span class="p">,</span>
</span><span id="initialize_inputs-2979"><a href="#initialize_inputs-2979"><span class="linenos">2979</span></a>    <span class="p">)</span>
</span><span id="initialize_inputs-2980"><a href="#initialize_inputs-2980"><span class="linenos">2980</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
</span><span id="initialize_inputs-2981"><a href="#initialize_inputs-2981"><span class="linenos">2981</span></a>        <span class="s2">&quot;--sims&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;int&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;sims&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;number of season simulations&quot;</span>
</span><span id="initialize_inputs-2982"><a href="#initialize_inputs-2982"><span class="linenos">2982</span></a>    <span class="p">)</span>
</span><span id="initialize_inputs-2983"><a href="#initialize_inputs-2983"><span class="linenos">2983</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
</span><span id="initialize_inputs-2984"><a href="#initialize_inputs-2984"><span class="linenos">2984</span></a>        <span class="s2">&quot;--payouts&quot;</span><span class="p">,</span>
</span><span id="initialize_inputs-2985"><a href="#initialize_inputs-2985"><span class="linenos">2985</span></a>        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span>
</span><span id="initialize_inputs-2986"><a href="#initialize_inputs-2986"><span class="linenos">2986</span></a>        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;payouts&quot;</span><span class="p">,</span>
</span><span id="initialize_inputs-2987"><a href="#initialize_inputs-2987"><span class="linenos">2987</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;comma separated string containing integer payouts for 1st, 2nd, and 3rd&quot;</span><span class="p">,</span>
</span><span id="initialize_inputs-2988"><a href="#initialize_inputs-2988"><span class="linenos">2988</span></a>    <span class="p">)</span>
</span><span id="initialize_inputs-2989"><a href="#initialize_inputs-2989"><span class="linenos">2989</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
</span><span id="initialize_inputs-2990"><a href="#initialize_inputs-2990"><span class="linenos">2990</span></a>        <span class="s2">&quot;--injurytries&quot;</span><span class="p">,</span>
</span><span id="initialize_inputs-2991"><a href="#initialize_inputs-2991"><span class="linenos">2991</span></a>        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span>
</span><span id="initialize_inputs-2992"><a href="#initialize_inputs-2992"><span class="linenos">2992</span></a>        <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;int&quot;</span><span class="p">,</span>
</span><span id="initialize_inputs-2993"><a href="#initialize_inputs-2993"><span class="linenos">2993</span></a>        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;injurytries&quot;</span><span class="p">,</span>
</span><span id="initialize_inputs-2994"><a href="#initialize_inputs-2994"><span class="linenos">2994</span></a>        <span class="n">default</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
</span><span id="initialize_inputs-2995"><a href="#initialize_inputs-2995"><span class="linenos">2995</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;number of times to try pulling injury statuses before rolling with it&quot;</span><span class="p">,</span>
</span><span id="initialize_inputs-2996"><a href="#initialize_inputs-2996"><span class="linenos">2996</span></a>    <span class="p">)</span>
</span><span id="initialize_inputs-2997"><a href="#initialize_inputs-2997"><span class="linenos">2997</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
</span><span id="initialize_inputs-2998"><a href="#initialize_inputs-2998"><span class="linenos">2998</span></a>        <span class="s2">&quot;--bestball&quot;</span><span class="p">,</span>
</span><span id="initialize_inputs-2999"><a href="#initialize_inputs-2999"><span class="linenos">2999</span></a>        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
</span><span id="initialize_inputs-3000"><a href="#initialize_inputs-3000"><span class="linenos">3000</span></a>        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;bestball&quot;</span><span class="p">,</span>
</span><span id="initialize_inputs-3001"><a href="#initialize_inputs-3001"><span class="linenos">3001</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;whether to assess the league of interest in the context of bestball (simulates bench contributions better)&quot;</span><span class="p">,</span>
</span><span id="initialize_inputs-3002"><a href="#initialize_inputs-3002"><span class="linenos">3002</span></a>    <span class="p">)</span>
</span><span id="initialize_inputs-3003"><a href="#initialize_inputs-3003"><span class="linenos">3003</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
</span><span id="initialize_inputs-3004"><a href="#initialize_inputs-3004"><span class="linenos">3004</span></a>        <span class="s2">&quot;--pickups&quot;</span><span class="p">,</span>
</span><span id="initialize_inputs-3005"><a href="#initialize_inputs-3005"><span class="linenos">3005</span></a>        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span>
</span><span id="initialize_inputs-3006"><a href="#initialize_inputs-3006"><span class="linenos">3006</span></a>        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;pickups&quot;</span><span class="p">,</span>
</span><span id="initialize_inputs-3007"><a href="#initialize_inputs-3007"><span class="linenos">3007</span></a>        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;assess possible free agent pickups for the players specified (&quot;all&quot; will analyze all possible pickups)&#39;</span><span class="p">,</span>
</span><span id="initialize_inputs-3008"><a href="#initialize_inputs-3008"><span class="linenos">3008</span></a>    <span class="p">)</span>
</span><span id="initialize_inputs-3009"><a href="#initialize_inputs-3009"><span class="linenos">3009</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
</span><span id="initialize_inputs-3010"><a href="#initialize_inputs-3010"><span class="linenos">3010</span></a>        <span class="s2">&quot;--adds&quot;</span><span class="p">,</span>
</span><span id="initialize_inputs-3011"><a href="#initialize_inputs-3011"><span class="linenos">3011</span></a>        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
</span><span id="initialize_inputs-3012"><a href="#initialize_inputs-3012"><span class="linenos">3012</span></a>        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;adds&quot;</span><span class="p">,</span>
</span><span id="initialize_inputs-3013"><a href="#initialize_inputs-3013"><span class="linenos">3013</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;whether to assess possible free agent adds&quot;</span><span class="p">,</span>
</span><span id="initialize_inputs-3014"><a href="#initialize_inputs-3014"><span class="linenos">3014</span></a>    <span class="p">)</span>
</span><span id="initialize_inputs-3015"><a href="#initialize_inputs-3015"><span class="linenos">3015</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
</span><span id="initialize_inputs-3016"><a href="#initialize_inputs-3016"><span class="linenos">3016</span></a>        <span class="s2">&quot;--drops&quot;</span><span class="p">,</span>
</span><span id="initialize_inputs-3017"><a href="#initialize_inputs-3017"><span class="linenos">3017</span></a>        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
</span><span id="initialize_inputs-3018"><a href="#initialize_inputs-3018"><span class="linenos">3018</span></a>        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;drops&quot;</span><span class="p">,</span>
</span><span id="initialize_inputs-3019"><a href="#initialize_inputs-3019"><span class="linenos">3019</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;whether to assess possible drops&quot;</span><span class="p">,</span>
</span><span id="initialize_inputs-3020"><a href="#initialize_inputs-3020"><span class="linenos">3020</span></a>    <span class="p">)</span>
</span><span id="initialize_inputs-3021"><a href="#initialize_inputs-3021"><span class="linenos">3021</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
</span><span id="initialize_inputs-3022"><a href="#initialize_inputs-3022"><span class="linenos">3022</span></a>        <span class="s2">&quot;--trades&quot;</span><span class="p">,</span>
</span><span id="initialize_inputs-3023"><a href="#initialize_inputs-3023"><span class="linenos">3023</span></a>        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span>
</span><span id="initialize_inputs-3024"><a href="#initialize_inputs-3024"><span class="linenos">3024</span></a>        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;trades&quot;</span><span class="p">,</span>
</span><span id="initialize_inputs-3025"><a href="#initialize_inputs-3025"><span class="linenos">3025</span></a>        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;assess possible trades for the players specified (&quot;all&quot; will analyze all possible trades)&#39;</span><span class="p">,</span>
</span><span id="initialize_inputs-3026"><a href="#initialize_inputs-3026"><span class="linenos">3026</span></a>    <span class="p">)</span>
</span><span id="initialize_inputs-3027"><a href="#initialize_inputs-3027"><span class="linenos">3027</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
</span><span id="initialize_inputs-3028"><a href="#initialize_inputs-3028"><span class="linenos">3028</span></a>        <span class="s2">&quot;--given&quot;</span><span class="p">,</span>
</span><span id="initialize_inputs-3029"><a href="#initialize_inputs-3029"><span class="linenos">3029</span></a>        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span>
</span><span id="initialize_inputs-3030"><a href="#initialize_inputs-3030"><span class="linenos">3030</span></a>        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;given&quot;</span><span class="p">,</span>
</span><span id="initialize_inputs-3031"><a href="#initialize_inputs-3031"><span class="linenos">3031</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;given players to start with for multi-player trades&quot;</span><span class="p">,</span>
</span><span id="initialize_inputs-3032"><a href="#initialize_inputs-3032"><span class="linenos">3032</span></a>    <span class="p">)</span>
</span><span id="initialize_inputs-3033"><a href="#initialize_inputs-3033"><span class="linenos">3033</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
</span><span id="initialize_inputs-3034"><a href="#initialize_inputs-3034"><span class="linenos">3034</span></a>        <span class="s2">&quot;--deltas&quot;</span><span class="p">,</span>
</span><span id="initialize_inputs-3035"><a href="#initialize_inputs-3035"><span class="linenos">3035</span></a>        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
</span><span id="initialize_inputs-3036"><a href="#initialize_inputs-3036"><span class="linenos">3036</span></a>        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;deltas&quot;</span><span class="p">,</span>
</span><span id="initialize_inputs-3037"><a href="#initialize_inputs-3037"><span class="linenos">3037</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;whether to assess deltas for each matchup of the current week&quot;</span><span class="p">,</span>
</span><span id="initialize_inputs-3038"><a href="#initialize_inputs-3038"><span class="linenos">3038</span></a>    <span class="p">)</span>
</span><span id="initialize_inputs-3039"><a href="#initialize_inputs-3039"><span class="linenos">3039</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
</span><span id="initialize_inputs-3040"><a href="#initialize_inputs-3040"><span class="linenos">3040</span></a>        <span class="s2">&quot;--output&quot;</span><span class="p">,</span>
</span><span id="initialize_inputs-3041"><a href="#initialize_inputs-3041"><span class="linenos">3041</span></a>        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span>
</span><span id="initialize_inputs-3042"><a href="#initialize_inputs-3042"><span class="linenos">3042</span></a>        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;output&quot;</span><span class="p">,</span>
</span><span id="initialize_inputs-3043"><a href="#initialize_inputs-3043"><span class="linenos">3043</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;where to save the final projections spreadsheet&quot;</span><span class="p">,</span>
</span><span id="initialize_inputs-3044"><a href="#initialize_inputs-3044"><span class="linenos">3044</span></a>    <span class="p">)</span>
</span><span id="initialize_inputs-3045"><a href="#initialize_inputs-3045"><span class="linenos">3045</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
</span><span id="initialize_inputs-3046"><a href="#initialize_inputs-3046"><span class="linenos">3046</span></a>        <span class="s2">&quot;--email&quot;</span><span class="p">,</span>
</span><span id="initialize_inputs-3047"><a href="#initialize_inputs-3047"><span class="linenos">3047</span></a>        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span>
</span><span id="initialize_inputs-3048"><a href="#initialize_inputs-3048"><span class="linenos">3048</span></a>        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;email&quot;</span><span class="p">,</span>
</span><span id="initialize_inputs-3049"><a href="#initialize_inputs-3049"><span class="linenos">3049</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;where to send the final projections spreadsheet&quot;</span><span class="p">,</span>
</span><span id="initialize_inputs-3050"><a href="#initialize_inputs-3050"><span class="linenos">3050</span></a>    <span class="p">)</span>
</span><span id="initialize_inputs-3051"><a href="#initialize_inputs-3051"><span class="linenos">3051</span></a>    <span class="n">options</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
</span><span id="initialize_inputs-3052"><a href="#initialize_inputs-3052"><span class="linenos">3052</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">options</span><span class="o">.</span><span class="n">season</span><span class="p">:</span>
</span><span id="initialize_inputs-3053"><a href="#initialize_inputs-3053"><span class="linenos">3053</span></a>        <span class="n">options</span><span class="o">.</span><span class="n">season</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">year</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">month</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">)</span>
</span><span id="initialize_inputs-3054"><a href="#initialize_inputs-3054"><span class="linenos">3054</span></a>    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">basaloppstringtime</span><span class="p">:</span>
</span><span id="initialize_inputs-3055"><a href="#initialize_inputs-3055"><span class="linenos">3055</span></a>        <span class="n">options</span><span class="o">.</span><span class="n">basaloppstringtime</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">basaloppstringtime</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
</span><span id="initialize_inputs-3056"><a href="#initialize_inputs-3056"><span class="linenos">3056</span></a>        <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="n">val</span><span class="o">.</span><span class="n">isnumeric</span><span class="p">()</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">basaloppstringtime</span><span class="p">])</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">basal_oppstringtime</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
</span><span id="initialize_inputs-3057"><a href="#initialize_inputs-3057"><span class="linenos">3057</span></a>            <span class="n">options</span><span class="o">.</span><span class="n">basaloppstringtime</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">basaloppstringtime</span><span class="p">]</span>
</span><span id="initialize_inputs-3058"><a href="#initialize_inputs-3058"><span class="linenos">3058</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="initialize_inputs-3059"><a href="#initialize_inputs-3059"><span class="linenos">3059</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Invalid rate inference parameters, using defaults...&quot;</span><span class="p">)</span>
</span><span id="initialize_inputs-3060"><a href="#initialize_inputs-3060"><span class="linenos">3060</span></a>            <span class="n">options</span><span class="o">.</span><span class="n">basaloppstringtime</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="initialize_inputs-3061"><a href="#initialize_inputs-3061"><span class="linenos">3061</span></a>    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">payouts</span><span class="p">:</span>
</span><span id="initialize_inputs-3062"><a href="#initialize_inputs-3062"><span class="linenos">3062</span></a>        <span class="n">options</span><span class="o">.</span><span class="n">payouts</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">payouts</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
</span><span id="initialize_inputs-3063"><a href="#initialize_inputs-3063"><span class="linenos">3063</span></a>        <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="n">val</span><span class="o">.</span><span class="n">isnumeric</span><span class="p">()</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">payouts</span><span class="p">])</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">payouts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="initialize_inputs-3064"><a href="#initialize_inputs-3064"><span class="linenos">3064</span></a>            <span class="n">options</span><span class="o">.</span><span class="n">payouts</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">payouts</span><span class="p">]</span>
</span><span id="initialize_inputs-3065"><a href="#initialize_inputs-3065"><span class="linenos">3065</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="initialize_inputs-3066"><a href="#initialize_inputs-3066"><span class="linenos">3066</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Weird values provided for payouts... Assuming standard payouts...&quot;</span><span class="p">)</span>
</span><span id="initialize_inputs-3067"><a href="#initialize_inputs-3067"><span class="linenos">3067</span></a>            <span class="n">options</span><span class="o">.</span><span class="n">payouts</span> <span class="o">=</span> <span class="p">[</span><span class="mf">60.0</span><span class="p">,</span><span class="mf">30.0</span><span class="p">,</span><span class="mf">10.0</span><span class="p">]</span>
</span><span id="initialize_inputs-3068"><a href="#initialize_inputs-3068"><span class="linenos">3068</span></a>    <span class="k">elif</span> <span class="n">options</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;The Algorithm&quot;</span><span class="p">:</span>
</span><span id="initialize_inputs-3069"><a href="#initialize_inputs-3069"><span class="linenos">3069</span></a>        <span class="n">options</span><span class="o">.</span><span class="n">payouts</span> <span class="o">=</span> <span class="p">[</span><span class="mi">720</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="mi">120</span><span class="p">]</span>
</span><span id="initialize_inputs-3070"><a href="#initialize_inputs-3070"><span class="linenos">3070</span></a>    <span class="k">elif</span> <span class="n">options</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;Toothless Wonders&quot;</span><span class="p">:</span>
</span><span id="initialize_inputs-3071"><a href="#initialize_inputs-3071"><span class="linenos">3071</span></a>        <span class="n">options</span><span class="o">.</span><span class="n">payouts</span> <span class="o">=</span> <span class="p">[</span><span class="mi">350</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">50</span><span class="p">]</span>
</span><span id="initialize_inputs-3072"><a href="#initialize_inputs-3072"><span class="linenos">3072</span></a>    <span class="k">elif</span> <span class="n">options</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;The GENIEs&quot;</span><span class="p">:</span>
</span><span id="initialize_inputs-3073"><a href="#initialize_inputs-3073"><span class="linenos">3073</span></a>        <span class="n">options</span><span class="o">.</span><span class="n">payouts</span> <span class="o">=</span> <span class="p">[</span><span class="mi">120</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="initialize_inputs-3074"><a href="#initialize_inputs-3074"><span class="linenos">3074</span></a>    <span class="k">elif</span> <span class="n">options</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;The Great Gadsby&#39;s&quot;</span><span class="p">:</span>
</span><span id="initialize_inputs-3075"><a href="#initialize_inputs-3075"><span class="linenos">3075</span></a>        <span class="n">options</span><span class="o">.</span><span class="n">payouts</span> <span class="o">=</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">15</span><span class="p">]</span>
</span><span id="initialize_inputs-3076"><a href="#initialize_inputs-3076"><span class="linenos">3076</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="initialize_inputs-3077"><a href="#initialize_inputs-3077"><span class="linenos">3077</span></a>        <span class="n">options</span><span class="o">.</span><span class="n">payouts</span> <span class="o">=</span> <span class="p">[</span><span class="mf">60.0</span><span class="p">,</span><span class="mf">30.0</span><span class="p">,</span><span class="mf">10.0</span><span class="p">]</span>
</span><span id="initialize_inputs-3078"><a href="#initialize_inputs-3078"><span class="linenos">3078</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">options</span><span class="o">.</span><span class="n">output</span><span class="p">:</span>
</span><span id="initialize_inputs-3079"><a href="#initialize_inputs-3079"><span class="linenos">3079</span></a>        <span class="n">options</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="initialize_inputs-3080"><a href="#initialize_inputs-3080"><span class="linenos">3080</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s2">&quot;~/Documents/&quot;</span><span class="p">)</span>
</span><span id="initialize_inputs-3081"><a href="#initialize_inputs-3081"><span class="linenos">3081</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s2">&quot;~/Documents/&quot;</span><span class="p">))</span>
</span><span id="initialize_inputs-3082"><a href="#initialize_inputs-3082"><span class="linenos">3082</span></a>            <span class="k">else</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s2">&quot;~/&quot;</span><span class="p">)</span>
</span><span id="initialize_inputs-3083"><a href="#initialize_inputs-3083"><span class="linenos">3083</span></a>        <span class="p">)</span>
</span><span id="initialize_inputs-3084"><a href="#initialize_inputs-3084"><span class="linenos">3084</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">output</span> <span class="o">+</span> <span class="n">options</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)):</span>
</span><span id="initialize_inputs-3085"><a href="#initialize_inputs-3085"><span class="linenos">3085</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">output</span> <span class="o">+</span> <span class="n">options</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
</span><span id="initialize_inputs-3086"><a href="#initialize_inputs-3086"><span class="linenos">3086</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span>
</span><span id="initialize_inputs-3087"><a href="#initialize_inputs-3087"><span class="linenos">3087</span></a>            <span class="n">options</span><span class="o">.</span><span class="n">output</span> <span class="o">+</span> <span class="n">options</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">season</span><span class="p">)</span>
</span><span id="initialize_inputs-3088"><a href="#initialize_inputs-3088"><span class="linenos">3088</span></a>        <span class="p">):</span>
</span><span id="initialize_inputs-3089"><a href="#initialize_inputs-3089"><span class="linenos">3089</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span>
</span><span id="initialize_inputs-3090"><a href="#initialize_inputs-3090"><span class="linenos">3090</span></a>                <span class="n">options</span><span class="o">.</span><span class="n">output</span>
</span><span id="initialize_inputs-3091"><a href="#initialize_inputs-3091"><span class="linenos">3091</span></a>                <span class="o">+</span> <span class="n">options</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="initialize_inputs-3092"><a href="#initialize_inputs-3092"><span class="linenos">3092</span></a>                <span class="o">+</span> <span class="s2">&quot;/&quot;</span>
</span><span id="initialize_inputs-3093"><a href="#initialize_inputs-3093"><span class="linenos">3093</span></a>                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">season</span><span class="p">)</span>
</span><span id="initialize_inputs-3094"><a href="#initialize_inputs-3094"><span class="linenos">3094</span></a>            <span class="p">)</span>
</span><span id="initialize_inputs-3095"><a href="#initialize_inputs-3095"><span class="linenos">3095</span></a>        <span class="n">options</span><span class="o">.</span><span class="n">output</span> <span class="o">+=</span> <span class="n">options</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">season</span><span class="p">)</span>
</span><span id="initialize_inputs-3096"><a href="#initialize_inputs-3096"><span class="linenos">3096</span></a>    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">output</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;/&quot;</span><span class="p">:</span>
</span><span id="initialize_inputs-3097"><a href="#initialize_inputs-3097"><span class="linenos">3097</span></a>        <span class="n">options</span><span class="o">.</span><span class="n">output</span> <span class="o">+=</span> <span class="s2">&quot;/&quot;</span>
</span><span id="initialize_inputs-3098"><a href="#initialize_inputs-3098"><span class="linenos">3098</span></a>    <span class="k">return</span> <span class="n">options</span>
</span></pre></div>


            <div class="docstring"><p>Initializing arguments based on command line inputs provided by the user.</p>

<p>Returns:
    optparse.Values: collection of cleaned input values based on inputs and basic logic.</p>
</div>


                </section>
                <section id="main">
                            <input id="main-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">main</span><span class="signature pdoc-code condensed">(<span class="return-annotation">):</span></span>

                <label class="view-source-button" for="main-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#main"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="main-3101"><a href="#main-3101"><span class="linenos">3101</span></a><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
</span><span id="main-3102"><a href="#main-3102"><span class="linenos">3102</span></a>    <span class="n">options</span> <span class="o">=</span> <span class="n">initialize_inputs</span><span class="p">()</span>
</span><span id="main-3103"><a href="#main-3103"><span class="linenos">3103</span></a>    <span class="n">league</span> <span class="o">=</span> <span class="n">League</span><span class="p">(</span>
</span><span id="main-3104"><a href="#main-3104"><span class="linenos">3104</span></a>        <span class="n">name</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span id="main-3105"><a href="#main-3105"><span class="linenos">3105</span></a>        <span class="n">season</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">season</span><span class="p">,</span>
</span><span id="main-3106"><a href="#main-3106"><span class="linenos">3106</span></a>        <span class="n">week</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">week</span><span class="p">,</span>
</span><span id="main-3107"><a href="#main-3107"><span class="linenos">3107</span></a>        <span class="n">injurytries</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">injurytries</span><span class="p">,</span>
</span><span id="main-3108"><a href="#main-3108"><span class="linenos">3108</span></a>        <span class="n">num_sims</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">sims</span><span class="p">,</span>
</span><span id="main-3109"><a href="#main-3109"><span class="linenos">3109</span></a>        <span class="n">earliest</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">earliest</span><span class="p">,</span>
</span><span id="main-3110"><a href="#main-3110"><span class="linenos">3110</span></a>        <span class="n">reference_games</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">games</span><span class="p">,</span>
</span><span id="main-3111"><a href="#main-3111"><span class="linenos">3111</span></a>        <span class="n">basaloppstringtime</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">basaloppstringtime</span><span class="p">,</span>
</span><span id="main-3112"><a href="#main-3112"><span class="linenos">3112</span></a>    <span class="p">)</span>
</span><span id="main-3113"><a href="#main-3113"><span class="linenos">3113</span></a>    <span class="n">writer</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelWriter</span><span class="p">(</span>
</span><span id="main-3114"><a href="#main-3114"><span class="linenos">3114</span></a>        <span class="n">options</span><span class="o">.</span><span class="n">output</span>
</span><span id="main-3115"><a href="#main-3115"><span class="linenos">3115</span></a>        <span class="o">+</span> <span class="s2">&quot;FantasyFootballProjections_</span><span class="si">{}</span><span class="s2">Week</span><span class="si">{}{}</span><span class="s2">.xlsx&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="main-3116"><a href="#main-3116"><span class="linenos">3116</span></a>            <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%A&quot;</span><span class="p">),</span> <span class="n">league</span><span class="o">.</span><span class="n">week</span><span class="p">,</span> <span class="s2">&quot;_BestBall&quot;</span> <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">bestball</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
</span><span id="main-3117"><a href="#main-3117"><span class="linenos">3117</span></a>        <span class="p">),</span>
</span><span id="main-3118"><a href="#main-3118"><span class="linenos">3118</span></a>        <span class="n">engine</span><span class="o">=</span><span class="s2">&quot;xlsxwriter&quot;</span><span class="p">,</span>
</span><span id="main-3119"><a href="#main-3119"><span class="linenos">3119</span></a>    <span class="p">)</span>
</span><span id="main-3120"><a href="#main-3120"><span class="linenos">3120</span></a>    <span class="n">writer</span><span class="o">.</span><span class="n">book</span><span class="o">.</span><span class="n">add_format</span><span class="p">({</span><span class="s2">&quot;align&quot;</span><span class="p">:</span> <span class="s2">&quot;vcenter&quot;</span><span class="p">})</span>
</span><span id="main-3121"><a href="#main-3121"><span class="linenos">3121</span></a>
</span><span id="main-3122"><a href="#main-3122"><span class="linenos">3122</span></a>    <span class="n">rosters</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="main-3123"><a href="#main-3123"><span class="linenos">3123</span></a>        <span class="n">league</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">league</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">fantasy_team</span><span class="o">.</span><span class="n">isnull</span><span class="p">()]</span>
</span><span id="main-3124"><a href="#main-3124"><span class="linenos">3124</span></a>        <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;fantasy_team&quot;</span><span class="p">,</span> <span class="s2">&quot;WAR&quot;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">])</span>
</span><span id="main-3125"><a href="#main-3125"><span class="linenos">3125</span></a>        <span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="main-3126"><a href="#main-3126"><span class="linenos">3126</span></a>    <span class="p">)</span>
</span><span id="main-3127"><a href="#main-3127"><span class="linenos">3127</span></a>    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="main-3128"><a href="#main-3128"><span class="linenos">3128</span></a>        <span class="s2">&quot;points_avg&quot;</span><span class="p">,</span>
</span><span id="main-3129"><a href="#main-3129"><span class="linenos">3129</span></a>        <span class="s2">&quot;points_stdev&quot;</span><span class="p">,</span>
</span><span id="main-3130"><a href="#main-3130"><span class="linenos">3130</span></a>        <span class="s2">&quot;WAR&quot;</span><span class="p">,</span>
</span><span id="main-3131"><a href="#main-3131"><span class="linenos">3131</span></a>        <span class="s2">&quot;game_factor&quot;</span><span class="p">,</span>
</span><span id="main-3132"><a href="#main-3132"><span class="linenos">3132</span></a>        <span class="s2">&quot;opp_factor&quot;</span><span class="p">,</span>
</span><span id="main-3133"><a href="#main-3133"><span class="linenos">3133</span></a>        <span class="s2">&quot;string_factor&quot;</span><span class="p">,</span>
</span><span id="main-3134"><a href="#main-3134"><span class="linenos">3134</span></a>    <span class="p">]:</span>
</span><span id="main-3135"><a href="#main-3135"><span class="linenos">3135</span></a>        <span class="n">rosters</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">rosters</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="main-3136"><a href="#main-3136"><span class="linenos">3136</span></a>    <span class="n">writer</span> <span class="o">=</span> <span class="n">excelAutofit</span><span class="p">(</span>
</span><span id="main-3137"><a href="#main-3137"><span class="linenos">3137</span></a>        <span class="n">rosters</span><span class="p">[</span>
</span><span id="main-3138"><a href="#main-3138"><span class="linenos">3138</span></a>            <span class="p">[</span>
</span><span id="main-3139"><a href="#main-3139"><span class="linenos">3139</span></a>                <span class="s2">&quot;name&quot;</span><span class="p">,</span>
</span><span id="main-3140"><a href="#main-3140"><span class="linenos">3140</span></a>                <span class="s2">&quot;position&quot;</span><span class="p">,</span>
</span><span id="main-3141"><a href="#main-3141"><span class="linenos">3141</span></a>                <span class="s2">&quot;current_team&quot;</span><span class="p">,</span>
</span><span id="main-3142"><a href="#main-3142"><span class="linenos">3142</span></a>                <span class="s2">&quot;points_avg&quot;</span><span class="p">,</span>
</span><span id="main-3143"><a href="#main-3143"><span class="linenos">3143</span></a>                <span class="s2">&quot;points_stdev&quot;</span><span class="p">,</span>
</span><span id="main-3144"><a href="#main-3144"><span class="linenos">3144</span></a>                <span class="s2">&quot;WAR&quot;</span><span class="p">,</span>
</span><span id="main-3145"><a href="#main-3145"><span class="linenos">3145</span></a>                <span class="s2">&quot;fantasy_team&quot;</span><span class="p">,</span>
</span><span id="main-3146"><a href="#main-3146"><span class="linenos">3146</span></a>                <span class="s2">&quot;num_games&quot;</span><span class="p">,</span>
</span><span id="main-3147"><a href="#main-3147"><span class="linenos">3147</span></a>                <span class="s2">&quot;game_factor&quot;</span><span class="p">,</span>
</span><span id="main-3148"><a href="#main-3148"><span class="linenos">3148</span></a>                <span class="s2">&quot;opp_factor&quot;</span><span class="p">,</span>
</span><span id="main-3149"><a href="#main-3149"><span class="linenos">3149</span></a>                <span class="s2">&quot;string_factor&quot;</span><span class="p">,</span>
</span><span id="main-3150"><a href="#main-3150"><span class="linenos">3150</span></a>                <span class="s2">&quot;status&quot;</span><span class="p">,</span>
</span><span id="main-3151"><a href="#main-3151"><span class="linenos">3151</span></a>                <span class="s2">&quot;bye_week&quot;</span><span class="p">,</span>
</span><span id="main-3152"><a href="#main-3152"><span class="linenos">3152</span></a>                <span class="s2">&quot;until&quot;</span><span class="p">,</span>
</span><span id="main-3153"><a href="#main-3153"><span class="linenos">3153</span></a>                <span class="s2">&quot;starter&quot;</span><span class="p">,</span>
</span><span id="main-3154"><a href="#main-3154"><span class="linenos">3154</span></a>                <span class="s2">&quot;injured&quot;</span><span class="p">,</span>
</span><span id="main-3155"><a href="#main-3155"><span class="linenos">3155</span></a>                <span class="s2">&quot;pct_rostered&quot;</span><span class="p">,</span>
</span><span id="main-3156"><a href="#main-3156"><span class="linenos">3156</span></a>            <span class="p">]</span>
</span><span id="main-3157"><a href="#main-3157"><span class="linenos">3157</span></a>        <span class="p">],</span>
</span><span id="main-3158"><a href="#main-3158"><span class="linenos">3158</span></a>        <span class="s2">&quot;Rosters&quot;</span><span class="p">,</span>
</span><span id="main-3159"><a href="#main-3159"><span class="linenos">3159</span></a>        <span class="n">writer</span><span class="p">,</span>
</span><span id="main-3160"><a href="#main-3160"><span class="linenos">3160</span></a>    <span class="p">)</span>
</span><span id="main-3161"><a href="#main-3161"><span class="linenos">3161</span></a>    <span class="n">writer</span><span class="o">.</span><span class="n">sheets</span><span class="p">[</span><span class="s2">&quot;Rosters&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">conditional_format</span><span class="p">(</span>
</span><span id="main-3162"><a href="#main-3162"><span class="linenos">3162</span></a>        <span class="s2">&quot;F2:F&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rosters</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="main-3163"><a href="#main-3163"><span class="linenos">3163</span></a>        <span class="p">{</span>
</span><span id="main-3164"><a href="#main-3164"><span class="linenos">3164</span></a>            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;3_color_scale&quot;</span><span class="p">,</span>
</span><span id="main-3165"><a href="#main-3165"><span class="linenos">3165</span></a>            <span class="s2">&quot;min_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FF6347&quot;</span><span class="p">,</span>
</span><span id="main-3166"><a href="#main-3166"><span class="linenos">3166</span></a>            <span class="s2">&quot;mid_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FFD700&quot;</span><span class="p">,</span>
</span><span id="main-3167"><a href="#main-3167"><span class="linenos">3167</span></a>            <span class="s2">&quot;max_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#3CB371&quot;</span><span class="p">,</span>
</span><span id="main-3168"><a href="#main-3168"><span class="linenos">3168</span></a>        <span class="p">},</span>
</span><span id="main-3169"><a href="#main-3169"><span class="linenos">3169</span></a>    <span class="p">)</span>
</span><span id="main-3170"><a href="#main-3170"><span class="linenos">3170</span></a>    <span class="n">available</span> <span class="o">=</span> <span class="n">league</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="main-3171"><a href="#main-3171"><span class="linenos">3171</span></a>        <span class="n">league</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">fantasy_team</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span>
</span><span id="main-3172"><a href="#main-3172"><span class="linenos">3172</span></a>        <span class="o">&amp;</span> <span class="p">(</span><span class="n">league</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">until</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span> <span class="o">|</span> <span class="p">(</span><span class="n">league</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">until</span> <span class="o">&lt;</span> <span class="mi">17</span><span class="p">))</span>
</span><span id="main-3173"><a href="#main-3173"><span class="linenos">3173</span></a>    <span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;WAR&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="main-3174"><a href="#main-3174"><span class="linenos">3174</span></a>    <span class="k">del</span> <span class="n">available</span><span class="p">[</span><span class="s2">&quot;fantasy_team&quot;</span><span class="p">]</span>
</span><span id="main-3175"><a href="#main-3175"><span class="linenos">3175</span></a>    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="main-3176"><a href="#main-3176"><span class="linenos">3176</span></a>        <span class="s2">&quot;points_avg&quot;</span><span class="p">,</span>
</span><span id="main-3177"><a href="#main-3177"><span class="linenos">3177</span></a>        <span class="s2">&quot;points_stdev&quot;</span><span class="p">,</span>
</span><span id="main-3178"><a href="#main-3178"><span class="linenos">3178</span></a>        <span class="s2">&quot;WAR&quot;</span><span class="p">,</span>
</span><span id="main-3179"><a href="#main-3179"><span class="linenos">3179</span></a>        <span class="s2">&quot;game_factor&quot;</span><span class="p">,</span>
</span><span id="main-3180"><a href="#main-3180"><span class="linenos">3180</span></a>        <span class="s2">&quot;opp_factor&quot;</span><span class="p">,</span>
</span><span id="main-3181"><a href="#main-3181"><span class="linenos">3181</span></a>        <span class="s2">&quot;string_factor&quot;</span><span class="p">,</span>
</span><span id="main-3182"><a href="#main-3182"><span class="linenos">3182</span></a>    <span class="p">]:</span>
</span><span id="main-3183"><a href="#main-3183"><span class="linenos">3183</span></a>        <span class="n">available</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">available</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="main-3184"><a href="#main-3184"><span class="linenos">3184</span></a>    <span class="n">writer</span> <span class="o">=</span> <span class="n">excelAutofit</span><span class="p">(</span>
</span><span id="main-3185"><a href="#main-3185"><span class="linenos">3185</span></a>        <span class="n">available</span><span class="p">[</span>
</span><span id="main-3186"><a href="#main-3186"><span class="linenos">3186</span></a>            <span class="p">[</span>
</span><span id="main-3187"><a href="#main-3187"><span class="linenos">3187</span></a>                <span class="s2">&quot;name&quot;</span><span class="p">,</span>
</span><span id="main-3188"><a href="#main-3188"><span class="linenos">3188</span></a>                <span class="s2">&quot;position&quot;</span><span class="p">,</span>
</span><span id="main-3189"><a href="#main-3189"><span class="linenos">3189</span></a>                <span class="s2">&quot;current_team&quot;</span><span class="p">,</span>
</span><span id="main-3190"><a href="#main-3190"><span class="linenos">3190</span></a>                <span class="s2">&quot;points_avg&quot;</span><span class="p">,</span>
</span><span id="main-3191"><a href="#main-3191"><span class="linenos">3191</span></a>                <span class="s2">&quot;points_stdev&quot;</span><span class="p">,</span>
</span><span id="main-3192"><a href="#main-3192"><span class="linenos">3192</span></a>                <span class="s2">&quot;WAR&quot;</span><span class="p">,</span>
</span><span id="main-3193"><a href="#main-3193"><span class="linenos">3193</span></a>                <span class="s2">&quot;num_games&quot;</span><span class="p">,</span>
</span><span id="main-3194"><a href="#main-3194"><span class="linenos">3194</span></a>                <span class="s2">&quot;game_factor&quot;</span><span class="p">,</span>
</span><span id="main-3195"><a href="#main-3195"><span class="linenos">3195</span></a>                <span class="s2">&quot;opp_factor&quot;</span><span class="p">,</span>
</span><span id="main-3196"><a href="#main-3196"><span class="linenos">3196</span></a>                <span class="s2">&quot;string_factor&quot;</span><span class="p">,</span>
</span><span id="main-3197"><a href="#main-3197"><span class="linenos">3197</span></a>                <span class="s2">&quot;status&quot;</span><span class="p">,</span>
</span><span id="main-3198"><a href="#main-3198"><span class="linenos">3198</span></a>                <span class="s2">&quot;bye_week&quot;</span><span class="p">,</span>
</span><span id="main-3199"><a href="#main-3199"><span class="linenos">3199</span></a>                <span class="s2">&quot;until&quot;</span><span class="p">,</span>
</span><span id="main-3200"><a href="#main-3200"><span class="linenos">3200</span></a>                <span class="s2">&quot;pct_rostered&quot;</span><span class="p">,</span>
</span><span id="main-3201"><a href="#main-3201"><span class="linenos">3201</span></a>            <span class="p">]</span>
</span><span id="main-3202"><a href="#main-3202"><span class="linenos">3202</span></a>        <span class="p">],</span>
</span><span id="main-3203"><a href="#main-3203"><span class="linenos">3203</span></a>        <span class="s2">&quot;Available&quot;</span><span class="p">,</span>
</span><span id="main-3204"><a href="#main-3204"><span class="linenos">3204</span></a>        <span class="n">writer</span><span class="p">,</span>
</span><span id="main-3205"><a href="#main-3205"><span class="linenos">3205</span></a>    <span class="p">)</span>
</span><span id="main-3206"><a href="#main-3206"><span class="linenos">3206</span></a>    <span class="n">writer</span><span class="o">.</span><span class="n">sheets</span><span class="p">[</span><span class="s2">&quot;Available&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">conditional_format</span><span class="p">(</span>
</span><span id="main-3207"><a href="#main-3207"><span class="linenos">3207</span></a>        <span class="s2">&quot;F2:F&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">available</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="main-3208"><a href="#main-3208"><span class="linenos">3208</span></a>        <span class="p">{</span>
</span><span id="main-3209"><a href="#main-3209"><span class="linenos">3209</span></a>            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;3_color_scale&quot;</span><span class="p">,</span>
</span><span id="main-3210"><a href="#main-3210"><span class="linenos">3210</span></a>            <span class="s2">&quot;min_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FF6347&quot;</span><span class="p">,</span>
</span><span id="main-3211"><a href="#main-3211"><span class="linenos">3211</span></a>            <span class="s2">&quot;mid_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FFD700&quot;</span><span class="p">,</span>
</span><span id="main-3212"><a href="#main-3212"><span class="linenos">3212</span></a>            <span class="s2">&quot;max_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#3CB371&quot;</span><span class="p">,</span>
</span><span id="main-3213"><a href="#main-3213"><span class="linenos">3213</span></a>        <span class="p">},</span>
</span><span id="main-3214"><a href="#main-3214"><span class="linenos">3214</span></a>    <span class="p">)</span>
</span><span id="main-3215"><a href="#main-3215"><span class="linenos">3215</span></a>
</span><span id="main-3216"><a href="#main-3216"><span class="linenos">3216</span></a>    <span class="c1"># # ASSESS WAR VALUES FOR EACH TEAM&#39;S STARTERS!!!</span>
</span><span id="main-3217"><a href="#main-3217"><span class="linenos">3217</span></a>    <span class="c1"># war_inds = rosters.starter &amp; ~rosters.position.isin([&quot;DEF&quot;,&quot;K&quot;])</span>
</span><span id="main-3218"><a href="#main-3218"><span class="linenos">3218</span></a>    <span class="c1"># war_vals = pd.merge(left=rosters.loc[war_inds].groupby([&quot;fantasy_team&quot;,&quot;position&quot;]).WAR.mean().unstack().reset_index(),\</span>
</span><span id="main-3219"><a href="#main-3219"><span class="linenos">3219</span></a>    <span class="c1"># right=rosters.loc[war_inds].groupby(&quot;fantasy_team&quot;).WAR.mean().reset_index().rename(columns={&quot;WAR&quot;:&quot;Overall&quot;}),how=&#39;inner&#39;,on=&#39;fantasy_team&#39;)</span>
</span><span id="main-3220"><a href="#main-3220"><span class="linenos">3220</span></a>    <span class="c1"># print(war_vals[[&quot;fantasy_team&quot;,&quot;QB&quot;,&quot;WR&quot;,&quot;RB&quot;]].set_index(&#39;fantasy_team&#39;).T.corr())</span>
</span><span id="main-3221"><a href="#main-3221"><span class="linenos">3221</span></a>    <span class="c1"># for col in war_vals.columns:</span>
</span><span id="main-3222"><a href="#main-3222"><span class="linenos">3222</span></a>    <span class="c1">#     if col != &quot;fantasy_team&quot;:</span>
</span><span id="main-3223"><a href="#main-3223"><span class="linenos">3223</span></a>    <span class="c1">#         war_vals[col] = round(war_vals[col],3)</span>
</span><span id="main-3224"><a href="#main-3224"><span class="linenos">3224</span></a>    <span class="c1"># writer = excelAutofit(war_vals,&quot;Team WAR&quot;,writer)</span>
</span><span id="main-3225"><a href="#main-3225"><span class="linenos">3225</span></a>    <span class="c1"># writer.sheets[&quot;Team WAR&quot;].conditional_format(</span>
</span><span id="main-3226"><a href="#main-3226"><span class="linenos">3226</span></a>    <span class="c1">#     &quot;B2:F&quot; + str(rosters.shape[0] + 1),</span>
</span><span id="main-3227"><a href="#main-3227"><span class="linenos">3227</span></a>    <span class="c1">#     {</span>
</span><span id="main-3228"><a href="#main-3228"><span class="linenos">3228</span></a>    <span class="c1">#         &quot;type&quot;: &quot;3_color_scale&quot;,</span>
</span><span id="main-3229"><a href="#main-3229"><span class="linenos">3229</span></a>    <span class="c1">#         &quot;min_color&quot;: &quot;#FF6347&quot;,</span>
</span><span id="main-3230"><a href="#main-3230"><span class="linenos">3230</span></a>    <span class="c1">#         &quot;mid_color&quot;: &quot;#FFD700&quot;,</span>
</span><span id="main-3231"><a href="#main-3231"><span class="linenos">3231</span></a>    <span class="c1">#         &quot;max_color&quot;: &quot;#3CB371&quot;,</span>
</span><span id="main-3232"><a href="#main-3232"><span class="linenos">3232</span></a>    <span class="c1">#     },</span>
</span><span id="main-3233"><a href="#main-3233"><span class="linenos">3233</span></a>    <span class="c1"># )</span>
</span><span id="main-3234"><a href="#main-3234"><span class="linenos">3234</span></a>    <span class="c1"># # ASSESS WAR VALUES FOR EACH TEAM&#39;S STARTERS!!!</span>
</span><span id="main-3235"><a href="#main-3235"><span class="linenos">3235</span></a>
</span><span id="main-3236"><a href="#main-3236"><span class="linenos">3236</span></a>    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">bestball</span><span class="p">:</span>
</span><span id="main-3237"><a href="#main-3237"><span class="linenos">3237</span></a>        <span class="n">standings_sim</span> <span class="o">=</span> <span class="n">league</span><span class="o">.</span><span class="n">bestball_sims</span><span class="p">(</span><span class="n">payouts</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">payouts</span><span class="p">)</span>
</span><span id="main-3238"><a href="#main-3238"><span class="linenos">3238</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="main-3239"><a href="#main-3239"><span class="linenos">3239</span></a>        <span class="n">schedule_sim</span><span class="p">,</span> <span class="n">standings_sim</span> <span class="o">=</span> <span class="n">league</span><span class="o">.</span><span class="n">season_sims</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">payouts</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">payouts</span><span class="p">)</span>
</span><span id="main-3240"><a href="#main-3240"><span class="linenos">3240</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="main-3241"><a href="#main-3241"><span class="linenos">3241</span></a>            <span class="n">schedule_sim</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="main-3242"><a href="#main-3242"><span class="linenos">3242</span></a>                <span class="n">schedule_sim</span><span class="o">.</span><span class="n">week</span> <span class="o">==</span> <span class="n">league</span><span class="o">.</span><span class="n">week</span><span class="p">,</span>
</span><span id="main-3243"><a href="#main-3243"><span class="linenos">3243</span></a>                <span class="p">[</span>
</span><span id="main-3244"><a href="#main-3244"><span class="linenos">3244</span></a>                    <span class="s2">&quot;week&quot;</span><span class="p">,</span>
</span><span id="main-3245"><a href="#main-3245"><span class="linenos">3245</span></a>                    <span class="s2">&quot;team_1&quot;</span><span class="p">,</span>
</span><span id="main-3246"><a href="#main-3246"><span class="linenos">3246</span></a>                    <span class="s2">&quot;team_2&quot;</span><span class="p">,</span>
</span><span id="main-3247"><a href="#main-3247"><span class="linenos">3247</span></a>                    <span class="s2">&quot;win_1&quot;</span><span class="p">,</span>
</span><span id="main-3248"><a href="#main-3248"><span class="linenos">3248</span></a>                    <span class="s2">&quot;win_2&quot;</span><span class="p">,</span>
</span><span id="main-3249"><a href="#main-3249"><span class="linenos">3249</span></a>                    <span class="s2">&quot;points_avg_1&quot;</span><span class="p">,</span>
</span><span id="main-3250"><a href="#main-3250"><span class="linenos">3250</span></a>                    <span class="s2">&quot;points_avg_2&quot;</span><span class="p">,</span>
</span><span id="main-3251"><a href="#main-3251"><span class="linenos">3251</span></a>                <span class="p">],</span>
</span><span id="main-3252"><a href="#main-3252"><span class="linenos">3252</span></a>            <span class="p">]</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="main-3253"><a href="#main-3253"><span class="linenos">3253</span></a>        <span class="p">)</span>
</span><span id="main-3254"><a href="#main-3254"><span class="linenos">3254</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="main-3255"><a href="#main-3255"><span class="linenos">3255</span></a>            <span class="n">standings_sim</span><span class="p">[</span>
</span><span id="main-3256"><a href="#main-3256"><span class="linenos">3256</span></a>                <span class="p">[</span>
</span><span id="main-3257"><a href="#main-3257"><span class="linenos">3257</span></a>                    <span class="s2">&quot;team&quot;</span><span class="p">,</span>
</span><span id="main-3258"><a href="#main-3258"><span class="linenos">3258</span></a>                    <span class="s2">&quot;wins_avg&quot;</span><span class="p">,</span>
</span><span id="main-3259"><a href="#main-3259"><span class="linenos">3259</span></a>                    <span class="s2">&quot;points_avg&quot;</span><span class="p">,</span>
</span><span id="main-3260"><a href="#main-3260"><span class="linenos">3260</span></a>                    <span class="s2">&quot;playoffs&quot;</span><span class="p">,</span>
</span><span id="main-3261"><a href="#main-3261"><span class="linenos">3261</span></a>                    <span class="s2">&quot;playoff_bye&quot;</span><span class="p">,</span>
</span><span id="main-3262"><a href="#main-3262"><span class="linenos">3262</span></a>                    <span class="s2">&quot;winner&quot;</span><span class="p">,</span>
</span><span id="main-3263"><a href="#main-3263"><span class="linenos">3263</span></a>                    <span class="s2">&quot;earnings&quot;</span><span class="p">,</span>
</span><span id="main-3264"><a href="#main-3264"><span class="linenos">3264</span></a>                <span class="p">]</span>
</span><span id="main-3265"><a href="#main-3265"><span class="linenos">3265</span></a>                <span class="o">+</span> <span class="p">([</span><span class="s2">&quot;many_mile&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">league</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;The Algorithm&quot;</span> <span class="k">else</span> <span class="p">[])</span>
</span><span id="main-3266"><a href="#main-3266"><span class="linenos">3266</span></a>            <span class="p">]</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="main-3267"><a href="#main-3267"><span class="linenos">3267</span></a>        <span class="p">)</span>
</span><span id="main-3268"><a href="#main-3268"><span class="linenos">3268</span></a>        <span class="n">writer</span> <span class="o">=</span> <span class="n">excelAutofit</span><span class="p">(</span>
</span><span id="main-3269"><a href="#main-3269"><span class="linenos">3269</span></a>            <span class="n">schedule_sim</span><span class="p">[</span>
</span><span id="main-3270"><a href="#main-3270"><span class="linenos">3270</span></a>                <span class="p">[</span>
</span><span id="main-3271"><a href="#main-3271"><span class="linenos">3271</span></a>                    <span class="s2">&quot;week&quot;</span><span class="p">,</span>
</span><span id="main-3272"><a href="#main-3272"><span class="linenos">3272</span></a>                    <span class="s2">&quot;team_1&quot;</span><span class="p">,</span>
</span><span id="main-3273"><a href="#main-3273"><span class="linenos">3273</span></a>                    <span class="s2">&quot;team_2&quot;</span><span class="p">,</span>
</span><span id="main-3274"><a href="#main-3274"><span class="linenos">3274</span></a>                    <span class="s2">&quot;win_1&quot;</span><span class="p">,</span>
</span><span id="main-3275"><a href="#main-3275"><span class="linenos">3275</span></a>                    <span class="s2">&quot;win_2&quot;</span><span class="p">,</span>
</span><span id="main-3276"><a href="#main-3276"><span class="linenos">3276</span></a>                    <span class="s2">&quot;points_avg_1&quot;</span><span class="p">,</span>
</span><span id="main-3277"><a href="#main-3277"><span class="linenos">3277</span></a>                    <span class="s2">&quot;points_stdev_1&quot;</span><span class="p">,</span>
</span><span id="main-3278"><a href="#main-3278"><span class="linenos">3278</span></a>                    <span class="s2">&quot;points_avg_2&quot;</span><span class="p">,</span>
</span><span id="main-3279"><a href="#main-3279"><span class="linenos">3279</span></a>                    <span class="s2">&quot;points_stdev_2&quot;</span><span class="p">,</span>
</span><span id="main-3280"><a href="#main-3280"><span class="linenos">3280</span></a>                    <span class="s2">&quot;me&quot;</span><span class="p">,</span>
</span><span id="main-3281"><a href="#main-3281"><span class="linenos">3281</span></a>                <span class="p">]</span>
</span><span id="main-3282"><a href="#main-3282"><span class="linenos">3282</span></a>            <span class="p">],</span>
</span><span id="main-3283"><a href="#main-3283"><span class="linenos">3283</span></a>            <span class="s2">&quot;Schedule&quot;</span><span class="p">,</span>
</span><span id="main-3284"><a href="#main-3284"><span class="linenos">3284</span></a>            <span class="n">writer</span><span class="p">,</span>
</span><span id="main-3285"><a href="#main-3285"><span class="linenos">3285</span></a>            <span class="mi">3</span><span class="p">,</span>
</span><span id="main-3286"><a href="#main-3286"><span class="linenos">3286</span></a>        <span class="p">)</span>
</span><span id="main-3287"><a href="#main-3287"><span class="linenos">3287</span></a>        <span class="n">writer</span><span class="o">.</span><span class="n">sheets</span><span class="p">[</span><span class="s2">&quot;Schedule&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">conditional_format</span><span class="p">(</span>
</span><span id="main-3288"><a href="#main-3288"><span class="linenos">3288</span></a>            <span class="s2">&quot;D2:E&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">schedule_sim</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="main-3289"><a href="#main-3289"><span class="linenos">3289</span></a>            <span class="p">{</span>
</span><span id="main-3290"><a href="#main-3290"><span class="linenos">3290</span></a>                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;3_color_scale&quot;</span><span class="p">,</span>
</span><span id="main-3291"><a href="#main-3291"><span class="linenos">3291</span></a>                <span class="s2">&quot;min_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FF6347&quot;</span><span class="p">,</span>
</span><span id="main-3292"><a href="#main-3292"><span class="linenos">3292</span></a>                <span class="s2">&quot;mid_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FFD700&quot;</span><span class="p">,</span>
</span><span id="main-3293"><a href="#main-3293"><span class="linenos">3293</span></a>                <span class="s2">&quot;max_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#3CB371&quot;</span><span class="p">,</span>
</span><span id="main-3294"><a href="#main-3294"><span class="linenos">3294</span></a>            <span class="p">},</span>
</span><span id="main-3295"><a href="#main-3295"><span class="linenos">3295</span></a>        <span class="p">)</span>
</span><span id="main-3296"><a href="#main-3296"><span class="linenos">3296</span></a>    <span class="n">writer</span> <span class="o">=</span> <span class="n">excelAutofit</span><span class="p">(</span>
</span><span id="main-3297"><a href="#main-3297"><span class="linenos">3297</span></a>        <span class="n">standings_sim</span><span class="p">[</span>
</span><span id="main-3298"><a href="#main-3298"><span class="linenos">3298</span></a>            <span class="p">[</span>
</span><span id="main-3299"><a href="#main-3299"><span class="linenos">3299</span></a>                <span class="s2">&quot;team&quot;</span><span class="p">,</span>
</span><span id="main-3300"><a href="#main-3300"><span class="linenos">3300</span></a>                <span class="s2">&quot;wins_avg&quot;</span><span class="p">,</span>
</span><span id="main-3301"><a href="#main-3301"><span class="linenos">3301</span></a>                <span class="s2">&quot;wins_stdev&quot;</span><span class="p">,</span>
</span><span id="main-3302"><a href="#main-3302"><span class="linenos">3302</span></a>                <span class="s2">&quot;points_avg&quot;</span><span class="p">,</span>
</span><span id="main-3303"><a href="#main-3303"><span class="linenos">3303</span></a>                <span class="s2">&quot;points_stdev&quot;</span><span class="p">,</span>
</span><span id="main-3304"><a href="#main-3304"><span class="linenos">3304</span></a>            <span class="p">]</span>
</span><span id="main-3305"><a href="#main-3305"><span class="linenos">3305</span></a>            <span class="o">+</span> <span class="p">([</span>
</span><span id="main-3306"><a href="#main-3306"><span class="linenos">3306</span></a>                <span class="s2">&quot;per_game_avg&quot;</span><span class="p">,</span>
</span><span id="main-3307"><a href="#main-3307"><span class="linenos">3307</span></a>                <span class="s2">&quot;per_game_stdev&quot;</span><span class="p">,</span>
</span><span id="main-3308"><a href="#main-3308"><span class="linenos">3308</span></a>                <span class="s2">&quot;per_game_fano&quot;</span><span class="p">,</span>
</span><span id="main-3309"><a href="#main-3309"><span class="linenos">3309</span></a>            <span class="p">]</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">options</span><span class="o">.</span><span class="n">bestball</span> <span class="k">else</span> <span class="p">[])</span> 
</span><span id="main-3310"><a href="#main-3310"><span class="linenos">3310</span></a>            <span class="o">+</span> <span class="p">[</span>
</span><span id="main-3311"><a href="#main-3311"><span class="linenos">3311</span></a>                <span class="s2">&quot;playoffs&quot;</span><span class="p">,</span>
</span><span id="main-3312"><a href="#main-3312"><span class="linenos">3312</span></a>                <span class="s2">&quot;playoff_bye&quot;</span><span class="p">,</span>
</span><span id="main-3313"><a href="#main-3313"><span class="linenos">3313</span></a>                <span class="s2">&quot;winner&quot;</span><span class="p">,</span>
</span><span id="main-3314"><a href="#main-3314"><span class="linenos">3314</span></a>                <span class="s2">&quot;runner_up&quot;</span><span class="p">,</span>
</span><span id="main-3315"><a href="#main-3315"><span class="linenos">3315</span></a>                <span class="s2">&quot;third&quot;</span><span class="p">,</span>
</span><span id="main-3316"><a href="#main-3316"><span class="linenos">3316</span></a>                <span class="s2">&quot;earnings&quot;</span><span class="p">,</span>
</span><span id="main-3317"><a href="#main-3317"><span class="linenos">3317</span></a>            <span class="p">]</span>
</span><span id="main-3318"><a href="#main-3318"><span class="linenos">3318</span></a>            <span class="o">+</span> <span class="p">([</span><span class="s2">&quot;many_mile&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">league</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;The Algorithm&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">options</span><span class="o">.</span><span class="n">bestball</span> <span class="k">else</span> <span class="p">[])</span>
</span><span id="main-3319"><a href="#main-3319"><span class="linenos">3319</span></a>        <span class="p">],</span>
</span><span id="main-3320"><a href="#main-3320"><span class="linenos">3320</span></a>        <span class="s2">&quot;Standings&quot;</span><span class="p">,</span>
</span><span id="main-3321"><a href="#main-3321"><span class="linenos">3321</span></a>        <span class="n">writer</span><span class="p">,</span>
</span><span id="main-3322"><a href="#main-3322"><span class="linenos">3322</span></a>    <span class="p">)</span>
</span><span id="main-3323"><a href="#main-3323"><span class="linenos">3323</span></a>    <span class="n">writer</span><span class="o">.</span><span class="n">sheets</span><span class="p">[</span><span class="s2">&quot;Standings&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">conditional_format</span><span class="p">(</span>
</span><span id="main-3324"><a href="#main-3324"><span class="linenos">3324</span></a>        <span class="s2">&quot;I2:M&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">standings_sim</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="main-3325"><a href="#main-3325"><span class="linenos">3325</span></a>        <span class="p">{</span>
</span><span id="main-3326"><a href="#main-3326"><span class="linenos">3326</span></a>            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;3_color_scale&quot;</span><span class="p">,</span>
</span><span id="main-3327"><a href="#main-3327"><span class="linenos">3327</span></a>            <span class="s2">&quot;min_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FF6347&quot;</span><span class="p">,</span>
</span><span id="main-3328"><a href="#main-3328"><span class="linenos">3328</span></a>            <span class="s2">&quot;mid_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FFD700&quot;</span><span class="p">,</span>
</span><span id="main-3329"><a href="#main-3329"><span class="linenos">3329</span></a>            <span class="s2">&quot;max_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#3CB371&quot;</span><span class="p">,</span>
</span><span id="main-3330"><a href="#main-3330"><span class="linenos">3330</span></a>        <span class="p">},</span>
</span><span id="main-3331"><a href="#main-3331"><span class="linenos">3331</span></a>    <span class="p">)</span>
</span><span id="main-3332"><a href="#main-3332"><span class="linenos">3332</span></a>    <span class="n">writer</span><span class="o">.</span><span class="n">sheets</span><span class="p">[</span><span class="s2">&quot;Standings&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">conditional_format</span><span class="p">(</span>
</span><span id="main-3333"><a href="#main-3333"><span class="linenos">3333</span></a>        <span class="s2">&quot;N2:N&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">standings_sim</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="main-3334"><a href="#main-3334"><span class="linenos">3334</span></a>        <span class="p">{</span>
</span><span id="main-3335"><a href="#main-3335"><span class="linenos">3335</span></a>            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;3_color_scale&quot;</span><span class="p">,</span>
</span><span id="main-3336"><a href="#main-3336"><span class="linenos">3336</span></a>            <span class="s2">&quot;min_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FF6347&quot;</span><span class="p">,</span>
</span><span id="main-3337"><a href="#main-3337"><span class="linenos">3337</span></a>            <span class="s2">&quot;mid_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FFD700&quot;</span><span class="p">,</span>
</span><span id="main-3338"><a href="#main-3338"><span class="linenos">3338</span></a>            <span class="s2">&quot;max_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#3CB371&quot;</span><span class="p">,</span>
</span><span id="main-3339"><a href="#main-3339"><span class="linenos">3339</span></a>        <span class="p">},</span>
</span><span id="main-3340"><a href="#main-3340"><span class="linenos">3340</span></a>    <span class="p">)</span>
</span><span id="main-3341"><a href="#main-3341"><span class="linenos">3341</span></a>    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;The Algorithm&quot;</span><span class="p">:</span>
</span><span id="main-3342"><a href="#main-3342"><span class="linenos">3342</span></a>        <span class="n">writer</span><span class="o">.</span><span class="n">sheets</span><span class="p">[</span><span class="s2">&quot;Standings&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">conditional_format</span><span class="p">(</span>
</span><span id="main-3343"><a href="#main-3343"><span class="linenos">3343</span></a>            <span class="s2">&quot;O2:O&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">standings_sim</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="main-3344"><a href="#main-3344"><span class="linenos">3344</span></a>            <span class="p">{</span>
</span><span id="main-3345"><a href="#main-3345"><span class="linenos">3345</span></a>                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;3_color_scale&quot;</span><span class="p">,</span>
</span><span id="main-3346"><a href="#main-3346"><span class="linenos">3346</span></a>                <span class="s2">&quot;max_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FF6347&quot;</span><span class="p">,</span>
</span><span id="main-3347"><a href="#main-3347"><span class="linenos">3347</span></a>                <span class="s2">&quot;mid_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FFD700&quot;</span><span class="p">,</span>
</span><span id="main-3348"><a href="#main-3348"><span class="linenos">3348</span></a>                <span class="s2">&quot;min_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#3CB371&quot;</span><span class="p">,</span>
</span><span id="main-3349"><a href="#main-3349"><span class="linenos">3349</span></a>            <span class="p">},</span>
</span><span id="main-3350"><a href="#main-3350"><span class="linenos">3350</span></a>        <span class="p">)</span>
</span><span id="main-3351"><a href="#main-3351"><span class="linenos">3351</span></a>
</span><span id="main-3352"><a href="#main-3352"><span class="linenos">3352</span></a>    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">pickups</span><span class="p">:</span>
</span><span id="main-3353"><a href="#main-3353"><span class="linenos">3353</span></a>        <span class="n">pickups</span> <span class="o">=</span> <span class="n">league</span><span class="o">.</span><span class="n">possible_pickups</span><span class="p">(</span>
</span><span id="main-3354"><a href="#main-3354"><span class="linenos">3354</span></a>            <span class="n">focus_on</span><span class="o">=</span><span class="p">[</span><span class="n">val</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">pickups</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)]</span>
</span><span id="main-3355"><a href="#main-3355"><span class="linenos">3355</span></a>            <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">pickups</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;all&quot;</span>
</span><span id="main-3356"><a href="#main-3356"><span class="linenos">3356</span></a>            <span class="k">else</span> <span class="p">[],</span>
</span><span id="main-3357"><a href="#main-3357"><span class="linenos">3357</span></a>            <span class="n">exclude</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Tom Brady&quot;</span><span class="p">],</span>
</span><span id="main-3358"><a href="#main-3358"><span class="linenos">3358</span></a>            <span class="n">limit_per</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
</span><span id="main-3359"><a href="#main-3359"><span class="linenos">3359</span></a>            <span class="n">payouts</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">payouts</span><span class="p">,</span>
</span><span id="main-3360"><a href="#main-3360"><span class="linenos">3360</span></a>            <span class="n">bestball</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">bestball</span><span class="p">,</span>
</span><span id="main-3361"><a href="#main-3361"><span class="linenos">3361</span></a>        <span class="p">)</span>
</span><span id="main-3362"><a href="#main-3362"><span class="linenos">3362</span></a>        <span class="n">writer</span> <span class="o">=</span> <span class="n">excelAutofit</span><span class="p">(</span>
</span><span id="main-3363"><a href="#main-3363"><span class="linenos">3363</span></a>            <span class="n">pickups</span><span class="p">[</span>
</span><span id="main-3364"><a href="#main-3364"><span class="linenos">3364</span></a>                <span class="p">[</span>
</span><span id="main-3365"><a href="#main-3365"><span class="linenos">3365</span></a>                    <span class="s2">&quot;player_to_drop&quot;</span><span class="p">,</span>
</span><span id="main-3366"><a href="#main-3366"><span class="linenos">3366</span></a>                    <span class="s2">&quot;player_to_add&quot;</span><span class="p">,</span>
</span><span id="main-3367"><a href="#main-3367"><span class="linenos">3367</span></a>                    <span class="s2">&quot;wins_avg&quot;</span><span class="p">,</span>
</span><span id="main-3368"><a href="#main-3368"><span class="linenos">3368</span></a>                    <span class="s2">&quot;wins_stdev&quot;</span><span class="p">,</span>
</span><span id="main-3369"><a href="#main-3369"><span class="linenos">3369</span></a>                    <span class="s2">&quot;points_avg&quot;</span><span class="p">,</span>
</span><span id="main-3370"><a href="#main-3370"><span class="linenos">3370</span></a>                    <span class="s2">&quot;points_stdev&quot;</span><span class="p">,</span>
</span><span id="main-3371"><a href="#main-3371"><span class="linenos">3371</span></a>                    <span class="s2">&quot;per_game_avg&quot;</span><span class="p">,</span>
</span><span id="main-3372"><a href="#main-3372"><span class="linenos">3372</span></a>                    <span class="s2">&quot;per_game_stdev&quot;</span><span class="p">,</span>
</span><span id="main-3373"><a href="#main-3373"><span class="linenos">3373</span></a>                    <span class="s2">&quot;per_game_fano&quot;</span><span class="p">,</span>
</span><span id="main-3374"><a href="#main-3374"><span class="linenos">3374</span></a>                    <span class="s2">&quot;playoffs&quot;</span><span class="p">,</span>
</span><span id="main-3375"><a href="#main-3375"><span class="linenos">3375</span></a>                    <span class="s2">&quot;playoff_bye&quot;</span><span class="p">,</span>
</span><span id="main-3376"><a href="#main-3376"><span class="linenos">3376</span></a>                    <span class="s2">&quot;winner&quot;</span><span class="p">,</span>
</span><span id="main-3377"><a href="#main-3377"><span class="linenos">3377</span></a>                    <span class="s2">&quot;runner_up&quot;</span><span class="p">,</span>
</span><span id="main-3378"><a href="#main-3378"><span class="linenos">3378</span></a>                    <span class="s2">&quot;third&quot;</span><span class="p">,</span>
</span><span id="main-3379"><a href="#main-3379"><span class="linenos">3379</span></a>                    <span class="s2">&quot;earnings&quot;</span><span class="p">,</span>
</span><span id="main-3380"><a href="#main-3380"><span class="linenos">3380</span></a>                <span class="p">]</span>
</span><span id="main-3381"><a href="#main-3381"><span class="linenos">3381</span></a>                <span class="o">+</span> <span class="p">([</span><span class="s2">&quot;many_mile&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;The Algorithm&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">options</span><span class="o">.</span><span class="n">bestball</span> <span class="k">else</span> <span class="p">[])</span>
</span><span id="main-3382"><a href="#main-3382"><span class="linenos">3382</span></a>            <span class="p">],</span>
</span><span id="main-3383"><a href="#main-3383"><span class="linenos">3383</span></a>            <span class="s2">&quot;Pickups&quot;</span><span class="p">,</span>
</span><span id="main-3384"><a href="#main-3384"><span class="linenos">3384</span></a>            <span class="n">writer</span><span class="p">,</span>
</span><span id="main-3385"><a href="#main-3385"><span class="linenos">3385</span></a>            <span class="mi">2</span><span class="p">,</span>
</span><span id="main-3386"><a href="#main-3386"><span class="linenos">3386</span></a>        <span class="p">)</span>
</span><span id="main-3387"><a href="#main-3387"><span class="linenos">3387</span></a>        <span class="n">writer</span><span class="o">.</span><span class="n">sheets</span><span class="p">[</span><span class="s2">&quot;Pickups&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">conditional_format</span><span class="p">(</span>
</span><span id="main-3388"><a href="#main-3388"><span class="linenos">3388</span></a>            <span class="s2">&quot;J2:N&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">pickups</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="main-3389"><a href="#main-3389"><span class="linenos">3389</span></a>            <span class="p">{</span>
</span><span id="main-3390"><a href="#main-3390"><span class="linenos">3390</span></a>                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;3_color_scale&quot;</span><span class="p">,</span>
</span><span id="main-3391"><a href="#main-3391"><span class="linenos">3391</span></a>                <span class="s2">&quot;min_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FF6347&quot;</span><span class="p">,</span>
</span><span id="main-3392"><a href="#main-3392"><span class="linenos">3392</span></a>                <span class="s2">&quot;mid_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FFD700&quot;</span><span class="p">,</span>
</span><span id="main-3393"><a href="#main-3393"><span class="linenos">3393</span></a>                <span class="s2">&quot;max_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#3CB371&quot;</span><span class="p">,</span>
</span><span id="main-3394"><a href="#main-3394"><span class="linenos">3394</span></a>            <span class="p">},</span>
</span><span id="main-3395"><a href="#main-3395"><span class="linenos">3395</span></a>        <span class="p">)</span>
</span><span id="main-3396"><a href="#main-3396"><span class="linenos">3396</span></a>        <span class="n">writer</span><span class="o">.</span><span class="n">sheets</span><span class="p">[</span><span class="s2">&quot;Pickups&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">conditional_format</span><span class="p">(</span>
</span><span id="main-3397"><a href="#main-3397"><span class="linenos">3397</span></a>            <span class="s2">&quot;O2:O&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">pickups</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="main-3398"><a href="#main-3398"><span class="linenos">3398</span></a>            <span class="p">{</span>
</span><span id="main-3399"><a href="#main-3399"><span class="linenos">3399</span></a>                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;3_color_scale&quot;</span><span class="p">,</span>
</span><span id="main-3400"><a href="#main-3400"><span class="linenos">3400</span></a>                <span class="s2">&quot;min_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FF6347&quot;</span><span class="p">,</span>
</span><span id="main-3401"><a href="#main-3401"><span class="linenos">3401</span></a>                <span class="s2">&quot;mid_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FFD700&quot;</span><span class="p">,</span>
</span><span id="main-3402"><a href="#main-3402"><span class="linenos">3402</span></a>                <span class="s2">&quot;max_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#3CB371&quot;</span><span class="p">,</span>
</span><span id="main-3403"><a href="#main-3403"><span class="linenos">3403</span></a>            <span class="p">},</span>
</span><span id="main-3404"><a href="#main-3404"><span class="linenos">3404</span></a>        <span class="p">)</span>
</span><span id="main-3405"><a href="#main-3405"><span class="linenos">3405</span></a>        <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;The Algorithm&quot;</span><span class="p">:</span>
</span><span id="main-3406"><a href="#main-3406"><span class="linenos">3406</span></a>            <span class="n">writer</span><span class="o">.</span><span class="n">sheets</span><span class="p">[</span><span class="s2">&quot;Pickups&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">conditional_format</span><span class="p">(</span>
</span><span id="main-3407"><a href="#main-3407"><span class="linenos">3407</span></a>                <span class="s2">&quot;P2:P&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">pickups</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="main-3408"><a href="#main-3408"><span class="linenos">3408</span></a>                <span class="p">{</span>
</span><span id="main-3409"><a href="#main-3409"><span class="linenos">3409</span></a>                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;3_color_scale&quot;</span><span class="p">,</span>
</span><span id="main-3410"><a href="#main-3410"><span class="linenos">3410</span></a>                    <span class="s2">&quot;max_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FF6347&quot;</span><span class="p">,</span>
</span><span id="main-3411"><a href="#main-3411"><span class="linenos">3411</span></a>                    <span class="s2">&quot;mid_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FFD700&quot;</span><span class="p">,</span>
</span><span id="main-3412"><a href="#main-3412"><span class="linenos">3412</span></a>                    <span class="s2">&quot;min_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#3CB371&quot;</span><span class="p">,</span>
</span><span id="main-3413"><a href="#main-3413"><span class="linenos">3413</span></a>                <span class="p">},</span>
</span><span id="main-3414"><a href="#main-3414"><span class="linenos">3414</span></a>            <span class="p">)</span>
</span><span id="main-3415"><a href="#main-3415"><span class="linenos">3415</span></a>
</span><span id="main-3416"><a href="#main-3416"><span class="linenos">3416</span></a>    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">adds</span><span class="p">:</span>
</span><span id="main-3417"><a href="#main-3417"><span class="linenos">3417</span></a>        <span class="n">adds</span> <span class="o">=</span> <span class="n">league</span><span class="o">.</span><span class="n">possible_adds</span><span class="p">(</span>
</span><span id="main-3418"><a href="#main-3418"><span class="linenos">3418</span></a>            <span class="n">exclude</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Tom Brady&quot;</span><span class="p">],</span>
</span><span id="main-3419"><a href="#main-3419"><span class="linenos">3419</span></a>            <span class="n">limit_per</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
</span><span id="main-3420"><a href="#main-3420"><span class="linenos">3420</span></a>            <span class="n">payouts</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">payouts</span><span class="p">,</span>
</span><span id="main-3421"><a href="#main-3421"><span class="linenos">3421</span></a>            <span class="n">bestball</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">bestball</span><span class="p">,</span>
</span><span id="main-3422"><a href="#main-3422"><span class="linenos">3422</span></a>        <span class="p">)</span>
</span><span id="main-3423"><a href="#main-3423"><span class="linenos">3423</span></a>        <span class="n">writer</span> <span class="o">=</span> <span class="n">excelAutofit</span><span class="p">(</span>
</span><span id="main-3424"><a href="#main-3424"><span class="linenos">3424</span></a>            <span class="n">adds</span><span class="p">[</span>
</span><span id="main-3425"><a href="#main-3425"><span class="linenos">3425</span></a>                <span class="p">[</span>
</span><span id="main-3426"><a href="#main-3426"><span class="linenos">3426</span></a>                    <span class="s2">&quot;player_to_add&quot;</span><span class="p">,</span>
</span><span id="main-3427"><a href="#main-3427"><span class="linenos">3427</span></a>                    <span class="s2">&quot;wins_avg&quot;</span><span class="p">,</span>
</span><span id="main-3428"><a href="#main-3428"><span class="linenos">3428</span></a>                    <span class="s2">&quot;wins_stdev&quot;</span><span class="p">,</span>
</span><span id="main-3429"><a href="#main-3429"><span class="linenos">3429</span></a>                    <span class="s2">&quot;points_avg&quot;</span><span class="p">,</span>
</span><span id="main-3430"><a href="#main-3430"><span class="linenos">3430</span></a>                    <span class="s2">&quot;points_stdev&quot;</span><span class="p">,</span>
</span><span id="main-3431"><a href="#main-3431"><span class="linenos">3431</span></a>                    <span class="s2">&quot;per_game_avg&quot;</span><span class="p">,</span>
</span><span id="main-3432"><a href="#main-3432"><span class="linenos">3432</span></a>                    <span class="s2">&quot;per_game_stdev&quot;</span><span class="p">,</span>
</span><span id="main-3433"><a href="#main-3433"><span class="linenos">3433</span></a>                    <span class="s2">&quot;per_game_fano&quot;</span><span class="p">,</span>
</span><span id="main-3434"><a href="#main-3434"><span class="linenos">3434</span></a>                    <span class="s2">&quot;playoffs&quot;</span><span class="p">,</span>
</span><span id="main-3435"><a href="#main-3435"><span class="linenos">3435</span></a>                    <span class="s2">&quot;playoff_bye&quot;</span><span class="p">,</span>
</span><span id="main-3436"><a href="#main-3436"><span class="linenos">3436</span></a>                    <span class="s2">&quot;winner&quot;</span><span class="p">,</span>
</span><span id="main-3437"><a href="#main-3437"><span class="linenos">3437</span></a>                    <span class="s2">&quot;runner_up&quot;</span><span class="p">,</span>
</span><span id="main-3438"><a href="#main-3438"><span class="linenos">3438</span></a>                    <span class="s2">&quot;third&quot;</span><span class="p">,</span>
</span><span id="main-3439"><a href="#main-3439"><span class="linenos">3439</span></a>                    <span class="s2">&quot;earnings&quot;</span><span class="p">,</span>
</span><span id="main-3440"><a href="#main-3440"><span class="linenos">3440</span></a>                <span class="p">]</span>
</span><span id="main-3441"><a href="#main-3441"><span class="linenos">3441</span></a>                <span class="o">+</span> <span class="p">([</span><span class="s2">&quot;many_mile&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;The Algorithm&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">options</span><span class="o">.</span><span class="n">bestball</span> <span class="k">else</span> <span class="p">[])</span>
</span><span id="main-3442"><a href="#main-3442"><span class="linenos">3442</span></a>            <span class="p">],</span>
</span><span id="main-3443"><a href="#main-3443"><span class="linenos">3443</span></a>            <span class="s2">&quot;Adds&quot;</span><span class="p">,</span>
</span><span id="main-3444"><a href="#main-3444"><span class="linenos">3444</span></a>            <span class="n">writer</span><span class="p">,</span>
</span><span id="main-3445"><a href="#main-3445"><span class="linenos">3445</span></a>        <span class="p">)</span>
</span><span id="main-3446"><a href="#main-3446"><span class="linenos">3446</span></a>        <span class="n">writer</span><span class="o">.</span><span class="n">sheets</span><span class="p">[</span><span class="s2">&quot;Adds&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">conditional_format</span><span class="p">(</span>
</span><span id="main-3447"><a href="#main-3447"><span class="linenos">3447</span></a>            <span class="s2">&quot;J2:N&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">adds</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="main-3448"><a href="#main-3448"><span class="linenos">3448</span></a>            <span class="p">{</span>
</span><span id="main-3449"><a href="#main-3449"><span class="linenos">3449</span></a>                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;3_color_scale&quot;</span><span class="p">,</span>
</span><span id="main-3450"><a href="#main-3450"><span class="linenos">3450</span></a>                <span class="s2">&quot;min_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FF6347&quot;</span><span class="p">,</span>
</span><span id="main-3451"><a href="#main-3451"><span class="linenos">3451</span></a>                <span class="s2">&quot;mid_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FFD700&quot;</span><span class="p">,</span>
</span><span id="main-3452"><a href="#main-3452"><span class="linenos">3452</span></a>                <span class="s2">&quot;max_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#3CB371&quot;</span><span class="p">,</span>
</span><span id="main-3453"><a href="#main-3453"><span class="linenos">3453</span></a>            <span class="p">},</span>
</span><span id="main-3454"><a href="#main-3454"><span class="linenos">3454</span></a>        <span class="p">)</span>
</span><span id="main-3455"><a href="#main-3455"><span class="linenos">3455</span></a>        <span class="n">writer</span><span class="o">.</span><span class="n">sheets</span><span class="p">[</span><span class="s2">&quot;Adds&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">conditional_format</span><span class="p">(</span>
</span><span id="main-3456"><a href="#main-3456"><span class="linenos">3456</span></a>            <span class="s2">&quot;O2:O&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">adds</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="main-3457"><a href="#main-3457"><span class="linenos">3457</span></a>            <span class="p">{</span>
</span><span id="main-3458"><a href="#main-3458"><span class="linenos">3458</span></a>                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;3_color_scale&quot;</span><span class="p">,</span>
</span><span id="main-3459"><a href="#main-3459"><span class="linenos">3459</span></a>                <span class="s2">&quot;min_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FF6347&quot;</span><span class="p">,</span>
</span><span id="main-3460"><a href="#main-3460"><span class="linenos">3460</span></a>                <span class="s2">&quot;mid_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FFD700&quot;</span><span class="p">,</span>
</span><span id="main-3461"><a href="#main-3461"><span class="linenos">3461</span></a>                <span class="s2">&quot;max_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#3CB371&quot;</span><span class="p">,</span>
</span><span id="main-3462"><a href="#main-3462"><span class="linenos">3462</span></a>            <span class="p">},</span>
</span><span id="main-3463"><a href="#main-3463"><span class="linenos">3463</span></a>        <span class="p">)</span>
</span><span id="main-3464"><a href="#main-3464"><span class="linenos">3464</span></a>        <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;The Algorithm&quot;</span><span class="p">:</span>
</span><span id="main-3465"><a href="#main-3465"><span class="linenos">3465</span></a>            <span class="n">writer</span><span class="o">.</span><span class="n">sheets</span><span class="p">[</span><span class="s2">&quot;Adds&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">conditional_format</span><span class="p">(</span>
</span><span id="main-3466"><a href="#main-3466"><span class="linenos">3466</span></a>                <span class="s2">&quot;P2:P&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">adds</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="main-3467"><a href="#main-3467"><span class="linenos">3467</span></a>                <span class="p">{</span>
</span><span id="main-3468"><a href="#main-3468"><span class="linenos">3468</span></a>                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;3_color_scale&quot;</span><span class="p">,</span>
</span><span id="main-3469"><a href="#main-3469"><span class="linenos">3469</span></a>                    <span class="s2">&quot;max_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FF6347&quot;</span><span class="p">,</span>
</span><span id="main-3470"><a href="#main-3470"><span class="linenos">3470</span></a>                    <span class="s2">&quot;mid_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FFD700&quot;</span><span class="p">,</span>
</span><span id="main-3471"><a href="#main-3471"><span class="linenos">3471</span></a>                    <span class="s2">&quot;min_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#3CB371&quot;</span><span class="p">,</span>
</span><span id="main-3472"><a href="#main-3472"><span class="linenos">3472</span></a>                <span class="p">},</span>
</span><span id="main-3473"><a href="#main-3473"><span class="linenos">3473</span></a>            <span class="p">)</span>
</span><span id="main-3474"><a href="#main-3474"><span class="linenos">3474</span></a>
</span><span id="main-3475"><a href="#main-3475"><span class="linenos">3475</span></a>    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">drops</span><span class="p">:</span>
</span><span id="main-3476"><a href="#main-3476"><span class="linenos">3476</span></a>        <span class="n">drops</span> <span class="o">=</span> <span class="n">league</span><span class="o">.</span><span class="n">possible_drops</span><span class="p">(</span>
</span><span id="main-3477"><a href="#main-3477"><span class="linenos">3477</span></a>            <span class="n">payouts</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">payouts</span><span class="p">,</span>
</span><span id="main-3478"><a href="#main-3478"><span class="linenos">3478</span></a>            <span class="n">bestball</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">bestball</span><span class="p">,</span>
</span><span id="main-3479"><a href="#main-3479"><span class="linenos">3479</span></a>        <span class="p">)</span>
</span><span id="main-3480"><a href="#main-3480"><span class="linenos">3480</span></a>        <span class="n">writer</span> <span class="o">=</span> <span class="n">excelAutofit</span><span class="p">(</span>
</span><span id="main-3481"><a href="#main-3481"><span class="linenos">3481</span></a>            <span class="n">drops</span><span class="p">[</span>
</span><span id="main-3482"><a href="#main-3482"><span class="linenos">3482</span></a>                <span class="p">[</span>
</span><span id="main-3483"><a href="#main-3483"><span class="linenos">3483</span></a>                    <span class="s2">&quot;player_to_drop&quot;</span><span class="p">,</span>
</span><span id="main-3484"><a href="#main-3484"><span class="linenos">3484</span></a>                    <span class="s2">&quot;wins_avg&quot;</span><span class="p">,</span>
</span><span id="main-3485"><a href="#main-3485"><span class="linenos">3485</span></a>                    <span class="s2">&quot;wins_stdev&quot;</span><span class="p">,</span>
</span><span id="main-3486"><a href="#main-3486"><span class="linenos">3486</span></a>                    <span class="s2">&quot;points_avg&quot;</span><span class="p">,</span>
</span><span id="main-3487"><a href="#main-3487"><span class="linenos">3487</span></a>                    <span class="s2">&quot;points_stdev&quot;</span><span class="p">,</span>
</span><span id="main-3488"><a href="#main-3488"><span class="linenos">3488</span></a>                    <span class="s2">&quot;per_game_avg&quot;</span><span class="p">,</span>
</span><span id="main-3489"><a href="#main-3489"><span class="linenos">3489</span></a>                    <span class="s2">&quot;per_game_stdev&quot;</span><span class="p">,</span>
</span><span id="main-3490"><a href="#main-3490"><span class="linenos">3490</span></a>                    <span class="s2">&quot;per_game_fano&quot;</span><span class="p">,</span>
</span><span id="main-3491"><a href="#main-3491"><span class="linenos">3491</span></a>                    <span class="s2">&quot;playoffs&quot;</span><span class="p">,</span>
</span><span id="main-3492"><a href="#main-3492"><span class="linenos">3492</span></a>                    <span class="s2">&quot;playoff_bye&quot;</span><span class="p">,</span>
</span><span id="main-3493"><a href="#main-3493"><span class="linenos">3493</span></a>                    <span class="s2">&quot;winner&quot;</span><span class="p">,</span>
</span><span id="main-3494"><a href="#main-3494"><span class="linenos">3494</span></a>                    <span class="s2">&quot;runner_up&quot;</span><span class="p">,</span>
</span><span id="main-3495"><a href="#main-3495"><span class="linenos">3495</span></a>                    <span class="s2">&quot;third&quot;</span><span class="p">,</span>
</span><span id="main-3496"><a href="#main-3496"><span class="linenos">3496</span></a>                    <span class="s2">&quot;earnings&quot;</span><span class="p">,</span>
</span><span id="main-3497"><a href="#main-3497"><span class="linenos">3497</span></a>                <span class="p">]</span>
</span><span id="main-3498"><a href="#main-3498"><span class="linenos">3498</span></a>                <span class="o">+</span> <span class="p">([</span><span class="s2">&quot;many_mile&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;The Algorithm&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">options</span><span class="o">.</span><span class="n">bestball</span> <span class="k">else</span> <span class="p">[])</span>
</span><span id="main-3499"><a href="#main-3499"><span class="linenos">3499</span></a>            <span class="p">],</span>
</span><span id="main-3500"><a href="#main-3500"><span class="linenos">3500</span></a>            <span class="s2">&quot;Drops&quot;</span><span class="p">,</span>
</span><span id="main-3501"><a href="#main-3501"><span class="linenos">3501</span></a>            <span class="n">writer</span><span class="p">,</span>
</span><span id="main-3502"><a href="#main-3502"><span class="linenos">3502</span></a>        <span class="p">)</span>
</span><span id="main-3503"><a href="#main-3503"><span class="linenos">3503</span></a>        <span class="n">writer</span><span class="o">.</span><span class="n">sheets</span><span class="p">[</span><span class="s2">&quot;Drops&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">conditional_format</span><span class="p">(</span>
</span><span id="main-3504"><a href="#main-3504"><span class="linenos">3504</span></a>            <span class="s2">&quot;J2:N&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">drops</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="main-3505"><a href="#main-3505"><span class="linenos">3505</span></a>            <span class="p">{</span>
</span><span id="main-3506"><a href="#main-3506"><span class="linenos">3506</span></a>                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;3_color_scale&quot;</span><span class="p">,</span>
</span><span id="main-3507"><a href="#main-3507"><span class="linenos">3507</span></a>                <span class="s2">&quot;min_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FF6347&quot;</span><span class="p">,</span>
</span><span id="main-3508"><a href="#main-3508"><span class="linenos">3508</span></a>                <span class="s2">&quot;mid_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FFD700&quot;</span><span class="p">,</span>
</span><span id="main-3509"><a href="#main-3509"><span class="linenos">3509</span></a>                <span class="s2">&quot;max_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#3CB371&quot;</span><span class="p">,</span>
</span><span id="main-3510"><a href="#main-3510"><span class="linenos">3510</span></a>            <span class="p">},</span>
</span><span id="main-3511"><a href="#main-3511"><span class="linenos">3511</span></a>        <span class="p">)</span>
</span><span id="main-3512"><a href="#main-3512"><span class="linenos">3512</span></a>        <span class="n">writer</span><span class="o">.</span><span class="n">sheets</span><span class="p">[</span><span class="s2">&quot;Drops&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">conditional_format</span><span class="p">(</span>
</span><span id="main-3513"><a href="#main-3513"><span class="linenos">3513</span></a>            <span class="s2">&quot;O2:O&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">drops</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="main-3514"><a href="#main-3514"><span class="linenos">3514</span></a>            <span class="p">{</span>
</span><span id="main-3515"><a href="#main-3515"><span class="linenos">3515</span></a>                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;3_color_scale&quot;</span><span class="p">,</span>
</span><span id="main-3516"><a href="#main-3516"><span class="linenos">3516</span></a>                <span class="s2">&quot;min_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FF6347&quot;</span><span class="p">,</span>
</span><span id="main-3517"><a href="#main-3517"><span class="linenos">3517</span></a>                <span class="s2">&quot;mid_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FFD700&quot;</span><span class="p">,</span>
</span><span id="main-3518"><a href="#main-3518"><span class="linenos">3518</span></a>                <span class="s2">&quot;max_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#3CB371&quot;</span><span class="p">,</span>
</span><span id="main-3519"><a href="#main-3519"><span class="linenos">3519</span></a>            <span class="p">},</span>
</span><span id="main-3520"><a href="#main-3520"><span class="linenos">3520</span></a>        <span class="p">)</span>
</span><span id="main-3521"><a href="#main-3521"><span class="linenos">3521</span></a>        <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;The Algorithm&quot;</span><span class="p">:</span>
</span><span id="main-3522"><a href="#main-3522"><span class="linenos">3522</span></a>            <span class="n">writer</span><span class="o">.</span><span class="n">sheets</span><span class="p">[</span><span class="s2">&quot;Drops&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">conditional_format</span><span class="p">(</span>
</span><span id="main-3523"><a href="#main-3523"><span class="linenos">3523</span></a>                <span class="s2">&quot;P2:P&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">drops</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="main-3524"><a href="#main-3524"><span class="linenos">3524</span></a>                <span class="p">{</span>
</span><span id="main-3525"><a href="#main-3525"><span class="linenos">3525</span></a>                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;3_color_scale&quot;</span><span class="p">,</span>
</span><span id="main-3526"><a href="#main-3526"><span class="linenos">3526</span></a>                    <span class="s2">&quot;max_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FF6347&quot;</span><span class="p">,</span>
</span><span id="main-3527"><a href="#main-3527"><span class="linenos">3527</span></a>                    <span class="s2">&quot;mid_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FFD700&quot;</span><span class="p">,</span>
</span><span id="main-3528"><a href="#main-3528"><span class="linenos">3528</span></a>                    <span class="s2">&quot;min_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#3CB371&quot;</span><span class="p">,</span>
</span><span id="main-3529"><a href="#main-3529"><span class="linenos">3529</span></a>                <span class="p">},</span>
</span><span id="main-3530"><a href="#main-3530"><span class="linenos">3530</span></a>            <span class="p">)</span>
</span><span id="main-3531"><a href="#main-3531"><span class="linenos">3531</span></a>
</span><span id="main-3532"><a href="#main-3532"><span class="linenos">3532</span></a>    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">trades</span> <span class="ow">or</span> <span class="n">options</span><span class="o">.</span><span class="n">given</span><span class="p">:</span>
</span><span id="main-3533"><a href="#main-3533"><span class="linenos">3533</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">options</span><span class="o">.</span><span class="n">trades</span><span class="p">:</span>
</span><span id="main-3534"><a href="#main-3534"><span class="linenos">3534</span></a>            <span class="n">options</span><span class="o">.</span><span class="n">trades</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span>
</span><span id="main-3535"><a href="#main-3535"><span class="linenos">3535</span></a>        <span class="n">trades</span> <span class="o">=</span> <span class="n">league</span><span class="o">.</span><span class="n">possible_trades</span><span class="p">(</span>
</span><span id="main-3536"><a href="#main-3536"><span class="linenos">3536</span></a>            <span class="n">focus_on</span><span class="o">=</span><span class="p">[</span><span class="n">val</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">trades</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)]</span>
</span><span id="main-3537"><a href="#main-3537"><span class="linenos">3537</span></a>            <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">trades</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;all&quot;</span>
</span><span id="main-3538"><a href="#main-3538"><span class="linenos">3538</span></a>            <span class="k">else</span> <span class="p">[],</span>
</span><span id="main-3539"><a href="#main-3539"><span class="linenos">3539</span></a>            <span class="n">exclude</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Tom Brady&quot;</span><span class="p">],</span>
</span><span id="main-3540"><a href="#main-3540"><span class="linenos">3540</span></a>            <span class="n">given</span><span class="o">=</span><span class="p">[</span><span class="n">val</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">given</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)]</span> <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">given</span> <span class="k">else</span> <span class="p">[],</span>
</span><span id="main-3541"><a href="#main-3541"><span class="linenos">3541</span></a>            <span class="n">limit_per</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
</span><span id="main-3542"><a href="#main-3542"><span class="linenos">3542</span></a>            <span class="n">payouts</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">payouts</span><span class="p">,</span>
</span><span id="main-3543"><a href="#main-3543"><span class="linenos">3543</span></a>            <span class="n">bestball</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">bestball</span><span class="p">,</span>
</span><span id="main-3544"><a href="#main-3544"><span class="linenos">3544</span></a>        <span class="p">)</span>
</span><span id="main-3545"><a href="#main-3545"><span class="linenos">3545</span></a>        <span class="n">writer</span> <span class="o">=</span> <span class="n">excelAutofit</span><span class="p">(</span>
</span><span id="main-3546"><a href="#main-3546"><span class="linenos">3546</span></a>            <span class="n">trades</span><span class="p">[</span>
</span><span id="main-3547"><a href="#main-3547"><span class="linenos">3547</span></a>                <span class="p">[</span>
</span><span id="main-3548"><a href="#main-3548"><span class="linenos">3548</span></a>                    <span class="s2">&quot;player_to_trade_away&quot;</span><span class="p">,</span>
</span><span id="main-3549"><a href="#main-3549"><span class="linenos">3549</span></a>                    <span class="s2">&quot;player_to_trade_for&quot;</span><span class="p">,</span>
</span><span id="main-3550"><a href="#main-3550"><span class="linenos">3550</span></a>                    <span class="s2">&quot;their_team&quot;</span><span class="p">,</span>
</span><span id="main-3551"><a href="#main-3551"><span class="linenos">3551</span></a>                    <span class="s2">&quot;my_wins_avg&quot;</span><span class="p">,</span>
</span><span id="main-3552"><a href="#main-3552"><span class="linenos">3552</span></a>                    <span class="s2">&quot;my_wins_stdev&quot;</span><span class="p">,</span>
</span><span id="main-3553"><a href="#main-3553"><span class="linenos">3553</span></a>                    <span class="s2">&quot;my_points_avg&quot;</span><span class="p">,</span>
</span><span id="main-3554"><a href="#main-3554"><span class="linenos">3554</span></a>                    <span class="s2">&quot;my_points_stdev&quot;</span><span class="p">,</span>
</span><span id="main-3555"><a href="#main-3555"><span class="linenos">3555</span></a>                    <span class="s2">&quot;my_per_game_avg&quot;</span><span class="p">,</span>
</span><span id="main-3556"><a href="#main-3556"><span class="linenos">3556</span></a>                    <span class="s2">&quot;my_per_game_stdev&quot;</span><span class="p">,</span>
</span><span id="main-3557"><a href="#main-3557"><span class="linenos">3557</span></a>                    <span class="s2">&quot;my_per_game_fano&quot;</span><span class="p">,</span>
</span><span id="main-3558"><a href="#main-3558"><span class="linenos">3558</span></a>                    <span class="s2">&quot;my_playoffs&quot;</span><span class="p">,</span>
</span><span id="main-3559"><a href="#main-3559"><span class="linenos">3559</span></a>                    <span class="s2">&quot;my_playoff_bye&quot;</span><span class="p">,</span>
</span><span id="main-3560"><a href="#main-3560"><span class="linenos">3560</span></a>                    <span class="s2">&quot;my_winner&quot;</span><span class="p">,</span>
</span><span id="main-3561"><a href="#main-3561"><span class="linenos">3561</span></a>                    <span class="s2">&quot;my_runner_up&quot;</span><span class="p">,</span>
</span><span id="main-3562"><a href="#main-3562"><span class="linenos">3562</span></a>                    <span class="s2">&quot;my_third&quot;</span><span class="p">,</span>
</span><span id="main-3563"><a href="#main-3563"><span class="linenos">3563</span></a>                    <span class="s2">&quot;my_earnings&quot;</span><span class="p">,</span>
</span><span id="main-3564"><a href="#main-3564"><span class="linenos">3564</span></a>                    <span class="s2">&quot;their_wins_avg&quot;</span><span class="p">,</span>
</span><span id="main-3565"><a href="#main-3565"><span class="linenos">3565</span></a>                    <span class="s2">&quot;their_wins_stdev&quot;</span><span class="p">,</span>
</span><span id="main-3566"><a href="#main-3566"><span class="linenos">3566</span></a>                    <span class="s2">&quot;their_points_avg&quot;</span><span class="p">,</span>
</span><span id="main-3567"><a href="#main-3567"><span class="linenos">3567</span></a>                    <span class="s2">&quot;their_points_stdev&quot;</span><span class="p">,</span>
</span><span id="main-3568"><a href="#main-3568"><span class="linenos">3568</span></a>                    <span class="s2">&quot;their_per_game_avg&quot;</span><span class="p">,</span>
</span><span id="main-3569"><a href="#main-3569"><span class="linenos">3569</span></a>                    <span class="s2">&quot;their_per_game_stdev&quot;</span><span class="p">,</span>
</span><span id="main-3570"><a href="#main-3570"><span class="linenos">3570</span></a>                    <span class="s2">&quot;their_per_game_fano&quot;</span><span class="p">,</span>
</span><span id="main-3571"><a href="#main-3571"><span class="linenos">3571</span></a>                    <span class="s2">&quot;their_playoffs&quot;</span><span class="p">,</span>
</span><span id="main-3572"><a href="#main-3572"><span class="linenos">3572</span></a>                    <span class="s2">&quot;their_playoff_bye&quot;</span><span class="p">,</span>
</span><span id="main-3573"><a href="#main-3573"><span class="linenos">3573</span></a>                    <span class="s2">&quot;their_winner&quot;</span><span class="p">,</span>
</span><span id="main-3574"><a href="#main-3574"><span class="linenos">3574</span></a>                    <span class="s2">&quot;their_runner_up&quot;</span><span class="p">,</span>
</span><span id="main-3575"><a href="#main-3575"><span class="linenos">3575</span></a>                    <span class="s2">&quot;their_third&quot;</span><span class="p">,</span>
</span><span id="main-3576"><a href="#main-3576"><span class="linenos">3576</span></a>                    <span class="s2">&quot;their_earnings&quot;</span><span class="p">,</span>
</span><span id="main-3577"><a href="#main-3577"><span class="linenos">3577</span></a>                <span class="p">]</span>
</span><span id="main-3578"><a href="#main-3578"><span class="linenos">3578</span></a>            <span class="p">],</span>
</span><span id="main-3579"><a href="#main-3579"><span class="linenos">3579</span></a>            <span class="s2">&quot;Trades&quot;</span><span class="p">,</span>
</span><span id="main-3580"><a href="#main-3580"><span class="linenos">3580</span></a>            <span class="n">writer</span><span class="p">,</span>
</span><span id="main-3581"><a href="#main-3581"><span class="linenos">3581</span></a>            <span class="mi">3</span><span class="p">,</span>
</span><span id="main-3582"><a href="#main-3582"><span class="linenos">3582</span></a>        <span class="p">)</span>
</span><span id="main-3583"><a href="#main-3583"><span class="linenos">3583</span></a>        <span class="n">writer</span><span class="o">.</span><span class="n">sheets</span><span class="p">[</span><span class="s2">&quot;Trades&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">conditional_format</span><span class="p">(</span>
</span><span id="main-3584"><a href="#main-3584"><span class="linenos">3584</span></a>            <span class="s2">&quot;K2:O&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">trades</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="main-3585"><a href="#main-3585"><span class="linenos">3585</span></a>            <span class="p">{</span>
</span><span id="main-3586"><a href="#main-3586"><span class="linenos">3586</span></a>                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;3_color_scale&quot;</span><span class="p">,</span>
</span><span id="main-3587"><a href="#main-3587"><span class="linenos">3587</span></a>                <span class="s2">&quot;min_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FF6347&quot;</span><span class="p">,</span>
</span><span id="main-3588"><a href="#main-3588"><span class="linenos">3588</span></a>                <span class="s2">&quot;mid_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FFD700&quot;</span><span class="p">,</span>
</span><span id="main-3589"><a href="#main-3589"><span class="linenos">3589</span></a>                <span class="s2">&quot;max_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#3CB371&quot;</span><span class="p">,</span>
</span><span id="main-3590"><a href="#main-3590"><span class="linenos">3590</span></a>            <span class="p">},</span>
</span><span id="main-3591"><a href="#main-3591"><span class="linenos">3591</span></a>        <span class="p">)</span>
</span><span id="main-3592"><a href="#main-3592"><span class="linenos">3592</span></a>        <span class="n">writer</span><span class="o">.</span><span class="n">sheets</span><span class="p">[</span><span class="s2">&quot;Trades&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">conditional_format</span><span class="p">(</span>
</span><span id="main-3593"><a href="#main-3593"><span class="linenos">3593</span></a>            <span class="s2">&quot;P2:P&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">trades</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="main-3594"><a href="#main-3594"><span class="linenos">3594</span></a>            <span class="p">{</span>
</span><span id="main-3595"><a href="#main-3595"><span class="linenos">3595</span></a>                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;3_color_scale&quot;</span><span class="p">,</span>
</span><span id="main-3596"><a href="#main-3596"><span class="linenos">3596</span></a>                <span class="s2">&quot;min_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FF6347&quot;</span><span class="p">,</span>
</span><span id="main-3597"><a href="#main-3597"><span class="linenos">3597</span></a>                <span class="s2">&quot;mid_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FFD700&quot;</span><span class="p">,</span>
</span><span id="main-3598"><a href="#main-3598"><span class="linenos">3598</span></a>                <span class="s2">&quot;max_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#3CB371&quot;</span><span class="p">,</span>
</span><span id="main-3599"><a href="#main-3599"><span class="linenos">3599</span></a>            <span class="p">},</span>
</span><span id="main-3600"><a href="#main-3600"><span class="linenos">3600</span></a>        <span class="p">)</span>
</span><span id="main-3601"><a href="#main-3601"><span class="linenos">3601</span></a>        <span class="n">writer</span><span class="o">.</span><span class="n">sheets</span><span class="p">[</span><span class="s2">&quot;Trades&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">conditional_format</span><span class="p">(</span>
</span><span id="main-3602"><a href="#main-3602"><span class="linenos">3602</span></a>            <span class="s2">&quot;X2:AB&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">trades</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="main-3603"><a href="#main-3603"><span class="linenos">3603</span></a>            <span class="p">{</span>
</span><span id="main-3604"><a href="#main-3604"><span class="linenos">3604</span></a>                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;3_color_scale&quot;</span><span class="p">,</span>
</span><span id="main-3605"><a href="#main-3605"><span class="linenos">3605</span></a>                <span class="s2">&quot;min_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FF6347&quot;</span><span class="p">,</span>
</span><span id="main-3606"><a href="#main-3606"><span class="linenos">3606</span></a>                <span class="s2">&quot;mid_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FFD700&quot;</span><span class="p">,</span>
</span><span id="main-3607"><a href="#main-3607"><span class="linenos">3607</span></a>                <span class="s2">&quot;max_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#3CB371&quot;</span><span class="p">,</span>
</span><span id="main-3608"><a href="#main-3608"><span class="linenos">3608</span></a>            <span class="p">},</span>
</span><span id="main-3609"><a href="#main-3609"><span class="linenos">3609</span></a>        <span class="p">)</span>
</span><span id="main-3610"><a href="#main-3610"><span class="linenos">3610</span></a>        <span class="n">writer</span><span class="o">.</span><span class="n">sheets</span><span class="p">[</span><span class="s2">&quot;Trades&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">conditional_format</span><span class="p">(</span>
</span><span id="main-3611"><a href="#main-3611"><span class="linenos">3611</span></a>            <span class="s2">&quot;AC2:AC&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">trades</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="main-3612"><a href="#main-3612"><span class="linenos">3612</span></a>            <span class="p">{</span>
</span><span id="main-3613"><a href="#main-3613"><span class="linenos">3613</span></a>                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;3_color_scale&quot;</span><span class="p">,</span>
</span><span id="main-3614"><a href="#main-3614"><span class="linenos">3614</span></a>                <span class="s2">&quot;min_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FF6347&quot;</span><span class="p">,</span>
</span><span id="main-3615"><a href="#main-3615"><span class="linenos">3615</span></a>                <span class="s2">&quot;mid_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FFD700&quot;</span><span class="p">,</span>
</span><span id="main-3616"><a href="#main-3616"><span class="linenos">3616</span></a>                <span class="s2">&quot;max_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#3CB371&quot;</span><span class="p">,</span>
</span><span id="main-3617"><a href="#main-3617"><span class="linenos">3617</span></a>            <span class="p">},</span>
</span><span id="main-3618"><a href="#main-3618"><span class="linenos">3618</span></a>        <span class="p">)</span>
</span><span id="main-3619"><a href="#main-3619"><span class="linenos">3619</span></a>
</span><span id="main-3620"><a href="#main-3620"><span class="linenos">3620</span></a>    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">deltas</span><span class="p">:</span>
</span><span id="main-3621"><a href="#main-3621"><span class="linenos">3621</span></a>        <span class="n">deltas</span> <span class="o">=</span> <span class="n">league</span><span class="o">.</span><span class="n">perGameDelta</span><span class="p">(</span><span class="n">payouts</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">payouts</span><span class="p">)</span>
</span><span id="main-3622"><a href="#main-3622"><span class="linenos">3622</span></a>        <span class="n">writer</span> <span class="o">=</span> <span class="n">excelAutofit</span><span class="p">(</span><span class="n">deltas</span><span class="p">,</span> <span class="s2">&quot;Deltas&quot;</span><span class="p">,</span> <span class="n">writer</span><span class="p">)</span>
</span><span id="main-3623"><a href="#main-3623"><span class="linenos">3623</span></a>        <span class="n">writer</span><span class="o">.</span><span class="n">sheets</span><span class="p">[</span><span class="s2">&quot;Deltas&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">conditional_format</span><span class="p">(</span>
</span><span id="main-3624"><a href="#main-3624"><span class="linenos">3624</span></a>            <span class="s2">&quot;B2:&quot;</span> <span class="o">+</span> <span class="nb">chr</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">deltas</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">deltas</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="main-3625"><a href="#main-3625"><span class="linenos">3625</span></a>            <span class="p">{</span>
</span><span id="main-3626"><a href="#main-3626"><span class="linenos">3626</span></a>                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;3_color_scale&quot;</span><span class="p">,</span>
</span><span id="main-3627"><a href="#main-3627"><span class="linenos">3627</span></a>                <span class="s2">&quot;min_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FF6347&quot;</span><span class="p">,</span>
</span><span id="main-3628"><a href="#main-3628"><span class="linenos">3628</span></a>                <span class="s2">&quot;mid_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FFD700&quot;</span><span class="p">,</span>
</span><span id="main-3629"><a href="#main-3629"><span class="linenos">3629</span></a>                <span class="s2">&quot;max_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#3CB371&quot;</span><span class="p">,</span>
</span><span id="main-3630"><a href="#main-3630"><span class="linenos">3630</span></a>            <span class="p">},</span>
</span><span id="main-3631"><a href="#main-3631"><span class="linenos">3631</span></a>        <span class="p">)</span>
</span><span id="main-3632"><a href="#main-3632"><span class="linenos">3632</span></a>
</span><span id="main-3633"><a href="#main-3633"><span class="linenos">3633</span></a>    <span class="n">writer</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="main-3634"><a href="#main-3634"><span class="linenos">3634</span></a>    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span>
</span><span id="main-3635"><a href="#main-3635"><span class="linenos">3635</span></a>        <span class="s1">&#39;touch -t </span><span class="si">{}</span><span class="s1"> &quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="main-3636"><a href="#main-3636"><span class="linenos">3636</span></a>            <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">%H%M&quot;</span><span class="p">),</span>
</span><span id="main-3637"><a href="#main-3637"><span class="linenos">3637</span></a>            <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]),</span>
</span><span id="main-3638"><a href="#main-3638"><span class="linenos">3638</span></a>        <span class="p">)</span>
</span><span id="main-3639"><a href="#main-3639"><span class="linenos">3639</span></a>    <span class="p">)</span>
</span><span id="main-3640"><a href="#main-3640"><span class="linenos">3640</span></a>    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">email</span><span class="p">:</span>
</span><span id="main-3641"><a href="#main-3641"><span class="linenos">3641</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="main-3642"><a href="#main-3642"><span class="linenos">3642</span></a>            <span class="n">sendEmail</span><span class="p">(</span>
</span><span id="main-3643"><a href="#main-3643"><span class="linenos">3643</span></a>                <span class="s2">&quot;Fantasy Football Projections for &quot;</span> <span class="o">+</span> <span class="n">options</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span id="main-3644"><a href="#main-3644"><span class="linenos">3644</span></a>                <span class="s2">&quot;Best of luck to you this fantasy football season!!!&quot;</span><span class="p">,</span>
</span><span id="main-3645"><a href="#main-3645"><span class="linenos">3645</span></a>                <span class="n">options</span><span class="o">.</span><span class="n">email</span><span class="p">,</span>
</span><span id="main-3646"><a href="#main-3646"><span class="linenos">3646</span></a>                <span class="n">options</span><span class="o">.</span><span class="n">output</span>
</span><span id="main-3647"><a href="#main-3647"><span class="linenos">3647</span></a>                <span class="o">+</span> <span class="s2">&quot;FantasyFootballProjections_</span><span class="si">{}</span><span class="s2">Week</span><span class="si">{}</span><span class="s2">.xlsx&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="main-3648"><a href="#main-3648"><span class="linenos">3648</span></a>                    <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%A&quot;</span><span class="p">),</span> <span class="n">league</span><span class="o">.</span><span class="n">week</span>
</span><span id="main-3649"><a href="#main-3649"><span class="linenos">3649</span></a>                <span class="p">),</span>
</span><span id="main-3650"><a href="#main-3650"><span class="linenos">3650</span></a>            <span class="p">)</span>
</span><span id="main-3651"><a href="#main-3651"><span class="linenos">3651</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="main-3652"><a href="#main-3652"><span class="linenos">3652</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="main-3653"><a href="#main-3653"><span class="linenos">3653</span></a>                <span class="s2">&quot;Couldn&#39;t email results, maybe no wifi...</span><span class="se">\n</span><span class="s2">Results saved to &quot;</span>
</span><span id="main-3654"><a href="#main-3654"><span class="linenos">3654</span></a>                <span class="o">+</span> <span class="n">options</span><span class="o">.</span><span class="n">output</span>
</span><span id="main-3655"><a href="#main-3655"><span class="linenos">3655</span></a>                <span class="o">+</span> <span class="s2">&quot;FantasyFootballProjections_</span><span class="si">{}</span><span class="s2">Week</span><span class="si">{}</span><span class="s2">.xlsx&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="main-3656"><a href="#main-3656"><span class="linenos">3656</span></a>                    <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%A&quot;</span><span class="p">),</span> <span class="n">league</span><span class="o">.</span><span class="n">week</span>
</span><span id="main-3657"><a href="#main-3657"><span class="linenos">3657</span></a>                <span class="p">)</span>
</span><span id="main-3658"><a href="#main-3658"><span class="linenos">3658</span></a>            <span class="p">)</span>
</span></pre></div>


    

                </section>
    </main>
<script>
    /* Periodically check with the pdoc server if there have been any changes. */
    let mtime_generated = "1699945607.4",
        url = new URL(window.location);
    url.searchParams.set("mtime", 1);
    window.setInterval(function () {
        fetch(url.toString())
            .then(response => response.text())
            .then(mtime => {
                if (mtime_generated !== mtime)
                    location.reload();
            });
    }, 1000);
</script></body>
</html>