<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 14.1.0"/>
    <title>sportsref_nfl documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>




            <h2>Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="variable" href="#base_url">base_url</a>
            </li>
            <li>
                    <a class="function" href="#get_page">get_page</a>
            </li>
            <li>
                    <a class="function" href="#parse_table">parse_table</a>
            </li>
            <li>
                    <a class="function" href="#get_intl_games">get_intl_games</a>
            </li>
            <li>
                    <a class="function" href="#get_depth_chart">get_depth_chart</a>
            </li>
            <li>
                    <a class="function" href="#get_all_depth_charts">get_all_depth_charts</a>
            </li>
            <li>
                    <a class="function" href="#get_stadiums">get_stadiums</a>
            </li>
            <li>
                    <a class="function" href="#get_team_stadium">get_team_stadium</a>
            </li>
            <li>
                    <a class="function" href="#get_game_stadium">get_game_stadium</a>
            </li>
            <li>
                    <a class="function" href="#get_address">get_address</a>
            </li>
            <li>
                    <a class="function" href="#download_zip_codes">download_zip_codes</a>
            </li>
            <li>
                    <a class="function" href="#get_coordinates">get_coordinates</a>
            </li>
            <li>
                    <a class="class" href="#Schedule">Schedule</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Schedule.__init__">Schedule</a>
                        </li>
                        <li>
                                <a class="function" href="#Schedule.get_schedules">get_schedules</a>
                        </li>
                        <li>
                                <a class="function" href="#Schedule.add_weeks">add_weeks</a>
                        </li>
                        <li>
                                <a class="function" href="#Schedule.convert_to_home_away">convert_to_home_away</a>
                        </li>
                        <li>
                                <a class="function" href="#Schedule.mark_intl_games">mark_intl_games</a>
                        </li>
                        <li>
                                <a class="function" href="#Schedule.add_team_coords">add_team_coords</a>
                        </li>
                        <li>
                                <a class="function" href="#Schedule.add_game_coords">add_game_coords</a>
                        </li>
                        <li>
                                <a class="function" href="#Schedule.add_travel">add_travel</a>
                        </li>
                        <li>
                                <a class="function" href="#Schedule.add_rest">add_rest</a>
                        </li>
                        <li>
                                <a class="function" href="#Schedule.add_elo_columns">add_elo_columns</a>
                        </li>
                        <li>
                                <a class="function" href="#Schedule.next_init_elo">next_init_elo</a>
                        </li>
                        <li>
                                <a class="function" href="#Schedule.next_elo_prob">next_elo_prob</a>
                        </li>
                        <li>
                                <a class="function" href="#Schedule.next_elo_delta">next_elo_delta</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Boxscore">Boxscore</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Boxscore.__init__">Boxscore</a>
                        </li>
                        <li>
                                <a class="variable" href="#Boxscore.game_id">game_id</a>
                        </li>
                        <li>
                                <a class="function" href="#Boxscore.get_raw_text">get_raw_text</a>
                        </li>
                        <li>
                                <a class="function" href="#Boxscore.get_details">get_details</a>
                        </li>
                        <li>
                                <a class="function" href="#Boxscore.get_stats">get_stats</a>
                        </li>
                        <li>
                                <a class="function" href="#Boxscore.get_advanced_stats">get_advanced_stats</a>
                        </li>
                        <li>
                                <a class="function" href="#Boxscore.get_starters">get_starters</a>
                        </li>
                        <li>
                                <a class="function" href="#Boxscore.get_snap_counts">get_snap_counts</a>
                        </li>
                        <li>
                                <a class="function" href="#Boxscore.add_depth_chart">add_depth_chart</a>
                        </li>
                        <li>
                                <a class="function" href="#Boxscore.add_qb_value">add_qb_value</a>
                        </li>
                        <li>
                                <a class="function" href="#Boxscore.normalize_team_names">normalize_team_names</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="function" href="#get_bulk_stats">get_bulk_stats</a>
            </li>
            <li>
                    <a class="function" href="#get_draft">get_draft</a>
            </li>
            <li>
                    <a class="function" href="#get_bulk_draft_pos">get_bulk_draft_pos</a>
            </li>
            <li>
                    <a class="function" href="#get_roster">get_roster</a>
            </li>
            <li>
                    <a class="function" href="#get_bulk_rosters">get_bulk_rosters</a>
            </li>
            <li>
                    <a class="function" href="#get_qb_elos">get_qb_elos</a>
            </li>
            <li>
                    <a class="function" href="#get_names">get_names</a>
            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
sportsref_nfl    </h1>

                        <div class="docstring"><p>@File    :   sportsref_nfl.py<br>
@Time    :   2023/04/12 21:49:12<br>
@Author  :   Taylor Firman<br>
@Version :   1.0<br>
@Contact :   tefirman@gmail.com<br>
@Desc    :   Collection of functions to easily pull down statistics from pro-football-reference.com</p>
</div>

                        <input id="mod-sportsref_nfl-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-sportsref_nfl-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">   1</span></a><span class="ch">#!/usr/bin/env python</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">   2</span></a><span class="c1"># -*-coding:utf-8 -*-</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">   3</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">   4</span></a><span class="sd">@File    :   sportsref_nfl.py</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">   5</span></a><span class="sd">@Time    :   2023/04/12 21:49:12</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">   6</span></a><span class="sd">@Author  :   Taylor Firman</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">   7</span></a><span class="sd">@Version :   1.0</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">   8</span></a><span class="sd">@Contact :   tefirman@gmail.com</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">   9</span></a><span class="sd">@Desc    :   Collection of functions to easily pull down statistics from pro-football-reference.com</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">  10</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">  11</span></a>
</span><span id="L-12"><a href="#L-12"><span class="linenos">  12</span></a><span class="kn">import</span> <span class="nn">requests</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos">  13</span></a><span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos">  14</span></a><span class="kn">import</span> <span class="nn">time</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos">  15</span></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos">  16</span></a><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos">  17</span></a><span class="kn">import</span> <span class="nn">os</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos">  18</span></a><span class="kn">import</span> <span class="nn">datetime</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos">  19</span></a><span class="kn">from</span> <span class="nn">geopy.distance</span> <span class="kn">import</span> <span class="n">geodesic</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos">  20</span></a><span class="kn">import</span> <span class="nn">shutil</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos">  21</span></a><span class="kn">import</span> <span class="nn">gzip</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos">  22</span></a><span class="kn">import</span> <span class="nn">sys</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos">  23</span></a>
</span><span id="L-24"><a href="#L-24"><span class="linenos">  24</span></a><span class="n">base_url</span> <span class="o">=</span> <span class="s2">&quot;https://www.pro-football-reference.com/&quot;</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos">  25</span></a>
</span><span id="L-26"><a href="#L-26"><span class="linenos">  26</span></a>
</span><span id="L-27"><a href="#L-27"><span class="linenos">  27</span></a><span class="k">def</span> <span class="nf">get_page</span><span class="p">(</span><span class="n">endpoint</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos">  28</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos">  29</span></a><span class="sd">    Pulls down the raw html for the specified endpoint of Pro Football Reference</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos">  30</span></a><span class="sd">    and adds an additional four second delay to avoid triggering the 1hr jailtime</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos">  31</span></a><span class="sd">    for exceeding 20 requests per minute.</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos">  32</span></a>
</span><span id="L-33"><a href="#L-33"><span class="linenos">  33</span></a><span class="sd">    Args:</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos">  34</span></a><span class="sd">        endpoint (str): relative location of the page to pull down.</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos">  35</span></a>
</span><span id="L-36"><a href="#L-36"><span class="linenos">  36</span></a><span class="sd">    Returns:</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos">  37</span></a><span class="sd">        bs4.BeautifulSoup: parsed html of the specified endpoint.</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos">  38</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos">  39</span></a>    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos">  40</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos">  41</span></a>        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">base_url</span> <span class="o">+</span> <span class="n">endpoint</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos">  42</span></a>    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ConnectionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos">  43</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;GETTING CONNECTION ERROR AGAIN!!!&#39;</span><span class="p">)</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos">  44</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">endpoint</span><span class="p">)</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos">  45</span></a>        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos">  46</span></a>    <span class="n">uncommented</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;!--&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;--&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos">  47</span></a>    <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">uncommented</span><span class="p">,</span> <span class="s2">&quot;html.parser&quot;</span><span class="p">)</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos">  48</span></a>    <span class="k">return</span> <span class="n">soup</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos">  49</span></a>
</span><span id="L-50"><a href="#L-50"><span class="linenos">  50</span></a>
</span><span id="L-51"><a href="#L-51"><span class="linenos">  51</span></a><span class="k">def</span> <span class="nf">parse_table</span><span class="p">(</span><span class="n">raw_text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos">  52</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos">  53</span></a><span class="sd">    Parses out the desired table from the raw html text into a pandas dataframe.</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos">  54</span></a>
</span><span id="L-55"><a href="#L-55"><span class="linenos">  55</span></a><span class="sd">    Args:</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos">  56</span></a><span class="sd">        raw_text (bs4.BeautifulSoup): raw html from the page of interest.</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos">  57</span></a><span class="sd">        table_name (str): title of the table to extract.</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos">  58</span></a>
</span><span id="L-59"><a href="#L-59"><span class="linenos">  59</span></a><span class="sd">    Returns:</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos">  60</span></a><span class="sd">        pd.DataFrame: dataframe containing the data from the specified table.</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos">  61</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos">  62</span></a>    <span class="n">players</span> <span class="o">=</span> <span class="n">raw_text</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">table_name</span><span class="p">)</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s2">&quot;tr&quot;</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">})</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos">  63</span></a>    <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;data-stat&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">players</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s2">&quot;th&quot;</span><span class="p">)]</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos">  64</span></a>    <span class="n">stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos">  65</span></a>    <span class="k">for</span> <span class="n">player</span> <span class="ow">in</span> <span class="n">players</span><span class="p">:</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos">  66</span></a>        <span class="k">if</span> <span class="n">player</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="s2">&quot;Playoffs&quot;</span><span class="p">:</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos">  67</span></a>            <span class="k">continue</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos">  68</span></a>        <span class="n">entry</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos">  69</span></a>        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">:</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos">  70</span></a>            <span class="n">entry</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">player</span><span class="o">.</span><span class="n">find</span><span class="p">([</span><span class="s2">&quot;th&quot;</span><span class="p">,</span> <span class="s2">&quot;td&quot;</span><span class="p">],</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;data-stat&quot;</span><span class="p">:</span> <span class="n">col</span><span class="p">})</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos">  71</span></a>            <span class="k">if</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;boxscore_word&quot;</span><span class="p">,</span> <span class="s2">&quot;stadium_name&quot;</span><span class="p">]:</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos">  72</span></a>                <span class="n">abbrev</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">)</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos">  73</span></a>                <span class="k">if</span> <span class="n">abbrev</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos">  74</span></a>                    <span class="n">new_col</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_abbrev&quot;</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos">  75</span></a>                    <span class="n">entry</span><span class="p">[</span><span class="n">new_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">abbrev</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;href&quot;</span><span class="p">]</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos">  76</span></a>                    <span class="n">entry</span><span class="p">[</span><span class="n">new_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="n">new_col</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos">  77</span></a>            <span class="k">elif</span> <span class="n">col</span> <span class="o">==</span> <span class="s2">&quot;player&quot;</span> <span class="ow">and</span> <span class="s2">&quot;data-append-csv&quot;</span> <span class="ow">in</span> <span class="n">entry</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">:</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos">  78</span></a>                <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;player_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;data-append-csv&quot;</span><span class="p">]</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos">  79</span></a>            <span class="k">elif</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;winner&quot;</span><span class="p">,</span> <span class="s2">&quot;loser&quot;</span><span class="p">,</span> <span class="s2">&quot;home_team&quot;</span><span class="p">,</span> <span class="s2">&quot;visitor_team&quot;</span><span class="p">,</span><span class="s2">&quot;teams&quot;</span><span class="p">,</span><span class="s2">&quot;team&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">entry</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos">  80</span></a>                <span class="n">entry</span><span class="p">[</span><span class="n">col</span> <span class="o">+</span> <span class="s2">&quot;_abbrev&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos">  81</span></a>                    <span class="p">[</span><span class="n">team</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;href&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">team</span> <span class="ow">in</span> <span class="n">entry</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">)]</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos">  82</span></a>                <span class="p">)</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos">  83</span></a>            <span class="n">entry</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">text</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos">  84</span></a>        <span class="n">stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">stats</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="n">stats</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]])])</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos">  85</span></a>    <span class="n">stats</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos">  86</span></a>    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">stats</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos">  87</span></a>        <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_pct&quot;</span><span class="p">):</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos">  88</span></a>            <span class="n">stats</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">stats</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;%&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos">  89</span></a>        <span class="n">stats</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">stats</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos">  90</span></a>    <span class="k">return</span> <span class="n">stats</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos">  91</span></a>
</span><span id="L-92"><a href="#L-92"><span class="linenos">  92</span></a>
</span><span id="L-93"><a href="#L-93"><span class="linenos">  93</span></a><span class="k">def</span> <span class="nf">get_intl_games</span><span class="p">():</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos">  94</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos">  95</span></a><span class="sd">    Pulls details about the games in the NFL International Series (used in annotating neutral site games).</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos">  96</span></a>
</span><span id="L-97"><a href="#L-97"><span class="linenos">  97</span></a><span class="sd">    Returns:</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos">  98</span></a><span class="sd">        pd.DataFrame: dataframe containing dates, teams, and scores for each matchup.</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos">  99</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos"> 100</span></a>    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos"> 101</span></a>        <span class="s2">&quot;https://en.wikipedia.org/wiki/NFL_International_Series&quot;</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos"> 102</span></a>    <span class="p">)</span><span class="o">.</span><span class="n">text</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos"> 103</span></a>    <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s2">&quot;html.parser&quot;</span><span class="p">)</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos"> 104</span></a>    <span class="n">tables</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s2">&quot;table&quot;</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;wikitable sortable&quot;</span><span class="p">})[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos"> 105</span></a>    <span class="n">intl_games</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">tables</span><span class="p">)),</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos"> 106</span></a>    <span class="n">intl_games</span> <span class="o">=</span> <span class="n">intl_games</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">intl_games</span><span class="o">.</span><span class="n">Date</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">intl_games</span><span class="o">.</span><span class="n">Date</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;TBD&quot;</span><span class="p">])]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos"> 107</span></a>    <span class="n">intl_games</span><span class="o">.</span><span class="n">Year</span> <span class="o">=</span> <span class="n">intl_games</span><span class="o">.</span><span class="n">Year</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos"> 108</span></a>    <span class="n">intl_games</span><span class="p">[</span><span class="s2">&quot;team1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">intl_games</span><span class="p">[</span><span class="s2">&quot;Designated home team&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;\[&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos"> 109</span></a>    <span class="n">intl_games</span><span class="p">[</span><span class="s2">&quot;team2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">intl_games</span><span class="p">[</span><span class="s2">&quot;Designated visitor&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;\[&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos"> 110</span></a>    <span class="n">intl_games</span><span class="o">.</span><span class="n">Stadium</span> <span class="o">=</span> <span class="n">intl_games</span><span class="o">.</span><span class="n">Stadium</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;\[&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos"> 111</span></a>    <span class="n">intl_games</span><span class="p">[</span><span class="s2">&quot;game_date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">intl_games</span><span class="o">.</span><span class="n">Date</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="n">intl_games</span><span class="o">.</span><span class="n">Year</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">))</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos"> 112</span></a>    <span class="k">return</span> <span class="n">intl_games</span><span class="p">[[</span><span class="s2">&quot;game_date&quot;</span><span class="p">,</span> <span class="s2">&quot;team1&quot;</span><span class="p">,</span> <span class="s2">&quot;team2&quot;</span><span class="p">,</span> <span class="s2">&quot;Stadium&quot;</span><span class="p">]]</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos"> 113</span></a>
</span><span id="L-114"><a href="#L-114"><span class="linenos"> 114</span></a>
</span><span id="L-115"><a href="#L-115"><span class="linenos"> 115</span></a><span class="k">def</span> <span class="nf">get_depth_chart</span><span class="p">(</span><span class="n">team_abbrev</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos"> 116</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos"> 117</span></a><span class="sd">    Pulls the team depth chart directly from ESPN based on the team abbreviation provided.</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos"> 118</span></a>
</span><span id="L-119"><a href="#L-119"><span class="linenos"> 119</span></a><span class="sd">    Args:</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos"> 120</span></a><span class="sd">        team_abbrev (str): ESPN abbreviation for the team of interest.</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos"> 121</span></a>
</span><span id="L-122"><a href="#L-122"><span class="linenos"> 122</span></a><span class="sd">    Returns:</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos"> 123</span></a><span class="sd">        pd.DataFrame: dataframe containing the depth chart ranking for each player on the team of interest.</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos"> 124</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos"> 125</span></a>    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;wget https://www.espn.com/nfl/team/depth/_/name/</span><span class="si">{}</span><span class="s2"> -q -O </span><span class="si">{}</span><span class="s2">.html&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">team_abbrev</span><span class="p">,</span><span class="n">team_abbrev</span><span class="p">))</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos"> 126</span></a>    <span class="n">tempData</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">team_abbrev</span> <span class="o">+</span> <span class="s2">&quot;.html&quot;</span><span class="p">,</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos"> 127</span></a>    <span class="n">response</span> <span class="o">=</span> <span class="n">tempData</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos"> 128</span></a>    <span class="n">tempData</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos"> 129</span></a>    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">team_abbrev</span> <span class="o">+</span> <span class="s2">&quot;.html&quot;</span><span class="p">)</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos"> 130</span></a>    <span class="c1"># Not working for some reason, some sort of CloudFront traffic error</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos"> 131</span></a>    <span class="c1"># response = requests.get(&quot;https://www.espn.com/nfl/team/depth/_/name/{}&quot;.format(team_abbrev)).text</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos"> 132</span></a>    <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s2">&quot;html.parser&quot;</span><span class="p">)</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos"> 133</span></a>    <span class="n">tables</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;table&#39;</span><span class="p">)</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos"> 134</span></a>    <span class="n">depth</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos"> 135</span></a>    <span class="k">for</span> <span class="n">table_ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tables</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">):</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos"> 136</span></a>        <span class="n">positions</span> <span class="o">=</span> <span class="p">[</span><span class="n">pos</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">tables</span><span class="p">[</span><span class="n">table_ind</span><span class="o">*</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;td&#39;</span><span class="p">)]</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos"> 137</span></a>        <span class="n">players</span> <span class="o">=</span> <span class="p">[</span><span class="n">player</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">player</span> <span class="ow">in</span> <span class="n">tables</span><span class="p">[</span><span class="n">table_ind</span><span class="o">*</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;td&#39;</span><span class="p">)]</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos"> 138</span></a>        <span class="n">num_strings</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">players</span><span class="p">)</span><span class="o">//</span><span class="nb">len</span><span class="p">(</span><span class="n">positions</span><span class="p">)</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos"> 139</span></a>        <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">positions</span><span class="p">)):</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos"> 140</span></a>            <span class="k">for</span> <span class="n">string</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_strings</span><span class="p">):</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos"> 141</span></a>                <span class="n">depth</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">depth</span><span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;player&#39;</span><span class="p">:[</span><span class="n">players</span><span class="p">[</span><span class="n">pos</span><span class="o">*</span><span class="n">num_strings</span> <span class="o">+</span> <span class="n">string</span><span class="p">]],</span>\
</span><span id="L-142"><a href="#L-142"><span class="linenos"> 142</span></a>                <span class="s1">&#39;pos&#39;</span><span class="p">:[</span><span class="n">positions</span><span class="p">[</span><span class="n">pos</span><span class="p">]],</span><span class="s1">&#39;string&#39;</span><span class="p">:[</span><span class="n">string</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]})],</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos"> 143</span></a>    <span class="n">depth</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">depth</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;PK&#39;</span><span class="p">]),</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;K&#39;</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos"> 144</span></a>    <span class="n">wrs</span> <span class="o">=</span> <span class="n">depth</span><span class="o">.</span><span class="n">pos</span> <span class="o">==</span> <span class="s1">&#39;WR&#39;</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos"> 145</span></a>    <span class="n">depth</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">wrs</span><span class="p">,</span><span class="s1">&#39;string&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">depth</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">wrs</span><span class="p">]</span><span class="o">.</span><span class="n">string</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">3</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos"> 146</span></a>    <span class="n">depth</span> <span class="o">=</span> <span class="n">depth</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">depth</span><span class="o">.</span><span class="n">player</span> <span class="o">!=</span> <span class="s1">&#39;-&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos"> 147</span></a>    <span class="k">for</span> <span class="n">status</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">,</span><span class="s1">&#39;Q&#39;</span><span class="p">,</span><span class="s1">&#39;O&#39;</span><span class="p">,</span><span class="s1">&#39;PUP&#39;</span><span class="p">,</span><span class="s1">&#39;SUSP&#39;</span><span class="p">,</span><span class="s1">&#39;IR&#39;</span><span class="p">]:</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos"> 148</span></a>        <span class="n">injured</span> <span class="o">=</span> <span class="n">depth</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">status</span><span class="p">)</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos"> 149</span></a>        <span class="n">depth</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">injured</span><span class="p">,</span><span class="s1">&#39;player&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">depth</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">injured</span><span class="p">,</span><span class="s1">&#39;player&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">)</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos"> 150</span></a>    <span class="n">corrections</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;https://raw.githubusercontent.com/tefirman/FantasySports/main/res/football/name_corrections.csv&quot;</span><span class="p">)</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos"> 151</span></a>    <span class="n">depth</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">depth</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">corrections</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s1">&#39;player&#39;</span><span class="p">}),</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;player&quot;</span><span class="p">)</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos"> 152</span></a>    <span class="n">to_fix</span> <span class="o">=</span> <span class="o">~</span><span class="n">depth</span><span class="o">.</span><span class="n">new_name</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos"> 153</span></a>    <span class="n">depth</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">to_fix</span><span class="p">,</span> <span class="s2">&quot;player&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">depth</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">to_fix</span><span class="p">,</span> <span class="s2">&quot;new_name&quot;</span><span class="p">]</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos"> 154</span></a>    <span class="k">del</span> <span class="n">depth</span><span class="p">[</span><span class="s1">&#39;new_name&#39;</span><span class="p">]</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos"> 155</span></a>    <span class="k">return</span> <span class="n">depth</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos"> 156</span></a>
</span><span id="L-157"><a href="#L-157"><span class="linenos"> 157</span></a>
</span><span id="L-158"><a href="#L-158"><span class="linenos"> 158</span></a><span class="k">def</span> <span class="nf">get_all_depth_charts</span><span class="p">():</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos"> 159</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos"> 160</span></a><span class="sd">    Pulls all ESPN depth charts across the NFL.</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos"> 161</span></a>
</span><span id="L-162"><a href="#L-162"><span class="linenos"> 162</span></a><span class="sd">    Returns:</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos"> 163</span></a><span class="sd">        pd.DataFrame: dataframe containing the depth chart ranking for each player in the NFL.</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos"> 164</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos"> 165</span></a>    <span class="n">teams</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;https://raw.githubusercontent.com/tefirman/FantasySports/main/res/football/team_abbrevs.csv&quot;</span><span class="p">)</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos"> 166</span></a>    <span class="n">teams</span><span class="p">[</span><span class="s1">&#39;espn&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">teams</span><span class="o">.</span><span class="n">fivethirtyeight</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;OAK&#39;</span><span class="p">,</span><span class="s1">&#39;LV&#39;</span><span class="p">)</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos"> 167</span></a>    <span class="n">depths</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;team&#39;</span><span class="p">])</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos"> 168</span></a>    <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">teams</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos"> 169</span></a>        <span class="n">depths</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">depths</span><span class="p">,</span><span class="n">get_depth_chart</span><span class="p">(</span><span class="n">teams</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;espn&#39;</span><span class="p">])],</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos"> 170</span></a>        <span class="n">depths</span><span class="o">.</span><span class="n">team</span> <span class="o">=</span> <span class="n">depths</span><span class="o">.</span><span class="n">team</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">teams</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;real_abbrev&#39;</span><span class="p">])</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos"> 171</span></a>    <span class="k">return</span> <span class="n">depths</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos"> 172</span></a>
</span><span id="L-173"><a href="#L-173"><span class="linenos"> 173</span></a>
</span><span id="L-174"><a href="#L-174"><span class="linenos"> 174</span></a><span class="k">def</span> <span class="nf">get_stadiums</span><span class="p">():</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos"> 175</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos"> 176</span></a><span class="sd">    Pulls details about all stadiums ever used for an NFL game.</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos"> 177</span></a>
</span><span id="L-178"><a href="#L-178"><span class="linenos"> 178</span></a><span class="sd">    Returns:</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos"> 179</span></a><span class="sd">        pd.DataFrame: dataframe containing names, locations, and timespans of each stadium.</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos"> 180</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos"> 181</span></a>    <span class="n">raw_text</span> <span class="o">=</span> <span class="n">get_page</span><span class="p">(</span><span class="s2">&quot;stadiums&quot;</span><span class="p">)</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos"> 182</span></a>    <span class="n">stadiums</span> <span class="o">=</span> <span class="n">parse_table</span><span class="p">(</span><span class="n">raw_text</span><span class="p">,</span> <span class="s2">&quot;stadiums&quot;</span><span class="p">)</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos"> 183</span></a>    <span class="k">return</span> <span class="n">stadiums</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos"> 184</span></a>
</span><span id="L-185"><a href="#L-185"><span class="linenos"> 185</span></a>
</span><span id="L-186"><a href="#L-186"><span class="linenos"> 186</span></a><span class="k">def</span> <span class="nf">get_team_stadium</span><span class="p">(</span><span class="n">abbrev</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">season</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos"> 187</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos"> 188</span></a><span class="sd">    Identifies the home stadium of the specified team during the specified season.</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos"> 189</span></a>
</span><span id="L-190"><a href="#L-190"><span class="linenos"> 190</span></a><span class="sd">    Args:</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos"> 191</span></a><span class="sd">        abbrev (str): team abbreviation according to Pro Football Reference</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos"> 192</span></a><span class="sd">        season (int): year of the NFL season of interest</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos"> 193</span></a>
</span><span id="L-194"><a href="#L-194"><span class="linenos"> 194</span></a><span class="sd">    Returns:</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos"> 195</span></a><span class="sd">        str: stadium identifier according to Pro Football Reference</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos"> 196</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos"> 197</span></a>    <span class="n">raw_text</span> <span class="o">=</span> <span class="n">get_page</span><span class="p">(</span><span class="s2">&quot;teams/</span><span class="si">{}</span><span class="s2">/</span><span class="si">{}</span><span class="s2">.htm&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">abbrev</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="nb">int</span><span class="p">(</span><span class="n">season</span><span class="p">)))</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos"> 198</span></a>    <span class="n">team_info</span> <span class="o">=</span> <span class="n">raw_text</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;meta&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">)</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos"> 199</span></a>    <span class="n">stadium_info</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">team_info</span> <span class="k">if</span> <span class="n">val</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Stadium:&quot;</span><span class="p">)]</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos"> 200</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">stadium_info</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos"> 201</span></a>        <span class="n">stadiums</span> <span class="o">=</span> <span class="n">get_stadiums</span><span class="p">()</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos"> 202</span></a>        <span class="n">stadiums</span><span class="o">.</span><span class="n">teams_abbrev</span> <span class="o">=</span> <span class="n">stadiums</span><span class="o">.</span><span class="n">teams_abbrev</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="p">)</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos"> 203</span></a>        <span class="n">stadiums</span> <span class="o">=</span> <span class="n">stadiums</span><span class="o">.</span><span class="n">explode</span><span class="p">(</span><span class="s2">&quot;teams_abbrev&quot;</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos"> 204</span></a>        <span class="n">stadium_id</span> <span class="o">=</span> <span class="n">stadiums</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos"> 205</span></a>            <span class="p">(</span><span class="n">stadiums</span><span class="o">.</span><span class="n">teams_abbrev</span> <span class="o">==</span> <span class="n">abbrev</span><span class="p">)</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos"> 206</span></a>            <span class="o">&amp;</span> <span class="p">(</span><span class="n">stadiums</span><span class="o">.</span><span class="n">year_min</span> <span class="o">&lt;=</span> <span class="n">season</span><span class="p">)</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos"> 207</span></a>            <span class="o">&amp;</span> <span class="p">(</span><span class="n">stadiums</span><span class="o">.</span><span class="n">year_max</span> <span class="o">&gt;=</span> <span class="n">season</span><span class="p">),</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos"> 208</span></a>            <span class="s2">&quot;stadium_abbrev&quot;</span><span class="p">,</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos"> 209</span></a>        <span class="p">]</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos"> 210</span></a>        <span class="k">if</span> <span class="n">stadium_id</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos"> 211</span></a>            <span class="n">stadium_id</span> <span class="o">=</span> <span class="n">stadium_id</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos"> 212</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos"> 213</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Can&#39;t find home stadium for </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2">...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">season</span><span class="p">,</span><span class="n">abbrev</span><span class="p">))</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos"> 214</span></a>            <span class="n">stadium_id</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos"> 215</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos"> 216</span></a>        <span class="n">stadium_info</span> <span class="o">=</span> <span class="n">stadium_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos"> 217</span></a>        <span class="n">stadium_id</span> <span class="o">=</span> <span class="n">stadium_info</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;href&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos"> 218</span></a>    <span class="k">return</span> <span class="n">stadium_id</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos"> 219</span></a>
</span><span id="L-220"><a href="#L-220"><span class="linenos"> 220</span></a>
</span><span id="L-221"><a href="#L-221"><span class="linenos"> 221</span></a><span class="k">def</span> <span class="nf">get_game_stadium</span><span class="p">(</span><span class="n">game_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos"> 222</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos"> 223</span></a><span class="sd">    Identifies the stadium where the specified game was played.</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos"> 224</span></a>
</span><span id="L-225"><a href="#L-225"><span class="linenos"> 225</span></a><span class="sd">    Args:</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos"> 226</span></a><span class="sd">        game_id (str): Pro Football Reference identifier string for the game in question (e.g. 202209080ram).</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos"> 227</span></a>
</span><span id="L-228"><a href="#L-228"><span class="linenos"> 228</span></a><span class="sd">    Returns:</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos"> 229</span></a><span class="sd">        str: stadium identifier according to Pro Football Reference.</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos"> 230</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos"> 231</span></a>    <span class="n">raw_text</span> <span class="o">=</span> <span class="n">get_page</span><span class="p">(</span><span class="s2">&quot;boxscores/</span><span class="si">{}</span><span class="s2">.htm&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">game_id</span><span class="p">))</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos"> 232</span></a>    <span class="n">game_info</span> <span class="o">=</span> <span class="n">raw_text</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;div&quot;</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;scorebox_meta&quot;</span><span class="p">})</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos"> 233</span></a>    <span class="n">stadium_id</span> <span class="o">=</span> <span class="n">game_info</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;href&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos"> 234</span></a>    <span class="k">return</span> <span class="n">stadium_id</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos"> 235</span></a>
</span><span id="L-236"><a href="#L-236"><span class="linenos"> 236</span></a>
</span><span id="L-237"><a href="#L-237"><span class="linenos"> 237</span></a><span class="k">def</span> <span class="nf">get_address</span><span class="p">(</span><span class="n">stadium_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos"> 238</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos"> 239</span></a><span class="sd">    Identifies the address of the specified stadium (with a few typo corrections here and there).</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos"> 240</span></a>
</span><span id="L-241"><a href="#L-241"><span class="linenos"> 241</span></a><span class="sd">    Args:</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos"> 242</span></a><span class="sd">        stadium_id (str): stadium identifier according to Pro Football Reference.</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos"> 243</span></a>
</span><span id="L-244"><a href="#L-244"><span class="linenos"> 244</span></a><span class="sd">    Returns:</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos"> 245</span></a><span class="sd">        str: address of the specified stadium according to Pro Football Reference.</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos"> 246</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos"> 247</span></a>    <span class="n">raw_text</span> <span class="o">=</span> <span class="n">get_page</span><span class="p">(</span><span class="s2">&quot;stadiums/</span><span class="si">{}</span><span class="s2">.htm&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stadium_id</span><span class="p">))</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos"> 248</span></a>    <span class="n">address</span> <span class="o">=</span> <span class="n">raw_text</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;meta&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos"> 249</span></a>    <span class="n">fixes</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos"> 250</span></a>        <span class="s2">&quot;New Jersey&quot;</span><span class="p">:</span> <span class="s2">&quot;NJ&quot;</span><span class="p">,</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos"> 251</span></a>        <span class="s2">&quot;Park Houston&quot;</span><span class="p">:</span> <span class="s2">&quot;Park, Houston&quot;</span><span class="p">,</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos"> 252</span></a>        <span class="s2">&quot;Blvd Opa-Locka&quot;</span><span class="p">:</span> <span class="s2">&quot;Blvd, Opa-Locka&quot;</span><span class="p">,</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos"> 253</span></a>        <span class="s2">&quot;Northumberland Development Project&quot;</span><span class="p">:</span> <span class="s2">&quot;782 High Rd, London N17 0BX, UK&quot;</span><span class="p">,</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos"> 254</span></a>    <span class="p">}</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos"> 255</span></a>    <span class="k">for</span> <span class="n">fix</span> <span class="ow">in</span> <span class="n">fixes</span><span class="p">:</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos"> 256</span></a>        <span class="n">address</span> <span class="o">=</span> <span class="n">address</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">fix</span><span class="p">,</span> <span class="n">fixes</span><span class="p">[</span><span class="n">fix</span><span class="p">])</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos"> 257</span></a>    <span class="k">return</span> <span class="n">address</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos"> 258</span></a>
</span><span id="L-259"><a href="#L-259"><span class="linenos"> 259</span></a>
</span><span id="L-260"><a href="#L-260"><span class="linenos"> 260</span></a><span class="k">def</span> <span class="nf">download_zip_codes</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;https://nominatim.org/data/us_postcodes.csv.gz&quot;</span><span class="p">):</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos"> 261</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos"> 262</span></a><span class="sd">    Downloads a csv from Nominatim containing the GPS coordinates of every zip code in the US</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos"> 263</span></a><span class="sd">    and returns it in the form of a pandas dataframe (used when accounting for team travel).</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos"> 264</span></a>
</span><span id="L-265"><a href="#L-265"><span class="linenos"> 265</span></a><span class="sd">    Args:</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos"> 266</span></a><span class="sd">        url (str, optional): URL location of the zipcode csv, defaults to &quot;https://nominatim.org/data/us_postcodes.csv.gz&quot;.</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos"> 267</span></a>
</span><span id="L-268"><a href="#L-268"><span class="linenos"> 268</span></a><span class="sd">    Returns:</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos"> 269</span></a><span class="sd">        pd.DataFrame: dataframe containing the GPS coordinates of every US zip code.</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos"> 270</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos"> 271</span></a>    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos"> 272</span></a>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">out_file</span><span class="p">:</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos"> 273</span></a>        <span class="n">shutil</span><span class="o">.</span><span class="n">copyfileobj</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">raw</span><span class="p">,</span><span class="n">out_file</span><span class="p">)</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos"> 274</span></a>    <span class="k">with</span> <span class="n">gzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f_in</span><span class="p">:</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos"> 275</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">3</span><span class="p">],</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f_out</span><span class="p">:</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos"> 276</span></a>            <span class="n">shutil</span><span class="o">.</span><span class="n">copyfileobj</span><span class="p">(</span><span class="n">f_in</span><span class="p">,</span> <span class="n">f_out</span><span class="p">)</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos"> 277</span></a>    <span class="n">zips</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">3</span><span class="p">],</span><span class="n">dtype</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;postcode&#39;</span><span class="p">:</span><span class="nb">str</span><span class="p">})</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos"> 278</span></a>    <span class="k">return</span> <span class="n">zips</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos"> 279</span></a>
</span><span id="L-280"><a href="#L-280"><span class="linenos"> 280</span></a>
</span><span id="L-281"><a href="#L-281"><span class="linenos"> 281</span></a><span class="k">def</span> <span class="nf">get_coordinates</span><span class="p">(</span><span class="n">address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">zips</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos"> 282</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos"> 283</span></a><span class="sd">    Provides the coordinates of the specified address. If no exact coordinates are available,</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos"> 284</span></a><span class="sd">    city, state, and zip code are used for an approximate position.</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos"> 285</span></a>
</span><span id="L-286"><a href="#L-286"><span class="linenos"> 286</span></a><span class="sd">    Args:</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos"> 287</span></a><span class="sd">        address (str): physical address of interest.</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos"> 288</span></a>
</span><span id="L-289"><a href="#L-289"><span class="linenos"> 289</span></a><span class="sd">    Returns:</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos"> 290</span></a><span class="sd">        str: latitudinal and longitudinal coordinates separated by a comma.</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos"> 291</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos"> 292</span></a>    <span class="n">stad_zip</span> <span class="o">=</span> <span class="n">address</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos"> 293</span></a>    <span class="n">stad_coords</span> <span class="o">=</span> <span class="n">zips</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">zips</span><span class="o">.</span><span class="n">postcode</span> <span class="o">==</span> <span class="n">stad_zip</span><span class="p">,[</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span><span class="s1">&#39;lon&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos"> 294</span></a>    <span class="k">if</span> <span class="n">stad_coords</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos"> 295</span></a>        <span class="n">coords</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">stad_coords</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos"> 296</span></a>    <span class="k">elif</span> <span class="n">stad_zip</span> <span class="o">==</span> <span class="s2">&quot;Mexico&quot;</span><span class="p">:</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos"> 297</span></a>        <span class="n">coords</span> <span class="o">=</span> <span class="s2">&quot;19.3029,-99.1505&quot;</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos"> 298</span></a>    <span class="k">elif</span> <span class="n">stad_zip</span> <span class="o">==</span> <span class="s2">&quot;UK&quot;</span><span class="p">:</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos"> 299</span></a>        <span class="n">coords</span> <span class="o">=</span> <span class="s2">&quot;51.5072,-0.1276&quot;</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos"> 300</span></a>    <span class="k">elif</span> <span class="n">stad_zip</span> <span class="o">==</span> <span class="s2">&quot;Bavaria&quot;</span><span class="p">:</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos"> 301</span></a>        <span class="n">coords</span> <span class="o">=</span> <span class="s2">&quot;48.2188,11.6248&quot;</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos"> 302</span></a>    <span class="k">elif</span> <span class="n">stad_zip</span> <span class="o">==</span> <span class="s2">&quot;Hesse&quot;</span><span class="p">:</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos"> 303</span></a>        <span class="n">coords</span> <span class="o">=</span> <span class="s2">&quot;50.0686,8.6455&quot;</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos"> 304</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos"> 305</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Can&#39;t find zip code provided: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">stad_zip</span><span class="p">))</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos"> 306</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Using centerpoint of US...&quot;</span><span class="p">)</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos"> 307</span></a>        <span class="n">coords</span> <span class="o">=</span> <span class="s2">&quot;37.0902,-95.7129&quot;</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos"> 308</span></a>    <span class="k">return</span> <span class="n">coords</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos"> 309</span></a>
</span><span id="L-310"><a href="#L-310"><span class="linenos"> 310</span></a>
</span><span id="L-311"><a href="#L-311"><span class="linenos"> 311</span></a><span class="k">class</span> <span class="nc">Schedule</span><span class="p">:</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos"> 312</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos"> 313</span></a><span class="sd">    Schedule class that gathers all matchups and outcomes for the seasons in question and</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos"> 314</span></a><span class="sd">    assess the evolution of each team&#39;s elo ranking according to 538&#39;s methodology.</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos"> 315</span></a>
</span><span id="L-316"><a href="#L-316"><span class="linenos"> 316</span></a><span class="sd">    Attributes:</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos"> 317</span></a><span class="sd">        schedule: dataframe containing matchup details for the seasons of interest.</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos"> 318</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos"> 319</span></a>
</span><span id="L-320"><a href="#L-320"><span class="linenos"> 320</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">finish</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">playoffs</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">elo</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">qbelo</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos"> 321</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos"> 322</span></a><span class="sd">        Initializes a Schedule object using the parameters provided and class functions defined below.</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos"> 323</span></a>
</span><span id="L-324"><a href="#L-324"><span class="linenos"> 324</span></a><span class="sd">        Args:</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos"> 325</span></a><span class="sd">            start (int): first NFL season of interest</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos"> 326</span></a><span class="sd">            finish (int): last NFL season of interest</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos"> 327</span></a><span class="sd">            playoffs (bool, optional): whether to include playoff games, defaults to True.</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos"> 328</span></a><span class="sd">            elo (bool, optional): whether to include elo rating considerations, defaults to False.</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos"> 329</span></a><span class="sd">            qbelo (bool, optional): whether to include QB elo rating considerations, defaults to False.</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos"> 330</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos"> 331</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">get_schedules</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">finish</span><span class="p">)</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos"> 332</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_weeks</span><span class="p">()</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos"> 333</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">convert_to_home_away</span><span class="p">()</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos"> 334</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mark_intl_games</span><span class="p">()</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos"> 335</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_rest</span><span class="p">()</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos"> 336</span></a>        <span class="k">if</span> <span class="n">elo</span><span class="p">:</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos"> 337</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">add_team_coords</span><span class="p">()</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos"> 338</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">add_game_coords</span><span class="p">()</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos"> 339</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">add_travel</span><span class="p">()</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos"> 340</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">add_elo_columns</span><span class="p">(</span><span class="n">qbelo</span><span class="p">)</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos"> 341</span></a>            <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">elo1_pre</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos"> 342</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">next_init_elo</span><span class="p">()</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos"> 343</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">next_elo_prob</span><span class="p">()</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos"> 344</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">next_elo_delta</span><span class="p">()</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos"> 345</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">playoffs</span><span class="p">:</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos"> 346</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos"> 347</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">week_num</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">isnumeric</span><span class="p">()</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos"> 348</span></a>            <span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos"> 349</span></a>
</span><span id="L-350"><a href="#L-350"><span class="linenos"> 350</span></a>    <span class="k">def</span> <span class="nf">get_schedules</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">finish</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos"> 351</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos"> 352</span></a><span class="sd">        Pulls the full NFL schedules for the seasons provided.</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos"> 353</span></a>
</span><span id="L-354"><a href="#L-354"><span class="linenos"> 354</span></a><span class="sd">        Args:</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos"> 355</span></a><span class="sd">            start (int): first season of interest</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos"> 356</span></a><span class="sd">            finish (int): last season of interest</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos"> 357</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos"> 358</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">])</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos"> 359</span></a>        <span class="k">for</span> <span class="n">season</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">start</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">finish</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos"> 360</span></a>            <span class="n">raw_text</span> <span class="o">=</span> <span class="n">get_page</span><span class="p">(</span><span class="s2">&quot;years/</span><span class="si">{}</span><span class="s2">/games.htm&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">season</span><span class="p">))</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos"> 361</span></a>            <span class="n">season_sched</span> <span class="o">=</span> <span class="n">parse_table</span><span class="p">(</span><span class="n">raw_text</span><span class="p">,</span> <span class="s2">&quot;games&quot;</span><span class="p">)</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos"> 362</span></a>            <span class="n">season_sched</span><span class="o">.</span><span class="n">week_num</span> <span class="o">=</span> <span class="n">season_sched</span><span class="o">.</span><span class="n">week_num</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos"> 363</span></a>            <span class="n">season_sched</span> <span class="o">=</span> <span class="n">season_sched</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">season_sched</span><span class="o">.</span><span class="n">week_num</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;Pre&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos"> 364</span></a>            <span class="n">season_sched</span><span class="p">[</span><span class="s1">&#39;season&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">season</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos"> 365</span></a>            <span class="k">if</span> <span class="s2">&quot;game_date&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">season_sched</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span> <span class="c1"># Current season</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos"> 366</span></a>                <span class="n">season_sched</span><span class="p">[</span><span class="s1">&#39;game_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">season_sched</span><span class="o">.</span><span class="n">boxscore_word</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span> <span class="o">+</span> \
</span><span id="L-367"><a href="#L-367"><span class="linenos"> 367</span></a>                <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">year</span> <span class="o">+</span> <span class="n">season_sched</span><span class="o">.</span><span class="n">boxscore_word</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;January&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos"> 368</span></a>                <span class="n">season_sched</span> <span class="o">=</span> <span class="n">season_sched</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;visitor_team&#39;</span><span class="p">:</span><span class="s1">&#39;winner&#39;</span><span class="p">,</span>\
</span><span id="L-369"><a href="#L-369"><span class="linenos"> 369</span></a>                <span class="s1">&#39;visitor_team_abbrev&#39;</span><span class="p">:</span><span class="s1">&#39;winner_abbrev&#39;</span><span class="p">,</span><span class="s1">&#39;home_team&#39;</span><span class="p">:</span><span class="s1">&#39;loser&#39;</span><span class="p">,</span><span class="s1">&#39;home_team_abbrev&#39;</span><span class="p">:</span><span class="s1">&#39;loser_abbrev&#39;</span><span class="p">})</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos"> 370</span></a>                <span class="n">season_sched</span><span class="p">[[</span><span class="s1">&#39;yards_win&#39;</span><span class="p">,</span><span class="s1">&#39;to_win&#39;</span><span class="p">,</span><span class="s1">&#39;yards_lose&#39;</span><span class="p">,</span><span class="s1">&#39;to_lose&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos"> 371</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="p">,</span> <span class="n">season_sched</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos"> 372</span></a>
</span><span id="L-373"><a href="#L-373"><span class="linenos"> 373</span></a>    <span class="k">def</span> <span class="nf">add_weeks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos"> 374</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos"> 375</span></a><span class="sd">        Infers season week based on game dates for each season.</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos"> 376</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos"> 377</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">game_date</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">game_date</span><span class="p">)</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos"> 378</span></a>        <span class="n">min_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;season&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">game_date</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos"> 379</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos"> 380</span></a>            <span class="n">left</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="p">,</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos"> 381</span></a>            <span class="n">right</span><span class="o">=</span><span class="n">min_date</span><span class="p">,</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos"> 382</span></a>            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">,</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos"> 383</span></a>            <span class="n">on</span><span class="o">=</span><span class="s2">&quot;season&quot;</span><span class="p">,</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos"> 384</span></a>            <span class="n">suffixes</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;_min&quot;</span><span class="p">),</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos"> 385</span></a>        <span class="p">)</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos"> 386</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;days_into_season&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos"> 387</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">game_date</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">game_date_min</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos"> 388</span></a>        <span class="p">)</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">days</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos"> 389</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;week&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">days_into_season</span> <span class="o">//</span> <span class="mi">7</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos"> 390</span></a>
</span><span id="L-391"><a href="#L-391"><span class="linenos"> 391</span></a>    <span class="k">def</span> <span class="nf">convert_to_home_away</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos"> 392</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos"> 393</span></a><span class="sd">        Converts winner/loser syntax of Pro Football Reference schedules into home/away.</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos"> 394</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos"> 395</span></a>        <span class="n">list1</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;team1&quot;</span><span class="p">,</span><span class="s2">&quot;team1_abbrev&quot;</span><span class="p">,</span><span class="s2">&quot;score1&quot;</span><span class="p">,</span><span class="s2">&quot;yards1&quot;</span><span class="p">,</span><span class="s2">&quot;timeouts1&quot;</span><span class="p">]</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos"> 396</span></a>        <span class="n">list2</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;team2&quot;</span><span class="p">,</span><span class="s2">&quot;team2_abbrev&quot;</span><span class="p">,</span><span class="s2">&quot;score2&quot;</span><span class="p">,</span><span class="s2">&quot;yards2&quot;</span><span class="p">,</span><span class="s2">&quot;timeouts2&quot;</span><span class="p">]</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos"> 397</span></a>        <span class="n">winner_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;winner&quot;</span><span class="p">,</span><span class="s2">&quot;winner_abbrev&quot;</span><span class="p">,</span><span class="s2">&quot;pts_win&quot;</span><span class="p">,</span><span class="s2">&quot;yards_win&quot;</span><span class="p">,</span><span class="s2">&quot;to_win&quot;</span><span class="p">]</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos"> 398</span></a>        <span class="n">loser_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;loser&quot;</span><span class="p">,</span><span class="s2">&quot;loser_abbrev&quot;</span><span class="p">,</span><span class="s2">&quot;pts_lose&quot;</span><span class="p">,</span><span class="s2">&quot;yards_lose&quot;</span><span class="p">,</span><span class="s2">&quot;to_lose&quot;</span><span class="p">]</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos"> 399</span></a>        <span class="n">home_loser</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">game_location</span> <span class="o">==</span> <span class="s2">&quot;@&quot;</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos"> 400</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">home_loser</span><span class="p">,</span> <span class="n">list1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">home_loser</span><span class="p">,</span> <span class="n">loser_list</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos"> 401</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">home_loser</span><span class="p">,</span> <span class="n">list2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">home_loser</span><span class="p">,</span> <span class="n">winner_list</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos"> 402</span></a>        <span class="n">away_loser</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">game_location</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">game_location</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;N&quot;</span><span class="p">])</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos"> 403</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">away_loser</span><span class="p">,</span> <span class="n">list1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">away_loser</span><span class="p">,</span> <span class="n">winner_list</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos"> 404</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">away_loser</span><span class="p">,</span> <span class="n">list2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">away_loser</span><span class="p">,</span> <span class="n">loser_list</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos"> 405</span></a>
</span><span id="L-406"><a href="#L-406"><span class="linenos"> 406</span></a>    <span class="k">def</span> <span class="nf">mark_intl_games</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos"> 407</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos"> 408</span></a><span class="sd">        Identifies international games in the provided schedule (used when accounting for team travel).</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos"> 409</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos"> 410</span></a>        <span class="n">intl</span> <span class="o">=</span> <span class="n">get_intl_games</span><span class="p">()</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos"> 411</span></a>        <span class="n">intl</span> <span class="o">=</span> <span class="n">intl</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos"> 412</span></a>            <span class="p">(</span><span class="n">intl</span><span class="o">.</span><span class="n">game_date</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">season</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos"> 413</span></a>            <span class="o">&amp;</span> <span class="p">(</span><span class="n">intl</span><span class="o">.</span><span class="n">game_date</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">season</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos"> 414</span></a>        <span class="p">]</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos"> 415</span></a>        <span class="n">intl</span><span class="p">[</span><span class="s2">&quot;international&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos"> 416</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos"> 417</span></a>            <span class="n">left</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="p">,</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos"> 418</span></a>            <span class="n">right</span><span class="o">=</span><span class="n">intl</span><span class="p">,</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos"> 419</span></a>            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos"> 420</span></a>            <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;game_date&quot;</span><span class="p">,</span> <span class="s2">&quot;team1&quot;</span><span class="p">,</span> <span class="s2">&quot;team2&quot;</span><span class="p">],</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos"> 421</span></a>        <span class="p">)</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos"> 422</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">international</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">international</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos"> 423</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">international</span><span class="p">,</span> <span class="s2">&quot;game_location&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;N&quot;</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos"> 424</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">international</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">intl</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos"> 425</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Missing some international games!!!&quot;</span><span class="p">)</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos"> 426</span></a>            <span class="n">bad</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos"> 427</span></a>                <span class="n">left</span><span class="o">=</span><span class="n">intl</span><span class="p">,</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos"> 428</span></a>                <span class="n">right</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="p">[[</span><span class="s2">&quot;boxscore_abbrev&quot;</span><span class="p">,</span> <span class="s2">&quot;game_date&quot;</span><span class="p">,</span> <span class="s2">&quot;team1&quot;</span><span class="p">,</span> <span class="s2">&quot;team2&quot;</span><span class="p">]],</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos"> 429</span></a>                <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos"> 430</span></a>                <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;game_date&quot;</span><span class="p">,</span> <span class="s2">&quot;team1&quot;</span><span class="p">,</span> <span class="s2">&quot;team2&quot;</span><span class="p">],</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos"> 431</span></a>            <span class="p">)</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos"> 432</span></a>            <span class="n">bad</span> <span class="o">=</span> <span class="n">bad</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">bad</span><span class="o">.</span><span class="n">boxscore_abbrev</span><span class="o">.</span><span class="n">isnull</span><span class="p">()]</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos"> 433</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">bad</span><span class="p">)</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos"> 434</span></a>
</span><span id="L-435"><a href="#L-435"><span class="linenos"> 435</span></a>    <span class="k">def</span> <span class="nf">add_team_coords</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos"> 436</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos"> 437</span></a><span class="sd">        Adds the home coordinates for each team in each matchup of the schedule.</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos"> 438</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos"> 439</span></a>        <span class="n">teams</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos"> 440</span></a>            <span class="p">[</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos"> 441</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="p">[[</span><span class="s2">&quot;season&quot;</span><span class="p">,</span> <span class="s2">&quot;team1_abbrev&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos"> 442</span></a>                    <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;team1_abbrev&quot;</span><span class="p">:</span> <span class="s2">&quot;abbrev&quot;</span><span class="p">}</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos"> 443</span></a>                <span class="p">),</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos"> 444</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="p">[[</span><span class="s2">&quot;season&quot;</span><span class="p">,</span> <span class="s2">&quot;team2_abbrev&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos"> 445</span></a>                    <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;team2_abbrev&quot;</span><span class="p">:</span> <span class="s2">&quot;abbrev&quot;</span><span class="p">}</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos"> 446</span></a>                <span class="p">),</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos"> 447</span></a>            <span class="p">]</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos"> 448</span></a>        <span class="p">)</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos"> 449</span></a>        <span class="n">zips</span> <span class="o">=</span> <span class="n">download_zip_codes</span><span class="p">()</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos"> 450</span></a>        <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">teams</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos"> 451</span></a>            <span class="n">team</span> <span class="o">=</span> <span class="n">teams</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos"> 452</span></a>            <span class="n">stadium_id</span> <span class="o">=</span> <span class="n">get_team_stadium</span><span class="p">(</span><span class="n">team</span><span class="p">[</span><span class="s2">&quot;abbrev&quot;</span><span class="p">],</span> <span class="n">team</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">])</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos"> 453</span></a>            <span class="n">address</span> <span class="o">=</span> <span class="n">get_address</span><span class="p">(</span><span class="n">stadium_id</span><span class="p">)</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos"> 454</span></a>            <span class="n">coords</span> <span class="o">=</span> <span class="n">get_coordinates</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">zips</span><span class="p">)</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos"> 455</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos"> 456</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">team1_abbrev</span> <span class="o">==</span> <span class="n">team</span><span class="p">[</span><span class="s2">&quot;abbrev&quot;</span><span class="p">],</span> <span class="s2">&quot;coords1&quot;</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos"> 457</span></a>            <span class="p">]</span> <span class="o">=</span> <span class="n">coords</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos"> 458</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos"> 459</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">team2_abbrev</span> <span class="o">==</span> <span class="n">team</span><span class="p">[</span><span class="s2">&quot;abbrev&quot;</span><span class="p">],</span> <span class="s2">&quot;coords2&quot;</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos"> 460</span></a>            <span class="p">]</span> <span class="o">=</span> <span class="n">coords</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos"> 461</span></a>
</span><span id="L-462"><a href="#L-462"><span class="linenos"> 462</span></a>    <span class="k">def</span> <span class="nf">add_game_coords</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos"> 463</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos"> 464</span></a><span class="sd">        Adds game coordinates for each of the matchups in the schedule.</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos"> 465</span></a><span class="sd">        If the game is international, the location is pulled directly from Pro Football Reference.</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos"> 466</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos"> 467</span></a>        <span class="n">neutral</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">game_location</span> <span class="o">==</span> <span class="s2">&quot;N&quot;</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos"> 468</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">neutral</span><span class="p">,</span> <span class="s2">&quot;game_coords&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos"> 469</span></a>            <span class="o">~</span><span class="n">neutral</span><span class="p">,</span> <span class="s2">&quot;coords1&quot;</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos"> 470</span></a>        <span class="p">]</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos"> 471</span></a>        <span class="n">zips</span> <span class="o">=</span> <span class="n">download_zip_codes</span><span class="p">()</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos"> 472</span></a>        <span class="k">for</span> <span class="n">box</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">neutral</span><span class="p">,</span> <span class="s2">&quot;boxscore_abbrev&quot;</span><span class="p">]:</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos"> 473</span></a>            <span class="n">stadium_id</span> <span class="o">=</span> <span class="n">get_game_stadium</span><span class="p">(</span><span class="n">box</span><span class="p">)</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos"> 474</span></a>            <span class="k">if</span> <span class="n">stadium_id</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;attendance&quot;</span><span class="p">]:</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos"> 475</span></a>                <span class="n">stad_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">boxscore_abbrev</span> <span class="o">==</span> <span class="n">box</span><span class="p">,</span><span class="s2">&quot;Stadium&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos"> 476</span></a>                <span class="k">if</span> <span class="n">stad_name</span> <span class="o">==</span> <span class="s2">&quot;Wembley Stadium&quot;</span><span class="p">:</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos"> 477</span></a>                    <span class="n">stadium_id</span> <span class="o">=</span> <span class="s2">&quot;LON00&quot;</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos"> 478</span></a>                <span class="k">elif</span> <span class="n">stad_name</span> <span class="o">==</span> <span class="s2">&quot;Tottenham Hotspur Stadium&quot;</span><span class="p">:</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos"> 479</span></a>                    <span class="n">stadium_id</span> <span class="o">=</span> <span class="s2">&quot;LON02&quot;</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos"> 480</span></a>                <span class="k">elif</span> <span class="n">stad_name</span> <span class="o">==</span> <span class="s2">&quot;Deutsche Bank Park&quot;</span><span class="p">:</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos"> 481</span></a>                    <span class="n">stadium_id</span> <span class="o">=</span> <span class="s2">&quot;FRA00&quot;</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos"> 482</span></a>            <span class="n">address</span> <span class="o">=</span> <span class="n">get_address</span><span class="p">(</span><span class="n">stadium_id</span><span class="p">)</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos"> 483</span></a>            <span class="n">coords</span> <span class="o">=</span> <span class="n">get_coordinates</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">zips</span><span class="p">)</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos"> 484</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos"> 485</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">boxscore_abbrev</span> <span class="o">==</span> <span class="n">box</span><span class="p">,</span> <span class="s2">&quot;game_coords&quot;</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos"> 486</span></a>            <span class="p">]</span> <span class="o">=</span> <span class="n">coords</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos"> 487</span></a>        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;Stadium&quot;</span><span class="p">]</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos"> 488</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">game_coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">game_coords</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos"> 489</span></a>
</span><span id="L-490"><a href="#L-490"><span class="linenos"> 490</span></a>    <span class="k">def</span> <span class="nf">add_travel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos"> 491</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos"> 492</span></a><span class="sd">        Adds the distance traveled for each team in each matchup of the schedule.</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos"> 493</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos"> 494</span></a>        <span class="k">for</span> <span class="n">team</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]:</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos"> 495</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;coords&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">team</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="p">[</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos"> 496</span></a>                <span class="s2">&quot;coords&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">team</span><span class="p">)</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos"> 497</span></a>            <span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos"> 498</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;travel&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">team</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos"> 499</span></a>                <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">geodesic</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;coords&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">team</span><span class="p">)],</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;game_coords&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">mi</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos"> 500</span></a>            <span class="p">)</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos"> 501</span></a>
</span><span id="L-502"><a href="#L-502"><span class="linenos"> 502</span></a>    <span class="k">def</span> <span class="nf">add_rest</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos"> 503</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos"> 504</span></a><span class="sd">        Identifies teams that had a bye week before the matchup in question.</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos"> 505</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos"> 506</span></a>        <span class="k">for</span> <span class="n">week</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">week</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos"> 507</span></a>            <span class="n">prev</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos"> 508</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">week</span> <span class="o">==</span> <span class="n">week</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;team1&quot;</span><span class="p">,</span> <span class="s2">&quot;team2&quot;</span><span class="p">]]</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos"> 509</span></a>                <span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos"> 510</span></a>                <span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos"> 511</span></a>            <span class="p">)</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos"> 512</span></a>            <span class="n">now</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos"> 513</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">week</span> <span class="o">==</span> <span class="n">week</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;team1&quot;</span><span class="p">,</span> <span class="s2">&quot;team2&quot;</span><span class="p">]]</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos"> 514</span></a>                <span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos"> 515</span></a>                <span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos"> 516</span></a>            <span class="p">)</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos"> 517</span></a>            <span class="n">rested</span> <span class="o">=</span> <span class="p">[</span><span class="n">team</span> <span class="k">for</span> <span class="n">team</span> <span class="ow">in</span> <span class="n">now</span> <span class="k">if</span> <span class="n">team</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">prev</span><span class="p">]</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos"> 518</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos"> 519</span></a>                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">week</span> <span class="o">==</span> <span class="n">week</span><span class="p">)</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">team1</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">rested</span><span class="p">),</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos"> 520</span></a>                <span class="s2">&quot;rested1&quot;</span><span class="p">,</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos"> 521</span></a>            <span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos"> 522</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos"> 523</span></a>                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">week</span> <span class="o">==</span> <span class="n">week</span><span class="p">)</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">team2</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">rested</span><span class="p">),</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos"> 524</span></a>                <span class="s2">&quot;rested2&quot;</span><span class="p">,</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos"> 525</span></a>            <span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos"> 526</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">rested1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">rested1</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos"> 527</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">rested2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">rested2</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos"> 528</span></a>    
</span><span id="L-529"><a href="#L-529"><span class="linenos"> 529</span></a>    <span class="k">def</span> <span class="nf">add_elo_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qbelo</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos"> 530</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos"> 531</span></a><span class="sd">        Adds the necessary columns for elo projections throughout the schedule.</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos"> 532</span></a>
</span><span id="L-533"><a href="#L-533"><span class="linenos"> 533</span></a><span class="sd">        Args:</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos"> 534</span></a><span class="sd">            qbelo (bool, optional): whether to infer QB elo values, defaults to False.</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos"> 535</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos"> 536</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="p">[[</span><span class="s1">&#39;elo1_pre&#39;</span><span class="p">,</span><span class="s1">&#39;elo2_pre&#39;</span><span class="p">,</span><span class="s1">&#39;elo1_post&#39;</span><span class="p">,</span><span class="s1">&#39;elo2_post&#39;</span><span class="p">,</span><span class="s1">&#39;elo_diff&#39;</span><span class="p">,</span>\
</span><span id="L-537"><a href="#L-537"><span class="linenos"> 537</span></a>        <span class="s1">&#39;point_spread&#39;</span><span class="p">,</span><span class="s1">&#39;elo_prob1&#39;</span><span class="p">,</span><span class="s1">&#39;elo_prob2&#39;</span><span class="p">,</span><span class="s1">&#39;score_diff&#39;</span><span class="p">,</span><span class="s1">&#39;forecast_delta&#39;</span><span class="p">,</span>\
</span><span id="L-538"><a href="#L-538"><span class="linenos"> 538</span></a>        <span class="s1">&#39;mov_multiplier&#39;</span><span class="p">,</span><span class="s1">&#39;elo_delta&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos"> 539</span></a>        <span class="k">if</span> <span class="n">qbelo</span><span class="p">:</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos"> 540</span></a>            <span class="n">qb_elos</span> <span class="o">=</span> <span class="n">get_qb_elos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">season</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">season</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos"> 541</span></a>            <span class="k">for</span> <span class="n">team_num</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="s1">&#39;2&#39;</span><span class="p">]:</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos"> 542</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="p">,</span><span class="n">right</span><span class="o">=</span><span class="n">qb_elos</span>\
</span><span id="L-543"><a href="#L-543"><span class="linenos"> 543</span></a>                <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;game_id&#39;</span><span class="p">:</span><span class="s1">&#39;boxscore_abbrev&#39;</span><span class="p">,</span><span class="s1">&#39;team&#39;</span><span class="p">:</span><span class="s1">&#39;team</span><span class="si">{}</span><span class="s1">_abbrev&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">team_num</span><span class="p">),</span>\
</span><span id="L-544"><a href="#L-544"><span class="linenos"> 544</span></a>                <span class="s1">&#39;player&#39;</span><span class="p">:</span><span class="s1">&#39;qb&#39;</span> <span class="o">+</span> <span class="n">team_num</span><span class="p">,</span><span class="s1">&#39;team_qbvalue_avg&#39;</span><span class="p">:</span><span class="s1">&#39;team</span><span class="si">{}</span><span class="s1">_qbvalue_avg&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">team_num</span><span class="p">),</span>\
</span><span id="L-545"><a href="#L-545"><span class="linenos"> 545</span></a>                <span class="s1">&#39;opp_qbvalue_avg&#39;</span><span class="p">:</span><span class="s1">&#39;opp</span><span class="si">{}</span><span class="s1">_qbvalue_avg&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">team_num</span><span class="p">),</span>\
</span><span id="L-546"><a href="#L-546"><span class="linenos"> 546</span></a>                <span class="s1">&#39;qb_value_pre&#39;</span><span class="p">:</span><span class="s1">&#39;qb</span><span class="si">{}</span><span class="s1">_value_pre&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">team_num</span><span class="p">),</span><span class="s1">&#39;qb_adj&#39;</span><span class="p">:</span><span class="s1">&#39;qb</span><span class="si">{}</span><span class="s1">_adj&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">team_num</span><span class="p">),</span>\
</span><span id="L-547"><a href="#L-547"><span class="linenos"> 547</span></a>                <span class="s1">&#39;qb_value_post&#39;</span><span class="p">:</span><span class="s1">&#39;qb</span><span class="si">{}</span><span class="s1">_value_post&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">team_num</span><span class="p">),</span><span class="s1">&#39;VALUE&#39;</span><span class="p">:</span><span class="s1">&#39;VALUE</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">team_num</span><span class="p">)}),</span>\
</span><span id="L-548"><a href="#L-548"><span class="linenos"> 548</span></a>                <span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;boxscore_abbrev&#39;</span><span class="p">,</span><span class="s1">&#39;team</span><span class="si">{}</span><span class="s1">_abbrev&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">team_num</span><span class="p">)])</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos"> 549</span></a>            <span class="c1"># Need to pull depth charts to extrapolate future qbelo values... Ignoring this for now...</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos"> 550</span></a>
</span><span id="L-551"><a href="#L-551"><span class="linenos"> 551</span></a>    <span class="k">def</span> <span class="nf">next_init_elo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">init_elo</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1300.0</span><span class="p">,</span> <span class="n">regress_pct</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.333</span><span class="p">):</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos"> 552</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos"> 553</span></a><span class="sd">        Identifies the next matchup that does not have complete elo projections </span>
</span><span id="L-554"><a href="#L-554"><span class="linenos"> 554</span></a><span class="sd">        and calculates each team&#39;s starting elo rating based on 538&#39;s model (#RIP).</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos"> 555</span></a>
</span><span id="L-556"><a href="#L-556"><span class="linenos"> 556</span></a><span class="sd">        Args:</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos"> 557</span></a><span class="sd">            init_elo (float, optional): initial elo rating to provide new teams with, defaults to 1300.</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos"> 558</span></a><span class="sd">            regress_pct (float, optional): percentage to regress teams back to the mean between each season, defaults to 0.333.</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos"> 559</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos"> 560</span></a>        <span class="n">ind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">elo1_pre</span><span class="o">.</span><span class="n">isnull</span><span class="p">()]</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos"> 561</span></a>        <span class="k">for</span> <span class="n">team_num</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="s1">&#39;2&#39;</span><span class="p">]:</span>
</span><span id="L-562"><a href="#L-562"><span class="linenos"> 562</span></a>            <span class="n">team</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;team</span><span class="si">{}</span><span class="s1">_abbrev&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">team_num</span><span class="p">)]</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos"> 563</span></a>            <span class="n">prev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">ind</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos"> 564</span></a>            <span class="n">prev</span> <span class="o">=</span> <span class="n">prev</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">prev</span><span class="o">.</span><span class="n">team1_abbrev</span> <span class="o">==</span> <span class="n">team</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">prev</span><span class="o">.</span><span class="n">team2_abbrev</span> <span class="o">==</span> <span class="n">team</span><span class="p">)]</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos"> 565</span></a>            <span class="k">if</span> <span class="n">prev</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos"> 566</span></a>                <span class="c1"># Team already exists</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos"> 567</span></a>                <span class="n">prev</span> <span class="o">=</span> <span class="n">prev</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos"> 568</span></a>                <span class="n">prev_num</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">prev</span><span class="p">[</span><span class="s1">&#39;team1_abbrev&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">team</span> <span class="k">else</span> <span class="mi">2</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos"> 569</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">prev</span><span class="p">[</span><span class="s1">&#39;elo</span><span class="si">{}</span><span class="s1">_post&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">prev_num</span><span class="p">)]):</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos"> 570</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo</span><span class="si">{}</span><span class="s1">_pre&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">team_num</span><span class="p">)]</span> <span class="o">=</span> <span class="n">prev</span><span class="p">[</span><span class="s1">&#39;elo</span><span class="si">{}</span><span class="s1">_post&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">prev_num</span><span class="p">)]</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos"> 571</span></a>                    <span class="k">if</span> <span class="n">prev</span><span class="p">[</span><span class="s1">&#39;season&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;season&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-572"><a href="#L-572"><span class="linenos"> 572</span></a>                        <span class="c1"># Start of a new season</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos"> 573</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo</span><span class="si">{}</span><span class="s1">_pre&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">team_num</span><span class="p">)]</span> <span class="o">+=</span> <span class="p">(</span><span class="mi">1505</span> <span class="o">-</span> <span class="n">prev</span><span class="p">[</span><span class="s1">&#39;elo</span><span class="si">{}</span><span class="s1">_post&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">prev_num</span><span class="p">)])</span><span class="o">*</span><span class="n">regress_pct</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos"> 574</span></a>                    <span class="k">elif</span> <span class="n">prev</span><span class="p">[</span><span class="s1">&#39;season&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;season&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos"> 575</span></a>                        <span class="c1"># Resurrected teams (e.g. 1999 Cleveland Browns)</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos"> 576</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo</span><span class="si">{}</span><span class="s1">_pre&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">team_num</span><span class="p">)]</span> <span class="o">=</span> <span class="n">init_elo</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos"> 577</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos"> 578</span></a>                    <span class="c1"># Game hasn&#39;t been played yet...</span>
</span><span id="L-579"><a href="#L-579"><span class="linenos"> 579</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo</span><span class="si">{}</span><span class="s1">_pre&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">team_num</span><span class="p">)]</span> <span class="o">=</span> <span class="n">prev</span><span class="p">[</span><span class="s1">&#39;elo</span><span class="si">{}</span><span class="s1">_pre&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">prev_num</span><span class="p">)]</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos"> 580</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos"> 581</span></a>                <span class="c1"># New Team</span>
</span><span id="L-582"><a href="#L-582"><span class="linenos"> 582</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo</span><span class="si">{}</span><span class="s1">_pre&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">team_num</span><span class="p">)]</span> <span class="o">=</span> <span class="n">init_elo</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos"> 583</span></a>            <span class="k">if</span> <span class="s1">&#39;qb</span><span class="si">{}</span><span class="s1">_adj&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">team_num</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos"> 584</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;qbelo</span><span class="si">{}</span><span class="s1">_pre&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">team_num</span><span class="p">)]</span> <span class="o">=</span> \
</span><span id="L-585"><a href="#L-585"><span class="linenos"> 585</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo</span><span class="si">{}</span><span class="s1">_pre&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">team_num</span><span class="p">)]</span> <span class="o">+</span> \
</span><span id="L-586"><a href="#L-586"><span class="linenos"> 586</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;qb</span><span class="si">{}</span><span class="s1">_adj&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">team_num</span><span class="p">)]</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos"> 587</span></a>    
</span><span id="L-588"><a href="#L-588"><span class="linenos"> 588</span></a>    <span class="k">def</span> <span class="nf">next_elo_prob</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">homefield</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">48.0</span><span class="p">,</span> <span class="n">travel</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.004</span><span class="p">,</span> <span class="n">rested</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">25.0</span><span class="p">,</span> <span class="n">playoffs</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.2</span><span class="p">,</span> <span class="n">elo2points</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.04</span><span class="p">):</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos"> 589</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos"> 590</span></a><span class="sd">        Identifies the next matchup that does not have complete elo projections </span>
</span><span id="L-591"><a href="#L-591"><span class="linenos"> 591</span></a><span class="sd">        and calculates each team&#39;s win probability based on 538&#39;s model (#RIP).</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos"> 592</span></a>
</span><span id="L-593"><a href="#L-593"><span class="linenos"> 593</span></a><span class="sd">        Args:</span>
</span><span id="L-594"><a href="#L-594"><span class="linenos"> 594</span></a><span class="sd">            homefield (float, optional): elo rating boost for home-field advantage, defaults to 48.</span>
</span><span id="L-595"><a href="#L-595"><span class="linenos"> 595</span></a><span class="sd">            travel (float, optional): elo rating penalty for travel, defaults to 0.004 per mile traveled.</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos"> 596</span></a><span class="sd">            rested (float, optional): elo rating boost for rested teams, defaults to 25.</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos"> 597</span></a><span class="sd">            playoffs (float, optional): elo rating expansion in the playoffs, defaults to 1.2.</span>
</span><span id="L-598"><a href="#L-598"><span class="linenos"> 598</span></a><span class="sd">            elo2points (float, optional): conversion rate between elo and points, defaults to 0.04.</span>
</span><span id="L-599"><a href="#L-599"><span class="linenos"> 599</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-600"><a href="#L-600"><span class="linenos"> 600</span></a>        <span class="n">ind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">elo_prob1</span><span class="o">.</span><span class="n">isnull</span><span class="p">()]</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-601"><a href="#L-601"><span class="linenos"> 601</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo_diff&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo1_pre&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo2_pre&#39;</span><span class="p">]</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos"> 602</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo_diff&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">homefield</span> <span class="c1"># Homefield advantage</span>
</span><span id="L-603"><a href="#L-603"><span class="linenos"> 603</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo_diff&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">travel</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;travel2&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;travel1&#39;</span><span class="p">])</span> <span class="c1"># Travel</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos"> 604</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;rested1&#39;</span><span class="p">]:</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos"> 605</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo_diff&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">rested</span> <span class="c1"># Bye week</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos"> 606</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;rested2&#39;</span><span class="p">]:</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos"> 607</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo_diff&#39;</span><span class="p">]</span> <span class="o">-=</span> <span class="n">rested</span> <span class="c1"># Bye week</span>
</span><span id="L-608"><a href="#L-608"><span class="linenos"> 608</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;week_num&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isnumeric</span><span class="p">():</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos"> 609</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo_diff&#39;</span><span class="p">]</span> <span class="o">*=</span> <span class="n">playoffs</span> <span class="c1"># Playoffs</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos"> 610</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;point_spread&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo_diff&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">elo2points</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos"> 611</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo_prob1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo_diff&#39;</span><span class="p">]</span><span class="o">/-</span><span class="mi">400</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-612"><a href="#L-612"><span class="linenos"> 612</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo_prob2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo_prob1&#39;</span><span class="p">]</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos"> 613</span></a>        <span class="k">if</span> <span class="s1">&#39;qb1_adj&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="s1">&#39;qb2_adj&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="L-614"><a href="#L-614"><span class="linenos"> 614</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;qbelo_diff&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo_diff&#39;</span><span class="p">]</span> <span class="o">+</span> \
</span><span id="L-615"><a href="#L-615"><span class="linenos"> 615</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;qb1_adj&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;qb2_adj&#39;</span><span class="p">]</span>
</span><span id="L-616"><a href="#L-616"><span class="linenos"> 616</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;qbpoint_spread&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;qbelo_diff&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">elo2points</span>
</span><span id="L-617"><a href="#L-617"><span class="linenos"> 617</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;qbelo_prob1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;qbelo_diff&#39;</span><span class="p">]</span><span class="o">/-</span><span class="mi">400</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-618"><a href="#L-618"><span class="linenos"> 618</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;qbelo_prob2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;qbelo_prob1&#39;</span><span class="p">]</span>
</span><span id="L-619"><a href="#L-619"><span class="linenos"> 619</span></a>
</span><span id="L-620"><a href="#L-620"><span class="linenos"> 620</span></a>    <span class="k">def</span> <span class="nf">next_elo_delta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k_factor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">20.0</span><span class="p">):</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos"> 621</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos"> 622</span></a><span class="sd">        Identifies the next matchup that does not have complete elo projections </span>
</span><span id="L-623"><a href="#L-623"><span class="linenos"> 623</span></a><span class="sd">        and calculates each team&#39;s new elo rating based on the results of that game.</span>
</span><span id="L-624"><a href="#L-624"><span class="linenos"> 624</span></a>
</span><span id="L-625"><a href="#L-625"><span class="linenos"> 625</span></a><span class="sd">        Args:</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos"> 626</span></a><span class="sd">            k_factor (float, optional): scaling factor that dictates how much ratings should shift based on recent results, defaults to 20.</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos"> 627</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-628"><a href="#L-628"><span class="linenos"> 628</span></a>        <span class="n">ind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">elo_prob1</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">elo_delta</span><span class="o">.</span><span class="n">isnull</span><span class="p">()]</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-629"><a href="#L-629"><span class="linenos"> 629</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;score1&#39;</span><span class="p">]):</span>
</span><span id="L-630"><a href="#L-630"><span class="linenos"> 630</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;score_diff&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;score1&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;score2&#39;</span><span class="p">]</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos"> 631</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;forecast_delta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;score_diff&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> \
</span><span id="L-632"><a href="#L-632"><span class="linenos"> 632</span></a>            <span class="mf">0.5</span><span class="o">*</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;score_diff&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo_prob1&#39;</span><span class="p">]</span>
</span><span id="L-633"><a href="#L-633"><span class="linenos"> 633</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;mov_multiplier&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;score_diff&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mf">2.2</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo_diff&#39;</span><span class="p">]</span><span class="o">*</span><span class="mf">0.001</span> <span class="o">+</span> <span class="mf">2.2</span><span class="p">)</span>
</span><span id="L-634"><a href="#L-634"><span class="linenos"> 634</span></a>            <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;mov_multiplier&#39;</span><span class="p">]):</span>
</span><span id="L-635"><a href="#L-635"><span class="linenos"> 635</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;mov_multiplier&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-636"><a href="#L-636"><span class="linenos"> 636</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo_delta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;forecast_delta&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;mov_multiplier&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">k_factor</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos"> 637</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo1_post&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo1_pre&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo_delta&#39;</span><span class="p">]</span>
</span><span id="L-638"><a href="#L-638"><span class="linenos"> 638</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo2_post&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo2_pre&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo_delta&#39;</span><span class="p">]</span>
</span><span id="L-639"><a href="#L-639"><span class="linenos"> 639</span></a>
</span><span id="L-640"><a href="#L-640"><span class="linenos"> 640</span></a>
</span><span id="L-641"><a href="#L-641"><span class="linenos"> 641</span></a><span class="k">class</span> <span class="nc">Boxscore</span><span class="p">:</span>
</span><span id="L-642"><a href="#L-642"><span class="linenos"> 642</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-643"><a href="#L-643"><span class="linenos"> 643</span></a><span class="sd">    Boxscore class that gathers all relevant statistics for the game in question</span>
</span><span id="L-644"><a href="#L-644"><span class="linenos"> 644</span></a><span class="sd">    and parses them into a pandas dataframe.</span>
</span><span id="L-645"><a href="#L-645"><span class="linenos"> 645</span></a>
</span><span id="L-646"><a href="#L-646"><span class="linenos"> 646</span></a><span class="sd">    Attributes:</span>
</span><span id="L-647"><a href="#L-647"><span class="linenos"> 647</span></a><span class="sd">        game_id: unique SportsRef identifier for the game in question.</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos"> 648</span></a><span class="sd">        raw_text: raw html for the Pro Football Reference page of the game in question.</span>
</span><span id="L-649"><a href="#L-649"><span class="linenos"> 649</span></a><span class="sd">        season: season of the game in question.</span>
</span><span id="L-650"><a href="#L-650"><span class="linenos"> 650</span></a><span class="sd">        week: week of the season for the game in question.</span>
</span><span id="L-651"><a href="#L-651"><span class="linenos"> 651</span></a><span class="sd">        team1_abbrev: abbreviation for the home team.</span>
</span><span id="L-652"><a href="#L-652"><span class="linenos"> 652</span></a><span class="sd">        team1_score: points scored by the home team.</span>
</span><span id="L-653"><a href="#L-653"><span class="linenos"> 653</span></a><span class="sd">        team2_abbrev: abbreviation for the away team.</span>
</span><span id="L-654"><a href="#L-654"><span class="linenos"> 654</span></a><span class="sd">        team2_score: points scored by the away team.</span>
</span><span id="L-655"><a href="#L-655"><span class="linenos"> 655</span></a><span class="sd">        game_stats: dataframe containing relevant statistics for the game in question.</span>
</span><span id="L-656"><a href="#L-656"><span class="linenos"> 656</span></a><span class="sd">        starters: dataframe containing the list of starting players for both teams.</span>
</span><span id="L-657"><a href="#L-657"><span class="linenos"> 657</span></a><span class="sd">        snaps: dataframe containing the number of snaps played by every player on both teams.</span>
</span><span id="L-658"><a href="#L-658"><span class="linenos"> 658</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-659"><a href="#L-659"><span class="linenos"> 659</span></a>
</span><span id="L-660"><a href="#L-660"><span class="linenos"> 660</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">game_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-661"><a href="#L-661"><span class="linenos"> 661</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-662"><a href="#L-662"><span class="linenos"> 662</span></a><span class="sd">        Initializes a Boxscore object using the parameters provided and class functions defined below.</span>
</span><span id="L-663"><a href="#L-663"><span class="linenos"> 663</span></a>
</span><span id="L-664"><a href="#L-664"><span class="linenos"> 664</span></a><span class="sd">        Args:</span>
</span><span id="L-665"><a href="#L-665"><span class="linenos"> 665</span></a><span class="sd">            game_id (str): unique SportsRef identifier for the game in question.</span>
</span><span id="L-666"><a href="#L-666"><span class="linenos"> 666</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-667"><a href="#L-667"><span class="linenos"> 667</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">game_id</span> <span class="o">=</span> <span class="n">game_id</span>
</span><span id="L-668"><a href="#L-668"><span class="linenos"> 668</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">get_raw_text</span><span class="p">()</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos"> 669</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">get_details</span><span class="p">()</span>
</span><span id="L-670"><a href="#L-670"><span class="linenos"> 670</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">get_stats</span><span class="p">()</span>
</span><span id="L-671"><a href="#L-671"><span class="linenos"> 671</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">get_advanced_stats</span><span class="p">()</span>
</span><span id="L-672"><a href="#L-672"><span class="linenos"> 672</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">get_starters</span><span class="p">()</span>
</span><span id="L-673"><a href="#L-673"><span class="linenos"> 673</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">get_snap_counts</span><span class="p">()</span>
</span><span id="L-674"><a href="#L-674"><span class="linenos"> 674</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_depth_chart</span><span class="p">()</span>
</span><span id="L-675"><a href="#L-675"><span class="linenos"> 675</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_qb_value</span><span class="p">()</span>
</span><span id="L-676"><a href="#L-676"><span class="linenos"> 676</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">normalize_team_names</span><span class="p">()</span>
</span><span id="L-677"><a href="#L-677"><span class="linenos"> 677</span></a>
</span><span id="L-678"><a href="#L-678"><span class="linenos"> 678</span></a>    <span class="k">def</span> <span class="nf">get_raw_text</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-679"><a href="#L-679"><span class="linenos"> 679</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-680"><a href="#L-680"><span class="linenos"> 680</span></a><span class="sd">        Pulls down the raw html from Pro Football Reference containing the statistics for the game in question.</span>
</span><span id="L-681"><a href="#L-681"><span class="linenos"> 681</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-682"><a href="#L-682"><span class="linenos"> 682</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">raw_text</span> <span class="o">=</span> <span class="n">get_page</span><span class="p">(</span><span class="s2">&quot;boxscores/</span><span class="si">{}</span><span class="s2">.htm&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">game_id</span><span class="p">))</span>
</span><span id="L-683"><a href="#L-683"><span class="linenos"> 683</span></a>
</span><span id="L-684"><a href="#L-684"><span class="linenos"> 684</span></a>    <span class="k">def</span> <span class="nf">get_details</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-685"><a href="#L-685"><span class="linenos"> 685</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-686"><a href="#L-686"><span class="linenos"> 686</span></a><span class="sd">        Extracts the overarching details for the game in question, specifically the season, week, score, and teams involved.</span>
</span><span id="L-687"><a href="#L-687"><span class="linenos"> 687</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-688"><a href="#L-688"><span class="linenos"> 688</span></a>        <span class="n">season_week</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_text</span><span class="o">.</span><span class="n">find</span><span class="p">(</span>
</span><span id="L-689"><a href="#L-689"><span class="linenos"> 689</span></a>            <span class="s2">&quot;div&quot;</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;game_summaries compressed&quot;</span><span class="p">}</span>
</span><span id="L-690"><a href="#L-690"><span class="linenos"> 690</span></a>        <span class="p">)</span>
</span><span id="L-691"><a href="#L-691"><span class="linenos"> 691</span></a>        <span class="n">season_week</span> <span class="o">=</span> <span class="n">season_week</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;href&quot;</span><span class="p">]</span>
</span><span id="L-692"><a href="#L-692"><span class="linenos"> 692</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">season</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">season_week</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
</span><span id="L-693"><a href="#L-693"><span class="linenos"> 693</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">week</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">season_week</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-694"><a href="#L-694"><span class="linenos"> 694</span></a>        <span class="n">home_scores</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_text</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span>
</span><span id="L-695"><a href="#L-695"><span class="linenos"> 695</span></a>            <span class="p">[</span><span class="s2">&quot;th&quot;</span><span class="p">,</span><span class="s2">&quot;td&quot;</span><span class="p">],</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;data-stat&quot;</span><span class="p">:</span> <span class="s2">&quot;home_team_score&quot;</span><span class="p">}</span>
</span><span id="L-696"><a href="#L-696"><span class="linenos"> 696</span></a>        <span class="p">)</span>
</span><span id="L-697"><a href="#L-697"><span class="linenos"> 697</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">team1_abbrev</span> <span class="o">=</span> <span class="n">home_scores</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span>
</span><span id="L-698"><a href="#L-698"><span class="linenos"> 698</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">team1_score</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">home_scores</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span><span id="L-699"><a href="#L-699"><span class="linenos"> 699</span></a>        <span class="n">away_scores</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_text</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span>
</span><span id="L-700"><a href="#L-700"><span class="linenos"> 700</span></a>            <span class="p">[</span><span class="s2">&quot;th&quot;</span><span class="p">,</span><span class="s2">&quot;td&quot;</span><span class="p">],</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;data-stat&quot;</span><span class="p">:</span> <span class="s2">&quot;vis_team_score&quot;</span><span class="p">}</span>
</span><span id="L-701"><a href="#L-701"><span class="linenos"> 701</span></a>        <span class="p">)</span>
</span><span id="L-702"><a href="#L-702"><span class="linenos"> 702</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">team2_abbrev</span> <span class="o">=</span> <span class="n">away_scores</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span>
</span><span id="L-703"><a href="#L-703"><span class="linenos"> 703</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">team2_score</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">away_scores</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span><span id="L-704"><a href="#L-704"><span class="linenos"> 704</span></a>
</span><span id="L-705"><a href="#L-705"><span class="linenos"> 705</span></a>    <span class="k">def</span> <span class="nf">get_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-706"><a href="#L-706"><span class="linenos"> 706</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-707"><a href="#L-707"><span class="linenos"> 707</span></a><span class="sd">        Extracts the basic offensive, defensive, and special teams stats </span>
</span><span id="L-708"><a href="#L-708"><span class="linenos"> 708</span></a><span class="sd">        from the raw html for the game in question.</span>
</span><span id="L-709"><a href="#L-709"><span class="linenos"> 709</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-710"><a href="#L-710"><span class="linenos"> 710</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
</span><span id="L-711"><a href="#L-711"><span class="linenos"> 711</span></a>            <span class="p">[</span>
</span><span id="L-712"><a href="#L-712"><span class="linenos"> 712</span></a>                <span class="n">parse_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raw_text</span><span class="p">,</span> <span class="s2">&quot;player_offense&quot;</span><span class="p">),</span>
</span><span id="L-713"><a href="#L-713"><span class="linenos"> 713</span></a>                <span class="n">parse_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raw_text</span><span class="p">,</span> <span class="s2">&quot;player_defense&quot;</span><span class="p">),</span>
</span><span id="L-714"><a href="#L-714"><span class="linenos"> 714</span></a>                <span class="n">parse_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raw_text</span><span class="p">,</span> <span class="s2">&quot;kicking&quot;</span><span class="p">),</span>
</span><span id="L-715"><a href="#L-715"><span class="linenos"> 715</span></a>            <span class="p">]</span>
</span><span id="L-716"><a href="#L-716"><span class="linenos"> 716</span></a>        <span class="p">)</span>
</span><span id="L-717"><a href="#L-717"><span class="linenos"> 717</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_text</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;returns&quot;</span><span class="p">):</span>
</span><span id="L-718"><a href="#L-718"><span class="linenos"> 718</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
</span><span id="L-719"><a href="#L-719"><span class="linenos"> 719</span></a>                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span><span class="p">,</span> <span class="n">parse_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raw_text</span><span class="p">,</span> <span class="s2">&quot;returns&quot;</span><span class="p">)]</span>
</span><span id="L-720"><a href="#L-720"><span class="linenos"> 720</span></a>            <span class="p">)</span>
</span><span id="L-721"><a href="#L-721"><span class="linenos"> 721</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-722"><a href="#L-722"><span class="linenos"> 722</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="L-723"><a href="#L-723"><span class="linenos"> 723</span></a>            <span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;player&quot;</span><span class="p">,</span> <span class="s2">&quot;player_id&quot;</span><span class="p">,</span> <span class="s2">&quot;team&quot;</span><span class="p">])</span>
</span><span id="L-724"><a href="#L-724"><span class="linenos"> 724</span></a>            <span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</span><span id="L-725"><a href="#L-725"><span class="linenos"> 725</span></a>            <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="L-726"><a href="#L-726"><span class="linenos"> 726</span></a>        <span class="p">)</span>
</span><span id="L-727"><a href="#L-727"><span class="linenos"> 727</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-728"><a href="#L-728"><span class="linenos"> 728</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span><span class="o">.</span><span class="n">team</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">team1_abbrev</span><span class="p">,</span> <span class="s2">&quot;opponent&quot;</span>
</span><span id="L-729"><a href="#L-729"><span class="linenos"> 729</span></a>        <span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">team2_abbrev</span>
</span><span id="L-730"><a href="#L-730"><span class="linenos"> 730</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-731"><a href="#L-731"><span class="linenos"> 731</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span><span class="o">.</span><span class="n">team</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">team2_abbrev</span><span class="p">,</span> <span class="s2">&quot;opponent&quot;</span>
</span><span id="L-732"><a href="#L-732"><span class="linenos"> 732</span></a>        <span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">team1_abbrev</span>
</span><span id="L-733"><a href="#L-733"><span class="linenos"> 733</span></a>
</span><span id="L-734"><a href="#L-734"><span class="linenos"> 734</span></a>    <span class="k">def</span> <span class="nf">get_advanced_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-735"><a href="#L-735"><span class="linenos"> 735</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-736"><a href="#L-736"><span class="linenos"> 736</span></a><span class="sd">        Extracts the advanced offensive, defensive, and special teams stats </span>
</span><span id="L-737"><a href="#L-737"><span class="linenos"> 737</span></a><span class="sd">        from the raw html for the game in question (e.g. first downs).</span>
</span><span id="L-738"><a href="#L-738"><span class="linenos"> 738</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-739"><a href="#L-739"><span class="linenos"> 739</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_text</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;passing_advanced&quot;</span><span class="p">):</span>
</span><span id="L-740"><a href="#L-740"><span class="linenos"> 740</span></a>            <span class="n">advanced</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
</span><span id="L-741"><a href="#L-741"><span class="linenos"> 741</span></a>                <span class="p">[</span>
</span><span id="L-742"><a href="#L-742"><span class="linenos"> 742</span></a>                    <span class="n">parse_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raw_text</span><span class="p">,</span> <span class="s2">&quot;passing_advanced&quot;</span><span class="p">),</span>
</span><span id="L-743"><a href="#L-743"><span class="linenos"> 743</span></a>                    <span class="n">parse_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raw_text</span><span class="p">,</span> <span class="s2">&quot;rushing_advanced&quot;</span><span class="p">),</span>
</span><span id="L-744"><a href="#L-744"><span class="linenos"> 744</span></a>                    <span class="n">parse_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raw_text</span><span class="p">,</span> <span class="s2">&quot;receiving_advanced&quot;</span><span class="p">),</span>
</span><span id="L-745"><a href="#L-745"><span class="linenos"> 745</span></a>                <span class="p">]</span>
</span><span id="L-746"><a href="#L-746"><span class="linenos"> 746</span></a>            <span class="p">)</span>
</span><span id="L-747"><a href="#L-747"><span class="linenos"> 747</span></a>            <span class="n">advanced</span> <span class="o">=</span> <span class="n">advanced</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;player&quot;</span><span class="p">,</span> <span class="s2">&quot;player_id&quot;</span><span class="p">,</span> <span class="s2">&quot;team&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="L-748"><a href="#L-748"><span class="linenos"> 748</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-749"><a href="#L-749"><span class="linenos"> 749</span></a>            <span class="n">advanced</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;player_id&#39;</span><span class="p">,</span><span class="s1">&#39;pass_first_down&#39;</span><span class="p">,</span><span class="s1">&#39;rush_first_down&#39;</span><span class="p">,</span><span class="s1">&#39;rec_first_down&#39;</span><span class="p">])</span>
</span><span id="L-750"><a href="#L-750"><span class="linenos"> 750</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span><span class="p">,</span><span class="n">right</span><span class="o">=</span><span class="n">advanced</span><span class="p">[[</span><span class="s1">&#39;player_id&#39;</span><span class="p">,</span>\
</span><span id="L-751"><a href="#L-751"><span class="linenos"> 751</span></a>        <span class="s1">&#39;pass_first_down&#39;</span><span class="p">,</span><span class="s1">&#39;rush_first_down&#39;</span><span class="p">,</span><span class="s1">&#39;rec_first_down&#39;</span><span class="p">]],</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="s1">&#39;player_id&#39;</span><span class="p">)</span>
</span><span id="L-752"><a href="#L-752"><span class="linenos"> 752</span></a>        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;pass_first_down&#39;</span><span class="p">,</span><span class="s1">&#39;rush_first_down&#39;</span><span class="p">,</span><span class="s1">&#39;rec_first_down&#39;</span><span class="p">]:</span>
</span><span id="L-753"><a href="#L-753"><span class="linenos"> 753</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="L-754"><a href="#L-754"><span class="linenos"> 754</span></a>
</span><span id="L-755"><a href="#L-755"><span class="linenos"> 755</span></a>    <span class="k">def</span> <span class="nf">get_starters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-756"><a href="#L-756"><span class="linenos"> 756</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-757"><a href="#L-757"><span class="linenos"> 757</span></a><span class="sd">        Extracts the intended starters for each team in the game in question.</span>
</span><span id="L-758"><a href="#L-758"><span class="linenos"> 758</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-759"><a href="#L-759"><span class="linenos"> 759</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">starters</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
</span><span id="L-760"><a href="#L-760"><span class="linenos"> 760</span></a>            <span class="p">[</span>
</span><span id="L-761"><a href="#L-761"><span class="linenos"> 761</span></a>                <span class="n">parse_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raw_text</span><span class="p">,</span> <span class="s2">&quot;home_starters&quot;</span><span class="p">),</span>
</span><span id="L-762"><a href="#L-762"><span class="linenos"> 762</span></a>                <span class="n">parse_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raw_text</span><span class="p">,</span> <span class="s2">&quot;vis_starters&quot;</span><span class="p">),</span>
</span><span id="L-763"><a href="#L-763"><span class="linenos"> 763</span></a>            <span class="p">]</span>
</span><span id="L-764"><a href="#L-764"><span class="linenos"> 764</span></a>        <span class="p">)</span>
</span><span id="L-765"><a href="#L-765"><span class="linenos"> 765</span></a>
</span><span id="L-766"><a href="#L-766"><span class="linenos"> 766</span></a>    <span class="k">def</span> <span class="nf">get_snap_counts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-767"><a href="#L-767"><span class="linenos"> 767</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-768"><a href="#L-768"><span class="linenos"> 768</span></a><span class="sd">        Extracts the actual snap counts for all players on each team in the game in question.</span>
</span><span id="L-769"><a href="#L-769"><span class="linenos"> 769</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-770"><a href="#L-770"><span class="linenos"> 770</span></a>        <span class="c1"># Games before 2012 don&#39;t have snapcounts and therefore no positions for non-starters...</span>
</span><span id="L-771"><a href="#L-771"><span class="linenos"> 771</span></a>        <span class="c1"># Could merge position in via the get_names function...</span>
</span><span id="L-772"><a href="#L-772"><span class="linenos"> 772</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_text</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;home_snap_counts&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> \
</span><span id="L-773"><a href="#L-773"><span class="linenos"> 773</span></a>        <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_text</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;vis_snap_counts&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-774"><a href="#L-774"><span class="linenos"> 774</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">snaps</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
</span><span id="L-775"><a href="#L-775"><span class="linenos"> 775</span></a>                <span class="p">[</span>
</span><span id="L-776"><a href="#L-776"><span class="linenos"> 776</span></a>                    <span class="n">parse_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raw_text</span><span class="p">,</span> <span class="s2">&quot;home_snap_counts&quot;</span><span class="p">),</span>
</span><span id="L-777"><a href="#L-777"><span class="linenos"> 777</span></a>                    <span class="n">parse_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raw_text</span><span class="p">,</span> <span class="s2">&quot;vis_snap_counts&quot;</span><span class="p">),</span>
</span><span id="L-778"><a href="#L-778"><span class="linenos"> 778</span></a>                <span class="p">]</span>
</span><span id="L-779"><a href="#L-779"><span class="linenos"> 779</span></a>            <span class="p">)</span>
</span><span id="L-780"><a href="#L-780"><span class="linenos"> 780</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-781"><a href="#L-781"><span class="linenos"> 781</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">snaps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span><span class="p">[[</span><span class="s2">&quot;player&quot;</span><span class="p">,</span> <span class="s2">&quot;player_id&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-782"><a href="#L-782"><span class="linenos"> 782</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">snaps</span><span class="p">[[</span><span class="s2">&quot;off_pct&quot;</span><span class="p">,</span><span class="s2">&quot;def_pct&quot;</span><span class="p">,</span><span class="s2">&quot;st_pct&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-783"><a href="#L-783"><span class="linenos"> 783</span></a>
</span><span id="L-784"><a href="#L-784"><span class="linenos"> 784</span></a>    <span class="k">def</span> <span class="nf">add_depth_chart</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-785"><a href="#L-785"><span class="linenos"> 785</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-786"><a href="#L-786"><span class="linenos"> 786</span></a><span class="sd">        Infers actual depth chart based on available depth charts/snap counts</span>
</span><span id="L-787"><a href="#L-787"><span class="linenos"> 787</span></a><span class="sd">        and merges it into the game_stats dataframe. </span>
</span><span id="L-788"><a href="#L-788"><span class="linenos"> 788</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-789"><a href="#L-789"><span class="linenos"> 789</span></a>        <span class="n">nonstarters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">snaps</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-790"><a href="#L-790"><span class="linenos"> 790</span></a>            <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">snaps</span><span class="o">.</span><span class="n">player_id</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">starters</span><span class="o">.</span><span class="n">player_id</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
</span><span id="L-791"><a href="#L-791"><span class="linenos"> 791</span></a>        <span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;off_pct&quot;</span><span class="p">,</span> <span class="s2">&quot;def_pct&quot;</span><span class="p">,</span> <span class="s2">&quot;st_pct&quot;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-792"><a href="#L-792"><span class="linenos"> 792</span></a>        <span class="n">depth_chart</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="L-793"><a href="#L-793"><span class="linenos"> 793</span></a>            <span class="n">left</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">starters</span><span class="o">.</span><span class="n">iloc</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">nonstarters</span><span class="p">]),</span>
</span><span id="L-794"><a href="#L-794"><span class="linenos"> 794</span></a>            <span class="n">right</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span><span class="p">[[</span><span class="s2">&quot;player&quot;</span><span class="p">,</span> <span class="s2">&quot;player_id&quot;</span><span class="p">,</span> <span class="s2">&quot;team&quot;</span><span class="p">]],</span>
</span><span id="L-795"><a href="#L-795"><span class="linenos"> 795</span></a>            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">,</span>
</span><span id="L-796"><a href="#L-796"><span class="linenos"> 796</span></a>            <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;player&quot;</span><span class="p">,</span> <span class="s2">&quot;player_id&quot;</span><span class="p">],</span>
</span><span id="L-797"><a href="#L-797"><span class="linenos"> 797</span></a>        <span class="p">)</span>
</span><span id="L-798"><a href="#L-798"><span class="linenos"> 798</span></a>        <span class="n">depth_chart</span><span class="p">[</span><span class="s2">&quot;dummy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-799"><a href="#L-799"><span class="linenos"> 799</span></a>        <span class="n">depth_chart</span><span class="p">[</span><span class="s2">&quot;string&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">depth_chart</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;team&quot;</span><span class="p">,</span> <span class="s2">&quot;pos&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">dummy</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span>
</span><span id="L-800"><a href="#L-800"><span class="linenos"> 800</span></a>            <span class="n">method</span><span class="o">=</span><span class="s2">&quot;first&quot;</span>
</span><span id="L-801"><a href="#L-801"><span class="linenos"> 801</span></a>        <span class="p">)</span>
</span><span id="L-802"><a href="#L-802"><span class="linenos"> 802</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="L-803"><a href="#L-803"><span class="linenos"> 803</span></a>            <span class="n">left</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span><span class="p">,</span>
</span><span id="L-804"><a href="#L-804"><span class="linenos"> 804</span></a>            <span class="n">right</span><span class="o">=</span><span class="n">depth_chart</span><span class="p">[[</span><span class="s2">&quot;player&quot;</span><span class="p">,</span> <span class="s2">&quot;player_id&quot;</span><span class="p">,</span> <span class="s2">&quot;team&quot;</span><span class="p">,</span> <span class="s2">&quot;pos&quot;</span><span class="p">,</span> <span class="s2">&quot;string&quot;</span><span class="p">]],</span>
</span><span id="L-805"><a href="#L-805"><span class="linenos"> 805</span></a>            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">,</span>
</span><span id="L-806"><a href="#L-806"><span class="linenos"> 806</span></a>            <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;player&quot;</span><span class="p">,</span> <span class="s2">&quot;player_id&quot;</span><span class="p">,</span> <span class="s2">&quot;team&quot;</span><span class="p">],</span>
</span><span id="L-807"><a href="#L-807"><span class="linenos"> 807</span></a>        <span class="p">)</span>
</span><span id="L-808"><a href="#L-808"><span class="linenos"> 808</span></a>    
</span><span id="L-809"><a href="#L-809"><span class="linenos"> 809</span></a>    <span class="k">def</span> <span class="nf">add_qb_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pass_att</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.2</span><span class="p">,</span> <span class="n">pass_cmp</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">3.7</span><span class="p">,</span> <span class="n">pass_yds</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span> 
</span><span id="L-810"><a href="#L-810"><span class="linenos"> 810</span></a>    <span class="n">pass_td</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">11.3</span><span class="p">,</span> <span class="n">pass_int</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="o">-</span><span class="mf">14.1</span><span class="p">,</span> <span class="n">pass_sacked</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="o">-</span><span class="mf">8.0</span><span class="p">,</span> <span class="n">rush_att</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.1</span><span class="p">,</span>
</span><span id="L-811"><a href="#L-811"><span class="linenos"> 811</span></a>    <span class="n">rush_yds</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.6</span><span class="p">,</span> <span class="n">rush_td</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">15.9</span><span class="p">):</span>
</span><span id="L-812"><a href="#L-812"><span class="linenos"> 812</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-813"><a href="#L-813"><span class="linenos"> 813</span></a><span class="sd">        Calculates individual QB elo value based on 538&#39;s model (#RIP).</span>
</span><span id="L-814"><a href="#L-814"><span class="linenos"> 814</span></a>
</span><span id="L-815"><a href="#L-815"><span class="linenos"> 815</span></a><span class="sd">        Args:</span>
</span><span id="L-816"><a href="#L-816"><span class="linenos"> 816</span></a><span class="sd">            pass_att (float, optional): weighting factor for pass attempts, defaults to -2.2.</span>
</span><span id="L-817"><a href="#L-817"><span class="linenos"> 817</span></a><span class="sd">            pass_cmp (float, optional): weighting factor for pass completions, defaults to 3.7.</span>
</span><span id="L-818"><a href="#L-818"><span class="linenos"> 818</span></a><span class="sd">            pass_yds (float, optional): weighting factor for passing yards, defaults to 0.2.</span>
</span><span id="L-819"><a href="#L-819"><span class="linenos"> 819</span></a><span class="sd">            pass_td (float, optional): weighting factor for passing touchdowns, defaults to 11.3.</span>
</span><span id="L-820"><a href="#L-820"><span class="linenos"> 820</span></a><span class="sd">            pass_sacked (float, optional): weighting factor for sacks, defaults to -8.0.</span>
</span><span id="L-821"><a href="#L-821"><span class="linenos"> 821</span></a><span class="sd">            rush_att (float, optional): weighting factor for rush attempts, defaults to -1.1.</span>
</span><span id="L-822"><a href="#L-822"><span class="linenos"> 822</span></a><span class="sd">            rush_yds (float, optional): weighting factor for rush yards, defaults to 0.6.</span>
</span><span id="L-823"><a href="#L-823"><span class="linenos"> 823</span></a><span class="sd">            rush_td (float, optional): weighting factor for rushing touchdowns, defaults to 15.9.</span>
</span><span id="L-824"><a href="#L-824"><span class="linenos"> 824</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-825"><a href="#L-825"><span class="linenos"> 825</span></a>        <span class="n">qbs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span><span class="o">.</span><span class="n">pos</span> <span class="o">==</span> <span class="s1">&#39;QB&#39;</span>
</span><span id="L-826"><a href="#L-826"><span class="linenos"> 826</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">qbs</span><span class="p">,</span><span class="s1">&#39;VALUE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pass_att</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">qbs</span><span class="p">,</span><span class="s1">&#39;pass_att&#39;</span><span class="p">]</span> \
</span><span id="L-827"><a href="#L-827"><span class="linenos"> 827</span></a>        <span class="o">+</span> <span class="n">pass_cmp</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">qbs</span><span class="p">,</span><span class="s1">&#39;pass_cmp&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">pass_yds</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">qbs</span><span class="p">,</span><span class="s1">&#39;pass_yds&#39;</span><span class="p">]</span> \
</span><span id="L-828"><a href="#L-828"><span class="linenos"> 828</span></a>        <span class="o">+</span> <span class="n">pass_td</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">qbs</span><span class="p">,</span><span class="s1">&#39;pass_td&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">pass_int</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">qbs</span><span class="p">,</span><span class="s1">&#39;pass_int&#39;</span><span class="p">]</span> \
</span><span id="L-829"><a href="#L-829"><span class="linenos"> 829</span></a>        <span class="o">+</span> <span class="n">pass_sacked</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">qbs</span><span class="p">,</span><span class="s1">&#39;pass_sacked&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">rush_att</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">qbs</span><span class="p">,</span><span class="s1">&#39;rush_att&#39;</span><span class="p">]</span> \
</span><span id="L-830"><a href="#L-830"><span class="linenos"> 830</span></a>        <span class="o">+</span> <span class="n">rush_yds</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">qbs</span><span class="p">,</span><span class="s1">&#39;rush_yds&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">rush_td</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">qbs</span><span class="p">,</span><span class="s1">&#39;rush_td&#39;</span><span class="p">]</span>
</span><span id="L-831"><a href="#L-831"><span class="linenos"> 831</span></a>
</span><span id="L-832"><a href="#L-832"><span class="linenos"> 832</span></a>    <span class="k">def</span> <span class="nf">normalize_team_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-833"><a href="#L-833"><span class="linenos"> 833</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-834"><a href="#L-834"><span class="linenos"> 834</span></a><span class="sd">        Normalizes team names between Pro Football Reference&#39;s boxscores and schedules.</span>
</span><span id="L-835"><a href="#L-835"><span class="linenos"> 835</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-836"><a href="#L-836"><span class="linenos"> 836</span></a>        <span class="n">abbrevs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;OAK&#39;</span><span class="p">:</span><span class="s1">&#39;RAI&#39;</span><span class="p">,</span><span class="s1">&#39;LVR&#39;</span><span class="p">:</span><span class="s1">&#39;RAI&#39;</span><span class="p">,</span><span class="s1">&#39;LAC&#39;</span><span class="p">:</span><span class="s1">&#39;SDG&#39;</span><span class="p">,</span><span class="s1">&#39;STL&#39;</span><span class="p">:</span><span class="s1">&#39;RAM&#39;</span><span class="p">,</span><span class="s1">&#39;LAR&#39;</span><span class="p">:</span><span class="s1">&#39;RAM&#39;</span><span class="p">,</span>\
</span><span id="L-837"><a href="#L-837"><span class="linenos"> 837</span></a>        <span class="s1">&#39;ARI&#39;</span><span class="p">:</span><span class="s1">&#39;CRD&#39;</span><span class="p">,</span><span class="s1">&#39;IND&#39;</span><span class="p">:</span><span class="s1">&#39;CLT&#39;</span><span class="p">,</span><span class="s1">&#39;BAL&#39;</span><span class="p">:</span><span class="s1">&#39;RAV&#39;</span><span class="p">,</span><span class="s1">&#39;HOU&#39;</span><span class="p">:</span><span class="s1">&#39;HTX&#39;</span><span class="p">,</span><span class="s1">&#39;TEN&#39;</span><span class="p">:</span><span class="s1">&#39;OTI&#39;</span><span class="p">}</span>
</span><span id="L-838"><a href="#L-838"><span class="linenos"> 838</span></a>        <span class="k">for</span> <span class="n">team</span> <span class="ow">in</span> <span class="n">abbrevs</span><span class="p">:</span>
</span><span id="L-839"><a href="#L-839"><span class="linenos"> 839</span></a>            <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;team&#39;</span><span class="p">,</span><span class="s1">&#39;opponent&#39;</span><span class="p">]:</span>
</span><span id="L-840"><a href="#L-840"><span class="linenos"> 840</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span><span class="p">[</span><span class="n">val</span><span class="p">]</span> <span class="o">==</span> <span class="n">team</span><span class="p">,</span><span class="n">val</span><span class="p">]</span> <span class="o">=</span> <span class="n">abbrevs</span><span class="p">[</span><span class="n">team</span><span class="p">]</span>
</span><span id="L-841"><a href="#L-841"><span class="linenos"> 841</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">team1_abbrev</span> <span class="ow">in</span> <span class="n">abbrevs</span><span class="p">:</span>
</span><span id="L-842"><a href="#L-842"><span class="linenos"> 842</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">team1_abbrev</span> <span class="o">=</span> <span class="n">abbrevs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">team1_abbrev</span><span class="p">]</span>
</span><span id="L-843"><a href="#L-843"><span class="linenos"> 843</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">team2_abbrev</span> <span class="ow">in</span> <span class="n">abbrevs</span><span class="p">:</span>
</span><span id="L-844"><a href="#L-844"><span class="linenos"> 844</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">team2_abbrev</span> <span class="o">=</span> <span class="n">abbrevs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">team2_abbrev</span><span class="p">]</span>
</span><span id="L-845"><a href="#L-845"><span class="linenos"> 845</span></a>
</span><span id="L-846"><a href="#L-846"><span class="linenos"> 846</span></a>
</span><span id="L-847"><a href="#L-847"><span class="linenos"> 847</span></a><span class="k">def</span> <span class="nf">get_bulk_stats</span><span class="p">(</span>
</span><span id="L-848"><a href="#L-848"><span class="linenos"> 848</span></a>    <span class="n">start_season</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-849"><a href="#L-849"><span class="linenos"> 849</span></a>    <span class="n">start_week</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-850"><a href="#L-850"><span class="linenos"> 850</span></a>    <span class="n">finish_season</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-851"><a href="#L-851"><span class="linenos"> 851</span></a>    <span class="n">finish_week</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-852"><a href="#L-852"><span class="linenos"> 852</span></a>    <span class="n">playoffs</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-853"><a href="#L-853"><span class="linenos"> 853</span></a>    <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-854"><a href="#L-854"><span class="linenos"> 854</span></a><span class="p">):</span>
</span><span id="L-855"><a href="#L-855"><span class="linenos"> 855</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-856"><a href="#L-856"><span class="linenos"> 856</span></a><span class="sd">    Pulls individual player statistics for each game in the specified timeframe from Pro Football Reference.</span>
</span><span id="L-857"><a href="#L-857"><span class="linenos"> 857</span></a>
</span><span id="L-858"><a href="#L-858"><span class="linenos"> 858</span></a><span class="sd">    Args:</span>
</span><span id="L-859"><a href="#L-859"><span class="linenos"> 859</span></a><span class="sd">        start_season (int): first season of interest.</span>
</span><span id="L-860"><a href="#L-860"><span class="linenos"> 860</span></a><span class="sd">        start_week (int): first week of interest.</span>
</span><span id="L-861"><a href="#L-861"><span class="linenos"> 861</span></a><span class="sd">        finish_season (int): last season of interest.</span>
</span><span id="L-862"><a href="#L-862"><span class="linenos"> 862</span></a><span class="sd">        finish_week (int): last week of interest.</span>
</span><span id="L-863"><a href="#L-863"><span class="linenos"> 863</span></a><span class="sd">        playoffs (bool, optional): whether to include playoff games, defaults to True.</span>
</span><span id="L-864"><a href="#L-864"><span class="linenos"> 864</span></a><span class="sd">        path(str, optional): file path where stats are/should be saved to, defaults to None.</span>
</span><span id="L-865"><a href="#L-865"><span class="linenos"> 865</span></a>
</span><span id="L-866"><a href="#L-866"><span class="linenos"> 866</span></a><span class="sd">    Returns:</span>
</span><span id="L-867"><a href="#L-867"><span class="linenos"> 867</span></a><span class="sd">        pd.DataFrame: dataframe containing player statistics for games during the timespan of interest.</span>
</span><span id="L-868"><a href="#L-868"><span class="linenos"> 868</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-869"><a href="#L-869"><span class="linenos"> 869</span></a>    <span class="n">s</span> <span class="o">=</span> <span class="n">Schedule</span><span class="p">(</span><span class="n">start_season</span><span class="p">,</span> <span class="n">finish_season</span><span class="p">,</span> <span class="n">playoffs</span><span class="p">)</span>
</span><span id="L-870"><a href="#L-870"><span class="linenos"> 870</span></a>    <span class="n">s</span><span class="o">.</span><span class="n">schedule</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-871"><a href="#L-871"><span class="linenos"> 871</span></a>        <span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">season</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="n">s</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">week</span> <span class="o">&gt;=</span> <span class="n">start_season</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="n">start_week</span><span class="p">)</span>
</span><span id="L-872"><a href="#L-872"><span class="linenos"> 872</span></a>        <span class="o">&amp;</span> <span class="p">(</span>
</span><span id="L-873"><a href="#L-873"><span class="linenos"> 873</span></a>            <span class="n">s</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">season</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="n">s</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">week</span>
</span><span id="L-874"><a href="#L-874"><span class="linenos"> 874</span></a>            <span class="o">&lt;=</span> <span class="n">finish_season</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="n">finish_week</span>
</span><span id="L-875"><a href="#L-875"><span class="linenos"> 875</span></a>        <span class="p">)</span>
</span><span id="L-876"><a href="#L-876"><span class="linenos"> 876</span></a>        <span class="o">&amp;</span> <span class="o">~</span><span class="n">s</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">score1</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span>
</span><span id="L-877"><a href="#L-877"><span class="linenos"> 877</span></a>        <span class="o">&amp;</span> <span class="o">~</span><span class="n">s</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">score2</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span>
</span><span id="L-878"><a href="#L-878"><span class="linenos"> 878</span></a>    <span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-879"><a href="#L-879"><span class="linenos"> 879</span></a>    <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">path</span><span class="p">)):</span>
</span><span id="L-880"><a href="#L-880"><span class="linenos"> 880</span></a>        <span class="n">stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="L-881"><a href="#L-881"><span class="linenos"> 881</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-882"><a href="#L-882"><span class="linenos"> 882</span></a>        <span class="n">stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">,</span> <span class="s2">&quot;week&quot;</span><span class="p">,</span> <span class="s2">&quot;game_id&quot;</span><span class="p">])</span>
</span><span id="L-883"><a href="#L-883"><span class="linenos"> 883</span></a>    <span class="n">to_save</span> <span class="o">=</span> <span class="n">path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span><span class="o">~</span><span class="n">s</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">boxscore_abbrev</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">game_id</span><span class="o">.</span><span class="n">unique</span><span class="p">()))</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
</span><span id="L-884"><a href="#L-884"><span class="linenos"> 884</span></a>    <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="L-885"><a href="#L-885"><span class="linenos"> 885</span></a>        <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">ind</span><span class="p">][</span><span class="s2">&quot;boxscore_abbrev&quot;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stats</span><span class="o">.</span><span class="n">game_id</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
</span><span id="L-886"><a href="#L-886"><span class="linenos"> 886</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">ind</span><span class="p">][</span><span class="s2">&quot;boxscore_abbrev&quot;</span><span class="p">])</span>
</span><span id="L-887"><a href="#L-887"><span class="linenos"> 887</span></a>            <span class="n">b</span> <span class="o">=</span> <span class="n">Boxscore</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">ind</span><span class="p">][</span><span class="s2">&quot;boxscore_abbrev&quot;</span><span class="p">])</span>
</span><span id="L-888"><a href="#L-888"><span class="linenos"> 888</span></a>            <span class="n">stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">stats</span><span class="p">,</span> <span class="n">b</span><span class="o">.</span><span class="n">game_stats</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-889"><a href="#L-889"><span class="linenos"> 889</span></a>            <span class="n">stats</span><span class="o">.</span><span class="n">season</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">season</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">season</span><span class="p">)</span>
</span><span id="L-890"><a href="#L-890"><span class="linenos"> 890</span></a>            <span class="n">stats</span><span class="o">.</span><span class="n">week</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">week</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">week</span><span class="p">)</span>
</span><span id="L-891"><a href="#L-891"><span class="linenos"> 891</span></a>            <span class="n">stats</span><span class="o">.</span><span class="n">game_id</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">game_id</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">game_id</span><span class="p">)</span>
</span><span id="L-892"><a href="#L-892"><span class="linenos"> 892</span></a>            <span class="k">if</span> <span class="n">to_save</span> <span class="ow">and</span> <span class="n">b</span><span class="o">.</span><span class="n">season</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">season</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
</span><span id="L-893"><a href="#L-893"><span class="linenos"> 893</span></a>                <span class="n">stats</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-894"><a href="#L-894"><span class="linenos"> 894</span></a>    <span class="k">if</span> <span class="n">to_save</span><span class="p">:</span>
</span><span id="L-895"><a href="#L-895"><span class="linenos"> 895</span></a>        <span class="n">stats</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-896"><a href="#L-896"><span class="linenos"> 896</span></a>    <span class="n">stats</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">stats</span><span class="o">.</span><span class="n">game_id</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">boxscore_abbrev</span><span class="o">.</span><span class="n">tolist</span><span class="p">())]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-897"><a href="#L-897"><span class="linenos"> 897</span></a>    <span class="k">return</span> <span class="n">stats</span>
</span><span id="L-898"><a href="#L-898"><span class="linenos"> 898</span></a>
</span><span id="L-899"><a href="#L-899"><span class="linenos"> 899</span></a>
</span><span id="L-900"><a href="#L-900"><span class="linenos"> 900</span></a><span class="k">def</span> <span class="nf">get_draft</span><span class="p">(</span><span class="n">season</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="L-901"><a href="#L-901"><span class="linenos"> 901</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-902"><a href="#L-902"><span class="linenos"> 902</span></a><span class="sd">    Pulls NFL draft results for the specified season from Pro Football Reference.</span>
</span><span id="L-903"><a href="#L-903"><span class="linenos"> 903</span></a>
</span><span id="L-904"><a href="#L-904"><span class="linenos"> 904</span></a><span class="sd">    Args:</span>
</span><span id="L-905"><a href="#L-905"><span class="linenos"> 905</span></a><span class="sd">        season (int): season of interest.</span>
</span><span id="L-906"><a href="#L-906"><span class="linenos"> 906</span></a>
</span><span id="L-907"><a href="#L-907"><span class="linenos"> 907</span></a><span class="sd">    Returns:</span>
</span><span id="L-908"><a href="#L-908"><span class="linenos"> 908</span></a><span class="sd">        pd.DataFrame: dataframe containing draft results for the season of interest.</span>
</span><span id="L-909"><a href="#L-909"><span class="linenos"> 909</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-910"><a href="#L-910"><span class="linenos"> 910</span></a>    <span class="n">raw_text</span> <span class="o">=</span> <span class="n">get_page</span><span class="p">(</span><span class="s2">&quot;years/</span><span class="si">{}</span><span class="s2">/draft.htm&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">season</span><span class="p">))</span>
</span><span id="L-911"><a href="#L-911"><span class="linenos"> 911</span></a>    <span class="n">draft_order</span> <span class="o">=</span> <span class="n">parse_table</span><span class="p">(</span><span class="n">raw_text</span><span class="p">,</span> <span class="s2">&quot;drafts&quot;</span><span class="p">)</span>
</span><span id="L-912"><a href="#L-912"><span class="linenos"> 912</span></a>    <span class="k">return</span> <span class="n">draft_order</span>
</span><span id="L-913"><a href="#L-913"><span class="linenos"> 913</span></a>
</span><span id="L-914"><a href="#L-914"><span class="linenos"> 914</span></a>
</span><span id="L-915"><a href="#L-915"><span class="linenos"> 915</span></a><span class="k">def</span> <span class="nf">get_bulk_draft_pos</span><span class="p">(</span><span class="n">start_season</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">finish_season</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> \
</span><span id="L-916"><a href="#L-916"><span class="linenos"> 916</span></a><span class="n">best_qb_val</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">34.313</span><span class="p">,</span> <span class="n">qb_val_per_pick</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.137</span><span class="p">):</span>
</span><span id="L-917"><a href="#L-917"><span class="linenos"> 917</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-918"><a href="#L-918"><span class="linenos"> 918</span></a><span class="sd">    Pulls draft results for each season in the specified timeframe from Pro Football Reference</span>
</span><span id="L-919"><a href="#L-919"><span class="linenos"> 919</span></a><span class="sd">    and infers initial QB elo values from draft positions.</span>
</span><span id="L-920"><a href="#L-920"><span class="linenos"> 920</span></a>
</span><span id="L-921"><a href="#L-921"><span class="linenos"> 921</span></a><span class="sd">    Args:</span>
</span><span id="L-922"><a href="#L-922"><span class="linenos"> 922</span></a><span class="sd">        start_season (int): first season of interest.</span>
</span><span id="L-923"><a href="#L-923"><span class="linenos"> 923</span></a><span class="sd">        finish_season (int): last season of interest.</span>
</span><span id="L-924"><a href="#L-924"><span class="linenos"> 924</span></a><span class="sd">        path (str, optional): where to save the draft results in csv form, defaults to None.</span>
</span><span id="L-925"><a href="#L-925"><span class="linenos"> 925</span></a><span class="sd">        best_qb_val (float, optional): QB elo value assigned to a first overall pick, defaults to 34.313.</span>
</span><span id="L-926"><a href="#L-926"><span class="linenos"> 926</span></a><span class="sd">        qb_val_per_pick (float, optional): elo point decline per pick, defaults to -0.137.</span>
</span><span id="L-927"><a href="#L-927"><span class="linenos"> 927</span></a>
</span><span id="L-928"><a href="#L-928"><span class="linenos"> 928</span></a><span class="sd">    Returns:</span>
</span><span id="L-929"><a href="#L-929"><span class="linenos"> 929</span></a><span class="sd">        pd.DataFrame: dataframe containing all draft results over the timeframe of interest.</span>
</span><span id="L-930"><a href="#L-930"><span class="linenos"> 930</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-931"><a href="#L-931"><span class="linenos"> 931</span></a>    <span class="n">start_season</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">start_season</span><span class="p">)</span>
</span><span id="L-932"><a href="#L-932"><span class="linenos"> 932</span></a>    <span class="n">finish_season</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">finish_season</span><span class="p">)</span>
</span><span id="L-933"><a href="#L-933"><span class="linenos"> 933</span></a>    <span class="k">if</span> <span class="n">path</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">path</span><span class="p">)):</span>
</span><span id="L-934"><a href="#L-934"><span class="linenos"> 934</span></a>        <span class="n">draft_pos</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="L-935"><a href="#L-935"><span class="linenos"> 935</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-936"><a href="#L-936"><span class="linenos"> 936</span></a>        <span class="n">draft_pos</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">])</span>
</span><span id="L-937"><a href="#L-937"><span class="linenos"> 937</span></a>    <span class="n">new_drafts</span> <span class="o">=</span> <span class="nb">any</span><span class="p">([</span><span class="n">year</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">draft_pos</span><span class="o">.</span><span class="n">year</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span> <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_season</span><span class="p">,</span><span class="n">finish_season</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)])</span>
</span><span id="L-938"><a href="#L-938"><span class="linenos"> 938</span></a>    <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_season</span><span class="p">,</span><span class="n">finish_season</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="L-939"><a href="#L-939"><span class="linenos"> 939</span></a>        <span class="k">if</span> <span class="n">year</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">draft_pos</span><span class="o">.</span><span class="n">year</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
</span><span id="L-940"><a href="#L-940"><span class="linenos"> 940</span></a>            <span class="n">draft_pos</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">draft_pos</span><span class="p">,</span><span class="n">get_draft</span><span class="p">(</span><span class="n">year</span><span class="p">)],</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-941"><a href="#L-941"><span class="linenos"> 941</span></a>            <span class="n">draft_pos</span><span class="o">.</span><span class="n">year</span> <span class="o">=</span> <span class="n">draft_pos</span><span class="o">.</span><span class="n">year</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>
</span><span id="L-942"><a href="#L-942"><span class="linenos"> 942</span></a>    <span class="k">if</span> <span class="n">path</span> <span class="ow">and</span> <span class="n">new_drafts</span><span class="p">:</span>
</span><span id="L-943"><a href="#L-943"><span class="linenos"> 943</span></a>        <span class="n">draft_pos</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-944"><a href="#L-944"><span class="linenos"> 944</span></a>    <span class="n">draft_pos</span> <span class="o">=</span> <span class="n">draft_pos</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">draft_pos</span><span class="o">.</span><span class="n">year</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">start_season</span><span class="p">,</span><span class="n">finish_season</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)))]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-945"><a href="#L-945"><span class="linenos"> 945</span></a>    <span class="n">qbs</span> <span class="o">=</span> <span class="n">draft_pos</span><span class="o">.</span><span class="n">pos</span> <span class="o">==</span> <span class="s1">&#39;QB&#39;</span>
</span><span id="L-946"><a href="#L-946"><span class="linenos"> 946</span></a>    <span class="n">draft_pos</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">qbs</span><span class="p">,</span><span class="s1">&#39;qb_value_init&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">draft_pos</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">qbs</span><span class="p">,</span><span class="s1">&#39;draft_pick&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">qb_val_per_pick</span> <span class="o">+</span> <span class="n">best_qb_val</span>
</span><span id="L-947"><a href="#L-947"><span class="linenos"> 947</span></a>    <span class="k">return</span> <span class="n">draft_pos</span>
</span><span id="L-948"><a href="#L-948"><span class="linenos"> 948</span></a>
</span><span id="L-949"><a href="#L-949"><span class="linenos"> 949</span></a>
</span><span id="L-950"><a href="#L-950"><span class="linenos"> 950</span></a><span class="k">def</span> <span class="nf">get_roster</span><span class="p">(</span><span class="n">team</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">season</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="L-951"><a href="#L-951"><span class="linenos"> 951</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-952"><a href="#L-952"><span class="linenos"> 952</span></a><span class="sd">    Pulls the full team roster for the team and season of interest from Pro Football Reference.</span>
</span><span id="L-953"><a href="#L-953"><span class="linenos"> 953</span></a>
</span><span id="L-954"><a href="#L-954"><span class="linenos"> 954</span></a><span class="sd">    Args:</span>
</span><span id="L-955"><a href="#L-955"><span class="linenos"> 955</span></a><span class="sd">        team (str): abbreviation for the team of interest.</span>
</span><span id="L-956"><a href="#L-956"><span class="linenos"> 956</span></a><span class="sd">        season (int): season of interest.</span>
</span><span id="L-957"><a href="#L-957"><span class="linenos"> 957</span></a>
</span><span id="L-958"><a href="#L-958"><span class="linenos"> 958</span></a><span class="sd">    Returns:</span>
</span><span id="L-959"><a href="#L-959"><span class="linenos"> 959</span></a><span class="sd">        pd.DataFrame: dataframe containing identifying information for each player on the roster of interest.</span>
</span><span id="L-960"><a href="#L-960"><span class="linenos"> 960</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-961"><a href="#L-961"><span class="linenos"> 961</span></a>    <span class="n">raw_text</span> <span class="o">=</span> <span class="n">get_page</span><span class="p">(</span><span class="s2">&quot;teams/</span><span class="si">{}</span><span class="s2">/</span><span class="si">{}</span><span class="s2">_roster.htm&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">team</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span><span class="n">season</span><span class="p">))</span>
</span><span id="L-962"><a href="#L-962"><span class="linenos"> 962</span></a>    <span class="n">roster</span> <span class="o">=</span> <span class="n">parse_table</span><span class="p">(</span><span class="n">raw_text</span><span class="p">,</span> <span class="s2">&quot;roster&quot;</span><span class="p">)</span>
</span><span id="L-963"><a href="#L-963"><span class="linenos"> 963</span></a>    <span class="k">return</span> <span class="n">roster</span>
</span><span id="L-964"><a href="#L-964"><span class="linenos"> 964</span></a>
</span><span id="L-965"><a href="#L-965"><span class="linenos"> 965</span></a>
</span><span id="L-966"><a href="#L-966"><span class="linenos"> 966</span></a><span class="k">def</span> <span class="nf">get_bulk_rosters</span><span class="p">(</span><span class="n">start_season</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">finish_season</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-967"><a href="#L-967"><span class="linenos"> 967</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-968"><a href="#L-968"><span class="linenos"> 968</span></a><span class="sd">    Pulls all NFL rosters during the specified timeframe from Pro Football Reference.</span>
</span><span id="L-969"><a href="#L-969"><span class="linenos"> 969</span></a>
</span><span id="L-970"><a href="#L-970"><span class="linenos"> 970</span></a><span class="sd">    Args:</span>
</span><span id="L-971"><a href="#L-971"><span class="linenos"> 971</span></a><span class="sd">        start_season (int): first season of interest.</span>
</span><span id="L-972"><a href="#L-972"><span class="linenos"> 972</span></a><span class="sd">        finish_season (int): last season of interest.</span>
</span><span id="L-973"><a href="#L-973"><span class="linenos"> 973</span></a><span class="sd">        path (str, optional): where to save the rosters in csv form, defaults to None.</span>
</span><span id="L-974"><a href="#L-974"><span class="linenos"> 974</span></a>
</span><span id="L-975"><a href="#L-975"><span class="linenos"> 975</span></a><span class="sd">    Returns:</span>
</span><span id="L-976"><a href="#L-976"><span class="linenos"> 976</span></a><span class="sd">        pd.DataFrame: dataframe containing all rosters for the specified timeframe.</span>
</span><span id="L-977"><a href="#L-977"><span class="linenos"> 977</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-978"><a href="#L-978"><span class="linenos"> 978</span></a>    <span class="n">s</span> <span class="o">=</span> <span class="n">Schedule</span><span class="p">(</span><span class="n">start_season</span><span class="p">,</span><span class="n">finish_season</span><span class="p">)</span>
</span><span id="L-979"><a href="#L-979"><span class="linenos"> 979</span></a>    <span class="c1"># Need to delete and repull after every new week to account for trades, etc.</span>
</span><span id="L-980"><a href="#L-980"><span class="linenos"> 980</span></a>    <span class="k">if</span> <span class="n">path</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">path</span><span class="p">)):</span>
</span><span id="L-981"><a href="#L-981"><span class="linenos"> 981</span></a>        <span class="n">teams</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="L-982"><a href="#L-982"><span class="linenos"> 982</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-983"><a href="#L-983"><span class="linenos"> 983</span></a>        <span class="n">teams</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">])</span>
</span><span id="L-984"><a href="#L-984"><span class="linenos"> 984</span></a>    <span class="n">new_games</span> <span class="o">=</span> <span class="nb">any</span><span class="p">([</span><span class="n">season</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">teams</span><span class="o">.</span><span class="n">season</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span> <span class="k">for</span> <span class="n">season</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_season</span><span class="p">,</span><span class="n">finish_season</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)])</span>
</span><span id="L-985"><a href="#L-985"><span class="linenos"> 985</span></a>    <span class="k">for</span> <span class="n">season</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_season</span><span class="p">,</span><span class="n">finish_season</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="L-986"><a href="#L-986"><span class="linenos"> 986</span></a>        <span class="k">if</span> <span class="n">season</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">teams</span><span class="o">.</span><span class="n">season</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
</span><span id="L-987"><a href="#L-987"><span class="linenos"> 987</span></a>            <span class="k">for</span> <span class="n">team</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">season</span> <span class="o">==</span> <span class="n">season</span><span class="p">,</span><span class="s1">&#39;team1_abbrev&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
</span><span id="L-988"><a href="#L-988"><span class="linenos"> 988</span></a>                <span class="n">roster</span> <span class="o">=</span> <span class="n">get_roster</span><span class="p">(</span><span class="n">team</span><span class="p">,</span><span class="n">season</span><span class="p">)</span>
</span><span id="L-989"><a href="#L-989"><span class="linenos"> 989</span></a>                <span class="n">roster</span><span class="p">[</span><span class="s1">&#39;team&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">team</span>
</span><span id="L-990"><a href="#L-990"><span class="linenos"> 990</span></a>                <span class="n">roster</span><span class="p">[</span><span class="s1">&#39;season&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">season</span>
</span><span id="L-991"><a href="#L-991"><span class="linenos"> 991</span></a>                <span class="n">teams</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">teams</span><span class="p">,</span><span class="n">roster</span><span class="p">],</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-992"><a href="#L-992"><span class="linenos"> 992</span></a>    <span class="k">if</span> <span class="n">path</span> <span class="ow">and</span> <span class="p">(</span><span class="n">new_games</span> <span class="ow">or</span> <span class="n">finish_season</span> <span class="o">==</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">year</span><span class="p">):</span>
</span><span id="L-993"><a href="#L-993"><span class="linenos"> 993</span></a>        <span class="n">teams</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-994"><a href="#L-994"><span class="linenos"> 994</span></a>    <span class="n">teams</span><span class="o">.</span><span class="n">player</span> <span class="o">=</span> <span class="n">teams</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; (&#39;</span><span class="p">,</span><span class="n">regex</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-995"><a href="#L-995"><span class="linenos"> 995</span></a>    <span class="k">return</span> <span class="n">teams</span>
</span><span id="L-996"><a href="#L-996"><span class="linenos"> 996</span></a>
</span><span id="L-997"><a href="#L-997"><span class="linenos"> 997</span></a>
</span><span id="L-998"><a href="#L-998"><span class="linenos"> 998</span></a><span class="k">def</span> <span class="nf">get_qb_elos</span><span class="p">(</span><span class="n">start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">finish</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">regress_pct</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">,</span> 
</span><span id="L-999"><a href="#L-999"><span class="linenos"> 999</span></a><span class="n">qb_games</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">team_games</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span> <span class="n">elo_adj</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">3.3</span><span class="p">):</span>
</span><span id="L-1000"><a href="#L-1000"><span class="linenos">1000</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1001"><a href="#L-1001"><span class="linenos">1001</span></a><span class="sd">    Pulls QB-related statistics and calculates QB elo ratings as they progress over time.</span>
</span><span id="L-1002"><a href="#L-1002"><span class="linenos">1002</span></a>
</span><span id="L-1003"><a href="#L-1003"><span class="linenos">1003</span></a><span class="sd">    Args:</span>
</span><span id="L-1004"><a href="#L-1004"><span class="linenos">1004</span></a><span class="sd">        start (int): first season of interest.</span>
</span><span id="L-1005"><a href="#L-1005"><span class="linenos">1005</span></a><span class="sd">        finish (int): last season of interest.</span>
</span><span id="L-1006"><a href="#L-1006"><span class="linenos">1006</span></a><span class="sd">        regress_pct (float, optional): percentage to regress QBs back to the mean between each season, defaults to 0.25.</span>
</span><span id="L-1007"><a href="#L-1007"><span class="linenos">1007</span></a><span class="sd">        qb_games (int, optional): number of games to use in the rolling average for individual QB elos, defaults to 10.</span>
</span><span id="L-1008"><a href="#L-1008"><span class="linenos">1008</span></a><span class="sd">        team_games (int, optional): number of games to use in the rolling average for team QB elos, defaults to 20.</span>
</span><span id="L-1009"><a href="#L-1009"><span class="linenos">1009</span></a><span class="sd">        elo_adj (float, optional): conversion factor between QB rating and team elos, defaults to 3.3.</span>
</span><span id="L-1010"><a href="#L-1010"><span class="linenos">1010</span></a>
</span><span id="L-1011"><a href="#L-1011"><span class="linenos">1011</span></a><span class="sd">    Returns:</span>
</span><span id="L-1012"><a href="#L-1012"><span class="linenos">1012</span></a><span class="sd">        pd.DataFrame: dataframe containing QB statistics and elo ratings throughout the timeframe of interest.</span>
</span><span id="L-1013"><a href="#L-1013"><span class="linenos">1013</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1014"><a href="#L-1014"><span class="linenos">1014</span></a>    <span class="n">stats</span> <span class="o">=</span> <span class="n">get_bulk_stats</span><span class="p">(</span><span class="n">start</span> <span class="o">-</span> <span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">finish</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="s2">&quot;GameByGameFantasyFootballStats.csv&quot;</span><span class="p">)</span>
</span><span id="L-1015"><a href="#L-1015"><span class="linenos">1015</span></a>    <span class="k">if</span> <span class="n">finish</span> <span class="o">==</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">year</span> <span class="ow">and</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">month</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
</span><span id="L-1016"><a href="#L-1016"><span class="linenos">1016</span></a>        <span class="c1"># Accounting for current season</span>
</span><span id="L-1017"><a href="#L-1017"><span class="linenos">1017</span></a>        <span class="n">sched</span> <span class="o">=</span> <span class="n">Schedule</span><span class="p">(</span><span class="n">finish</span><span class="p">,</span><span class="n">finish</span><span class="p">)</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-1018"><a href="#L-1018"><span class="linenos">1018</span></a>        <span class="n">missing</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">sched</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sched</span><span class="o">.</span><span class="n">score1</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">sched</span><span class="o">.</span><span class="n">score2</span><span class="o">.</span><span class="n">isnull</span><span class="p">(),</span>\
</span><span id="L-1019"><a href="#L-1019"><span class="linenos">1019</span></a>        <span class="p">[</span><span class="s1">&#39;season&#39;</span><span class="p">,</span><span class="s1">&#39;week_num&#39;</span><span class="p">,</span><span class="s1">&#39;boxscore_abbrev&#39;</span><span class="p">,</span><span class="s1">&#39;team1_abbrev&#39;</span><span class="p">,</span><span class="s1">&#39;team2_abbrev&#39;</span><span class="p">]]</span>\
</span><span id="L-1020"><a href="#L-1020"><span class="linenos">1020</span></a>        <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;week_num&#39;</span><span class="p">:</span><span class="s1">&#39;week&#39;</span><span class="p">,</span><span class="s1">&#39;boxscore_abbrev&#39;</span><span class="p">:</span><span class="s1">&#39;game_id&#39;</span><span class="p">,</span><span class="s1">&#39;team1_abbrev&#39;</span><span class="p">:</span><span class="s1">&#39;team&#39;</span><span class="p">,</span><span class="s1">&#39;team2_abbrev&#39;</span><span class="p">:</span><span class="s1">&#39;opponent&#39;</span><span class="p">}),</span>\
</span><span id="L-1021"><a href="#L-1021"><span class="linenos">1021</span></a>        <span class="n">sched</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sched</span><span class="o">.</span><span class="n">score1</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">sched</span><span class="o">.</span><span class="n">score2</span><span class="o">.</span><span class="n">isnull</span><span class="p">(),[</span><span class="s1">&#39;season&#39;</span><span class="p">,</span><span class="s1">&#39;week_num&#39;</span><span class="p">,</span><span class="s1">&#39;boxscore_abbrev&#39;</span><span class="p">,</span><span class="s1">&#39;team2_abbrev&#39;</span><span class="p">,</span><span class="s1">&#39;team1_abbrev&#39;</span><span class="p">]]</span>\
</span><span id="L-1022"><a href="#L-1022"><span class="linenos">1022</span></a>        <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;week_num&#39;</span><span class="p">:</span><span class="s1">&#39;week&#39;</span><span class="p">,</span><span class="s1">&#39;boxscore_abbrev&#39;</span><span class="p">:</span><span class="s1">&#39;game_id&#39;</span><span class="p">,</span><span class="s1">&#39;team2_abbrev&#39;</span><span class="p">:</span><span class="s1">&#39;team&#39;</span><span class="p">,</span><span class="s1">&#39;team1_abbrev&#39;</span><span class="p">:</span><span class="s1">&#39;opponent&#39;</span><span class="p">})],</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1023"><a href="#L-1023"><span class="linenos">1023</span></a>        <span class="n">current</span> <span class="o">=</span> <span class="n">get_all_depth_charts</span><span class="p">()</span>
</span><span id="L-1024"><a href="#L-1024"><span class="linenos">1024</span></a>        <span class="n">current</span> <span class="o">=</span> <span class="n">current</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">current</span><span class="o">.</span><span class="n">pos</span> <span class="o">==</span> <span class="s1">&#39;QB&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">current</span><span class="o">.</span><span class="n">string</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">)]</span>
</span><span id="L-1025"><a href="#L-1025"><span class="linenos">1025</span></a>        <span class="n">missing</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">missing</span><span class="p">,</span><span class="n">right</span><span class="o">=</span><span class="n">current</span><span class="p">,</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="s1">&#39;team&#39;</span><span class="p">)</span>
</span><span id="L-1026"><a href="#L-1026"><span class="linenos">1026</span></a>        <span class="n">stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">stats</span><span class="p">,</span><span class="n">missing</span><span class="p">],</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1027"><a href="#L-1027"><span class="linenos">1027</span></a>    <span class="n">draft_pos</span> <span class="o">=</span> <span class="n">get_bulk_draft_pos</span><span class="p">(</span><span class="n">start</span> <span class="o">-</span> <span class="mi">10</span><span class="p">,</span><span class="n">finish</span><span class="p">,</span><span class="s2">&quot;NFLDraftPositions.csv&quot;</span><span class="p">)</span>
</span><span id="L-1028"><a href="#L-1028"><span class="linenos">1028</span></a>    <span class="n">prev_all</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">stats</span><span class="o">.</span><span class="n">season</span> <span class="o">&lt;</span> <span class="n">stats</span><span class="o">.</span><span class="n">season</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> \
</span><span id="L-1029"><a href="#L-1029"><span class="linenos">1029</span></a>    <span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">pos</span> <span class="o">==</span> <span class="s1">&#39;QB&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">string</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1030"><a href="#L-1030"><span class="linenos">1030</span></a>    <span class="n">by_opponent</span> <span class="o">=</span> <span class="n">prev_all</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;season&#39;</span><span class="p">,</span><span class="s1">&#39;week&#39;</span><span class="p">,</span><span class="s1">&#39;game_id&#39;</span><span class="p">,</span><span class="s1">&#39;opponent&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">VALUE</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="L-1031"><a href="#L-1031"><span class="linenos">1031</span></a>    <span class="n">by_opponent</span> <span class="o">=</span> <span class="n">by_opponent</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;season&#39;</span><span class="p">,</span><span class="s1">&#39;week&#39;</span><span class="p">],</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1032"><a href="#L-1032"><span class="linenos">1032</span></a>    <span class="n">by_opponent</span> <span class="o">=</span> <span class="n">by_opponent</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;opponent&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">team_games</span><span class="p">)</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;opponent&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">VALUE</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="L-1033"><a href="#L-1033"><span class="linenos">1033</span></a>    <span class="n">by_team</span> <span class="o">=</span> <span class="n">prev_all</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;season&#39;</span><span class="p">,</span><span class="s1">&#39;week&#39;</span><span class="p">,</span><span class="s1">&#39;game_id&#39;</span><span class="p">,</span><span class="s1">&#39;team&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">VALUE</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="L-1034"><a href="#L-1034"><span class="linenos">1034</span></a>    <span class="n">by_team</span> <span class="o">=</span> <span class="n">by_team</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;season&#39;</span><span class="p">,</span><span class="s1">&#39;week&#39;</span><span class="p">],</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1035"><a href="#L-1035"><span class="linenos">1035</span></a>    <span class="n">by_team</span> <span class="o">=</span> <span class="n">by_team</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;team&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">team_games</span><span class="p">)</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;team&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">VALUE</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="L-1036"><a href="#L-1036"><span class="linenos">1036</span></a>    <span class="n">new</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">stats</span><span class="o">.</span><span class="n">season</span> <span class="o">&gt;=</span> <span class="n">stats</span><span class="o">.</span><span class="n">season</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> \
</span><span id="L-1037"><a href="#L-1037"><span class="linenos">1037</span></a>    <span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">pos</span> <span class="o">==</span> <span class="s1">&#39;QB&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">string</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1038"><a href="#L-1038"><span class="linenos">1038</span></a>    <span class="n">new</span><span class="p">[</span><span class="s1">&#39;qb_value_pre&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-1039"><a href="#L-1039"><span class="linenos">1039</span></a>    <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">new</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="L-1040"><a href="#L-1040"><span class="linenos">1040</span></a>        <span class="n">avg_value</span> <span class="o">=</span> <span class="n">by_opponent</span><span class="o">.</span><span class="n">VALUE</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="L-1041"><a href="#L-1041"><span class="linenos">1041</span></a>        <span class="n">prev_qb</span> <span class="o">=</span> <span class="n">new</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">new</span><span class="o">.</span><span class="n">player</span> <span class="o">==</span> <span class="n">new</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;player&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">new</span><span class="o">.</span><span class="n">index</span> <span class="o">&lt;</span> <span class="n">ind</span><span class="p">)]</span>
</span><span id="L-1042"><a href="#L-1042"><span class="linenos">1042</span></a>        <span class="k">if</span> <span class="n">prev_qb</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1043"><a href="#L-1043"><span class="linenos">1043</span></a>            <span class="n">drafted</span> <span class="o">=</span> <span class="n">draft_pos</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">draft_pos</span><span class="o">.</span><span class="n">player</span> <span class="o">==</span> <span class="n">new</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;player&#39;</span><span class="p">]]</span>
</span><span id="L-1044"><a href="#L-1044"><span class="linenos">1044</span></a>            <span class="k">if</span> <span class="n">drafted</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1045"><a href="#L-1045"><span class="linenos">1045</span></a>                <span class="n">new</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;qb_value_pre&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">drafted</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">qb_value_init</span>
</span><span id="L-1046"><a href="#L-1046"><span class="linenos">1046</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1047"><a href="#L-1047"><span class="linenos">1047</span></a>                <span class="n">new</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;qb_value_pre&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-1048"><a href="#L-1048"><span class="linenos">1048</span></a>            <span class="n">new</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;num_games&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-1049"><a href="#L-1049"><span class="linenos">1049</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1050"><a href="#L-1050"><span class="linenos">1050</span></a>            <span class="n">new</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;qb_value_pre&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prev_qb</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;qb_value_post&#39;</span><span class="p">]</span>
</span><span id="L-1051"><a href="#L-1051"><span class="linenos">1051</span></a>            <span class="k">if</span> <span class="n">new</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;season&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">prev_qb</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;season&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">prev_qb</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">10</span> <span class="ow">and</span> <span class="n">prev_qb</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">100</span><span class="p">:</span>
</span><span id="L-1052"><a href="#L-1052"><span class="linenos">1052</span></a>                <span class="n">new</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;qb_value_pre&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">regress_pct</span><span class="p">)</span><span class="o">*</span><span class="n">new</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;qb_value_pre&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">regress_pct</span><span class="o">*</span><span class="n">avg_value</span>
</span><span id="L-1053"><a href="#L-1053"><span class="linenos">1053</span></a>            <span class="n">new</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;num_games&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prev_qb</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-1054"><a href="#L-1054"><span class="linenos">1054</span></a>        <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">new</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;VALUE&#39;</span><span class="p">]):</span>
</span><span id="L-1055"><a href="#L-1055"><span class="linenos">1055</span></a>            <span class="c1"># Game hasn&#39;t been played yet</span>
</span><span id="L-1056"><a href="#L-1056"><span class="linenos">1056</span></a>            <span class="n">new</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;qb_value_post&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;qb_value_pre&#39;</span><span class="p">]</span>
</span><span id="L-1057"><a href="#L-1057"><span class="linenos">1057</span></a>            <span class="n">new</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;team_qbvalue_avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">by_team</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">by_team</span><span class="o">.</span><span class="n">team</span> <span class="o">==</span> <span class="n">new</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;team&#39;</span><span class="p">],</span><span class="s1">&#39;VALUE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-1058"><a href="#L-1058"><span class="linenos">1058</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1059"><a href="#L-1059"><span class="linenos">1059</span></a>            <span class="n">new</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;team_qbvalue_avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">by_team</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">by_team</span><span class="o">.</span><span class="n">team</span> <span class="o">==</span> <span class="n">new</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;team&#39;</span><span class="p">],</span><span class="s1">&#39;VALUE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-1060"><a href="#L-1060"><span class="linenos">1060</span></a>            <span class="n">new</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;opp_qbvalue_avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">by_opponent</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">by_opponent</span><span class="o">.</span><span class="n">opponent</span> <span class="o">==</span> <span class="n">new</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;opponent&#39;</span><span class="p">],</span><span class="s1">&#39;VALUE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">avg_value</span>
</span><span id="L-1061"><a href="#L-1061"><span class="linenos">1061</span></a>            <span class="n">new</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;VALUE&#39;</span><span class="p">]</span> <span class="o">-=</span> <span class="n">new</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;opp_qbvalue_avg&#39;</span><span class="p">]</span>
</span><span id="L-1062"><a href="#L-1062"><span class="linenos">1062</span></a>            <span class="n">new</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;qb_value_post&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;qb_value_pre&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="n">qb_games</span><span class="p">)</span> <span class="o">+</span> <span class="n">new</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;VALUE&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">qb_games</span>
</span><span id="L-1063"><a href="#L-1063"><span class="linenos">1063</span></a>            <span class="n">by_opponent</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">by_opponent</span><span class="o">.</span><span class="n">opponent</span> <span class="o">==</span> <span class="n">new</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;opponent&#39;</span><span class="p">],</span><span class="s1">&#39;VALUE&#39;</span><span class="p">]</span> <span class="o">*=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="n">team_games</span><span class="p">)</span>
</span><span id="L-1064"><a href="#L-1064"><span class="linenos">1064</span></a>            <span class="n">by_opponent</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">by_opponent</span><span class="o">.</span><span class="n">opponent</span> <span class="o">==</span> <span class="n">new</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;opponent&#39;</span><span class="p">],</span><span class="s1">&#39;VALUE&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">new</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;VALUE&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">team_games</span>
</span><span id="L-1065"><a href="#L-1065"><span class="linenos">1065</span></a>            <span class="n">by_team</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">by_team</span><span class="o">.</span><span class="n">team</span> <span class="o">==</span> <span class="n">new</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;team&#39;</span><span class="p">],</span><span class="s1">&#39;VALUE&#39;</span><span class="p">]</span> <span class="o">*=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="n">team_games</span><span class="p">)</span>
</span><span id="L-1066"><a href="#L-1066"><span class="linenos">1066</span></a>            <span class="n">by_team</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">by_team</span><span class="o">.</span><span class="n">team</span> <span class="o">==</span> <span class="n">new</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;team&#39;</span><span class="p">],</span><span class="s1">&#39;VALUE&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">new</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;VALUE&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">team_games</span>
</span><span id="L-1067"><a href="#L-1067"><span class="linenos">1067</span></a>    <span class="n">new</span><span class="p">[</span><span class="s1">&#39;qb_adj&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">elo_adj</span><span class="o">*</span><span class="p">(</span><span class="n">new</span><span class="o">.</span><span class="n">qb_value_pre</span> <span class="o">-</span> <span class="n">new</span><span class="o">.</span><span class="n">team_qbvalue_avg</span><span class="p">)</span>
</span><span id="L-1068"><a href="#L-1068"><span class="linenos">1068</span></a>    <span class="k">return</span> <span class="n">new</span><span class="p">[[</span><span class="s1">&#39;game_id&#39;</span><span class="p">,</span><span class="s1">&#39;player&#39;</span><span class="p">,</span><span class="s1">&#39;team&#39;</span><span class="p">,</span><span class="s1">&#39;team_qbvalue_avg&#39;</span><span class="p">,</span>\
</span><span id="L-1069"><a href="#L-1069"><span class="linenos">1069</span></a>    <span class="s1">&#39;opp_qbvalue_avg&#39;</span><span class="p">,</span><span class="s1">&#39;qb_value_pre&#39;</span><span class="p">,</span><span class="s1">&#39;qb_adj&#39;</span><span class="p">,</span><span class="s1">&#39;qb_value_post&#39;</span><span class="p">,</span><span class="s1">&#39;VALUE&#39;</span><span class="p">]]</span>
</span><span id="L-1070"><a href="#L-1070"><span class="linenos">1070</span></a>
</span><span id="L-1071"><a href="#L-1071"><span class="linenos">1071</span></a>
</span><span id="L-1072"><a href="#L-1072"><span class="linenos">1072</span></a><span class="k">def</span> <span class="nf">get_names</span><span class="p">():</span>
</span><span id="L-1073"><a href="#L-1073"><span class="linenos">1073</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1074"><a href="#L-1074"><span class="linenos">1074</span></a><span class="sd">    Pulls the player id and name for every player on Pro Football Reference for conversion purposes.</span>
</span><span id="L-1075"><a href="#L-1075"><span class="linenos">1075</span></a>
</span><span id="L-1076"><a href="#L-1076"><span class="linenos">1076</span></a><span class="sd">    Returns:</span>
</span><span id="L-1077"><a href="#L-1077"><span class="linenos">1077</span></a><span class="sd">        pd.DataFrame: dataframe containing name, position,</span>
</span><span id="L-1078"><a href="#L-1078"><span class="linenos">1078</span></a><span class="sd">        player id, and timespan of every player in the database.</span>
</span><span id="L-1079"><a href="#L-1079"><span class="linenos">1079</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1080"><a href="#L-1080"><span class="linenos">1080</span></a>    <span class="n">names</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="L-1081"><a href="#L-1081"><span class="linenos">1081</span></a>    <span class="k">for</span> <span class="n">letter</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">65</span><span class="p">,</span> <span class="mi">91</span><span class="p">):</span>
</span><span id="L-1082"><a href="#L-1082"><span class="linenos">1082</span></a>        <span class="n">raw_text</span> <span class="o">=</span> <span class="n">get_page</span><span class="p">(</span><span class="s2">&quot;players/&quot;</span> <span class="o">+</span> <span class="nb">chr</span><span class="p">(</span><span class="n">letter</span><span class="p">))</span>
</span><span id="L-1083"><a href="#L-1083"><span class="linenos">1083</span></a>        <span class="n">players</span> <span class="o">=</span> <span class="n">raw_text</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;div_players&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">)</span>
</span><span id="L-1084"><a href="#L-1084"><span class="linenos">1084</span></a>        <span class="k">for</span> <span class="n">player</span> <span class="ow">in</span> <span class="n">players</span><span class="p">:</span>
</span><span id="L-1085"><a href="#L-1085"><span class="linenos">1085</span></a>            <span class="n">entry</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-1086"><a href="#L-1086"><span class="linenos">1086</span></a>                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">player</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
</span><span id="L-1087"><a href="#L-1087"><span class="linenos">1087</span></a>                <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">player</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="L-1088"><a href="#L-1088"><span class="linenos">1088</span></a>                <span class="s2">&quot;player_id&quot;</span><span class="p">:</span> <span class="n">player</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">)</span>
</span><span id="L-1089"><a href="#L-1089"><span class="linenos">1089</span></a>                <span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;href&quot;</span><span class="p">]</span>
</span><span id="L-1090"><a href="#L-1090"><span class="linenos">1090</span></a>                <span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-1091"><a href="#L-1091"><span class="linenos">1091</span></a>                <span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="L-1092"><a href="#L-1092"><span class="linenos">1092</span></a>                <span class="s2">&quot;years_active&quot;</span><span class="p">:</span> <span class="n">player</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;) &quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
</span><span id="L-1093"><a href="#L-1093"><span class="linenos">1093</span></a>            <span class="p">}</span>
</span><span id="L-1094"><a href="#L-1094"><span class="linenos">1094</span></a>            <span class="n">names</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">names</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="n">names</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]])])</span>
</span><span id="L-1095"><a href="#L-1095"><span class="linenos">1095</span></a>    <span class="k">return</span> <span class="n">names</span>
</span></pre></div>


            </section>
                <section id="base_url">
                    <div class="attr variable">
            <span class="name">base_url</span>        =
<span class="default_value">&#39;https://www.pro-football-reference.com/&#39;</span>

        
    </div>
    <a class="headerlink" href="#base_url"></a>
    
    

                </section>
                <section id="get_page">
                            <input id="get_page-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_page</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">endpoint</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="get_page-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#get_page"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="get_page-28"><a href="#get_page-28"><span class="linenos">28</span></a><span class="k">def</span> <span class="nf">get_page</span><span class="p">(</span><span class="n">endpoint</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="get_page-29"><a href="#get_page-29"><span class="linenos">29</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="get_page-30"><a href="#get_page-30"><span class="linenos">30</span></a><span class="sd">    Pulls down the raw html for the specified endpoint of Pro Football Reference</span>
</span><span id="get_page-31"><a href="#get_page-31"><span class="linenos">31</span></a><span class="sd">    and adds an additional four second delay to avoid triggering the 1hr jailtime</span>
</span><span id="get_page-32"><a href="#get_page-32"><span class="linenos">32</span></a><span class="sd">    for exceeding 20 requests per minute.</span>
</span><span id="get_page-33"><a href="#get_page-33"><span class="linenos">33</span></a>
</span><span id="get_page-34"><a href="#get_page-34"><span class="linenos">34</span></a><span class="sd">    Args:</span>
</span><span id="get_page-35"><a href="#get_page-35"><span class="linenos">35</span></a><span class="sd">        endpoint (str): relative location of the page to pull down.</span>
</span><span id="get_page-36"><a href="#get_page-36"><span class="linenos">36</span></a>
</span><span id="get_page-37"><a href="#get_page-37"><span class="linenos">37</span></a><span class="sd">    Returns:</span>
</span><span id="get_page-38"><a href="#get_page-38"><span class="linenos">38</span></a><span class="sd">        bs4.BeautifulSoup: parsed html of the specified endpoint.</span>
</span><span id="get_page-39"><a href="#get_page-39"><span class="linenos">39</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="get_page-40"><a href="#get_page-40"><span class="linenos">40</span></a>    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</span><span id="get_page-41"><a href="#get_page-41"><span class="linenos">41</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="get_page-42"><a href="#get_page-42"><span class="linenos">42</span></a>        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">base_url</span> <span class="o">+</span> <span class="n">endpoint</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
</span><span id="get_page-43"><a href="#get_page-43"><span class="linenos">43</span></a>    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ConnectionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="get_page-44"><a href="#get_page-44"><span class="linenos">44</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;GETTING CONNECTION ERROR AGAIN!!!&#39;</span><span class="p">)</span>
</span><span id="get_page-45"><a href="#get_page-45"><span class="linenos">45</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">endpoint</span><span class="p">)</span>
</span><span id="get_page-46"><a href="#get_page-46"><span class="linenos">46</span></a>        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="get_page-47"><a href="#get_page-47"><span class="linenos">47</span></a>    <span class="n">uncommented</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;!--&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;--&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="get_page-48"><a href="#get_page-48"><span class="linenos">48</span></a>    <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">uncommented</span><span class="p">,</span> <span class="s2">&quot;html.parser&quot;</span><span class="p">)</span>
</span><span id="get_page-49"><a href="#get_page-49"><span class="linenos">49</span></a>    <span class="k">return</span> <span class="n">soup</span>
</span></pre></div>


            <div class="docstring"><p>Pulls down the raw html for the specified endpoint of Pro Football Reference
and adds an additional four second delay to avoid triggering the 1hr jailtime
for exceeding 20 requests per minute.</p>

<p>Args:
    endpoint (str): relative location of the page to pull down.</p>

<p>Returns:
    bs4.BeautifulSoup: parsed html of the specified endpoint.</p>
</div>


                </section>
                <section id="parse_table">
                            <input id="parse_table-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">parse_table</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">raw_text</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="parse_table-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#parse_table"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="parse_table-52"><a href="#parse_table-52"><span class="linenos">52</span></a><span class="k">def</span> <span class="nf">parse_table</span><span class="p">(</span><span class="n">raw_text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="parse_table-53"><a href="#parse_table-53"><span class="linenos">53</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="parse_table-54"><a href="#parse_table-54"><span class="linenos">54</span></a><span class="sd">    Parses out the desired table from the raw html text into a pandas dataframe.</span>
</span><span id="parse_table-55"><a href="#parse_table-55"><span class="linenos">55</span></a>
</span><span id="parse_table-56"><a href="#parse_table-56"><span class="linenos">56</span></a><span class="sd">    Args:</span>
</span><span id="parse_table-57"><a href="#parse_table-57"><span class="linenos">57</span></a><span class="sd">        raw_text (bs4.BeautifulSoup): raw html from the page of interest.</span>
</span><span id="parse_table-58"><a href="#parse_table-58"><span class="linenos">58</span></a><span class="sd">        table_name (str): title of the table to extract.</span>
</span><span id="parse_table-59"><a href="#parse_table-59"><span class="linenos">59</span></a>
</span><span id="parse_table-60"><a href="#parse_table-60"><span class="linenos">60</span></a><span class="sd">    Returns:</span>
</span><span id="parse_table-61"><a href="#parse_table-61"><span class="linenos">61</span></a><span class="sd">        pd.DataFrame: dataframe containing the data from the specified table.</span>
</span><span id="parse_table-62"><a href="#parse_table-62"><span class="linenos">62</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="parse_table-63"><a href="#parse_table-63"><span class="linenos">63</span></a>    <span class="n">players</span> <span class="o">=</span> <span class="n">raw_text</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">table_name</span><span class="p">)</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s2">&quot;tr&quot;</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">})</span>
</span><span id="parse_table-64"><a href="#parse_table-64"><span class="linenos">64</span></a>    <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;data-stat&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">players</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s2">&quot;th&quot;</span><span class="p">)]</span>
</span><span id="parse_table-65"><a href="#parse_table-65"><span class="linenos">65</span></a>    <span class="n">stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="parse_table-66"><a href="#parse_table-66"><span class="linenos">66</span></a>    <span class="k">for</span> <span class="n">player</span> <span class="ow">in</span> <span class="n">players</span><span class="p">:</span>
</span><span id="parse_table-67"><a href="#parse_table-67"><span class="linenos">67</span></a>        <span class="k">if</span> <span class="n">player</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="s2">&quot;Playoffs&quot;</span><span class="p">:</span>
</span><span id="parse_table-68"><a href="#parse_table-68"><span class="linenos">68</span></a>            <span class="k">continue</span>
</span><span id="parse_table-69"><a href="#parse_table-69"><span class="linenos">69</span></a>        <span class="n">entry</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="parse_table-70"><a href="#parse_table-70"><span class="linenos">70</span></a>        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">:</span>
</span><span id="parse_table-71"><a href="#parse_table-71"><span class="linenos">71</span></a>            <span class="n">entry</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">player</span><span class="o">.</span><span class="n">find</span><span class="p">([</span><span class="s2">&quot;th&quot;</span><span class="p">,</span> <span class="s2">&quot;td&quot;</span><span class="p">],</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;data-stat&quot;</span><span class="p">:</span> <span class="n">col</span><span class="p">})</span>
</span><span id="parse_table-72"><a href="#parse_table-72"><span class="linenos">72</span></a>            <span class="k">if</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;boxscore_word&quot;</span><span class="p">,</span> <span class="s2">&quot;stadium_name&quot;</span><span class="p">]:</span>
</span><span id="parse_table-73"><a href="#parse_table-73"><span class="linenos">73</span></a>                <span class="n">abbrev</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">)</span>
</span><span id="parse_table-74"><a href="#parse_table-74"><span class="linenos">74</span></a>                <span class="k">if</span> <span class="n">abbrev</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="parse_table-75"><a href="#parse_table-75"><span class="linenos">75</span></a>                    <span class="n">new_col</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_abbrev&quot;</span>
</span><span id="parse_table-76"><a href="#parse_table-76"><span class="linenos">76</span></a>                    <span class="n">entry</span><span class="p">[</span><span class="n">new_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">abbrev</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;href&quot;</span><span class="p">]</span>
</span><span id="parse_table-77"><a href="#parse_table-77"><span class="linenos">77</span></a>                    <span class="n">entry</span><span class="p">[</span><span class="n">new_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="n">new_col</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="parse_table-78"><a href="#parse_table-78"><span class="linenos">78</span></a>            <span class="k">elif</span> <span class="n">col</span> <span class="o">==</span> <span class="s2">&quot;player&quot;</span> <span class="ow">and</span> <span class="s2">&quot;data-append-csv&quot;</span> <span class="ow">in</span> <span class="n">entry</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">:</span>
</span><span id="parse_table-79"><a href="#parse_table-79"><span class="linenos">79</span></a>                <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;player_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;data-append-csv&quot;</span><span class="p">]</span>
</span><span id="parse_table-80"><a href="#parse_table-80"><span class="linenos">80</span></a>            <span class="k">elif</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;winner&quot;</span><span class="p">,</span> <span class="s2">&quot;loser&quot;</span><span class="p">,</span> <span class="s2">&quot;home_team&quot;</span><span class="p">,</span> <span class="s2">&quot;visitor_team&quot;</span><span class="p">,</span><span class="s2">&quot;teams&quot;</span><span class="p">,</span><span class="s2">&quot;team&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">entry</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="parse_table-81"><a href="#parse_table-81"><span class="linenos">81</span></a>                <span class="n">entry</span><span class="p">[</span><span class="n">col</span> <span class="o">+</span> <span class="s2">&quot;_abbrev&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="parse_table-82"><a href="#parse_table-82"><span class="linenos">82</span></a>                    <span class="p">[</span><span class="n">team</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;href&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">team</span> <span class="ow">in</span> <span class="n">entry</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">)]</span>
</span><span id="parse_table-83"><a href="#parse_table-83"><span class="linenos">83</span></a>                <span class="p">)</span>
</span><span id="parse_table-84"><a href="#parse_table-84"><span class="linenos">84</span></a>            <span class="n">entry</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">text</span>
</span><span id="parse_table-85"><a href="#parse_table-85"><span class="linenos">85</span></a>        <span class="n">stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">stats</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="n">stats</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]])])</span>
</span><span id="parse_table-86"><a href="#parse_table-86"><span class="linenos">86</span></a>    <span class="n">stats</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="parse_table-87"><a href="#parse_table-87"><span class="linenos">87</span></a>    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">stats</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="parse_table-88"><a href="#parse_table-88"><span class="linenos">88</span></a>        <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_pct&quot;</span><span class="p">):</span>
</span><span id="parse_table-89"><a href="#parse_table-89"><span class="linenos">89</span></a>            <span class="n">stats</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">stats</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;%&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="parse_table-90"><a href="#parse_table-90"><span class="linenos">90</span></a>        <span class="n">stats</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">stats</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
</span><span id="parse_table-91"><a href="#parse_table-91"><span class="linenos">91</span></a>    <span class="k">return</span> <span class="n">stats</span>
</span></pre></div>


            <div class="docstring"><p>Parses out the desired table from the raw html text into a pandas dataframe.</p>

<p>Args:
    raw_text (bs4.BeautifulSoup): raw html from the page of interest.
    table_name (str): title of the table to extract.</p>

<p>Returns:
    pd.DataFrame: dataframe containing the data from the specified table.</p>
</div>


                </section>
                <section id="get_intl_games">
                            <input id="get_intl_games-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_intl_games</span><span class="signature pdoc-code condensed">(<span class="return-annotation">):</span></span>

                <label class="view-source-button" for="get_intl_games-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#get_intl_games"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="get_intl_games-94"><a href="#get_intl_games-94"><span class="linenos"> 94</span></a><span class="k">def</span> <span class="nf">get_intl_games</span><span class="p">():</span>
</span><span id="get_intl_games-95"><a href="#get_intl_games-95"><span class="linenos"> 95</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="get_intl_games-96"><a href="#get_intl_games-96"><span class="linenos"> 96</span></a><span class="sd">    Pulls details about the games in the NFL International Series (used in annotating neutral site games).</span>
</span><span id="get_intl_games-97"><a href="#get_intl_games-97"><span class="linenos"> 97</span></a>
</span><span id="get_intl_games-98"><a href="#get_intl_games-98"><span class="linenos"> 98</span></a><span class="sd">    Returns:</span>
</span><span id="get_intl_games-99"><a href="#get_intl_games-99"><span class="linenos"> 99</span></a><span class="sd">        pd.DataFrame: dataframe containing dates, teams, and scores for each matchup.</span>
</span><span id="get_intl_games-100"><a href="#get_intl_games-100"><span class="linenos">100</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="get_intl_games-101"><a href="#get_intl_games-101"><span class="linenos">101</span></a>    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="get_intl_games-102"><a href="#get_intl_games-102"><span class="linenos">102</span></a>        <span class="s2">&quot;https://en.wikipedia.org/wiki/NFL_International_Series&quot;</span>
</span><span id="get_intl_games-103"><a href="#get_intl_games-103"><span class="linenos">103</span></a>    <span class="p">)</span><span class="o">.</span><span class="n">text</span>
</span><span id="get_intl_games-104"><a href="#get_intl_games-104"><span class="linenos">104</span></a>    <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s2">&quot;html.parser&quot;</span><span class="p">)</span>
</span><span id="get_intl_games-105"><a href="#get_intl_games-105"><span class="linenos">105</span></a>    <span class="n">tables</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s2">&quot;table&quot;</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;wikitable sortable&quot;</span><span class="p">})[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="get_intl_games-106"><a href="#get_intl_games-106"><span class="linenos">106</span></a>    <span class="n">intl_games</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">tables</span><span class="p">)),</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="get_intl_games-107"><a href="#get_intl_games-107"><span class="linenos">107</span></a>    <span class="n">intl_games</span> <span class="o">=</span> <span class="n">intl_games</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">intl_games</span><span class="o">.</span><span class="n">Date</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">intl_games</span><span class="o">.</span><span class="n">Date</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;TBD&quot;</span><span class="p">])]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="get_intl_games-108"><a href="#get_intl_games-108"><span class="linenos">108</span></a>    <span class="n">intl_games</span><span class="o">.</span><span class="n">Year</span> <span class="o">=</span> <span class="n">intl_games</span><span class="o">.</span><span class="n">Year</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="get_intl_games-109"><a href="#get_intl_games-109"><span class="linenos">109</span></a>    <span class="n">intl_games</span><span class="p">[</span><span class="s2">&quot;team1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">intl_games</span><span class="p">[</span><span class="s2">&quot;Designated home team&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;\[&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="get_intl_games-110"><a href="#get_intl_games-110"><span class="linenos">110</span></a>    <span class="n">intl_games</span><span class="p">[</span><span class="s2">&quot;team2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">intl_games</span><span class="p">[</span><span class="s2">&quot;Designated visitor&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;\[&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="get_intl_games-111"><a href="#get_intl_games-111"><span class="linenos">111</span></a>    <span class="n">intl_games</span><span class="o">.</span><span class="n">Stadium</span> <span class="o">=</span> <span class="n">intl_games</span><span class="o">.</span><span class="n">Stadium</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;\[&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="get_intl_games-112"><a href="#get_intl_games-112"><span class="linenos">112</span></a>    <span class="n">intl_games</span><span class="p">[</span><span class="s2">&quot;game_date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">intl_games</span><span class="o">.</span><span class="n">Date</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="n">intl_games</span><span class="o">.</span><span class="n">Year</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">))</span>
</span><span id="get_intl_games-113"><a href="#get_intl_games-113"><span class="linenos">113</span></a>    <span class="k">return</span> <span class="n">intl_games</span><span class="p">[[</span><span class="s2">&quot;game_date&quot;</span><span class="p">,</span> <span class="s2">&quot;team1&quot;</span><span class="p">,</span> <span class="s2">&quot;team2&quot;</span><span class="p">,</span> <span class="s2">&quot;Stadium&quot;</span><span class="p">]]</span>
</span></pre></div>


            <div class="docstring"><p>Pulls details about the games in the NFL International Series (used in annotating neutral site games).</p>

<p>Returns:
    pd.DataFrame: dataframe containing dates, teams, and scores for each matchup.</p>
</div>


                </section>
                <section id="get_depth_chart">
                            <input id="get_depth_chart-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_depth_chart</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">team_abbrev</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="get_depth_chart-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#get_depth_chart"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="get_depth_chart-116"><a href="#get_depth_chart-116"><span class="linenos">116</span></a><span class="k">def</span> <span class="nf">get_depth_chart</span><span class="p">(</span><span class="n">team_abbrev</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="get_depth_chart-117"><a href="#get_depth_chart-117"><span class="linenos">117</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="get_depth_chart-118"><a href="#get_depth_chart-118"><span class="linenos">118</span></a><span class="sd">    Pulls the team depth chart directly from ESPN based on the team abbreviation provided.</span>
</span><span id="get_depth_chart-119"><a href="#get_depth_chart-119"><span class="linenos">119</span></a>
</span><span id="get_depth_chart-120"><a href="#get_depth_chart-120"><span class="linenos">120</span></a><span class="sd">    Args:</span>
</span><span id="get_depth_chart-121"><a href="#get_depth_chart-121"><span class="linenos">121</span></a><span class="sd">        team_abbrev (str): ESPN abbreviation for the team of interest.</span>
</span><span id="get_depth_chart-122"><a href="#get_depth_chart-122"><span class="linenos">122</span></a>
</span><span id="get_depth_chart-123"><a href="#get_depth_chart-123"><span class="linenos">123</span></a><span class="sd">    Returns:</span>
</span><span id="get_depth_chart-124"><a href="#get_depth_chart-124"><span class="linenos">124</span></a><span class="sd">        pd.DataFrame: dataframe containing the depth chart ranking for each player on the team of interest.</span>
</span><span id="get_depth_chart-125"><a href="#get_depth_chart-125"><span class="linenos">125</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="get_depth_chart-126"><a href="#get_depth_chart-126"><span class="linenos">126</span></a>    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;wget https://www.espn.com/nfl/team/depth/_/name/</span><span class="si">{}</span><span class="s2"> -q -O </span><span class="si">{}</span><span class="s2">.html&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">team_abbrev</span><span class="p">,</span><span class="n">team_abbrev</span><span class="p">))</span>
</span><span id="get_depth_chart-127"><a href="#get_depth_chart-127"><span class="linenos">127</span></a>    <span class="n">tempData</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">team_abbrev</span> <span class="o">+</span> <span class="s2">&quot;.html&quot;</span><span class="p">,</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
</span><span id="get_depth_chart-128"><a href="#get_depth_chart-128"><span class="linenos">128</span></a>    <span class="n">response</span> <span class="o">=</span> <span class="n">tempData</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="get_depth_chart-129"><a href="#get_depth_chart-129"><span class="linenos">129</span></a>    <span class="n">tempData</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="get_depth_chart-130"><a href="#get_depth_chart-130"><span class="linenos">130</span></a>    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">team_abbrev</span> <span class="o">+</span> <span class="s2">&quot;.html&quot;</span><span class="p">)</span>
</span><span id="get_depth_chart-131"><a href="#get_depth_chart-131"><span class="linenos">131</span></a>    <span class="c1"># Not working for some reason, some sort of CloudFront traffic error</span>
</span><span id="get_depth_chart-132"><a href="#get_depth_chart-132"><span class="linenos">132</span></a>    <span class="c1"># response = requests.get(&quot;https://www.espn.com/nfl/team/depth/_/name/{}&quot;.format(team_abbrev)).text</span>
</span><span id="get_depth_chart-133"><a href="#get_depth_chart-133"><span class="linenos">133</span></a>    <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s2">&quot;html.parser&quot;</span><span class="p">)</span>
</span><span id="get_depth_chart-134"><a href="#get_depth_chart-134"><span class="linenos">134</span></a>    <span class="n">tables</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;table&#39;</span><span class="p">)</span>
</span><span id="get_depth_chart-135"><a href="#get_depth_chart-135"><span class="linenos">135</span></a>    <span class="n">depth</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="get_depth_chart-136"><a href="#get_depth_chart-136"><span class="linenos">136</span></a>    <span class="k">for</span> <span class="n">table_ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tables</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">):</span>
</span><span id="get_depth_chart-137"><a href="#get_depth_chart-137"><span class="linenos">137</span></a>        <span class="n">positions</span> <span class="o">=</span> <span class="p">[</span><span class="n">pos</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">tables</span><span class="p">[</span><span class="n">table_ind</span><span class="o">*</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;td&#39;</span><span class="p">)]</span>
</span><span id="get_depth_chart-138"><a href="#get_depth_chart-138"><span class="linenos">138</span></a>        <span class="n">players</span> <span class="o">=</span> <span class="p">[</span><span class="n">player</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">player</span> <span class="ow">in</span> <span class="n">tables</span><span class="p">[</span><span class="n">table_ind</span><span class="o">*</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;td&#39;</span><span class="p">)]</span>
</span><span id="get_depth_chart-139"><a href="#get_depth_chart-139"><span class="linenos">139</span></a>        <span class="n">num_strings</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">players</span><span class="p">)</span><span class="o">//</span><span class="nb">len</span><span class="p">(</span><span class="n">positions</span><span class="p">)</span>
</span><span id="get_depth_chart-140"><a href="#get_depth_chart-140"><span class="linenos">140</span></a>        <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">positions</span><span class="p">)):</span>
</span><span id="get_depth_chart-141"><a href="#get_depth_chart-141"><span class="linenos">141</span></a>            <span class="k">for</span> <span class="n">string</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_strings</span><span class="p">):</span>
</span><span id="get_depth_chart-142"><a href="#get_depth_chart-142"><span class="linenos">142</span></a>                <span class="n">depth</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">depth</span><span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;player&#39;</span><span class="p">:[</span><span class="n">players</span><span class="p">[</span><span class="n">pos</span><span class="o">*</span><span class="n">num_strings</span> <span class="o">+</span> <span class="n">string</span><span class="p">]],</span>\
</span><span id="get_depth_chart-143"><a href="#get_depth_chart-143"><span class="linenos">143</span></a>                <span class="s1">&#39;pos&#39;</span><span class="p">:[</span><span class="n">positions</span><span class="p">[</span><span class="n">pos</span><span class="p">]],</span><span class="s1">&#39;string&#39;</span><span class="p">:[</span><span class="n">string</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]})],</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="get_depth_chart-144"><a href="#get_depth_chart-144"><span class="linenos">144</span></a>    <span class="n">depth</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">depth</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;PK&#39;</span><span class="p">]),</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;K&#39;</span>
</span><span id="get_depth_chart-145"><a href="#get_depth_chart-145"><span class="linenos">145</span></a>    <span class="n">wrs</span> <span class="o">=</span> <span class="n">depth</span><span class="o">.</span><span class="n">pos</span> <span class="o">==</span> <span class="s1">&#39;WR&#39;</span>
</span><span id="get_depth_chart-146"><a href="#get_depth_chart-146"><span class="linenos">146</span></a>    <span class="n">depth</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">wrs</span><span class="p">,</span><span class="s1">&#39;string&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">depth</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">wrs</span><span class="p">]</span><span class="o">.</span><span class="n">string</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">3</span>
</span><span id="get_depth_chart-147"><a href="#get_depth_chart-147"><span class="linenos">147</span></a>    <span class="n">depth</span> <span class="o">=</span> <span class="n">depth</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">depth</span><span class="o">.</span><span class="n">player</span> <span class="o">!=</span> <span class="s1">&#39;-&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="get_depth_chart-148"><a href="#get_depth_chart-148"><span class="linenos">148</span></a>    <span class="k">for</span> <span class="n">status</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">,</span><span class="s1">&#39;Q&#39;</span><span class="p">,</span><span class="s1">&#39;O&#39;</span><span class="p">,</span><span class="s1">&#39;PUP&#39;</span><span class="p">,</span><span class="s1">&#39;SUSP&#39;</span><span class="p">,</span><span class="s1">&#39;IR&#39;</span><span class="p">]:</span>
</span><span id="get_depth_chart-149"><a href="#get_depth_chart-149"><span class="linenos">149</span></a>        <span class="n">injured</span> <span class="o">=</span> <span class="n">depth</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">status</span><span class="p">)</span>
</span><span id="get_depth_chart-150"><a href="#get_depth_chart-150"><span class="linenos">150</span></a>        <span class="n">depth</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">injured</span><span class="p">,</span><span class="s1">&#39;player&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">depth</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">injured</span><span class="p">,</span><span class="s1">&#39;player&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">)</span>
</span><span id="get_depth_chart-151"><a href="#get_depth_chart-151"><span class="linenos">151</span></a>    <span class="n">corrections</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;https://raw.githubusercontent.com/tefirman/FantasySports/main/res/football/name_corrections.csv&quot;</span><span class="p">)</span>
</span><span id="get_depth_chart-152"><a href="#get_depth_chart-152"><span class="linenos">152</span></a>    <span class="n">depth</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">depth</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">corrections</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s1">&#39;player&#39;</span><span class="p">}),</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;player&quot;</span><span class="p">)</span>
</span><span id="get_depth_chart-153"><a href="#get_depth_chart-153"><span class="linenos">153</span></a>    <span class="n">to_fix</span> <span class="o">=</span> <span class="o">~</span><span class="n">depth</span><span class="o">.</span><span class="n">new_name</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span>
</span><span id="get_depth_chart-154"><a href="#get_depth_chart-154"><span class="linenos">154</span></a>    <span class="n">depth</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">to_fix</span><span class="p">,</span> <span class="s2">&quot;player&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">depth</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">to_fix</span><span class="p">,</span> <span class="s2">&quot;new_name&quot;</span><span class="p">]</span>
</span><span id="get_depth_chart-155"><a href="#get_depth_chart-155"><span class="linenos">155</span></a>    <span class="k">del</span> <span class="n">depth</span><span class="p">[</span><span class="s1">&#39;new_name&#39;</span><span class="p">]</span>
</span><span id="get_depth_chart-156"><a href="#get_depth_chart-156"><span class="linenos">156</span></a>    <span class="k">return</span> <span class="n">depth</span>
</span></pre></div>


            <div class="docstring"><p>Pulls the team depth chart directly from ESPN based on the team abbreviation provided.</p>

<p>Args:
    team_abbrev (str): ESPN abbreviation for the team of interest.</p>

<p>Returns:
    pd.DataFrame: dataframe containing the depth chart ranking for each player on the team of interest.</p>
</div>


                </section>
                <section id="get_all_depth_charts">
                            <input id="get_all_depth_charts-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_all_depth_charts</span><span class="signature pdoc-code condensed">(<span class="return-annotation">):</span></span>

                <label class="view-source-button" for="get_all_depth_charts-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#get_all_depth_charts"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="get_all_depth_charts-159"><a href="#get_all_depth_charts-159"><span class="linenos">159</span></a><span class="k">def</span> <span class="nf">get_all_depth_charts</span><span class="p">():</span>
</span><span id="get_all_depth_charts-160"><a href="#get_all_depth_charts-160"><span class="linenos">160</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="get_all_depth_charts-161"><a href="#get_all_depth_charts-161"><span class="linenos">161</span></a><span class="sd">    Pulls all ESPN depth charts across the NFL.</span>
</span><span id="get_all_depth_charts-162"><a href="#get_all_depth_charts-162"><span class="linenos">162</span></a>
</span><span id="get_all_depth_charts-163"><a href="#get_all_depth_charts-163"><span class="linenos">163</span></a><span class="sd">    Returns:</span>
</span><span id="get_all_depth_charts-164"><a href="#get_all_depth_charts-164"><span class="linenos">164</span></a><span class="sd">        pd.DataFrame: dataframe containing the depth chart ranking for each player in the NFL.</span>
</span><span id="get_all_depth_charts-165"><a href="#get_all_depth_charts-165"><span class="linenos">165</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="get_all_depth_charts-166"><a href="#get_all_depth_charts-166"><span class="linenos">166</span></a>    <span class="n">teams</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;https://raw.githubusercontent.com/tefirman/FantasySports/main/res/football/team_abbrevs.csv&quot;</span><span class="p">)</span>
</span><span id="get_all_depth_charts-167"><a href="#get_all_depth_charts-167"><span class="linenos">167</span></a>    <span class="n">teams</span><span class="p">[</span><span class="s1">&#39;espn&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">teams</span><span class="o">.</span><span class="n">fivethirtyeight</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;OAK&#39;</span><span class="p">,</span><span class="s1">&#39;LV&#39;</span><span class="p">)</span>
</span><span id="get_all_depth_charts-168"><a href="#get_all_depth_charts-168"><span class="linenos">168</span></a>    <span class="n">depths</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;team&#39;</span><span class="p">])</span>
</span><span id="get_all_depth_charts-169"><a href="#get_all_depth_charts-169"><span class="linenos">169</span></a>    <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">teams</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="get_all_depth_charts-170"><a href="#get_all_depth_charts-170"><span class="linenos">170</span></a>        <span class="n">depths</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">depths</span><span class="p">,</span><span class="n">get_depth_chart</span><span class="p">(</span><span class="n">teams</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;espn&#39;</span><span class="p">])],</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="get_all_depth_charts-171"><a href="#get_all_depth_charts-171"><span class="linenos">171</span></a>        <span class="n">depths</span><span class="o">.</span><span class="n">team</span> <span class="o">=</span> <span class="n">depths</span><span class="o">.</span><span class="n">team</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">teams</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;real_abbrev&#39;</span><span class="p">])</span>
</span><span id="get_all_depth_charts-172"><a href="#get_all_depth_charts-172"><span class="linenos">172</span></a>    <span class="k">return</span> <span class="n">depths</span>
</span></pre></div>


            <div class="docstring"><p>Pulls all ESPN depth charts across the NFL.</p>

<p>Returns:
    pd.DataFrame: dataframe containing the depth chart ranking for each player in the NFL.</p>
</div>


                </section>
                <section id="get_stadiums">
                            <input id="get_stadiums-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_stadiums</span><span class="signature pdoc-code condensed">(<span class="return-annotation">):</span></span>

                <label class="view-source-button" for="get_stadiums-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#get_stadiums"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="get_stadiums-175"><a href="#get_stadiums-175"><span class="linenos">175</span></a><span class="k">def</span> <span class="nf">get_stadiums</span><span class="p">():</span>
</span><span id="get_stadiums-176"><a href="#get_stadiums-176"><span class="linenos">176</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="get_stadiums-177"><a href="#get_stadiums-177"><span class="linenos">177</span></a><span class="sd">    Pulls details about all stadiums ever used for an NFL game.</span>
</span><span id="get_stadiums-178"><a href="#get_stadiums-178"><span class="linenos">178</span></a>
</span><span id="get_stadiums-179"><a href="#get_stadiums-179"><span class="linenos">179</span></a><span class="sd">    Returns:</span>
</span><span id="get_stadiums-180"><a href="#get_stadiums-180"><span class="linenos">180</span></a><span class="sd">        pd.DataFrame: dataframe containing names, locations, and timespans of each stadium.</span>
</span><span id="get_stadiums-181"><a href="#get_stadiums-181"><span class="linenos">181</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="get_stadiums-182"><a href="#get_stadiums-182"><span class="linenos">182</span></a>    <span class="n">raw_text</span> <span class="o">=</span> <span class="n">get_page</span><span class="p">(</span><span class="s2">&quot;stadiums&quot;</span><span class="p">)</span>
</span><span id="get_stadiums-183"><a href="#get_stadiums-183"><span class="linenos">183</span></a>    <span class="n">stadiums</span> <span class="o">=</span> <span class="n">parse_table</span><span class="p">(</span><span class="n">raw_text</span><span class="p">,</span> <span class="s2">&quot;stadiums&quot;</span><span class="p">)</span>
</span><span id="get_stadiums-184"><a href="#get_stadiums-184"><span class="linenos">184</span></a>    <span class="k">return</span> <span class="n">stadiums</span>
</span></pre></div>


            <div class="docstring"><p>Pulls details about all stadiums ever used for an NFL game.</p>

<p>Returns:
    pd.DataFrame: dataframe containing names, locations, and timespans of each stadium.</p>
</div>


                </section>
                <section id="get_team_stadium">
                            <input id="get_team_stadium-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_team_stadium</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">abbrev</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">season</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="get_team_stadium-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#get_team_stadium"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="get_team_stadium-187"><a href="#get_team_stadium-187"><span class="linenos">187</span></a><span class="k">def</span> <span class="nf">get_team_stadium</span><span class="p">(</span><span class="n">abbrev</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">season</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="get_team_stadium-188"><a href="#get_team_stadium-188"><span class="linenos">188</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="get_team_stadium-189"><a href="#get_team_stadium-189"><span class="linenos">189</span></a><span class="sd">    Identifies the home stadium of the specified team during the specified season.</span>
</span><span id="get_team_stadium-190"><a href="#get_team_stadium-190"><span class="linenos">190</span></a>
</span><span id="get_team_stadium-191"><a href="#get_team_stadium-191"><span class="linenos">191</span></a><span class="sd">    Args:</span>
</span><span id="get_team_stadium-192"><a href="#get_team_stadium-192"><span class="linenos">192</span></a><span class="sd">        abbrev (str): team abbreviation according to Pro Football Reference</span>
</span><span id="get_team_stadium-193"><a href="#get_team_stadium-193"><span class="linenos">193</span></a><span class="sd">        season (int): year of the NFL season of interest</span>
</span><span id="get_team_stadium-194"><a href="#get_team_stadium-194"><span class="linenos">194</span></a>
</span><span id="get_team_stadium-195"><a href="#get_team_stadium-195"><span class="linenos">195</span></a><span class="sd">    Returns:</span>
</span><span id="get_team_stadium-196"><a href="#get_team_stadium-196"><span class="linenos">196</span></a><span class="sd">        str: stadium identifier according to Pro Football Reference</span>
</span><span id="get_team_stadium-197"><a href="#get_team_stadium-197"><span class="linenos">197</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="get_team_stadium-198"><a href="#get_team_stadium-198"><span class="linenos">198</span></a>    <span class="n">raw_text</span> <span class="o">=</span> <span class="n">get_page</span><span class="p">(</span><span class="s2">&quot;teams/</span><span class="si">{}</span><span class="s2">/</span><span class="si">{}</span><span class="s2">.htm&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">abbrev</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="nb">int</span><span class="p">(</span><span class="n">season</span><span class="p">)))</span>
</span><span id="get_team_stadium-199"><a href="#get_team_stadium-199"><span class="linenos">199</span></a>    <span class="n">team_info</span> <span class="o">=</span> <span class="n">raw_text</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;meta&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">)</span>
</span><span id="get_team_stadium-200"><a href="#get_team_stadium-200"><span class="linenos">200</span></a>    <span class="n">stadium_info</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">team_info</span> <span class="k">if</span> <span class="n">val</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Stadium:&quot;</span><span class="p">)]</span>
</span><span id="get_team_stadium-201"><a href="#get_team_stadium-201"><span class="linenos">201</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">stadium_info</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="get_team_stadium-202"><a href="#get_team_stadium-202"><span class="linenos">202</span></a>        <span class="n">stadiums</span> <span class="o">=</span> <span class="n">get_stadiums</span><span class="p">()</span>
</span><span id="get_team_stadium-203"><a href="#get_team_stadium-203"><span class="linenos">203</span></a>        <span class="n">stadiums</span><span class="o">.</span><span class="n">teams_abbrev</span> <span class="o">=</span> <span class="n">stadiums</span><span class="o">.</span><span class="n">teams_abbrev</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="p">)</span>
</span><span id="get_team_stadium-204"><a href="#get_team_stadium-204"><span class="linenos">204</span></a>        <span class="n">stadiums</span> <span class="o">=</span> <span class="n">stadiums</span><span class="o">.</span><span class="n">explode</span><span class="p">(</span><span class="s2">&quot;teams_abbrev&quot;</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="get_team_stadium-205"><a href="#get_team_stadium-205"><span class="linenos">205</span></a>        <span class="n">stadium_id</span> <span class="o">=</span> <span class="n">stadiums</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="get_team_stadium-206"><a href="#get_team_stadium-206"><span class="linenos">206</span></a>            <span class="p">(</span><span class="n">stadiums</span><span class="o">.</span><span class="n">teams_abbrev</span> <span class="o">==</span> <span class="n">abbrev</span><span class="p">)</span>
</span><span id="get_team_stadium-207"><a href="#get_team_stadium-207"><span class="linenos">207</span></a>            <span class="o">&amp;</span> <span class="p">(</span><span class="n">stadiums</span><span class="o">.</span><span class="n">year_min</span> <span class="o">&lt;=</span> <span class="n">season</span><span class="p">)</span>
</span><span id="get_team_stadium-208"><a href="#get_team_stadium-208"><span class="linenos">208</span></a>            <span class="o">&amp;</span> <span class="p">(</span><span class="n">stadiums</span><span class="o">.</span><span class="n">year_max</span> <span class="o">&gt;=</span> <span class="n">season</span><span class="p">),</span>
</span><span id="get_team_stadium-209"><a href="#get_team_stadium-209"><span class="linenos">209</span></a>            <span class="s2">&quot;stadium_abbrev&quot;</span><span class="p">,</span>
</span><span id="get_team_stadium-210"><a href="#get_team_stadium-210"><span class="linenos">210</span></a>        <span class="p">]</span>
</span><span id="get_team_stadium-211"><a href="#get_team_stadium-211"><span class="linenos">211</span></a>        <span class="k">if</span> <span class="n">stadium_id</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="get_team_stadium-212"><a href="#get_team_stadium-212"><span class="linenos">212</span></a>            <span class="n">stadium_id</span> <span class="o">=</span> <span class="n">stadium_id</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="get_team_stadium-213"><a href="#get_team_stadium-213"><span class="linenos">213</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="get_team_stadium-214"><a href="#get_team_stadium-214"><span class="linenos">214</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Can&#39;t find home stadium for </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2">...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">season</span><span class="p">,</span><span class="n">abbrev</span><span class="p">))</span>
</span><span id="get_team_stadium-215"><a href="#get_team_stadium-215"><span class="linenos">215</span></a>            <span class="n">stadium_id</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="get_team_stadium-216"><a href="#get_team_stadium-216"><span class="linenos">216</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="get_team_stadium-217"><a href="#get_team_stadium-217"><span class="linenos">217</span></a>        <span class="n">stadium_info</span> <span class="o">=</span> <span class="n">stadium_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="get_team_stadium-218"><a href="#get_team_stadium-218"><span class="linenos">218</span></a>        <span class="n">stadium_id</span> <span class="o">=</span> <span class="n">stadium_info</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;href&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="get_team_stadium-219"><a href="#get_team_stadium-219"><span class="linenos">219</span></a>    <span class="k">return</span> <span class="n">stadium_id</span>
</span></pre></div>


            <div class="docstring"><p>Identifies the home stadium of the specified team during the specified season.</p>

<p>Args:
    abbrev (str): team abbreviation according to Pro Football Reference
    season (int): year of the NFL season of interest</p>

<p>Returns:
    str: stadium identifier according to Pro Football Reference</p>
</div>


                </section>
                <section id="get_game_stadium">
                            <input id="get_game_stadium-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_game_stadium</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">game_id</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="get_game_stadium-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#get_game_stadium"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="get_game_stadium-222"><a href="#get_game_stadium-222"><span class="linenos">222</span></a><span class="k">def</span> <span class="nf">get_game_stadium</span><span class="p">(</span><span class="n">game_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="get_game_stadium-223"><a href="#get_game_stadium-223"><span class="linenos">223</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="get_game_stadium-224"><a href="#get_game_stadium-224"><span class="linenos">224</span></a><span class="sd">    Identifies the stadium where the specified game was played.</span>
</span><span id="get_game_stadium-225"><a href="#get_game_stadium-225"><span class="linenos">225</span></a>
</span><span id="get_game_stadium-226"><a href="#get_game_stadium-226"><span class="linenos">226</span></a><span class="sd">    Args:</span>
</span><span id="get_game_stadium-227"><a href="#get_game_stadium-227"><span class="linenos">227</span></a><span class="sd">        game_id (str): Pro Football Reference identifier string for the game in question (e.g. 202209080ram).</span>
</span><span id="get_game_stadium-228"><a href="#get_game_stadium-228"><span class="linenos">228</span></a>
</span><span id="get_game_stadium-229"><a href="#get_game_stadium-229"><span class="linenos">229</span></a><span class="sd">    Returns:</span>
</span><span id="get_game_stadium-230"><a href="#get_game_stadium-230"><span class="linenos">230</span></a><span class="sd">        str: stadium identifier according to Pro Football Reference.</span>
</span><span id="get_game_stadium-231"><a href="#get_game_stadium-231"><span class="linenos">231</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="get_game_stadium-232"><a href="#get_game_stadium-232"><span class="linenos">232</span></a>    <span class="n">raw_text</span> <span class="o">=</span> <span class="n">get_page</span><span class="p">(</span><span class="s2">&quot;boxscores/</span><span class="si">{}</span><span class="s2">.htm&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">game_id</span><span class="p">))</span>
</span><span id="get_game_stadium-233"><a href="#get_game_stadium-233"><span class="linenos">233</span></a>    <span class="n">game_info</span> <span class="o">=</span> <span class="n">raw_text</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;div&quot;</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;scorebox_meta&quot;</span><span class="p">})</span>
</span><span id="get_game_stadium-234"><a href="#get_game_stadium-234"><span class="linenos">234</span></a>    <span class="n">stadium_id</span> <span class="o">=</span> <span class="n">game_info</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;href&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="get_game_stadium-235"><a href="#get_game_stadium-235"><span class="linenos">235</span></a>    <span class="k">return</span> <span class="n">stadium_id</span>
</span></pre></div>


            <div class="docstring"><p>Identifies the stadium where the specified game was played.</p>

<p>Args:
    game_id (str): Pro Football Reference identifier string for the game in question (e.g. 202209080ram).</p>

<p>Returns:
    str: stadium identifier according to Pro Football Reference.</p>
</div>


                </section>
                <section id="get_address">
                            <input id="get_address-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_address</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">stadium_id</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="get_address-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#get_address"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="get_address-238"><a href="#get_address-238"><span class="linenos">238</span></a><span class="k">def</span> <span class="nf">get_address</span><span class="p">(</span><span class="n">stadium_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="get_address-239"><a href="#get_address-239"><span class="linenos">239</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="get_address-240"><a href="#get_address-240"><span class="linenos">240</span></a><span class="sd">    Identifies the address of the specified stadium (with a few typo corrections here and there).</span>
</span><span id="get_address-241"><a href="#get_address-241"><span class="linenos">241</span></a>
</span><span id="get_address-242"><a href="#get_address-242"><span class="linenos">242</span></a><span class="sd">    Args:</span>
</span><span id="get_address-243"><a href="#get_address-243"><span class="linenos">243</span></a><span class="sd">        stadium_id (str): stadium identifier according to Pro Football Reference.</span>
</span><span id="get_address-244"><a href="#get_address-244"><span class="linenos">244</span></a>
</span><span id="get_address-245"><a href="#get_address-245"><span class="linenos">245</span></a><span class="sd">    Returns:</span>
</span><span id="get_address-246"><a href="#get_address-246"><span class="linenos">246</span></a><span class="sd">        str: address of the specified stadium according to Pro Football Reference.</span>
</span><span id="get_address-247"><a href="#get_address-247"><span class="linenos">247</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="get_address-248"><a href="#get_address-248"><span class="linenos">248</span></a>    <span class="n">raw_text</span> <span class="o">=</span> <span class="n">get_page</span><span class="p">(</span><span class="s2">&quot;stadiums/</span><span class="si">{}</span><span class="s2">.htm&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stadium_id</span><span class="p">))</span>
</span><span id="get_address-249"><a href="#get_address-249"><span class="linenos">249</span></a>    <span class="n">address</span> <span class="o">=</span> <span class="n">raw_text</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;meta&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
</span><span id="get_address-250"><a href="#get_address-250"><span class="linenos">250</span></a>    <span class="n">fixes</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="get_address-251"><a href="#get_address-251"><span class="linenos">251</span></a>        <span class="s2">&quot;New Jersey&quot;</span><span class="p">:</span> <span class="s2">&quot;NJ&quot;</span><span class="p">,</span>
</span><span id="get_address-252"><a href="#get_address-252"><span class="linenos">252</span></a>        <span class="s2">&quot;Park Houston&quot;</span><span class="p">:</span> <span class="s2">&quot;Park, Houston&quot;</span><span class="p">,</span>
</span><span id="get_address-253"><a href="#get_address-253"><span class="linenos">253</span></a>        <span class="s2">&quot;Blvd Opa-Locka&quot;</span><span class="p">:</span> <span class="s2">&quot;Blvd, Opa-Locka&quot;</span><span class="p">,</span>
</span><span id="get_address-254"><a href="#get_address-254"><span class="linenos">254</span></a>        <span class="s2">&quot;Northumberland Development Project&quot;</span><span class="p">:</span> <span class="s2">&quot;782 High Rd, London N17 0BX, UK&quot;</span><span class="p">,</span>
</span><span id="get_address-255"><a href="#get_address-255"><span class="linenos">255</span></a>    <span class="p">}</span>
</span><span id="get_address-256"><a href="#get_address-256"><span class="linenos">256</span></a>    <span class="k">for</span> <span class="n">fix</span> <span class="ow">in</span> <span class="n">fixes</span><span class="p">:</span>
</span><span id="get_address-257"><a href="#get_address-257"><span class="linenos">257</span></a>        <span class="n">address</span> <span class="o">=</span> <span class="n">address</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">fix</span><span class="p">,</span> <span class="n">fixes</span><span class="p">[</span><span class="n">fix</span><span class="p">])</span>
</span><span id="get_address-258"><a href="#get_address-258"><span class="linenos">258</span></a>    <span class="k">return</span> <span class="n">address</span>
</span></pre></div>


            <div class="docstring"><p>Identifies the address of the specified stadium (with a few typo corrections here and there).</p>

<p>Args:
    stadium_id (str): stadium identifier according to Pro Football Reference.</p>

<p>Returns:
    str: address of the specified stadium according to Pro Football Reference.</p>
</div>


                </section>
                <section id="download_zip_codes">
                            <input id="download_zip_codes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">download_zip_codes</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;https://nominatim.org/data/us_postcodes.csv.gz&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="download_zip_codes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#download_zip_codes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="download_zip_codes-261"><a href="#download_zip_codes-261"><span class="linenos">261</span></a><span class="k">def</span> <span class="nf">download_zip_codes</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;https://nominatim.org/data/us_postcodes.csv.gz&quot;</span><span class="p">):</span>
</span><span id="download_zip_codes-262"><a href="#download_zip_codes-262"><span class="linenos">262</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="download_zip_codes-263"><a href="#download_zip_codes-263"><span class="linenos">263</span></a><span class="sd">    Downloads a csv from Nominatim containing the GPS coordinates of every zip code in the US</span>
</span><span id="download_zip_codes-264"><a href="#download_zip_codes-264"><span class="linenos">264</span></a><span class="sd">    and returns it in the form of a pandas dataframe (used when accounting for team travel).</span>
</span><span id="download_zip_codes-265"><a href="#download_zip_codes-265"><span class="linenos">265</span></a>
</span><span id="download_zip_codes-266"><a href="#download_zip_codes-266"><span class="linenos">266</span></a><span class="sd">    Args:</span>
</span><span id="download_zip_codes-267"><a href="#download_zip_codes-267"><span class="linenos">267</span></a><span class="sd">        url (str, optional): URL location of the zipcode csv, defaults to &quot;https://nominatim.org/data/us_postcodes.csv.gz&quot;.</span>
</span><span id="download_zip_codes-268"><a href="#download_zip_codes-268"><span class="linenos">268</span></a>
</span><span id="download_zip_codes-269"><a href="#download_zip_codes-269"><span class="linenos">269</span></a><span class="sd">    Returns:</span>
</span><span id="download_zip_codes-270"><a href="#download_zip_codes-270"><span class="linenos">270</span></a><span class="sd">        pd.DataFrame: dataframe containing the GPS coordinates of every US zip code.</span>
</span><span id="download_zip_codes-271"><a href="#download_zip_codes-271"><span class="linenos">271</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="download_zip_codes-272"><a href="#download_zip_codes-272"><span class="linenos">272</span></a>    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="download_zip_codes-273"><a href="#download_zip_codes-273"><span class="linenos">273</span></a>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">out_file</span><span class="p">:</span>
</span><span id="download_zip_codes-274"><a href="#download_zip_codes-274"><span class="linenos">274</span></a>        <span class="n">shutil</span><span class="o">.</span><span class="n">copyfileobj</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">raw</span><span class="p">,</span><span class="n">out_file</span><span class="p">)</span>
</span><span id="download_zip_codes-275"><a href="#download_zip_codes-275"><span class="linenos">275</span></a>    <span class="k">with</span> <span class="n">gzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f_in</span><span class="p">:</span>
</span><span id="download_zip_codes-276"><a href="#download_zip_codes-276"><span class="linenos">276</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">3</span><span class="p">],</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f_out</span><span class="p">:</span>
</span><span id="download_zip_codes-277"><a href="#download_zip_codes-277"><span class="linenos">277</span></a>            <span class="n">shutil</span><span class="o">.</span><span class="n">copyfileobj</span><span class="p">(</span><span class="n">f_in</span><span class="p">,</span> <span class="n">f_out</span><span class="p">)</span>
</span><span id="download_zip_codes-278"><a href="#download_zip_codes-278"><span class="linenos">278</span></a>    <span class="n">zips</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">3</span><span class="p">],</span><span class="n">dtype</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;postcode&#39;</span><span class="p">:</span><span class="nb">str</span><span class="p">})</span>
</span><span id="download_zip_codes-279"><a href="#download_zip_codes-279"><span class="linenos">279</span></a>    <span class="k">return</span> <span class="n">zips</span>
</span></pre></div>


            <div class="docstring"><p>Downloads a csv from Nominatim containing the GPS coordinates of every zip code in the US
and returns it in the form of a pandas dataframe (used when accounting for team travel).</p>

<p>Args:
    url (str, optional): URL location of the zipcode csv, defaults to "https://nominatim.org/data/us_postcodes.csv.gz".</p>

<p>Returns:
    pd.DataFrame: dataframe containing the GPS coordinates of every US zip code.</p>
</div>


                </section>
                <section id="get_coordinates">
                            <input id="get_coordinates-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_coordinates</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">address</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">zips</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="get_coordinates-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#get_coordinates"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="get_coordinates-282"><a href="#get_coordinates-282"><span class="linenos">282</span></a><span class="k">def</span> <span class="nf">get_coordinates</span><span class="p">(</span><span class="n">address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">zips</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
</span><span id="get_coordinates-283"><a href="#get_coordinates-283"><span class="linenos">283</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="get_coordinates-284"><a href="#get_coordinates-284"><span class="linenos">284</span></a><span class="sd">    Provides the coordinates of the specified address. If no exact coordinates are available,</span>
</span><span id="get_coordinates-285"><a href="#get_coordinates-285"><span class="linenos">285</span></a><span class="sd">    city, state, and zip code are used for an approximate position.</span>
</span><span id="get_coordinates-286"><a href="#get_coordinates-286"><span class="linenos">286</span></a>
</span><span id="get_coordinates-287"><a href="#get_coordinates-287"><span class="linenos">287</span></a><span class="sd">    Args:</span>
</span><span id="get_coordinates-288"><a href="#get_coordinates-288"><span class="linenos">288</span></a><span class="sd">        address (str): physical address of interest.</span>
</span><span id="get_coordinates-289"><a href="#get_coordinates-289"><span class="linenos">289</span></a>
</span><span id="get_coordinates-290"><a href="#get_coordinates-290"><span class="linenos">290</span></a><span class="sd">    Returns:</span>
</span><span id="get_coordinates-291"><a href="#get_coordinates-291"><span class="linenos">291</span></a><span class="sd">        str: latitudinal and longitudinal coordinates separated by a comma.</span>
</span><span id="get_coordinates-292"><a href="#get_coordinates-292"><span class="linenos">292</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="get_coordinates-293"><a href="#get_coordinates-293"><span class="linenos">293</span></a>    <span class="n">stad_zip</span> <span class="o">=</span> <span class="n">address</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="get_coordinates-294"><a href="#get_coordinates-294"><span class="linenos">294</span></a>    <span class="n">stad_coords</span> <span class="o">=</span> <span class="n">zips</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">zips</span><span class="o">.</span><span class="n">postcode</span> <span class="o">==</span> <span class="n">stad_zip</span><span class="p">,[</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span><span class="s1">&#39;lon&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
</span><span id="get_coordinates-295"><a href="#get_coordinates-295"><span class="linenos">295</span></a>    <span class="k">if</span> <span class="n">stad_coords</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="get_coordinates-296"><a href="#get_coordinates-296"><span class="linenos">296</span></a>        <span class="n">coords</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">stad_coords</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="get_coordinates-297"><a href="#get_coordinates-297"><span class="linenos">297</span></a>    <span class="k">elif</span> <span class="n">stad_zip</span> <span class="o">==</span> <span class="s2">&quot;Mexico&quot;</span><span class="p">:</span>
</span><span id="get_coordinates-298"><a href="#get_coordinates-298"><span class="linenos">298</span></a>        <span class="n">coords</span> <span class="o">=</span> <span class="s2">&quot;19.3029,-99.1505&quot;</span>
</span><span id="get_coordinates-299"><a href="#get_coordinates-299"><span class="linenos">299</span></a>    <span class="k">elif</span> <span class="n">stad_zip</span> <span class="o">==</span> <span class="s2">&quot;UK&quot;</span><span class="p">:</span>
</span><span id="get_coordinates-300"><a href="#get_coordinates-300"><span class="linenos">300</span></a>        <span class="n">coords</span> <span class="o">=</span> <span class="s2">&quot;51.5072,-0.1276&quot;</span>
</span><span id="get_coordinates-301"><a href="#get_coordinates-301"><span class="linenos">301</span></a>    <span class="k">elif</span> <span class="n">stad_zip</span> <span class="o">==</span> <span class="s2">&quot;Bavaria&quot;</span><span class="p">:</span>
</span><span id="get_coordinates-302"><a href="#get_coordinates-302"><span class="linenos">302</span></a>        <span class="n">coords</span> <span class="o">=</span> <span class="s2">&quot;48.2188,11.6248&quot;</span>
</span><span id="get_coordinates-303"><a href="#get_coordinates-303"><span class="linenos">303</span></a>    <span class="k">elif</span> <span class="n">stad_zip</span> <span class="o">==</span> <span class="s2">&quot;Hesse&quot;</span><span class="p">:</span>
</span><span id="get_coordinates-304"><a href="#get_coordinates-304"><span class="linenos">304</span></a>        <span class="n">coords</span> <span class="o">=</span> <span class="s2">&quot;50.0686,8.6455&quot;</span>
</span><span id="get_coordinates-305"><a href="#get_coordinates-305"><span class="linenos">305</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="get_coordinates-306"><a href="#get_coordinates-306"><span class="linenos">306</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Can&#39;t find zip code provided: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">stad_zip</span><span class="p">))</span>
</span><span id="get_coordinates-307"><a href="#get_coordinates-307"><span class="linenos">307</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Using centerpoint of US...&quot;</span><span class="p">)</span>
</span><span id="get_coordinates-308"><a href="#get_coordinates-308"><span class="linenos">308</span></a>        <span class="n">coords</span> <span class="o">=</span> <span class="s2">&quot;37.0902,-95.7129&quot;</span>
</span><span id="get_coordinates-309"><a href="#get_coordinates-309"><span class="linenos">309</span></a>    <span class="k">return</span> <span class="n">coords</span>
</span></pre></div>


            <div class="docstring"><p>Provides the coordinates of the specified address. If no exact coordinates are available,
city, state, and zip code are used for an approximate position.</p>

<p>Args:
    address (str): physical address of interest.</p>

<p>Returns:
    str: latitudinal and longitudinal coordinates separated by a comma.</p>
</div>


                </section>
                <section id="Schedule">
                            <input id="Schedule-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Schedule</span>:

                <label class="view-source-button" for="Schedule-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Schedule"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Schedule-312"><a href="#Schedule-312"><span class="linenos">312</span></a><span class="k">class</span> <span class="nc">Schedule</span><span class="p">:</span>
</span><span id="Schedule-313"><a href="#Schedule-313"><span class="linenos">313</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Schedule-314"><a href="#Schedule-314"><span class="linenos">314</span></a><span class="sd">    Schedule class that gathers all matchups and outcomes for the seasons in question and</span>
</span><span id="Schedule-315"><a href="#Schedule-315"><span class="linenos">315</span></a><span class="sd">    assess the evolution of each team&#39;s elo ranking according to 538&#39;s methodology.</span>
</span><span id="Schedule-316"><a href="#Schedule-316"><span class="linenos">316</span></a>
</span><span id="Schedule-317"><a href="#Schedule-317"><span class="linenos">317</span></a><span class="sd">    Attributes:</span>
</span><span id="Schedule-318"><a href="#Schedule-318"><span class="linenos">318</span></a><span class="sd">        schedule: dataframe containing matchup details for the seasons of interest.</span>
</span><span id="Schedule-319"><a href="#Schedule-319"><span class="linenos">319</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Schedule-320"><a href="#Schedule-320"><span class="linenos">320</span></a>
</span><span id="Schedule-321"><a href="#Schedule-321"><span class="linenos">321</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">finish</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">playoffs</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">elo</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">qbelo</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="Schedule-322"><a href="#Schedule-322"><span class="linenos">322</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Schedule-323"><a href="#Schedule-323"><span class="linenos">323</span></a><span class="sd">        Initializes a Schedule object using the parameters provided and class functions defined below.</span>
</span><span id="Schedule-324"><a href="#Schedule-324"><span class="linenos">324</span></a>
</span><span id="Schedule-325"><a href="#Schedule-325"><span class="linenos">325</span></a><span class="sd">        Args:</span>
</span><span id="Schedule-326"><a href="#Schedule-326"><span class="linenos">326</span></a><span class="sd">            start (int): first NFL season of interest</span>
</span><span id="Schedule-327"><a href="#Schedule-327"><span class="linenos">327</span></a><span class="sd">            finish (int): last NFL season of interest</span>
</span><span id="Schedule-328"><a href="#Schedule-328"><span class="linenos">328</span></a><span class="sd">            playoffs (bool, optional): whether to include playoff games, defaults to True.</span>
</span><span id="Schedule-329"><a href="#Schedule-329"><span class="linenos">329</span></a><span class="sd">            elo (bool, optional): whether to include elo rating considerations, defaults to False.</span>
</span><span id="Schedule-330"><a href="#Schedule-330"><span class="linenos">330</span></a><span class="sd">            qbelo (bool, optional): whether to include QB elo rating considerations, defaults to False.</span>
</span><span id="Schedule-331"><a href="#Schedule-331"><span class="linenos">331</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Schedule-332"><a href="#Schedule-332"><span class="linenos">332</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">get_schedules</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">finish</span><span class="p">)</span>
</span><span id="Schedule-333"><a href="#Schedule-333"><span class="linenos">333</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_weeks</span><span class="p">()</span>
</span><span id="Schedule-334"><a href="#Schedule-334"><span class="linenos">334</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">convert_to_home_away</span><span class="p">()</span>
</span><span id="Schedule-335"><a href="#Schedule-335"><span class="linenos">335</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mark_intl_games</span><span class="p">()</span>
</span><span id="Schedule-336"><a href="#Schedule-336"><span class="linenos">336</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_rest</span><span class="p">()</span>
</span><span id="Schedule-337"><a href="#Schedule-337"><span class="linenos">337</span></a>        <span class="k">if</span> <span class="n">elo</span><span class="p">:</span>
</span><span id="Schedule-338"><a href="#Schedule-338"><span class="linenos">338</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">add_team_coords</span><span class="p">()</span>
</span><span id="Schedule-339"><a href="#Schedule-339"><span class="linenos">339</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">add_game_coords</span><span class="p">()</span>
</span><span id="Schedule-340"><a href="#Schedule-340"><span class="linenos">340</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">add_travel</span><span class="p">()</span>
</span><span id="Schedule-341"><a href="#Schedule-341"><span class="linenos">341</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">add_elo_columns</span><span class="p">(</span><span class="n">qbelo</span><span class="p">)</span>
</span><span id="Schedule-342"><a href="#Schedule-342"><span class="linenos">342</span></a>            <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">elo1_pre</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="Schedule-343"><a href="#Schedule-343"><span class="linenos">343</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">next_init_elo</span><span class="p">()</span>
</span><span id="Schedule-344"><a href="#Schedule-344"><span class="linenos">344</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">next_elo_prob</span><span class="p">()</span>
</span><span id="Schedule-345"><a href="#Schedule-345"><span class="linenos">345</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">next_elo_delta</span><span class="p">()</span>
</span><span id="Schedule-346"><a href="#Schedule-346"><span class="linenos">346</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">playoffs</span><span class="p">:</span>
</span><span id="Schedule-347"><a href="#Schedule-347"><span class="linenos">347</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="Schedule-348"><a href="#Schedule-348"><span class="linenos">348</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">week_num</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">isnumeric</span><span class="p">()</span>
</span><span id="Schedule-349"><a href="#Schedule-349"><span class="linenos">349</span></a>            <span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Schedule-350"><a href="#Schedule-350"><span class="linenos">350</span></a>
</span><span id="Schedule-351"><a href="#Schedule-351"><span class="linenos">351</span></a>    <span class="k">def</span> <span class="nf">get_schedules</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">finish</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="Schedule-352"><a href="#Schedule-352"><span class="linenos">352</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Schedule-353"><a href="#Schedule-353"><span class="linenos">353</span></a><span class="sd">        Pulls the full NFL schedules for the seasons provided.</span>
</span><span id="Schedule-354"><a href="#Schedule-354"><span class="linenos">354</span></a>
</span><span id="Schedule-355"><a href="#Schedule-355"><span class="linenos">355</span></a><span class="sd">        Args:</span>
</span><span id="Schedule-356"><a href="#Schedule-356"><span class="linenos">356</span></a><span class="sd">            start (int): first season of interest</span>
</span><span id="Schedule-357"><a href="#Schedule-357"><span class="linenos">357</span></a><span class="sd">            finish (int): last season of interest</span>
</span><span id="Schedule-358"><a href="#Schedule-358"><span class="linenos">358</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Schedule-359"><a href="#Schedule-359"><span class="linenos">359</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">])</span>
</span><span id="Schedule-360"><a href="#Schedule-360"><span class="linenos">360</span></a>        <span class="k">for</span> <span class="n">season</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">start</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">finish</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="Schedule-361"><a href="#Schedule-361"><span class="linenos">361</span></a>            <span class="n">raw_text</span> <span class="o">=</span> <span class="n">get_page</span><span class="p">(</span><span class="s2">&quot;years/</span><span class="si">{}</span><span class="s2">/games.htm&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">season</span><span class="p">))</span>
</span><span id="Schedule-362"><a href="#Schedule-362"><span class="linenos">362</span></a>            <span class="n">season_sched</span> <span class="o">=</span> <span class="n">parse_table</span><span class="p">(</span><span class="n">raw_text</span><span class="p">,</span> <span class="s2">&quot;games&quot;</span><span class="p">)</span>
</span><span id="Schedule-363"><a href="#Schedule-363"><span class="linenos">363</span></a>            <span class="n">season_sched</span><span class="o">.</span><span class="n">week_num</span> <span class="o">=</span> <span class="n">season_sched</span><span class="o">.</span><span class="n">week_num</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Schedule-364"><a href="#Schedule-364"><span class="linenos">364</span></a>            <span class="n">season_sched</span> <span class="o">=</span> <span class="n">season_sched</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">season_sched</span><span class="o">.</span><span class="n">week_num</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;Pre&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Schedule-365"><a href="#Schedule-365"><span class="linenos">365</span></a>            <span class="n">season_sched</span><span class="p">[</span><span class="s1">&#39;season&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">season</span>
</span><span id="Schedule-366"><a href="#Schedule-366"><span class="linenos">366</span></a>            <span class="k">if</span> <span class="s2">&quot;game_date&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">season_sched</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span> <span class="c1"># Current season</span>
</span><span id="Schedule-367"><a href="#Schedule-367"><span class="linenos">367</span></a>                <span class="n">season_sched</span><span class="p">[</span><span class="s1">&#39;game_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">season_sched</span><span class="o">.</span><span class="n">boxscore_word</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span> <span class="o">+</span> \
</span><span id="Schedule-368"><a href="#Schedule-368"><span class="linenos">368</span></a>                <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">year</span> <span class="o">+</span> <span class="n">season_sched</span><span class="o">.</span><span class="n">boxscore_word</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;January&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
</span><span id="Schedule-369"><a href="#Schedule-369"><span class="linenos">369</span></a>                <span class="n">season_sched</span> <span class="o">=</span> <span class="n">season_sched</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;visitor_team&#39;</span><span class="p">:</span><span class="s1">&#39;winner&#39;</span><span class="p">,</span>\
</span><span id="Schedule-370"><a href="#Schedule-370"><span class="linenos">370</span></a>                <span class="s1">&#39;visitor_team_abbrev&#39;</span><span class="p">:</span><span class="s1">&#39;winner_abbrev&#39;</span><span class="p">,</span><span class="s1">&#39;home_team&#39;</span><span class="p">:</span><span class="s1">&#39;loser&#39;</span><span class="p">,</span><span class="s1">&#39;home_team_abbrev&#39;</span><span class="p">:</span><span class="s1">&#39;loser_abbrev&#39;</span><span class="p">})</span>
</span><span id="Schedule-371"><a href="#Schedule-371"><span class="linenos">371</span></a>                <span class="n">season_sched</span><span class="p">[[</span><span class="s1">&#39;yards_win&#39;</span><span class="p">,</span><span class="s1">&#39;to_win&#39;</span><span class="p">,</span><span class="s1">&#39;yards_lose&#39;</span><span class="p">,</span><span class="s1">&#39;to_lose&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Schedule-372"><a href="#Schedule-372"><span class="linenos">372</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="p">,</span> <span class="n">season_sched</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Schedule-373"><a href="#Schedule-373"><span class="linenos">373</span></a>
</span><span id="Schedule-374"><a href="#Schedule-374"><span class="linenos">374</span></a>    <span class="k">def</span> <span class="nf">add_weeks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Schedule-375"><a href="#Schedule-375"><span class="linenos">375</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Schedule-376"><a href="#Schedule-376"><span class="linenos">376</span></a><span class="sd">        Infers season week based on game dates for each season.</span>
</span><span id="Schedule-377"><a href="#Schedule-377"><span class="linenos">377</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Schedule-378"><a href="#Schedule-378"><span class="linenos">378</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">game_date</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">game_date</span><span class="p">)</span>
</span><span id="Schedule-379"><a href="#Schedule-379"><span class="linenos">379</span></a>        <span class="n">min_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;season&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">game_date</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="Schedule-380"><a href="#Schedule-380"><span class="linenos">380</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="Schedule-381"><a href="#Schedule-381"><span class="linenos">381</span></a>            <span class="n">left</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="p">,</span>
</span><span id="Schedule-382"><a href="#Schedule-382"><span class="linenos">382</span></a>            <span class="n">right</span><span class="o">=</span><span class="n">min_date</span><span class="p">,</span>
</span><span id="Schedule-383"><a href="#Schedule-383"><span class="linenos">383</span></a>            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">,</span>
</span><span id="Schedule-384"><a href="#Schedule-384"><span class="linenos">384</span></a>            <span class="n">on</span><span class="o">=</span><span class="s2">&quot;season&quot;</span><span class="p">,</span>
</span><span id="Schedule-385"><a href="#Schedule-385"><span class="linenos">385</span></a>            <span class="n">suffixes</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;_min&quot;</span><span class="p">),</span>
</span><span id="Schedule-386"><a href="#Schedule-386"><span class="linenos">386</span></a>        <span class="p">)</span>
</span><span id="Schedule-387"><a href="#Schedule-387"><span class="linenos">387</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;days_into_season&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Schedule-388"><a href="#Schedule-388"><span class="linenos">388</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">game_date</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">game_date_min</span>
</span><span id="Schedule-389"><a href="#Schedule-389"><span class="linenos">389</span></a>        <span class="p">)</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">days</span>
</span><span id="Schedule-390"><a href="#Schedule-390"><span class="linenos">390</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;week&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">days_into_season</span> <span class="o">//</span> <span class="mi">7</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="Schedule-391"><a href="#Schedule-391"><span class="linenos">391</span></a>
</span><span id="Schedule-392"><a href="#Schedule-392"><span class="linenos">392</span></a>    <span class="k">def</span> <span class="nf">convert_to_home_away</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Schedule-393"><a href="#Schedule-393"><span class="linenos">393</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Schedule-394"><a href="#Schedule-394"><span class="linenos">394</span></a><span class="sd">        Converts winner/loser syntax of Pro Football Reference schedules into home/away.</span>
</span><span id="Schedule-395"><a href="#Schedule-395"><span class="linenos">395</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Schedule-396"><a href="#Schedule-396"><span class="linenos">396</span></a>        <span class="n">list1</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;team1&quot;</span><span class="p">,</span><span class="s2">&quot;team1_abbrev&quot;</span><span class="p">,</span><span class="s2">&quot;score1&quot;</span><span class="p">,</span><span class="s2">&quot;yards1&quot;</span><span class="p">,</span><span class="s2">&quot;timeouts1&quot;</span><span class="p">]</span>
</span><span id="Schedule-397"><a href="#Schedule-397"><span class="linenos">397</span></a>        <span class="n">list2</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;team2&quot;</span><span class="p">,</span><span class="s2">&quot;team2_abbrev&quot;</span><span class="p">,</span><span class="s2">&quot;score2&quot;</span><span class="p">,</span><span class="s2">&quot;yards2&quot;</span><span class="p">,</span><span class="s2">&quot;timeouts2&quot;</span><span class="p">]</span>
</span><span id="Schedule-398"><a href="#Schedule-398"><span class="linenos">398</span></a>        <span class="n">winner_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;winner&quot;</span><span class="p">,</span><span class="s2">&quot;winner_abbrev&quot;</span><span class="p">,</span><span class="s2">&quot;pts_win&quot;</span><span class="p">,</span><span class="s2">&quot;yards_win&quot;</span><span class="p">,</span><span class="s2">&quot;to_win&quot;</span><span class="p">]</span>
</span><span id="Schedule-399"><a href="#Schedule-399"><span class="linenos">399</span></a>        <span class="n">loser_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;loser&quot;</span><span class="p">,</span><span class="s2">&quot;loser_abbrev&quot;</span><span class="p">,</span><span class="s2">&quot;pts_lose&quot;</span><span class="p">,</span><span class="s2">&quot;yards_lose&quot;</span><span class="p">,</span><span class="s2">&quot;to_lose&quot;</span><span class="p">]</span>
</span><span id="Schedule-400"><a href="#Schedule-400"><span class="linenos">400</span></a>        <span class="n">home_loser</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">game_location</span> <span class="o">==</span> <span class="s2">&quot;@&quot;</span>
</span><span id="Schedule-401"><a href="#Schedule-401"><span class="linenos">401</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">home_loser</span><span class="p">,</span> <span class="n">list1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">home_loser</span><span class="p">,</span> <span class="n">loser_list</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="Schedule-402"><a href="#Schedule-402"><span class="linenos">402</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">home_loser</span><span class="p">,</span> <span class="n">list2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">home_loser</span><span class="p">,</span> <span class="n">winner_list</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="Schedule-403"><a href="#Schedule-403"><span class="linenos">403</span></a>        <span class="n">away_loser</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">game_location</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">game_location</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;N&quot;</span><span class="p">])</span>
</span><span id="Schedule-404"><a href="#Schedule-404"><span class="linenos">404</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">away_loser</span><span class="p">,</span> <span class="n">list1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">away_loser</span><span class="p">,</span> <span class="n">winner_list</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="Schedule-405"><a href="#Schedule-405"><span class="linenos">405</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">away_loser</span><span class="p">,</span> <span class="n">list2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">away_loser</span><span class="p">,</span> <span class="n">loser_list</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="Schedule-406"><a href="#Schedule-406"><span class="linenos">406</span></a>
</span><span id="Schedule-407"><a href="#Schedule-407"><span class="linenos">407</span></a>    <span class="k">def</span> <span class="nf">mark_intl_games</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Schedule-408"><a href="#Schedule-408"><span class="linenos">408</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Schedule-409"><a href="#Schedule-409"><span class="linenos">409</span></a><span class="sd">        Identifies international games in the provided schedule (used when accounting for team travel).</span>
</span><span id="Schedule-410"><a href="#Schedule-410"><span class="linenos">410</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Schedule-411"><a href="#Schedule-411"><span class="linenos">411</span></a>        <span class="n">intl</span> <span class="o">=</span> <span class="n">get_intl_games</span><span class="p">()</span>
</span><span id="Schedule-412"><a href="#Schedule-412"><span class="linenos">412</span></a>        <span class="n">intl</span> <span class="o">=</span> <span class="n">intl</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="Schedule-413"><a href="#Schedule-413"><span class="linenos">413</span></a>            <span class="p">(</span><span class="n">intl</span><span class="o">.</span><span class="n">game_date</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">season</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
</span><span id="Schedule-414"><a href="#Schedule-414"><span class="linenos">414</span></a>            <span class="o">&amp;</span> <span class="p">(</span><span class="n">intl</span><span class="o">.</span><span class="n">game_date</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">season</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</span><span id="Schedule-415"><a href="#Schedule-415"><span class="linenos">415</span></a>        <span class="p">]</span>
</span><span id="Schedule-416"><a href="#Schedule-416"><span class="linenos">416</span></a>        <span class="n">intl</span><span class="p">[</span><span class="s2">&quot;international&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Schedule-417"><a href="#Schedule-417"><span class="linenos">417</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="Schedule-418"><a href="#Schedule-418"><span class="linenos">418</span></a>            <span class="n">left</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="p">,</span>
</span><span id="Schedule-419"><a href="#Schedule-419"><span class="linenos">419</span></a>            <span class="n">right</span><span class="o">=</span><span class="n">intl</span><span class="p">,</span>
</span><span id="Schedule-420"><a href="#Schedule-420"><span class="linenos">420</span></a>            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
</span><span id="Schedule-421"><a href="#Schedule-421"><span class="linenos">421</span></a>            <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;game_date&quot;</span><span class="p">,</span> <span class="s2">&quot;team1&quot;</span><span class="p">,</span> <span class="s2">&quot;team2&quot;</span><span class="p">],</span>
</span><span id="Schedule-422"><a href="#Schedule-422"><span class="linenos">422</span></a>        <span class="p">)</span>
</span><span id="Schedule-423"><a href="#Schedule-423"><span class="linenos">423</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">international</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">international</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
</span><span id="Schedule-424"><a href="#Schedule-424"><span class="linenos">424</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">international</span><span class="p">,</span> <span class="s2">&quot;game_location&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;N&quot;</span>
</span><span id="Schedule-425"><a href="#Schedule-425"><span class="linenos">425</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">international</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">intl</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="Schedule-426"><a href="#Schedule-426"><span class="linenos">426</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Missing some international games!!!&quot;</span><span class="p">)</span>
</span><span id="Schedule-427"><a href="#Schedule-427"><span class="linenos">427</span></a>            <span class="n">bad</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="Schedule-428"><a href="#Schedule-428"><span class="linenos">428</span></a>                <span class="n">left</span><span class="o">=</span><span class="n">intl</span><span class="p">,</span>
</span><span id="Schedule-429"><a href="#Schedule-429"><span class="linenos">429</span></a>                <span class="n">right</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="p">[[</span><span class="s2">&quot;boxscore_abbrev&quot;</span><span class="p">,</span> <span class="s2">&quot;game_date&quot;</span><span class="p">,</span> <span class="s2">&quot;team1&quot;</span><span class="p">,</span> <span class="s2">&quot;team2&quot;</span><span class="p">]],</span>
</span><span id="Schedule-430"><a href="#Schedule-430"><span class="linenos">430</span></a>                <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
</span><span id="Schedule-431"><a href="#Schedule-431"><span class="linenos">431</span></a>                <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;game_date&quot;</span><span class="p">,</span> <span class="s2">&quot;team1&quot;</span><span class="p">,</span> <span class="s2">&quot;team2&quot;</span><span class="p">],</span>
</span><span id="Schedule-432"><a href="#Schedule-432"><span class="linenos">432</span></a>            <span class="p">)</span>
</span><span id="Schedule-433"><a href="#Schedule-433"><span class="linenos">433</span></a>            <span class="n">bad</span> <span class="o">=</span> <span class="n">bad</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">bad</span><span class="o">.</span><span class="n">boxscore_abbrev</span><span class="o">.</span><span class="n">isnull</span><span class="p">()]</span>
</span><span id="Schedule-434"><a href="#Schedule-434"><span class="linenos">434</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">bad</span><span class="p">)</span>
</span><span id="Schedule-435"><a href="#Schedule-435"><span class="linenos">435</span></a>
</span><span id="Schedule-436"><a href="#Schedule-436"><span class="linenos">436</span></a>    <span class="k">def</span> <span class="nf">add_team_coords</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Schedule-437"><a href="#Schedule-437"><span class="linenos">437</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Schedule-438"><a href="#Schedule-438"><span class="linenos">438</span></a><span class="sd">        Adds the home coordinates for each team in each matchup of the schedule.</span>
</span><span id="Schedule-439"><a href="#Schedule-439"><span class="linenos">439</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Schedule-440"><a href="#Schedule-440"><span class="linenos">440</span></a>        <span class="n">teams</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
</span><span id="Schedule-441"><a href="#Schedule-441"><span class="linenos">441</span></a>            <span class="p">[</span>
</span><span id="Schedule-442"><a href="#Schedule-442"><span class="linenos">442</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="p">[[</span><span class="s2">&quot;season&quot;</span><span class="p">,</span> <span class="s2">&quot;team1_abbrev&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
</span><span id="Schedule-443"><a href="#Schedule-443"><span class="linenos">443</span></a>                    <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;team1_abbrev&quot;</span><span class="p">:</span> <span class="s2">&quot;abbrev&quot;</span><span class="p">}</span>
</span><span id="Schedule-444"><a href="#Schedule-444"><span class="linenos">444</span></a>                <span class="p">),</span>
</span><span id="Schedule-445"><a href="#Schedule-445"><span class="linenos">445</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="p">[[</span><span class="s2">&quot;season&quot;</span><span class="p">,</span> <span class="s2">&quot;team2_abbrev&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
</span><span id="Schedule-446"><a href="#Schedule-446"><span class="linenos">446</span></a>                    <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;team2_abbrev&quot;</span><span class="p">:</span> <span class="s2">&quot;abbrev&quot;</span><span class="p">}</span>
</span><span id="Schedule-447"><a href="#Schedule-447"><span class="linenos">447</span></a>                <span class="p">),</span>
</span><span id="Schedule-448"><a href="#Schedule-448"><span class="linenos">448</span></a>            <span class="p">]</span>
</span><span id="Schedule-449"><a href="#Schedule-449"><span class="linenos">449</span></a>        <span class="p">)</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Schedule-450"><a href="#Schedule-450"><span class="linenos">450</span></a>        <span class="n">zips</span> <span class="o">=</span> <span class="n">download_zip_codes</span><span class="p">()</span>
</span><span id="Schedule-451"><a href="#Schedule-451"><span class="linenos">451</span></a>        <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">teams</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="Schedule-452"><a href="#Schedule-452"><span class="linenos">452</span></a>            <span class="n">team</span> <span class="o">=</span> <span class="n">teams</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
</span><span id="Schedule-453"><a href="#Schedule-453"><span class="linenos">453</span></a>            <span class="n">stadium_id</span> <span class="o">=</span> <span class="n">get_team_stadium</span><span class="p">(</span><span class="n">team</span><span class="p">[</span><span class="s2">&quot;abbrev&quot;</span><span class="p">],</span> <span class="n">team</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">])</span>
</span><span id="Schedule-454"><a href="#Schedule-454"><span class="linenos">454</span></a>            <span class="n">address</span> <span class="o">=</span> <span class="n">get_address</span><span class="p">(</span><span class="n">stadium_id</span><span class="p">)</span>
</span><span id="Schedule-455"><a href="#Schedule-455"><span class="linenos">455</span></a>            <span class="n">coords</span> <span class="o">=</span> <span class="n">get_coordinates</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">zips</span><span class="p">)</span>
</span><span id="Schedule-456"><a href="#Schedule-456"><span class="linenos">456</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="Schedule-457"><a href="#Schedule-457"><span class="linenos">457</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">team1_abbrev</span> <span class="o">==</span> <span class="n">team</span><span class="p">[</span><span class="s2">&quot;abbrev&quot;</span><span class="p">],</span> <span class="s2">&quot;coords1&quot;</span>
</span><span id="Schedule-458"><a href="#Schedule-458"><span class="linenos">458</span></a>            <span class="p">]</span> <span class="o">=</span> <span class="n">coords</span>
</span><span id="Schedule-459"><a href="#Schedule-459"><span class="linenos">459</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="Schedule-460"><a href="#Schedule-460"><span class="linenos">460</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">team2_abbrev</span> <span class="o">==</span> <span class="n">team</span><span class="p">[</span><span class="s2">&quot;abbrev&quot;</span><span class="p">],</span> <span class="s2">&quot;coords2&quot;</span>
</span><span id="Schedule-461"><a href="#Schedule-461"><span class="linenos">461</span></a>            <span class="p">]</span> <span class="o">=</span> <span class="n">coords</span>
</span><span id="Schedule-462"><a href="#Schedule-462"><span class="linenos">462</span></a>
</span><span id="Schedule-463"><a href="#Schedule-463"><span class="linenos">463</span></a>    <span class="k">def</span> <span class="nf">add_game_coords</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Schedule-464"><a href="#Schedule-464"><span class="linenos">464</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Schedule-465"><a href="#Schedule-465"><span class="linenos">465</span></a><span class="sd">        Adds game coordinates for each of the matchups in the schedule.</span>
</span><span id="Schedule-466"><a href="#Schedule-466"><span class="linenos">466</span></a><span class="sd">        If the game is international, the location is pulled directly from Pro Football Reference.</span>
</span><span id="Schedule-467"><a href="#Schedule-467"><span class="linenos">467</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Schedule-468"><a href="#Schedule-468"><span class="linenos">468</span></a>        <span class="n">neutral</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">game_location</span> <span class="o">==</span> <span class="s2">&quot;N&quot;</span>
</span><span id="Schedule-469"><a href="#Schedule-469"><span class="linenos">469</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">neutral</span><span class="p">,</span> <span class="s2">&quot;game_coords&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="Schedule-470"><a href="#Schedule-470"><span class="linenos">470</span></a>            <span class="o">~</span><span class="n">neutral</span><span class="p">,</span> <span class="s2">&quot;coords1&quot;</span>
</span><span id="Schedule-471"><a href="#Schedule-471"><span class="linenos">471</span></a>        <span class="p">]</span>
</span><span id="Schedule-472"><a href="#Schedule-472"><span class="linenos">472</span></a>        <span class="n">zips</span> <span class="o">=</span> <span class="n">download_zip_codes</span><span class="p">()</span>
</span><span id="Schedule-473"><a href="#Schedule-473"><span class="linenos">473</span></a>        <span class="k">for</span> <span class="n">box</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">neutral</span><span class="p">,</span> <span class="s2">&quot;boxscore_abbrev&quot;</span><span class="p">]:</span>
</span><span id="Schedule-474"><a href="#Schedule-474"><span class="linenos">474</span></a>            <span class="n">stadium_id</span> <span class="o">=</span> <span class="n">get_game_stadium</span><span class="p">(</span><span class="n">box</span><span class="p">)</span>
</span><span id="Schedule-475"><a href="#Schedule-475"><span class="linenos">475</span></a>            <span class="k">if</span> <span class="n">stadium_id</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;attendance&quot;</span><span class="p">]:</span>
</span><span id="Schedule-476"><a href="#Schedule-476"><span class="linenos">476</span></a>                <span class="n">stad_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">boxscore_abbrev</span> <span class="o">==</span> <span class="n">box</span><span class="p">,</span><span class="s2">&quot;Stadium&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Schedule-477"><a href="#Schedule-477"><span class="linenos">477</span></a>                <span class="k">if</span> <span class="n">stad_name</span> <span class="o">==</span> <span class="s2">&quot;Wembley Stadium&quot;</span><span class="p">:</span>
</span><span id="Schedule-478"><a href="#Schedule-478"><span class="linenos">478</span></a>                    <span class="n">stadium_id</span> <span class="o">=</span> <span class="s2">&quot;LON00&quot;</span>
</span><span id="Schedule-479"><a href="#Schedule-479"><span class="linenos">479</span></a>                <span class="k">elif</span> <span class="n">stad_name</span> <span class="o">==</span> <span class="s2">&quot;Tottenham Hotspur Stadium&quot;</span><span class="p">:</span>
</span><span id="Schedule-480"><a href="#Schedule-480"><span class="linenos">480</span></a>                    <span class="n">stadium_id</span> <span class="o">=</span> <span class="s2">&quot;LON02&quot;</span>
</span><span id="Schedule-481"><a href="#Schedule-481"><span class="linenos">481</span></a>                <span class="k">elif</span> <span class="n">stad_name</span> <span class="o">==</span> <span class="s2">&quot;Deutsche Bank Park&quot;</span><span class="p">:</span>
</span><span id="Schedule-482"><a href="#Schedule-482"><span class="linenos">482</span></a>                    <span class="n">stadium_id</span> <span class="o">=</span> <span class="s2">&quot;FRA00&quot;</span>
</span><span id="Schedule-483"><a href="#Schedule-483"><span class="linenos">483</span></a>            <span class="n">address</span> <span class="o">=</span> <span class="n">get_address</span><span class="p">(</span><span class="n">stadium_id</span><span class="p">)</span>
</span><span id="Schedule-484"><a href="#Schedule-484"><span class="linenos">484</span></a>            <span class="n">coords</span> <span class="o">=</span> <span class="n">get_coordinates</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">zips</span><span class="p">)</span>
</span><span id="Schedule-485"><a href="#Schedule-485"><span class="linenos">485</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="Schedule-486"><a href="#Schedule-486"><span class="linenos">486</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">boxscore_abbrev</span> <span class="o">==</span> <span class="n">box</span><span class="p">,</span> <span class="s2">&quot;game_coords&quot;</span>
</span><span id="Schedule-487"><a href="#Schedule-487"><span class="linenos">487</span></a>            <span class="p">]</span> <span class="o">=</span> <span class="n">coords</span>
</span><span id="Schedule-488"><a href="#Schedule-488"><span class="linenos">488</span></a>        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;Stadium&quot;</span><span class="p">]</span>
</span><span id="Schedule-489"><a href="#Schedule-489"><span class="linenos">489</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">game_coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">game_coords</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
</span><span id="Schedule-490"><a href="#Schedule-490"><span class="linenos">490</span></a>
</span><span id="Schedule-491"><a href="#Schedule-491"><span class="linenos">491</span></a>    <span class="k">def</span> <span class="nf">add_travel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Schedule-492"><a href="#Schedule-492"><span class="linenos">492</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Schedule-493"><a href="#Schedule-493"><span class="linenos">493</span></a><span class="sd">        Adds the distance traveled for each team in each matchup of the schedule.</span>
</span><span id="Schedule-494"><a href="#Schedule-494"><span class="linenos">494</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Schedule-495"><a href="#Schedule-495"><span class="linenos">495</span></a>        <span class="k">for</span> <span class="n">team</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]:</span>
</span><span id="Schedule-496"><a href="#Schedule-496"><span class="linenos">496</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;coords&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">team</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="p">[</span>
</span><span id="Schedule-497"><a href="#Schedule-497"><span class="linenos">497</span></a>                <span class="s2">&quot;coords&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">team</span><span class="p">)</span>
</span><span id="Schedule-498"><a href="#Schedule-498"><span class="linenos">498</span></a>            <span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
</span><span id="Schedule-499"><a href="#Schedule-499"><span class="linenos">499</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;travel&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">team</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
</span><span id="Schedule-500"><a href="#Schedule-500"><span class="linenos">500</span></a>                <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">geodesic</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;coords&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">team</span><span class="p">)],</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;game_coords&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">mi</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
</span><span id="Schedule-501"><a href="#Schedule-501"><span class="linenos">501</span></a>            <span class="p">)</span>
</span><span id="Schedule-502"><a href="#Schedule-502"><span class="linenos">502</span></a>
</span><span id="Schedule-503"><a href="#Schedule-503"><span class="linenos">503</span></a>    <span class="k">def</span> <span class="nf">add_rest</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Schedule-504"><a href="#Schedule-504"><span class="linenos">504</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Schedule-505"><a href="#Schedule-505"><span class="linenos">505</span></a><span class="sd">        Identifies teams that had a bye week before the matchup in question.</span>
</span><span id="Schedule-506"><a href="#Schedule-506"><span class="linenos">506</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Schedule-507"><a href="#Schedule-507"><span class="linenos">507</span></a>        <span class="k">for</span> <span class="n">week</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">week</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="Schedule-508"><a href="#Schedule-508"><span class="linenos">508</span></a>            <span class="n">prev</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Schedule-509"><a href="#Schedule-509"><span class="linenos">509</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">week</span> <span class="o">==</span> <span class="n">week</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;team1&quot;</span><span class="p">,</span> <span class="s2">&quot;team2&quot;</span><span class="p">]]</span>
</span><span id="Schedule-510"><a href="#Schedule-510"><span class="linenos">510</span></a>                <span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</span><span id="Schedule-511"><a href="#Schedule-511"><span class="linenos">511</span></a>                <span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="Schedule-512"><a href="#Schedule-512"><span class="linenos">512</span></a>            <span class="p">)</span>
</span><span id="Schedule-513"><a href="#Schedule-513"><span class="linenos">513</span></a>            <span class="n">now</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Schedule-514"><a href="#Schedule-514"><span class="linenos">514</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">week</span> <span class="o">==</span> <span class="n">week</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;team1&quot;</span><span class="p">,</span> <span class="s2">&quot;team2&quot;</span><span class="p">]]</span>
</span><span id="Schedule-515"><a href="#Schedule-515"><span class="linenos">515</span></a>                <span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</span><span id="Schedule-516"><a href="#Schedule-516"><span class="linenos">516</span></a>                <span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="Schedule-517"><a href="#Schedule-517"><span class="linenos">517</span></a>            <span class="p">)</span>
</span><span id="Schedule-518"><a href="#Schedule-518"><span class="linenos">518</span></a>            <span class="n">rested</span> <span class="o">=</span> <span class="p">[</span><span class="n">team</span> <span class="k">for</span> <span class="n">team</span> <span class="ow">in</span> <span class="n">now</span> <span class="k">if</span> <span class="n">team</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">prev</span><span class="p">]</span>
</span><span id="Schedule-519"><a href="#Schedule-519"><span class="linenos">519</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="Schedule-520"><a href="#Schedule-520"><span class="linenos">520</span></a>                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">week</span> <span class="o">==</span> <span class="n">week</span><span class="p">)</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">team1</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">rested</span><span class="p">),</span>
</span><span id="Schedule-521"><a href="#Schedule-521"><span class="linenos">521</span></a>                <span class="s2">&quot;rested1&quot;</span><span class="p">,</span>
</span><span id="Schedule-522"><a href="#Schedule-522"><span class="linenos">522</span></a>            <span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Schedule-523"><a href="#Schedule-523"><span class="linenos">523</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="Schedule-524"><a href="#Schedule-524"><span class="linenos">524</span></a>                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">week</span> <span class="o">==</span> <span class="n">week</span><span class="p">)</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">team2</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">rested</span><span class="p">),</span>
</span><span id="Schedule-525"><a href="#Schedule-525"><span class="linenos">525</span></a>                <span class="s2">&quot;rested2&quot;</span><span class="p">,</span>
</span><span id="Schedule-526"><a href="#Schedule-526"><span class="linenos">526</span></a>            <span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Schedule-527"><a href="#Schedule-527"><span class="linenos">527</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">rested1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">rested1</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
</span><span id="Schedule-528"><a href="#Schedule-528"><span class="linenos">528</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">rested2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">rested2</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
</span><span id="Schedule-529"><a href="#Schedule-529"><span class="linenos">529</span></a>    
</span><span id="Schedule-530"><a href="#Schedule-530"><span class="linenos">530</span></a>    <span class="k">def</span> <span class="nf">add_elo_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qbelo</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="Schedule-531"><a href="#Schedule-531"><span class="linenos">531</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Schedule-532"><a href="#Schedule-532"><span class="linenos">532</span></a><span class="sd">        Adds the necessary columns for elo projections throughout the schedule.</span>
</span><span id="Schedule-533"><a href="#Schedule-533"><span class="linenos">533</span></a>
</span><span id="Schedule-534"><a href="#Schedule-534"><span class="linenos">534</span></a><span class="sd">        Args:</span>
</span><span id="Schedule-535"><a href="#Schedule-535"><span class="linenos">535</span></a><span class="sd">            qbelo (bool, optional): whether to infer QB elo values, defaults to False.</span>
</span><span id="Schedule-536"><a href="#Schedule-536"><span class="linenos">536</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Schedule-537"><a href="#Schedule-537"><span class="linenos">537</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="p">[[</span><span class="s1">&#39;elo1_pre&#39;</span><span class="p">,</span><span class="s1">&#39;elo2_pre&#39;</span><span class="p">,</span><span class="s1">&#39;elo1_post&#39;</span><span class="p">,</span><span class="s1">&#39;elo2_post&#39;</span><span class="p">,</span><span class="s1">&#39;elo_diff&#39;</span><span class="p">,</span>\
</span><span id="Schedule-538"><a href="#Schedule-538"><span class="linenos">538</span></a>        <span class="s1">&#39;point_spread&#39;</span><span class="p">,</span><span class="s1">&#39;elo_prob1&#39;</span><span class="p">,</span><span class="s1">&#39;elo_prob2&#39;</span><span class="p">,</span><span class="s1">&#39;score_diff&#39;</span><span class="p">,</span><span class="s1">&#39;forecast_delta&#39;</span><span class="p">,</span>\
</span><span id="Schedule-539"><a href="#Schedule-539"><span class="linenos">539</span></a>        <span class="s1">&#39;mov_multiplier&#39;</span><span class="p">,</span><span class="s1">&#39;elo_delta&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Schedule-540"><a href="#Schedule-540"><span class="linenos">540</span></a>        <span class="k">if</span> <span class="n">qbelo</span><span class="p">:</span>
</span><span id="Schedule-541"><a href="#Schedule-541"><span class="linenos">541</span></a>            <span class="n">qb_elos</span> <span class="o">=</span> <span class="n">get_qb_elos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">season</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">season</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</span><span id="Schedule-542"><a href="#Schedule-542"><span class="linenos">542</span></a>            <span class="k">for</span> <span class="n">team_num</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="s1">&#39;2&#39;</span><span class="p">]:</span>
</span><span id="Schedule-543"><a href="#Schedule-543"><span class="linenos">543</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="p">,</span><span class="n">right</span><span class="o">=</span><span class="n">qb_elos</span>\
</span><span id="Schedule-544"><a href="#Schedule-544"><span class="linenos">544</span></a>                <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;game_id&#39;</span><span class="p">:</span><span class="s1">&#39;boxscore_abbrev&#39;</span><span class="p">,</span><span class="s1">&#39;team&#39;</span><span class="p">:</span><span class="s1">&#39;team</span><span class="si">{}</span><span class="s1">_abbrev&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">team_num</span><span class="p">),</span>\
</span><span id="Schedule-545"><a href="#Schedule-545"><span class="linenos">545</span></a>                <span class="s1">&#39;player&#39;</span><span class="p">:</span><span class="s1">&#39;qb&#39;</span> <span class="o">+</span> <span class="n">team_num</span><span class="p">,</span><span class="s1">&#39;team_qbvalue_avg&#39;</span><span class="p">:</span><span class="s1">&#39;team</span><span class="si">{}</span><span class="s1">_qbvalue_avg&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">team_num</span><span class="p">),</span>\
</span><span id="Schedule-546"><a href="#Schedule-546"><span class="linenos">546</span></a>                <span class="s1">&#39;opp_qbvalue_avg&#39;</span><span class="p">:</span><span class="s1">&#39;opp</span><span class="si">{}</span><span class="s1">_qbvalue_avg&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">team_num</span><span class="p">),</span>\
</span><span id="Schedule-547"><a href="#Schedule-547"><span class="linenos">547</span></a>                <span class="s1">&#39;qb_value_pre&#39;</span><span class="p">:</span><span class="s1">&#39;qb</span><span class="si">{}</span><span class="s1">_value_pre&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">team_num</span><span class="p">),</span><span class="s1">&#39;qb_adj&#39;</span><span class="p">:</span><span class="s1">&#39;qb</span><span class="si">{}</span><span class="s1">_adj&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">team_num</span><span class="p">),</span>\
</span><span id="Schedule-548"><a href="#Schedule-548"><span class="linenos">548</span></a>                <span class="s1">&#39;qb_value_post&#39;</span><span class="p">:</span><span class="s1">&#39;qb</span><span class="si">{}</span><span class="s1">_value_post&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">team_num</span><span class="p">),</span><span class="s1">&#39;VALUE&#39;</span><span class="p">:</span><span class="s1">&#39;VALUE</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">team_num</span><span class="p">)}),</span>\
</span><span id="Schedule-549"><a href="#Schedule-549"><span class="linenos">549</span></a>                <span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;boxscore_abbrev&#39;</span><span class="p">,</span><span class="s1">&#39;team</span><span class="si">{}</span><span class="s1">_abbrev&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">team_num</span><span class="p">)])</span>
</span><span id="Schedule-550"><a href="#Schedule-550"><span class="linenos">550</span></a>            <span class="c1"># Need to pull depth charts to extrapolate future qbelo values... Ignoring this for now...</span>
</span><span id="Schedule-551"><a href="#Schedule-551"><span class="linenos">551</span></a>
</span><span id="Schedule-552"><a href="#Schedule-552"><span class="linenos">552</span></a>    <span class="k">def</span> <span class="nf">next_init_elo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">init_elo</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1300.0</span><span class="p">,</span> <span class="n">regress_pct</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.333</span><span class="p">):</span>
</span><span id="Schedule-553"><a href="#Schedule-553"><span class="linenos">553</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Schedule-554"><a href="#Schedule-554"><span class="linenos">554</span></a><span class="sd">        Identifies the next matchup that does not have complete elo projections </span>
</span><span id="Schedule-555"><a href="#Schedule-555"><span class="linenos">555</span></a><span class="sd">        and calculates each team&#39;s starting elo rating based on 538&#39;s model (#RIP).</span>
</span><span id="Schedule-556"><a href="#Schedule-556"><span class="linenos">556</span></a>
</span><span id="Schedule-557"><a href="#Schedule-557"><span class="linenos">557</span></a><span class="sd">        Args:</span>
</span><span id="Schedule-558"><a href="#Schedule-558"><span class="linenos">558</span></a><span class="sd">            init_elo (float, optional): initial elo rating to provide new teams with, defaults to 1300.</span>
</span><span id="Schedule-559"><a href="#Schedule-559"><span class="linenos">559</span></a><span class="sd">            regress_pct (float, optional): percentage to regress teams back to the mean between each season, defaults to 0.333.</span>
</span><span id="Schedule-560"><a href="#Schedule-560"><span class="linenos">560</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Schedule-561"><a href="#Schedule-561"><span class="linenos">561</span></a>        <span class="n">ind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">elo1_pre</span><span class="o">.</span><span class="n">isnull</span><span class="p">()]</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Schedule-562"><a href="#Schedule-562"><span class="linenos">562</span></a>        <span class="k">for</span> <span class="n">team_num</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="s1">&#39;2&#39;</span><span class="p">]:</span>
</span><span id="Schedule-563"><a href="#Schedule-563"><span class="linenos">563</span></a>            <span class="n">team</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;team</span><span class="si">{}</span><span class="s1">_abbrev&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">team_num</span><span class="p">)]</span>
</span><span id="Schedule-564"><a href="#Schedule-564"><span class="linenos">564</span></a>            <span class="n">prev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">ind</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Schedule-565"><a href="#Schedule-565"><span class="linenos">565</span></a>            <span class="n">prev</span> <span class="o">=</span> <span class="n">prev</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">prev</span><span class="o">.</span><span class="n">team1_abbrev</span> <span class="o">==</span> <span class="n">team</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">prev</span><span class="o">.</span><span class="n">team2_abbrev</span> <span class="o">==</span> <span class="n">team</span><span class="p">)]</span>
</span><span id="Schedule-566"><a href="#Schedule-566"><span class="linenos">566</span></a>            <span class="k">if</span> <span class="n">prev</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Schedule-567"><a href="#Schedule-567"><span class="linenos">567</span></a>                <span class="c1"># Team already exists</span>
</span><span id="Schedule-568"><a href="#Schedule-568"><span class="linenos">568</span></a>                <span class="n">prev</span> <span class="o">=</span> <span class="n">prev</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Schedule-569"><a href="#Schedule-569"><span class="linenos">569</span></a>                <span class="n">prev_num</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">prev</span><span class="p">[</span><span class="s1">&#39;team1_abbrev&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">team</span> <span class="k">else</span> <span class="mi">2</span>
</span><span id="Schedule-570"><a href="#Schedule-570"><span class="linenos">570</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">prev</span><span class="p">[</span><span class="s1">&#39;elo</span><span class="si">{}</span><span class="s1">_post&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">prev_num</span><span class="p">)]):</span>
</span><span id="Schedule-571"><a href="#Schedule-571"><span class="linenos">571</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo</span><span class="si">{}</span><span class="s1">_pre&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">team_num</span><span class="p">)]</span> <span class="o">=</span> <span class="n">prev</span><span class="p">[</span><span class="s1">&#39;elo</span><span class="si">{}</span><span class="s1">_post&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">prev_num</span><span class="p">)]</span>
</span><span id="Schedule-572"><a href="#Schedule-572"><span class="linenos">572</span></a>                    <span class="k">if</span> <span class="n">prev</span><span class="p">[</span><span class="s1">&#39;season&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;season&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Schedule-573"><a href="#Schedule-573"><span class="linenos">573</span></a>                        <span class="c1"># Start of a new season</span>
</span><span id="Schedule-574"><a href="#Schedule-574"><span class="linenos">574</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo</span><span class="si">{}</span><span class="s1">_pre&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">team_num</span><span class="p">)]</span> <span class="o">+=</span> <span class="p">(</span><span class="mi">1505</span> <span class="o">-</span> <span class="n">prev</span><span class="p">[</span><span class="s1">&#39;elo</span><span class="si">{}</span><span class="s1">_post&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">prev_num</span><span class="p">)])</span><span class="o">*</span><span class="n">regress_pct</span>
</span><span id="Schedule-575"><a href="#Schedule-575"><span class="linenos">575</span></a>                    <span class="k">elif</span> <span class="n">prev</span><span class="p">[</span><span class="s1">&#39;season&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;season&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Schedule-576"><a href="#Schedule-576"><span class="linenos">576</span></a>                        <span class="c1"># Resurrected teams (e.g. 1999 Cleveland Browns)</span>
</span><span id="Schedule-577"><a href="#Schedule-577"><span class="linenos">577</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo</span><span class="si">{}</span><span class="s1">_pre&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">team_num</span><span class="p">)]</span> <span class="o">=</span> <span class="n">init_elo</span>
</span><span id="Schedule-578"><a href="#Schedule-578"><span class="linenos">578</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Schedule-579"><a href="#Schedule-579"><span class="linenos">579</span></a>                    <span class="c1"># Game hasn&#39;t been played yet...</span>
</span><span id="Schedule-580"><a href="#Schedule-580"><span class="linenos">580</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo</span><span class="si">{}</span><span class="s1">_pre&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">team_num</span><span class="p">)]</span> <span class="o">=</span> <span class="n">prev</span><span class="p">[</span><span class="s1">&#39;elo</span><span class="si">{}</span><span class="s1">_pre&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">prev_num</span><span class="p">)]</span>
</span><span id="Schedule-581"><a href="#Schedule-581"><span class="linenos">581</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Schedule-582"><a href="#Schedule-582"><span class="linenos">582</span></a>                <span class="c1"># New Team</span>
</span><span id="Schedule-583"><a href="#Schedule-583"><span class="linenos">583</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo</span><span class="si">{}</span><span class="s1">_pre&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">team_num</span><span class="p">)]</span> <span class="o">=</span> <span class="n">init_elo</span>
</span><span id="Schedule-584"><a href="#Schedule-584"><span class="linenos">584</span></a>            <span class="k">if</span> <span class="s1">&#39;qb</span><span class="si">{}</span><span class="s1">_adj&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">team_num</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="Schedule-585"><a href="#Schedule-585"><span class="linenos">585</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;qbelo</span><span class="si">{}</span><span class="s1">_pre&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">team_num</span><span class="p">)]</span> <span class="o">=</span> \
</span><span id="Schedule-586"><a href="#Schedule-586"><span class="linenos">586</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo</span><span class="si">{}</span><span class="s1">_pre&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">team_num</span><span class="p">)]</span> <span class="o">+</span> \
</span><span id="Schedule-587"><a href="#Schedule-587"><span class="linenos">587</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;qb</span><span class="si">{}</span><span class="s1">_adj&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">team_num</span><span class="p">)]</span>
</span><span id="Schedule-588"><a href="#Schedule-588"><span class="linenos">588</span></a>    
</span><span id="Schedule-589"><a href="#Schedule-589"><span class="linenos">589</span></a>    <span class="k">def</span> <span class="nf">next_elo_prob</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">homefield</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">48.0</span><span class="p">,</span> <span class="n">travel</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.004</span><span class="p">,</span> <span class="n">rested</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">25.0</span><span class="p">,</span> <span class="n">playoffs</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.2</span><span class="p">,</span> <span class="n">elo2points</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.04</span><span class="p">):</span>
</span><span id="Schedule-590"><a href="#Schedule-590"><span class="linenos">590</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Schedule-591"><a href="#Schedule-591"><span class="linenos">591</span></a><span class="sd">        Identifies the next matchup that does not have complete elo projections </span>
</span><span id="Schedule-592"><a href="#Schedule-592"><span class="linenos">592</span></a><span class="sd">        and calculates each team&#39;s win probability based on 538&#39;s model (#RIP).</span>
</span><span id="Schedule-593"><a href="#Schedule-593"><span class="linenos">593</span></a>
</span><span id="Schedule-594"><a href="#Schedule-594"><span class="linenos">594</span></a><span class="sd">        Args:</span>
</span><span id="Schedule-595"><a href="#Schedule-595"><span class="linenos">595</span></a><span class="sd">            homefield (float, optional): elo rating boost for home-field advantage, defaults to 48.</span>
</span><span id="Schedule-596"><a href="#Schedule-596"><span class="linenos">596</span></a><span class="sd">            travel (float, optional): elo rating penalty for travel, defaults to 0.004 per mile traveled.</span>
</span><span id="Schedule-597"><a href="#Schedule-597"><span class="linenos">597</span></a><span class="sd">            rested (float, optional): elo rating boost for rested teams, defaults to 25.</span>
</span><span id="Schedule-598"><a href="#Schedule-598"><span class="linenos">598</span></a><span class="sd">            playoffs (float, optional): elo rating expansion in the playoffs, defaults to 1.2.</span>
</span><span id="Schedule-599"><a href="#Schedule-599"><span class="linenos">599</span></a><span class="sd">            elo2points (float, optional): conversion rate between elo and points, defaults to 0.04.</span>
</span><span id="Schedule-600"><a href="#Schedule-600"><span class="linenos">600</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Schedule-601"><a href="#Schedule-601"><span class="linenos">601</span></a>        <span class="n">ind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">elo_prob1</span><span class="o">.</span><span class="n">isnull</span><span class="p">()]</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Schedule-602"><a href="#Schedule-602"><span class="linenos">602</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo_diff&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo1_pre&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo2_pre&#39;</span><span class="p">]</span>
</span><span id="Schedule-603"><a href="#Schedule-603"><span class="linenos">603</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo_diff&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">homefield</span> <span class="c1"># Homefield advantage</span>
</span><span id="Schedule-604"><a href="#Schedule-604"><span class="linenos">604</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo_diff&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">travel</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;travel2&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;travel1&#39;</span><span class="p">])</span> <span class="c1"># Travel</span>
</span><span id="Schedule-605"><a href="#Schedule-605"><span class="linenos">605</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;rested1&#39;</span><span class="p">]:</span>
</span><span id="Schedule-606"><a href="#Schedule-606"><span class="linenos">606</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo_diff&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">rested</span> <span class="c1"># Bye week</span>
</span><span id="Schedule-607"><a href="#Schedule-607"><span class="linenos">607</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;rested2&#39;</span><span class="p">]:</span>
</span><span id="Schedule-608"><a href="#Schedule-608"><span class="linenos">608</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo_diff&#39;</span><span class="p">]</span> <span class="o">-=</span> <span class="n">rested</span> <span class="c1"># Bye week</span>
</span><span id="Schedule-609"><a href="#Schedule-609"><span class="linenos">609</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;week_num&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isnumeric</span><span class="p">():</span>
</span><span id="Schedule-610"><a href="#Schedule-610"><span class="linenos">610</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo_diff&#39;</span><span class="p">]</span> <span class="o">*=</span> <span class="n">playoffs</span> <span class="c1"># Playoffs</span>
</span><span id="Schedule-611"><a href="#Schedule-611"><span class="linenos">611</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;point_spread&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo_diff&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">elo2points</span>
</span><span id="Schedule-612"><a href="#Schedule-612"><span class="linenos">612</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo_prob1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo_diff&#39;</span><span class="p">]</span><span class="o">/-</span><span class="mi">400</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Schedule-613"><a href="#Schedule-613"><span class="linenos">613</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo_prob2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo_prob1&#39;</span><span class="p">]</span>
</span><span id="Schedule-614"><a href="#Schedule-614"><span class="linenos">614</span></a>        <span class="k">if</span> <span class="s1">&#39;qb1_adj&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="s1">&#39;qb2_adj&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="Schedule-615"><a href="#Schedule-615"><span class="linenos">615</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;qbelo_diff&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo_diff&#39;</span><span class="p">]</span> <span class="o">+</span> \
</span><span id="Schedule-616"><a href="#Schedule-616"><span class="linenos">616</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;qb1_adj&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;qb2_adj&#39;</span><span class="p">]</span>
</span><span id="Schedule-617"><a href="#Schedule-617"><span class="linenos">617</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;qbpoint_spread&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;qbelo_diff&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">elo2points</span>
</span><span id="Schedule-618"><a href="#Schedule-618"><span class="linenos">618</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;qbelo_prob1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;qbelo_diff&#39;</span><span class="p">]</span><span class="o">/-</span><span class="mi">400</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Schedule-619"><a href="#Schedule-619"><span class="linenos">619</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;qbelo_prob2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;qbelo_prob1&#39;</span><span class="p">]</span>
</span><span id="Schedule-620"><a href="#Schedule-620"><span class="linenos">620</span></a>
</span><span id="Schedule-621"><a href="#Schedule-621"><span class="linenos">621</span></a>    <span class="k">def</span> <span class="nf">next_elo_delta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k_factor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">20.0</span><span class="p">):</span>
</span><span id="Schedule-622"><a href="#Schedule-622"><span class="linenos">622</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Schedule-623"><a href="#Schedule-623"><span class="linenos">623</span></a><span class="sd">        Identifies the next matchup that does not have complete elo projections </span>
</span><span id="Schedule-624"><a href="#Schedule-624"><span class="linenos">624</span></a><span class="sd">        and calculates each team&#39;s new elo rating based on the results of that game.</span>
</span><span id="Schedule-625"><a href="#Schedule-625"><span class="linenos">625</span></a>
</span><span id="Schedule-626"><a href="#Schedule-626"><span class="linenos">626</span></a><span class="sd">        Args:</span>
</span><span id="Schedule-627"><a href="#Schedule-627"><span class="linenos">627</span></a><span class="sd">            k_factor (float, optional): scaling factor that dictates how much ratings should shift based on recent results, defaults to 20.</span>
</span><span id="Schedule-628"><a href="#Schedule-628"><span class="linenos">628</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Schedule-629"><a href="#Schedule-629"><span class="linenos">629</span></a>        <span class="n">ind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">elo_prob1</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">elo_delta</span><span class="o">.</span><span class="n">isnull</span><span class="p">()]</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Schedule-630"><a href="#Schedule-630"><span class="linenos">630</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;score1&#39;</span><span class="p">]):</span>
</span><span id="Schedule-631"><a href="#Schedule-631"><span class="linenos">631</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;score_diff&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;score1&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;score2&#39;</span><span class="p">]</span>
</span><span id="Schedule-632"><a href="#Schedule-632"><span class="linenos">632</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;forecast_delta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;score_diff&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> \
</span><span id="Schedule-633"><a href="#Schedule-633"><span class="linenos">633</span></a>            <span class="mf">0.5</span><span class="o">*</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;score_diff&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo_prob1&#39;</span><span class="p">]</span>
</span><span id="Schedule-634"><a href="#Schedule-634"><span class="linenos">634</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;mov_multiplier&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;score_diff&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mf">2.2</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo_diff&#39;</span><span class="p">]</span><span class="o">*</span><span class="mf">0.001</span> <span class="o">+</span> <span class="mf">2.2</span><span class="p">)</span>
</span><span id="Schedule-635"><a href="#Schedule-635"><span class="linenos">635</span></a>            <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;mov_multiplier&#39;</span><span class="p">]):</span>
</span><span id="Schedule-636"><a href="#Schedule-636"><span class="linenos">636</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;mov_multiplier&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Schedule-637"><a href="#Schedule-637"><span class="linenos">637</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo_delta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;forecast_delta&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;mov_multiplier&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">k_factor</span>
</span><span id="Schedule-638"><a href="#Schedule-638"><span class="linenos">638</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo1_post&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo1_pre&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo_delta&#39;</span><span class="p">]</span>
</span><span id="Schedule-639"><a href="#Schedule-639"><span class="linenos">639</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo2_post&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo2_pre&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo_delta&#39;</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Schedule class that gathers all matchups and outcomes for the seasons in question and
assess the evolution of each team's elo ranking according to 538's methodology.</p>

<p>Attributes:
    schedule: dataframe containing matchup details for the seasons of interest.</p>
</div>


                            <div id="Schedule.__init__" class="classattr">
                                        <input id="Schedule.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">Schedule</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">start</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">finish</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">playoffs</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">elo</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">qbelo</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span>)</span>

                <label class="view-source-button" for="Schedule.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Schedule.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Schedule.__init__-321"><a href="#Schedule.__init__-321"><span class="linenos">321</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">finish</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">playoffs</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">elo</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">qbelo</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="Schedule.__init__-322"><a href="#Schedule.__init__-322"><span class="linenos">322</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Schedule.__init__-323"><a href="#Schedule.__init__-323"><span class="linenos">323</span></a><span class="sd">        Initializes a Schedule object using the parameters provided and class functions defined below.</span>
</span><span id="Schedule.__init__-324"><a href="#Schedule.__init__-324"><span class="linenos">324</span></a>
</span><span id="Schedule.__init__-325"><a href="#Schedule.__init__-325"><span class="linenos">325</span></a><span class="sd">        Args:</span>
</span><span id="Schedule.__init__-326"><a href="#Schedule.__init__-326"><span class="linenos">326</span></a><span class="sd">            start (int): first NFL season of interest</span>
</span><span id="Schedule.__init__-327"><a href="#Schedule.__init__-327"><span class="linenos">327</span></a><span class="sd">            finish (int): last NFL season of interest</span>
</span><span id="Schedule.__init__-328"><a href="#Schedule.__init__-328"><span class="linenos">328</span></a><span class="sd">            playoffs (bool, optional): whether to include playoff games, defaults to True.</span>
</span><span id="Schedule.__init__-329"><a href="#Schedule.__init__-329"><span class="linenos">329</span></a><span class="sd">            elo (bool, optional): whether to include elo rating considerations, defaults to False.</span>
</span><span id="Schedule.__init__-330"><a href="#Schedule.__init__-330"><span class="linenos">330</span></a><span class="sd">            qbelo (bool, optional): whether to include QB elo rating considerations, defaults to False.</span>
</span><span id="Schedule.__init__-331"><a href="#Schedule.__init__-331"><span class="linenos">331</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Schedule.__init__-332"><a href="#Schedule.__init__-332"><span class="linenos">332</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">get_schedules</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">finish</span><span class="p">)</span>
</span><span id="Schedule.__init__-333"><a href="#Schedule.__init__-333"><span class="linenos">333</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_weeks</span><span class="p">()</span>
</span><span id="Schedule.__init__-334"><a href="#Schedule.__init__-334"><span class="linenos">334</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">convert_to_home_away</span><span class="p">()</span>
</span><span id="Schedule.__init__-335"><a href="#Schedule.__init__-335"><span class="linenos">335</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mark_intl_games</span><span class="p">()</span>
</span><span id="Schedule.__init__-336"><a href="#Schedule.__init__-336"><span class="linenos">336</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_rest</span><span class="p">()</span>
</span><span id="Schedule.__init__-337"><a href="#Schedule.__init__-337"><span class="linenos">337</span></a>        <span class="k">if</span> <span class="n">elo</span><span class="p">:</span>
</span><span id="Schedule.__init__-338"><a href="#Schedule.__init__-338"><span class="linenos">338</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">add_team_coords</span><span class="p">()</span>
</span><span id="Schedule.__init__-339"><a href="#Schedule.__init__-339"><span class="linenos">339</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">add_game_coords</span><span class="p">()</span>
</span><span id="Schedule.__init__-340"><a href="#Schedule.__init__-340"><span class="linenos">340</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">add_travel</span><span class="p">()</span>
</span><span id="Schedule.__init__-341"><a href="#Schedule.__init__-341"><span class="linenos">341</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">add_elo_columns</span><span class="p">(</span><span class="n">qbelo</span><span class="p">)</span>
</span><span id="Schedule.__init__-342"><a href="#Schedule.__init__-342"><span class="linenos">342</span></a>            <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">elo1_pre</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="Schedule.__init__-343"><a href="#Schedule.__init__-343"><span class="linenos">343</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">next_init_elo</span><span class="p">()</span>
</span><span id="Schedule.__init__-344"><a href="#Schedule.__init__-344"><span class="linenos">344</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">next_elo_prob</span><span class="p">()</span>
</span><span id="Schedule.__init__-345"><a href="#Schedule.__init__-345"><span class="linenos">345</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">next_elo_delta</span><span class="p">()</span>
</span><span id="Schedule.__init__-346"><a href="#Schedule.__init__-346"><span class="linenos">346</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">playoffs</span><span class="p">:</span>
</span><span id="Schedule.__init__-347"><a href="#Schedule.__init__-347"><span class="linenos">347</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="Schedule.__init__-348"><a href="#Schedule.__init__-348"><span class="linenos">348</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">week_num</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">isnumeric</span><span class="p">()</span>
</span><span id="Schedule.__init__-349"><a href="#Schedule.__init__-349"><span class="linenos">349</span></a>            <span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Initializes a Schedule object using the parameters provided and class functions defined below.</p>

<p>Args:
    start (int): first NFL season of interest
    finish (int): last NFL season of interest
    playoffs (bool, optional): whether to include playoff games, defaults to True.
    elo (bool, optional): whether to include elo rating considerations, defaults to False.
    qbelo (bool, optional): whether to include QB elo rating considerations, defaults to False.</p>
</div>


                            </div>
                            <div id="Schedule.get_schedules" class="classattr">
                                        <input id="Schedule.get_schedules-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_schedules</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">start</span><span class="p">:</span> <span class="nb">int</span>, </span><span class="param"><span class="n">finish</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Schedule.get_schedules-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Schedule.get_schedules"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Schedule.get_schedules-351"><a href="#Schedule.get_schedules-351"><span class="linenos">351</span></a>    <span class="k">def</span> <span class="nf">get_schedules</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">finish</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="Schedule.get_schedules-352"><a href="#Schedule.get_schedules-352"><span class="linenos">352</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Schedule.get_schedules-353"><a href="#Schedule.get_schedules-353"><span class="linenos">353</span></a><span class="sd">        Pulls the full NFL schedules for the seasons provided.</span>
</span><span id="Schedule.get_schedules-354"><a href="#Schedule.get_schedules-354"><span class="linenos">354</span></a>
</span><span id="Schedule.get_schedules-355"><a href="#Schedule.get_schedules-355"><span class="linenos">355</span></a><span class="sd">        Args:</span>
</span><span id="Schedule.get_schedules-356"><a href="#Schedule.get_schedules-356"><span class="linenos">356</span></a><span class="sd">            start (int): first season of interest</span>
</span><span id="Schedule.get_schedules-357"><a href="#Schedule.get_schedules-357"><span class="linenos">357</span></a><span class="sd">            finish (int): last season of interest</span>
</span><span id="Schedule.get_schedules-358"><a href="#Schedule.get_schedules-358"><span class="linenos">358</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Schedule.get_schedules-359"><a href="#Schedule.get_schedules-359"><span class="linenos">359</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">])</span>
</span><span id="Schedule.get_schedules-360"><a href="#Schedule.get_schedules-360"><span class="linenos">360</span></a>        <span class="k">for</span> <span class="n">season</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">start</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">finish</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="Schedule.get_schedules-361"><a href="#Schedule.get_schedules-361"><span class="linenos">361</span></a>            <span class="n">raw_text</span> <span class="o">=</span> <span class="n">get_page</span><span class="p">(</span><span class="s2">&quot;years/</span><span class="si">{}</span><span class="s2">/games.htm&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">season</span><span class="p">))</span>
</span><span id="Schedule.get_schedules-362"><a href="#Schedule.get_schedules-362"><span class="linenos">362</span></a>            <span class="n">season_sched</span> <span class="o">=</span> <span class="n">parse_table</span><span class="p">(</span><span class="n">raw_text</span><span class="p">,</span> <span class="s2">&quot;games&quot;</span><span class="p">)</span>
</span><span id="Schedule.get_schedules-363"><a href="#Schedule.get_schedules-363"><span class="linenos">363</span></a>            <span class="n">season_sched</span><span class="o">.</span><span class="n">week_num</span> <span class="o">=</span> <span class="n">season_sched</span><span class="o">.</span><span class="n">week_num</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Schedule.get_schedules-364"><a href="#Schedule.get_schedules-364"><span class="linenos">364</span></a>            <span class="n">season_sched</span> <span class="o">=</span> <span class="n">season_sched</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">season_sched</span><span class="o">.</span><span class="n">week_num</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;Pre&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Schedule.get_schedules-365"><a href="#Schedule.get_schedules-365"><span class="linenos">365</span></a>            <span class="n">season_sched</span><span class="p">[</span><span class="s1">&#39;season&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">season</span>
</span><span id="Schedule.get_schedules-366"><a href="#Schedule.get_schedules-366"><span class="linenos">366</span></a>            <span class="k">if</span> <span class="s2">&quot;game_date&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">season_sched</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span> <span class="c1"># Current season</span>
</span><span id="Schedule.get_schedules-367"><a href="#Schedule.get_schedules-367"><span class="linenos">367</span></a>                <span class="n">season_sched</span><span class="p">[</span><span class="s1">&#39;game_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">season_sched</span><span class="o">.</span><span class="n">boxscore_word</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span> <span class="o">+</span> \
</span><span id="Schedule.get_schedules-368"><a href="#Schedule.get_schedules-368"><span class="linenos">368</span></a>                <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">year</span> <span class="o">+</span> <span class="n">season_sched</span><span class="o">.</span><span class="n">boxscore_word</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;January&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
</span><span id="Schedule.get_schedules-369"><a href="#Schedule.get_schedules-369"><span class="linenos">369</span></a>                <span class="n">season_sched</span> <span class="o">=</span> <span class="n">season_sched</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;visitor_team&#39;</span><span class="p">:</span><span class="s1">&#39;winner&#39;</span><span class="p">,</span>\
</span><span id="Schedule.get_schedules-370"><a href="#Schedule.get_schedules-370"><span class="linenos">370</span></a>                <span class="s1">&#39;visitor_team_abbrev&#39;</span><span class="p">:</span><span class="s1">&#39;winner_abbrev&#39;</span><span class="p">,</span><span class="s1">&#39;home_team&#39;</span><span class="p">:</span><span class="s1">&#39;loser&#39;</span><span class="p">,</span><span class="s1">&#39;home_team_abbrev&#39;</span><span class="p">:</span><span class="s1">&#39;loser_abbrev&#39;</span><span class="p">})</span>
</span><span id="Schedule.get_schedules-371"><a href="#Schedule.get_schedules-371"><span class="linenos">371</span></a>                <span class="n">season_sched</span><span class="p">[[</span><span class="s1">&#39;yards_win&#39;</span><span class="p">,</span><span class="s1">&#39;to_win&#39;</span><span class="p">,</span><span class="s1">&#39;yards_lose&#39;</span><span class="p">,</span><span class="s1">&#39;to_lose&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Schedule.get_schedules-372"><a href="#Schedule.get_schedules-372"><span class="linenos">372</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="p">,</span> <span class="n">season_sched</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Pulls the full NFL schedules for the seasons provided.</p>

<p>Args:
    start (int): first season of interest
    finish (int): last season of interest</p>
</div>


                            </div>
                            <div id="Schedule.add_weeks" class="classattr">
                                        <input id="Schedule.add_weeks-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_weeks</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Schedule.add_weeks-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Schedule.add_weeks"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Schedule.add_weeks-374"><a href="#Schedule.add_weeks-374"><span class="linenos">374</span></a>    <span class="k">def</span> <span class="nf">add_weeks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Schedule.add_weeks-375"><a href="#Schedule.add_weeks-375"><span class="linenos">375</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Schedule.add_weeks-376"><a href="#Schedule.add_weeks-376"><span class="linenos">376</span></a><span class="sd">        Infers season week based on game dates for each season.</span>
</span><span id="Schedule.add_weeks-377"><a href="#Schedule.add_weeks-377"><span class="linenos">377</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Schedule.add_weeks-378"><a href="#Schedule.add_weeks-378"><span class="linenos">378</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">game_date</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">game_date</span><span class="p">)</span>
</span><span id="Schedule.add_weeks-379"><a href="#Schedule.add_weeks-379"><span class="linenos">379</span></a>        <span class="n">min_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;season&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">game_date</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="Schedule.add_weeks-380"><a href="#Schedule.add_weeks-380"><span class="linenos">380</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="Schedule.add_weeks-381"><a href="#Schedule.add_weeks-381"><span class="linenos">381</span></a>            <span class="n">left</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="p">,</span>
</span><span id="Schedule.add_weeks-382"><a href="#Schedule.add_weeks-382"><span class="linenos">382</span></a>            <span class="n">right</span><span class="o">=</span><span class="n">min_date</span><span class="p">,</span>
</span><span id="Schedule.add_weeks-383"><a href="#Schedule.add_weeks-383"><span class="linenos">383</span></a>            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">,</span>
</span><span id="Schedule.add_weeks-384"><a href="#Schedule.add_weeks-384"><span class="linenos">384</span></a>            <span class="n">on</span><span class="o">=</span><span class="s2">&quot;season&quot;</span><span class="p">,</span>
</span><span id="Schedule.add_weeks-385"><a href="#Schedule.add_weeks-385"><span class="linenos">385</span></a>            <span class="n">suffixes</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;_min&quot;</span><span class="p">),</span>
</span><span id="Schedule.add_weeks-386"><a href="#Schedule.add_weeks-386"><span class="linenos">386</span></a>        <span class="p">)</span>
</span><span id="Schedule.add_weeks-387"><a href="#Schedule.add_weeks-387"><span class="linenos">387</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;days_into_season&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Schedule.add_weeks-388"><a href="#Schedule.add_weeks-388"><span class="linenos">388</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">game_date</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">game_date_min</span>
</span><span id="Schedule.add_weeks-389"><a href="#Schedule.add_weeks-389"><span class="linenos">389</span></a>        <span class="p">)</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">days</span>
</span><span id="Schedule.add_weeks-390"><a href="#Schedule.add_weeks-390"><span class="linenos">390</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;week&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">days_into_season</span> <span class="o">//</span> <span class="mi">7</span> <span class="o">+</span> <span class="mi">1</span>
</span></pre></div>


            <div class="docstring"><p>Infers season week based on game dates for each season.</p>
</div>


                            </div>
                            <div id="Schedule.convert_to_home_away" class="classattr">
                                        <input id="Schedule.convert_to_home_away-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">convert_to_home_away</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Schedule.convert_to_home_away-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Schedule.convert_to_home_away"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Schedule.convert_to_home_away-392"><a href="#Schedule.convert_to_home_away-392"><span class="linenos">392</span></a>    <span class="k">def</span> <span class="nf">convert_to_home_away</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Schedule.convert_to_home_away-393"><a href="#Schedule.convert_to_home_away-393"><span class="linenos">393</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Schedule.convert_to_home_away-394"><a href="#Schedule.convert_to_home_away-394"><span class="linenos">394</span></a><span class="sd">        Converts winner/loser syntax of Pro Football Reference schedules into home/away.</span>
</span><span id="Schedule.convert_to_home_away-395"><a href="#Schedule.convert_to_home_away-395"><span class="linenos">395</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Schedule.convert_to_home_away-396"><a href="#Schedule.convert_to_home_away-396"><span class="linenos">396</span></a>        <span class="n">list1</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;team1&quot;</span><span class="p">,</span><span class="s2">&quot;team1_abbrev&quot;</span><span class="p">,</span><span class="s2">&quot;score1&quot;</span><span class="p">,</span><span class="s2">&quot;yards1&quot;</span><span class="p">,</span><span class="s2">&quot;timeouts1&quot;</span><span class="p">]</span>
</span><span id="Schedule.convert_to_home_away-397"><a href="#Schedule.convert_to_home_away-397"><span class="linenos">397</span></a>        <span class="n">list2</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;team2&quot;</span><span class="p">,</span><span class="s2">&quot;team2_abbrev&quot;</span><span class="p">,</span><span class="s2">&quot;score2&quot;</span><span class="p">,</span><span class="s2">&quot;yards2&quot;</span><span class="p">,</span><span class="s2">&quot;timeouts2&quot;</span><span class="p">]</span>
</span><span id="Schedule.convert_to_home_away-398"><a href="#Schedule.convert_to_home_away-398"><span class="linenos">398</span></a>        <span class="n">winner_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;winner&quot;</span><span class="p">,</span><span class="s2">&quot;winner_abbrev&quot;</span><span class="p">,</span><span class="s2">&quot;pts_win&quot;</span><span class="p">,</span><span class="s2">&quot;yards_win&quot;</span><span class="p">,</span><span class="s2">&quot;to_win&quot;</span><span class="p">]</span>
</span><span id="Schedule.convert_to_home_away-399"><a href="#Schedule.convert_to_home_away-399"><span class="linenos">399</span></a>        <span class="n">loser_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;loser&quot;</span><span class="p">,</span><span class="s2">&quot;loser_abbrev&quot;</span><span class="p">,</span><span class="s2">&quot;pts_lose&quot;</span><span class="p">,</span><span class="s2">&quot;yards_lose&quot;</span><span class="p">,</span><span class="s2">&quot;to_lose&quot;</span><span class="p">]</span>
</span><span id="Schedule.convert_to_home_away-400"><a href="#Schedule.convert_to_home_away-400"><span class="linenos">400</span></a>        <span class="n">home_loser</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">game_location</span> <span class="o">==</span> <span class="s2">&quot;@&quot;</span>
</span><span id="Schedule.convert_to_home_away-401"><a href="#Schedule.convert_to_home_away-401"><span class="linenos">401</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">home_loser</span><span class="p">,</span> <span class="n">list1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">home_loser</span><span class="p">,</span> <span class="n">loser_list</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="Schedule.convert_to_home_away-402"><a href="#Schedule.convert_to_home_away-402"><span class="linenos">402</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">home_loser</span><span class="p">,</span> <span class="n">list2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">home_loser</span><span class="p">,</span> <span class="n">winner_list</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="Schedule.convert_to_home_away-403"><a href="#Schedule.convert_to_home_away-403"><span class="linenos">403</span></a>        <span class="n">away_loser</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">game_location</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">game_location</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;N&quot;</span><span class="p">])</span>
</span><span id="Schedule.convert_to_home_away-404"><a href="#Schedule.convert_to_home_away-404"><span class="linenos">404</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">away_loser</span><span class="p">,</span> <span class="n">list1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">away_loser</span><span class="p">,</span> <span class="n">winner_list</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="Schedule.convert_to_home_away-405"><a href="#Schedule.convert_to_home_away-405"><span class="linenos">405</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">away_loser</span><span class="p">,</span> <span class="n">list2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">away_loser</span><span class="p">,</span> <span class="n">loser_list</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span></pre></div>


            <div class="docstring"><p>Converts winner/loser syntax of Pro Football Reference schedules into home/away.</p>
</div>


                            </div>
                            <div id="Schedule.mark_intl_games" class="classattr">
                                        <input id="Schedule.mark_intl_games-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">mark_intl_games</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Schedule.mark_intl_games-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Schedule.mark_intl_games"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Schedule.mark_intl_games-407"><a href="#Schedule.mark_intl_games-407"><span class="linenos">407</span></a>    <span class="k">def</span> <span class="nf">mark_intl_games</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Schedule.mark_intl_games-408"><a href="#Schedule.mark_intl_games-408"><span class="linenos">408</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Schedule.mark_intl_games-409"><a href="#Schedule.mark_intl_games-409"><span class="linenos">409</span></a><span class="sd">        Identifies international games in the provided schedule (used when accounting for team travel).</span>
</span><span id="Schedule.mark_intl_games-410"><a href="#Schedule.mark_intl_games-410"><span class="linenos">410</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Schedule.mark_intl_games-411"><a href="#Schedule.mark_intl_games-411"><span class="linenos">411</span></a>        <span class="n">intl</span> <span class="o">=</span> <span class="n">get_intl_games</span><span class="p">()</span>
</span><span id="Schedule.mark_intl_games-412"><a href="#Schedule.mark_intl_games-412"><span class="linenos">412</span></a>        <span class="n">intl</span> <span class="o">=</span> <span class="n">intl</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="Schedule.mark_intl_games-413"><a href="#Schedule.mark_intl_games-413"><span class="linenos">413</span></a>            <span class="p">(</span><span class="n">intl</span><span class="o">.</span><span class="n">game_date</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">season</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
</span><span id="Schedule.mark_intl_games-414"><a href="#Schedule.mark_intl_games-414"><span class="linenos">414</span></a>            <span class="o">&amp;</span> <span class="p">(</span><span class="n">intl</span><span class="o">.</span><span class="n">game_date</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">season</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</span><span id="Schedule.mark_intl_games-415"><a href="#Schedule.mark_intl_games-415"><span class="linenos">415</span></a>        <span class="p">]</span>
</span><span id="Schedule.mark_intl_games-416"><a href="#Schedule.mark_intl_games-416"><span class="linenos">416</span></a>        <span class="n">intl</span><span class="p">[</span><span class="s2">&quot;international&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Schedule.mark_intl_games-417"><a href="#Schedule.mark_intl_games-417"><span class="linenos">417</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="Schedule.mark_intl_games-418"><a href="#Schedule.mark_intl_games-418"><span class="linenos">418</span></a>            <span class="n">left</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="p">,</span>
</span><span id="Schedule.mark_intl_games-419"><a href="#Schedule.mark_intl_games-419"><span class="linenos">419</span></a>            <span class="n">right</span><span class="o">=</span><span class="n">intl</span><span class="p">,</span>
</span><span id="Schedule.mark_intl_games-420"><a href="#Schedule.mark_intl_games-420"><span class="linenos">420</span></a>            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
</span><span id="Schedule.mark_intl_games-421"><a href="#Schedule.mark_intl_games-421"><span class="linenos">421</span></a>            <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;game_date&quot;</span><span class="p">,</span> <span class="s2">&quot;team1&quot;</span><span class="p">,</span> <span class="s2">&quot;team2&quot;</span><span class="p">],</span>
</span><span id="Schedule.mark_intl_games-422"><a href="#Schedule.mark_intl_games-422"><span class="linenos">422</span></a>        <span class="p">)</span>
</span><span id="Schedule.mark_intl_games-423"><a href="#Schedule.mark_intl_games-423"><span class="linenos">423</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">international</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">international</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
</span><span id="Schedule.mark_intl_games-424"><a href="#Schedule.mark_intl_games-424"><span class="linenos">424</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">international</span><span class="p">,</span> <span class="s2">&quot;game_location&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;N&quot;</span>
</span><span id="Schedule.mark_intl_games-425"><a href="#Schedule.mark_intl_games-425"><span class="linenos">425</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">international</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">intl</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="Schedule.mark_intl_games-426"><a href="#Schedule.mark_intl_games-426"><span class="linenos">426</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Missing some international games!!!&quot;</span><span class="p">)</span>
</span><span id="Schedule.mark_intl_games-427"><a href="#Schedule.mark_intl_games-427"><span class="linenos">427</span></a>            <span class="n">bad</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="Schedule.mark_intl_games-428"><a href="#Schedule.mark_intl_games-428"><span class="linenos">428</span></a>                <span class="n">left</span><span class="o">=</span><span class="n">intl</span><span class="p">,</span>
</span><span id="Schedule.mark_intl_games-429"><a href="#Schedule.mark_intl_games-429"><span class="linenos">429</span></a>                <span class="n">right</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="p">[[</span><span class="s2">&quot;boxscore_abbrev&quot;</span><span class="p">,</span> <span class="s2">&quot;game_date&quot;</span><span class="p">,</span> <span class="s2">&quot;team1&quot;</span><span class="p">,</span> <span class="s2">&quot;team2&quot;</span><span class="p">]],</span>
</span><span id="Schedule.mark_intl_games-430"><a href="#Schedule.mark_intl_games-430"><span class="linenos">430</span></a>                <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
</span><span id="Schedule.mark_intl_games-431"><a href="#Schedule.mark_intl_games-431"><span class="linenos">431</span></a>                <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;game_date&quot;</span><span class="p">,</span> <span class="s2">&quot;team1&quot;</span><span class="p">,</span> <span class="s2">&quot;team2&quot;</span><span class="p">],</span>
</span><span id="Schedule.mark_intl_games-432"><a href="#Schedule.mark_intl_games-432"><span class="linenos">432</span></a>            <span class="p">)</span>
</span><span id="Schedule.mark_intl_games-433"><a href="#Schedule.mark_intl_games-433"><span class="linenos">433</span></a>            <span class="n">bad</span> <span class="o">=</span> <span class="n">bad</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">bad</span><span class="o">.</span><span class="n">boxscore_abbrev</span><span class="o">.</span><span class="n">isnull</span><span class="p">()]</span>
</span><span id="Schedule.mark_intl_games-434"><a href="#Schedule.mark_intl_games-434"><span class="linenos">434</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">bad</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Identifies international games in the provided schedule (used when accounting for team travel).</p>
</div>


                            </div>
                            <div id="Schedule.add_team_coords" class="classattr">
                                        <input id="Schedule.add_team_coords-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_team_coords</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Schedule.add_team_coords-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Schedule.add_team_coords"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Schedule.add_team_coords-436"><a href="#Schedule.add_team_coords-436"><span class="linenos">436</span></a>    <span class="k">def</span> <span class="nf">add_team_coords</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Schedule.add_team_coords-437"><a href="#Schedule.add_team_coords-437"><span class="linenos">437</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Schedule.add_team_coords-438"><a href="#Schedule.add_team_coords-438"><span class="linenos">438</span></a><span class="sd">        Adds the home coordinates for each team in each matchup of the schedule.</span>
</span><span id="Schedule.add_team_coords-439"><a href="#Schedule.add_team_coords-439"><span class="linenos">439</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Schedule.add_team_coords-440"><a href="#Schedule.add_team_coords-440"><span class="linenos">440</span></a>        <span class="n">teams</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
</span><span id="Schedule.add_team_coords-441"><a href="#Schedule.add_team_coords-441"><span class="linenos">441</span></a>            <span class="p">[</span>
</span><span id="Schedule.add_team_coords-442"><a href="#Schedule.add_team_coords-442"><span class="linenos">442</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="p">[[</span><span class="s2">&quot;season&quot;</span><span class="p">,</span> <span class="s2">&quot;team1_abbrev&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
</span><span id="Schedule.add_team_coords-443"><a href="#Schedule.add_team_coords-443"><span class="linenos">443</span></a>                    <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;team1_abbrev&quot;</span><span class="p">:</span> <span class="s2">&quot;abbrev&quot;</span><span class="p">}</span>
</span><span id="Schedule.add_team_coords-444"><a href="#Schedule.add_team_coords-444"><span class="linenos">444</span></a>                <span class="p">),</span>
</span><span id="Schedule.add_team_coords-445"><a href="#Schedule.add_team_coords-445"><span class="linenos">445</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="p">[[</span><span class="s2">&quot;season&quot;</span><span class="p">,</span> <span class="s2">&quot;team2_abbrev&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
</span><span id="Schedule.add_team_coords-446"><a href="#Schedule.add_team_coords-446"><span class="linenos">446</span></a>                    <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;team2_abbrev&quot;</span><span class="p">:</span> <span class="s2">&quot;abbrev&quot;</span><span class="p">}</span>
</span><span id="Schedule.add_team_coords-447"><a href="#Schedule.add_team_coords-447"><span class="linenos">447</span></a>                <span class="p">),</span>
</span><span id="Schedule.add_team_coords-448"><a href="#Schedule.add_team_coords-448"><span class="linenos">448</span></a>            <span class="p">]</span>
</span><span id="Schedule.add_team_coords-449"><a href="#Schedule.add_team_coords-449"><span class="linenos">449</span></a>        <span class="p">)</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Schedule.add_team_coords-450"><a href="#Schedule.add_team_coords-450"><span class="linenos">450</span></a>        <span class="n">zips</span> <span class="o">=</span> <span class="n">download_zip_codes</span><span class="p">()</span>
</span><span id="Schedule.add_team_coords-451"><a href="#Schedule.add_team_coords-451"><span class="linenos">451</span></a>        <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">teams</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="Schedule.add_team_coords-452"><a href="#Schedule.add_team_coords-452"><span class="linenos">452</span></a>            <span class="n">team</span> <span class="o">=</span> <span class="n">teams</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
</span><span id="Schedule.add_team_coords-453"><a href="#Schedule.add_team_coords-453"><span class="linenos">453</span></a>            <span class="n">stadium_id</span> <span class="o">=</span> <span class="n">get_team_stadium</span><span class="p">(</span><span class="n">team</span><span class="p">[</span><span class="s2">&quot;abbrev&quot;</span><span class="p">],</span> <span class="n">team</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">])</span>
</span><span id="Schedule.add_team_coords-454"><a href="#Schedule.add_team_coords-454"><span class="linenos">454</span></a>            <span class="n">address</span> <span class="o">=</span> <span class="n">get_address</span><span class="p">(</span><span class="n">stadium_id</span><span class="p">)</span>
</span><span id="Schedule.add_team_coords-455"><a href="#Schedule.add_team_coords-455"><span class="linenos">455</span></a>            <span class="n">coords</span> <span class="o">=</span> <span class="n">get_coordinates</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">zips</span><span class="p">)</span>
</span><span id="Schedule.add_team_coords-456"><a href="#Schedule.add_team_coords-456"><span class="linenos">456</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="Schedule.add_team_coords-457"><a href="#Schedule.add_team_coords-457"><span class="linenos">457</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">team1_abbrev</span> <span class="o">==</span> <span class="n">team</span><span class="p">[</span><span class="s2">&quot;abbrev&quot;</span><span class="p">],</span> <span class="s2">&quot;coords1&quot;</span>
</span><span id="Schedule.add_team_coords-458"><a href="#Schedule.add_team_coords-458"><span class="linenos">458</span></a>            <span class="p">]</span> <span class="o">=</span> <span class="n">coords</span>
</span><span id="Schedule.add_team_coords-459"><a href="#Schedule.add_team_coords-459"><span class="linenos">459</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="Schedule.add_team_coords-460"><a href="#Schedule.add_team_coords-460"><span class="linenos">460</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">team2_abbrev</span> <span class="o">==</span> <span class="n">team</span><span class="p">[</span><span class="s2">&quot;abbrev&quot;</span><span class="p">],</span> <span class="s2">&quot;coords2&quot;</span>
</span><span id="Schedule.add_team_coords-461"><a href="#Schedule.add_team_coords-461"><span class="linenos">461</span></a>            <span class="p">]</span> <span class="o">=</span> <span class="n">coords</span>
</span></pre></div>


            <div class="docstring"><p>Adds the home coordinates for each team in each matchup of the schedule.</p>
</div>


                            </div>
                            <div id="Schedule.add_game_coords" class="classattr">
                                        <input id="Schedule.add_game_coords-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_game_coords</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Schedule.add_game_coords-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Schedule.add_game_coords"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Schedule.add_game_coords-463"><a href="#Schedule.add_game_coords-463"><span class="linenos">463</span></a>    <span class="k">def</span> <span class="nf">add_game_coords</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Schedule.add_game_coords-464"><a href="#Schedule.add_game_coords-464"><span class="linenos">464</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Schedule.add_game_coords-465"><a href="#Schedule.add_game_coords-465"><span class="linenos">465</span></a><span class="sd">        Adds game coordinates for each of the matchups in the schedule.</span>
</span><span id="Schedule.add_game_coords-466"><a href="#Schedule.add_game_coords-466"><span class="linenos">466</span></a><span class="sd">        If the game is international, the location is pulled directly from Pro Football Reference.</span>
</span><span id="Schedule.add_game_coords-467"><a href="#Schedule.add_game_coords-467"><span class="linenos">467</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Schedule.add_game_coords-468"><a href="#Schedule.add_game_coords-468"><span class="linenos">468</span></a>        <span class="n">neutral</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">game_location</span> <span class="o">==</span> <span class="s2">&quot;N&quot;</span>
</span><span id="Schedule.add_game_coords-469"><a href="#Schedule.add_game_coords-469"><span class="linenos">469</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">neutral</span><span class="p">,</span> <span class="s2">&quot;game_coords&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="Schedule.add_game_coords-470"><a href="#Schedule.add_game_coords-470"><span class="linenos">470</span></a>            <span class="o">~</span><span class="n">neutral</span><span class="p">,</span> <span class="s2">&quot;coords1&quot;</span>
</span><span id="Schedule.add_game_coords-471"><a href="#Schedule.add_game_coords-471"><span class="linenos">471</span></a>        <span class="p">]</span>
</span><span id="Schedule.add_game_coords-472"><a href="#Schedule.add_game_coords-472"><span class="linenos">472</span></a>        <span class="n">zips</span> <span class="o">=</span> <span class="n">download_zip_codes</span><span class="p">()</span>
</span><span id="Schedule.add_game_coords-473"><a href="#Schedule.add_game_coords-473"><span class="linenos">473</span></a>        <span class="k">for</span> <span class="n">box</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">neutral</span><span class="p">,</span> <span class="s2">&quot;boxscore_abbrev&quot;</span><span class="p">]:</span>
</span><span id="Schedule.add_game_coords-474"><a href="#Schedule.add_game_coords-474"><span class="linenos">474</span></a>            <span class="n">stadium_id</span> <span class="o">=</span> <span class="n">get_game_stadium</span><span class="p">(</span><span class="n">box</span><span class="p">)</span>
</span><span id="Schedule.add_game_coords-475"><a href="#Schedule.add_game_coords-475"><span class="linenos">475</span></a>            <span class="k">if</span> <span class="n">stadium_id</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;attendance&quot;</span><span class="p">]:</span>
</span><span id="Schedule.add_game_coords-476"><a href="#Schedule.add_game_coords-476"><span class="linenos">476</span></a>                <span class="n">stad_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">boxscore_abbrev</span> <span class="o">==</span> <span class="n">box</span><span class="p">,</span><span class="s2">&quot;Stadium&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Schedule.add_game_coords-477"><a href="#Schedule.add_game_coords-477"><span class="linenos">477</span></a>                <span class="k">if</span> <span class="n">stad_name</span> <span class="o">==</span> <span class="s2">&quot;Wembley Stadium&quot;</span><span class="p">:</span>
</span><span id="Schedule.add_game_coords-478"><a href="#Schedule.add_game_coords-478"><span class="linenos">478</span></a>                    <span class="n">stadium_id</span> <span class="o">=</span> <span class="s2">&quot;LON00&quot;</span>
</span><span id="Schedule.add_game_coords-479"><a href="#Schedule.add_game_coords-479"><span class="linenos">479</span></a>                <span class="k">elif</span> <span class="n">stad_name</span> <span class="o">==</span> <span class="s2">&quot;Tottenham Hotspur Stadium&quot;</span><span class="p">:</span>
</span><span id="Schedule.add_game_coords-480"><a href="#Schedule.add_game_coords-480"><span class="linenos">480</span></a>                    <span class="n">stadium_id</span> <span class="o">=</span> <span class="s2">&quot;LON02&quot;</span>
</span><span id="Schedule.add_game_coords-481"><a href="#Schedule.add_game_coords-481"><span class="linenos">481</span></a>                <span class="k">elif</span> <span class="n">stad_name</span> <span class="o">==</span> <span class="s2">&quot;Deutsche Bank Park&quot;</span><span class="p">:</span>
</span><span id="Schedule.add_game_coords-482"><a href="#Schedule.add_game_coords-482"><span class="linenos">482</span></a>                    <span class="n">stadium_id</span> <span class="o">=</span> <span class="s2">&quot;FRA00&quot;</span>
</span><span id="Schedule.add_game_coords-483"><a href="#Schedule.add_game_coords-483"><span class="linenos">483</span></a>            <span class="n">address</span> <span class="o">=</span> <span class="n">get_address</span><span class="p">(</span><span class="n">stadium_id</span><span class="p">)</span>
</span><span id="Schedule.add_game_coords-484"><a href="#Schedule.add_game_coords-484"><span class="linenos">484</span></a>            <span class="n">coords</span> <span class="o">=</span> <span class="n">get_coordinates</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">zips</span><span class="p">)</span>
</span><span id="Schedule.add_game_coords-485"><a href="#Schedule.add_game_coords-485"><span class="linenos">485</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="Schedule.add_game_coords-486"><a href="#Schedule.add_game_coords-486"><span class="linenos">486</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">boxscore_abbrev</span> <span class="o">==</span> <span class="n">box</span><span class="p">,</span> <span class="s2">&quot;game_coords&quot;</span>
</span><span id="Schedule.add_game_coords-487"><a href="#Schedule.add_game_coords-487"><span class="linenos">487</span></a>            <span class="p">]</span> <span class="o">=</span> <span class="n">coords</span>
</span><span id="Schedule.add_game_coords-488"><a href="#Schedule.add_game_coords-488"><span class="linenos">488</span></a>        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;Stadium&quot;</span><span class="p">]</span>
</span><span id="Schedule.add_game_coords-489"><a href="#Schedule.add_game_coords-489"><span class="linenos">489</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">game_coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">game_coords</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Adds game coordinates for each of the matchups in the schedule.
If the game is international, the location is pulled directly from Pro Football Reference.</p>
</div>


                            </div>
                            <div id="Schedule.add_travel" class="classattr">
                                        <input id="Schedule.add_travel-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_travel</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Schedule.add_travel-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Schedule.add_travel"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Schedule.add_travel-491"><a href="#Schedule.add_travel-491"><span class="linenos">491</span></a>    <span class="k">def</span> <span class="nf">add_travel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Schedule.add_travel-492"><a href="#Schedule.add_travel-492"><span class="linenos">492</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Schedule.add_travel-493"><a href="#Schedule.add_travel-493"><span class="linenos">493</span></a><span class="sd">        Adds the distance traveled for each team in each matchup of the schedule.</span>
</span><span id="Schedule.add_travel-494"><a href="#Schedule.add_travel-494"><span class="linenos">494</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Schedule.add_travel-495"><a href="#Schedule.add_travel-495"><span class="linenos">495</span></a>        <span class="k">for</span> <span class="n">team</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]:</span>
</span><span id="Schedule.add_travel-496"><a href="#Schedule.add_travel-496"><span class="linenos">496</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;coords&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">team</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="p">[</span>
</span><span id="Schedule.add_travel-497"><a href="#Schedule.add_travel-497"><span class="linenos">497</span></a>                <span class="s2">&quot;coords&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">team</span><span class="p">)</span>
</span><span id="Schedule.add_travel-498"><a href="#Schedule.add_travel-498"><span class="linenos">498</span></a>            <span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
</span><span id="Schedule.add_travel-499"><a href="#Schedule.add_travel-499"><span class="linenos">499</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="p">[</span><span class="s2">&quot;travel&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">team</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
</span><span id="Schedule.add_travel-500"><a href="#Schedule.add_travel-500"><span class="linenos">500</span></a>                <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">geodesic</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;coords&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">team</span><span class="p">)],</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;game_coords&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">mi</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
</span><span id="Schedule.add_travel-501"><a href="#Schedule.add_travel-501"><span class="linenos">501</span></a>            <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Adds the distance traveled for each team in each matchup of the schedule.</p>
</div>


                            </div>
                            <div id="Schedule.add_rest" class="classattr">
                                        <input id="Schedule.add_rest-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_rest</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Schedule.add_rest-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Schedule.add_rest"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Schedule.add_rest-503"><a href="#Schedule.add_rest-503"><span class="linenos">503</span></a>    <span class="k">def</span> <span class="nf">add_rest</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Schedule.add_rest-504"><a href="#Schedule.add_rest-504"><span class="linenos">504</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Schedule.add_rest-505"><a href="#Schedule.add_rest-505"><span class="linenos">505</span></a><span class="sd">        Identifies teams that had a bye week before the matchup in question.</span>
</span><span id="Schedule.add_rest-506"><a href="#Schedule.add_rest-506"><span class="linenos">506</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Schedule.add_rest-507"><a href="#Schedule.add_rest-507"><span class="linenos">507</span></a>        <span class="k">for</span> <span class="n">week</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">week</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="Schedule.add_rest-508"><a href="#Schedule.add_rest-508"><span class="linenos">508</span></a>            <span class="n">prev</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Schedule.add_rest-509"><a href="#Schedule.add_rest-509"><span class="linenos">509</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">week</span> <span class="o">==</span> <span class="n">week</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;team1&quot;</span><span class="p">,</span> <span class="s2">&quot;team2&quot;</span><span class="p">]]</span>
</span><span id="Schedule.add_rest-510"><a href="#Schedule.add_rest-510"><span class="linenos">510</span></a>                <span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</span><span id="Schedule.add_rest-511"><a href="#Schedule.add_rest-511"><span class="linenos">511</span></a>                <span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="Schedule.add_rest-512"><a href="#Schedule.add_rest-512"><span class="linenos">512</span></a>            <span class="p">)</span>
</span><span id="Schedule.add_rest-513"><a href="#Schedule.add_rest-513"><span class="linenos">513</span></a>            <span class="n">now</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Schedule.add_rest-514"><a href="#Schedule.add_rest-514"><span class="linenos">514</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">week</span> <span class="o">==</span> <span class="n">week</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;team1&quot;</span><span class="p">,</span> <span class="s2">&quot;team2&quot;</span><span class="p">]]</span>
</span><span id="Schedule.add_rest-515"><a href="#Schedule.add_rest-515"><span class="linenos">515</span></a>                <span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</span><span id="Schedule.add_rest-516"><a href="#Schedule.add_rest-516"><span class="linenos">516</span></a>                <span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="Schedule.add_rest-517"><a href="#Schedule.add_rest-517"><span class="linenos">517</span></a>            <span class="p">)</span>
</span><span id="Schedule.add_rest-518"><a href="#Schedule.add_rest-518"><span class="linenos">518</span></a>            <span class="n">rested</span> <span class="o">=</span> <span class="p">[</span><span class="n">team</span> <span class="k">for</span> <span class="n">team</span> <span class="ow">in</span> <span class="n">now</span> <span class="k">if</span> <span class="n">team</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">prev</span><span class="p">]</span>
</span><span id="Schedule.add_rest-519"><a href="#Schedule.add_rest-519"><span class="linenos">519</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="Schedule.add_rest-520"><a href="#Schedule.add_rest-520"><span class="linenos">520</span></a>                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">week</span> <span class="o">==</span> <span class="n">week</span><span class="p">)</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">team1</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">rested</span><span class="p">),</span>
</span><span id="Schedule.add_rest-521"><a href="#Schedule.add_rest-521"><span class="linenos">521</span></a>                <span class="s2">&quot;rested1&quot;</span><span class="p">,</span>
</span><span id="Schedule.add_rest-522"><a href="#Schedule.add_rest-522"><span class="linenos">522</span></a>            <span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Schedule.add_rest-523"><a href="#Schedule.add_rest-523"><span class="linenos">523</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="Schedule.add_rest-524"><a href="#Schedule.add_rest-524"><span class="linenos">524</span></a>                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">week</span> <span class="o">==</span> <span class="n">week</span><span class="p">)</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">team2</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">rested</span><span class="p">),</span>
</span><span id="Schedule.add_rest-525"><a href="#Schedule.add_rest-525"><span class="linenos">525</span></a>                <span class="s2">&quot;rested2&quot;</span><span class="p">,</span>
</span><span id="Schedule.add_rest-526"><a href="#Schedule.add_rest-526"><span class="linenos">526</span></a>            <span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Schedule.add_rest-527"><a href="#Schedule.add_rest-527"><span class="linenos">527</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">rested1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">rested1</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
</span><span id="Schedule.add_rest-528"><a href="#Schedule.add_rest-528"><span class="linenos">528</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">rested2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">rested2</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Identifies teams that had a bye week before the matchup in question.</p>
</div>


                            </div>
                            <div id="Schedule.add_elo_columns" class="classattr">
                                        <input id="Schedule.add_elo_columns-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_elo_columns</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">qbelo</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Schedule.add_elo_columns-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Schedule.add_elo_columns"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Schedule.add_elo_columns-530"><a href="#Schedule.add_elo_columns-530"><span class="linenos">530</span></a>    <span class="k">def</span> <span class="nf">add_elo_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qbelo</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="Schedule.add_elo_columns-531"><a href="#Schedule.add_elo_columns-531"><span class="linenos">531</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Schedule.add_elo_columns-532"><a href="#Schedule.add_elo_columns-532"><span class="linenos">532</span></a><span class="sd">        Adds the necessary columns for elo projections throughout the schedule.</span>
</span><span id="Schedule.add_elo_columns-533"><a href="#Schedule.add_elo_columns-533"><span class="linenos">533</span></a>
</span><span id="Schedule.add_elo_columns-534"><a href="#Schedule.add_elo_columns-534"><span class="linenos">534</span></a><span class="sd">        Args:</span>
</span><span id="Schedule.add_elo_columns-535"><a href="#Schedule.add_elo_columns-535"><span class="linenos">535</span></a><span class="sd">            qbelo (bool, optional): whether to infer QB elo values, defaults to False.</span>
</span><span id="Schedule.add_elo_columns-536"><a href="#Schedule.add_elo_columns-536"><span class="linenos">536</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Schedule.add_elo_columns-537"><a href="#Schedule.add_elo_columns-537"><span class="linenos">537</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="p">[[</span><span class="s1">&#39;elo1_pre&#39;</span><span class="p">,</span><span class="s1">&#39;elo2_pre&#39;</span><span class="p">,</span><span class="s1">&#39;elo1_post&#39;</span><span class="p">,</span><span class="s1">&#39;elo2_post&#39;</span><span class="p">,</span><span class="s1">&#39;elo_diff&#39;</span><span class="p">,</span>\
</span><span id="Schedule.add_elo_columns-538"><a href="#Schedule.add_elo_columns-538"><span class="linenos">538</span></a>        <span class="s1">&#39;point_spread&#39;</span><span class="p">,</span><span class="s1">&#39;elo_prob1&#39;</span><span class="p">,</span><span class="s1">&#39;elo_prob2&#39;</span><span class="p">,</span><span class="s1">&#39;score_diff&#39;</span><span class="p">,</span><span class="s1">&#39;forecast_delta&#39;</span><span class="p">,</span>\
</span><span id="Schedule.add_elo_columns-539"><a href="#Schedule.add_elo_columns-539"><span class="linenos">539</span></a>        <span class="s1">&#39;mov_multiplier&#39;</span><span class="p">,</span><span class="s1">&#39;elo_delta&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Schedule.add_elo_columns-540"><a href="#Schedule.add_elo_columns-540"><span class="linenos">540</span></a>        <span class="k">if</span> <span class="n">qbelo</span><span class="p">:</span>
</span><span id="Schedule.add_elo_columns-541"><a href="#Schedule.add_elo_columns-541"><span class="linenos">541</span></a>            <span class="n">qb_elos</span> <span class="o">=</span> <span class="n">get_qb_elos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">season</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">season</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</span><span id="Schedule.add_elo_columns-542"><a href="#Schedule.add_elo_columns-542"><span class="linenos">542</span></a>            <span class="k">for</span> <span class="n">team_num</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="s1">&#39;2&#39;</span><span class="p">]:</span>
</span><span id="Schedule.add_elo_columns-543"><a href="#Schedule.add_elo_columns-543"><span class="linenos">543</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="p">,</span><span class="n">right</span><span class="o">=</span><span class="n">qb_elos</span>\
</span><span id="Schedule.add_elo_columns-544"><a href="#Schedule.add_elo_columns-544"><span class="linenos">544</span></a>                <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;game_id&#39;</span><span class="p">:</span><span class="s1">&#39;boxscore_abbrev&#39;</span><span class="p">,</span><span class="s1">&#39;team&#39;</span><span class="p">:</span><span class="s1">&#39;team</span><span class="si">{}</span><span class="s1">_abbrev&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">team_num</span><span class="p">),</span>\
</span><span id="Schedule.add_elo_columns-545"><a href="#Schedule.add_elo_columns-545"><span class="linenos">545</span></a>                <span class="s1">&#39;player&#39;</span><span class="p">:</span><span class="s1">&#39;qb&#39;</span> <span class="o">+</span> <span class="n">team_num</span><span class="p">,</span><span class="s1">&#39;team_qbvalue_avg&#39;</span><span class="p">:</span><span class="s1">&#39;team</span><span class="si">{}</span><span class="s1">_qbvalue_avg&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">team_num</span><span class="p">),</span>\
</span><span id="Schedule.add_elo_columns-546"><a href="#Schedule.add_elo_columns-546"><span class="linenos">546</span></a>                <span class="s1">&#39;opp_qbvalue_avg&#39;</span><span class="p">:</span><span class="s1">&#39;opp</span><span class="si">{}</span><span class="s1">_qbvalue_avg&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">team_num</span><span class="p">),</span>\
</span><span id="Schedule.add_elo_columns-547"><a href="#Schedule.add_elo_columns-547"><span class="linenos">547</span></a>                <span class="s1">&#39;qb_value_pre&#39;</span><span class="p">:</span><span class="s1">&#39;qb</span><span class="si">{}</span><span class="s1">_value_pre&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">team_num</span><span class="p">),</span><span class="s1">&#39;qb_adj&#39;</span><span class="p">:</span><span class="s1">&#39;qb</span><span class="si">{}</span><span class="s1">_adj&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">team_num</span><span class="p">),</span>\
</span><span id="Schedule.add_elo_columns-548"><a href="#Schedule.add_elo_columns-548"><span class="linenos">548</span></a>                <span class="s1">&#39;qb_value_post&#39;</span><span class="p">:</span><span class="s1">&#39;qb</span><span class="si">{}</span><span class="s1">_value_post&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">team_num</span><span class="p">),</span><span class="s1">&#39;VALUE&#39;</span><span class="p">:</span><span class="s1">&#39;VALUE</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">team_num</span><span class="p">)}),</span>\
</span><span id="Schedule.add_elo_columns-549"><a href="#Schedule.add_elo_columns-549"><span class="linenos">549</span></a>                <span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;boxscore_abbrev&#39;</span><span class="p">,</span><span class="s1">&#39;team</span><span class="si">{}</span><span class="s1">_abbrev&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">team_num</span><span class="p">)])</span>
</span><span id="Schedule.add_elo_columns-550"><a href="#Schedule.add_elo_columns-550"><span class="linenos">550</span></a>            <span class="c1"># Need to pull depth charts to extrapolate future qbelo values... Ignoring this for now...</span>
</span></pre></div>


            <div class="docstring"><p>Adds the necessary columns for elo projections throughout the schedule.</p>

<p>Args:
    qbelo (bool, optional): whether to infer QB elo values, defaults to False.</p>
</div>


                            </div>
                            <div id="Schedule.next_init_elo" class="classattr">
                                        <input id="Schedule.next_init_elo-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">next_init_elo</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">init_elo</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1300.0</span>, </span><span class="param"><span class="n">regress_pct</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.333</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Schedule.next_init_elo-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Schedule.next_init_elo"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Schedule.next_init_elo-552"><a href="#Schedule.next_init_elo-552"><span class="linenos">552</span></a>    <span class="k">def</span> <span class="nf">next_init_elo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">init_elo</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1300.0</span><span class="p">,</span> <span class="n">regress_pct</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.333</span><span class="p">):</span>
</span><span id="Schedule.next_init_elo-553"><a href="#Schedule.next_init_elo-553"><span class="linenos">553</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Schedule.next_init_elo-554"><a href="#Schedule.next_init_elo-554"><span class="linenos">554</span></a><span class="sd">        Identifies the next matchup that does not have complete elo projections </span>
</span><span id="Schedule.next_init_elo-555"><a href="#Schedule.next_init_elo-555"><span class="linenos">555</span></a><span class="sd">        and calculates each team&#39;s starting elo rating based on 538&#39;s model (#RIP).</span>
</span><span id="Schedule.next_init_elo-556"><a href="#Schedule.next_init_elo-556"><span class="linenos">556</span></a>
</span><span id="Schedule.next_init_elo-557"><a href="#Schedule.next_init_elo-557"><span class="linenos">557</span></a><span class="sd">        Args:</span>
</span><span id="Schedule.next_init_elo-558"><a href="#Schedule.next_init_elo-558"><span class="linenos">558</span></a><span class="sd">            init_elo (float, optional): initial elo rating to provide new teams with, defaults to 1300.</span>
</span><span id="Schedule.next_init_elo-559"><a href="#Schedule.next_init_elo-559"><span class="linenos">559</span></a><span class="sd">            regress_pct (float, optional): percentage to regress teams back to the mean between each season, defaults to 0.333.</span>
</span><span id="Schedule.next_init_elo-560"><a href="#Schedule.next_init_elo-560"><span class="linenos">560</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Schedule.next_init_elo-561"><a href="#Schedule.next_init_elo-561"><span class="linenos">561</span></a>        <span class="n">ind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">elo1_pre</span><span class="o">.</span><span class="n">isnull</span><span class="p">()]</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Schedule.next_init_elo-562"><a href="#Schedule.next_init_elo-562"><span class="linenos">562</span></a>        <span class="k">for</span> <span class="n">team_num</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="s1">&#39;2&#39;</span><span class="p">]:</span>
</span><span id="Schedule.next_init_elo-563"><a href="#Schedule.next_init_elo-563"><span class="linenos">563</span></a>            <span class="n">team</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;team</span><span class="si">{}</span><span class="s1">_abbrev&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">team_num</span><span class="p">)]</span>
</span><span id="Schedule.next_init_elo-564"><a href="#Schedule.next_init_elo-564"><span class="linenos">564</span></a>            <span class="n">prev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">ind</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Schedule.next_init_elo-565"><a href="#Schedule.next_init_elo-565"><span class="linenos">565</span></a>            <span class="n">prev</span> <span class="o">=</span> <span class="n">prev</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">prev</span><span class="o">.</span><span class="n">team1_abbrev</span> <span class="o">==</span> <span class="n">team</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">prev</span><span class="o">.</span><span class="n">team2_abbrev</span> <span class="o">==</span> <span class="n">team</span><span class="p">)]</span>
</span><span id="Schedule.next_init_elo-566"><a href="#Schedule.next_init_elo-566"><span class="linenos">566</span></a>            <span class="k">if</span> <span class="n">prev</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Schedule.next_init_elo-567"><a href="#Schedule.next_init_elo-567"><span class="linenos">567</span></a>                <span class="c1"># Team already exists</span>
</span><span id="Schedule.next_init_elo-568"><a href="#Schedule.next_init_elo-568"><span class="linenos">568</span></a>                <span class="n">prev</span> <span class="o">=</span> <span class="n">prev</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Schedule.next_init_elo-569"><a href="#Schedule.next_init_elo-569"><span class="linenos">569</span></a>                <span class="n">prev_num</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">prev</span><span class="p">[</span><span class="s1">&#39;team1_abbrev&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">team</span> <span class="k">else</span> <span class="mi">2</span>
</span><span id="Schedule.next_init_elo-570"><a href="#Schedule.next_init_elo-570"><span class="linenos">570</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">prev</span><span class="p">[</span><span class="s1">&#39;elo</span><span class="si">{}</span><span class="s1">_post&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">prev_num</span><span class="p">)]):</span>
</span><span id="Schedule.next_init_elo-571"><a href="#Schedule.next_init_elo-571"><span class="linenos">571</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo</span><span class="si">{}</span><span class="s1">_pre&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">team_num</span><span class="p">)]</span> <span class="o">=</span> <span class="n">prev</span><span class="p">[</span><span class="s1">&#39;elo</span><span class="si">{}</span><span class="s1">_post&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">prev_num</span><span class="p">)]</span>
</span><span id="Schedule.next_init_elo-572"><a href="#Schedule.next_init_elo-572"><span class="linenos">572</span></a>                    <span class="k">if</span> <span class="n">prev</span><span class="p">[</span><span class="s1">&#39;season&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;season&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Schedule.next_init_elo-573"><a href="#Schedule.next_init_elo-573"><span class="linenos">573</span></a>                        <span class="c1"># Start of a new season</span>
</span><span id="Schedule.next_init_elo-574"><a href="#Schedule.next_init_elo-574"><span class="linenos">574</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo</span><span class="si">{}</span><span class="s1">_pre&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">team_num</span><span class="p">)]</span> <span class="o">+=</span> <span class="p">(</span><span class="mi">1505</span> <span class="o">-</span> <span class="n">prev</span><span class="p">[</span><span class="s1">&#39;elo</span><span class="si">{}</span><span class="s1">_post&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">prev_num</span><span class="p">)])</span><span class="o">*</span><span class="n">regress_pct</span>
</span><span id="Schedule.next_init_elo-575"><a href="#Schedule.next_init_elo-575"><span class="linenos">575</span></a>                    <span class="k">elif</span> <span class="n">prev</span><span class="p">[</span><span class="s1">&#39;season&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;season&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Schedule.next_init_elo-576"><a href="#Schedule.next_init_elo-576"><span class="linenos">576</span></a>                        <span class="c1"># Resurrected teams (e.g. 1999 Cleveland Browns)</span>
</span><span id="Schedule.next_init_elo-577"><a href="#Schedule.next_init_elo-577"><span class="linenos">577</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo</span><span class="si">{}</span><span class="s1">_pre&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">team_num</span><span class="p">)]</span> <span class="o">=</span> <span class="n">init_elo</span>
</span><span id="Schedule.next_init_elo-578"><a href="#Schedule.next_init_elo-578"><span class="linenos">578</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Schedule.next_init_elo-579"><a href="#Schedule.next_init_elo-579"><span class="linenos">579</span></a>                    <span class="c1"># Game hasn&#39;t been played yet...</span>
</span><span id="Schedule.next_init_elo-580"><a href="#Schedule.next_init_elo-580"><span class="linenos">580</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo</span><span class="si">{}</span><span class="s1">_pre&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">team_num</span><span class="p">)]</span> <span class="o">=</span> <span class="n">prev</span><span class="p">[</span><span class="s1">&#39;elo</span><span class="si">{}</span><span class="s1">_pre&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">prev_num</span><span class="p">)]</span>
</span><span id="Schedule.next_init_elo-581"><a href="#Schedule.next_init_elo-581"><span class="linenos">581</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Schedule.next_init_elo-582"><a href="#Schedule.next_init_elo-582"><span class="linenos">582</span></a>                <span class="c1"># New Team</span>
</span><span id="Schedule.next_init_elo-583"><a href="#Schedule.next_init_elo-583"><span class="linenos">583</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo</span><span class="si">{}</span><span class="s1">_pre&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">team_num</span><span class="p">)]</span> <span class="o">=</span> <span class="n">init_elo</span>
</span><span id="Schedule.next_init_elo-584"><a href="#Schedule.next_init_elo-584"><span class="linenos">584</span></a>            <span class="k">if</span> <span class="s1">&#39;qb</span><span class="si">{}</span><span class="s1">_adj&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">team_num</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="Schedule.next_init_elo-585"><a href="#Schedule.next_init_elo-585"><span class="linenos">585</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;qbelo</span><span class="si">{}</span><span class="s1">_pre&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">team_num</span><span class="p">)]</span> <span class="o">=</span> \
</span><span id="Schedule.next_init_elo-586"><a href="#Schedule.next_init_elo-586"><span class="linenos">586</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo</span><span class="si">{}</span><span class="s1">_pre&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">team_num</span><span class="p">)]</span> <span class="o">+</span> \
</span><span id="Schedule.next_init_elo-587"><a href="#Schedule.next_init_elo-587"><span class="linenos">587</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;qb</span><span class="si">{}</span><span class="s1">_adj&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">team_num</span><span class="p">)]</span>
</span></pre></div>


            <div class="docstring"><p>Identifies the next matchup that does not have complete elo projections 
and calculates each team's starting elo rating based on 538's model (#RIP).</p>

<p>Args:
    init_elo (float, optional): initial elo rating to provide new teams with, defaults to 1300.
    regress_pct (float, optional): percentage to regress teams back to the mean between each season, defaults to 0.333.</p>
</div>


                            </div>
                            <div id="Schedule.next_elo_prob" class="classattr">
                                        <input id="Schedule.next_elo_prob-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">next_elo_prob</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">homefield</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">48.0</span>,</span><span class="param">	<span class="n">travel</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.004</span>,</span><span class="param">	<span class="n">rested</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">25.0</span>,</span><span class="param">	<span class="n">playoffs</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.2</span>,</span><span class="param">	<span class="n">elo2points</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.04</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Schedule.next_elo_prob-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Schedule.next_elo_prob"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Schedule.next_elo_prob-589"><a href="#Schedule.next_elo_prob-589"><span class="linenos">589</span></a>    <span class="k">def</span> <span class="nf">next_elo_prob</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">homefield</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">48.0</span><span class="p">,</span> <span class="n">travel</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.004</span><span class="p">,</span> <span class="n">rested</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">25.0</span><span class="p">,</span> <span class="n">playoffs</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.2</span><span class="p">,</span> <span class="n">elo2points</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.04</span><span class="p">):</span>
</span><span id="Schedule.next_elo_prob-590"><a href="#Schedule.next_elo_prob-590"><span class="linenos">590</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Schedule.next_elo_prob-591"><a href="#Schedule.next_elo_prob-591"><span class="linenos">591</span></a><span class="sd">        Identifies the next matchup that does not have complete elo projections </span>
</span><span id="Schedule.next_elo_prob-592"><a href="#Schedule.next_elo_prob-592"><span class="linenos">592</span></a><span class="sd">        and calculates each team&#39;s win probability based on 538&#39;s model (#RIP).</span>
</span><span id="Schedule.next_elo_prob-593"><a href="#Schedule.next_elo_prob-593"><span class="linenos">593</span></a>
</span><span id="Schedule.next_elo_prob-594"><a href="#Schedule.next_elo_prob-594"><span class="linenos">594</span></a><span class="sd">        Args:</span>
</span><span id="Schedule.next_elo_prob-595"><a href="#Schedule.next_elo_prob-595"><span class="linenos">595</span></a><span class="sd">            homefield (float, optional): elo rating boost for home-field advantage, defaults to 48.</span>
</span><span id="Schedule.next_elo_prob-596"><a href="#Schedule.next_elo_prob-596"><span class="linenos">596</span></a><span class="sd">            travel (float, optional): elo rating penalty for travel, defaults to 0.004 per mile traveled.</span>
</span><span id="Schedule.next_elo_prob-597"><a href="#Schedule.next_elo_prob-597"><span class="linenos">597</span></a><span class="sd">            rested (float, optional): elo rating boost for rested teams, defaults to 25.</span>
</span><span id="Schedule.next_elo_prob-598"><a href="#Schedule.next_elo_prob-598"><span class="linenos">598</span></a><span class="sd">            playoffs (float, optional): elo rating expansion in the playoffs, defaults to 1.2.</span>
</span><span id="Schedule.next_elo_prob-599"><a href="#Schedule.next_elo_prob-599"><span class="linenos">599</span></a><span class="sd">            elo2points (float, optional): conversion rate between elo and points, defaults to 0.04.</span>
</span><span id="Schedule.next_elo_prob-600"><a href="#Schedule.next_elo_prob-600"><span class="linenos">600</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Schedule.next_elo_prob-601"><a href="#Schedule.next_elo_prob-601"><span class="linenos">601</span></a>        <span class="n">ind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">elo_prob1</span><span class="o">.</span><span class="n">isnull</span><span class="p">()]</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Schedule.next_elo_prob-602"><a href="#Schedule.next_elo_prob-602"><span class="linenos">602</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo_diff&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo1_pre&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo2_pre&#39;</span><span class="p">]</span>
</span><span id="Schedule.next_elo_prob-603"><a href="#Schedule.next_elo_prob-603"><span class="linenos">603</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo_diff&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">homefield</span> <span class="c1"># Homefield advantage</span>
</span><span id="Schedule.next_elo_prob-604"><a href="#Schedule.next_elo_prob-604"><span class="linenos">604</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo_diff&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">travel</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;travel2&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;travel1&#39;</span><span class="p">])</span> <span class="c1"># Travel</span>
</span><span id="Schedule.next_elo_prob-605"><a href="#Schedule.next_elo_prob-605"><span class="linenos">605</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;rested1&#39;</span><span class="p">]:</span>
</span><span id="Schedule.next_elo_prob-606"><a href="#Schedule.next_elo_prob-606"><span class="linenos">606</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo_diff&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">rested</span> <span class="c1"># Bye week</span>
</span><span id="Schedule.next_elo_prob-607"><a href="#Schedule.next_elo_prob-607"><span class="linenos">607</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;rested2&#39;</span><span class="p">]:</span>
</span><span id="Schedule.next_elo_prob-608"><a href="#Schedule.next_elo_prob-608"><span class="linenos">608</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo_diff&#39;</span><span class="p">]</span> <span class="o">-=</span> <span class="n">rested</span> <span class="c1"># Bye week</span>
</span><span id="Schedule.next_elo_prob-609"><a href="#Schedule.next_elo_prob-609"><span class="linenos">609</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;week_num&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isnumeric</span><span class="p">():</span>
</span><span id="Schedule.next_elo_prob-610"><a href="#Schedule.next_elo_prob-610"><span class="linenos">610</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo_diff&#39;</span><span class="p">]</span> <span class="o">*=</span> <span class="n">playoffs</span> <span class="c1"># Playoffs</span>
</span><span id="Schedule.next_elo_prob-611"><a href="#Schedule.next_elo_prob-611"><span class="linenos">611</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;point_spread&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo_diff&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">elo2points</span>
</span><span id="Schedule.next_elo_prob-612"><a href="#Schedule.next_elo_prob-612"><span class="linenos">612</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo_prob1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo_diff&#39;</span><span class="p">]</span><span class="o">/-</span><span class="mi">400</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Schedule.next_elo_prob-613"><a href="#Schedule.next_elo_prob-613"><span class="linenos">613</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo_prob2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo_prob1&#39;</span><span class="p">]</span>
</span><span id="Schedule.next_elo_prob-614"><a href="#Schedule.next_elo_prob-614"><span class="linenos">614</span></a>        <span class="k">if</span> <span class="s1">&#39;qb1_adj&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="s1">&#39;qb2_adj&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="Schedule.next_elo_prob-615"><a href="#Schedule.next_elo_prob-615"><span class="linenos">615</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;qbelo_diff&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo_diff&#39;</span><span class="p">]</span> <span class="o">+</span> \
</span><span id="Schedule.next_elo_prob-616"><a href="#Schedule.next_elo_prob-616"><span class="linenos">616</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;qb1_adj&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;qb2_adj&#39;</span><span class="p">]</span>
</span><span id="Schedule.next_elo_prob-617"><a href="#Schedule.next_elo_prob-617"><span class="linenos">617</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;qbpoint_spread&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;qbelo_diff&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">elo2points</span>
</span><span id="Schedule.next_elo_prob-618"><a href="#Schedule.next_elo_prob-618"><span class="linenos">618</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;qbelo_prob1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;qbelo_diff&#39;</span><span class="p">]</span><span class="o">/-</span><span class="mi">400</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Schedule.next_elo_prob-619"><a href="#Schedule.next_elo_prob-619"><span class="linenos">619</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;qbelo_prob2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;qbelo_prob1&#39;</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Identifies the next matchup that does not have complete elo projections 
and calculates each team's win probability based on 538's model (#RIP).</p>

<p>Args:
    homefield (float, optional): elo rating boost for home-field advantage, defaults to 48.
    travel (float, optional): elo rating penalty for travel, defaults to 0.004 per mile traveled.
    rested (float, optional): elo rating boost for rested teams, defaults to 25.
    playoffs (float, optional): elo rating expansion in the playoffs, defaults to 1.2.
    elo2points (float, optional): conversion rate between elo and points, defaults to 0.04.</p>
</div>


                            </div>
                            <div id="Schedule.next_elo_delta" class="classattr">
                                        <input id="Schedule.next_elo_delta-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">next_elo_delta</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">k_factor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">20.0</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Schedule.next_elo_delta-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Schedule.next_elo_delta"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Schedule.next_elo_delta-621"><a href="#Schedule.next_elo_delta-621"><span class="linenos">621</span></a>    <span class="k">def</span> <span class="nf">next_elo_delta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k_factor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">20.0</span><span class="p">):</span>
</span><span id="Schedule.next_elo_delta-622"><a href="#Schedule.next_elo_delta-622"><span class="linenos">622</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Schedule.next_elo_delta-623"><a href="#Schedule.next_elo_delta-623"><span class="linenos">623</span></a><span class="sd">        Identifies the next matchup that does not have complete elo projections </span>
</span><span id="Schedule.next_elo_delta-624"><a href="#Schedule.next_elo_delta-624"><span class="linenos">624</span></a><span class="sd">        and calculates each team&#39;s new elo rating based on the results of that game.</span>
</span><span id="Schedule.next_elo_delta-625"><a href="#Schedule.next_elo_delta-625"><span class="linenos">625</span></a>
</span><span id="Schedule.next_elo_delta-626"><a href="#Schedule.next_elo_delta-626"><span class="linenos">626</span></a><span class="sd">        Args:</span>
</span><span id="Schedule.next_elo_delta-627"><a href="#Schedule.next_elo_delta-627"><span class="linenos">627</span></a><span class="sd">            k_factor (float, optional): scaling factor that dictates how much ratings should shift based on recent results, defaults to 20.</span>
</span><span id="Schedule.next_elo_delta-628"><a href="#Schedule.next_elo_delta-628"><span class="linenos">628</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Schedule.next_elo_delta-629"><a href="#Schedule.next_elo_delta-629"><span class="linenos">629</span></a>        <span class="n">ind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">elo_prob1</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">elo_delta</span><span class="o">.</span><span class="n">isnull</span><span class="p">()]</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Schedule.next_elo_delta-630"><a href="#Schedule.next_elo_delta-630"><span class="linenos">630</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;score1&#39;</span><span class="p">]):</span>
</span><span id="Schedule.next_elo_delta-631"><a href="#Schedule.next_elo_delta-631"><span class="linenos">631</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;score_diff&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;score1&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;score2&#39;</span><span class="p">]</span>
</span><span id="Schedule.next_elo_delta-632"><a href="#Schedule.next_elo_delta-632"><span class="linenos">632</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;forecast_delta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;score_diff&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> \
</span><span id="Schedule.next_elo_delta-633"><a href="#Schedule.next_elo_delta-633"><span class="linenos">633</span></a>            <span class="mf">0.5</span><span class="o">*</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;score_diff&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo_prob1&#39;</span><span class="p">]</span>
</span><span id="Schedule.next_elo_delta-634"><a href="#Schedule.next_elo_delta-634"><span class="linenos">634</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;mov_multiplier&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;score_diff&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mf">2.2</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo_diff&#39;</span><span class="p">]</span><span class="o">*</span><span class="mf">0.001</span> <span class="o">+</span> <span class="mf">2.2</span><span class="p">)</span>
</span><span id="Schedule.next_elo_delta-635"><a href="#Schedule.next_elo_delta-635"><span class="linenos">635</span></a>            <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;mov_multiplier&#39;</span><span class="p">]):</span>
</span><span id="Schedule.next_elo_delta-636"><a href="#Schedule.next_elo_delta-636"><span class="linenos">636</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;mov_multiplier&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Schedule.next_elo_delta-637"><a href="#Schedule.next_elo_delta-637"><span class="linenos">637</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo_delta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;forecast_delta&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;mov_multiplier&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">k_factor</span>
</span><span id="Schedule.next_elo_delta-638"><a href="#Schedule.next_elo_delta-638"><span class="linenos">638</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo1_post&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo1_pre&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo_delta&#39;</span><span class="p">]</span>
</span><span id="Schedule.next_elo_delta-639"><a href="#Schedule.next_elo_delta-639"><span class="linenos">639</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo2_post&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo2_pre&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;elo_delta&#39;</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Identifies the next matchup that does not have complete elo projections 
and calculates each team's new elo rating based on the results of that game.</p>

<p>Args:
    k_factor (float, optional): scaling factor that dictates how much ratings should shift based on recent results, defaults to 20.</p>
</div>


                            </div>
                </section>
                <section id="Boxscore">
                            <input id="Boxscore-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Boxscore</span>:

                <label class="view-source-button" for="Boxscore-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Boxscore"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Boxscore-642"><a href="#Boxscore-642"><span class="linenos">642</span></a><span class="k">class</span> <span class="nc">Boxscore</span><span class="p">:</span>
</span><span id="Boxscore-643"><a href="#Boxscore-643"><span class="linenos">643</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Boxscore-644"><a href="#Boxscore-644"><span class="linenos">644</span></a><span class="sd">    Boxscore class that gathers all relevant statistics for the game in question</span>
</span><span id="Boxscore-645"><a href="#Boxscore-645"><span class="linenos">645</span></a><span class="sd">    and parses them into a pandas dataframe.</span>
</span><span id="Boxscore-646"><a href="#Boxscore-646"><span class="linenos">646</span></a>
</span><span id="Boxscore-647"><a href="#Boxscore-647"><span class="linenos">647</span></a><span class="sd">    Attributes:</span>
</span><span id="Boxscore-648"><a href="#Boxscore-648"><span class="linenos">648</span></a><span class="sd">        game_id: unique SportsRef identifier for the game in question.</span>
</span><span id="Boxscore-649"><a href="#Boxscore-649"><span class="linenos">649</span></a><span class="sd">        raw_text: raw html for the Pro Football Reference page of the game in question.</span>
</span><span id="Boxscore-650"><a href="#Boxscore-650"><span class="linenos">650</span></a><span class="sd">        season: season of the game in question.</span>
</span><span id="Boxscore-651"><a href="#Boxscore-651"><span class="linenos">651</span></a><span class="sd">        week: week of the season for the game in question.</span>
</span><span id="Boxscore-652"><a href="#Boxscore-652"><span class="linenos">652</span></a><span class="sd">        team1_abbrev: abbreviation for the home team.</span>
</span><span id="Boxscore-653"><a href="#Boxscore-653"><span class="linenos">653</span></a><span class="sd">        team1_score: points scored by the home team.</span>
</span><span id="Boxscore-654"><a href="#Boxscore-654"><span class="linenos">654</span></a><span class="sd">        team2_abbrev: abbreviation for the away team.</span>
</span><span id="Boxscore-655"><a href="#Boxscore-655"><span class="linenos">655</span></a><span class="sd">        team2_score: points scored by the away team.</span>
</span><span id="Boxscore-656"><a href="#Boxscore-656"><span class="linenos">656</span></a><span class="sd">        game_stats: dataframe containing relevant statistics for the game in question.</span>
</span><span id="Boxscore-657"><a href="#Boxscore-657"><span class="linenos">657</span></a><span class="sd">        starters: dataframe containing the list of starting players for both teams.</span>
</span><span id="Boxscore-658"><a href="#Boxscore-658"><span class="linenos">658</span></a><span class="sd">        snaps: dataframe containing the number of snaps played by every player on both teams.</span>
</span><span id="Boxscore-659"><a href="#Boxscore-659"><span class="linenos">659</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Boxscore-660"><a href="#Boxscore-660"><span class="linenos">660</span></a>
</span><span id="Boxscore-661"><a href="#Boxscore-661"><span class="linenos">661</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">game_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Boxscore-662"><a href="#Boxscore-662"><span class="linenos">662</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Boxscore-663"><a href="#Boxscore-663"><span class="linenos">663</span></a><span class="sd">        Initializes a Boxscore object using the parameters provided and class functions defined below.</span>
</span><span id="Boxscore-664"><a href="#Boxscore-664"><span class="linenos">664</span></a>
</span><span id="Boxscore-665"><a href="#Boxscore-665"><span class="linenos">665</span></a><span class="sd">        Args:</span>
</span><span id="Boxscore-666"><a href="#Boxscore-666"><span class="linenos">666</span></a><span class="sd">            game_id (str): unique SportsRef identifier for the game in question.</span>
</span><span id="Boxscore-667"><a href="#Boxscore-667"><span class="linenos">667</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Boxscore-668"><a href="#Boxscore-668"><span class="linenos">668</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">game_id</span> <span class="o">=</span> <span class="n">game_id</span>
</span><span id="Boxscore-669"><a href="#Boxscore-669"><span class="linenos">669</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">get_raw_text</span><span class="p">()</span>
</span><span id="Boxscore-670"><a href="#Boxscore-670"><span class="linenos">670</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">get_details</span><span class="p">()</span>
</span><span id="Boxscore-671"><a href="#Boxscore-671"><span class="linenos">671</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">get_stats</span><span class="p">()</span>
</span><span id="Boxscore-672"><a href="#Boxscore-672"><span class="linenos">672</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">get_advanced_stats</span><span class="p">()</span>
</span><span id="Boxscore-673"><a href="#Boxscore-673"><span class="linenos">673</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">get_starters</span><span class="p">()</span>
</span><span id="Boxscore-674"><a href="#Boxscore-674"><span class="linenos">674</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">get_snap_counts</span><span class="p">()</span>
</span><span id="Boxscore-675"><a href="#Boxscore-675"><span class="linenos">675</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_depth_chart</span><span class="p">()</span>
</span><span id="Boxscore-676"><a href="#Boxscore-676"><span class="linenos">676</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_qb_value</span><span class="p">()</span>
</span><span id="Boxscore-677"><a href="#Boxscore-677"><span class="linenos">677</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">normalize_team_names</span><span class="p">()</span>
</span><span id="Boxscore-678"><a href="#Boxscore-678"><span class="linenos">678</span></a>
</span><span id="Boxscore-679"><a href="#Boxscore-679"><span class="linenos">679</span></a>    <span class="k">def</span> <span class="nf">get_raw_text</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Boxscore-680"><a href="#Boxscore-680"><span class="linenos">680</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Boxscore-681"><a href="#Boxscore-681"><span class="linenos">681</span></a><span class="sd">        Pulls down the raw html from Pro Football Reference containing the statistics for the game in question.</span>
</span><span id="Boxscore-682"><a href="#Boxscore-682"><span class="linenos">682</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Boxscore-683"><a href="#Boxscore-683"><span class="linenos">683</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">raw_text</span> <span class="o">=</span> <span class="n">get_page</span><span class="p">(</span><span class="s2">&quot;boxscores/</span><span class="si">{}</span><span class="s2">.htm&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">game_id</span><span class="p">))</span>
</span><span id="Boxscore-684"><a href="#Boxscore-684"><span class="linenos">684</span></a>
</span><span id="Boxscore-685"><a href="#Boxscore-685"><span class="linenos">685</span></a>    <span class="k">def</span> <span class="nf">get_details</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Boxscore-686"><a href="#Boxscore-686"><span class="linenos">686</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Boxscore-687"><a href="#Boxscore-687"><span class="linenos">687</span></a><span class="sd">        Extracts the overarching details for the game in question, specifically the season, week, score, and teams involved.</span>
</span><span id="Boxscore-688"><a href="#Boxscore-688"><span class="linenos">688</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Boxscore-689"><a href="#Boxscore-689"><span class="linenos">689</span></a>        <span class="n">season_week</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_text</span><span class="o">.</span><span class="n">find</span><span class="p">(</span>
</span><span id="Boxscore-690"><a href="#Boxscore-690"><span class="linenos">690</span></a>            <span class="s2">&quot;div&quot;</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;game_summaries compressed&quot;</span><span class="p">}</span>
</span><span id="Boxscore-691"><a href="#Boxscore-691"><span class="linenos">691</span></a>        <span class="p">)</span>
</span><span id="Boxscore-692"><a href="#Boxscore-692"><span class="linenos">692</span></a>        <span class="n">season_week</span> <span class="o">=</span> <span class="n">season_week</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;href&quot;</span><span class="p">]</span>
</span><span id="Boxscore-693"><a href="#Boxscore-693"><span class="linenos">693</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">season</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">season_week</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
</span><span id="Boxscore-694"><a href="#Boxscore-694"><span class="linenos">694</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">week</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">season_week</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="Boxscore-695"><a href="#Boxscore-695"><span class="linenos">695</span></a>        <span class="n">home_scores</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_text</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span>
</span><span id="Boxscore-696"><a href="#Boxscore-696"><span class="linenos">696</span></a>            <span class="p">[</span><span class="s2">&quot;th&quot;</span><span class="p">,</span><span class="s2">&quot;td&quot;</span><span class="p">],</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;data-stat&quot;</span><span class="p">:</span> <span class="s2">&quot;home_team_score&quot;</span><span class="p">}</span>
</span><span id="Boxscore-697"><a href="#Boxscore-697"><span class="linenos">697</span></a>        <span class="p">)</span>
</span><span id="Boxscore-698"><a href="#Boxscore-698"><span class="linenos">698</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">team1_abbrev</span> <span class="o">=</span> <span class="n">home_scores</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span>
</span><span id="Boxscore-699"><a href="#Boxscore-699"><span class="linenos">699</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">team1_score</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">home_scores</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span><span id="Boxscore-700"><a href="#Boxscore-700"><span class="linenos">700</span></a>        <span class="n">away_scores</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_text</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span>
</span><span id="Boxscore-701"><a href="#Boxscore-701"><span class="linenos">701</span></a>            <span class="p">[</span><span class="s2">&quot;th&quot;</span><span class="p">,</span><span class="s2">&quot;td&quot;</span><span class="p">],</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;data-stat&quot;</span><span class="p">:</span> <span class="s2">&quot;vis_team_score&quot;</span><span class="p">}</span>
</span><span id="Boxscore-702"><a href="#Boxscore-702"><span class="linenos">702</span></a>        <span class="p">)</span>
</span><span id="Boxscore-703"><a href="#Boxscore-703"><span class="linenos">703</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">team2_abbrev</span> <span class="o">=</span> <span class="n">away_scores</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span>
</span><span id="Boxscore-704"><a href="#Boxscore-704"><span class="linenos">704</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">team2_score</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">away_scores</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span><span id="Boxscore-705"><a href="#Boxscore-705"><span class="linenos">705</span></a>
</span><span id="Boxscore-706"><a href="#Boxscore-706"><span class="linenos">706</span></a>    <span class="k">def</span> <span class="nf">get_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Boxscore-707"><a href="#Boxscore-707"><span class="linenos">707</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Boxscore-708"><a href="#Boxscore-708"><span class="linenos">708</span></a><span class="sd">        Extracts the basic offensive, defensive, and special teams stats </span>
</span><span id="Boxscore-709"><a href="#Boxscore-709"><span class="linenos">709</span></a><span class="sd">        from the raw html for the game in question.</span>
</span><span id="Boxscore-710"><a href="#Boxscore-710"><span class="linenos">710</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Boxscore-711"><a href="#Boxscore-711"><span class="linenos">711</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
</span><span id="Boxscore-712"><a href="#Boxscore-712"><span class="linenos">712</span></a>            <span class="p">[</span>
</span><span id="Boxscore-713"><a href="#Boxscore-713"><span class="linenos">713</span></a>                <span class="n">parse_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raw_text</span><span class="p">,</span> <span class="s2">&quot;player_offense&quot;</span><span class="p">),</span>
</span><span id="Boxscore-714"><a href="#Boxscore-714"><span class="linenos">714</span></a>                <span class="n">parse_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raw_text</span><span class="p">,</span> <span class="s2">&quot;player_defense&quot;</span><span class="p">),</span>
</span><span id="Boxscore-715"><a href="#Boxscore-715"><span class="linenos">715</span></a>                <span class="n">parse_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raw_text</span><span class="p">,</span> <span class="s2">&quot;kicking&quot;</span><span class="p">),</span>
</span><span id="Boxscore-716"><a href="#Boxscore-716"><span class="linenos">716</span></a>            <span class="p">]</span>
</span><span id="Boxscore-717"><a href="#Boxscore-717"><span class="linenos">717</span></a>        <span class="p">)</span>
</span><span id="Boxscore-718"><a href="#Boxscore-718"><span class="linenos">718</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_text</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;returns&quot;</span><span class="p">):</span>
</span><span id="Boxscore-719"><a href="#Boxscore-719"><span class="linenos">719</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
</span><span id="Boxscore-720"><a href="#Boxscore-720"><span class="linenos">720</span></a>                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span><span class="p">,</span> <span class="n">parse_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raw_text</span><span class="p">,</span> <span class="s2">&quot;returns&quot;</span><span class="p">)]</span>
</span><span id="Boxscore-721"><a href="#Boxscore-721"><span class="linenos">721</span></a>            <span class="p">)</span>
</span><span id="Boxscore-722"><a href="#Boxscore-722"><span class="linenos">722</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Boxscore-723"><a href="#Boxscore-723"><span class="linenos">723</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="Boxscore-724"><a href="#Boxscore-724"><span class="linenos">724</span></a>            <span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;player&quot;</span><span class="p">,</span> <span class="s2">&quot;player_id&quot;</span><span class="p">,</span> <span class="s2">&quot;team&quot;</span><span class="p">])</span>
</span><span id="Boxscore-725"><a href="#Boxscore-725"><span class="linenos">725</span></a>            <span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</span><span id="Boxscore-726"><a href="#Boxscore-726"><span class="linenos">726</span></a>            <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="Boxscore-727"><a href="#Boxscore-727"><span class="linenos">727</span></a>        <span class="p">)</span>
</span><span id="Boxscore-728"><a href="#Boxscore-728"><span class="linenos">728</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="Boxscore-729"><a href="#Boxscore-729"><span class="linenos">729</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span><span class="o">.</span><span class="n">team</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">team1_abbrev</span><span class="p">,</span> <span class="s2">&quot;opponent&quot;</span>
</span><span id="Boxscore-730"><a href="#Boxscore-730"><span class="linenos">730</span></a>        <span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">team2_abbrev</span>
</span><span id="Boxscore-731"><a href="#Boxscore-731"><span class="linenos">731</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="Boxscore-732"><a href="#Boxscore-732"><span class="linenos">732</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span><span class="o">.</span><span class="n">team</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">team2_abbrev</span><span class="p">,</span> <span class="s2">&quot;opponent&quot;</span>
</span><span id="Boxscore-733"><a href="#Boxscore-733"><span class="linenos">733</span></a>        <span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">team1_abbrev</span>
</span><span id="Boxscore-734"><a href="#Boxscore-734"><span class="linenos">734</span></a>
</span><span id="Boxscore-735"><a href="#Boxscore-735"><span class="linenos">735</span></a>    <span class="k">def</span> <span class="nf">get_advanced_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Boxscore-736"><a href="#Boxscore-736"><span class="linenos">736</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Boxscore-737"><a href="#Boxscore-737"><span class="linenos">737</span></a><span class="sd">        Extracts the advanced offensive, defensive, and special teams stats </span>
</span><span id="Boxscore-738"><a href="#Boxscore-738"><span class="linenos">738</span></a><span class="sd">        from the raw html for the game in question (e.g. first downs).</span>
</span><span id="Boxscore-739"><a href="#Boxscore-739"><span class="linenos">739</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Boxscore-740"><a href="#Boxscore-740"><span class="linenos">740</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_text</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;passing_advanced&quot;</span><span class="p">):</span>
</span><span id="Boxscore-741"><a href="#Boxscore-741"><span class="linenos">741</span></a>            <span class="n">advanced</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
</span><span id="Boxscore-742"><a href="#Boxscore-742"><span class="linenos">742</span></a>                <span class="p">[</span>
</span><span id="Boxscore-743"><a href="#Boxscore-743"><span class="linenos">743</span></a>                    <span class="n">parse_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raw_text</span><span class="p">,</span> <span class="s2">&quot;passing_advanced&quot;</span><span class="p">),</span>
</span><span id="Boxscore-744"><a href="#Boxscore-744"><span class="linenos">744</span></a>                    <span class="n">parse_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raw_text</span><span class="p">,</span> <span class="s2">&quot;rushing_advanced&quot;</span><span class="p">),</span>
</span><span id="Boxscore-745"><a href="#Boxscore-745"><span class="linenos">745</span></a>                    <span class="n">parse_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raw_text</span><span class="p">,</span> <span class="s2">&quot;receiving_advanced&quot;</span><span class="p">),</span>
</span><span id="Boxscore-746"><a href="#Boxscore-746"><span class="linenos">746</span></a>                <span class="p">]</span>
</span><span id="Boxscore-747"><a href="#Boxscore-747"><span class="linenos">747</span></a>            <span class="p">)</span>
</span><span id="Boxscore-748"><a href="#Boxscore-748"><span class="linenos">748</span></a>            <span class="n">advanced</span> <span class="o">=</span> <span class="n">advanced</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;player&quot;</span><span class="p">,</span> <span class="s2">&quot;player_id&quot;</span><span class="p">,</span> <span class="s2">&quot;team&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="Boxscore-749"><a href="#Boxscore-749"><span class="linenos">749</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Boxscore-750"><a href="#Boxscore-750"><span class="linenos">750</span></a>            <span class="n">advanced</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;player_id&#39;</span><span class="p">,</span><span class="s1">&#39;pass_first_down&#39;</span><span class="p">,</span><span class="s1">&#39;rush_first_down&#39;</span><span class="p">,</span><span class="s1">&#39;rec_first_down&#39;</span><span class="p">])</span>
</span><span id="Boxscore-751"><a href="#Boxscore-751"><span class="linenos">751</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span><span class="p">,</span><span class="n">right</span><span class="o">=</span><span class="n">advanced</span><span class="p">[[</span><span class="s1">&#39;player_id&#39;</span><span class="p">,</span>\
</span><span id="Boxscore-752"><a href="#Boxscore-752"><span class="linenos">752</span></a>        <span class="s1">&#39;pass_first_down&#39;</span><span class="p">,</span><span class="s1">&#39;rush_first_down&#39;</span><span class="p">,</span><span class="s1">&#39;rec_first_down&#39;</span><span class="p">]],</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="s1">&#39;player_id&#39;</span><span class="p">)</span>
</span><span id="Boxscore-753"><a href="#Boxscore-753"><span class="linenos">753</span></a>        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;pass_first_down&#39;</span><span class="p">,</span><span class="s1">&#39;rush_first_down&#39;</span><span class="p">,</span><span class="s1">&#39;rec_first_down&#39;</span><span class="p">]:</span>
</span><span id="Boxscore-754"><a href="#Boxscore-754"><span class="linenos">754</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="Boxscore-755"><a href="#Boxscore-755"><span class="linenos">755</span></a>
</span><span id="Boxscore-756"><a href="#Boxscore-756"><span class="linenos">756</span></a>    <span class="k">def</span> <span class="nf">get_starters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Boxscore-757"><a href="#Boxscore-757"><span class="linenos">757</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Boxscore-758"><a href="#Boxscore-758"><span class="linenos">758</span></a><span class="sd">        Extracts the intended starters for each team in the game in question.</span>
</span><span id="Boxscore-759"><a href="#Boxscore-759"><span class="linenos">759</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Boxscore-760"><a href="#Boxscore-760"><span class="linenos">760</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">starters</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
</span><span id="Boxscore-761"><a href="#Boxscore-761"><span class="linenos">761</span></a>            <span class="p">[</span>
</span><span id="Boxscore-762"><a href="#Boxscore-762"><span class="linenos">762</span></a>                <span class="n">parse_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raw_text</span><span class="p">,</span> <span class="s2">&quot;home_starters&quot;</span><span class="p">),</span>
</span><span id="Boxscore-763"><a href="#Boxscore-763"><span class="linenos">763</span></a>                <span class="n">parse_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raw_text</span><span class="p">,</span> <span class="s2">&quot;vis_starters&quot;</span><span class="p">),</span>
</span><span id="Boxscore-764"><a href="#Boxscore-764"><span class="linenos">764</span></a>            <span class="p">]</span>
</span><span id="Boxscore-765"><a href="#Boxscore-765"><span class="linenos">765</span></a>        <span class="p">)</span>
</span><span id="Boxscore-766"><a href="#Boxscore-766"><span class="linenos">766</span></a>
</span><span id="Boxscore-767"><a href="#Boxscore-767"><span class="linenos">767</span></a>    <span class="k">def</span> <span class="nf">get_snap_counts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Boxscore-768"><a href="#Boxscore-768"><span class="linenos">768</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Boxscore-769"><a href="#Boxscore-769"><span class="linenos">769</span></a><span class="sd">        Extracts the actual snap counts for all players on each team in the game in question.</span>
</span><span id="Boxscore-770"><a href="#Boxscore-770"><span class="linenos">770</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Boxscore-771"><a href="#Boxscore-771"><span class="linenos">771</span></a>        <span class="c1"># Games before 2012 don&#39;t have snapcounts and therefore no positions for non-starters...</span>
</span><span id="Boxscore-772"><a href="#Boxscore-772"><span class="linenos">772</span></a>        <span class="c1"># Could merge position in via the get_names function...</span>
</span><span id="Boxscore-773"><a href="#Boxscore-773"><span class="linenos">773</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_text</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;home_snap_counts&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> \
</span><span id="Boxscore-774"><a href="#Boxscore-774"><span class="linenos">774</span></a>        <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_text</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;vis_snap_counts&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Boxscore-775"><a href="#Boxscore-775"><span class="linenos">775</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">snaps</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
</span><span id="Boxscore-776"><a href="#Boxscore-776"><span class="linenos">776</span></a>                <span class="p">[</span>
</span><span id="Boxscore-777"><a href="#Boxscore-777"><span class="linenos">777</span></a>                    <span class="n">parse_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raw_text</span><span class="p">,</span> <span class="s2">&quot;home_snap_counts&quot;</span><span class="p">),</span>
</span><span id="Boxscore-778"><a href="#Boxscore-778"><span class="linenos">778</span></a>                    <span class="n">parse_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raw_text</span><span class="p">,</span> <span class="s2">&quot;vis_snap_counts&quot;</span><span class="p">),</span>
</span><span id="Boxscore-779"><a href="#Boxscore-779"><span class="linenos">779</span></a>                <span class="p">]</span>
</span><span id="Boxscore-780"><a href="#Boxscore-780"><span class="linenos">780</span></a>            <span class="p">)</span>
</span><span id="Boxscore-781"><a href="#Boxscore-781"><span class="linenos">781</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Boxscore-782"><a href="#Boxscore-782"><span class="linenos">782</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">snaps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span><span class="p">[[</span><span class="s2">&quot;player&quot;</span><span class="p">,</span> <span class="s2">&quot;player_id&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Boxscore-783"><a href="#Boxscore-783"><span class="linenos">783</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">snaps</span><span class="p">[[</span><span class="s2">&quot;off_pct&quot;</span><span class="p">,</span><span class="s2">&quot;def_pct&quot;</span><span class="p">,</span><span class="s2">&quot;st_pct&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Boxscore-784"><a href="#Boxscore-784"><span class="linenos">784</span></a>
</span><span id="Boxscore-785"><a href="#Boxscore-785"><span class="linenos">785</span></a>    <span class="k">def</span> <span class="nf">add_depth_chart</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Boxscore-786"><a href="#Boxscore-786"><span class="linenos">786</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Boxscore-787"><a href="#Boxscore-787"><span class="linenos">787</span></a><span class="sd">        Infers actual depth chart based on available depth charts/snap counts</span>
</span><span id="Boxscore-788"><a href="#Boxscore-788"><span class="linenos">788</span></a><span class="sd">        and merges it into the game_stats dataframe. </span>
</span><span id="Boxscore-789"><a href="#Boxscore-789"><span class="linenos">789</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Boxscore-790"><a href="#Boxscore-790"><span class="linenos">790</span></a>        <span class="n">nonstarters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">snaps</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="Boxscore-791"><a href="#Boxscore-791"><span class="linenos">791</span></a>            <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">snaps</span><span class="o">.</span><span class="n">player_id</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">starters</span><span class="o">.</span><span class="n">player_id</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
</span><span id="Boxscore-792"><a href="#Boxscore-792"><span class="linenos">792</span></a>        <span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;off_pct&quot;</span><span class="p">,</span> <span class="s2">&quot;def_pct&quot;</span><span class="p">,</span> <span class="s2">&quot;st_pct&quot;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="Boxscore-793"><a href="#Boxscore-793"><span class="linenos">793</span></a>        <span class="n">depth_chart</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="Boxscore-794"><a href="#Boxscore-794"><span class="linenos">794</span></a>            <span class="n">left</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">starters</span><span class="o">.</span><span class="n">iloc</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">nonstarters</span><span class="p">]),</span>
</span><span id="Boxscore-795"><a href="#Boxscore-795"><span class="linenos">795</span></a>            <span class="n">right</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span><span class="p">[[</span><span class="s2">&quot;player&quot;</span><span class="p">,</span> <span class="s2">&quot;player_id&quot;</span><span class="p">,</span> <span class="s2">&quot;team&quot;</span><span class="p">]],</span>
</span><span id="Boxscore-796"><a href="#Boxscore-796"><span class="linenos">796</span></a>            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">,</span>
</span><span id="Boxscore-797"><a href="#Boxscore-797"><span class="linenos">797</span></a>            <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;player&quot;</span><span class="p">,</span> <span class="s2">&quot;player_id&quot;</span><span class="p">],</span>
</span><span id="Boxscore-798"><a href="#Boxscore-798"><span class="linenos">798</span></a>        <span class="p">)</span>
</span><span id="Boxscore-799"><a href="#Boxscore-799"><span class="linenos">799</span></a>        <span class="n">depth_chart</span><span class="p">[</span><span class="s2">&quot;dummy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Boxscore-800"><a href="#Boxscore-800"><span class="linenos">800</span></a>        <span class="n">depth_chart</span><span class="p">[</span><span class="s2">&quot;string&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">depth_chart</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;team&quot;</span><span class="p">,</span> <span class="s2">&quot;pos&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">dummy</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span>
</span><span id="Boxscore-801"><a href="#Boxscore-801"><span class="linenos">801</span></a>            <span class="n">method</span><span class="o">=</span><span class="s2">&quot;first&quot;</span>
</span><span id="Boxscore-802"><a href="#Boxscore-802"><span class="linenos">802</span></a>        <span class="p">)</span>
</span><span id="Boxscore-803"><a href="#Boxscore-803"><span class="linenos">803</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="Boxscore-804"><a href="#Boxscore-804"><span class="linenos">804</span></a>            <span class="n">left</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span><span class="p">,</span>
</span><span id="Boxscore-805"><a href="#Boxscore-805"><span class="linenos">805</span></a>            <span class="n">right</span><span class="o">=</span><span class="n">depth_chart</span><span class="p">[[</span><span class="s2">&quot;player&quot;</span><span class="p">,</span> <span class="s2">&quot;player_id&quot;</span><span class="p">,</span> <span class="s2">&quot;team&quot;</span><span class="p">,</span> <span class="s2">&quot;pos&quot;</span><span class="p">,</span> <span class="s2">&quot;string&quot;</span><span class="p">]],</span>
</span><span id="Boxscore-806"><a href="#Boxscore-806"><span class="linenos">806</span></a>            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">,</span>
</span><span id="Boxscore-807"><a href="#Boxscore-807"><span class="linenos">807</span></a>            <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;player&quot;</span><span class="p">,</span> <span class="s2">&quot;player_id&quot;</span><span class="p">,</span> <span class="s2">&quot;team&quot;</span><span class="p">],</span>
</span><span id="Boxscore-808"><a href="#Boxscore-808"><span class="linenos">808</span></a>        <span class="p">)</span>
</span><span id="Boxscore-809"><a href="#Boxscore-809"><span class="linenos">809</span></a>    
</span><span id="Boxscore-810"><a href="#Boxscore-810"><span class="linenos">810</span></a>    <span class="k">def</span> <span class="nf">add_qb_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pass_att</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.2</span><span class="p">,</span> <span class="n">pass_cmp</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">3.7</span><span class="p">,</span> <span class="n">pass_yds</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span> 
</span><span id="Boxscore-811"><a href="#Boxscore-811"><span class="linenos">811</span></a>    <span class="n">pass_td</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">11.3</span><span class="p">,</span> <span class="n">pass_int</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="o">-</span><span class="mf">14.1</span><span class="p">,</span> <span class="n">pass_sacked</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="o">-</span><span class="mf">8.0</span><span class="p">,</span> <span class="n">rush_att</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.1</span><span class="p">,</span>
</span><span id="Boxscore-812"><a href="#Boxscore-812"><span class="linenos">812</span></a>    <span class="n">rush_yds</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.6</span><span class="p">,</span> <span class="n">rush_td</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">15.9</span><span class="p">):</span>
</span><span id="Boxscore-813"><a href="#Boxscore-813"><span class="linenos">813</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Boxscore-814"><a href="#Boxscore-814"><span class="linenos">814</span></a><span class="sd">        Calculates individual QB elo value based on 538&#39;s model (#RIP).</span>
</span><span id="Boxscore-815"><a href="#Boxscore-815"><span class="linenos">815</span></a>
</span><span id="Boxscore-816"><a href="#Boxscore-816"><span class="linenos">816</span></a><span class="sd">        Args:</span>
</span><span id="Boxscore-817"><a href="#Boxscore-817"><span class="linenos">817</span></a><span class="sd">            pass_att (float, optional): weighting factor for pass attempts, defaults to -2.2.</span>
</span><span id="Boxscore-818"><a href="#Boxscore-818"><span class="linenos">818</span></a><span class="sd">            pass_cmp (float, optional): weighting factor for pass completions, defaults to 3.7.</span>
</span><span id="Boxscore-819"><a href="#Boxscore-819"><span class="linenos">819</span></a><span class="sd">            pass_yds (float, optional): weighting factor for passing yards, defaults to 0.2.</span>
</span><span id="Boxscore-820"><a href="#Boxscore-820"><span class="linenos">820</span></a><span class="sd">            pass_td (float, optional): weighting factor for passing touchdowns, defaults to 11.3.</span>
</span><span id="Boxscore-821"><a href="#Boxscore-821"><span class="linenos">821</span></a><span class="sd">            pass_sacked (float, optional): weighting factor for sacks, defaults to -8.0.</span>
</span><span id="Boxscore-822"><a href="#Boxscore-822"><span class="linenos">822</span></a><span class="sd">            rush_att (float, optional): weighting factor for rush attempts, defaults to -1.1.</span>
</span><span id="Boxscore-823"><a href="#Boxscore-823"><span class="linenos">823</span></a><span class="sd">            rush_yds (float, optional): weighting factor for rush yards, defaults to 0.6.</span>
</span><span id="Boxscore-824"><a href="#Boxscore-824"><span class="linenos">824</span></a><span class="sd">            rush_td (float, optional): weighting factor for rushing touchdowns, defaults to 15.9.</span>
</span><span id="Boxscore-825"><a href="#Boxscore-825"><span class="linenos">825</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Boxscore-826"><a href="#Boxscore-826"><span class="linenos">826</span></a>        <span class="n">qbs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span><span class="o">.</span><span class="n">pos</span> <span class="o">==</span> <span class="s1">&#39;QB&#39;</span>
</span><span id="Boxscore-827"><a href="#Boxscore-827"><span class="linenos">827</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">qbs</span><span class="p">,</span><span class="s1">&#39;VALUE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pass_att</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">qbs</span><span class="p">,</span><span class="s1">&#39;pass_att&#39;</span><span class="p">]</span> \
</span><span id="Boxscore-828"><a href="#Boxscore-828"><span class="linenos">828</span></a>        <span class="o">+</span> <span class="n">pass_cmp</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">qbs</span><span class="p">,</span><span class="s1">&#39;pass_cmp&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">pass_yds</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">qbs</span><span class="p">,</span><span class="s1">&#39;pass_yds&#39;</span><span class="p">]</span> \
</span><span id="Boxscore-829"><a href="#Boxscore-829"><span class="linenos">829</span></a>        <span class="o">+</span> <span class="n">pass_td</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">qbs</span><span class="p">,</span><span class="s1">&#39;pass_td&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">pass_int</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">qbs</span><span class="p">,</span><span class="s1">&#39;pass_int&#39;</span><span class="p">]</span> \
</span><span id="Boxscore-830"><a href="#Boxscore-830"><span class="linenos">830</span></a>        <span class="o">+</span> <span class="n">pass_sacked</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">qbs</span><span class="p">,</span><span class="s1">&#39;pass_sacked&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">rush_att</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">qbs</span><span class="p">,</span><span class="s1">&#39;rush_att&#39;</span><span class="p">]</span> \
</span><span id="Boxscore-831"><a href="#Boxscore-831"><span class="linenos">831</span></a>        <span class="o">+</span> <span class="n">rush_yds</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">qbs</span><span class="p">,</span><span class="s1">&#39;rush_yds&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">rush_td</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">qbs</span><span class="p">,</span><span class="s1">&#39;rush_td&#39;</span><span class="p">]</span>
</span><span id="Boxscore-832"><a href="#Boxscore-832"><span class="linenos">832</span></a>
</span><span id="Boxscore-833"><a href="#Boxscore-833"><span class="linenos">833</span></a>    <span class="k">def</span> <span class="nf">normalize_team_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Boxscore-834"><a href="#Boxscore-834"><span class="linenos">834</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Boxscore-835"><a href="#Boxscore-835"><span class="linenos">835</span></a><span class="sd">        Normalizes team names between Pro Football Reference&#39;s boxscores and schedules.</span>
</span><span id="Boxscore-836"><a href="#Boxscore-836"><span class="linenos">836</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Boxscore-837"><a href="#Boxscore-837"><span class="linenos">837</span></a>        <span class="n">abbrevs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;OAK&#39;</span><span class="p">:</span><span class="s1">&#39;RAI&#39;</span><span class="p">,</span><span class="s1">&#39;LVR&#39;</span><span class="p">:</span><span class="s1">&#39;RAI&#39;</span><span class="p">,</span><span class="s1">&#39;LAC&#39;</span><span class="p">:</span><span class="s1">&#39;SDG&#39;</span><span class="p">,</span><span class="s1">&#39;STL&#39;</span><span class="p">:</span><span class="s1">&#39;RAM&#39;</span><span class="p">,</span><span class="s1">&#39;LAR&#39;</span><span class="p">:</span><span class="s1">&#39;RAM&#39;</span><span class="p">,</span>\
</span><span id="Boxscore-838"><a href="#Boxscore-838"><span class="linenos">838</span></a>        <span class="s1">&#39;ARI&#39;</span><span class="p">:</span><span class="s1">&#39;CRD&#39;</span><span class="p">,</span><span class="s1">&#39;IND&#39;</span><span class="p">:</span><span class="s1">&#39;CLT&#39;</span><span class="p">,</span><span class="s1">&#39;BAL&#39;</span><span class="p">:</span><span class="s1">&#39;RAV&#39;</span><span class="p">,</span><span class="s1">&#39;HOU&#39;</span><span class="p">:</span><span class="s1">&#39;HTX&#39;</span><span class="p">,</span><span class="s1">&#39;TEN&#39;</span><span class="p">:</span><span class="s1">&#39;OTI&#39;</span><span class="p">}</span>
</span><span id="Boxscore-839"><a href="#Boxscore-839"><span class="linenos">839</span></a>        <span class="k">for</span> <span class="n">team</span> <span class="ow">in</span> <span class="n">abbrevs</span><span class="p">:</span>
</span><span id="Boxscore-840"><a href="#Boxscore-840"><span class="linenos">840</span></a>            <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;team&#39;</span><span class="p">,</span><span class="s1">&#39;opponent&#39;</span><span class="p">]:</span>
</span><span id="Boxscore-841"><a href="#Boxscore-841"><span class="linenos">841</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span><span class="p">[</span><span class="n">val</span><span class="p">]</span> <span class="o">==</span> <span class="n">team</span><span class="p">,</span><span class="n">val</span><span class="p">]</span> <span class="o">=</span> <span class="n">abbrevs</span><span class="p">[</span><span class="n">team</span><span class="p">]</span>
</span><span id="Boxscore-842"><a href="#Boxscore-842"><span class="linenos">842</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">team1_abbrev</span> <span class="ow">in</span> <span class="n">abbrevs</span><span class="p">:</span>
</span><span id="Boxscore-843"><a href="#Boxscore-843"><span class="linenos">843</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">team1_abbrev</span> <span class="o">=</span> <span class="n">abbrevs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">team1_abbrev</span><span class="p">]</span>
</span><span id="Boxscore-844"><a href="#Boxscore-844"><span class="linenos">844</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">team2_abbrev</span> <span class="ow">in</span> <span class="n">abbrevs</span><span class="p">:</span>
</span><span id="Boxscore-845"><a href="#Boxscore-845"><span class="linenos">845</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">team2_abbrev</span> <span class="o">=</span> <span class="n">abbrevs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">team2_abbrev</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Boxscore class that gathers all relevant statistics for the game in question
and parses them into a pandas dataframe.</p>

<p>Attributes:
    game_id: unique SportsRef identifier for the game in question.
    raw_text: raw html for the Pro Football Reference page of the game in question.
    season: season of the game in question.
    week: week of the season for the game in question.
    team1_abbrev: abbreviation for the home team.
    team1_score: points scored by the home team.
    team2_abbrev: abbreviation for the away team.
    team2_score: points scored by the away team.
    game_stats: dataframe containing relevant statistics for the game in question.
    starters: dataframe containing the list of starting players for both teams.
    snaps: dataframe containing the number of snaps played by every player on both teams.</p>
</div>


                            <div id="Boxscore.__init__" class="classattr">
                                        <input id="Boxscore.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">Boxscore</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">game_id</span><span class="p">:</span> <span class="nb">str</span></span>)</span>

                <label class="view-source-button" for="Boxscore.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Boxscore.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Boxscore.__init__-661"><a href="#Boxscore.__init__-661"><span class="linenos">661</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">game_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Boxscore.__init__-662"><a href="#Boxscore.__init__-662"><span class="linenos">662</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Boxscore.__init__-663"><a href="#Boxscore.__init__-663"><span class="linenos">663</span></a><span class="sd">        Initializes a Boxscore object using the parameters provided and class functions defined below.</span>
</span><span id="Boxscore.__init__-664"><a href="#Boxscore.__init__-664"><span class="linenos">664</span></a>
</span><span id="Boxscore.__init__-665"><a href="#Boxscore.__init__-665"><span class="linenos">665</span></a><span class="sd">        Args:</span>
</span><span id="Boxscore.__init__-666"><a href="#Boxscore.__init__-666"><span class="linenos">666</span></a><span class="sd">            game_id (str): unique SportsRef identifier for the game in question.</span>
</span><span id="Boxscore.__init__-667"><a href="#Boxscore.__init__-667"><span class="linenos">667</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Boxscore.__init__-668"><a href="#Boxscore.__init__-668"><span class="linenos">668</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">game_id</span> <span class="o">=</span> <span class="n">game_id</span>
</span><span id="Boxscore.__init__-669"><a href="#Boxscore.__init__-669"><span class="linenos">669</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">get_raw_text</span><span class="p">()</span>
</span><span id="Boxscore.__init__-670"><a href="#Boxscore.__init__-670"><span class="linenos">670</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">get_details</span><span class="p">()</span>
</span><span id="Boxscore.__init__-671"><a href="#Boxscore.__init__-671"><span class="linenos">671</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">get_stats</span><span class="p">()</span>
</span><span id="Boxscore.__init__-672"><a href="#Boxscore.__init__-672"><span class="linenos">672</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">get_advanced_stats</span><span class="p">()</span>
</span><span id="Boxscore.__init__-673"><a href="#Boxscore.__init__-673"><span class="linenos">673</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">get_starters</span><span class="p">()</span>
</span><span id="Boxscore.__init__-674"><a href="#Boxscore.__init__-674"><span class="linenos">674</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">get_snap_counts</span><span class="p">()</span>
</span><span id="Boxscore.__init__-675"><a href="#Boxscore.__init__-675"><span class="linenos">675</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_depth_chart</span><span class="p">()</span>
</span><span id="Boxscore.__init__-676"><a href="#Boxscore.__init__-676"><span class="linenos">676</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_qb_value</span><span class="p">()</span>
</span><span id="Boxscore.__init__-677"><a href="#Boxscore.__init__-677"><span class="linenos">677</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">normalize_team_names</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Initializes a Boxscore object using the parameters provided and class functions defined below.</p>

<p>Args:
    game_id (str): unique SportsRef identifier for the game in question.</p>
</div>


                            </div>
                            <div id="Boxscore.game_id" class="classattr">
                                <div class="attr variable">
            <span class="name">game_id</span>

        
    </div>
    <a class="headerlink" href="#Boxscore.game_id"></a>
    
    

                            </div>
                            <div id="Boxscore.get_raw_text" class="classattr">
                                        <input id="Boxscore.get_raw_text-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_raw_text</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Boxscore.get_raw_text-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Boxscore.get_raw_text"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Boxscore.get_raw_text-679"><a href="#Boxscore.get_raw_text-679"><span class="linenos">679</span></a>    <span class="k">def</span> <span class="nf">get_raw_text</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Boxscore.get_raw_text-680"><a href="#Boxscore.get_raw_text-680"><span class="linenos">680</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Boxscore.get_raw_text-681"><a href="#Boxscore.get_raw_text-681"><span class="linenos">681</span></a><span class="sd">        Pulls down the raw html from Pro Football Reference containing the statistics for the game in question.</span>
</span><span id="Boxscore.get_raw_text-682"><a href="#Boxscore.get_raw_text-682"><span class="linenos">682</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Boxscore.get_raw_text-683"><a href="#Boxscore.get_raw_text-683"><span class="linenos">683</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">raw_text</span> <span class="o">=</span> <span class="n">get_page</span><span class="p">(</span><span class="s2">&quot;boxscores/</span><span class="si">{}</span><span class="s2">.htm&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">game_id</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Pulls down the raw html from Pro Football Reference containing the statistics for the game in question.</p>
</div>


                            </div>
                            <div id="Boxscore.get_details" class="classattr">
                                        <input id="Boxscore.get_details-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_details</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Boxscore.get_details-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Boxscore.get_details"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Boxscore.get_details-685"><a href="#Boxscore.get_details-685"><span class="linenos">685</span></a>    <span class="k">def</span> <span class="nf">get_details</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Boxscore.get_details-686"><a href="#Boxscore.get_details-686"><span class="linenos">686</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Boxscore.get_details-687"><a href="#Boxscore.get_details-687"><span class="linenos">687</span></a><span class="sd">        Extracts the overarching details for the game in question, specifically the season, week, score, and teams involved.</span>
</span><span id="Boxscore.get_details-688"><a href="#Boxscore.get_details-688"><span class="linenos">688</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Boxscore.get_details-689"><a href="#Boxscore.get_details-689"><span class="linenos">689</span></a>        <span class="n">season_week</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_text</span><span class="o">.</span><span class="n">find</span><span class="p">(</span>
</span><span id="Boxscore.get_details-690"><a href="#Boxscore.get_details-690"><span class="linenos">690</span></a>            <span class="s2">&quot;div&quot;</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;game_summaries compressed&quot;</span><span class="p">}</span>
</span><span id="Boxscore.get_details-691"><a href="#Boxscore.get_details-691"><span class="linenos">691</span></a>        <span class="p">)</span>
</span><span id="Boxscore.get_details-692"><a href="#Boxscore.get_details-692"><span class="linenos">692</span></a>        <span class="n">season_week</span> <span class="o">=</span> <span class="n">season_week</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;href&quot;</span><span class="p">]</span>
</span><span id="Boxscore.get_details-693"><a href="#Boxscore.get_details-693"><span class="linenos">693</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">season</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">season_week</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
</span><span id="Boxscore.get_details-694"><a href="#Boxscore.get_details-694"><span class="linenos">694</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">week</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">season_week</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="Boxscore.get_details-695"><a href="#Boxscore.get_details-695"><span class="linenos">695</span></a>        <span class="n">home_scores</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_text</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span>
</span><span id="Boxscore.get_details-696"><a href="#Boxscore.get_details-696"><span class="linenos">696</span></a>            <span class="p">[</span><span class="s2">&quot;th&quot;</span><span class="p">,</span><span class="s2">&quot;td&quot;</span><span class="p">],</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;data-stat&quot;</span><span class="p">:</span> <span class="s2">&quot;home_team_score&quot;</span><span class="p">}</span>
</span><span id="Boxscore.get_details-697"><a href="#Boxscore.get_details-697"><span class="linenos">697</span></a>        <span class="p">)</span>
</span><span id="Boxscore.get_details-698"><a href="#Boxscore.get_details-698"><span class="linenos">698</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">team1_abbrev</span> <span class="o">=</span> <span class="n">home_scores</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span>
</span><span id="Boxscore.get_details-699"><a href="#Boxscore.get_details-699"><span class="linenos">699</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">team1_score</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">home_scores</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span><span id="Boxscore.get_details-700"><a href="#Boxscore.get_details-700"><span class="linenos">700</span></a>        <span class="n">away_scores</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_text</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span>
</span><span id="Boxscore.get_details-701"><a href="#Boxscore.get_details-701"><span class="linenos">701</span></a>            <span class="p">[</span><span class="s2">&quot;th&quot;</span><span class="p">,</span><span class="s2">&quot;td&quot;</span><span class="p">],</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;data-stat&quot;</span><span class="p">:</span> <span class="s2">&quot;vis_team_score&quot;</span><span class="p">}</span>
</span><span id="Boxscore.get_details-702"><a href="#Boxscore.get_details-702"><span class="linenos">702</span></a>        <span class="p">)</span>
</span><span id="Boxscore.get_details-703"><a href="#Boxscore.get_details-703"><span class="linenos">703</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">team2_abbrev</span> <span class="o">=</span> <span class="n">away_scores</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span>
</span><span id="Boxscore.get_details-704"><a href="#Boxscore.get_details-704"><span class="linenos">704</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">team2_score</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">away_scores</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Extracts the overarching details for the game in question, specifically the season, week, score, and teams involved.</p>
</div>


                            </div>
                            <div id="Boxscore.get_stats" class="classattr">
                                        <input id="Boxscore.get_stats-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_stats</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Boxscore.get_stats-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Boxscore.get_stats"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Boxscore.get_stats-706"><a href="#Boxscore.get_stats-706"><span class="linenos">706</span></a>    <span class="k">def</span> <span class="nf">get_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Boxscore.get_stats-707"><a href="#Boxscore.get_stats-707"><span class="linenos">707</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Boxscore.get_stats-708"><a href="#Boxscore.get_stats-708"><span class="linenos">708</span></a><span class="sd">        Extracts the basic offensive, defensive, and special teams stats </span>
</span><span id="Boxscore.get_stats-709"><a href="#Boxscore.get_stats-709"><span class="linenos">709</span></a><span class="sd">        from the raw html for the game in question.</span>
</span><span id="Boxscore.get_stats-710"><a href="#Boxscore.get_stats-710"><span class="linenos">710</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Boxscore.get_stats-711"><a href="#Boxscore.get_stats-711"><span class="linenos">711</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
</span><span id="Boxscore.get_stats-712"><a href="#Boxscore.get_stats-712"><span class="linenos">712</span></a>            <span class="p">[</span>
</span><span id="Boxscore.get_stats-713"><a href="#Boxscore.get_stats-713"><span class="linenos">713</span></a>                <span class="n">parse_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raw_text</span><span class="p">,</span> <span class="s2">&quot;player_offense&quot;</span><span class="p">),</span>
</span><span id="Boxscore.get_stats-714"><a href="#Boxscore.get_stats-714"><span class="linenos">714</span></a>                <span class="n">parse_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raw_text</span><span class="p">,</span> <span class="s2">&quot;player_defense&quot;</span><span class="p">),</span>
</span><span id="Boxscore.get_stats-715"><a href="#Boxscore.get_stats-715"><span class="linenos">715</span></a>                <span class="n">parse_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raw_text</span><span class="p">,</span> <span class="s2">&quot;kicking&quot;</span><span class="p">),</span>
</span><span id="Boxscore.get_stats-716"><a href="#Boxscore.get_stats-716"><span class="linenos">716</span></a>            <span class="p">]</span>
</span><span id="Boxscore.get_stats-717"><a href="#Boxscore.get_stats-717"><span class="linenos">717</span></a>        <span class="p">)</span>
</span><span id="Boxscore.get_stats-718"><a href="#Boxscore.get_stats-718"><span class="linenos">718</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_text</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;returns&quot;</span><span class="p">):</span>
</span><span id="Boxscore.get_stats-719"><a href="#Boxscore.get_stats-719"><span class="linenos">719</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
</span><span id="Boxscore.get_stats-720"><a href="#Boxscore.get_stats-720"><span class="linenos">720</span></a>                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span><span class="p">,</span> <span class="n">parse_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raw_text</span><span class="p">,</span> <span class="s2">&quot;returns&quot;</span><span class="p">)]</span>
</span><span id="Boxscore.get_stats-721"><a href="#Boxscore.get_stats-721"><span class="linenos">721</span></a>            <span class="p">)</span>
</span><span id="Boxscore.get_stats-722"><a href="#Boxscore.get_stats-722"><span class="linenos">722</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Boxscore.get_stats-723"><a href="#Boxscore.get_stats-723"><span class="linenos">723</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="Boxscore.get_stats-724"><a href="#Boxscore.get_stats-724"><span class="linenos">724</span></a>            <span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;player&quot;</span><span class="p">,</span> <span class="s2">&quot;player_id&quot;</span><span class="p">,</span> <span class="s2">&quot;team&quot;</span><span class="p">])</span>
</span><span id="Boxscore.get_stats-725"><a href="#Boxscore.get_stats-725"><span class="linenos">725</span></a>            <span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</span><span id="Boxscore.get_stats-726"><a href="#Boxscore.get_stats-726"><span class="linenos">726</span></a>            <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="Boxscore.get_stats-727"><a href="#Boxscore.get_stats-727"><span class="linenos">727</span></a>        <span class="p">)</span>
</span><span id="Boxscore.get_stats-728"><a href="#Boxscore.get_stats-728"><span class="linenos">728</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="Boxscore.get_stats-729"><a href="#Boxscore.get_stats-729"><span class="linenos">729</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span><span class="o">.</span><span class="n">team</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">team1_abbrev</span><span class="p">,</span> <span class="s2">&quot;opponent&quot;</span>
</span><span id="Boxscore.get_stats-730"><a href="#Boxscore.get_stats-730"><span class="linenos">730</span></a>        <span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">team2_abbrev</span>
</span><span id="Boxscore.get_stats-731"><a href="#Boxscore.get_stats-731"><span class="linenos">731</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="Boxscore.get_stats-732"><a href="#Boxscore.get_stats-732"><span class="linenos">732</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span><span class="o">.</span><span class="n">team</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">team2_abbrev</span><span class="p">,</span> <span class="s2">&quot;opponent&quot;</span>
</span><span id="Boxscore.get_stats-733"><a href="#Boxscore.get_stats-733"><span class="linenos">733</span></a>        <span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">team1_abbrev</span>
</span></pre></div>


            <div class="docstring"><p>Extracts the basic offensive, defensive, and special teams stats 
from the raw html for the game in question.</p>
</div>


                            </div>
                            <div id="Boxscore.get_advanced_stats" class="classattr">
                                        <input id="Boxscore.get_advanced_stats-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_advanced_stats</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Boxscore.get_advanced_stats-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Boxscore.get_advanced_stats"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Boxscore.get_advanced_stats-735"><a href="#Boxscore.get_advanced_stats-735"><span class="linenos">735</span></a>    <span class="k">def</span> <span class="nf">get_advanced_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Boxscore.get_advanced_stats-736"><a href="#Boxscore.get_advanced_stats-736"><span class="linenos">736</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Boxscore.get_advanced_stats-737"><a href="#Boxscore.get_advanced_stats-737"><span class="linenos">737</span></a><span class="sd">        Extracts the advanced offensive, defensive, and special teams stats </span>
</span><span id="Boxscore.get_advanced_stats-738"><a href="#Boxscore.get_advanced_stats-738"><span class="linenos">738</span></a><span class="sd">        from the raw html for the game in question (e.g. first downs).</span>
</span><span id="Boxscore.get_advanced_stats-739"><a href="#Boxscore.get_advanced_stats-739"><span class="linenos">739</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Boxscore.get_advanced_stats-740"><a href="#Boxscore.get_advanced_stats-740"><span class="linenos">740</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_text</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;passing_advanced&quot;</span><span class="p">):</span>
</span><span id="Boxscore.get_advanced_stats-741"><a href="#Boxscore.get_advanced_stats-741"><span class="linenos">741</span></a>            <span class="n">advanced</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
</span><span id="Boxscore.get_advanced_stats-742"><a href="#Boxscore.get_advanced_stats-742"><span class="linenos">742</span></a>                <span class="p">[</span>
</span><span id="Boxscore.get_advanced_stats-743"><a href="#Boxscore.get_advanced_stats-743"><span class="linenos">743</span></a>                    <span class="n">parse_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raw_text</span><span class="p">,</span> <span class="s2">&quot;passing_advanced&quot;</span><span class="p">),</span>
</span><span id="Boxscore.get_advanced_stats-744"><a href="#Boxscore.get_advanced_stats-744"><span class="linenos">744</span></a>                    <span class="n">parse_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raw_text</span><span class="p">,</span> <span class="s2">&quot;rushing_advanced&quot;</span><span class="p">),</span>
</span><span id="Boxscore.get_advanced_stats-745"><a href="#Boxscore.get_advanced_stats-745"><span class="linenos">745</span></a>                    <span class="n">parse_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raw_text</span><span class="p">,</span> <span class="s2">&quot;receiving_advanced&quot;</span><span class="p">),</span>
</span><span id="Boxscore.get_advanced_stats-746"><a href="#Boxscore.get_advanced_stats-746"><span class="linenos">746</span></a>                <span class="p">]</span>
</span><span id="Boxscore.get_advanced_stats-747"><a href="#Boxscore.get_advanced_stats-747"><span class="linenos">747</span></a>            <span class="p">)</span>
</span><span id="Boxscore.get_advanced_stats-748"><a href="#Boxscore.get_advanced_stats-748"><span class="linenos">748</span></a>            <span class="n">advanced</span> <span class="o">=</span> <span class="n">advanced</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;player&quot;</span><span class="p">,</span> <span class="s2">&quot;player_id&quot;</span><span class="p">,</span> <span class="s2">&quot;team&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="Boxscore.get_advanced_stats-749"><a href="#Boxscore.get_advanced_stats-749"><span class="linenos">749</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Boxscore.get_advanced_stats-750"><a href="#Boxscore.get_advanced_stats-750"><span class="linenos">750</span></a>            <span class="n">advanced</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;player_id&#39;</span><span class="p">,</span><span class="s1">&#39;pass_first_down&#39;</span><span class="p">,</span><span class="s1">&#39;rush_first_down&#39;</span><span class="p">,</span><span class="s1">&#39;rec_first_down&#39;</span><span class="p">])</span>
</span><span id="Boxscore.get_advanced_stats-751"><a href="#Boxscore.get_advanced_stats-751"><span class="linenos">751</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span><span class="p">,</span><span class="n">right</span><span class="o">=</span><span class="n">advanced</span><span class="p">[[</span><span class="s1">&#39;player_id&#39;</span><span class="p">,</span>\
</span><span id="Boxscore.get_advanced_stats-752"><a href="#Boxscore.get_advanced_stats-752"><span class="linenos">752</span></a>        <span class="s1">&#39;pass_first_down&#39;</span><span class="p">,</span><span class="s1">&#39;rush_first_down&#39;</span><span class="p">,</span><span class="s1">&#39;rec_first_down&#39;</span><span class="p">]],</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="s1">&#39;player_id&#39;</span><span class="p">)</span>
</span><span id="Boxscore.get_advanced_stats-753"><a href="#Boxscore.get_advanced_stats-753"><span class="linenos">753</span></a>        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;pass_first_down&#39;</span><span class="p">,</span><span class="s1">&#39;rush_first_down&#39;</span><span class="p">,</span><span class="s1">&#39;rec_first_down&#39;</span><span class="p">]:</span>
</span><span id="Boxscore.get_advanced_stats-754"><a href="#Boxscore.get_advanced_stats-754"><span class="linenos">754</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Extracts the advanced offensive, defensive, and special teams stats 
from the raw html for the game in question (e.g. first downs).</p>
</div>


                            </div>
                            <div id="Boxscore.get_starters" class="classattr">
                                        <input id="Boxscore.get_starters-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_starters</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Boxscore.get_starters-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Boxscore.get_starters"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Boxscore.get_starters-756"><a href="#Boxscore.get_starters-756"><span class="linenos">756</span></a>    <span class="k">def</span> <span class="nf">get_starters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Boxscore.get_starters-757"><a href="#Boxscore.get_starters-757"><span class="linenos">757</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Boxscore.get_starters-758"><a href="#Boxscore.get_starters-758"><span class="linenos">758</span></a><span class="sd">        Extracts the intended starters for each team in the game in question.</span>
</span><span id="Boxscore.get_starters-759"><a href="#Boxscore.get_starters-759"><span class="linenos">759</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Boxscore.get_starters-760"><a href="#Boxscore.get_starters-760"><span class="linenos">760</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">starters</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
</span><span id="Boxscore.get_starters-761"><a href="#Boxscore.get_starters-761"><span class="linenos">761</span></a>            <span class="p">[</span>
</span><span id="Boxscore.get_starters-762"><a href="#Boxscore.get_starters-762"><span class="linenos">762</span></a>                <span class="n">parse_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raw_text</span><span class="p">,</span> <span class="s2">&quot;home_starters&quot;</span><span class="p">),</span>
</span><span id="Boxscore.get_starters-763"><a href="#Boxscore.get_starters-763"><span class="linenos">763</span></a>                <span class="n">parse_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raw_text</span><span class="p">,</span> <span class="s2">&quot;vis_starters&quot;</span><span class="p">),</span>
</span><span id="Boxscore.get_starters-764"><a href="#Boxscore.get_starters-764"><span class="linenos">764</span></a>            <span class="p">]</span>
</span><span id="Boxscore.get_starters-765"><a href="#Boxscore.get_starters-765"><span class="linenos">765</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Extracts the intended starters for each team in the game in question.</p>
</div>


                            </div>
                            <div id="Boxscore.get_snap_counts" class="classattr">
                                        <input id="Boxscore.get_snap_counts-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_snap_counts</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Boxscore.get_snap_counts-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Boxscore.get_snap_counts"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Boxscore.get_snap_counts-767"><a href="#Boxscore.get_snap_counts-767"><span class="linenos">767</span></a>    <span class="k">def</span> <span class="nf">get_snap_counts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Boxscore.get_snap_counts-768"><a href="#Boxscore.get_snap_counts-768"><span class="linenos">768</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Boxscore.get_snap_counts-769"><a href="#Boxscore.get_snap_counts-769"><span class="linenos">769</span></a><span class="sd">        Extracts the actual snap counts for all players on each team in the game in question.</span>
</span><span id="Boxscore.get_snap_counts-770"><a href="#Boxscore.get_snap_counts-770"><span class="linenos">770</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Boxscore.get_snap_counts-771"><a href="#Boxscore.get_snap_counts-771"><span class="linenos">771</span></a>        <span class="c1"># Games before 2012 don&#39;t have snapcounts and therefore no positions for non-starters...</span>
</span><span id="Boxscore.get_snap_counts-772"><a href="#Boxscore.get_snap_counts-772"><span class="linenos">772</span></a>        <span class="c1"># Could merge position in via the get_names function...</span>
</span><span id="Boxscore.get_snap_counts-773"><a href="#Boxscore.get_snap_counts-773"><span class="linenos">773</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_text</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;home_snap_counts&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> \
</span><span id="Boxscore.get_snap_counts-774"><a href="#Boxscore.get_snap_counts-774"><span class="linenos">774</span></a>        <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_text</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;vis_snap_counts&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Boxscore.get_snap_counts-775"><a href="#Boxscore.get_snap_counts-775"><span class="linenos">775</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">snaps</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
</span><span id="Boxscore.get_snap_counts-776"><a href="#Boxscore.get_snap_counts-776"><span class="linenos">776</span></a>                <span class="p">[</span>
</span><span id="Boxscore.get_snap_counts-777"><a href="#Boxscore.get_snap_counts-777"><span class="linenos">777</span></a>                    <span class="n">parse_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raw_text</span><span class="p">,</span> <span class="s2">&quot;home_snap_counts&quot;</span><span class="p">),</span>
</span><span id="Boxscore.get_snap_counts-778"><a href="#Boxscore.get_snap_counts-778"><span class="linenos">778</span></a>                    <span class="n">parse_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raw_text</span><span class="p">,</span> <span class="s2">&quot;vis_snap_counts&quot;</span><span class="p">),</span>
</span><span id="Boxscore.get_snap_counts-779"><a href="#Boxscore.get_snap_counts-779"><span class="linenos">779</span></a>                <span class="p">]</span>
</span><span id="Boxscore.get_snap_counts-780"><a href="#Boxscore.get_snap_counts-780"><span class="linenos">780</span></a>            <span class="p">)</span>
</span><span id="Boxscore.get_snap_counts-781"><a href="#Boxscore.get_snap_counts-781"><span class="linenos">781</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Boxscore.get_snap_counts-782"><a href="#Boxscore.get_snap_counts-782"><span class="linenos">782</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">snaps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span><span class="p">[[</span><span class="s2">&quot;player&quot;</span><span class="p">,</span> <span class="s2">&quot;player_id&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Boxscore.get_snap_counts-783"><a href="#Boxscore.get_snap_counts-783"><span class="linenos">783</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">snaps</span><span class="p">[[</span><span class="s2">&quot;off_pct&quot;</span><span class="p">,</span><span class="s2">&quot;def_pct&quot;</span><span class="p">,</span><span class="s2">&quot;st_pct&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span></pre></div>


            <div class="docstring"><p>Extracts the actual snap counts for all players on each team in the game in question.</p>
</div>


                            </div>
                            <div id="Boxscore.add_depth_chart" class="classattr">
                                        <input id="Boxscore.add_depth_chart-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_depth_chart</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Boxscore.add_depth_chart-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Boxscore.add_depth_chart"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Boxscore.add_depth_chart-785"><a href="#Boxscore.add_depth_chart-785"><span class="linenos">785</span></a>    <span class="k">def</span> <span class="nf">add_depth_chart</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Boxscore.add_depth_chart-786"><a href="#Boxscore.add_depth_chart-786"><span class="linenos">786</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Boxscore.add_depth_chart-787"><a href="#Boxscore.add_depth_chart-787"><span class="linenos">787</span></a><span class="sd">        Infers actual depth chart based on available depth charts/snap counts</span>
</span><span id="Boxscore.add_depth_chart-788"><a href="#Boxscore.add_depth_chart-788"><span class="linenos">788</span></a><span class="sd">        and merges it into the game_stats dataframe. </span>
</span><span id="Boxscore.add_depth_chart-789"><a href="#Boxscore.add_depth_chart-789"><span class="linenos">789</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Boxscore.add_depth_chart-790"><a href="#Boxscore.add_depth_chart-790"><span class="linenos">790</span></a>        <span class="n">nonstarters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">snaps</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="Boxscore.add_depth_chart-791"><a href="#Boxscore.add_depth_chart-791"><span class="linenos">791</span></a>            <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">snaps</span><span class="o">.</span><span class="n">player_id</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">starters</span><span class="o">.</span><span class="n">player_id</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
</span><span id="Boxscore.add_depth_chart-792"><a href="#Boxscore.add_depth_chart-792"><span class="linenos">792</span></a>        <span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;off_pct&quot;</span><span class="p">,</span> <span class="s2">&quot;def_pct&quot;</span><span class="p">,</span> <span class="s2">&quot;st_pct&quot;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="Boxscore.add_depth_chart-793"><a href="#Boxscore.add_depth_chart-793"><span class="linenos">793</span></a>        <span class="n">depth_chart</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="Boxscore.add_depth_chart-794"><a href="#Boxscore.add_depth_chart-794"><span class="linenos">794</span></a>            <span class="n">left</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">starters</span><span class="o">.</span><span class="n">iloc</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">nonstarters</span><span class="p">]),</span>
</span><span id="Boxscore.add_depth_chart-795"><a href="#Boxscore.add_depth_chart-795"><span class="linenos">795</span></a>            <span class="n">right</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span><span class="p">[[</span><span class="s2">&quot;player&quot;</span><span class="p">,</span> <span class="s2">&quot;player_id&quot;</span><span class="p">,</span> <span class="s2">&quot;team&quot;</span><span class="p">]],</span>
</span><span id="Boxscore.add_depth_chart-796"><a href="#Boxscore.add_depth_chart-796"><span class="linenos">796</span></a>            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">,</span>
</span><span id="Boxscore.add_depth_chart-797"><a href="#Boxscore.add_depth_chart-797"><span class="linenos">797</span></a>            <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;player&quot;</span><span class="p">,</span> <span class="s2">&quot;player_id&quot;</span><span class="p">],</span>
</span><span id="Boxscore.add_depth_chart-798"><a href="#Boxscore.add_depth_chart-798"><span class="linenos">798</span></a>        <span class="p">)</span>
</span><span id="Boxscore.add_depth_chart-799"><a href="#Boxscore.add_depth_chart-799"><span class="linenos">799</span></a>        <span class="n">depth_chart</span><span class="p">[</span><span class="s2">&quot;dummy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Boxscore.add_depth_chart-800"><a href="#Boxscore.add_depth_chart-800"><span class="linenos">800</span></a>        <span class="n">depth_chart</span><span class="p">[</span><span class="s2">&quot;string&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">depth_chart</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;team&quot;</span><span class="p">,</span> <span class="s2">&quot;pos&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">dummy</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span>
</span><span id="Boxscore.add_depth_chart-801"><a href="#Boxscore.add_depth_chart-801"><span class="linenos">801</span></a>            <span class="n">method</span><span class="o">=</span><span class="s2">&quot;first&quot;</span>
</span><span id="Boxscore.add_depth_chart-802"><a href="#Boxscore.add_depth_chart-802"><span class="linenos">802</span></a>        <span class="p">)</span>
</span><span id="Boxscore.add_depth_chart-803"><a href="#Boxscore.add_depth_chart-803"><span class="linenos">803</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="Boxscore.add_depth_chart-804"><a href="#Boxscore.add_depth_chart-804"><span class="linenos">804</span></a>            <span class="n">left</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span><span class="p">,</span>
</span><span id="Boxscore.add_depth_chart-805"><a href="#Boxscore.add_depth_chart-805"><span class="linenos">805</span></a>            <span class="n">right</span><span class="o">=</span><span class="n">depth_chart</span><span class="p">[[</span><span class="s2">&quot;player&quot;</span><span class="p">,</span> <span class="s2">&quot;player_id&quot;</span><span class="p">,</span> <span class="s2">&quot;team&quot;</span><span class="p">,</span> <span class="s2">&quot;pos&quot;</span><span class="p">,</span> <span class="s2">&quot;string&quot;</span><span class="p">]],</span>
</span><span id="Boxscore.add_depth_chart-806"><a href="#Boxscore.add_depth_chart-806"><span class="linenos">806</span></a>            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">,</span>
</span><span id="Boxscore.add_depth_chart-807"><a href="#Boxscore.add_depth_chart-807"><span class="linenos">807</span></a>            <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;player&quot;</span><span class="p">,</span> <span class="s2">&quot;player_id&quot;</span><span class="p">,</span> <span class="s2">&quot;team&quot;</span><span class="p">],</span>
</span><span id="Boxscore.add_depth_chart-808"><a href="#Boxscore.add_depth_chart-808"><span class="linenos">808</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Infers actual depth chart based on available depth charts/snap counts
and merges it into the game_stats dataframe.</p>
</div>


                            </div>
                            <div id="Boxscore.add_qb_value" class="classattr">
                                        <input id="Boxscore.add_qb_value-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_qb_value</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">pass_att</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.2</span>,</span><span class="param">	<span class="n">pass_cmp</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">3.7</span>,</span><span class="param">	<span class="n">pass_yds</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.2</span>,</span><span class="param">	<span class="n">pass_td</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">11.3</span>,</span><span class="param">	<span class="n">pass_int</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="o">-</span><span class="mf">14.1</span>,</span><span class="param">	<span class="n">pass_sacked</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="o">-</span><span class="mf">8.0</span>,</span><span class="param">	<span class="n">rush_att</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.1</span>,</span><span class="param">	<span class="n">rush_yds</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.6</span>,</span><span class="param">	<span class="n">rush_td</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">15.9</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Boxscore.add_qb_value-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Boxscore.add_qb_value"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Boxscore.add_qb_value-810"><a href="#Boxscore.add_qb_value-810"><span class="linenos">810</span></a>    <span class="k">def</span> <span class="nf">add_qb_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pass_att</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.2</span><span class="p">,</span> <span class="n">pass_cmp</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">3.7</span><span class="p">,</span> <span class="n">pass_yds</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span> 
</span><span id="Boxscore.add_qb_value-811"><a href="#Boxscore.add_qb_value-811"><span class="linenos">811</span></a>    <span class="n">pass_td</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">11.3</span><span class="p">,</span> <span class="n">pass_int</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="o">-</span><span class="mf">14.1</span><span class="p">,</span> <span class="n">pass_sacked</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="o">-</span><span class="mf">8.0</span><span class="p">,</span> <span class="n">rush_att</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.1</span><span class="p">,</span>
</span><span id="Boxscore.add_qb_value-812"><a href="#Boxscore.add_qb_value-812"><span class="linenos">812</span></a>    <span class="n">rush_yds</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.6</span><span class="p">,</span> <span class="n">rush_td</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">15.9</span><span class="p">):</span>
</span><span id="Boxscore.add_qb_value-813"><a href="#Boxscore.add_qb_value-813"><span class="linenos">813</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Boxscore.add_qb_value-814"><a href="#Boxscore.add_qb_value-814"><span class="linenos">814</span></a><span class="sd">        Calculates individual QB elo value based on 538&#39;s model (#RIP).</span>
</span><span id="Boxscore.add_qb_value-815"><a href="#Boxscore.add_qb_value-815"><span class="linenos">815</span></a>
</span><span id="Boxscore.add_qb_value-816"><a href="#Boxscore.add_qb_value-816"><span class="linenos">816</span></a><span class="sd">        Args:</span>
</span><span id="Boxscore.add_qb_value-817"><a href="#Boxscore.add_qb_value-817"><span class="linenos">817</span></a><span class="sd">            pass_att (float, optional): weighting factor for pass attempts, defaults to -2.2.</span>
</span><span id="Boxscore.add_qb_value-818"><a href="#Boxscore.add_qb_value-818"><span class="linenos">818</span></a><span class="sd">            pass_cmp (float, optional): weighting factor for pass completions, defaults to 3.7.</span>
</span><span id="Boxscore.add_qb_value-819"><a href="#Boxscore.add_qb_value-819"><span class="linenos">819</span></a><span class="sd">            pass_yds (float, optional): weighting factor for passing yards, defaults to 0.2.</span>
</span><span id="Boxscore.add_qb_value-820"><a href="#Boxscore.add_qb_value-820"><span class="linenos">820</span></a><span class="sd">            pass_td (float, optional): weighting factor for passing touchdowns, defaults to 11.3.</span>
</span><span id="Boxscore.add_qb_value-821"><a href="#Boxscore.add_qb_value-821"><span class="linenos">821</span></a><span class="sd">            pass_sacked (float, optional): weighting factor for sacks, defaults to -8.0.</span>
</span><span id="Boxscore.add_qb_value-822"><a href="#Boxscore.add_qb_value-822"><span class="linenos">822</span></a><span class="sd">            rush_att (float, optional): weighting factor for rush attempts, defaults to -1.1.</span>
</span><span id="Boxscore.add_qb_value-823"><a href="#Boxscore.add_qb_value-823"><span class="linenos">823</span></a><span class="sd">            rush_yds (float, optional): weighting factor for rush yards, defaults to 0.6.</span>
</span><span id="Boxscore.add_qb_value-824"><a href="#Boxscore.add_qb_value-824"><span class="linenos">824</span></a><span class="sd">            rush_td (float, optional): weighting factor for rushing touchdowns, defaults to 15.9.</span>
</span><span id="Boxscore.add_qb_value-825"><a href="#Boxscore.add_qb_value-825"><span class="linenos">825</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Boxscore.add_qb_value-826"><a href="#Boxscore.add_qb_value-826"><span class="linenos">826</span></a>        <span class="n">qbs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span><span class="o">.</span><span class="n">pos</span> <span class="o">==</span> <span class="s1">&#39;QB&#39;</span>
</span><span id="Boxscore.add_qb_value-827"><a href="#Boxscore.add_qb_value-827"><span class="linenos">827</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">qbs</span><span class="p">,</span><span class="s1">&#39;VALUE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pass_att</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">qbs</span><span class="p">,</span><span class="s1">&#39;pass_att&#39;</span><span class="p">]</span> \
</span><span id="Boxscore.add_qb_value-828"><a href="#Boxscore.add_qb_value-828"><span class="linenos">828</span></a>        <span class="o">+</span> <span class="n">pass_cmp</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">qbs</span><span class="p">,</span><span class="s1">&#39;pass_cmp&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">pass_yds</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">qbs</span><span class="p">,</span><span class="s1">&#39;pass_yds&#39;</span><span class="p">]</span> \
</span><span id="Boxscore.add_qb_value-829"><a href="#Boxscore.add_qb_value-829"><span class="linenos">829</span></a>        <span class="o">+</span> <span class="n">pass_td</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">qbs</span><span class="p">,</span><span class="s1">&#39;pass_td&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">pass_int</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">qbs</span><span class="p">,</span><span class="s1">&#39;pass_int&#39;</span><span class="p">]</span> \
</span><span id="Boxscore.add_qb_value-830"><a href="#Boxscore.add_qb_value-830"><span class="linenos">830</span></a>        <span class="o">+</span> <span class="n">pass_sacked</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">qbs</span><span class="p">,</span><span class="s1">&#39;pass_sacked&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">rush_att</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">qbs</span><span class="p">,</span><span class="s1">&#39;rush_att&#39;</span><span class="p">]</span> \
</span><span id="Boxscore.add_qb_value-831"><a href="#Boxscore.add_qb_value-831"><span class="linenos">831</span></a>        <span class="o">+</span> <span class="n">rush_yds</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">qbs</span><span class="p">,</span><span class="s1">&#39;rush_yds&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">rush_td</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">qbs</span><span class="p">,</span><span class="s1">&#39;rush_td&#39;</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Calculates individual QB elo value based on 538's model (#RIP).</p>

<p>Args:
    pass_att (float, optional): weighting factor for pass attempts, defaults to -2.2.
    pass_cmp (float, optional): weighting factor for pass completions, defaults to 3.7.
    pass_yds (float, optional): weighting factor for passing yards, defaults to 0.2.
    pass_td (float, optional): weighting factor for passing touchdowns, defaults to 11.3.
    pass_sacked (float, optional): weighting factor for sacks, defaults to -8.0.
    rush_att (float, optional): weighting factor for rush attempts, defaults to -1.1.
    rush_yds (float, optional): weighting factor for rush yards, defaults to 0.6.
    rush_td (float, optional): weighting factor for rushing touchdowns, defaults to 15.9.</p>
</div>


                            </div>
                            <div id="Boxscore.normalize_team_names" class="classattr">
                                        <input id="Boxscore.normalize_team_names-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">normalize_team_names</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Boxscore.normalize_team_names-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Boxscore.normalize_team_names"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Boxscore.normalize_team_names-833"><a href="#Boxscore.normalize_team_names-833"><span class="linenos">833</span></a>    <span class="k">def</span> <span class="nf">normalize_team_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Boxscore.normalize_team_names-834"><a href="#Boxscore.normalize_team_names-834"><span class="linenos">834</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Boxscore.normalize_team_names-835"><a href="#Boxscore.normalize_team_names-835"><span class="linenos">835</span></a><span class="sd">        Normalizes team names between Pro Football Reference&#39;s boxscores and schedules.</span>
</span><span id="Boxscore.normalize_team_names-836"><a href="#Boxscore.normalize_team_names-836"><span class="linenos">836</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Boxscore.normalize_team_names-837"><a href="#Boxscore.normalize_team_names-837"><span class="linenos">837</span></a>        <span class="n">abbrevs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;OAK&#39;</span><span class="p">:</span><span class="s1">&#39;RAI&#39;</span><span class="p">,</span><span class="s1">&#39;LVR&#39;</span><span class="p">:</span><span class="s1">&#39;RAI&#39;</span><span class="p">,</span><span class="s1">&#39;LAC&#39;</span><span class="p">:</span><span class="s1">&#39;SDG&#39;</span><span class="p">,</span><span class="s1">&#39;STL&#39;</span><span class="p">:</span><span class="s1">&#39;RAM&#39;</span><span class="p">,</span><span class="s1">&#39;LAR&#39;</span><span class="p">:</span><span class="s1">&#39;RAM&#39;</span><span class="p">,</span>\
</span><span id="Boxscore.normalize_team_names-838"><a href="#Boxscore.normalize_team_names-838"><span class="linenos">838</span></a>        <span class="s1">&#39;ARI&#39;</span><span class="p">:</span><span class="s1">&#39;CRD&#39;</span><span class="p">,</span><span class="s1">&#39;IND&#39;</span><span class="p">:</span><span class="s1">&#39;CLT&#39;</span><span class="p">,</span><span class="s1">&#39;BAL&#39;</span><span class="p">:</span><span class="s1">&#39;RAV&#39;</span><span class="p">,</span><span class="s1">&#39;HOU&#39;</span><span class="p">:</span><span class="s1">&#39;HTX&#39;</span><span class="p">,</span><span class="s1">&#39;TEN&#39;</span><span class="p">:</span><span class="s1">&#39;OTI&#39;</span><span class="p">}</span>
</span><span id="Boxscore.normalize_team_names-839"><a href="#Boxscore.normalize_team_names-839"><span class="linenos">839</span></a>        <span class="k">for</span> <span class="n">team</span> <span class="ow">in</span> <span class="n">abbrevs</span><span class="p">:</span>
</span><span id="Boxscore.normalize_team_names-840"><a href="#Boxscore.normalize_team_names-840"><span class="linenos">840</span></a>            <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;team&#39;</span><span class="p">,</span><span class="s1">&#39;opponent&#39;</span><span class="p">]:</span>
</span><span id="Boxscore.normalize_team_names-841"><a href="#Boxscore.normalize_team_names-841"><span class="linenos">841</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">game_stats</span><span class="p">[</span><span class="n">val</span><span class="p">]</span> <span class="o">==</span> <span class="n">team</span><span class="p">,</span><span class="n">val</span><span class="p">]</span> <span class="o">=</span> <span class="n">abbrevs</span><span class="p">[</span><span class="n">team</span><span class="p">]</span>
</span><span id="Boxscore.normalize_team_names-842"><a href="#Boxscore.normalize_team_names-842"><span class="linenos">842</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">team1_abbrev</span> <span class="ow">in</span> <span class="n">abbrevs</span><span class="p">:</span>
</span><span id="Boxscore.normalize_team_names-843"><a href="#Boxscore.normalize_team_names-843"><span class="linenos">843</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">team1_abbrev</span> <span class="o">=</span> <span class="n">abbrevs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">team1_abbrev</span><span class="p">]</span>
</span><span id="Boxscore.normalize_team_names-844"><a href="#Boxscore.normalize_team_names-844"><span class="linenos">844</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">team2_abbrev</span> <span class="ow">in</span> <span class="n">abbrevs</span><span class="p">:</span>
</span><span id="Boxscore.normalize_team_names-845"><a href="#Boxscore.normalize_team_names-845"><span class="linenos">845</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">team2_abbrev</span> <span class="o">=</span> <span class="n">abbrevs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">team2_abbrev</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Normalizes team names between Pro Football Reference's boxscores and schedules.</p>
</div>


                            </div>
                </section>
                <section id="get_bulk_stats">
                            <input id="get_bulk_stats-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_bulk_stats</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">start_season</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">start_week</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">finish_season</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">finish_week</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">playoffs</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="get_bulk_stats-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#get_bulk_stats"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="get_bulk_stats-848"><a href="#get_bulk_stats-848"><span class="linenos">848</span></a><span class="k">def</span> <span class="nf">get_bulk_stats</span><span class="p">(</span>
</span><span id="get_bulk_stats-849"><a href="#get_bulk_stats-849"><span class="linenos">849</span></a>    <span class="n">start_season</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="get_bulk_stats-850"><a href="#get_bulk_stats-850"><span class="linenos">850</span></a>    <span class="n">start_week</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="get_bulk_stats-851"><a href="#get_bulk_stats-851"><span class="linenos">851</span></a>    <span class="n">finish_season</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="get_bulk_stats-852"><a href="#get_bulk_stats-852"><span class="linenos">852</span></a>    <span class="n">finish_week</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="get_bulk_stats-853"><a href="#get_bulk_stats-853"><span class="linenos">853</span></a>    <span class="n">playoffs</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="get_bulk_stats-854"><a href="#get_bulk_stats-854"><span class="linenos">854</span></a>    <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="get_bulk_stats-855"><a href="#get_bulk_stats-855"><span class="linenos">855</span></a><span class="p">):</span>
</span><span id="get_bulk_stats-856"><a href="#get_bulk_stats-856"><span class="linenos">856</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="get_bulk_stats-857"><a href="#get_bulk_stats-857"><span class="linenos">857</span></a><span class="sd">    Pulls individual player statistics for each game in the specified timeframe from Pro Football Reference.</span>
</span><span id="get_bulk_stats-858"><a href="#get_bulk_stats-858"><span class="linenos">858</span></a>
</span><span id="get_bulk_stats-859"><a href="#get_bulk_stats-859"><span class="linenos">859</span></a><span class="sd">    Args:</span>
</span><span id="get_bulk_stats-860"><a href="#get_bulk_stats-860"><span class="linenos">860</span></a><span class="sd">        start_season (int): first season of interest.</span>
</span><span id="get_bulk_stats-861"><a href="#get_bulk_stats-861"><span class="linenos">861</span></a><span class="sd">        start_week (int): first week of interest.</span>
</span><span id="get_bulk_stats-862"><a href="#get_bulk_stats-862"><span class="linenos">862</span></a><span class="sd">        finish_season (int): last season of interest.</span>
</span><span id="get_bulk_stats-863"><a href="#get_bulk_stats-863"><span class="linenos">863</span></a><span class="sd">        finish_week (int): last week of interest.</span>
</span><span id="get_bulk_stats-864"><a href="#get_bulk_stats-864"><span class="linenos">864</span></a><span class="sd">        playoffs (bool, optional): whether to include playoff games, defaults to True.</span>
</span><span id="get_bulk_stats-865"><a href="#get_bulk_stats-865"><span class="linenos">865</span></a><span class="sd">        path(str, optional): file path where stats are/should be saved to, defaults to None.</span>
</span><span id="get_bulk_stats-866"><a href="#get_bulk_stats-866"><span class="linenos">866</span></a>
</span><span id="get_bulk_stats-867"><a href="#get_bulk_stats-867"><span class="linenos">867</span></a><span class="sd">    Returns:</span>
</span><span id="get_bulk_stats-868"><a href="#get_bulk_stats-868"><span class="linenos">868</span></a><span class="sd">        pd.DataFrame: dataframe containing player statistics for games during the timespan of interest.</span>
</span><span id="get_bulk_stats-869"><a href="#get_bulk_stats-869"><span class="linenos">869</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="get_bulk_stats-870"><a href="#get_bulk_stats-870"><span class="linenos">870</span></a>    <span class="n">s</span> <span class="o">=</span> <span class="n">Schedule</span><span class="p">(</span><span class="n">start_season</span><span class="p">,</span> <span class="n">finish_season</span><span class="p">,</span> <span class="n">playoffs</span><span class="p">)</span>
</span><span id="get_bulk_stats-871"><a href="#get_bulk_stats-871"><span class="linenos">871</span></a>    <span class="n">s</span><span class="o">.</span><span class="n">schedule</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="get_bulk_stats-872"><a href="#get_bulk_stats-872"><span class="linenos">872</span></a>        <span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">season</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="n">s</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">week</span> <span class="o">&gt;=</span> <span class="n">start_season</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="n">start_week</span><span class="p">)</span>
</span><span id="get_bulk_stats-873"><a href="#get_bulk_stats-873"><span class="linenos">873</span></a>        <span class="o">&amp;</span> <span class="p">(</span>
</span><span id="get_bulk_stats-874"><a href="#get_bulk_stats-874"><span class="linenos">874</span></a>            <span class="n">s</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">season</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="n">s</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">week</span>
</span><span id="get_bulk_stats-875"><a href="#get_bulk_stats-875"><span class="linenos">875</span></a>            <span class="o">&lt;=</span> <span class="n">finish_season</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="n">finish_week</span>
</span><span id="get_bulk_stats-876"><a href="#get_bulk_stats-876"><span class="linenos">876</span></a>        <span class="p">)</span>
</span><span id="get_bulk_stats-877"><a href="#get_bulk_stats-877"><span class="linenos">877</span></a>        <span class="o">&amp;</span> <span class="o">~</span><span class="n">s</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">score1</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span>
</span><span id="get_bulk_stats-878"><a href="#get_bulk_stats-878"><span class="linenos">878</span></a>        <span class="o">&amp;</span> <span class="o">~</span><span class="n">s</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">score2</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span>
</span><span id="get_bulk_stats-879"><a href="#get_bulk_stats-879"><span class="linenos">879</span></a>    <span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="get_bulk_stats-880"><a href="#get_bulk_stats-880"><span class="linenos">880</span></a>    <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">path</span><span class="p">)):</span>
</span><span id="get_bulk_stats-881"><a href="#get_bulk_stats-881"><span class="linenos">881</span></a>        <span class="n">stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="get_bulk_stats-882"><a href="#get_bulk_stats-882"><span class="linenos">882</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="get_bulk_stats-883"><a href="#get_bulk_stats-883"><span class="linenos">883</span></a>        <span class="n">stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">,</span> <span class="s2">&quot;week&quot;</span><span class="p">,</span> <span class="s2">&quot;game_id&quot;</span><span class="p">])</span>
</span><span id="get_bulk_stats-884"><a href="#get_bulk_stats-884"><span class="linenos">884</span></a>    <span class="n">to_save</span> <span class="o">=</span> <span class="n">path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span><span class="o">~</span><span class="n">s</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">boxscore_abbrev</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">game_id</span><span class="o">.</span><span class="n">unique</span><span class="p">()))</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
</span><span id="get_bulk_stats-885"><a href="#get_bulk_stats-885"><span class="linenos">885</span></a>    <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="get_bulk_stats-886"><a href="#get_bulk_stats-886"><span class="linenos">886</span></a>        <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">ind</span><span class="p">][</span><span class="s2">&quot;boxscore_abbrev&quot;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stats</span><span class="o">.</span><span class="n">game_id</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
</span><span id="get_bulk_stats-887"><a href="#get_bulk_stats-887"><span class="linenos">887</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">ind</span><span class="p">][</span><span class="s2">&quot;boxscore_abbrev&quot;</span><span class="p">])</span>
</span><span id="get_bulk_stats-888"><a href="#get_bulk_stats-888"><span class="linenos">888</span></a>            <span class="n">b</span> <span class="o">=</span> <span class="n">Boxscore</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">ind</span><span class="p">][</span><span class="s2">&quot;boxscore_abbrev&quot;</span><span class="p">])</span>
</span><span id="get_bulk_stats-889"><a href="#get_bulk_stats-889"><span class="linenos">889</span></a>            <span class="n">stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">stats</span><span class="p">,</span> <span class="n">b</span><span class="o">.</span><span class="n">game_stats</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="get_bulk_stats-890"><a href="#get_bulk_stats-890"><span class="linenos">890</span></a>            <span class="n">stats</span><span class="o">.</span><span class="n">season</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">season</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">season</span><span class="p">)</span>
</span><span id="get_bulk_stats-891"><a href="#get_bulk_stats-891"><span class="linenos">891</span></a>            <span class="n">stats</span><span class="o">.</span><span class="n">week</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">week</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">week</span><span class="p">)</span>
</span><span id="get_bulk_stats-892"><a href="#get_bulk_stats-892"><span class="linenos">892</span></a>            <span class="n">stats</span><span class="o">.</span><span class="n">game_id</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">game_id</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">game_id</span><span class="p">)</span>
</span><span id="get_bulk_stats-893"><a href="#get_bulk_stats-893"><span class="linenos">893</span></a>            <span class="k">if</span> <span class="n">to_save</span> <span class="ow">and</span> <span class="n">b</span><span class="o">.</span><span class="n">season</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">season</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
</span><span id="get_bulk_stats-894"><a href="#get_bulk_stats-894"><span class="linenos">894</span></a>                <span class="n">stats</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="get_bulk_stats-895"><a href="#get_bulk_stats-895"><span class="linenos">895</span></a>    <span class="k">if</span> <span class="n">to_save</span><span class="p">:</span>
</span><span id="get_bulk_stats-896"><a href="#get_bulk_stats-896"><span class="linenos">896</span></a>        <span class="n">stats</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="get_bulk_stats-897"><a href="#get_bulk_stats-897"><span class="linenos">897</span></a>    <span class="n">stats</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">stats</span><span class="o">.</span><span class="n">game_id</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">boxscore_abbrev</span><span class="o">.</span><span class="n">tolist</span><span class="p">())]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="get_bulk_stats-898"><a href="#get_bulk_stats-898"><span class="linenos">898</span></a>    <span class="k">return</span> <span class="n">stats</span>
</span></pre></div>


            <div class="docstring"><p>Pulls individual player statistics for each game in the specified timeframe from Pro Football Reference.</p>

<p>Args:
    start_season (int): first season of interest.
    start_week (int): first week of interest.
    finish_season (int): last season of interest.
    finish_week (int): last week of interest.
    playoffs (bool, optional): whether to include playoff games, defaults to True.
    path(str, optional): file path where stats are/should be saved to, defaults to None.</p>

<p>Returns:
    pd.DataFrame: dataframe containing player statistics for games during the timespan of interest.</p>
</div>


                </section>
                <section id="get_draft">
                            <input id="get_draft-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_draft</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">season</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="get_draft-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#get_draft"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="get_draft-901"><a href="#get_draft-901"><span class="linenos">901</span></a><span class="k">def</span> <span class="nf">get_draft</span><span class="p">(</span><span class="n">season</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="get_draft-902"><a href="#get_draft-902"><span class="linenos">902</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="get_draft-903"><a href="#get_draft-903"><span class="linenos">903</span></a><span class="sd">    Pulls NFL draft results for the specified season from Pro Football Reference.</span>
</span><span id="get_draft-904"><a href="#get_draft-904"><span class="linenos">904</span></a>
</span><span id="get_draft-905"><a href="#get_draft-905"><span class="linenos">905</span></a><span class="sd">    Args:</span>
</span><span id="get_draft-906"><a href="#get_draft-906"><span class="linenos">906</span></a><span class="sd">        season (int): season of interest.</span>
</span><span id="get_draft-907"><a href="#get_draft-907"><span class="linenos">907</span></a>
</span><span id="get_draft-908"><a href="#get_draft-908"><span class="linenos">908</span></a><span class="sd">    Returns:</span>
</span><span id="get_draft-909"><a href="#get_draft-909"><span class="linenos">909</span></a><span class="sd">        pd.DataFrame: dataframe containing draft results for the season of interest.</span>
</span><span id="get_draft-910"><a href="#get_draft-910"><span class="linenos">910</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="get_draft-911"><a href="#get_draft-911"><span class="linenos">911</span></a>    <span class="n">raw_text</span> <span class="o">=</span> <span class="n">get_page</span><span class="p">(</span><span class="s2">&quot;years/</span><span class="si">{}</span><span class="s2">/draft.htm&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">season</span><span class="p">))</span>
</span><span id="get_draft-912"><a href="#get_draft-912"><span class="linenos">912</span></a>    <span class="n">draft_order</span> <span class="o">=</span> <span class="n">parse_table</span><span class="p">(</span><span class="n">raw_text</span><span class="p">,</span> <span class="s2">&quot;drafts&quot;</span><span class="p">)</span>
</span><span id="get_draft-913"><a href="#get_draft-913"><span class="linenos">913</span></a>    <span class="k">return</span> <span class="n">draft_order</span>
</span></pre></div>


            <div class="docstring"><p>Pulls NFL draft results for the specified season from Pro Football Reference.</p>

<p>Args:
    season (int): season of interest.</p>

<p>Returns:
    pd.DataFrame: dataframe containing draft results for the season of interest.</p>
</div>


                </section>
                <section id="get_bulk_draft_pos">
                            <input id="get_bulk_draft_pos-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_bulk_draft_pos</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">start_season</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">finish_season</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">best_qb_val</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">34.313</span>,</span><span class="param">	<span class="n">qb_val_per_pick</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.137</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="get_bulk_draft_pos-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#get_bulk_draft_pos"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="get_bulk_draft_pos-916"><a href="#get_bulk_draft_pos-916"><span class="linenos">916</span></a><span class="k">def</span> <span class="nf">get_bulk_draft_pos</span><span class="p">(</span><span class="n">start_season</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">finish_season</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> \
</span><span id="get_bulk_draft_pos-917"><a href="#get_bulk_draft_pos-917"><span class="linenos">917</span></a><span class="n">best_qb_val</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">34.313</span><span class="p">,</span> <span class="n">qb_val_per_pick</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.137</span><span class="p">):</span>
</span><span id="get_bulk_draft_pos-918"><a href="#get_bulk_draft_pos-918"><span class="linenos">918</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="get_bulk_draft_pos-919"><a href="#get_bulk_draft_pos-919"><span class="linenos">919</span></a><span class="sd">    Pulls draft results for each season in the specified timeframe from Pro Football Reference</span>
</span><span id="get_bulk_draft_pos-920"><a href="#get_bulk_draft_pos-920"><span class="linenos">920</span></a><span class="sd">    and infers initial QB elo values from draft positions.</span>
</span><span id="get_bulk_draft_pos-921"><a href="#get_bulk_draft_pos-921"><span class="linenos">921</span></a>
</span><span id="get_bulk_draft_pos-922"><a href="#get_bulk_draft_pos-922"><span class="linenos">922</span></a><span class="sd">    Args:</span>
</span><span id="get_bulk_draft_pos-923"><a href="#get_bulk_draft_pos-923"><span class="linenos">923</span></a><span class="sd">        start_season (int): first season of interest.</span>
</span><span id="get_bulk_draft_pos-924"><a href="#get_bulk_draft_pos-924"><span class="linenos">924</span></a><span class="sd">        finish_season (int): last season of interest.</span>
</span><span id="get_bulk_draft_pos-925"><a href="#get_bulk_draft_pos-925"><span class="linenos">925</span></a><span class="sd">        path (str, optional): where to save the draft results in csv form, defaults to None.</span>
</span><span id="get_bulk_draft_pos-926"><a href="#get_bulk_draft_pos-926"><span class="linenos">926</span></a><span class="sd">        best_qb_val (float, optional): QB elo value assigned to a first overall pick, defaults to 34.313.</span>
</span><span id="get_bulk_draft_pos-927"><a href="#get_bulk_draft_pos-927"><span class="linenos">927</span></a><span class="sd">        qb_val_per_pick (float, optional): elo point decline per pick, defaults to -0.137.</span>
</span><span id="get_bulk_draft_pos-928"><a href="#get_bulk_draft_pos-928"><span class="linenos">928</span></a>
</span><span id="get_bulk_draft_pos-929"><a href="#get_bulk_draft_pos-929"><span class="linenos">929</span></a><span class="sd">    Returns:</span>
</span><span id="get_bulk_draft_pos-930"><a href="#get_bulk_draft_pos-930"><span class="linenos">930</span></a><span class="sd">        pd.DataFrame: dataframe containing all draft results over the timeframe of interest.</span>
</span><span id="get_bulk_draft_pos-931"><a href="#get_bulk_draft_pos-931"><span class="linenos">931</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="get_bulk_draft_pos-932"><a href="#get_bulk_draft_pos-932"><span class="linenos">932</span></a>    <span class="n">start_season</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">start_season</span><span class="p">)</span>
</span><span id="get_bulk_draft_pos-933"><a href="#get_bulk_draft_pos-933"><span class="linenos">933</span></a>    <span class="n">finish_season</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">finish_season</span><span class="p">)</span>
</span><span id="get_bulk_draft_pos-934"><a href="#get_bulk_draft_pos-934"><span class="linenos">934</span></a>    <span class="k">if</span> <span class="n">path</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">path</span><span class="p">)):</span>
</span><span id="get_bulk_draft_pos-935"><a href="#get_bulk_draft_pos-935"><span class="linenos">935</span></a>        <span class="n">draft_pos</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="get_bulk_draft_pos-936"><a href="#get_bulk_draft_pos-936"><span class="linenos">936</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="get_bulk_draft_pos-937"><a href="#get_bulk_draft_pos-937"><span class="linenos">937</span></a>        <span class="n">draft_pos</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">])</span>
</span><span id="get_bulk_draft_pos-938"><a href="#get_bulk_draft_pos-938"><span class="linenos">938</span></a>    <span class="n">new_drafts</span> <span class="o">=</span> <span class="nb">any</span><span class="p">([</span><span class="n">year</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">draft_pos</span><span class="o">.</span><span class="n">year</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span> <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_season</span><span class="p">,</span><span class="n">finish_season</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)])</span>
</span><span id="get_bulk_draft_pos-939"><a href="#get_bulk_draft_pos-939"><span class="linenos">939</span></a>    <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_season</span><span class="p">,</span><span class="n">finish_season</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="get_bulk_draft_pos-940"><a href="#get_bulk_draft_pos-940"><span class="linenos">940</span></a>        <span class="k">if</span> <span class="n">year</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">draft_pos</span><span class="o">.</span><span class="n">year</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
</span><span id="get_bulk_draft_pos-941"><a href="#get_bulk_draft_pos-941"><span class="linenos">941</span></a>            <span class="n">draft_pos</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">draft_pos</span><span class="p">,</span><span class="n">get_draft</span><span class="p">(</span><span class="n">year</span><span class="p">)],</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="get_bulk_draft_pos-942"><a href="#get_bulk_draft_pos-942"><span class="linenos">942</span></a>            <span class="n">draft_pos</span><span class="o">.</span><span class="n">year</span> <span class="o">=</span> <span class="n">draft_pos</span><span class="o">.</span><span class="n">year</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>
</span><span id="get_bulk_draft_pos-943"><a href="#get_bulk_draft_pos-943"><span class="linenos">943</span></a>    <span class="k">if</span> <span class="n">path</span> <span class="ow">and</span> <span class="n">new_drafts</span><span class="p">:</span>
</span><span id="get_bulk_draft_pos-944"><a href="#get_bulk_draft_pos-944"><span class="linenos">944</span></a>        <span class="n">draft_pos</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="get_bulk_draft_pos-945"><a href="#get_bulk_draft_pos-945"><span class="linenos">945</span></a>    <span class="n">draft_pos</span> <span class="o">=</span> <span class="n">draft_pos</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">draft_pos</span><span class="o">.</span><span class="n">year</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">start_season</span><span class="p">,</span><span class="n">finish_season</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)))]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="get_bulk_draft_pos-946"><a href="#get_bulk_draft_pos-946"><span class="linenos">946</span></a>    <span class="n">qbs</span> <span class="o">=</span> <span class="n">draft_pos</span><span class="o">.</span><span class="n">pos</span> <span class="o">==</span> <span class="s1">&#39;QB&#39;</span>
</span><span id="get_bulk_draft_pos-947"><a href="#get_bulk_draft_pos-947"><span class="linenos">947</span></a>    <span class="n">draft_pos</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">qbs</span><span class="p">,</span><span class="s1">&#39;qb_value_init&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">draft_pos</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">qbs</span><span class="p">,</span><span class="s1">&#39;draft_pick&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">qb_val_per_pick</span> <span class="o">+</span> <span class="n">best_qb_val</span>
</span><span id="get_bulk_draft_pos-948"><a href="#get_bulk_draft_pos-948"><span class="linenos">948</span></a>    <span class="k">return</span> <span class="n">draft_pos</span>
</span></pre></div>


            <div class="docstring"><p>Pulls draft results for each season in the specified timeframe from Pro Football Reference
and infers initial QB elo values from draft positions.</p>

<p>Args:
    start_season (int): first season of interest.
    finish_season (int): last season of interest.
    path (str, optional): where to save the draft results in csv form, defaults to None.
    best_qb_val (float, optional): QB elo value assigned to a first overall pick, defaults to 34.313.
    qb_val_per_pick (float, optional): elo point decline per pick, defaults to -0.137.</p>

<p>Returns:
    pd.DataFrame: dataframe containing all draft results over the timeframe of interest.</p>
</div>


                </section>
                <section id="get_roster">
                            <input id="get_roster-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_roster</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">team</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">season</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="get_roster-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#get_roster"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="get_roster-951"><a href="#get_roster-951"><span class="linenos">951</span></a><span class="k">def</span> <span class="nf">get_roster</span><span class="p">(</span><span class="n">team</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">season</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="get_roster-952"><a href="#get_roster-952"><span class="linenos">952</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="get_roster-953"><a href="#get_roster-953"><span class="linenos">953</span></a><span class="sd">    Pulls the full team roster for the team and season of interest from Pro Football Reference.</span>
</span><span id="get_roster-954"><a href="#get_roster-954"><span class="linenos">954</span></a>
</span><span id="get_roster-955"><a href="#get_roster-955"><span class="linenos">955</span></a><span class="sd">    Args:</span>
</span><span id="get_roster-956"><a href="#get_roster-956"><span class="linenos">956</span></a><span class="sd">        team (str): abbreviation for the team of interest.</span>
</span><span id="get_roster-957"><a href="#get_roster-957"><span class="linenos">957</span></a><span class="sd">        season (int): season of interest.</span>
</span><span id="get_roster-958"><a href="#get_roster-958"><span class="linenos">958</span></a>
</span><span id="get_roster-959"><a href="#get_roster-959"><span class="linenos">959</span></a><span class="sd">    Returns:</span>
</span><span id="get_roster-960"><a href="#get_roster-960"><span class="linenos">960</span></a><span class="sd">        pd.DataFrame: dataframe containing identifying information for each player on the roster of interest.</span>
</span><span id="get_roster-961"><a href="#get_roster-961"><span class="linenos">961</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="get_roster-962"><a href="#get_roster-962"><span class="linenos">962</span></a>    <span class="n">raw_text</span> <span class="o">=</span> <span class="n">get_page</span><span class="p">(</span><span class="s2">&quot;teams/</span><span class="si">{}</span><span class="s2">/</span><span class="si">{}</span><span class="s2">_roster.htm&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">team</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span><span class="n">season</span><span class="p">))</span>
</span><span id="get_roster-963"><a href="#get_roster-963"><span class="linenos">963</span></a>    <span class="n">roster</span> <span class="o">=</span> <span class="n">parse_table</span><span class="p">(</span><span class="n">raw_text</span><span class="p">,</span> <span class="s2">&quot;roster&quot;</span><span class="p">)</span>
</span><span id="get_roster-964"><a href="#get_roster-964"><span class="linenos">964</span></a>    <span class="k">return</span> <span class="n">roster</span>
</span></pre></div>


            <div class="docstring"><p>Pulls the full team roster for the team and season of interest from Pro Football Reference.</p>

<p>Args:
    team (str): abbreviation for the team of interest.
    season (int): season of interest.</p>

<p>Returns:
    pd.DataFrame: dataframe containing identifying information for each player on the roster of interest.</p>
</div>


                </section>
                <section id="get_bulk_rosters">
                            <input id="get_bulk_rosters-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_bulk_rosters</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">start_season</span><span class="p">:</span> <span class="nb">int</span>, </span><span class="param"><span class="n">finish_season</span><span class="p">:</span> <span class="nb">int</span>, </span><span class="param"><span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="get_bulk_rosters-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#get_bulk_rosters"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="get_bulk_rosters-967"><a href="#get_bulk_rosters-967"><span class="linenos">967</span></a><span class="k">def</span> <span class="nf">get_bulk_rosters</span><span class="p">(</span><span class="n">start_season</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">finish_season</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="get_bulk_rosters-968"><a href="#get_bulk_rosters-968"><span class="linenos">968</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="get_bulk_rosters-969"><a href="#get_bulk_rosters-969"><span class="linenos">969</span></a><span class="sd">    Pulls all NFL rosters during the specified timeframe from Pro Football Reference.</span>
</span><span id="get_bulk_rosters-970"><a href="#get_bulk_rosters-970"><span class="linenos">970</span></a>
</span><span id="get_bulk_rosters-971"><a href="#get_bulk_rosters-971"><span class="linenos">971</span></a><span class="sd">    Args:</span>
</span><span id="get_bulk_rosters-972"><a href="#get_bulk_rosters-972"><span class="linenos">972</span></a><span class="sd">        start_season (int): first season of interest.</span>
</span><span id="get_bulk_rosters-973"><a href="#get_bulk_rosters-973"><span class="linenos">973</span></a><span class="sd">        finish_season (int): last season of interest.</span>
</span><span id="get_bulk_rosters-974"><a href="#get_bulk_rosters-974"><span class="linenos">974</span></a><span class="sd">        path (str, optional): where to save the rosters in csv form, defaults to None.</span>
</span><span id="get_bulk_rosters-975"><a href="#get_bulk_rosters-975"><span class="linenos">975</span></a>
</span><span id="get_bulk_rosters-976"><a href="#get_bulk_rosters-976"><span class="linenos">976</span></a><span class="sd">    Returns:</span>
</span><span id="get_bulk_rosters-977"><a href="#get_bulk_rosters-977"><span class="linenos">977</span></a><span class="sd">        pd.DataFrame: dataframe containing all rosters for the specified timeframe.</span>
</span><span id="get_bulk_rosters-978"><a href="#get_bulk_rosters-978"><span class="linenos">978</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="get_bulk_rosters-979"><a href="#get_bulk_rosters-979"><span class="linenos">979</span></a>    <span class="n">s</span> <span class="o">=</span> <span class="n">Schedule</span><span class="p">(</span><span class="n">start_season</span><span class="p">,</span><span class="n">finish_season</span><span class="p">)</span>
</span><span id="get_bulk_rosters-980"><a href="#get_bulk_rosters-980"><span class="linenos">980</span></a>    <span class="c1"># Need to delete and repull after every new week to account for trades, etc.</span>
</span><span id="get_bulk_rosters-981"><a href="#get_bulk_rosters-981"><span class="linenos">981</span></a>    <span class="k">if</span> <span class="n">path</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">path</span><span class="p">)):</span>
</span><span id="get_bulk_rosters-982"><a href="#get_bulk_rosters-982"><span class="linenos">982</span></a>        <span class="n">teams</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="get_bulk_rosters-983"><a href="#get_bulk_rosters-983"><span class="linenos">983</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="get_bulk_rosters-984"><a href="#get_bulk_rosters-984"><span class="linenos">984</span></a>        <span class="n">teams</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">])</span>
</span><span id="get_bulk_rosters-985"><a href="#get_bulk_rosters-985"><span class="linenos">985</span></a>    <span class="n">new_games</span> <span class="o">=</span> <span class="nb">any</span><span class="p">([</span><span class="n">season</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">teams</span><span class="o">.</span><span class="n">season</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span> <span class="k">for</span> <span class="n">season</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_season</span><span class="p">,</span><span class="n">finish_season</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)])</span>
</span><span id="get_bulk_rosters-986"><a href="#get_bulk_rosters-986"><span class="linenos">986</span></a>    <span class="k">for</span> <span class="n">season</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_season</span><span class="p">,</span><span class="n">finish_season</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="get_bulk_rosters-987"><a href="#get_bulk_rosters-987"><span class="linenos">987</span></a>        <span class="k">if</span> <span class="n">season</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">teams</span><span class="o">.</span><span class="n">season</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
</span><span id="get_bulk_rosters-988"><a href="#get_bulk_rosters-988"><span class="linenos">988</span></a>            <span class="k">for</span> <span class="n">team</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">season</span> <span class="o">==</span> <span class="n">season</span><span class="p">,</span><span class="s1">&#39;team1_abbrev&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
</span><span id="get_bulk_rosters-989"><a href="#get_bulk_rosters-989"><span class="linenos">989</span></a>                <span class="n">roster</span> <span class="o">=</span> <span class="n">get_roster</span><span class="p">(</span><span class="n">team</span><span class="p">,</span><span class="n">season</span><span class="p">)</span>
</span><span id="get_bulk_rosters-990"><a href="#get_bulk_rosters-990"><span class="linenos">990</span></a>                <span class="n">roster</span><span class="p">[</span><span class="s1">&#39;team&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">team</span>
</span><span id="get_bulk_rosters-991"><a href="#get_bulk_rosters-991"><span class="linenos">991</span></a>                <span class="n">roster</span><span class="p">[</span><span class="s1">&#39;season&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">season</span>
</span><span id="get_bulk_rosters-992"><a href="#get_bulk_rosters-992"><span class="linenos">992</span></a>                <span class="n">teams</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">teams</span><span class="p">,</span><span class="n">roster</span><span class="p">],</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="get_bulk_rosters-993"><a href="#get_bulk_rosters-993"><span class="linenos">993</span></a>    <span class="k">if</span> <span class="n">path</span> <span class="ow">and</span> <span class="p">(</span><span class="n">new_games</span> <span class="ow">or</span> <span class="n">finish_season</span> <span class="o">==</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">year</span><span class="p">):</span>
</span><span id="get_bulk_rosters-994"><a href="#get_bulk_rosters-994"><span class="linenos">994</span></a>        <span class="n">teams</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="get_bulk_rosters-995"><a href="#get_bulk_rosters-995"><span class="linenos">995</span></a>    <span class="n">teams</span><span class="o">.</span><span class="n">player</span> <span class="o">=</span> <span class="n">teams</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; (&#39;</span><span class="p">,</span><span class="n">regex</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="get_bulk_rosters-996"><a href="#get_bulk_rosters-996"><span class="linenos">996</span></a>    <span class="k">return</span> <span class="n">teams</span>
</span></pre></div>


            <div class="docstring"><p>Pulls all NFL rosters during the specified timeframe from Pro Football Reference.</p>

<p>Args:
    start_season (int): first season of interest.
    finish_season (int): last season of interest.
    path (str, optional): where to save the rosters in csv form, defaults to None.</p>

<p>Returns:
    pd.DataFrame: dataframe containing all rosters for the specified timeframe.</p>
</div>


                </section>
                <section id="get_qb_elos">
                            <input id="get_qb_elos-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_qb_elos</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">start</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">finish</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">regress_pct</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.25</span>,</span><span class="param">	<span class="n">qb_games</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span>,</span><span class="param">	<span class="n">team_games</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span>,</span><span class="param">	<span class="n">elo_adj</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">3.3</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="get_qb_elos-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#get_qb_elos"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="get_qb_elos-999"><a href="#get_qb_elos-999"><span class="linenos"> 999</span></a><span class="k">def</span> <span class="nf">get_qb_elos</span><span class="p">(</span><span class="n">start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">finish</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">regress_pct</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">,</span> 
</span><span id="get_qb_elos-1000"><a href="#get_qb_elos-1000"><span class="linenos">1000</span></a><span class="n">qb_games</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">team_games</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span> <span class="n">elo_adj</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">3.3</span><span class="p">):</span>
</span><span id="get_qb_elos-1001"><a href="#get_qb_elos-1001"><span class="linenos">1001</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="get_qb_elos-1002"><a href="#get_qb_elos-1002"><span class="linenos">1002</span></a><span class="sd">    Pulls QB-related statistics and calculates QB elo ratings as they progress over time.</span>
</span><span id="get_qb_elos-1003"><a href="#get_qb_elos-1003"><span class="linenos">1003</span></a>
</span><span id="get_qb_elos-1004"><a href="#get_qb_elos-1004"><span class="linenos">1004</span></a><span class="sd">    Args:</span>
</span><span id="get_qb_elos-1005"><a href="#get_qb_elos-1005"><span class="linenos">1005</span></a><span class="sd">        start (int): first season of interest.</span>
</span><span id="get_qb_elos-1006"><a href="#get_qb_elos-1006"><span class="linenos">1006</span></a><span class="sd">        finish (int): last season of interest.</span>
</span><span id="get_qb_elos-1007"><a href="#get_qb_elos-1007"><span class="linenos">1007</span></a><span class="sd">        regress_pct (float, optional): percentage to regress QBs back to the mean between each season, defaults to 0.25.</span>
</span><span id="get_qb_elos-1008"><a href="#get_qb_elos-1008"><span class="linenos">1008</span></a><span class="sd">        qb_games (int, optional): number of games to use in the rolling average for individual QB elos, defaults to 10.</span>
</span><span id="get_qb_elos-1009"><a href="#get_qb_elos-1009"><span class="linenos">1009</span></a><span class="sd">        team_games (int, optional): number of games to use in the rolling average for team QB elos, defaults to 20.</span>
</span><span id="get_qb_elos-1010"><a href="#get_qb_elos-1010"><span class="linenos">1010</span></a><span class="sd">        elo_adj (float, optional): conversion factor between QB rating and team elos, defaults to 3.3.</span>
</span><span id="get_qb_elos-1011"><a href="#get_qb_elos-1011"><span class="linenos">1011</span></a>
</span><span id="get_qb_elos-1012"><a href="#get_qb_elos-1012"><span class="linenos">1012</span></a><span class="sd">    Returns:</span>
</span><span id="get_qb_elos-1013"><a href="#get_qb_elos-1013"><span class="linenos">1013</span></a><span class="sd">        pd.DataFrame: dataframe containing QB statistics and elo ratings throughout the timeframe of interest.</span>
</span><span id="get_qb_elos-1014"><a href="#get_qb_elos-1014"><span class="linenos">1014</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="get_qb_elos-1015"><a href="#get_qb_elos-1015"><span class="linenos">1015</span></a>    <span class="n">stats</span> <span class="o">=</span> <span class="n">get_bulk_stats</span><span class="p">(</span><span class="n">start</span> <span class="o">-</span> <span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">finish</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="s2">&quot;GameByGameFantasyFootballStats.csv&quot;</span><span class="p">)</span>
</span><span id="get_qb_elos-1016"><a href="#get_qb_elos-1016"><span class="linenos">1016</span></a>    <span class="k">if</span> <span class="n">finish</span> <span class="o">==</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">year</span> <span class="ow">and</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">month</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
</span><span id="get_qb_elos-1017"><a href="#get_qb_elos-1017"><span class="linenos">1017</span></a>        <span class="c1"># Accounting for current season</span>
</span><span id="get_qb_elos-1018"><a href="#get_qb_elos-1018"><span class="linenos">1018</span></a>        <span class="n">sched</span> <span class="o">=</span> <span class="n">Schedule</span><span class="p">(</span><span class="n">finish</span><span class="p">,</span><span class="n">finish</span><span class="p">)</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="get_qb_elos-1019"><a href="#get_qb_elos-1019"><span class="linenos">1019</span></a>        <span class="n">missing</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">sched</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sched</span><span class="o">.</span><span class="n">score1</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">sched</span><span class="o">.</span><span class="n">score2</span><span class="o">.</span><span class="n">isnull</span><span class="p">(),</span>\
</span><span id="get_qb_elos-1020"><a href="#get_qb_elos-1020"><span class="linenos">1020</span></a>        <span class="p">[</span><span class="s1">&#39;season&#39;</span><span class="p">,</span><span class="s1">&#39;week_num&#39;</span><span class="p">,</span><span class="s1">&#39;boxscore_abbrev&#39;</span><span class="p">,</span><span class="s1">&#39;team1_abbrev&#39;</span><span class="p">,</span><span class="s1">&#39;team2_abbrev&#39;</span><span class="p">]]</span>\
</span><span id="get_qb_elos-1021"><a href="#get_qb_elos-1021"><span class="linenos">1021</span></a>        <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;week_num&#39;</span><span class="p">:</span><span class="s1">&#39;week&#39;</span><span class="p">,</span><span class="s1">&#39;boxscore_abbrev&#39;</span><span class="p">:</span><span class="s1">&#39;game_id&#39;</span><span class="p">,</span><span class="s1">&#39;team1_abbrev&#39;</span><span class="p">:</span><span class="s1">&#39;team&#39;</span><span class="p">,</span><span class="s1">&#39;team2_abbrev&#39;</span><span class="p">:</span><span class="s1">&#39;opponent&#39;</span><span class="p">}),</span>\
</span><span id="get_qb_elos-1022"><a href="#get_qb_elos-1022"><span class="linenos">1022</span></a>        <span class="n">sched</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sched</span><span class="o">.</span><span class="n">score1</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">sched</span><span class="o">.</span><span class="n">score2</span><span class="o">.</span><span class="n">isnull</span><span class="p">(),[</span><span class="s1">&#39;season&#39;</span><span class="p">,</span><span class="s1">&#39;week_num&#39;</span><span class="p">,</span><span class="s1">&#39;boxscore_abbrev&#39;</span><span class="p">,</span><span class="s1">&#39;team2_abbrev&#39;</span><span class="p">,</span><span class="s1">&#39;team1_abbrev&#39;</span><span class="p">]]</span>\
</span><span id="get_qb_elos-1023"><a href="#get_qb_elos-1023"><span class="linenos">1023</span></a>        <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;week_num&#39;</span><span class="p">:</span><span class="s1">&#39;week&#39;</span><span class="p">,</span><span class="s1">&#39;boxscore_abbrev&#39;</span><span class="p">:</span><span class="s1">&#39;game_id&#39;</span><span class="p">,</span><span class="s1">&#39;team2_abbrev&#39;</span><span class="p">:</span><span class="s1">&#39;team&#39;</span><span class="p">,</span><span class="s1">&#39;team1_abbrev&#39;</span><span class="p">:</span><span class="s1">&#39;opponent&#39;</span><span class="p">})],</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="get_qb_elos-1024"><a href="#get_qb_elos-1024"><span class="linenos">1024</span></a>        <span class="n">current</span> <span class="o">=</span> <span class="n">get_all_depth_charts</span><span class="p">()</span>
</span><span id="get_qb_elos-1025"><a href="#get_qb_elos-1025"><span class="linenos">1025</span></a>        <span class="n">current</span> <span class="o">=</span> <span class="n">current</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">current</span><span class="o">.</span><span class="n">pos</span> <span class="o">==</span> <span class="s1">&#39;QB&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">current</span><span class="o">.</span><span class="n">string</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">)]</span>
</span><span id="get_qb_elos-1026"><a href="#get_qb_elos-1026"><span class="linenos">1026</span></a>        <span class="n">missing</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">missing</span><span class="p">,</span><span class="n">right</span><span class="o">=</span><span class="n">current</span><span class="p">,</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="s1">&#39;team&#39;</span><span class="p">)</span>
</span><span id="get_qb_elos-1027"><a href="#get_qb_elos-1027"><span class="linenos">1027</span></a>        <span class="n">stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">stats</span><span class="p">,</span><span class="n">missing</span><span class="p">],</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="get_qb_elos-1028"><a href="#get_qb_elos-1028"><span class="linenos">1028</span></a>    <span class="n">draft_pos</span> <span class="o">=</span> <span class="n">get_bulk_draft_pos</span><span class="p">(</span><span class="n">start</span> <span class="o">-</span> <span class="mi">10</span><span class="p">,</span><span class="n">finish</span><span class="p">,</span><span class="s2">&quot;NFLDraftPositions.csv&quot;</span><span class="p">)</span>
</span><span id="get_qb_elos-1029"><a href="#get_qb_elos-1029"><span class="linenos">1029</span></a>    <span class="n">prev_all</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">stats</span><span class="o">.</span><span class="n">season</span> <span class="o">&lt;</span> <span class="n">stats</span><span class="o">.</span><span class="n">season</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> \
</span><span id="get_qb_elos-1030"><a href="#get_qb_elos-1030"><span class="linenos">1030</span></a>    <span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">pos</span> <span class="o">==</span> <span class="s1">&#39;QB&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">string</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="get_qb_elos-1031"><a href="#get_qb_elos-1031"><span class="linenos">1031</span></a>    <span class="n">by_opponent</span> <span class="o">=</span> <span class="n">prev_all</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;season&#39;</span><span class="p">,</span><span class="s1">&#39;week&#39;</span><span class="p">,</span><span class="s1">&#39;game_id&#39;</span><span class="p">,</span><span class="s1">&#39;opponent&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">VALUE</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="get_qb_elos-1032"><a href="#get_qb_elos-1032"><span class="linenos">1032</span></a>    <span class="n">by_opponent</span> <span class="o">=</span> <span class="n">by_opponent</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;season&#39;</span><span class="p">,</span><span class="s1">&#39;week&#39;</span><span class="p">],</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="get_qb_elos-1033"><a href="#get_qb_elos-1033"><span class="linenos">1033</span></a>    <span class="n">by_opponent</span> <span class="o">=</span> <span class="n">by_opponent</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;opponent&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">team_games</span><span class="p">)</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;opponent&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">VALUE</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="get_qb_elos-1034"><a href="#get_qb_elos-1034"><span class="linenos">1034</span></a>    <span class="n">by_team</span> <span class="o">=</span> <span class="n">prev_all</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;season&#39;</span><span class="p">,</span><span class="s1">&#39;week&#39;</span><span class="p">,</span><span class="s1">&#39;game_id&#39;</span><span class="p">,</span><span class="s1">&#39;team&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">VALUE</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="get_qb_elos-1035"><a href="#get_qb_elos-1035"><span class="linenos">1035</span></a>    <span class="n">by_team</span> <span class="o">=</span> <span class="n">by_team</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;season&#39;</span><span class="p">,</span><span class="s1">&#39;week&#39;</span><span class="p">],</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="get_qb_elos-1036"><a href="#get_qb_elos-1036"><span class="linenos">1036</span></a>    <span class="n">by_team</span> <span class="o">=</span> <span class="n">by_team</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;team&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">team_games</span><span class="p">)</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;team&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">VALUE</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="get_qb_elos-1037"><a href="#get_qb_elos-1037"><span class="linenos">1037</span></a>    <span class="n">new</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">stats</span><span class="o">.</span><span class="n">season</span> <span class="o">&gt;=</span> <span class="n">stats</span><span class="o">.</span><span class="n">season</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> \
</span><span id="get_qb_elos-1038"><a href="#get_qb_elos-1038"><span class="linenos">1038</span></a>    <span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">pos</span> <span class="o">==</span> <span class="s1">&#39;QB&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">string</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="get_qb_elos-1039"><a href="#get_qb_elos-1039"><span class="linenos">1039</span></a>    <span class="n">new</span><span class="p">[</span><span class="s1">&#39;qb_value_pre&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="get_qb_elos-1040"><a href="#get_qb_elos-1040"><span class="linenos">1040</span></a>    <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">new</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="get_qb_elos-1041"><a href="#get_qb_elos-1041"><span class="linenos">1041</span></a>        <span class="n">avg_value</span> <span class="o">=</span> <span class="n">by_opponent</span><span class="o">.</span><span class="n">VALUE</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="get_qb_elos-1042"><a href="#get_qb_elos-1042"><span class="linenos">1042</span></a>        <span class="n">prev_qb</span> <span class="o">=</span> <span class="n">new</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">new</span><span class="o">.</span><span class="n">player</span> <span class="o">==</span> <span class="n">new</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;player&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">new</span><span class="o">.</span><span class="n">index</span> <span class="o">&lt;</span> <span class="n">ind</span><span class="p">)]</span>
</span><span id="get_qb_elos-1043"><a href="#get_qb_elos-1043"><span class="linenos">1043</span></a>        <span class="k">if</span> <span class="n">prev_qb</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="get_qb_elos-1044"><a href="#get_qb_elos-1044"><span class="linenos">1044</span></a>            <span class="n">drafted</span> <span class="o">=</span> <span class="n">draft_pos</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">draft_pos</span><span class="o">.</span><span class="n">player</span> <span class="o">==</span> <span class="n">new</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;player&#39;</span><span class="p">]]</span>
</span><span id="get_qb_elos-1045"><a href="#get_qb_elos-1045"><span class="linenos">1045</span></a>            <span class="k">if</span> <span class="n">drafted</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="get_qb_elos-1046"><a href="#get_qb_elos-1046"><span class="linenos">1046</span></a>                <span class="n">new</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;qb_value_pre&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">drafted</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">qb_value_init</span>
</span><span id="get_qb_elos-1047"><a href="#get_qb_elos-1047"><span class="linenos">1047</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="get_qb_elos-1048"><a href="#get_qb_elos-1048"><span class="linenos">1048</span></a>                <span class="n">new</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;qb_value_pre&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="get_qb_elos-1049"><a href="#get_qb_elos-1049"><span class="linenos">1049</span></a>            <span class="n">new</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;num_games&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="get_qb_elos-1050"><a href="#get_qb_elos-1050"><span class="linenos">1050</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="get_qb_elos-1051"><a href="#get_qb_elos-1051"><span class="linenos">1051</span></a>            <span class="n">new</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;qb_value_pre&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prev_qb</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;qb_value_post&#39;</span><span class="p">]</span>
</span><span id="get_qb_elos-1052"><a href="#get_qb_elos-1052"><span class="linenos">1052</span></a>            <span class="k">if</span> <span class="n">new</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;season&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">prev_qb</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;season&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">prev_qb</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">10</span> <span class="ow">and</span> <span class="n">prev_qb</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">100</span><span class="p">:</span>
</span><span id="get_qb_elos-1053"><a href="#get_qb_elos-1053"><span class="linenos">1053</span></a>                <span class="n">new</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;qb_value_pre&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">regress_pct</span><span class="p">)</span><span class="o">*</span><span class="n">new</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;qb_value_pre&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">regress_pct</span><span class="o">*</span><span class="n">avg_value</span>
</span><span id="get_qb_elos-1054"><a href="#get_qb_elos-1054"><span class="linenos">1054</span></a>            <span class="n">new</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;num_games&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prev_qb</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="get_qb_elos-1055"><a href="#get_qb_elos-1055"><span class="linenos">1055</span></a>        <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">new</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;VALUE&#39;</span><span class="p">]):</span>
</span><span id="get_qb_elos-1056"><a href="#get_qb_elos-1056"><span class="linenos">1056</span></a>            <span class="c1"># Game hasn&#39;t been played yet</span>
</span><span id="get_qb_elos-1057"><a href="#get_qb_elos-1057"><span class="linenos">1057</span></a>            <span class="n">new</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;qb_value_post&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;qb_value_pre&#39;</span><span class="p">]</span>
</span><span id="get_qb_elos-1058"><a href="#get_qb_elos-1058"><span class="linenos">1058</span></a>            <span class="n">new</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;team_qbvalue_avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">by_team</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">by_team</span><span class="o">.</span><span class="n">team</span> <span class="o">==</span> <span class="n">new</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;team&#39;</span><span class="p">],</span><span class="s1">&#39;VALUE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="get_qb_elos-1059"><a href="#get_qb_elos-1059"><span class="linenos">1059</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="get_qb_elos-1060"><a href="#get_qb_elos-1060"><span class="linenos">1060</span></a>            <span class="n">new</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;team_qbvalue_avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">by_team</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">by_team</span><span class="o">.</span><span class="n">team</span> <span class="o">==</span> <span class="n">new</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;team&#39;</span><span class="p">],</span><span class="s1">&#39;VALUE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="get_qb_elos-1061"><a href="#get_qb_elos-1061"><span class="linenos">1061</span></a>            <span class="n">new</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;opp_qbvalue_avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">by_opponent</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">by_opponent</span><span class="o">.</span><span class="n">opponent</span> <span class="o">==</span> <span class="n">new</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;opponent&#39;</span><span class="p">],</span><span class="s1">&#39;VALUE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">avg_value</span>
</span><span id="get_qb_elos-1062"><a href="#get_qb_elos-1062"><span class="linenos">1062</span></a>            <span class="n">new</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;VALUE&#39;</span><span class="p">]</span> <span class="o">-=</span> <span class="n">new</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;opp_qbvalue_avg&#39;</span><span class="p">]</span>
</span><span id="get_qb_elos-1063"><a href="#get_qb_elos-1063"><span class="linenos">1063</span></a>            <span class="n">new</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;qb_value_post&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;qb_value_pre&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="n">qb_games</span><span class="p">)</span> <span class="o">+</span> <span class="n">new</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;VALUE&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">qb_games</span>
</span><span id="get_qb_elos-1064"><a href="#get_qb_elos-1064"><span class="linenos">1064</span></a>            <span class="n">by_opponent</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">by_opponent</span><span class="o">.</span><span class="n">opponent</span> <span class="o">==</span> <span class="n">new</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;opponent&#39;</span><span class="p">],</span><span class="s1">&#39;VALUE&#39;</span><span class="p">]</span> <span class="o">*=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="n">team_games</span><span class="p">)</span>
</span><span id="get_qb_elos-1065"><a href="#get_qb_elos-1065"><span class="linenos">1065</span></a>            <span class="n">by_opponent</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">by_opponent</span><span class="o">.</span><span class="n">opponent</span> <span class="o">==</span> <span class="n">new</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;opponent&#39;</span><span class="p">],</span><span class="s1">&#39;VALUE&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">new</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;VALUE&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">team_games</span>
</span><span id="get_qb_elos-1066"><a href="#get_qb_elos-1066"><span class="linenos">1066</span></a>            <span class="n">by_team</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">by_team</span><span class="o">.</span><span class="n">team</span> <span class="o">==</span> <span class="n">new</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;team&#39;</span><span class="p">],</span><span class="s1">&#39;VALUE&#39;</span><span class="p">]</span> <span class="o">*=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="n">team_games</span><span class="p">)</span>
</span><span id="get_qb_elos-1067"><a href="#get_qb_elos-1067"><span class="linenos">1067</span></a>            <span class="n">by_team</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">by_team</span><span class="o">.</span><span class="n">team</span> <span class="o">==</span> <span class="n">new</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;team&#39;</span><span class="p">],</span><span class="s1">&#39;VALUE&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">new</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="s1">&#39;VALUE&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">team_games</span>
</span><span id="get_qb_elos-1068"><a href="#get_qb_elos-1068"><span class="linenos">1068</span></a>    <span class="n">new</span><span class="p">[</span><span class="s1">&#39;qb_adj&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">elo_adj</span><span class="o">*</span><span class="p">(</span><span class="n">new</span><span class="o">.</span><span class="n">qb_value_pre</span> <span class="o">-</span> <span class="n">new</span><span class="o">.</span><span class="n">team_qbvalue_avg</span><span class="p">)</span>
</span><span id="get_qb_elos-1069"><a href="#get_qb_elos-1069"><span class="linenos">1069</span></a>    <span class="k">return</span> <span class="n">new</span><span class="p">[[</span><span class="s1">&#39;game_id&#39;</span><span class="p">,</span><span class="s1">&#39;player&#39;</span><span class="p">,</span><span class="s1">&#39;team&#39;</span><span class="p">,</span><span class="s1">&#39;team_qbvalue_avg&#39;</span><span class="p">,</span>\
</span><span id="get_qb_elos-1070"><a href="#get_qb_elos-1070"><span class="linenos">1070</span></a>    <span class="s1">&#39;opp_qbvalue_avg&#39;</span><span class="p">,</span><span class="s1">&#39;qb_value_pre&#39;</span><span class="p">,</span><span class="s1">&#39;qb_adj&#39;</span><span class="p">,</span><span class="s1">&#39;qb_value_post&#39;</span><span class="p">,</span><span class="s1">&#39;VALUE&#39;</span><span class="p">]]</span>
</span></pre></div>


            <div class="docstring"><p>Pulls QB-related statistics and calculates QB elo ratings as they progress over time.</p>

<p>Args:
    start (int): first season of interest.
    finish (int): last season of interest.
    regress_pct (float, optional): percentage to regress QBs back to the mean between each season, defaults to 0.25.
    qb_games (int, optional): number of games to use in the rolling average for individual QB elos, defaults to 10.
    team_games (int, optional): number of games to use in the rolling average for team QB elos, defaults to 20.
    elo_adj (float, optional): conversion factor between QB rating and team elos, defaults to 3.3.</p>

<p>Returns:
    pd.DataFrame: dataframe containing QB statistics and elo ratings throughout the timeframe of interest.</p>
</div>


                </section>
                <section id="get_names">
                            <input id="get_names-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_names</span><span class="signature pdoc-code condensed">(<span class="return-annotation">):</span></span>

                <label class="view-source-button" for="get_names-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#get_names"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="get_names-1073"><a href="#get_names-1073"><span class="linenos">1073</span></a><span class="k">def</span> <span class="nf">get_names</span><span class="p">():</span>
</span><span id="get_names-1074"><a href="#get_names-1074"><span class="linenos">1074</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="get_names-1075"><a href="#get_names-1075"><span class="linenos">1075</span></a><span class="sd">    Pulls the player id and name for every player on Pro Football Reference for conversion purposes.</span>
</span><span id="get_names-1076"><a href="#get_names-1076"><span class="linenos">1076</span></a>
</span><span id="get_names-1077"><a href="#get_names-1077"><span class="linenos">1077</span></a><span class="sd">    Returns:</span>
</span><span id="get_names-1078"><a href="#get_names-1078"><span class="linenos">1078</span></a><span class="sd">        pd.DataFrame: dataframe containing name, position,</span>
</span><span id="get_names-1079"><a href="#get_names-1079"><span class="linenos">1079</span></a><span class="sd">        player id, and timespan of every player in the database.</span>
</span><span id="get_names-1080"><a href="#get_names-1080"><span class="linenos">1080</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="get_names-1081"><a href="#get_names-1081"><span class="linenos">1081</span></a>    <span class="n">names</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="get_names-1082"><a href="#get_names-1082"><span class="linenos">1082</span></a>    <span class="k">for</span> <span class="n">letter</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">65</span><span class="p">,</span> <span class="mi">91</span><span class="p">):</span>
</span><span id="get_names-1083"><a href="#get_names-1083"><span class="linenos">1083</span></a>        <span class="n">raw_text</span> <span class="o">=</span> <span class="n">get_page</span><span class="p">(</span><span class="s2">&quot;players/&quot;</span> <span class="o">+</span> <span class="nb">chr</span><span class="p">(</span><span class="n">letter</span><span class="p">))</span>
</span><span id="get_names-1084"><a href="#get_names-1084"><span class="linenos">1084</span></a>        <span class="n">players</span> <span class="o">=</span> <span class="n">raw_text</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;div_players&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">)</span>
</span><span id="get_names-1085"><a href="#get_names-1085"><span class="linenos">1085</span></a>        <span class="k">for</span> <span class="n">player</span> <span class="ow">in</span> <span class="n">players</span><span class="p">:</span>
</span><span id="get_names-1086"><a href="#get_names-1086"><span class="linenos">1086</span></a>            <span class="n">entry</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="get_names-1087"><a href="#get_names-1087"><span class="linenos">1087</span></a>                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">player</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
</span><span id="get_names-1088"><a href="#get_names-1088"><span class="linenos">1088</span></a>                <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">player</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="get_names-1089"><a href="#get_names-1089"><span class="linenos">1089</span></a>                <span class="s2">&quot;player_id&quot;</span><span class="p">:</span> <span class="n">player</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">)</span>
</span><span id="get_names-1090"><a href="#get_names-1090"><span class="linenos">1090</span></a>                <span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;href&quot;</span><span class="p">]</span>
</span><span id="get_names-1091"><a href="#get_names-1091"><span class="linenos">1091</span></a>                <span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="get_names-1092"><a href="#get_names-1092"><span class="linenos">1092</span></a>                <span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="get_names-1093"><a href="#get_names-1093"><span class="linenos">1093</span></a>                <span class="s2">&quot;years_active&quot;</span><span class="p">:</span> <span class="n">player</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;) &quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
</span><span id="get_names-1094"><a href="#get_names-1094"><span class="linenos">1094</span></a>            <span class="p">}</span>
</span><span id="get_names-1095"><a href="#get_names-1095"><span class="linenos">1095</span></a>            <span class="n">names</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">names</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="n">names</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]])])</span>
</span><span id="get_names-1096"><a href="#get_names-1096"><span class="linenos">1096</span></a>    <span class="k">return</span> <span class="n">names</span>
</span></pre></div>


            <div class="docstring"><p>Pulls the player id and name for every player on Pro Football Reference for conversion purposes.</p>

<p>Returns:
    pd.DataFrame: dataframe containing name, position,
    player id, and timespan of every player in the database.</p>
</div>


                </section>
    </main>
<script>
    /* Periodically check with the pdoc server if there have been any changes. */
    let mtime_generated = "1699506170.2",
        url = new URL(window.location);
    url.searchParams.set("mtime", 1);
    window.setInterval(function () {
        fetch(url.toString())
            .then(response => response.text())
            .then(mtime => {
                if (mtime_generated !== mtime)
                    location.reload();
            });
    }, 1000);
</script></body>
</html>